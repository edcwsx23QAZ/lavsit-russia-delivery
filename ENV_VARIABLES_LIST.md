# Список переменных окружения проекта

## Обязательные переменные (Required)

### 1. DATABASE_URL
- **Описание**: Строка подключения к базе данных Supabase PostgreSQL для миграций и серверных операций
- **Формат**: `postgresql://user:password@host:port/database?schema=public`
- **Где используется**: 
  - `lib/prisma.ts` - подключение к базе данных
  - `app/api/calculations/route.ts` - операции с базой данных
- **Где получить**: Supabase Dashboard → Settings → Database → Connection string (URI format)

### 2. NEXT_PUBLIC_SUPABASE_URL
- **Описание**: URL проекта Supabase для клиентской аутентификации и API вызовов
- **Формат**: `https://[project-id].supabase.co`
- **Где используется**: Клиентские компоненты (префикс `NEXT_PUBLIC_` делает переменную доступной в браузере)
- **Где получить**: Supabase Dashboard → Settings → API → Project URL

### 3. NEXT_PUBLIC_SUPABASE_ANON_KEY
- **Описание**: Анонимный/публичный ключ Supabase для клиентской аутентификации
- **Формат**: JWT токен
- **Где используется**: Клиентские компоненты для работы с Supabase API
- **Где получить**: Supabase Dashboard → Settings → API Keys → anon public key
- **Примечание**: Безопасен для использования на клиенте (публичный ключ)

### 4. PEK_LOGIN
- **Описание**: Логин пользователя личного кабинета ПЭК
- **Где используется**: 
  - `app/api/pek/route.ts` - API запросы к ПЭК
  - `app/api/pek-simple/route.ts` - упрощенные запросы к ПЭК
- **Где получить**: [kabinet.pecom.ru](https://kabinet.pecom.ru) - логин от личного кабинета

### 5. PEK_API_KEY
- **Описание**: API ключ доступа к ПЭК
- **Где используется**: 
  - `app/api/pek/route.ts` - API запросы к ПЭК
  - `app/api/pek-simple/route.ts` - упрощенные запросы к ПЭК
  - `lib/cache-manager.ts` - кэширование запросов ПЭК
- **Где получить**: [kabinet.pecom.ru](https://kabinet.pecom.ru) → Регистрационные данные → Ключи API
- **Дефолтное значение**: `624FC93CA677B23673BB476D4982294DC27E246F` (используется как fallback)

---

## Опциональные переменные (Optional)

### 6. KIT_API_TOKEN
- **Описание**: API токен для транспортной компании КИТ
- **Где используется**: `app/api/kit/route.ts` - API запросы к КИТ
- **Где получить**: Личный кабинет КИТ → Раздел "Разработчикам" → "Получение ключа API"
- **Примечание**: Если токен не настроен, API КИТ вернет ошибку, но не заблокирует работу приложения

### 7. NORDWHEEL_API_KEY
- **Описание**: API ключ для транспортной компании NordWheel
- **Где используется**: 
  - `app/api/nordwheel/route.ts` - API запросы к NordWheel
  - Тестовые файлы: `test-nordwheel-*.js`
- **Дефолтное значение**: `5|WYpV9f788Y2ASobpv3xy6N5qxtIUaKhxFF4yWETOfc398950`
- **Примечание**: Если ключ не настроен, используется дефолтное значение

### 8. DELLIN_APP_KEY
- **Описание**: App Key для API Деловых Линий (ДелЛин)
- **Где используется**: 
  - `app/api/dellin-freight/route.ts` - запросы к API ДелЛин
  - `app/api/dellin-packages/route.ts` - запросы к API ДелЛин
  - Тестовые файлы: `test-dellin-*.js`
- **Дефолтное значение**: `E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B`
- **Примечание**: Если ключ не настроен, используется дефолтное значение

### 9. API_BASE
- **Описание**: Базовый URL API для тестирования
- **Где используется**: `test-dellin-freight.js` - тестовые скрипты
- **Дефолтное значение**: `http://localhost:3000`
- **Примечание**: Используется только в тестовых скриптах

---

## Системные переменные Next.js

### 10. NODE_ENV
- **Описание**: Режим работы приложения (development/production)
- **Где используется**: 
  - `middleware.ts` - определение dev режима
  - `next.config.js` - конфигурация webpack
  - `lib/prisma.ts` - настройка логирования Prisma
  - `lib/error-handling.ts` - отображение технических деталей ошибок
  - Различные компоненты для условного рендеринга
- **Значения**: `development`, `production`, или `undefined` (по умолчанию development)

### 11. NEXT_RUNTIME
- **Описание**: Runtime окружение Next.js (nodejs/edge)
- **Где используется**: `instrumentation.ts` - инструментация (закомментировано)
- **Примечание**: Используется редко, в основном для специфических конфигураций

### 12. FORCE_NO_CACHE
- **Описание**: Внутренняя переменная для отключения кэширования
- **Где используется**: `next.config.js` - webpack конфигурация
- **Примечание**: Внутренняя переменная, устанавливается автоматически

---

## Итоговая статистика

- **Обязательных переменных**: 5
- **Опциональных переменных**: 4
- **Системных переменных**: 3
- **Всего уникальных переменных**: 12

---

## Файлы конфигурации

- **env.example** - пример файла с переменными окружения
- **lib/env-config.ts** - централизованная конфигурация переменных (только обязательные)
- **lib/env-checker.ts** - утилита для проверки переменных по компаниям
- **app/env-check/page.tsx** - страница проверки переменных окружения
- **middleware.ts** - проверка переменных и редирект на `/env-check` при отсутствии обязательных

---

## Примечания

1. **Префикс `NEXT_PUBLIC_`**: Переменные с этим префиксом автоматически становятся доступными в браузере. Без префикса переменные доступны только на сервере.

2. **Дефолтные значения**: Некоторые переменные имеют дефолтные значения (PEK_API_KEY, NORDWHEEL_API_KEY, DELLIN_APP_KEY), которые используются если переменная не установлена. Это позволяет приложению работать даже без настройки этих переменных.

3. **Проверка переменных**: Middleware автоматически проверяет наличие обязательных переменных и редиректит на `/env-check` если какие-то отсутствуют.

4. **Безопасность**: 
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY` - безопасен для использования на клиенте
   - Остальные переменные (особенно API ключи) должны храниться только на сервере
   - Никогда не коммитьте `.env` файл в git




