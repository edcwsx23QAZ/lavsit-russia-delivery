/**
 * –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤–∏–∫–∏-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
 * –ó–∞–ø—É—Å–∫: npx tsx scripts/create-full-wiki.ts
 * 
 * –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–µ—Ç –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–∏–∫–∏ —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
 */

import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∏–∫–∏ —Å–æ –≤—Å–µ–º–∏ —Ä–∞–∑–¥–µ–ª–∞–º–∏
// –ò–∑-–∑–∞ –æ–±—ä–µ–º–∞, —Å–æ–∑–¥–∞–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

async function createFullWikiStructure() {
  console.log('–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤–∏–∫–∏...\n');

  // –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è (–±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
  const pages = [
    {
      slug: 'introduction',
      title: '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø–æ –ª–æ–≥–∏—Å—Ç–∏–∫–µ',
      content: JSON.stringify({
        sections: [
          {
            id: 'intro',
            title: '–í–≤–µ–¥–µ–Ω–∏–µ',
            content: `### –¶–µ–ª—å –∏ –≤–∞–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã

–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ª–æ–≥–∏—Å—Ç–∏–∫–µ ‚Äî –∫–ª—é—á–µ–≤–æ–µ –∑–≤–µ–Ω–æ –≤ —Ü–µ–ø–æ—á–∫–µ –¥–æ—Å—Ç–∞–≤–∫–∏ –ø—Ä–µ–º–∏—É–º-–º–µ–±–µ–ª–∏. –í–∞—à–∞ —Ä–∞–±–æ—Ç–∞ –Ω–∞–ø—Ä—è–º—É—é –≤–ª–∏—è–µ—Ç –Ω–∞ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ —Ä–µ–ø—É—Ç–∞—Ü–∏—é –∫–æ–º–ø–∞–Ω–∏–∏.

–í –∫–æ–º–ø–∞–Ω–∏–∏ –¥–µ–π—Å—Ç–≤—É–µ—Ç **–∫–ª–∏–µ–Ω—Ç–æ–∫—Ä–∞—Ç–∏—è –ø–æ –í–∫—É—Å—Å–≤–∏–ª–ª—É** –∏ **AJTBD –ø–æ–¥—Ö–æ–¥** (Always Just The Best Delivery). –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –≤—Å–µ–≥–¥–∞ –ø—Ä–∞–≤, –∏ –º—ã —Å—Ç—Ä–µ–º–∏–º—Å—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ª—É—á—à–∏–π —Å–µ—Ä–≤–∏—Å –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ –æ—Ç—Ä–∞—Å–ª–∏.

### –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

–≠—Ç–∞ –≤–∏–∫–∏-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã. –í—Å–µ —Ä–∞–∑–¥–µ–ª—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã - –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–∫–∞—Ä–∞–Ω–¥–∞—à–∏–∫) —Ä—è–¥–æ–º —Å –ª—é–±—ã–º –±–ª–æ–∫–æ–º –¥–ª—è –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.`,
            order: 0
          }
        ]
      }),
      order: 0,
      parentSlug: null
    }
  ];

  for (const pageData of pages) {
    try {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
      const existing = await prisma.wikiPage.findUnique({
        where: { slug: pageData.slug }
      });

      if (existing) {
        console.log(`‚úì –°—Ç—Ä–∞–Ω–∏—Ü–∞ "${pageData.title}" —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç`);
        continue;
      }

      // –ù–∞—Ö–æ–¥–∏–º —Ä–æ–¥–∏—Ç–µ–ª—è
      let parentId: string | null = null;
      if (pageData.parentSlug) {
        const parent = await prisma.wikiPage.findUnique({
          where: { slug: pageData.parentSlug }
        });
        if (parent) parentId = parent.id;
      }

      // –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
      const page = await prisma.wikiPage.create({
        data: {
          slug: pageData.slug,
          title: pageData.title,
          content: pageData.content,
          order: pageData.order,
          parentId: parentId,
          isActive: true
        }
      });

      // –°–æ–∑–¥–∞–µ–º –≤–µ—Ä—Å–∏—é
      await prisma.wikiVersion.create({
        data: {
          pageId: page.id,
          title: page.title,
          content: page.content,
          version: 1,
          changeNote: '–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã',
          createdBy: null
        }
      });

      console.log(`‚úì –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞: "${pageData.title}"`);
    } catch (error: any) {
      console.error(`‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã "${pageData.title}":`, error.message);
    }
  }

  console.log('\n‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∏–∫–∏ —Å–æ–∑–¥–∞–Ω–∞!');
  console.log('\nüí° –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ:');
  console.log('   1. –û—Ç–∫—Ä—ã—Ç—å /wiki –≤ –±—Ä–∞—É–∑–µ—Ä–µ');
  console.log('   2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞');
  console.log('   3. –°–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å');
  console.log('   4. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å –±—ç–∫–∞–ø–∞–º–∏\n');
}

createFullWikiStructure()
  .then(() => {
    prisma.$disconnect();
    process.exit(0);
  })
  .catch((error) => {
    console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', error);
    prisma.$disconnect();
    process.exit(1);
  });


