From 9f775808193abfefcaa3eb78db03c48c9225fedf Mon Sep 17 00:00:00 2001
From: edcwsx23QAZ <edcwsx23qaz@users.noreply.github.com>
Date: Thu, 29 Jan 2026 10:47:53 +0300
Subject: [PATCH 09/12] =?UTF-8?q?feat:=20=D0=A1=D0=82=D0=A0=C2=B5=D0=A0?=
 =?UTF-8?q?=C2=B0=D0=A0=C2=BB=D0=A0=D1=91=D0=A0=C2=B7=D0=A0=C2=B0=D0=A1?=
 =?UTF-8?q?=E2=80=A0=D0=A0=D1=91=D0=A1=D0=8F=20=D0=A0=D1=97=D0=A0=D1=95?=
 =?UTF-8?q?=D0=A0=C2=BB=D0=A0=D0=85=D0=A0=D1=95=D0=A0=E2=84=96=20=D0=A0?=
 =?UTF-8?q?=D0=86=D0=A0=D1=91=D0=A0=D1=94=D0=A0=D1=91-=D0=A0=D1=91=D0=A0?=
 =?UTF-8?q?=D0=85=D0=A1=D0=83=D0=A1=E2=80=9A=D0=A1=D0=82=D0=A1=D1=93=D0=A0?=
 =?UTF-8?q?=D1=94=D0=A1=E2=80=A0=D0=A0=D1=91=D0=A0=D1=91=20=D0=A0=D2=91?=
 =?UTF-8?q?=D0=A0=C2=BB=D0=A1=D0=8F=20=D0=A0=C2=BB=D0=A0=D1=95=D0=A0=D1=96?=
 =?UTF-8?q?=D0=A0=D1=91=D0=A1=D0=83=D0=A1=E2=80=9A=D0=A0=D1=95=D0=A0=D0=86?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

- –†‚Äî–†¬∞–†—ò–†¬µ–†–Ö–†¬∞ alert/confirm –†–Ö–†¬∞ UI –†—î–†—ï–†—ò–†—ó–†—ï–†–Ö–†¬µ–†–Ö–°‚Äö–°‚Äπ (Dialog, Toast)
- –†‚Äô–†—î–†¬ª–°–ã–°‚Ä°–†¬µ–†–Ö–†—ë–†¬µ CRUD –†—ï–†—ó–†¬µ–°–Ç–†¬∞–°‚Ä†–†—ë–†‚Ññ –°–É Prisma –†“ë–†¬ª–°–è wiki –°–É–°‚Äö–°–Ç–†¬∞–†–Ö–†—ë–°‚Ä†
- –†–é–†—ë–°–É–°‚Äö–†¬µ–†—ò–†¬∞ –†–Ü–†¬µ–°–Ç–°–É–†—ë–†—ï–†–Ö–†—ë–°–Ç–†—ï–†–Ü–†¬∞–†–Ö–†—ë–°–è –°–É –†¬∞–†–Ü–°‚Äö–†—ï–†—ò–†¬∞–°‚Äö–†—ë–°‚Ä°–†¬µ–°–É–†—î–†—ë–†—ò –°–É–†—ï–†¬∑–†“ë–†¬∞–†–Ö–†—ë–†¬µ–†—ò –†–Ü–†¬µ–°–Ç–°–É–†—ë–†‚Ññ
- –†¬†–†¬µ–†“ë–†¬∞–†—î–°‚Äö–†—ë–°–Ç–°—ì–†¬µ–†—ò–°‚Äπ–†¬µ –†¬±–†¬ª–†—ï–†—î–†—ë –°–É –†—î–†–Ö–†—ï–†—ó–†—î–†¬∞–†—ò–†—ë –°–Ç–†¬µ–†“ë–†¬∞–†—î–°‚Äö–†—ë–°–Ç–†—ï–†–Ü–†¬∞–†–Ö–†—ë–°–è
- –†–é–†—ë–°–É–°‚Äö–†¬µ–†—ò–†¬∞ –†–Ü–†–Ö–°—ì–°‚Äö–°–Ç–†¬µ–†–Ö–†–Ö–†—ë–°‚Ä¶ –°–É–°–É–°‚Äπ–†¬ª–†—ï–†—î –†—ò–†¬µ–†¬∂–†“ë–°—ì –†¬±–†¬ª–†—ï–†—î–†¬∞–†—ò–†—ë
- –†–à–†¬ª–°—ì–°‚Ä°–°‚Ç¨–†¬µ–†–Ö–†–Ö–†—ï–†¬µ –†“ë–†¬µ–°–Ç–†¬µ–†–Ü–†—ï –°–É–°‚Äö–°–Ç–†¬∞–†–Ö–†—ë–°‚Ä† –°–É breadcrumbs
- –†–é–†—ë–°–É–°‚Äö–†¬µ–†—ò–†¬∞ –†¬±–°–å–†—î–†¬∞–†—ó–†—ï–†–Ü –°–É API endpoint
- –†—ü–†—ï–†¬ª–†–Ö–°‚Äπ–†‚Ññ –†—î–†—ï–†–Ö–°‚Äö–†¬µ–†–Ö–°‚Äö –†“ë–†¬ª–°–è –†–Ü–°–É–†¬µ–°‚Ä¶ 13 –†¬±–†¬ª–†—ï–†—î–†—ï–†–Ü –†–Ü–†—ë–†—î–†—ë
- –†–é–†—î–°–Ç–†—ë–†—ó–°‚Äö–°‚Äπ –†“ë–†¬ª–°–è –†—ë–†—ò–†—ó–†—ï–°–Ç–°‚Äö–†¬∞, –†—ó–°–Ç–†—ï–†–Ü–†¬µ–°–Ç–†—î–†—ë –†—ë –†¬±–°–å–†—î–†¬∞–†—ó–†¬∞
---
 app/api/wiki/backup/route.ts          | 212 +++++++++++++++++
 app/api/wiki/pages/route.ts           | 324 ++++++++++++++++++++++----
 app/wiki/page.tsx                     | 151 +++++++-----
 components/wiki/ConfirmDialog.tsx     |  60 +++++
 components/wiki/EditableBlock.tsx     |  87 +++++++
 components/wiki/LinkEditor.tsx        | 150 ++++++++++++
 components/wiki/PageManager.tsx       | 154 +++++++++---
 components/wiki/VersionHistory.tsx    |  35 ++-
 components/wiki/WikiContentEditor.tsx |   7 +-
 components/wiki/WikiEditor.tsx        |  49 ++--
 10 files changed, 1064 insertions(+), 165 deletions(-)
 create mode 100644 app/api/wiki/backup/route.ts
 create mode 100644 components/wiki/ConfirmDialog.tsx
 create mode 100644 components/wiki/EditableBlock.tsx
 create mode 100644 components/wiki/LinkEditor.tsx

diff --git a/app/api/wiki/backup/route.ts b/app/api/wiki/backup/route.ts
new file mode 100644
index 00000000..424b6816
--- /dev/null
+++ b/app/api/wiki/backup/route.ts
@@ -0,0 +1,212 @@
+import { NextRequest, NextResponse } from 'next/server';
+import { prisma } from '@/lib/prisma';
+
+// GET - –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –∏ –≤–µ—Ä—Å–∏–π
+export async function GET(request: NextRequest) {
+  try {
+    const { searchParams } = new URL(request.url);
+    const format = searchParams.get('format') || 'json';
+
+    // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
+    const pages = await prisma.wikiPage.findMany({
+      where: { isActive: true },
+      include: {
+        parent: {
+          select: {
+            id: true,
+            title: true,
+            slug: true
+          }
+        },
+        children: {
+          where: { isActive: true },
+          select: {
+            id: true,
+            title: true,
+            slug: true
+          }
+        },
+        versions: {
+          orderBy: { version: 'desc' },
+          take: 10 // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –≤–µ—Ä—Å–∏–π –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
+        }
+      },
+      orderBy: [{ order: 'asc' }, { createdAt: 'asc' }]
+    });
+
+    const backup = {
+      exportDate: new Date().toISOString(),
+      version: '1.0',
+      pages: pages.map(page => ({
+        id: page.id,
+        slug: page.slug,
+        title: page.title,
+        content: page.content,
+        order: page.order,
+        parentId: page.parentId,
+        createdAt: page.createdAt.toISOString(),
+        updatedAt: page.updatedAt.toISOString(),
+        createdBy: page.createdBy,
+        updatedBy: page.updatedBy,
+        versions: page.versions.map(v => ({
+          id: v.id,
+          content: v.content,
+          title: v.title,
+          version: v.version,
+          changeNote: v.changeNote,
+          createdBy: v.createdBy,
+          createdAt: v.createdAt.toISOString()
+        }))
+      }))
+    };
+
+    if (format === 'json') {
+      return NextResponse.json(backup, {
+        headers: {
+          'Content-Type': 'application/json',
+          'Content-Disposition': `attachment; filename="wiki-backup-${new Date().toISOString().split('T')[0]}.json"`
+        }
+      });
+    }
+
+    // –î–ª—è –¥—Ä—É–≥–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é
+    return NextResponse.json(backup);
+  } catch (error: any) {
+    console.error('Error exporting backup:', error);
+    return NextResponse.json(
+      { error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –±—ç–∫–∞–ø–∞: ' + (error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') },
+      { status: 500 }
+    );
+  }
+}
+
+// POST - –ò–º–ø–æ—Ä—Ç —Å—Ç—Ä–∞–Ω–∏—Ü –∏ –≤–µ—Ä—Å–∏–π
+export async function POST(request: NextRequest) {
+  try {
+    const body = await request.json();
+    const { pages, overwrite = false } = body;
+
+    if (!pages || !Array.isArray(pages)) {
+      return NextResponse.json(
+        { error: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö. –û–∂–∏–¥–∞–µ—Ç—Å—è –º–∞—Å—Å–∏–≤ pages.' },
+        { status: 400 }
+      );
+    }
+
+    const importedPages = [];
+    const errors = [];
+
+    for (const pageData of pages) {
+      try {
+        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
+        const existingPage = await prisma.wikiPage.findUnique({
+          where: { slug: pageData.slug }
+        });
+
+        if (existingPage && !overwrite) {
+          errors.push(`–°—Ç—Ä–∞–Ω–∏—Ü–∞ "${pageData.title}" (${pageData.slug}) —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ overwrite=true –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏.`);
+          continue;
+        }
+
+        if (existingPage && overwrite) {
+          // –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
+          const updatedPage = await prisma.wikiPage.update({
+            where: { slug: pageData.slug },
+            data: {
+              title: pageData.title,
+              content: pageData.content,
+              order: pageData.order,
+              parentId: pageData.parentId || null,
+              updatedBy: pageData.updatedBy || null
+            }
+          });
+
+          // –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏–∏
+          if (pageData.versions && Array.isArray(pageData.versions)) {
+            for (const versionData of pageData.versions) {
+              try {
+                await prisma.wikiVersion.upsert({
+                  where: {
+                    pageId_version: {
+                      pageId: updatedPage.id,
+                      version: versionData.version
+                    }
+                  },
+                  create: {
+                    pageId: updatedPage.id,
+                    content: versionData.content,
+                    title: versionData.title,
+                    version: versionData.version,
+                    changeNote: versionData.changeNote || `–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ –±—ç–∫–∞–ø–∞`,
+                    createdBy: versionData.createdBy || null
+                  },
+                  update: {
+                    content: versionData.content,
+                    title: versionData.title,
+                    changeNote: versionData.changeNote || `–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ –±—ç–∫–∞–ø–∞`
+                  }
+                });
+              } catch (versionError) {
+                console.error(`Error importing version ${versionData.version} for page ${pageData.slug}:`, versionError);
+              }
+            }
+          }
+
+          importedPages.push({ slug: updatedPage.slug, title: updatedPage.title, action: 'updated' });
+        } else {
+          // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
+          const newPage = await prisma.wikiPage.create({
+            data: {
+              slug: pageData.slug,
+              title: pageData.title,
+              content: pageData.content,
+              order: pageData.order,
+              parentId: pageData.parentId || null,
+              createdBy: pageData.createdBy || null,
+              isActive: true
+            }
+          });
+
+          // –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏–∏
+          if (pageData.versions && Array.isArray(pageData.versions)) {
+            for (const versionData of pageData.versions) {
+              try {
+                await prisma.wikiVersion.create({
+                  data: {
+                    pageId: newPage.id,
+                    content: versionData.content,
+                    title: versionData.title,
+                    version: versionData.version,
+                    changeNote: versionData.changeNote || `–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ –±—ç–∫–∞–ø–∞`,
+                    createdBy: versionData.createdBy || null
+                  }
+                });
+              } catch (versionError) {
+                console.error(`Error importing version ${versionData.version} for page ${pageData.slug}:`, versionError);
+              }
+            }
+          }
+
+          importedPages.push({ slug: newPage.slug, title: newPage.title, action: 'created' });
+        }
+      } catch (pageError: any) {
+        console.error(`Error importing page ${pageData.slug}:`, pageError);
+        errors.push(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã "${pageData.title}" (${pageData.slug}): ${pageError.message}`);
+      }
+    }
+
+    return NextResponse.json({
+      success: true,
+      imported: importedPages.length,
+      pages: importedPages,
+      errors: errors.length > 0 ? errors : undefined
+    });
+  } catch (error: any) {
+    console.error('Error importing backup:', error);
+    return NextResponse.json(
+      { error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –±—ç–∫–∞–ø–∞: ' + (error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') },
+      { status: 500 }
+    );
+  }
+}
+
diff --git a/app/api/wiki/pages/route.ts b/app/api/wiki/pages/route.ts
index 7b9316fb..757f4689 100644
--- a/app/api/wiki/pages/route.ts
+++ b/app/api/wiki/pages/route.ts
@@ -1,59 +1,82 @@
 import { NextRequest, NextResponse } from 'next/server';
-import { wikiPagesData } from '@/lib/wiki-data';
+import { prisma } from '@/lib/prisma';
 
 // GET - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
 export async function GET(request: NextRequest) {
   try {
     const { searchParams } = new URL(request.url);
     const slug = searchParams.get('slug');
+    const id = searchParams.get('id');
     const includeVersions = searchParams.get('includeVersions') === 'true';
 
-    const pages = wikiPagesData.pages || [];
-
     if (slug) {
-      // –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
-      const page = pages.find((p: any) => p.slug === slug && p.isActive !== false);
-      
+      // –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ slug
+      const page = await prisma.wikiPage.findUnique({
+        where: { slug, isActive: true },
+        include: {
+          parent: true,
+          children: {
+            where: { isActive: true },
+            orderBy: [{ order: 'asc' }, { createdAt: 'asc' }]
+          },
+          versions: includeVersions ? {
+            orderBy: { version: 'desc' },
+            take: 10
+          } : false
+        }
+      });
+
       if (!page) {
         return NextResponse.json({ error: '–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞' }, { status: 404 });
       }
 
-      // –î–æ–±–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–µ —Å–≤—è–∑–∏ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
-      const pageWithRelations = {
-        ...page,
-        parent: null,
-        children: pages.filter((p: any) => p.parentId === page.id && p.isActive !== false),
-        versions: includeVersions ? [] : undefined
-      };
+      return NextResponse.json(page);
+    } else if (id) {
+      // –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ id
+      const page = await prisma.wikiPage.findUnique({
+        where: { id, isActive: true },
+        include: {
+          parent: true,
+          children: {
+            where: { isActive: true },
+            orderBy: [{ order: 'asc' }, { createdAt: 'asc' }]
+          },
+          versions: includeVersions ? {
+            orderBy: { version: 'desc' },
+            take: 10
+          } : false
+        }
+      });
+
+      if (!page) {
+        return NextResponse.json({ error: '–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞' }, { status: 404 });
+      }
 
-      return NextResponse.json(pageWithRelations);
+      return NextResponse.json(page);
     } else {
       // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
-      const activePages = pages
-        .filter((p: any) => p.isActive !== false)
-        .map((page: any) => ({
-          ...page,
-          parent: page.parentId ? pages.find((p: any) => p.id === page.parentId) || null : null,
-          children: pages.filter((p: any) => p.parentId === page.id && p.isActive !== false)
-        }))
-        .sort((a: any, b: any) => {
-          // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ order, –∑–∞—Ç–µ–º –ø–æ createdAt
-          if (a.order !== b.order) {
-            return a.order - b.order;
+      const pages = await prisma.wikiPage.findMany({
+        where: { isActive: true },
+        include: {
+          parent: true,
+          children: {
+            where: { isActive: true }
           }
-          return new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime();
-        });
+        },
+        orderBy: [{ order: 'asc' }, { createdAt: 'asc' }]
+      });
 
-      return NextResponse.json(activePages);
+      return NextResponse.json(pages);
     }
   } catch (error: any) {
     console.error('Error fetching wiki pages:', error);
-    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ
+    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –ø—Ä–∏ –æ—à–∏–±–∫–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
     try {
       const { searchParams } = new URL(request.url);
       const slug = searchParams.get('slug');
+      const id = searchParams.get('id');
       
-      if (slug) {
+      if (slug || id) {
         return NextResponse.json({ error: '–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞' }, { status: 404 });
       }
       return NextResponse.json([], { status: 200 });
@@ -63,26 +86,237 @@ export async function GET(request: NextRequest) {
   }
 }
 
-// POST - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (—Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è, –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–º —Ñ–∞–π–ª–µ)
+// POST - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
 export async function POST(request: NextRequest) {
-  return NextResponse.json(
-    { error: '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ API –æ—Ç–∫–ª—é—á–µ–Ω–æ. –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–º —Ñ–∞–π–ª–µ data/wiki-pages.json' },
-    { status: 405 }
-  );
+  try {
+    const body = await request.json();
+    const { title, slug, content, parentId, order, createdBy } = body;
+
+    if (!title || !slug) {
+      return NextResponse.json(
+        { error: '–ù–µ–æ–±—Ö–æ–¥–∏–º—ã title –∏ slug' },
+        { status: 400 }
+      );
+    }
+
+    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ slug
+    const existingPage = await prisma.wikiPage.findUnique({
+      where: { slug }
+    });
+
+    if (existingPage) {
+      return NextResponse.json(
+        { error: '–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Ç–∞–∫–∏–º slug —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' },
+        { status: 409 }
+      );
+    }
+
+    // –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
+    const newPage = await prisma.wikiPage.create({
+      data: {
+        title,
+        slug,
+        content: content || `# ${title}\n\n–ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞. –ù–∞—á–Ω–∏—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.`,
+        parentId: parentId || null,
+        order: order ?? 0,
+        createdBy: createdBy || null,
+        isActive: true
+      },
+      include: {
+        parent: true,
+        children: true
+      }
+    });
+
+    // –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –≤–µ—Ä—Å–∏—é
+    await prisma.wikiVersion.create({
+      data: {
+        pageId: newPage.id,
+        title: newPage.title,
+        content: newPage.content,
+        version: 1,
+        changeNote: '–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã',
+        createdBy: createdBy || null
+      }
+    });
+
+    return NextResponse.json(newPage, { status: 201 });
+  } catch (error: any) {
+    console.error('Error creating wiki page:', error);
+    
+    if (error.code === 'P2002') {
+      return NextResponse.json(
+        { error: '–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Ç–∞–∫–∏–º slug —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' },
+        { status: 409 }
+      );
+    }
+
+    return NextResponse.json(
+      { error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: ' + (error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') },
+      { status: 500 }
+    );
+  }
 }
 
-// PUT - –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (—Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è, –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–º —Ñ–∞–π–ª–µ)
+// PUT - –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
 export async function PUT(request: NextRequest) {
-  return NextResponse.json(
-    { error: '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ API –æ—Ç–∫–ª—é—á–µ–Ω–æ. –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–º —Ñ–∞–π–ª–µ data/wiki-pages.json' },
-    { status: 405 }
-  );
+  try {
+    const body = await request.json();
+    const { id, title, slug, content, parentId, order, updatedBy, changeNote } = body;
+
+    if (!id) {
+      return NextResponse.json(
+        { error: '–ù–µ–æ–±—Ö–æ–¥–∏–º id —Å—Ç—Ä–∞–Ω–∏—Ü—ã' },
+        { status: 400 }
+      );
+    }
+
+    // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ—Ä—Å–∏–∏
+    const currentPage = await prisma.wikiPage.findUnique({
+      where: { id },
+      include: {
+        versions: {
+          orderBy: { version: 'desc' },
+          take: 1
+        }
+      }
+    });
+
+    if (!currentPage) {
+      return NextResponse.json(
+        { error: '–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞' },
+        { status: 404 }
+      );
+    }
+
+    // –ï—Å–ª–∏ slug –∏–∑–º–µ–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
+    if (slug && slug !== currentPage.slug) {
+      const existingPage = await prisma.wikiPage.findUnique({
+        where: { slug }
+      });
+
+      if (existingPage) {
+        return NextResponse.json(
+          { error: '–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Ç–∞–∫–∏–º slug —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' },
+          { status: 409 }
+        );
+      }
+    }
+
+    // –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
+    const updateData: any = {
+      updatedBy: updatedBy || null
+    };
+
+    if (title !== undefined) updateData.title = title;
+    if (slug !== undefined) updateData.slug = slug;
+    if (content !== undefined) updateData.content = content;
+    if (parentId !== undefined) updateData.parentId = parentId;
+    if (order !== undefined) updateData.order = order;
+
+    // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
+    const updatedPage = await prisma.wikiPage.update({
+      where: { id },
+      data: updateData,
+      include: {
+        parent: true,
+        children: {
+          where: { isActive: true }
+        }
+      }
+    });
+
+    // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é, –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è –∫–æ–Ω—Ç–µ–Ω—Ç –∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫
+    const contentChanged = content !== undefined && content !== currentPage.content;
+    const titleChanged = title !== undefined && title !== currentPage.title;
+
+    if (contentChanged || titleChanged) {
+      const nextVersion = (currentPage.versions[0]?.version || 0) + 1;
+
+      await prisma.wikiVersion.create({
+        data: {
+          pageId: updatedPage.id,
+          title: updatedPage.title,
+          content: updatedPage.content,
+          version: nextVersion,
+          changeNote: changeNote || '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã',
+          createdBy: updatedBy || null
+        }
+      });
+
+      // –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ (–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10)
+      await prisma.wikiVersion.deleteMany({
+        where: {
+          pageId: id,
+          version: {
+            lt: nextVersion - 9 // –£–¥–∞–ª–∏—Ç—å –≤–µ—Ä—Å–∏–∏ —Å—Ç–∞—Ä—à–µ 10 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö
+          }
+        }
+      });
+    }
+
+    return NextResponse.json(updatedPage);
+  } catch (error: any) {
+    console.error('Error updating wiki page:', error);
+    
+    if (error.code === 'P2025') {
+      return NextResponse.json(
+        { error: '–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞' },
+        { status: 404 }
+      );
+    }
+
+    if (error.code === 'P2002') {
+      return NextResponse.json(
+        { error: '–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Ç–∞–∫–∏–º slug —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' },
+        { status: 409 }
+      );
+    }
+
+    return NextResponse.json(
+      { error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: ' + (error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') },
+      { status: 500 }
+    );
+  }
 }
 
-// DELETE - –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (—Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è, –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–º —Ñ–∞–π–ª–µ)
+// DELETE - –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)
 export async function DELETE(request: NextRequest) {
-  return NextResponse.json(
-    { error: '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ API –æ—Ç–∫–ª—é—á–µ–Ω–æ. –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–º —Ñ–∞–π–ª–µ data/wiki-pages.json' },
-    { status: 405 }
-  );
+  try {
+    const { searchParams } = new URL(request.url);
+    const id = searchParams.get('id');
+
+    if (!id) {
+      return NextResponse.json(
+        { error: '–ù–µ–æ–±—Ö–æ–¥–∏–º id —Å—Ç—Ä–∞–Ω–∏—Ü—ã' },
+        { status: 400 }
+      );
+    }
+
+    // –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ - –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –Ω–µ–∞–∫—Ç–∏–≤–Ω—É—é
+    const deletedPage = await prisma.wikiPage.update({
+      where: { id },
+      data: { isActive: false },
+      include: {
+        parent: true,
+        children: true
+      }
+    });
+
+    return NextResponse.json(deletedPage);
+  } catch (error: any) {
+    console.error('Error deleting wiki page:', error);
+    
+    if (error.code === 'P2025') {
+      return NextResponse.json(
+        { error: '–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞' },
+        { status: 404 }
+      );
+    }
+
+    return NextResponse.json(
+      { error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: ' + (error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') },
+      { status: 500 }
+    );
+  }
 }
diff --git a/app/wiki/page.tsx b/app/wiki/page.tsx
index bcb51db0..e754b788 100644
--- a/app/wiki/page.tsx
+++ b/app/wiki/page.tsx
@@ -8,7 +8,17 @@ import WikiEditor from '@/components/wiki/WikiEditor';
 import WikiContentEditor, { WikiContentEditorRef } from '@/components/wiki/WikiContentEditor';
 import PageManager from '@/components/wiki/PageManager';
 import VersionHistory from '@/components/wiki/VersionHistory';
+import EditableSection from '@/components/wiki/EditableSection';
 import { FileText, Edit, History, ArrowLeft, Layout, Save, Loader2, Lock, Unlock } from 'lucide-react';
+import { WikiSection } from '@/components/wiki/types';
+import {
+  Breadcrumb,
+  BreadcrumbItem,
+  BreadcrumbLink,
+  BreadcrumbList,
+  BreadcrumbPage,
+  BreadcrumbSeparator,
+} from '@/components/ui/breadcrumb';
 
 interface WikiPage {
   id: string;
@@ -553,6 +563,20 @@ export default function WikiPage() {
     window.history.pushState({}, '', `/wiki?slug=${page.slug}`);
   };
 
+  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è breadcrumbs
+  const buildBreadcrumbs = (page: WikiPage | null): WikiPage[] => {
+    if (!page) return [];
+    const breadcrumbs: WikiPage[] = [];
+    let current: WikiPage | null = page;
+    
+    while (current) {
+      breadcrumbs.unshift(current);
+      current = current.parent || null;
+    }
+    
+    return breadcrumbs;
+  };
+
   const handlePageCreate = (page: WikiPage) => {
     setSelectedPage(page);
     setIsEditing(true);
@@ -584,7 +608,7 @@ export default function WikiPage() {
         const paraText = currentParagraph.join(' ');
         elements.push(
           <p key={`p-${elements.length}`} className="mb-4">
-            {renderInline(paraText)}
+            {renderInline(paraText, pages)}
           </p>
         );
         currentParagraph = [];
@@ -596,7 +620,7 @@ export default function WikiPage() {
         elements.push(
           <ul key={`ul-${elements.length}`} className="list-disc list-inside mb-4 space-y-1">
             {listItems.map((item, idx) => (
-              <li key={idx}>{renderInline(item)}</li>
+              <li key={idx}>{renderInline(item, pages)}</li>
             ))}
           </ul>
         );
@@ -657,7 +681,7 @@ export default function WikiPage() {
     return <div>{elements}</div>;
   };
 
-  const renderInline = (text: string): (string | JSX.Element)[] => {
+  const renderInline = (text: string, pages: WikiPage[] = []): (string | JSX.Element)[] => {
     const parts: (string | JSX.Element)[] = [];
     let lastIndex = 0;
     let key = 0;
@@ -669,13 +693,22 @@ export default function WikiPage() {
       if (match.index > lastIndex) {
         parts.push(text.substring(lastIndex, match.index));
       }
+      const url = match[2];
+      const isInternal = url.startsWith('/wiki') || url.startsWith('wiki') || url.includes('slug=');
+      const handleClick = isInternal ? (e: React.MouseEvent) => {
+        e.preventDefault();
+        const slug = url.includes('slug=') ? url.split('slug=')[1].split('&')[0] : url.replace('/wiki?', '').replace('wiki/', '');
+        window.location.href = `/wiki?slug=${slug}`;
+      } : undefined;
+      
       parts.push(
         <a
           key={`link-${key++}`}
-          href={match[2]}
-          target="_blank"
-          rel="noopener noreferrer"
+          href={url}
+          target={isInternal ? undefined : '_blank'}
+          rel={isInternal ? undefined : 'noopener noreferrer'}
           className="text-blue-600 hover:underline"
+          onClick={handleClick}
         >
           {match[1]}
         </a>
@@ -909,6 +942,7 @@ export default function WikiPage() {
                 initialContent={selectedPage.content}
                 onSave={handleSave}
                 onCancel={() => setIsEditing(false)}
+                pages={pages.map(p => ({ id: p.id, title: p.title, slug: p.slug }))}
               />
             ) : isStructuredEditing && selectedPage ? (
               <WikiContentEditor
@@ -926,6 +960,33 @@ export default function WikiPage() {
               />
             ) : selectedPage ? (
               <div className="bg-white rounded-lg shadow p-8">
+                {/* Breadcrumbs */}
+                {buildBreadcrumbs(selectedPage).length > 1 && (
+                  <Breadcrumb className="mb-4">
+                    <BreadcrumbList>
+                      {buildBreadcrumbs(selectedPage).map((page, index, array) => (
+                        <div key={page.id} className="flex items-center">
+                          {index > 0 && <BreadcrumbSeparator />}
+                          {index === array.length - 1 ? (
+                            <BreadcrumbPage>{page.title}</BreadcrumbPage>
+                          ) : (
+                            <BreadcrumbItem>
+                              <BreadcrumbLink
+                                href="#"
+                                onClick={(e) => {
+                                  e.preventDefault();
+                                  handlePageSelect(page);
+                                }}
+                              >
+                                {page.title}
+                              </BreadcrumbLink>
+                            </BreadcrumbItem>
+                          )}
+                        </div>
+                      ))}
+                    </BreadcrumbList>
+                  </Breadcrumb>
+                )}
                 <h1 className="text-3xl font-bold mb-6">{selectedPage.title}</h1>
                 <div className="prose prose-lg max-w-none">
                   {(() => {
@@ -937,63 +998,31 @@ export default function WikiPage() {
                     try {
                       const parsed = JSON.parse(selectedPage.content);
                       if (parsed.sections && Array.isArray(parsed.sections) && parsed.sections.length > 0) {
-                        // –≠—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç - –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –µ–≥–æ
+                        // –≠—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç - –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –µ–≥–æ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
+                        const handleSectionUpdate = async (updatedSection: WikiSection) => {
+                          const updatedSections = parsed.sections.map((s: WikiSection) =>
+                            s.id === updatedSection.id ? updatedSection : s
+                          );
+                          const updatedContent = JSON.stringify({ sections: updatedSections }, null, 2);
+                          await handleStructuredSave(updatedContent);
+                        };
+
+                        const handleSectionDelete = async (sectionId: string) => {
+                          const updatedSections = parsed.sections.filter((s: WikiSection) => s.id !== sectionId);
+                          const updatedContent = JSON.stringify({ sections: updatedSections }, null, 2);
+                          await handleStructuredSave(updatedContent);
+                        };
+
                         return (
                           <div className="space-y-6">
-                            {parsed.sections.map((section: any, index: number) => (
-                              <div key={section.id || index} className="border-b pb-6 last:border-b-0">
-                                {section.title && (
-                                  <h2 className="text-2xl font-bold mb-4">{section.title}</h2>
-                                )}
-                                {section.content && (
-                                  <div className="mb-4 whitespace-pre-wrap text-gray-700">
-                                    {renderMarkdown(section.content)}
-                                  </div>
-                                )}
-                                {section.columns && section.columns.length > 0 && (
-                                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4">
-                                    {section.columns.map((column: any) => (
-                                      <div key={column.id} className="border rounded p-4">
-                                        {column.title && (
-                                          <h3 className="font-semibold mb-2">{column.title}</h3>
-                                        )}
-                                        {column.content && (
-                                          <p className="text-sm whitespace-pre-wrap">{column.content}</p>
-                                        )}
-                                        {column.contacts && column.contacts.length > 0 && (
-                                          <div className="mt-4 pt-4 border-t">
-                                            <h4 className="font-semibold text-sm mb-2">–ö–æ–Ω—Ç–∞–∫—Ç—ã:</h4>
-                                            {column.contacts.map((contact: any) => (
-                                              <div key={contact.id} className="text-sm mb-2">
-                                                <p className="font-medium">{contact.name}</p>
-                                                {contact.position && <p className="text-gray-600">{contact.position}</p>}
-                                                {contact.phone && <p>üìû {contact.phone}</p>}
-                                                {contact.email && <p>‚úâÔ∏è {contact.email}</p>}
-                                              </div>
-                                            ))}
-                                          </div>
-                                        )}
-                                      </div>
-                                    ))}
-                                  </div>
-                                )}
-                                {section.contacts && section.contacts.length > 0 && (
-                                  <div className="mt-4 pt-4 border-t">
-                                    <h3 className="font-semibold mb-3">–ö–æ–Ω—Ç–∞–∫—Ç—ã:</h3>
-                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
-                                      {section.contacts.map((contact: any) => (
-                                        <div key={contact.id} className="border rounded p-4">
-                                          <p className="font-semibold">{contact.name}</p>
-                                          {contact.position && <p className="text-sm text-gray-600">{contact.position}</p>}
-                                          {contact.phone && <p className="text-sm">üìû {contact.phone}</p>}
-                                          {contact.email && <p className="text-sm">‚úâÔ∏è {contact.email}</p>}
-                                          {contact.notes && <p className="text-sm text-gray-500 italic mt-2">{contact.notes}</p>}
-                                        </div>
-                                      ))}
-                                    </div>
-                                  </div>
-                                )}
-                              </div>
+                            {parsed.sections.map((section: WikiSection, index: number) => (
+                              <EditableSection
+                                key={section.id || index}
+                                section={section}
+                                onUpdate={handleSectionUpdate}
+                                onDelete={handleSectionDelete}
+                                isEditing={false}
+                              />
                             ))}
                           </div>
                         );
diff --git a/components/wiki/ConfirmDialog.tsx b/components/wiki/ConfirmDialog.tsx
new file mode 100644
index 00000000..e2a65518
--- /dev/null
+++ b/components/wiki/ConfirmDialog.tsx
@@ -0,0 +1,60 @@
+'use client';
+
+import {
+  AlertDialog,
+  AlertDialogAction,
+  AlertDialogCancel,
+  AlertDialogContent,
+  AlertDialogDescription,
+  AlertDialogFooter,
+  AlertDialogHeader,
+  AlertDialogTitle,
+} from '@/components/ui/alert-dialog';
+
+interface ConfirmDialogProps {
+  open: boolean;
+  onOpenChange: (open: boolean) => void;
+  title: string;
+  description: string;
+  confirmText?: string;
+  cancelText?: string;
+  onConfirm: () => void;
+  variant?: 'default' | 'destructive';
+}
+
+export default function ConfirmDialog({
+  open,
+  onOpenChange,
+  title,
+  description,
+  confirmText = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å',
+  cancelText = '–û—Ç–º–µ–Ω–∞',
+  onConfirm,
+  variant = 'default',
+}: ConfirmDialogProps) {
+  const handleConfirm = () => {
+    onConfirm();
+    onOpenChange(false);
+  };
+
+  return (
+    <AlertDialog open={open} onOpenChange={onOpenChange}>
+      <AlertDialogContent>
+        <AlertDialogHeader>
+          <AlertDialogTitle>{title}</AlertDialogTitle>
+          <AlertDialogDescription>{description}</AlertDialogDescription>
+        </AlertDialogHeader>
+        <AlertDialogFooter>
+          <AlertDialogCancel>{cancelText}</AlertDialogCancel>
+          <AlertDialogAction
+            onClick={handleConfirm}
+            className={variant === 'destructive' ? 'bg-red-600 hover:bg-red-700' : ''}
+          >
+            {confirmText}
+          </AlertDialogAction>
+        </AlertDialogFooter>
+      </AlertDialogContent>
+    </AlertDialog>
+  );
+}
+
diff --git a/components/wiki/EditableBlock.tsx b/components/wiki/EditableBlock.tsx
new file mode 100644
index 00000000..62f88748
--- /dev/null
+++ b/components/wiki/EditableBlock.tsx
@@ -0,0 +1,87 @@
+'use client';
+
+import { useState } from 'react';
+import { Button } from '@/components/ui/button';
+import { Textarea } from '@/components/ui/textarea';
+import { Edit, Save, X } from 'lucide-react';
+import { cn } from '@/lib/utils';
+
+interface EditableBlockProps {
+  content: string;
+  onSave: (content: string) => void;
+  className?: string;
+  placeholder?: string;
+  renderContent?: (content: string) => React.ReactNode;
+}
+
+export default function EditableBlock({
+  content,
+  onSave,
+  className,
+  placeholder = '–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...',
+  renderContent
+}: EditableBlockProps) {
+  const [isEditing, setIsEditing] = useState(false);
+  const [editedContent, setEditedContent] = useState(content);
+
+  const handleSave = () => {
+    onSave(editedContent);
+    setIsEditing(false);
+  };
+
+  const handleCancel = () => {
+    setEditedContent(content);
+    setIsEditing(false);
+  };
+
+  if (isEditing) {
+    return (
+      <div className={cn('relative group border-2 border-blue-300 rounded-lg p-4', className)}>
+        <div className="flex justify-end gap-2 mb-2">
+          <Button
+            variant="outline"
+            size="sm"
+            onClick={handleCancel}
+          >
+            <X className="w-4 h-4 mr-2" />
+            –û—Ç–º–µ–Ω–∞
+          </Button>
+          <Button
+            size="sm"
+            onClick={handleSave}
+          >
+            <Save className="w-4 h-4 mr-2" />
+            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
+          </Button>
+        </div>
+        <Textarea
+          value={editedContent}
+          onChange={(e) => setEditedContent(e.target.value)}
+          placeholder={placeholder}
+          className="min-h-[100px]"
+          autoFocus
+        />
+      </div>
+    );
+  }
+
+  return (
+    <div className={cn('relative group', className)}>
+      <Button
+        variant="ghost"
+        size="sm"
+        className="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity z-10"
+        onClick={() => setIsEditing(true)}
+        title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–ª–æ–∫"
+      >
+        <Edit className="w-4 h-4" />
+      </Button>
+      <div className="prose max-w-none">
+        {renderContent ? renderContent(content) : (
+          <div className="whitespace-pre-wrap">{content}</div>
+        )}
+      </div>
+    </div>
+  );
+}
+
diff --git a/components/wiki/LinkEditor.tsx b/components/wiki/LinkEditor.tsx
new file mode 100644
index 00000000..fc26f8a0
--- /dev/null
+++ b/components/wiki/LinkEditor.tsx
@@ -0,0 +1,150 @@
+'use client';
+
+import { useState } from 'react';
+import { Button } from '@/components/ui/button';
+import { Input } from '@/components/ui/input';
+import { Label } from '@/components/ui/label';
+import {
+  Dialog,
+  DialogContent,
+  DialogHeader,
+  DialogTitle,
+  DialogTrigger,
+} from '@/components/ui/dialog';
+import { Link as LinkIcon, ExternalLink, FileText } from 'lucide-react';
+
+interface LinkEditorProps {
+  onInsert: (text: string, url: string, isInternal: boolean) => void;
+  pages?: Array<{ id: string; title: string; slug: string }>;
+}
+
+export default function LinkEditor({ onInsert, pages = [] }: LinkEditorProps) {
+  const [open, setOpen] = useState(false);
+  const [linkText, setLinkText] = useState('');
+  const [linkUrl, setLinkUrl] = useState('');
+  const [isInternal, setIsInternal] = useState(false);
+  const [selectedPageId, setSelectedPageId] = useState<string>('');
+
+  const handleInsert = () => {
+    if (!linkText.trim()) {
+      return;
+    }
+
+    let url = linkUrl;
+    if (isInternal && selectedPageId) {
+      const selectedPage = pages.find(p => p.id === selectedPageId);
+      if (selectedPage) {
+        url = `/wiki?slug=${selectedPage.slug}`;
+      }
+    }
+
+    if (!url.trim()) {
+      return;
+    }
+
+    const markdownLink = isInternal 
+      ? `[${linkText}](${url})`
+      : `[${linkText}](${url})`;
+    
+    onInsert(linkText, url, isInternal);
+    setOpen(false);
+    setLinkText('');
+    setLinkUrl('');
+    setSelectedPageId('');
+    setIsInternal(false);
+  };
+
+  return (
+    <Dialog open={open} onOpenChange={setOpen}>
+      <DialogTrigger asChild>
+        <Button variant="outline" size="sm" type="button">
+          <LinkIcon className="w-4 h-4 mr-2" />
+          –°—Å—ã–ª–∫–∞
+        </Button>
+      </DialogTrigger>
+      <DialogContent>
+        <DialogHeader>
+          <DialogTitle>–î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É</DialogTitle>
+        </DialogHeader>
+        <div className="space-y-4 mt-4">
+          <div>
+            <Label htmlFor="link-text">–¢–µ–∫—Å—Ç —Å—Å—ã–ª–∫–∏</Label>
+            <Input
+              id="link-text"
+              value={linkText}
+              onChange={(e) => setLinkText(e.target.value)}
+              placeholder="–¢–µ–∫—Å—Ç —Å—Å—ã–ª–∫–∏"
+            />
+          </div>
+          <div>
+            <Label>–¢–∏–ø —Å—Å—ã–ª–∫–∏</Label>
+            <div className="flex gap-4 mt-2">
+              <Button
+                type="button"
+                variant={isInternal ? "default" : "outline"}
+                size="sm"
+                onClick={() => {
+                  setIsInternal(true);
+                  setLinkUrl('');
+                }}
+              >
+                <FileText className="w-4 h-4 mr-2" />
+                –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è
+              </Button>
+              <Button
+                type="button"
+                variant={!isInternal ? "default" : "outline"}
+                size="sm"
+                onClick={() => {
+                  setIsInternal(false);
+                  setSelectedPageId('');
+                }}
+              >
+                <ExternalLink className="w-4 h-4 mr-2" />
+                –í–Ω–µ—à–Ω—è—è
+              </Button>
+            </div>
+          </div>
+          {isInternal ? (
+            <div>
+              <Label htmlFor="internal-page">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É</Label>
+              <select
+                id="internal-page"
+                value={selectedPageId}
+                onChange={(e) => setSelectedPageId(e.target.value)}
+                className="w-full mt-1 px-3 py-2 border border-gray-300 rounded-md"
+              >
+                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É...</option>
+                {pages.map((page) => (
+                  <option key={page.id} value={page.id}>
+                    {page.title}
+                  </option>
+                ))}
+              </select>
+            </div>
+          ) : (
+            <div>
+              <Label htmlFor="link-url">URL</Label>
+              <Input
+                id="link-url"
+                value={linkUrl}
+                onChange={(e) => setLinkUrl(e.target.value)}
+                placeholder="https://example.com"
+                type="url"
+              />
+            </div>
+          )}
+          <div className="flex justify-end gap-2">
+            <Button variant="outline" onClick={() => setOpen(false)}>
+              –û—Ç–º–µ–Ω–∞
+            </Button>
+            <Button onClick={handleInsert} disabled={!linkText.trim() || (isInternal ? !selectedPageId : !linkUrl.trim())}>
+              –í—Å—Ç–∞–≤–∏—Ç—å
+            </Button>
+          </div>
+        </div>
+      </DialogContent>
+    </Dialog>
+  );
+}
+
diff --git a/components/wiki/PageManager.tsx b/components/wiki/PageManager.tsx
index a301e79d..d9a3e315 100644
--- a/components/wiki/PageManager.tsx
+++ b/components/wiki/PageManager.tsx
@@ -5,7 +5,9 @@ import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
 import { Button } from '@/components/ui/button';
 import { Input } from '@/components/ui/input';
 import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';
-import { Plus, Trash2, Edit, FileText, ChevronRight } from 'lucide-react';
+import { Plus, Trash2, Edit, FileText, ChevronRight, ChevronDown, FolderPlus } from 'lucide-react';
+import { toast } from 'sonner';
+import ConfirmDialog from './ConfirmDialog';
 
 interface WikiPage {
   id: string;
@@ -38,6 +40,13 @@ export default function PageManager({
   const [showCreateDialog, setShowCreateDialog] = useState(false);
   const [newPageTitle, setNewPageTitle] = useState('');
   const [newPageSlug, setNewPageSlug] = useState('');
+  const [newPageParentId, setNewPageParentId] = useState<string | null>(null);
+  const [expandedPages, setExpandedPages] = useState<Set<string>>(new Set());
+  const [deleteDialog, setDeleteDialog] = useState<{ open: boolean; pageId: string | null; title: string }>({
+    open: false,
+    pageId: null,
+    title: '',
+  });
 
   useEffect(() => {
     loadPages();
@@ -64,13 +73,13 @@ export default function PageManager({
 
   const handleCreatePage = async () => {
     if (!newPageTitle.trim() || !newPageSlug.trim()) {
-      alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ slug');
+      toast.error('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ slug');
       return;
     }
 
     // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ slug (—Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω–∏—Ü–∞, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å—ã)
     if (!/^[a-z0-9-]+$/.test(newPageSlug)) {
-      alert('Slug –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –¥–µ—Ñ–∏—Å—ã');
+      toast.error('Slug –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –¥–µ—Ñ–∏—Å—ã');
       return;
     }
 
@@ -81,7 +90,9 @@ export default function PageManager({
         body: JSON.stringify({
           title: newPageTitle.trim(),
           slug: newPageSlug.trim(),
-          content: `# ${newPageTitle.trim()}\n\n–ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞. –ù–∞—á–Ω–∏—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.`
+          content: `# ${newPageTitle.trim()}\n\n–ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞. –ù–∞—á–Ω–∏—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.`,
+          parentId: newPageParentId || null,
+          order: 0
         })
       });
 
@@ -91,22 +102,27 @@ export default function PageManager({
       }
 
       const newPage = await response.json();
-      setPages([...pages, newPage]);
+      await loadPages(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞
       setNewPageTitle('');
       setNewPageSlug('');
+      setNewPageParentId(null);
       setShowCreateDialog(false);
       onPageCreate(newPage);
       onPageSelect(newPage);
+      toast.success('–°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞');
     } catch (error) {
       console.error('Error creating page:', error);
-      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: ' + (error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
+      toast.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: ' + (error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
     }
   };
 
-  const handleDeletePage = async (pageId: string, title: string) => {
-    if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É "${title}"?`)) {
-      return;
-    }
+  const handleDeletePageClick = (pageId: string, title: string) => {
+    setDeleteDialog({ open: true, pageId, title });
+  };
+
+  const handleDeletePage = async () => {
+    const { pageId, title } = deleteDialog;
+    if (!pageId) return;
 
     try {
       const response = await fetch(`/api/wiki/pages?id=${pageId}`, {
@@ -117,48 +133,111 @@ export default function PageManager({
 
       setPages(pages.filter(p => p.id !== pageId));
       onPageDelete(pageId);
+      toast.success(`–°—Ç—Ä–∞–Ω–∏—Ü–∞ "${title}" —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞`);
     } catch (error) {
       console.error('Error deleting page:', error);
-      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã');
+      toast.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã');
+    } finally {
+      setDeleteDialog({ open: false, pageId: null, title: '' });
     }
   };
 
+  const toggleExpand = (pageId: string) => {
+    setExpandedPages(prev => {
+      const newSet = new Set(prev);
+      if (newSet.has(pageId)) {
+        newSet.delete(pageId);
+      } else {
+        newSet.add(pageId);
+      }
+      return newSet;
+    });
+  };
+
+  const handleCreateChildPage = (parentId: string, parentTitle: string) => {
+    setNewPageParentId(parentId);
+    setNewPageTitle(`${parentTitle} - `);
+    setShowCreateDialog(true);
+  };
+
   const renderPageTree = (pageList: WikiPage[], parentId: string | null = null, level: number = 0): JSX.Element[] => {
-    return pageList
+    const children = pageList
       .filter(page => page.parentId === parentId)
-      .sort((a, b) => a.order - b.order)
-      .map(page => (
+      .sort((a, b) => a.order - b.order);
+
+    return children.map(page => {
+      const hasChildren = page.children && page.children.length > 0;
+      const isExpanded = expandedPages.has(page.id);
+      const childrenToRender = hasChildren && isExpanded;
+
+      return (
         <div key={page.id}>
           <div
             className={`flex items-center gap-2 p-2 rounded cursor-pointer hover:bg-gray-100 transition-colors ${
               selectedPageId === page.id ? 'bg-blue-100 border border-blue-300' : ''
             }`}
             style={{ paddingLeft: `${level * 20 + 8}px` }}
-            onClick={() => onPageSelect(page)}
           >
-            {page.children && page.children.length > 0 && (
-              <ChevronRight className="w-4 h-4 text-gray-400" />
+            {hasChildren ? (
+              <button
+                onClick={(e) => {
+                  e.stopPropagation();
+                  toggleExpand(page.id);
+                }}
+                className="p-0.5 hover:bg-gray-200 rounded"
+              >
+                {isExpanded ? (
+                  <ChevronDown className="w-4 h-4 text-gray-400" />
+                ) : (
+                  <ChevronRight className="w-4 h-4 text-gray-400" />
+                )}
+              </button>
+            ) : (
+              <div className="w-5" /> // Placeholder –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è
             )}
-            <FileText className="w-4 h-4 text-gray-500" />
-            <span className="flex-1 font-medium">{page.title}</span>
-            <Button
-              size="sm"
-              variant="ghost"
-              onClick={(e) => {
-                e.stopPropagation();
-                handleDeletePage(page.id, page.title);
-              }}
+            <FileText 
+              className="w-4 h-4 text-gray-500 flex-shrink-0" 
+              onClick={() => onPageSelect(page)}
+            />
+            <span 
+              className="flex-1 font-medium"
+              onClick={() => onPageSelect(page)}
             >
-              <Trash2 className="w-4 h-4 text-red-500" />
-            </Button>
+              {page.title}
+            </span>
+            <div className="flex gap-1">
+              <Button
+                size="sm"
+                variant="ghost"
+                onClick={(e) => {
+                  e.stopPropagation();
+                  handleCreateChildPage(page.id, page.title);
+                }}
+                title="–°–æ–∑–¥–∞—Ç—å –¥–æ—á–µ—Ä–Ω—é—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"
+              >
+                <FolderPlus className="w-4 h-4 text-blue-500" />
+              </Button>
+              <Button
+                size="sm"
+                variant="ghost"
+                onClick={(e) => {
+                  e.stopPropagation();
+                  handleDeletePageClick(page.id, page.title);
+                }}
+                title="–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É"
+              >
+                <Trash2 className="w-4 h-4 text-red-500" />
+              </Button>
+            </div>
           </div>
-          {page.children && page.children.length > 0 && (
+          {childrenToRender && (
             <div className="ml-4">
               {renderPageTree(pageList, page.id, level + 1)}
             </div>
           )}
         </div>
-      ));
+      );
+    });
   };
 
   if (loading) {
@@ -201,6 +280,11 @@ export default function PageManager({
                     –¢–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –¥–µ—Ñ–∏—Å—ã
                   </p>
                 </div>
+                {newPageParentId && (
+                  <div className="p-2 bg-blue-50 rounded text-sm text-blue-700">
+                    –°–æ–∑–¥–∞–µ—Ç—Å—è –∫–∞–∫ –¥–æ—á–µ—Ä–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
+                  </div>
+                )}
                 <div className="flex justify-end gap-2">
                   <Button variant="outline" onClick={() => setShowCreateDialog(false)}>
                     –û—Ç–º–µ–Ω–∞
@@ -225,6 +309,16 @@ export default function PageManager({
           </div>
         )}
       </CardContent>
+      <ConfirmDialog
+        open={deleteDialog.open}
+        onOpenChange={(open) => setDeleteDialog({ ...deleteDialog, open })}
+        title="–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã"
+        description={`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É "${deleteDialog.title}"? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`}
+        confirmText="–£–¥–∞–ª–∏—Ç—å"
+        cancelText="–û—Ç–º–µ–Ω–∞"
+        onConfirm={handleDeletePage}
+        variant="destructive"
+      />
     </Card>
   );
 }
diff --git a/components/wiki/VersionHistory.tsx b/components/wiki/VersionHistory.tsx
index 726fdd74..ffb904f0 100644
--- a/components/wiki/VersionHistory.tsx
+++ b/components/wiki/VersionHistory.tsx
@@ -5,6 +5,8 @@ import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
 import { Button } from '@/components/ui/button';
 import { History, RotateCcw, Calendar, User } from 'lucide-react';
 import { format } from 'date-fns';
+import { toast } from 'sonner';
+import ConfirmDialog from './ConfirmDialog';
 
 interface WikiVersion {
   id: string;
@@ -25,6 +27,10 @@ export default function VersionHistory({ pageId, onRestore }: VersionHistoryProp
   const [versions, setVersions] = useState<WikiVersion[]>([]);
   const [loading, setLoading] = useState(true);
   const [restoring, setRestoring] = useState<number | null>(null);
+  const [confirmDialog, setConfirmDialog] = useState<{ open: boolean; version: number | null }>({
+    open: false,
+    version: null,
+  });
 
   useEffect(() => {
     loadVersions();
@@ -39,16 +45,19 @@ export default function VersionHistory({ pageId, onRestore }: VersionHistoryProp
       setVersions(data);
     } catch (error) {
       console.error('Error loading versions:', error);
-      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤–µ—Ä—Å–∏–π');
+      toast.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤–µ—Ä—Å–∏–π');
     } finally {
       setLoading(false);
     }
   };
 
-  const handleRestore = async (version: number) => {
-    if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫–∞—Ç–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫ –≤–µ—Ä—Å–∏–∏ ${version}?`)) {
-      return;
-    }
+  const handleRestoreClick = (version: number) => {
+    setConfirmDialog({ open: true, version });
+  };
+
+  const handleRestore = async () => {
+    const version = confirmDialog.version;
+    if (!version) return;
 
     try {
       setRestoring(version);
@@ -68,12 +77,13 @@ export default function VersionHistory({ pageId, onRestore }: VersionHistoryProp
       if (onRestore) {
         await onRestore(version);
       }
-      alert('–°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫–∞—á–µ–Ω–∞ –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏');
+      toast.success('–°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫–∞—á–µ–Ω–∞ –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏');
     } catch (error) {
       console.error('Error restoring version:', error);
-      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–∞—Ç–µ –≤–µ—Ä—Å–∏–∏');
+      toast.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–∞—Ç–µ –≤–µ—Ä—Å–∏–∏');
     } finally {
       setRestoring(null);
+      setConfirmDialog({ open: false, version: null });
     }
   };
 
@@ -112,7 +122,7 @@ export default function VersionHistory({ pageId, onRestore }: VersionHistoryProp
                 <Button
                   size="sm"
                   variant="outline"
-                  onClick={() => handleRestore(version.version)}
+                  onClick={() => handleRestoreClick(version.version)}
                   disabled={restoring === version.version || version.version === versions[0].version}
                 >
                   {restoring === version.version ? (
@@ -155,6 +165,15 @@ export default function VersionHistory({ pageId, onRestore }: VersionHistoryProp
           ))}
         </div>
       </CardContent>
+      <ConfirmDialog
+        open={confirmDialog.open}
+        onOpenChange={(open) => setConfirmDialog({ open, version: confirmDialog.version })}
+        title="–û—Ç–∫–∞—Ç –∫ –≤–µ—Ä—Å–∏–∏"
+        description={`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫–∞—Ç–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫ –≤–µ—Ä—Å–∏–∏ ${confirmDialog.version}? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ —Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏.`}
+        confirmText="–û—Ç–∫–∞—Ç–∏—Ç—å"
+        cancelText="–û—Ç–º–µ–Ω–∞"
+        onConfirm={handleRestore}
+      />
     </Card>
   );
 }
diff --git a/components/wiki/WikiContentEditor.tsx b/components/wiki/WikiContentEditor.tsx
index 3941a75e..d8a6a1c6 100644
--- a/components/wiki/WikiContentEditor.tsx
+++ b/components/wiki/WikiContentEditor.tsx
@@ -6,6 +6,7 @@ import { Card, CardContent } from '@/components/ui/card';
 import { Plus, Save, Eye, Edit as EditIcon, Loader2 } from 'lucide-react';
 import { WikiSection, WikiStructuredContent, generateId } from './types';
 import EditableSection from './EditableSection';
+import { toast } from 'sonner';
 
 interface WikiContentEditorProps {
   pageId: string;
@@ -91,10 +92,11 @@ const WikiContentEditor = forwardRef<WikiContentEditorRef, WikiContentEditorProp
 
   const handleDeleteSection = (sectionId: string) => {
     if (sections.length === 1) {
-      alert('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑–¥–µ–ª. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º.');
+      toast.error('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑–¥–µ–ª. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º.');
       return;
     }
     setSections(sections.filter((s) => s.id !== sectionId));
+    toast.success('–†–∞–∑–¥–µ–ª —É–¥–∞–ª–µ–Ω');
   };
 
   const handleSave = async () => {
@@ -113,9 +115,10 @@ const WikiContentEditor = forwardRef<WikiContentEditorRef, WikiContentEditorProp
       if (onSaveComplete) {
         onSaveComplete();
       }
+      toast.success('–ö–æ–Ω—Ç–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
     } catch (error) {
       console.error('Error saving content:', error);
-      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + (error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
+      toast.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + (error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
     } finally {
       setIsLoading(false);
     }
diff --git a/components/wiki/WikiEditor.tsx b/components/wiki/WikiEditor.tsx
index bbcca783..a6619127 100644
--- a/components/wiki/WikiEditor.tsx
+++ b/components/wiki/WikiEditor.tsx
@@ -8,6 +8,8 @@ import { Label } from '@/components/ui/label';
 import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
 import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
 import { Upload, X, Save, Eye, Edit, Link as LinkIcon, Image as ImageIcon, Type } from 'lucide-react';
+import { toast } from 'sonner';
+import LinkEditor from './LinkEditor';
 // –ü—Ä–æ—Å—Ç–æ–π markdown —Ä–µ–Ω–¥–µ—Ä–µ—Ä –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
 const MarkdownPreview = ({ content }: { content: string }) => {
   // –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ markdown
@@ -114,13 +116,20 @@ const MarkdownPreview = ({ content }: { content: string }) => {
       if (match.index > lastIndex) {
         parts.push(text.substring(lastIndex, match.index));
       }
+      const url = match[2];
+      const isInternal = url.startsWith('/wiki') || url.startsWith('wiki');
       parts.push(
         <a
           key={`link-${key++}`}
-          href={match[2]}
-          target="_blank"
-          rel="noopener noreferrer"
+          href={url}
+          target={isInternal ? undefined : '_blank'}
+          rel={isInternal ? undefined : 'noopener noreferrer'}
           className="text-blue-600 hover:underline"
+          onClick={isInternal ? (e) => {
+            e.preventDefault();
+            const slug = url.includes('slug=') ? url.split('slug=')[1] : url.replace('/wiki?', '').replace('wiki/', '');
+            window.location.href = `/wiki?slug=${slug}`;
+          } : undefined}
         >
           {match[1]}
         </a>
@@ -228,6 +237,7 @@ interface WikiEditorProps {
   onSave: (title: string, content: string, changeNote?: string) => Promise<void>;
   onCancel?: () => void;
   isNewPage?: boolean;
+  pages?: Array<{ id: string; title: string; slug: string }>;
 }
 
 export default function WikiEditor({
@@ -236,7 +246,8 @@ export default function WikiEditor({
   initialContent = '',
   onSave,
   onCancel,
-  isNewPage = false
+  isNewPage = false,
+  pages = []
 }: WikiEditorProps) {
   const [title, setTitle] = useState(initialTitle);
   const [content, setContent] = useState(initialContent);
@@ -276,12 +287,12 @@ export default function WikiEditor({
   // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   const handleImageUpload = async (file: File) => {
     if (!file.type.startsWith('image/')) {
-      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
+      toast.error('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
       return;
     }
 
     if (file.size > 10 * 1024 * 1024) {
-      alert('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 10MB');
+      toast.error('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 10MB');
       return;
     }
 
@@ -302,9 +313,10 @@ export default function WikiEditor({
       const data = await response.json();
       const imageMarkdown = `![${file.name}](${data.url})`;
       insertText(imageMarkdown);
+      toast.success('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ');
     } catch (error) {
       console.error('Error uploading image:', error);
-      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ' + (error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
+      toast.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ' + (error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
     }
   };
 
@@ -349,12 +361,12 @@ export default function WikiEditor({
   // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
   const handleSave = async () => {
     if (!title.trim()) {
-      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫');
+      toast.error('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫');
       return;
     }
 
     if (!content.trim()) {
-      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ');
+      toast.error('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ');
       return;
     }
 
@@ -362,9 +374,10 @@ export default function WikiEditor({
     try {
       await onSave(title.trim(), content.trim(), changeNote.trim() || undefined);
       setChangeNote('');
+      toast.success('–°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞');
     } catch (error) {
       console.error('Error saving:', error);
-      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + (error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
+      toast.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + (error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
     } finally {
       setIsSaving(false);
     }
@@ -445,15 +458,13 @@ export default function WikiEditor({
                   >
                     <Type className="w-4 h-4 mr-1" />H3
                   </Button>
-                  <Button
-                    type="button"
-                    variant="outline"
-                    size="sm"
-                    onClick={() => insertText('[', '](url)')}
-                    title="–°—Å—ã–ª–∫–∞"
-                  >
-                    <LinkIcon className="w-4 h-4 mr-1" />–°—Å—ã–ª–∫–∞
-                  </Button>
+                  <LinkEditor
+                    onInsert={(text, url, isInternal) => {
+                      const markdownLink = `[${text}](${url})`;
+                      insertText(markdownLink);
+                    }}
+                    pages={pages}
+                  />
                   <Button
                     type="button"
                     variant="outline"
-- 
2.51.2.windows.1

