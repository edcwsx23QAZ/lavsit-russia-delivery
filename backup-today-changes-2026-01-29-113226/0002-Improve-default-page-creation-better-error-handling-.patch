From 8a604e994fb9d47d35a629a1aef19b6f783cb3b9 Mon Sep 17 00:00:00 2001
From: edcwsx23QAZ <edcwsx23QAZ@users.noreply.github.com>
Date: Tue, 27 Jan 2026 17:58:40 +0300
Subject: [PATCH 02/12] Improve default page creation: better error handling
 and URL update

---
 app/wiki/page.tsx | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/app/wiki/page.tsx b/app/wiki/page.tsx
index c78bb776..79ebbd4e 100644
--- a/app/wiki/page.tsx
+++ b/app/wiki/page.tsx
@@ -95,6 +95,7 @@ export default function WikiPage() {
 
   const createDefaultPage = async () => {
     try {
+      setLoading(true);
       const response = await fetch('/api/wiki/pages', {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
@@ -132,9 +133,16 @@ export default function WikiPage() {
       if (response.ok) {
         const page = await response.json();
         setSelectedPage(page);
+        // Обновить URL
+        window.history.pushState({}, '', `/wiki?slug=${page.slug}`);
+      } else {
+        const error = await response.json().catch(() => ({}));
+        console.error('Error creating default page:', error);
       }
     } catch (error) {
       console.error('Error creating default page:', error);
+    } finally {
+      setLoading(false);
     }
   };
 
-- 
2.51.2.windows.1

