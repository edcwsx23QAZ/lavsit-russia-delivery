From 10a5b7830cdb5ff66d4f754f5ebee814e36d7e75 Mon Sep 17 00:00:00 2001
From: edcwsx23QAZ <edcwsx23QAZ@users.noreply.github.com>
Date: Tue, 27 Jan 2026 18:04:31 +0300
Subject: [PATCH 05/12] Add fallback content: display original wiki content
 even when database is unavailable

---
 app/wiki/page.tsx | 309 +++++++++++++++++++++++++++++++++++++++++++++-
 1 file changed, 308 insertions(+), 1 deletion(-)

diff --git a/app/wiki/page.tsx b/app/wiki/page.tsx
index 8bdf07b2..18951e9a 100644
--- a/app/wiki/page.tsx
+++ b/app/wiki/page.tsx
@@ -23,6 +23,303 @@ interface WikiPage {
   updatedAt: string;
 }
 
+// Статический контент для отображения, если база данных недоступна
+const FALLBACK_CONTENT = {
+  id: 'fallback',
+  slug: 'introduction',
+  title: 'Инструкция для менеджера по логистике',
+  content: JSON.stringify({
+    sections: [
+      {
+        id: 'intro',
+        title: '1. Введение',
+        content: `### Цель и важность работы
+
+Менеджер по логистике — ключевое звено в цепочке доставки премиум-мебели. Ваша работа напрямую влияет на удовлетворенность клиентов и репутацию компании.
+
+В компании действует **клиентократия по Вкуссвиллу** и **AJTBD подход**(Always Just The Best Delivery). Это означает, что клиент всегда прав, и мы стремимся предоставить лучший сервис доставки в отрасли.
+
+### Ценность для клиента
+
+* ✅ **Безопасность и сохранность** — гарантия целостности премиум-мебели при транспортировке
+* ✅ **Прозрачность** — полная информация о статусе доставки в реальном времени
+* ✅ **Удобство** — гибкое планирование доставки с учетом пожеланий клиента
+* ✅ **Профессионализм** — компетентное решение любых вопросов и проблем
+* ✅ **Эксклюзивность** — индивидуальный подход к каждому клиенту
+* ✅ **Скорость реакции** — оперативное решение вопросов и рекламаций
+
+### Общие принципы работы
+
+* Клиент всегда в приоритете
+* Проактивная коммуникация вместо реактивной
+* Документирование всех операций
+* Работа в команде и взаимопомощь
+* Постоянное улучшение процессов`
+      },
+      {
+        id: 'schedule',
+        title: '2. Расписание и рабочий день',
+        content: `### Типичное ежедневное расписание
+
+09:00 - 09:30 | Проверка новых заявок и отгрузок на день
+
+09:30 - 10:30 | Согласование отгрузок с производителями
+
+10:30 - 11:30 | Согласование со складом
+
+11:30 - 13:00 | Согласование с экспедиторами/сборщиками
+
+13:00 - 14:00 | Обед
+
+14:00 - 15:30 | Согласование с клиентами, работа с оплатами
+
+15:30 - 17:00 | Оформление заказов через ТК и прямые машины
+
+17:00 - 18:00 | Ведение учета, отчетность, обработка рекламаций
+
+### Критические временные точки
+
+* **09:00** — обязательная проверка всех заявок на день
+* **12:00** — все отгрузки должны быть согласованы
+* **16:00** — все заказы должны быть оформлены
+* **18:00** — отчеты должны быть готовы`
+      },
+      {
+        id: 'tools',
+        title: '3. Инструменты и системы',
+        content: `### CRM и системы учета
+
+#### CRM система
+**Ссылка:** crm.company.ru
+**Логин:** [ваш логин]
+**Пароль:** [хранится в менеджере паролей]
+
+#### Таск-менеджер
+**Ссылка:** tasks.company.ru
+**Логин:** [ваш логин]
+
+#### Система учета платежей
+**Ссылка:** payments.company.ru
+**Логин:** [ваш логин]
+
+### Транспортные платформы
+
+#### ТК Деловые Линии
+**Ссылка:** www.dellin.ru
+**Логин:** [логин компании]
+
+#### ТК ПЭК
+**Ссылка:** www.pecom.ru
+**Логин:** [логин компании]
+
+#### ТК СДЭК
+**Ссылка:** www.cdek.ru
+**Логин:** [логин компании]
+
+#### Прямые машины
+**Контакты:** [телефон диспетчера]
+**Чат:** [ссылка на чат]
+
+### Чаты и коммуникации
+
+* **Общий чат отдела:** [ссылка на Telegram/WhatsApp]
+* **Чат с производителями:** [ссылка]
+* **Чат со складом:** [ссылка]
+* **Чат с экспедиторами:** [ссылка]
+* **Чат с клиентами (премиум):** [ссылка]`
+      },
+      {
+        id: 'processes',
+        title: '4. Процессы и регламенты',
+        content: `### 4.1 Согласование отгрузок
+
+#### С производителями
+1. Проверить готовность заказа в CRM
+2. Связаться с производителем в установленное время (09:30-10:30)
+3. Уточнить сроки готовности и возможность отгрузки
+4. Согласовать дату и время отгрузки
+5. Зафиксировать в системе
+
+#### Со складом
+1. Проверить наличие товара на складе
+2. Согласовать время приёмки
+3. Уточнить условия хранения
+4. Зафиксировать в системе
+
+#### С экспедиторами/сборщиками
+1. Согласовать маршрут и время
+2. Уточнить необходимость сборки
+3. Предоставить контакты клиента
+4. Согласовать условия доставки
+
+#### С клиентами
+1. Связаться с клиентом заранее (минимум за 2 дня)
+2. Предложить удобное время доставки
+3. Уточнить адрес и условия доступа
+4. Предупредить о необходимости присутствия
+5. Подтвердить детали в письменном виде
+
+### 4.2 Работа с оплатами
+
+#### Доплаты клиентов
+1. Рассчитать сумму доплаты
+2. Связаться с клиентом и объяснить причину
+3. Отправить реквизиты для оплаты
+4. Подтвердить получение платежа
+5. Зафиксировать в системе учета
+
+#### Оплата за платное хранение
+1. Рассчитать стоимость хранения (по тарифам)
+2. Уведомить клиента о необходимости оплаты
+3. Принять оплату
+4. Зафиксировать в системе учета платежей
+
+#### Расчеты по доставке в другие города
+1. Рассчитать ставку по доставке
+2. Согласовать с клиентом или менеджером
+3. Зафиксировать расчет
+4. После доставки сравнить с реальными тратами
+5. Внести корректировки в учет
+
+### 4.3 Оформление заказов
+
+#### Через ТК
+1. Выбрать транспортную компанию
+2. Рассчитать стоимость доставки
+3. Оформить заказ на сайте ТК
+4. Получить трек-номер
+5. Передать трек-номер клиенту
+6. Отслеживать статус доставки
+
+#### Прямыми машинами
+1. Связаться с диспетчером
+2. Согласовать маршрут и стоимость
+3. Забронировать машину
+4. Передать информацию экспедитору
+5. Контролировать выполнение
+
+### 4.4 Обработка рекламаций
+1. Принять рекламацию от клиента
+2. Зафиксировать детали проблемы
+3. Согласовать выезд для исправления
+4. Организовать доставку/ремонт
+5. Проконтролировать выполнение
+6. Получить подтверждение от клиента
+7. Зафиксировать в системе
+
+### 4.5 Учёт и отчётность
+* **Учет доставок:** Все доставки фиксируются в CRM с указанием статуса, даты, стоимости
+* **Учет платежей:** Все платежи по хранению фиксируются в системе учета платежей
+* **Учет расчетов:** Все расчеты по доставкам в города и реальные траты фиксируются в таблице учета
+* **Ежедневный отчет:** Формируется до 18:00 и отправляется руководителю`
+      },
+      {
+        id: 'regulations',
+        title: '5. Регламенты и стандарты',
+        content: `### Время реакции
+
+* **На сообщения клиентов:** в течение 15 минут в рабочее время
+* **На заявки на отгрузку:** в течение 1 часа
+* **На рекламации:** немедленно, в течение 30 минут
+* **На запросы коллег:** в течение 2 часов
+
+### Качество коммуникации
+
+* Всегда вежливый и профессиональный тон
+* Полные и точные ответы на вопросы
+* Проактивное информирование о статусах
+* Использование проверенной информации
+* Документирование важных договоренностей
+
+### Документальное оформление
+
+* Все согласования фиксируются в CRM
+* Важные договоренности подтверждаются письменно
+* Отчеты формируются по установленному шаблону
+* Все платежи документируются`
+      },
+      {
+        id: 'contacts',
+        title: '6. Контакты и коммуникации',
+        content: `### Внутренние контакты
+
+#### Руководитель отдела логистики
+Телефон: [номер]
+Email: [email]
+Telegram: [username]
+
+#### Менеджеры по производству
+Телефон: [номер]
+Чат: [ссылка]
+
+#### Склад
+Телефон: [номер]
+Чат: [ссылка]
+
+#### Экспедиторы
+Диспетчер: [номер]
+Чат: [ссылка]
+
+### Поставщики и грузоперевозчики
+
+#### ТК Деловые Линии
+Телефон: 8-800-100-45-45
+Email: info@dellin.ru
+
+#### ТК ПЭК
+Телефон: 8-800-700-33-55
+Email: info@pecom.ru
+
+#### Прямые машины
+Диспетчер: [номер]
+Чат: [ссылка]`
+      },
+      {
+        id: 'clients',
+        title: '7. Работа с клиентами',
+        content: `### Принципы общения с клиентами
+
+1. **Клиент всегда прав** - Даже если клиент ошибается, наша задача — найти решение, которое его удовлетворит. Мы работаем в формате клиентократии.
+
+2. **Проактивная коммуникация** - Не ждите вопросов клиента — информируйте его заранее о статусе заказа, возможных задержках, изменениях.
+
+3. **Эмпатия и понимание** - Поставьте себя на место клиента. Премиум-мебель — это важная покупка, и клиент переживает за результат.
+
+4. **Прозрачность и честность** - Всегда говорите правду, даже если она неприятна. Лучше честно сообщить о задержке, чем обещать невозможное.
+
+5. **Быстрая реакция** - Отвечайте на сообщения клиентов в течение 15 минут. Это показывает, что они важны для вас.
+
+6. **Персонализация** - Обращайтесь к клиенту по имени, помните детали предыдущих разговоров, показывайте индивидуальный подход.
+
+7. **Решение проблем, а не объяснение причин** - Клиенту не важно, почему произошла проблема. Ему важно, как быстро вы её решите.
+
+8. **Предложение альтернатив** - Если что-то невозможно, предложите альтернативное решение. Не просто говорите "нет".
+
+9. **Благодарность и признательность** - Благодарите клиента за терпение, за выбор нашей компании. Показывайте, что цените его.
+
+10. **Следование обещаниям** - Если вы что-то пообещали — обязательно выполните. Если не можете — немедленно сообщите и предложите компенсацию.`
+      },
+      {
+        id: 'scripts',
+        title: '8. Скрипты для работы с клиентами',
+        content: `### Редактируемая база скриптов
+
+#### Приветствие клиента
+**Категория:** Общение
+**Текст:** Добрый день! Меня зовут [Имя], я ваш менеджер по логистике. Готов помочь с организацией доставки вашего заказа.
+
+#### Уточнение адреса доставки
+**Категория:** Оформление
+**Текст:** Для оформления доставки мне необходимо уточнить точный адрес и удобное время. Когда вам будет удобно принять заказ?`
+      }
+    ]
+  }),
+  order: 0,
+  parentId: null,
+  createdAt: new Date().toISOString(),
+  updatedAt: new Date().toISOString()
+};
+
 export default function WikiPage() {
   const [selectedPage, setSelectedPage] = useState<WikiPage | null>(null);
   const [isEditing, setIsEditing] = useState(false);
@@ -31,6 +328,7 @@ export default function WikiPage() {
   const [loading, setLoading] = useState(false);
   const [isSaving, setIsSaving] = useState(false);
   const [editModeEnabled, setEditModeEnabled] = useState(false);
+  const [dbError, setDbError] = useState(false);
   const wikiEditorRef = useRef<WikiContentEditorRef>(null);
 
   // Загрузить страницу по slug из URL или первую доступную
@@ -74,8 +372,14 @@ export default function WikiPage() {
   const loadDefaultPage = async () => {
     try {
       setLoading(true);
+      setDbError(false);
       const response = await fetch('/api/wiki/pages');
-      if (!response.ok) throw new Error('Ошибка загрузки');
+      if (!response.ok) {
+        // Если ошибка, используем fallback контент
+        setDbError(true);
+        setSelectedPage(FALLBACK_CONTENT as WikiPage);
+        return;
+      }
       const pages = await response.json();
       
       if (pages.length > 0) {
@@ -88,6 +392,9 @@ export default function WikiPage() {
       }
     } catch (error) {
       console.error('Error loading default page:', error);
+      // При ошибке используем fallback контент
+      setDbError(true);
+      setSelectedPage(FALLBACK_CONTENT as WikiPage);
     } finally {
       setLoading(false);
     }
-- 
2.51.2.windows.1

