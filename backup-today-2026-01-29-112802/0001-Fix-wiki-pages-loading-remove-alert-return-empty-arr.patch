From 8278b15f23d4b825044a36d044afc4b8db90003a Mon Sep 17 00:00:00 2001
From: edcwsx23QAZ <edcwsx23QAZ@users.noreply.github.com>
Date: Tue, 27 Jan 2026 17:58:14 +0300
Subject: [PATCH 01/12] Fix wiki pages loading: remove alert, return empty
 array on error, better error handling

---
 app/api/wiki/pages/route.ts     | 11 ++++++-----
 components/wiki/PageManager.tsx | 10 +++++++---
 2 files changed, 13 insertions(+), 8 deletions(-)

diff --git a/app/api/wiki/pages/route.ts b/app/api/wiki/pages/route.ts
index c272eac5..6c9a7707 100644
--- a/app/api/wiki/pages/route.ts
+++ b/app/api/wiki/pages/route.ts
@@ -48,14 +48,15 @@ export async function GET(request: NextRequest) {
         ]
       });
 
-      return NextResponse.json(pages);
+      return NextResponse.json(pages || []);
     }
   } catch (error) {
     console.error('Error fetching wiki pages:', error);
-    return NextResponse.json(
-      { error: 'Ошибка при получении страниц' },
-      { status: 500 }
-    );
+    // Возвращаем пустой массив вместо ошибки, чтобы страница могла работать
+    if (slug) {
+      return NextResponse.json({ error: 'Страница не найдена' }, { status: 404 });
+    }
+    return NextResponse.json([]);
   }
 }
 
diff --git a/components/wiki/PageManager.tsx b/components/wiki/PageManager.tsx
index 2e1ed866..a301e79d 100644
--- a/components/wiki/PageManager.tsx
+++ b/components/wiki/PageManager.tsx
@@ -47,12 +47,16 @@ export default function PageManager({
     try {
       setLoading(true);
       const response = await fetch('/api/wiki/pages');
-      if (!response.ok) throw new Error('Ошибка загрузки страниц');
+      if (!response.ok) {
+        const errorData = await response.json().catch(() => ({}));
+        throw new Error(errorData.error || 'Ошибка загрузки страниц');
+      }
       const data = await response.json();
-      setPages(data);
+      setPages(data || []);
     } catch (error) {
       console.error('Error loading pages:', error);
-      alert('Ошибка при загрузке страниц');
+      // Не показываем alert, просто оставляем пустой список
+      setPages([]);
     } finally {
       setLoading(false);
     }
-- 
2.51.2.windows.1

