{
  "id": "prt_9b97fe302001mXryMY9rEuSYC7",
  "messageID": "msg_9b97f30eb001ENVqcwYxlvYUkX",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "write",
  "callID": "toolu_012X1n1j6xa4pUARzRTUG137",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/lib/form-storage.ts",
      "content": "'use client';\n\n// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –∫–ª—é—á–µ–π localStorage\nconst FORM_DATA_KEY = 'deliveryFormData';\nconst FORM_VERSION = '1.0'; // –î–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã\n\nexport interface StoredFormData {\n  version: string;\n  timestamp: number;\n  cargos: Array<{\n    id: string;\n    length: number;\n    width: number;\n    height: number;\n    weight: number;\n  }>;\n  fromCity: string;\n  toCity: string;\n  fromAddress: string;\n  toAddress: string;\n  declaredValue: number;\n  needPackaging: boolean;\n  needLoading: boolean;\n  needCarry: boolean;\n  floor: number;\n  hasFreightLift: boolean;\n  needInsurance: boolean;\n  fromTerminal: boolean;\n  toTerminal: boolean;\n  fromAddressDelivery: boolean;\n  toAddressDelivery: boolean;\n  selectedProducts: Array<{\n    product: {\n      id: number;\n      name: string;\n      category: string;\n      length: number;\n      width: number;\n      height: number;\n      weight: number;\n      price: number;\n    };\n    quantity: number;\n    addedAt: number;\n  }>;\n}\n\n/**\n * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –≤ localStorage\n * –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤ - —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥\n */\nexport const saveFormData = (formData: Partial<StoredFormData>): boolean => {\n  try {\n    if (typeof window === 'undefined') {\n      return false; // SSR safe\n    }\n\n    const dataToSave: StoredFormData = {\n      version: FORM_VERSION,\n      timestamp: Date.now(),\n      cargos: formData.cargos || [],\n      fromCity: formData.fromCity || '',\n      toCity: formData.toCity || '',\n      fromAddress: formData.fromAddress || '',\n      toAddress: formData.toAddress || '',\n      declaredValue: formData.declaredValue || 0,\n      needPackaging: formData.needPackaging || false,\n      needLoading: formData.needLoading || false,\n      needCarry: formData.needCarry || false,\n      floor: formData.floor || 1,\n      hasFreightLift: formData.hasFreightLift || false,\n      needInsurance: formData.needInsurance || false,\n      fromTerminal: formData.fromTerminal ?? true,\n      toTerminal: formData.toTerminal ?? true,\n      fromAddressDelivery: formData.fromAddressDelivery || false,\n      toAddressDelivery: formData.toAddressDelivery || false,\n      selectedProducts: formData.selectedProducts || [],\n    };\n\n    localStorage.setItem(FORM_DATA_KEY, JSON.stringify(dataToSave));\n    console.log('üíæ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage:', dataToSave);\n    return true;\n  } catch (error) {\n    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã:', error);\n    return false;\n  }\n};\n\n/**\n * –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –∏–∑ localStorage\n */\nexport const loadFormData = (): StoredFormData | null => {\n  try {\n    if (typeof window === 'undefined') {\n      return null; // SSR safe\n    }\n\n    const savedData = localStorage.getItem(FORM_DATA_KEY);\n    if (!savedData) {\n      console.log('üìù –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');\n      return null;\n    }\n\n    const parsedData = JSON.parse(savedData) as StoredFormData;\n    \n    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –¥–∞–Ω–Ω—ã—Ö\n    if (parsedData.version !== FORM_VERSION) {\n      console.warn('‚ö†Ô∏è –í–µ—Ä—Å–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è...');\n      // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã\n      return migrateFormData(parsedData);\n    }\n\n    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–∞–≤–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ - —É–¥–∞–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π)\n    const thirtyDaysInMs = 30 * 24 * 60 * 60 * 1000;\n    if (Date.now() - parsedData.timestamp > thirtyDaysInMs) {\n      console.log('üóëÔ∏è –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä—ã–µ, —É–¥–∞–ª—è–µ–º...');\n      clearFormData();\n      return null;\n    }\n\n    console.log('üìÇ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ localStorage:', parsedData);\n    return parsedData;\n  } catch (error) {\n    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã:', error);\n    return null;\n  }\n};\n\n/**\n * –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã\n */\nconst migrateFormData = (oldData: any): StoredFormData | null => {\n  try {\n    // –ë–∞–∑–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è - –ø—Ä–∏–≤–æ–¥–∏–º –∫ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ\n    const migratedData: StoredFormData = {\n      version: FORM_VERSION,\n      timestamp: Date.now(),\n      cargos: oldData.cargos || [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n      fromCity: oldData.fromCity || '',\n      toCity: oldData.toCity || '',\n      fromAddress: oldData.fromAddress || '',\n      toAddress: oldData.toAddress || '',\n      declaredValue: oldData.declaredValue || 0,\n      needPackaging: oldData.needPackaging || false,\n      needLoading: oldData.needLoading || false,\n      needCarry: oldData.needCarry || false,\n      floor: oldData.floor || 1,\n      hasFreightLift: oldData.hasFreightLift || false,\n      needInsurance: oldData.needInsurance || false,\n      fromTerminal: oldData.fromTerminal ?? true,\n      toTerminal: oldData.toTerminal ?? true,\n      fromAddressDelivery: oldData.fromAddressDelivery || false,\n      toAddressDelivery: oldData.toAddressDelivery || false,\n      selectedProducts: oldData.selectedProducts || [],\n    };\n\n    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n    localStorage.setItem(FORM_DATA_KEY, JSON.stringify(migratedData));\n    console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã');\n    return migratedData;\n  } catch (error) {\n    console.error('‚ùå –û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);\n    return null;\n  }\n};\n\n/**\n * –û—á–∏—â–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã\n */\nexport const clearFormData = (): boolean => {\n  try {\n    if (typeof window === 'undefined') {\n      return false;\n    }\n\n    localStorage.removeItem(FORM_DATA_KEY);\n    console.log('üóëÔ∏è –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —É–¥–∞–ª–µ–Ω—ã –∏–∑ localStorage');\n    return true;\n  } catch (error) {\n    console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã:', error);\n    return false;\n  }\n};\n\n/**\n * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n */\nexport const hasStoredFormData = (): boolean => {\n  try {\n    if (typeof window === 'undefined') {\n      return false;\n    }\n\n    return localStorage.getItem(FORM_DATA_KEY) !== null;\n  } catch (error) {\n    return false;\n  }\n};\n\n/**\n * –î–µ–±–∞—É–Ω—Å —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è\n */\nexport const createDebouncedSaver = (delay: number = 1000) => {\n  let timeoutId: NodeJS.Timeout;\n  \n  return (formData: Partial<StoredFormData>) => {\n    clearTimeout(timeoutId);\n    timeoutId = setTimeout(() => {\n      saveFormData(formData);\n    }, delay);\n  };\n};"
    },
    "output": "",
    "metadata": {
      "diagnostics": {},
      "filepath": "/home/user/project/lib/form-storage.ts",
      "exists": false
    },
    "title": "lib/form-storage.ts",
    "time": {
      "start": 1759753814173,
      "end": 1759753814175
    }
  }
}