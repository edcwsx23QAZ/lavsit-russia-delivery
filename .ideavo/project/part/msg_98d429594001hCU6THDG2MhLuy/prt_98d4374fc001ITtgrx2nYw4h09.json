{
  "id": "prt_98d4374fc001ITtgrx2nYw4h09",
  "messageID": "msg_98d429594001hCU6THDG2MhLuy",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "read",
  "callID": "toolu_012m1KwY9sTKTYszk5if8xxG",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/lib/furniture-utils.ts"
    },
    "output": "<file>\n00001| import { \n00002|   FurnitureProduct, \n00003|   CargoPlace, \n00004|   CargoWithMetadata, \n00005|   ProductInForm \n00006| } from './furniture-types';\n00007| \n00008| // üîß –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–µ–±–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏\n00009| \n00010| /**\n00011|  * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç CargoPlace –≤ —Ñ–æ—Ä–º–∞—Ç Cargo –¥–ª—è —Ñ–æ—Ä–º—ã\n00012|  */\n00013| export function cargoPlaceToFormCargo(\n00014|   place: CargoPlace, \n00015|   productId: string, \n00016|   uniqueId: string\n00017| ): CargoWithMetadata {\n00018|   return {\n00019|     id: uniqueId,\n00020|     length: place.length,\n00021|     width: place.depth,  // –≤ —Ç–∞–±–ª–∏—Ü–µ depth, –≤ —Ñ–æ—Ä–º–µ width\n00022|     height: place.height,\n00023|     weight: place.weight,\n00024|     productId,\n00025|     placeNumber: place.placeNumber,\n00026|     isFromProduct: true\n00027|   };\n00028| }\n00029| \n00030| /**\n00031|  * –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∑–∞–ø—Ä–æ—Å—É\n00032|  */\n00033| export function searchProducts(products: FurnitureProduct[], query: string): FurnitureProduct[] {\n00034|   if (!query.trim()) return [];\n00035|   \n00036|   const normalizedQuery = query.toLowerCase().trim();\n00037|   \n00038|   return products.filter(product => {\n00039|     const nameMatch = product.name.toLowerCase().includes(normalizedQuery);\n00040|     const codeMatch = product.externalCode.toLowerCase().includes(normalizedQuery);\n00041|     return (nameMatch || codeMatch) && product.isActive;\n00042|   }).slice(0, 20); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã\n00043| }\n00044| \n00045| /**\n00046|  * –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–∞\n00047|  */\n00048| export function validateProduct(product: FurnitureProduct): { isValid: boolean; errors: string[] } {\n00049|   const errors: string[] = [];\n00050|   \n00051|   if (!product.name?.trim()) {\n00052|     errors.push('–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞');\n00053|   }\n00054|   \n00055|   if (!product.cargoPlaces || product.cargoPlaces.length === 0) {\n00056|     errors.push('–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≥—Ä—É–∑–æ–≤—ã–µ –º–µ—Å—Ç–∞');\n00057|   }\n00058|   \n00059|   if (product.retailPrice < 0) {\n00060|     errors.push('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ü–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞');\n00061|   }\n00062|   \n00063|   // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä—É–∑–æ–≤—ã–µ –º–µ—Å—Ç–∞\n00064|   product.cargoPlaces?.forEach((place, index) => {\n00065|     if (place.weight <= 0 && place.length <= 0 && place.depth <= 0 && place.height <= 0) {\n00066|       errors.push(`–ì—Ä—É–∑–æ–≤–æ–µ –º–µ—Å—Ç–æ ‚Ññ${place.placeNumber} –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–∞–∑–º–µ—Ä–æ–≤`);\n00067|     }\n00068|     \n00069|     if (place.weight > 10000) {\n00070|       errors.push(`–ì—Ä—É–∑–æ–≤–æ–µ –º–µ—Å—Ç–æ ‚Ññ${place.placeNumber} –∏–º–µ–µ—Ç —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –≤–µ—Å: ${place.weight}–∫–≥`);\n00071|     }\n00072|     \n00073|     const maxDimension = Math.max(place.length, place.depth, place.height);\n00074|     if (maxDimension > 1000) {\n00075|       errors.push(`–ì—Ä—É–∑–æ–≤–æ–µ –º–µ—Å—Ç–æ ‚Ññ${place.placeNumber} –∏–º–µ–µ—Ç —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ —Ä–∞–∑–º–µ—Ä—ã: ${maxDimension}—Å–º`);\n00076|     }\n00077|   });\n00078|   \n00079|   return {\n00080|     isValid: errors.length === 0,\n00081|     errors\n00082|   };\n00083| }\n00084| \n00085| /**\n00086|  * –†–∞—Å—á–µ—Ç –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–æ–≤\n00087|  */\n00088| export function calculateTotalValue(productsInForm: ProductInForm[]): number {\n00089|   return productsInForm.reduce((total, item) => {\n00090|     return total + (item.product.retailPrice * item.quantity);\n00091|   }, 0);\n00092| }\n00093| \n00094| /**\n00095|  * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID –¥–ª—è –≥—Ä—É–∑–∞\n00096|  */\n00097| export function generateCargoId(productId: string, placeNumber: number, timestamp: number): string {\n00098|   return `${productId}_p${placeNumber}_${timestamp}`;\n00099| }\n00100| \n00101| /**\n00102|  * –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç –¥–ª—è —Ç–æ–≤–∞—Ä–∞ —Å —É—á–µ—Ç–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞\n00103|  */\n00104| export function createCargosForProduct(\n00105|   product: FurnitureProduct, \n00106|   quantity: number, \n00107|   timestamp: number\n00108| ): CargoWithMetadata[] {\n00109|   const cargos: CargoWithMetadata[] = [];\n00110|   \n00111|   for (let q = 0; q < quantity; q++) {\n00112|     product.cargoPlaces.forEach(place => {\n00113|       const uniqueId = generateCargoId(product.id, place.placeNumber, timestamp + q * 1000 + place.placeNumber);\n00114|       const cargo = cargoPlaceToFormCargo(place, product.id, uniqueId);\n00115|       cargos.push(cargo);\n00116|     });\n00117|   }\n00118|   \n00119|   return cargos;\n00120| }\n00121| \n00122| /**\n00123|  * –ü–æ–∏—Å–∫ –∏–Ω–¥–µ–∫—Å–æ–≤ –≥—Ä—É–∑–æ–≤, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–∏—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ç–æ–≤–∞—Ä—É\n00124|  */\n00125| export function findCargoIndexesForProduct(\n00126|   cargos: CargoWithMetadata[], \n00127|   productId: string, \n00128|   addedAt: number\n00129| ): number[] {\n00130|   const indexes: number[] = [];\n00131|   \n00132|   cargos.forEach((cargo, index) => {\n00133|     if (cargo.productId === productId && cargo.id.includes(`_${addedAt}`)) {\n00134|       indexes.push(index);\n00135|     }\n00136|   });\n00137|   \n00138|   return indexes;\n00139| }\n00140| \n00141| /**\n00142|  * –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –≥—Ä—É–∑–æ–≤ —Ç–æ–≤–∞—Ä–∞\n00143|  */\n00144| export function removeCargosForProduct(\n00145|   cargos: CargoWithMetadata[], \n00146|   productId: string, \n00147|   addedAt: number\n00148| ): CargoWithMetadata[] {\n00149|   return cargos.filter(cargo => {\n00150|     return !(cargo.productId === productId && cargo.id.includes(`_${addedAt}`));\n00151|   });\n00152| }\n00153| \n00154| /**\n00155|  * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã\n00156|  */\n00157| export function formatPrice(price: number): string {\n00158|   return new Intl.NumberFormat('ru-RU', {\n00159|     style: 'currency',\n00160|     currency: 'RUB',\n00161|     minimumFractionDigits: 0,\n00162|     maximumFractionDigits: 0\n00163|   }).format(price);\n00164| }\n00165| \n00166| /**\n00167|  * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–∞–±–∞—Ä–∏—Ç–æ–≤\n00168|  */\n00169| export function formatDimensions(length: number, width: number, height: number): string {\n00170|   return `${length}√ó${width}√ó${height} —Å–º`;\n00171| }\n00172| \n00173| /**\n00174|  * –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—Ä–∞—Ç–∫–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞\n00175|  */\n00176| export function getProductSummary(product: FurnitureProduct): string {\n00177|   const placesCount = product.cargoPlaces.length;\n00178|   const totalWeight = product.cargoPlaces.reduce((sum, place) => sum + place.weight, 0);\n00179|   \n00180|   return `${placesCount} ${getPlaceWord(placesCount)}, ${totalWeight}–∫–≥`;\n00181| }\n00182| \n00183| /**\n00184|  * –°–∫–ª–æ–Ω–µ–Ω–∏–µ —Å–ª–æ–≤–∞ \"–º–µ—Å—Ç–æ\"\n00185|  */\n00186| function getPlaceWord(count: number): string {\n00187|   if (count % 10 === 1 && count % 100 !== 11) {\n00188|     return '–º–µ—Å—Ç–æ';\n00189|   } else if ([2, 3, 4].includes(count % 10) && ![12, 13, 14].includes(count % 100)) {\n00190|     return '–º–µ—Å—Ç–∞';\n00191|   } else {\n00192|     return '–º–µ—Å—Ç';\n00193|   }\n00194| }\n00195| \n00196| /**\n00197|  * –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ localStorage\n00198|  */\n00199| export function cacheProducts(products: FurnitureProduct[]): void {\n00200|   try {\n00201|     const cacheData = {\n00202|       products,\n00203|       timestamp: Date.now()\n00204|     };\n00205|     localStorage.setItem('furniture_products_cache', JSON.stringify(cacheData));\n00206|   } catch (error) {\n00207|     console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã:', error);\n00208|   }\n00209| }\n00210| \n00211| /**\n00212|  * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏–∑ –∫—ç—à–∞\n00213|  */\n00214| export function getCachedProducts(): FurnitureProduct[] | null {\n00215|   try {\n00216|     const cached = localStorage.getItem('furniture_products_cache');\n00217|     if (!cached) return null;\n00218|     \n00219|     const cacheData = JSON.parse(cached);\n00220|     const now = Date.now();\n00221|     const cacheAge = now - cacheData.timestamp;\n00222|     \n00223|     // –ö—ç—à –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 30 –º–∏–Ω—É—Ç\n00224|     if (cacheAge > 30 * 60 * 1000) {\n00225|       localStorage.removeItem('furniture_products_cache');\n00226|       return null;\n00227|     }\n00228|     \n00229|     return cacheData.products;\n00230|   } catch (error) {\n00231|     console.warn('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –∫—ç—à–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤:', error);\n00232|     return null;\n00233|   }\n00234| }\n</file>",
    "metadata": {
      "preview": "import { \n  FurnitureProduct, \n  CargoPlace, \n  CargoWithMetadata, \n  ProductInForm \n} from './furniture-types';\n\n// üîß –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–µ–±–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏\n\n/**\n * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç CargoPlace –≤ —Ñ–æ—Ä–º–∞—Ç Cargo –¥–ª—è —Ñ–æ—Ä–º—ã\n */\nexport function cargoPlaceToFormCargo(\n  place: CargoPlace, \n  productId: string, \n  uniqueId: string\n): CargoWithMetadata {\n  return {\n    id: uniqueId,\n    length: place.length,"
    },
    "title": "lib/furniture-utils.ts",
    "time": {
      "start": 1759011632860,
      "end": 1759011632861
    }
  }
}