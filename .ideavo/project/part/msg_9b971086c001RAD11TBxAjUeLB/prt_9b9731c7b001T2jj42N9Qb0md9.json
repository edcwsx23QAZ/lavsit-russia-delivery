{
  "id": "prt_9b9731c7b001T2jj42N9Qb0md9",
  "messageID": "msg_9b971086c001RAD11TBxAjUeLB",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "edit",
  "callID": "toolu_01JhzHg1D2yBtNew7mvNcpUv",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/layout.tsx",
      "oldString": "import './globals.css';\nimport type { Metadata } from 'next';\nimport { Inter } from 'next/font/google';\nimport ServiceWorkerRegistration from '@/components/ServiceWorkerRegistration';\nimport ClientDevUtils from '@/components/ClientDevUtils';\n\nconst inter = Inter({ subsets: ['latin'] });\n\nexport const metadata: Metadata = {\n  title: 'Междугородняя доставка Лавсит',\n  description: 'Система расчета стоимости доставки по всей России',\n};\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    <html lang=\"en\">\n      <body className={inter.className}>\n        <ServiceWorkerRegistration />\n        <ClientDevUtils />\n        {children}\n        {/* TODO: Remove iframe-navigation.js in production, should never be removed by AI */}\n        <script src=\"/scripts/iframe-navigation.js\"></script>\n        {/* CRITICAL: Dev cache clearing script - only loads in development */}\n        {process.env.NODE_ENV !== 'production' && (\n          <script src=\"/clear-dev-cache.js\"></script>\n        )}\n      </body>\n    </html>\n  );\n}",
      "newString": "import './globals.css';\nimport type { Metadata } from 'next';\nimport { Inter } from 'next/font/google';\nimport { WebpackErrorBoundary } from '@/components/WebpackErrorBoundary';\nimport ClientDevUtils from '@/components/ClientDevUtils';\n\nconst inter = Inter({ subsets: ['latin'] });\n\nexport const metadata: Metadata = {\n  title: 'Междугородняя доставка Лавсит',\n  description: 'Система расчета стоимости доставки по всей России',\n};\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const isDev = process.env.NODE_ENV !== 'production';\n  \n  return (\n    <html lang=\"en\">\n      <head>\n        {isDev && (\n          <>\n            <meta name=\"format-detection\" content=\"telephone=no, date=no, email=no, address=no\" />\n            <meta httpEquiv=\"Cache-Control\" content=\"no-cache, no-store, must-revalidate\" />\n            <meta httpEquiv=\"Pragma\" content=\"no-cache\" />\n            <meta httpEquiv=\"Expires\" content=\"0\" />\n          </>\n        )}\n      </head>\n      <body className={inter.className} suppressHydrationWarning={isDev}>\n        {isDev ? (\n          <WebpackErrorBoundary>\n            <ClientDevUtils />\n            {children}\n          </WebpackErrorBoundary>\n        ) : (\n          <>\n            {children}\n          </>\n        )}\n        {/* TODO: Remove iframe-navigation.js in production, should never be removed by AI */}\n        <script src=\"/scripts/iframe-navigation.js\"></script>\n        {/* CRITICAL: Dev cache clearing script - only loads in development */}\n        {isDev && (\n          <>\n            <script src=\"/clear-dev-cache.js\"></script>\n            <script dangerouslySetInnerHTML={{\n              __html: `\n                console.log('[EMERGENCY] Layout: Killing all service workers and caches...');\n                if ('serviceWorker' in navigator) {\n                  navigator.serviceWorker.getRegistrations().then(registrations => {\n                    registrations.forEach(registration => {\n                      console.log('[EMERGENCY] Layout: Unregistering SW:', registration.scope);\n                      registration.unregister();\n                    });\n                  });\n                }\n                if ('caches' in window) {\n                  caches.keys().then(names => {\n                    names.forEach(name => {\n                      console.log('[EMERGENCY] Layout: Deleting cache:', name);\n                      caches.delete(name);\n                    });\n                  });\n                }\n              `\n            }} />\n          </>\n        )}\n      </body>\n    </html>\n  );\n}"
    },
    "output": "",
    "metadata": {
      "diagnostics": {},
      "diff": "Index: /home/user/project/app/layout.tsx\n===================================================================\n--- /home/user/project/app/layout.tsx\n+++ /home/user/project/app/layout.tsx\n@@ -1,8 +1,8 @@\n import './globals.css';\n import type { Metadata } from 'next';\n import { Inter } from 'next/font/google';\n-import ServiceWorkerRegistration from '@/components/ServiceWorkerRegistration';\n+import { WebpackErrorBoundary } from '@/components/WebpackErrorBoundary';\n import ClientDevUtils from '@/components/ClientDevUtils';\n \n const inter = Inter({ subsets: ['latin'] });\n \n@@ -15,19 +15,61 @@\n   children,\n }: {\n   children: React.ReactNode;\n }) {\n+  const isDev = process.env.NODE_ENV !== 'production';\n+  \n   return (\n     <html lang=\"en\">\n-      <body className={inter.className}>\n-        <ServiceWorkerRegistration />\n-        <ClientDevUtils />\n-        {children}\n+      <head>\n+        {isDev && (\n+          <>\n+            <meta name=\"format-detection\" content=\"telephone=no, date=no, email=no, address=no\" />\n+            <meta httpEquiv=\"Cache-Control\" content=\"no-cache, no-store, must-revalidate\" />\n+            <meta httpEquiv=\"Pragma\" content=\"no-cache\" />\n+            <meta httpEquiv=\"Expires\" content=\"0\" />\n+          </>\n+        )}\n+      </head>\n+      <body className={inter.className} suppressHydrationWarning={isDev}>\n+        {isDev ? (\n+          <WebpackErrorBoundary>\n+            <ClientDevUtils />\n+            {children}\n+          </WebpackErrorBoundary>\n+        ) : (\n+          <>\n+            {children}\n+          </>\n+        )}\n         {/* TODO: Remove iframe-navigation.js in production, should never be removed by AI */}\n         <script src=\"/scripts/iframe-navigation.js\"></script>\n         {/* CRITICAL: Dev cache clearing script - only loads in development */}\n-        {process.env.NODE_ENV !== 'production' && (\n-          <script src=\"/clear-dev-cache.js\"></script>\n+        {isDev && (\n+          <>\n+            <script src=\"/clear-dev-cache.js\"></script>\n+            <script dangerouslySetInnerHTML={{\n+              __html: `\n+                console.log('[EMERGENCY] Layout: Killing all service workers and caches...');\n+                if ('serviceWorker' in navigator) {\n+                  navigator.serviceWorker.getRegistrations().then(registrations => {\n+                    registrations.forEach(registration => {\n+                      console.log('[EMERGENCY] Layout: Unregistering SW:', registration.scope);\n+                      registration.unregister();\n+                    });\n+                  });\n+                }\n+                if ('caches' in window) {\n+                  caches.keys().then(names => {\n+                    names.forEach(name => {\n+                      console.log('[EMERGENCY] Layout: Deleting cache:', name);\n+                      caches.delete(name);\n+                    });\n+                  });\n+                }\n+              `\n+            }} />\n+          </>\n         )}\n       </body>\n     </html>\n   );\n"
    },
    "title": "app/layout.tsx",
    "time": {
      "start": 1759752962355,
      "end": 1759752962365
    }
  }
}