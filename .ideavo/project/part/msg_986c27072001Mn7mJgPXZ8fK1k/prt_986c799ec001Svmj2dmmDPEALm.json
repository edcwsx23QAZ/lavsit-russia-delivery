{
  "id": "prt_986c799ec001Svmj2dmmDPEALm",
  "messageID": "msg_986c27072001Mn7mJgPXZ8fK1k",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "bash",
  "callID": "toolu_01QUJXkXmRaFjMwpRGnAhAKF",
  "state": {
    "status": "completed",
    "input": {
      "command": "cd /home/user/project && npm run build",
      "description": "Build the project again to check for errors"
    },
    "output": "\n> ideavo-nextjs@0.1.0 build\n> next build\n\n  ‚ñ≤ Next.js 14.2.31\n  - Environments: .env\n\n   Creating an optimized production build ...\nFailed to compile.\n\n./app/page.tsx\nError: \n  \u001b[31mx\u001b[0m the name `calculatePEK` is defined multiple times\n      ,-[\u001b[36;1;4m/home/user/project/app/page.tsx\u001b[0m:897:1]\n \u001b[2m 897\u001b[0m |   };\n \u001b[2m 898\u001b[0m | \n \u001b[2m 899\u001b[0m |   // –†–∞—Å—á–µ—Ç –¥–ª—è –ü–≠–ö —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API\n \u001b[2m 900\u001b[0m |   const calculatePEK = async (): Promise<CalculationResult> => {\n      : \u001b[31;1m        ^^^^^^|^^^^^\u001b[0m\n      :               \u001b[31;1m`-- \u001b[31;1mprevious definition of `calculatePEK` here\u001b[0m\u001b[0m\n \u001b[2m 901\u001b[0m |     const apiUrl = 'https://kabinet.pecom.ru/api/v1/calculateprice/';\n \u001b[2m 902\u001b[0m |     \n \u001b[2m 903\u001b[0m |     try {\n \u001b[2m 904\u001b[0m |       // –ü–æ–ª—É—á–∞–µ–º ID —Å–∫–ª–∞–¥–æ–≤ –ø–æ –≥–æ—Ä–æ–¥–∞–º\n \u001b[2m 905\u001b[0m |       const senderWarehouseId = getPekWarehouseId(form.fromCity);\n \u001b[2m 906\u001b[0m |       const receiverWarehouseId = getPekWarehouseId(form.toCity);\n \u001b[2m 907\u001b[0m |       \n \u001b[2m 908\u001b[0m |       if (!senderWarehouseId || !receiverWarehouseId) {\n \u001b[2m 909\u001b[0m |         return {\n \u001b[2m 910\u001b[0m |           company: '–ü–≠–ö',\n \u001b[2m 911\u001b[0m |           price: 0,\n \u001b[2m 912\u001b[0m |           days: 0,\n \u001b[2m 913\u001b[0m |           error: `–°–∫–ª–∞–¥ –ü–≠–ö –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–æ—Ä–æ–¥–∞: ${!senderWarehouseId ? form.fromCity : ''} ${!receiverWarehouseId ? form.toCity : ''}`.trim(),\n \u001b[2m 914\u001b[0m |           apiUrl,\n \u001b[2m 915\u001b[0m |           requestData: { fromCity: form.fromCity, toCity: form.toCity },\n \u001b[2m 916\u001b[0m |           responseData: null\n \u001b[2m 917\u001b[0m |         };\n \u001b[2m 918\u001b[0m |       }\n \u001b[2m 919\u001b[0m | \n \u001b[2m 920\u001b[0m |       // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞—Ç—É –∑–∞–≤—Ç—Ä–∞ –¥–ª—è –∑–∞–±–æ—Ä–∞\n \u001b[2m 921\u001b[0m |       const tomorrow = new Date();\n \u001b[2m 922\u001b[0m |       tomorrow.setDate(tomorrow.getDate() + 1);\n \u001b[2m 923\u001b[0m |       const plannedDateTime = tomorrow.toISOString().slice(0, 19); // 2023-02-28T14:00:00\n \u001b[2m 924\u001b[0m | \n \u001b[2m 925\u001b[0m |       // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤\n \u001b[2m 926\u001b[0m |       const cargos = form.cargos.map(cargo => ({\n \u001b[2m 927\u001b[0m |         length: cargo.length / 100, // –ø–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–µ—Ç—Ä—ã\n \u001b[2m 928\u001b[0m |         width: cargo.width / 100,\n \u001b[2m 929\u001b[0m |         height: cargo.height / 100,\n \u001b[2m 930\u001b[0m |         volume: (cargo.length * cargo.width * cargo.height) / 1000000, // –º3\n \u001b[2m 931\u001b[0m |         weight: cargo.weight,\n \u001b[2m 932\u001b[0m |         isHP: form.needPackaging, // –∑–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n \u001b[2m 933\u001b[0m |         sealingPositionsCount: 0\n \u001b[2m 934\u001b[0m |       }));\n \u001b[2m 935\u001b[0m | \n \u001b[2m 936\u001b[0m |       // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –∫ API –ü–≠–ö\n \u001b[2m 937\u001b[0m |       const requestData = {\n \u001b[2m 938\u001b[0m |         currencyCode: \"643\", // —Ä—É–±–ª–∏\n \u001b[2m 939\u001b[0m |         types: [3], // —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ –ø–µ—Ä–µ–≤–æ–∑–∫–∞\n \u001b[2m 940\u001b[0m |         senderWarehouseId,\n \u001b[2m 941\u001b[0m |         receiverWarehouseId,\n \u001b[2m 942\u001b[0m |         isOpenCarSender: false,\n \u001b[2m 943\u001b[0m |         isOpenCarReceiver: false,\n \u001b[2m 944\u001b[0m |         isHyperMarket: false,\n \u001b[2m 945\u001b[0m |         plannedDateTime,\n \u001b[2m 946\u001b[0m |         isInsurance: form.needInsurance && form.declaredValue > 0,\n \u001b[2m 947\u001b[0m |         isInsurancePrice: form.needInsurance ? form.declaredValue : 0,\n \u001b[2m 948\u001b[0m |         isPickUp: form.fromAddressDelivery,\n \u001b[2m 949\u001b[0m |         isDelivery: form.toAddressDelivery,\n \u001b[2m 950\u001b[0m |         needReturnDocuments: false,\n \u001b[2m 951\u001b[0m |         needArrangeTransportationDocuments: false,\n \u001b[2m 952\u001b[0m |         senderDistanceType: 0,\n \u001b[2m 953\u001b[0m |         receiverDistanceType: 0,\n \u001b[2m 954\u001b[0m |         cargos\n \u001b[2m 955\u001b[0m |       };\n \u001b[2m 956\u001b[0m | \n \u001b[2m 957\u001b[0m |       // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏ –ü–†–† –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\n \u001b[2m 958\u001b[0m |       if (form.needCarry) {\n \u001b[2m 959\u001b[0m |         requestData.pickupServices = {\n \u001b[2m 960\u001b[0m |           isLoading: true,\n \u001b[2m 961\u001b[0m |           floor: 0,\n \u001b[2m 962\u001b[0m |           carryingDistance: 0,\n \u001b[2m 963\u001b[0m |           isElevator: false\n \u001b[2m 964\u001b[0m |         };\n \u001b[2m 965\u001b[0m |         requestData.deliveryServices = {\n \u001b[2m 966\u001b[0m |           isLoading: true,\n \u001b[2m 967\u001b[0m |           floor: 0,\n \u001b[2m 968\u001b[0m |           carryingDistance: 0,\n \u001b[2m 969\u001b[0m |           isElevator: false\n \u001b[2m 970\u001b[0m |         };\n \u001b[2m 971\u001b[0m |       }\n \u001b[2m 972\u001b[0m | \n \u001b[2m 973\u001b[0m |       // –î–æ–±–∞–≤–ª—è–µ–º –∞–¥—Ä–µ—Å–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞\n \u001b[2m 974\u001b[0m |       if (form.fromAddressDelivery) {\n \u001b[2m 975\u001b[0m |         requestData.pickup = {\n \u001b[2m 976\u001b[0m |           address: form.fromAddress || `–†–æ—Å—Å–∏—è, ${form.fromCity}`\n \u001b[2m 977\u001b[0m |         };\n \u001b[2m 978\u001b[0m |       }\n \u001b[2m 979\u001b[0m |       \n \u001b[2m 980\u001b[0m |       if (form.toAddressDelivery) {\n \u001b[2m 981\u001b[0m |         requestData.delivery = {\n \u001b[2m 982\u001b[0m |           address: form.toAddress || `–†–æ—Å—Å–∏—è, ${form.toCity}`\n \u001b[2m 983\u001b[0m |         };\n \u001b[2m 984\u001b[0m |       }\n \u001b[2m 985\u001b[0m | \n \u001b[2m 986\u001b[0m |       console.log('üöÄ –ü–≠–ö API –∑–∞–ø—Ä–æ—Å:', requestData);\n \u001b[2m 987\u001b[0m | \n \u001b[2m 988\u001b[0m |       const response = await fetch(apiUrl, {\n \u001b[2m 989\u001b[0m |         method: 'POST',\n \u001b[2m 990\u001b[0m |         headers: {\n \u001b[2m 991\u001b[0m |           'Content-Type': 'application/json;charset=utf-8',\n \u001b[2m 992\u001b[0m |           'Accept': 'application/json',\n \u001b[2m 993\u001b[0m |           'Authorization': `Bearer 624FC93CA677B23673BB476D4982294DC27E246F`\n \u001b[2m 994\u001b[0m |         },\n \u001b[2m 995\u001b[0m |         body: JSON.stringify(requestData)\n \u001b[2m 996\u001b[0m |       });\n \u001b[2m 997\u001b[0m | \n \u001b[2m 998\u001b[0m |       const data = await response.json();\n \u001b[2m 999\u001b[0m |       console.log('üöÄ –ü–≠–ö API –æ—Ç–≤–µ—Ç:', data);\n \u001b[2m1000\u001b[0m | \n \u001b[2m1001\u001b[0m |       if (response.ok && !data.hasError && data.transfers && data.transfers.length > 0) {\n \u001b[2m1002\u001b[0m |         const transfer = data.transfers[0]; // –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Ç–∞—Ä–∏—Ñ (–∞–≤—Ç–æ)\n \u001b[2m1003\u001b[0m |         \n \u001b[2m1004\u001b[0m |         if (!transfer.hasError) {\n \u001b[2m1005\u001b[0m |           // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —É—Å–ª—É–≥\n \u001b[2m1006\u001b[0m |           const services = [];\n \u001b[2m1007\u001b[0m |           let totalCalculated = 0;\n \u001b[2m1008\u001b[0m | \n \u001b[2m1009\u001b[0m |           const processServices = (servicesList: any[], parentName = '') => {\n \u001b[2m1010\u001b[0m |             servicesList.forEach(service => {\n \u001b[2m1011\u001b[0m |               const serviceName = parentName ? `${parentName} - ${service.info}` : service.info;\n \u001b[2m1012\u001b[0m |               const serviceCost = parseFloat(service.cost) || 0;\n \u001b[2m1013\u001b[0m |               \n \u001b[2m1014\u001b[0m |               if (serviceCost > 0) {\n \u001b[2m1015\u001b[0m |                 services.push({\n \u001b[2m1016\u001b[0m |                   name: serviceName,\n \u001b[2m1017\u001b[0m |                   description: service.serviceType,\n \u001b[2m1018\u001b[0m |                   price: serviceCost\n \u001b[2m1019\u001b[0m |                 });\n \u001b[2m1020\u001b[0m |                 totalCalculated += serviceCost;\n \u001b[2m1021\u001b[0m |               }\n \u001b[2m1022\u001b[0m | \n \u001b[2m1023\u001b[0m |               // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏\n \u001b[2m1024\u001b[0m |               if (service.services && Array.isArray(service.services)) {\n \u001b[2m1025\u001b[0m |                 processServices(service.services, serviceName);\n \u001b[2m1026\u001b[0m |               }\n \u001b[2m1027\u001b[0m |             });\n \u001b[2m1028\u001b[0m |           };\n \u001b[2m1029\u001b[0m | \n \u001b[2m1030\u001b[0m |           if (transfer.services) {\n \u001b[2m1031\u001b[0m |             processServices(transfer.services);\n \u001b[2m1032\u001b[0m |           }\n \u001b[2m1033\u001b[0m | \n \u001b[2m1034\u001b[0m |           return {\n \u001b[2m1035\u001b[0m |             company: '–ü–≠–ö',\n \u001b[2m1036\u001b[0m |             price: Math.round(transfer.costTotal),\n \u001b[2m1037\u001b[0m |             days: transfer.estDeliveryTime || 3,\n \u001b[2m1038\u001b[0m |             details: {\n \u001b[2m1039\u001b[0m |               note: `–î–æ—Å—Ç–∞–≤–∫–∞ ${form.fromCity} - ${form.toCity} (—Ç–∞—Ä–∏—Ñ ${transfer.type})`,\n \u001b[2m1040\u001b[0m |               services: services.length > 0 ? services : [\n \u001b[2m1041\u001b[0m |                 {\n \u001b[2m1042\u001b[0m |                   name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n \u001b[2m1043\u001b[0m |                   description: `${form.fromCity} - ${form.toCity}`,\n \u001b[2m1044\u001b[0m |                   price: Math.round(transfer.costTotal)\n \u001b[2m1045\u001b[0m |                 }\n \u001b[2m1046\u001b[0m |               ]\n \u001b[2m1047\u001b[0m |             },\n \u001b[2m1048\u001b[0m |             requestData,\n \u001b[2m1049\u001b[0m |             responseData: data,\n \u001b[2m1050\u001b[0m |             apiUrl\n \u001b[2m1051\u001b[0m |           };\n \u001b[2m1052\u001b[0m |         } else {\n \u001b[2m1053\u001b[0m |           throw new Error(transfer.errorMessage || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞ –ü–≠–ö');\n \u001b[2m1054\u001b[0m |         }\n \u001b[2m1055\u001b[0m |       } else {\n \u001b[2m1056\u001b[0m |         throw new Error(data.errorMessage || '–û—à–∏–±–∫–∞ API –ü–≠–ö');\n \u001b[2m1057\u001b[0m |       }\n \u001b[2m1058\u001b[0m |       \n \u001b[2m1059\u001b[0m |     } catch (error: any) {\n \u001b[2m1060\u001b[0m |       console.error('üö® –û—à–∏–±–∫–∞ –ü–≠–ö API:', error);\n \u001b[2m1061\u001b[0m |       \n \u001b[2m1062\u001b[0m |       // –§–æ–ª–ª–±—ç–∫ —Ä–∞—Å—á–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ\n \u001b[2m1063\u001b[0m |       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n \u001b[2m1064\u001b[0m |       let basePrice = totalWeight * 18; // 18 —Ä—É–± –∑–∞ –∫–≥ –¥–ª—è –ü–≠–ö\n \u001b[2m1065\u001b[0m |       \n \u001b[2m1066\u001b[0m |       if (form.fromAddressDelivery) basePrice += 600;\n \u001b[2m1067\u001b[0m |       if (form.toAddressDelivery) basePrice += 600;\n \u001b[2m1068\u001b[0m |       if (form.needInsurance && form.declaredValue > 0) basePrice += form.declaredValue * 0.012;\n \u001b[2m1069\u001b[0m |       if (form.needPackaging) basePrice += totalWeight * 25;\n \u001b[2m1070\u001b[0m |       if (form.needCarry) basePrice += 500;\n \u001b[2m1071\u001b[0m |       \n \u001b[2m1072\u001b[0m |       return {\n \u001b[2m1073\u001b[0m |         company: '–ü–≠–ö',\n \u001b[2m1074\u001b[0m |         price: Math.round(basePrice),\n \u001b[2m1075\u001b[0m |         days: 3,\n \u001b[2m1076\u001b[0m |         details: {\n \u001b[2m1077\u001b[0m |           note: '–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º –ü–≠–ö (–æ—à–∏–±–∫–∞ API)',\n \u001b[2m1078\u001b[0m |           services: [\n \u001b[2m1079\u001b[0m |             {\n \u001b[2m1080\u001b[0m |               name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n \u001b[2m1081\u001b[0m |               description: `${form.fromCity} - ${form.toCity}`,\n \u001b[2m1082\u001b[0m |               price: Math.round(basePrice)\n \u001b[2m1083\u001b[0m |             }\n \u001b[2m1084\u001b[0m |           ]\n \u001b[2m1085\u001b[0m |         },\n \u001b[2m1086\u001b[0m |         requestData: null,\n \u001b[2m1087\u001b[0m |         responseData: null,\n \u001b[2m1088\u001b[0m |         apiUrl,\n \u001b[2m1089\u001b[0m |         error: `–û—à–∏–±–∫–∞ API –ü–≠–ö: ${error.message}. –ü–æ–∫–∞–∑–∞–Ω –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç.`\n \u001b[2m1090\u001b[0m |       };\n \u001b[2m1091\u001b[0m |     }\n \u001b[2m1092\u001b[0m |   };\n \u001b[2m1093\u001b[0m | \n \u001b[2m1094\u001b[0m |   // –ü–æ–ª—É—á–µ–Ω–∏–µ ID —Å–∫–ª–∞–¥–∞ –ü–≠–ö –ø–æ –∞–¥—Ä–µ—Å—É —á–µ—Ä–µ–∑ API\n \u001b[2m1095\u001b[0m |   const findPekWarehouseId = async (address: string): Promise<string | null> => {\n \u001b[2m1096\u001b[0m |     try {\n \u001b[2m1097\u001b[0m |       // –ò—Å–ø–æ–ª—å–∑—É–µ–º API –ü–≠–ö –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–∫–ª–∞–¥–∞ –ø–æ –∞–¥—Ä–µ—Å—É\n \u001b[2m1098\u001b[0m |       const response = await fetch('https://api.pecom.ru/v1/branches/findzonebyaddress', {\n \u001b[2m1099\u001b[0m |         method: 'POST',\n \u001b[2m1100\u001b[0m |         headers: {\n \u001b[2m1101\u001b[0m |           'Content-Type': 'application/json',\n \u001b[2m1102\u001b[0m |           'Authorization': 'Basic ' + btoa('C04C5BF2AE367BDCBDC71E7DA520A69B167D1984:')\n \u001b[2m1103\u001b[0m |         },\n \u001b[2m1104\u001b[0m |         body: JSON.stringify({\n \u001b[2m1105\u001b[0m |           address: address\n \u001b[2m1106\u001b[0m |         })\n \u001b[2m1107\u001b[0m |       });\n \u001b[2m1108\u001b[0m | \n \u001b[2m1109\u001b[0m |       if (response.ok) {\n \u001b[2m1110\u001b[0m |         const data = await response.json();\n \u001b[2m1111\u001b[0m |         return data.mainWarehouseId || null;\n \u001b[2m1112\u001b[0m |       }\n \u001b[2m1113\u001b[0m |       \n \u001b[2m1114\u001b[0m |       // –§–æ–ª–ª–±—ç–∫ –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤\n \u001b[2m1115\u001b[0m |       const fallbackWarehouses: { [key: string]: string } = {\n \u001b[2m1116\u001b[0m |         '–º–æ—Å–∫–≤–∞': 'dc6c746d-812d-11e4-bbfc-001999d8b3c5',\n \u001b[2m1117\u001b[0m |         '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': 'b436c978-086d-11e6-b6ca-00155d668909',\n \u001b[2m1118\u001b[0m |         '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': '550e8400-e29b-41d4-a716-446655440000'\n \u001b[2m1119\u001b[0m |       };\n \u001b[2m1120\u001b[0m |       \n \u001b[2m1121\u001b[0m |       const normalizedCity = address.toLowerCase().trim()\n \u001b[2m1122\u001b[0m |         .replace(/—ë/g, '–µ')\n \u001b[2m1123\u001b[0m |         .replace(/[\\s\\-\\.]+/g, '');\n \u001b[2m1124\u001b[0m |       \n \u001b[2m1125\u001b[0m |       for (const [city, warehouseId] of Object.entries(fallbackWarehouses)) {\n \u001b[2m1126\u001b[0m |         const normalizedCityKey = city.replace(/[\\s\\-\\.]+/g, '');\n \u001b[2m1127\u001b[0m |         if (normalizedCity.includes(normalizedCityKey) || normalizedCityKey.includes(normalizedCity)) {\n \u001b[2m1128\u001b[0m |           return warehouseId;\n \u001b[2m1129\u001b[0m |         }\n \u001b[2m1130\u001b[0m |       }\n \u001b[2m1131\u001b[0m |       \n \u001b[2m1132\u001b[0m |       return null;\n \u001b[2m1133\u001b[0m |     } catch (error) {\n \u001b[2m1134\u001b[0m |       console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ —Å–∫–ª–∞–¥–∞ –ü–≠–ö:', error);\n \u001b[2m1135\u001b[0m |       return null;\n \u001b[2m1136\u001b[0m |     }\n \u001b[2m1137\u001b[0m |   };\n \u001b[2m1138\u001b[0m | \n \u001b[2m1139\u001b[0m |   // –†–∞—Å—á–µ—Ç –¥–ª—è –ü–≠–ö —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–π API\n \u001b[2m1140\u001b[0m |   const calculatePEK = async (): Promise<CalculationResult> => {\n      : \u001b[33;1m        ^^^^^^|^^^^^\u001b[0m\n      :               \u001b[33;1m`-- \u001b[33;1m`calculatePEK` redefined here\u001b[0m\u001b[0m\n \u001b[2m1141\u001b[0m |     const apiUrl = 'http://calc.pecom.ru/bitrix/components/pecom/calc/ajax.php';\n \u001b[2m1142\u001b[0m |     \n \u001b[2m1143\u001b[0m |     try {\n      `----\n\nImport trace for requested module:\n./app/page.tsx\n\n\n> Build failed because of webpack errors\n",
    "metadata": {
      "output": "\n> ideavo-nextjs@0.1.0 build\n> next build\n\n  ‚ñ≤ Next.js 14.2.31\n  - Environments: .env\n\n   Creating an optimized production build ...\nFailed to compile.\n\n./app/page.tsx\nError: \n  \u001b[31mx\u001b[0m the name `calculatePEK` is defined multiple times\n      ,-[\u001b[36;1;4m/home/user/project/app/page.tsx\u001b[0m:897:1]\n \u001b[2m 897\u001b[0m |   };\n \u001b[2m 898\u001b[0m | \n \u001b[2m 899\u001b[0m |   // –†–∞—Å—á–µ—Ç –¥–ª—è –ü–≠–ö —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API\n \u001b[2m 900\u001b[0m |   const calculatePEK = async (): Promise<CalculationResult> => {\n      : \u001b[31;1m        ^^^^^^|^^^^^\u001b[0m\n      :               \u001b[31;1m`-- \u001b[31;1mprevious definition of `calculatePEK` here\u001b[0m\u001b[0m\n \u001b[2m 901\u001b[0m |     const apiUrl = 'https://kabinet.pecom.ru/api/v1/calculateprice/';\n \u001b[2m 902\u001b[0m |     \n \u001b[2m 903\u001b[0m |     try {\n \u001b[2m 904\u001b[0m |       // –ü–æ–ª—É—á–∞–µ–º ID —Å–∫–ª–∞–¥–æ–≤ –ø–æ –≥–æ—Ä–æ–¥–∞–º\n \u001b[2m 905\u001b[0m |       const senderWarehouseId = getPekWarehouseId(form.fromCity);\n \u001b[2m 906\u001b[0m |       const receiverWarehouseId = getPekWarehouseId(form.toCity);\n \u001b[2m 907\u001b[0m |       \n \u001b[2m 908\u001b[0m |       if (!senderWarehouseId || !receiverWarehouseId) {\n \u001b[2m 909\u001b[0m |         return {\n \u001b[2m 910\u001b[0m |           company: '–ü–≠–ö',\n \u001b[2m 911\u001b[0m |           price: 0,\n \u001b[2m 912\u001b[0m |           days: 0,\n \u001b[2m 913\u001b[0m |           error: `–°–∫–ª–∞–¥ –ü–≠–ö –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–æ—Ä–æ–¥–∞: ${!senderWarehouseId ? form.fromCity : ''} ${!receiverWarehouseId ? form.toCity : ''}`.trim(),\n \u001b[2m 914\u001b[0m |           apiUrl,\n \u001b[2m 915\u001b[0m |           requestData: { fromCity: form.fromCity, toCity: form.toCity },\n \u001b[2m 916\u001b[0m |           responseData: null\n \u001b[2m 917\u001b[0m |         };\n \u001b[2m 918\u001b[0m |       }\n \u001b[2m 919\u001b[0m | \n \u001b[2m 920\u001b[0m |       // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞—Ç—É –∑–∞–≤—Ç—Ä–∞ –¥–ª—è –∑–∞–±–æ—Ä–∞\n \u001b[2m 921\u001b[0m |       const tomorrow = new Date();\n \u001b[2m 922\u001b[0m |       tomorrow.setDate(tomorrow.getDate() + 1);\n \u001b[2m 923\u001b[0m |       const plannedDateTime = tomorrow.toISOString().slice(0, 19); // 2023-02-28T14:00:00\n \u001b[2m 924\u001b[0m | \n \u001b[2m 925\u001b[0m |       // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤\n \u001b[2m 926\u001b[0m |       const cargos = form.cargos.map(cargo => ({\n \u001b[2m 927\u001b[0m |         length: cargo.length / 100, // –ø–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–µ—Ç—Ä—ã\n \u001b[2m 928\u001b[0m |         width: cargo.width / 100,\n \u001b[2m 929\u001b[0m |         height: cargo.height / 100,\n \u001b[2m 930\u001b[0m |         volume: (cargo.length * cargo.width * cargo.height) / 1000000, // –º3\n \u001b[2m 931\u001b[0m |         weight: cargo.weight,\n \u001b[2m 932\u001b[0m |         isHP: form.needPackaging, // –∑–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n \u001b[2m 933\u001b[0m |         sealingPositionsCount: 0\n \u001b[2m 934\u001b[0m |       }));\n \u001b[2m 935\u001b[0m | \n \u001b[2m 936\u001b[0m |       // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –∫ API –ü–≠–ö\n \u001b[2m 937\u001b[0m |       const requestData = {\n \u001b[2m 938\u001b[0m |         currencyCode: \"643\", // —Ä—É–±–ª–∏\n \u001b[2m 939\u001b[0m |         types: [3], // —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ –ø–µ—Ä–µ–≤–æ–∑–∫–∞\n \u001b[2m 940\u001b[0m |         senderWarehouseId,\n \u001b[2m 941\u001b[0m |         receiverWarehouseId,\n \u001b[2m 942\u001b[0m |         isOpenCarSender: false,\n \u001b[2m 943\u001b[0m |         isOpenCarReceiver: false,\n \u001b[2m 944\u001b[0m |         isHyperMarket: false,\n \u001b[2m 945\u001b[0m |         plannedDateTime,\n \u001b[2m 946\u001b[0m |         isInsurance: form.needInsurance && form.declaredValue > 0,\n \u001b[2m 947\u001b[0m |         isInsurancePrice: form.needInsurance ? form.declaredValue : 0,\n \u001b[2m 948\u001b[0m |         isPickUp: form.fromAddressDelivery,\n \u001b[2m 949\u001b[0m |         isDelivery: form.toAddressDelivery,\n \u001b[2m 950\u001b[0m |         needReturnDocuments: false,\n \u001b[2m 951\u001b[0m |         needArrangeTransportationDocuments: false,\n \u001b[2m 952\u001b[0m |         senderDistanceType: 0,\n \u001b[2m 953\u001b[0m |         receiverDistanceType: 0,\n \u001b[2m 954\u001b[0m |         cargos\n \u001b[2m 955\u001b[0m |       };\n \u001b[2m 956\u001b[0m | \n \u001b[2m 957\u001b[0m |       // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏ –ü–†–† –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\n \u001b[2m 958\u001b[0m |       if (form.needCarry) {\n \u001b[2m 959\u001b[0m |         requestData.pickupServices = {\n \u001b[2m 960\u001b[0m |           isLoading: true,\n \u001b[2m 961\u001b[0m |           floor: 0,\n \u001b[2m 962\u001b[0m |           carryingDistance: 0,\n \u001b[2m 963\u001b[0m |           isElevator: false\n \u001b[2m 964\u001b[0m |         };\n \u001b[2m 965\u001b[0m |         requestData.deliveryServices = {\n \u001b[2m 966\u001b[0m |           isLoading: true,\n \u001b[2m 967\u001b[0m |           floor: 0,\n \u001b[2m 968\u001b[0m |           carryingDistance: 0,\n \u001b[2m 969\u001b[0m |           isElevator: false\n \u001b[2m 970\u001b[0m |         };\n \u001b[2m 971\u001b[0m |       }\n \u001b[2m 972\u001b[0m | \n \u001b[2m 973\u001b[0m |       // –î–æ–±–∞–≤–ª—è–µ–º –∞–¥—Ä–µ—Å–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞\n \u001b[2m 974\u001b[0m |       if (form.fromAddressDelivery) {\n \u001b[2m 975\u001b[0m |         requestData.pickup = {\n \u001b[2m 976\u001b[0m |           address: form.fromAddress || `–†–æ—Å—Å–∏—è, ${form.fromCity}`\n \u001b[2m 977\u001b[0m |         };\n \u001b[2m 978\u001b[0m |       }\n \u001b[2m 979\u001b[0m |       \n \u001b[2m 980\u001b[0m |       if (form.toAddressDelivery) {\n \u001b[2m 981\u001b[0m |         requestData.delivery = {\n \u001b[2m 982\u001b[0m |           address: form.toAddress || `–†–æ—Å—Å–∏—è, ${form.toCity}`\n \u001b[2m 983\u001b[0m |         };\n \u001b[2m 984\u001b[0m |       }\n \u001b[2m 985\u001b[0m | \n \u001b[2m 986\u001b[0m |       console.log('üöÄ –ü–≠–ö API –∑–∞–ø—Ä–æ—Å:', requestData);\n \u001b[2m 987\u001b[0m | \n \u001b[2m 988\u001b[0m |       const response = await fetch(apiUrl, {\n \u001b[2m 989\u001b[0m |         method: 'POST',\n \u001b[2m 990\u001b[0m |         headers: {\n \u001b[2m 991\u001b[0m |           'Content-Type': 'application/json;charset=utf-8',\n \u001b[2m 992\u001b[0m |           'Accept': 'application/json',\n \u001b[2m 993\u001b[0m |           'Authorization': `Bearer 624FC93CA677B23673BB476D4982294DC27E246F`\n \u001b[2m 994\u001b[0m |         },\n \u001b[2m 995\u001b[0m |         body: JSON.stringify(requestData)\n \u001b[2m 996\u001b[0m |       });\n \u001b[2m 997\u001b[0m | \n \u001b[2m 998\u001b[0m |       const data = await response.json();\n \u001b[2m 999\u001b[0m |       console.log('üöÄ –ü–≠–ö API –æ—Ç–≤–µ—Ç:', data);\n \u001b[2m1000\u001b[0m | \n \u001b[2m1001\u001b[0m |       if (response.ok && !data.hasError && data.transfers && data.transfers.length > 0) {\n \u001b[2m1002\u001b[0m |         const transfer = data.transfers[0]; // –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Ç–∞—Ä–∏—Ñ (–∞–≤—Ç–æ)\n \u001b[2m1003\u001b[0m |         \n \u001b[2m1004\u001b[0m |         if (!transfer.hasError) {\n \u001b[2m1005\u001b[0m |           // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —É—Å–ª—É–≥\n \u001b[2m1006\u001b[0m |           const services = [];\n \u001b[2m1007\u001b[0m |           let totalCalculated = 0;\n \u001b[2m1008\u001b[0m | \n \u001b[2m1009\u001b[0m |           const processServices = (servicesList: any[], parentName = '') => {\n \u001b[2m1010\u001b[0m |             servicesList.forEach(service => {\n \u001b[2m1011\u001b[0m |               const serviceName = parentName ? `${parentName} - ${service.info}` : service.info;\n \u001b[2m1012\u001b[0m |               const serviceCost = parseFloat(service.cost) || 0;\n \u001b[2m1013\u001b[0m |               \n \u001b[2m1014\u001b[0m |               if (serviceCost > 0) {\n \u001b[2m1015\u001b[0m |                 services.push({\n \u001b[2m1016\u001b[0m |                   name: serviceName,\n \u001b[2m1017\u001b[0m |                   description: service.serviceType,\n \u001b[2m1018\u001b[0m |                   price: serviceCost\n \u001b[2m1019\u001b[0m |                 });\n \u001b[2m1020\u001b[0m |                 totalCalculated += serviceCost;\n \u001b[2m1021\u001b[0m |               }\n \u001b[2m1022\u001b[0m | \n \u001b[2m1023\u001b[0m |               // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏\n \u001b[2m1024\u001b[0m |               if (service.services && Array.isArray(service.services)) {\n \u001b[2m1025\u001b[0m |                 processServices(service.services, serviceName);\n \u001b[2m1026\u001b[0m |               }\n \u001b[2m1027\u001b[0m |             });\n \u001b[2m1028\u001b[0m |           };\n \u001b[2m1029\u001b[0m | \n \u001b[2m1030\u001b[0m |           if (transfer.services) {\n \u001b[2m1031\u001b[0m |             processServices(transfer.services);\n \u001b[2m1032\u001b[0m |           }\n \u001b[2m1033\u001b[0m | \n \u001b[2m1034\u001b[0m |           return {\n \u001b[2m1035\u001b[0m |             company: '–ü–≠–ö',\n \u001b[2m1036\u001b[0m |             price: Math.round(transfer.costTotal),\n \u001b[2m1037\u001b[0m |             days: transfer.estDeliveryTime || 3,\n \u001b[2m1038\u001b[0m |             details: {\n \u001b[2m1039\u001b[0m |               note: `–î–æ—Å—Ç–∞–≤–∫–∞ ${form.fromCity} - ${form.toCity} (—Ç–∞—Ä–∏—Ñ ${transfer.type})`,\n \u001b[2m1040\u001b[0m |               services: services.length > 0 ? services : [\n \u001b[2m1041\u001b[0m |                 {\n \u001b[2m1042\u001b[0m |                   name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n \u001b[2m1043\u001b[0m |                   description: `${form.fromCity} - ${form.toCity}`,\n \u001b[2m1044\u001b[0m |                   price: Math.round(transfer.costTotal)\n \u001b[2m1045\u001b[0m |                 }\n \u001b[2m1046\u001b[0m |               ]\n \u001b[2m1047\u001b[0m |             },\n \u001b[2m1048\u001b[0m |             requestData,\n \u001b[2m1049\u001b[0m |             responseData: data,\n \u001b[2m1050\u001b[0m |             apiUrl\n \u001b[2m1051\u001b[0m |           };\n \u001b[2m1052\u001b[0m |         } else {\n \u001b[2m1053\u001b[0m |           throw new Error(transfer.errorMessage || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞ –ü–≠–ö');\n \u001b[2m1054\u001b[0m |         }\n \u001b[2m1055\u001b[0m |       } else {\n \u001b[2m1056\u001b[0m |         throw new Error(data.errorMessage || '–û—à–∏–±–∫–∞ API –ü–≠–ö');\n \u001b[2m1057\u001b[0m |       }\n \u001b[2m1058\u001b[0m |       \n \u001b[2m1059\u001b[0m |     } catch (error: any) {\n \u001b[2m1060\u001b[0m |       console.error('üö® –û—à–∏–±–∫–∞ –ü–≠–ö API:', error);\n \u001b[2m1061\u001b[0m |       \n \u001b[2m1062\u001b[0m |       // –§–æ–ª–ª–±—ç–∫ —Ä–∞—Å—á–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ\n \u001b[2m1063\u001b[0m |       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n \u001b[2m1064\u001b[0m |       let basePrice = totalWeight * 18; // 18 —Ä—É–± –∑–∞ –∫–≥ –¥–ª—è –ü–≠–ö\n \u001b[2m1065\u001b[0m |       \n \u001b[2m1066\u001b[0m |       if (form.fromAddressDelivery) basePrice += 600;\n \u001b[2m1067\u001b[0m |       if (form.toAddressDelivery) basePrice += 600;\n \u001b[2m1068\u001b[0m |       if (form.needInsurance && form.declaredValue > 0) basePrice += form.declaredValue * 0.012;\n \u001b[2m1069\u001b[0m |       if (form.needPackaging) basePrice += totalWeight * 25;\n \u001b[2m1070\u001b[0m |       if (form.needCarry) basePrice += 500;\n \u001b[2m1071\u001b[0m |       \n \u001b[2m1072\u001b[0m |       return {\n \u001b[2m1073\u001b[0m |         company: '–ü–≠–ö',\n \u001b[2m1074\u001b[0m |         price: Math.round(basePrice),\n \u001b[2m1075\u001b[0m |         days: 3,\n \u001b[2m1076\u001b[0m |         details: {\n \u001b[2m1077\u001b[0m |           note: '–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º –ü–≠–ö (–æ—à–∏–±–∫–∞ API)',\n \u001b[2m1078\u001b[0m |           services: [\n \u001b[2m1079\u001b[0m |             {\n \u001b[2m1080\u001b[0m |               name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n \u001b[2m1081\u001b[0m |               description: `${form.fromCity} - ${form.toCity}`,\n \u001b[2m1082\u001b[0m |               price: Math.round(basePrice)\n \u001b[2m1083\u001b[0m |             }\n \u001b[2m1084\u001b[0m |           ]\n \u001b[2m1085\u001b[0m |         },\n \u001b[2m1086\u001b[0m |         requestData: null,\n \u001b[2m1087\u001b[0m |         responseData: null,\n \u001b[2m1088\u001b[0m |         apiUrl,\n \u001b[2m1089\u001b[0m |         error: `–û—à–∏–±–∫–∞ API –ü–≠–ö: ${error.message}. –ü–æ–∫–∞–∑–∞–Ω –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç.`\n \u001b[2m1090\u001b[0m |       };\n \u001b[2m1091\u001b[0m |     }\n \u001b[2m1092\u001b[0m |   };\n \u001b[2m1093\u001b[0m | \n \u001b[2m1094\u001b[0m |   // –ü–æ–ª—É—á–µ–Ω–∏–µ ID —Å–∫–ª–∞–¥–∞ –ü–≠–ö –ø–æ –∞–¥—Ä–µ—Å—É —á–µ—Ä–µ–∑ API\n \u001b[2m1095\u001b[0m |   const findPekWarehouseId = async (address: string): Promise<string | null> => {\n \u001b[2m1096\u001b[0m |     try {\n \u001b[2m1097\u001b[0m |       // –ò—Å–ø–æ–ª—å–∑—É–µ–º API –ü–≠–ö –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–∫–ª–∞–¥–∞ –ø–æ –∞–¥—Ä–µ—Å—É\n \u001b[2m1098\u001b[0m |       const response = await fetch('https://api.pecom.ru/v1/branches/findzonebyaddress', {\n \u001b[2m1099\u001b[0m |         method: 'POST',\n \u001b[2m1100\u001b[0m |         headers: {\n \u001b[2m1101\u001b[0m |           'Content-Type': 'application/json',\n \u001b[2m1102\u001b[0m |           'Authorization': 'Basic ' + btoa('C04C5BF2AE367BDCBDC71E7DA520A69B167D1984:')\n \u001b[2m1103\u001b[0m |         },\n \u001b[2m1104\u001b[0m |         body: JSON.stringify({\n \u001b[2m1105\u001b[0m |           address: address\n \u001b[2m1106\u001b[0m |         })\n \u001b[2m1107\u001b[0m |       });\n \u001b[2m1108\u001b[0m | \n \u001b[2m1109\u001b[0m |       if (response.ok) {\n \u001b[2m1110\u001b[0m |         const data = await response.json();\n \u001b[2m1111\u001b[0m |         return data.mainWarehouseId || null;\n \u001b[2m1112\u001b[0m |       }\n \u001b[2m1113\u001b[0m |       \n \u001b[2m1114\u001b[0m |       // –§–æ–ª–ª–±—ç–∫ –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤\n \u001b[2m1115\u001b[0m |       const fallbackWarehouses: { [key: string]: string } = {\n \u001b[2m1116\u001b[0m |         '–º–æ—Å–∫–≤–∞': 'dc6c746d-812d-11e4-bbfc-001999d8b3c5',\n \u001b[2m1117\u001b[0m |         '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': 'b436c978-086d-11e6-b6ca-00155d668909',\n \u001b[2m1118\u001b[0m |         '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': '550e8400-e29b-41d4-a716-446655440000'\n \u001b[2m1119\u001b[0m |       };\n \u001b[2m1120\u001b[0m |       \n \u001b[2m1121\u001b[0m |       const normalizedCity = address.toLowerCase().trim()\n \u001b[2m1122\u001b[0m |         .replace(/—ë/g, '–µ')\n \u001b[2m1123\u001b[0m |         .replace(/[\\s\\-\\.]+/g, '');\n \u001b[2m1124\u001b[0m |       \n \u001b[2m1125\u001b[0m |       for (const [city, warehouseId] of Object.entries(fallbackWarehouses)) {\n \u001b[2m1126\u001b[0m |         const normalizedCityKey = city.replace(/[\\s\\-\\.]+/g, '');\n \u001b[2m1127\u001b[0m |         if (normalizedCity.includes(normalizedCityKey) || normalizedCityKey.includes(normalizedCity)) {\n \u001b[2m1128\u001b[0m |           return warehouseId;\n \u001b[2m1129\u001b[0m |         }\n \u001b[2m1130\u001b[0m |       }\n \u001b[2m1131\u001b[0m |       \n \u001b[2m1132\u001b[0m |       return null;\n \u001b[2m1133\u001b[0m |     } catch (error) {\n \u001b[2m1134\u001b[0m |       console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ —Å–∫–ª–∞–¥–∞ –ü–≠–ö:', error);\n \u001b[2m1135\u001b[0m |       return null;\n \u001b[2m1136\u001b[0m |     }\n \u001b[2m1137\u001b[0m |   };\n \u001b[2m1138\u001b[0m | \n \u001b[2m1139\u001b[0m |   // –†–∞—Å—á–µ—Ç –¥–ª—è –ü–≠–ö —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–π API\n \u001b[2m1140\u001b[0m |   const calculatePEK = async (): Promise<CalculationResult> => {\n      : \u001b[33;1m        ^^^^^^|^^^^^\u001b[0m\n      :               \u001b[33;1m`-- \u001b[33;1m`calculatePEK` redefined here\u001b[0m\u001b[0m\n \u001b[2m1141\u001b[0m |     const apiUrl = 'http://calc.pecom.ru/bitrix/components/pecom/calc/ajax.php';\n \u001b[2m1142\u001b[0m |     \n \u001b[2m1143\u001b[0m |     try {\n      `----\n\nImport trace for requested module:\n./app/page.tsx\n\n\n> Build failed because of webpack errors\n",
      "exit": 1,
      "description": "Build the project again to check for errors"
    },
    "title": "cd /home/user/project && npm run build",
    "time": {
      "start": 1758902852730,
      "end": 1758902855907
    }
  }
}