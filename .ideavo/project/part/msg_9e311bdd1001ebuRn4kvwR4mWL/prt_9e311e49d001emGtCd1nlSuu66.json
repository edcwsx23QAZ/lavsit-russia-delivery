{
  "id": "prt_9e311e49d001emGtCd1nlSuu66",
  "messageID": "msg_9e311bdd1001ebuRn4kvwR4mWL",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "write",
  "callID": "call_81555990",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "components/diagnostic/TestRunner.tsx",
      "content": "'use client';\n\nimport React, { useState, useCallback } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Play, CheckCircle, XCircle, Clock, Terminal } from 'lucide-react';\nimport { apiRequestWithTimeout } from '@/lib/api-utils';\n\ninterface TestResult {\n  testType: string;\n  success: boolean;\n  output: string | null;\n  errors: string | null;\n  executionTime: number;\n  timestamp: string;\n}\n\ninterface TestRunnerProps {\n  className?: string;\n}\n\nconst availableTests = [\n  {\n    id: 'dellin-api',\n    name: 'Dellin API Tests',\n    description: 'Test Dellin API endpoints and validation',\n    script: 'test-dellin-api.js'\n  },\n  {\n    id: 'performance',\n    name: 'Performance Tests',\n    description: 'Comprehensive performance testing and metrics',\n    script: 'performance-test.js'\n  },\n  {\n    id: 'dellin-derival',\n    name: 'Dellin Derival Tests',\n    description: 'Test derival error handling fixes',\n    script: 'test-dellin-derival.js'\n  },\n  {\n    id: 'dellin-terminals',\n    name: 'Dellin Terminals Tests',\n    description: 'Test terminal data processing',\n    script: 'test-dellin-terminals.js'\n  },\n  {\n    id: 'dellin-terminals-simple',\n    name: 'Simple Terminals Tests',\n    description: 'Simplified terminal testing',\n    script: 'test-dellin-terminals-simple.js'\n  },\n  {\n    id: 'spb-terminals',\n    name: 'SPB Terminals Tests',\n    description: 'Saint Petersburg terminals testing',\n    script: 'test-spb-terminals.js'\n  }\n];\n\nexport default function TestRunner({ className }: TestRunnerProps) {\n  const [runningTests, setRunningTests] = useState<Set<string>>(new Set());\n  const [testResults, setTestResults] = useState<Map<string, TestResult>>(new Map());\n  const [selectedTest, setSelectedTest] = useState<string | null>(null);\n\n  const runTest = useCallback(async (testId: string) => {\n    setRunningTests(prev => new Set(prev).add(testId));\n    setSelectedTest(testId);\n\n    try {\n      const response = await apiRequestWithTimeout('/api/run-tests', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ testType: testId })\n      }, { timeout: 35000 });\n\n      const result: TestResult = await response.json();\n      setTestResults(prev => new Map(prev).set(testId, result));\n    } catch (error: any) {\n      const errorResult: TestResult = {\n        testType: testId,\n        success: false,\n        output: null,\n        errors: error.message || 'Network error',\n        executionTime: 0,\n        timestamp: new Date().toISOString()\n      };\n      setTestResults(prev => new Map(prev).set(testId, errorResult));\n    } finally {\n      setRunningTests(prev => {\n        const newSet = new Set(prev);\n        newSet.delete(testId);\n        return newSet;\n      });\n    }\n  }, []);\n\n  const runAllTests = useCallback(async () => {\n    for (const test of availableTests) {\n      await runTest(test.id);\n      // Small delay between tests\n      await new Promise(resolve => setTimeout(resolve, 500));\n    }\n  }, [runTest]);\n\n  const getTestStatus = (testId: string) => {\n    if (runningTests.has(testId)) return 'running';\n    const result = testResults.get(testId);\n    if (!result) return 'idle';\n    return result.success ? 'success' : 'error';\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'running':\n        return <Clock className=\"h-4 w-4 animate-spin text-blue-500\" />;\n      case 'success':\n        return <CheckCircle className=\"h-4 w-4 text-green-500\" />;\n      case 'error':\n        return <XCircle className=\"h-4 w-4 text-red-500\" />;\n      default:\n        return <Terminal className=\"h-4 w-4 text-gray-400\" />;\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'running':\n        return <Badge variant=\"secondary\">Running</Badge>;\n      case 'success':\n        return <Badge variant=\"default\" className=\"bg-green-500\">Passed</Badge>;\n      case 'error':\n        return <Badge variant=\"destructive\">Failed</Badge>;\n      default:\n        return <Badge variant=\"outline\">Not Run</Badge>;\n    }\n  };\n\n  const selectedResult = selectedTest ? testResults.get(selectedTest) : null;\n\n  return (\n    <div className={`space-y-6 ${className}`}>\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Terminal className=\"h-5 w-5\" />\n            Test Runner\n          </CardTitle>\n          <CardDescription>\n            Run standalone test scripts and view results in real-time\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex gap-2 mb-4\">\n            <Button\n              onClick={runAllTests}\n              disabled={runningTests.size > 0}\n              className=\"flex items-center gap-2\"\n            >\n              <Play className=\"h-4 w-4\" />\n              Run All Tests\n            </Button>\n          </div>\n\n          <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n            {availableTests.map((test) => {\n              const status = getTestStatus(test.id);\n              const result = testResults.get(test.id);\n\n              return (\n                <Card key={test.id} className=\"cursor-pointer hover:shadow-md transition-shadow\">\n                  <CardHeader className=\"pb-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"text-sm\">{test.name}</CardTitle>\n                      {getStatusIcon(status)}\n                    </div>\n                    <CardDescription className=\"text-xs\">\n                      {test.description}\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"pt-0\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                      {getStatusBadge(status)}\n                      {result && (\n                        <span className=\"text-xs text-muted-foreground\">\n                          {result.executionTime}ms\n                        </span>\n                      )}\n                    </div>\n                    <Button\n                      size=\"sm\"\n                      variant={selectedTest === test.id ? \"default\" : \"outline\"}\n                      onClick={() => runTest(test.id)}\n                      disabled={runningTests.has(test.id)}\n                      className=\"w-full\"\n                    >\n                      {runningTests.has(test.id) ? 'Running...' : 'Run Test'}\n                    </Button>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        </CardContent>\n      </Card>\n\n      {selectedResult && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              {getStatusIcon(selectedResult.success ? 'success' : 'error')}\n              Test Results: {availableTests.find(t => t.id === selectedTest)?.name}\n            </CardTitle>\n            <CardDescription>\n              Executed at {new Date(selectedResult.timestamp).toLocaleString('ru-RU')} â€¢ {selectedResult.executionTime}ms\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ScrollArea className=\"h-96 w-full rounded-md border p-4\">\n              {selectedResult.output && (\n                <div className=\"mb-4\">\n                  <h4 className=\"font-semibold text-green-600 mb-2\">Output:</h4>\n                  <pre className=\"text-sm bg-green-50 p-3 rounded border overflow-x-auto\">\n                    {selectedResult.output}\n                  </pre>\n                </div>\n              )}\n\n              {selectedResult.errors && (\n                <div>\n                  <h4 className=\"font-semibold text-red-600 mb-2\">Errors:</h4>\n                  <pre className=\"text-sm bg-red-50 p-3 rounded border overflow-x-auto text-red-800\">\n                    {selectedResult.errors}\n                  </pre>\n                </div>\n              )}\n\n              {!selectedResult.output && !selectedResult.errors && (\n                <div className=\"text-center text-muted-foreground py-8\">\n                  No output generated\n                </div>\n              )}\n            </ScrollArea>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}"
    },
    "output": "",
    "metadata": {
      "diagnostics": {},
      "filepath": "/home/user/project/components/diagnostic/TestRunner.tsx",
      "exists": false
    },
    "title": "components/diagnostic/TestRunner.tsx",
    "time": {
      "start": 1760451224734,
      "end": 1760451224735
    }
  }
}