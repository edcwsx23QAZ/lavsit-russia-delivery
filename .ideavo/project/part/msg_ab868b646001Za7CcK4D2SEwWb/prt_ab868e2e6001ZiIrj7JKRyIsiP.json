{
  "id": "prt_ab868e2e6001ZiIrj7JKRyIsiP",
  "sessionID": "ses_54b97e247ffenCZZa4jZiIWD0l",
  "messageID": "msg_ab868b646001Za7CcK4D2SEwWb",
  "type": "tool",
  "callID": "call_07536434",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx",
      "offset": 3547
    },
    "output": "<file>\n03548|     const apiUrl = 'https://api.nordw.orog.ru/api/v1/calculate';\n03549| \n03550|     try {\n03551|       // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03552|       validateMultipleCargos(form.cargos);\n03553|       \n03554|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n03555|       const totalVolume = form.cargos.reduce((sum, cargo) => \n03556|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n03557|       );\n03558| \n03559|       // üîß –î–û–ë–ê–í–õ–ï–ù–û: –†–∞—Å—á–µ—Ç –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03560|       const maxLength = Math.max(...form.cargos.map(c => c.length));\n03561|       const maxWidth = Math.max(...form.cargos.map(c => c.width));\n03562|       const maxHeight = Math.max(...form.cargos.map(c => c.height));\n03563|       \n03564|       // üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03565|       console.log('üåê Nord Wheel: –ê–Ω–∞–ª–∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç:');\n03566|       console.log(`   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç: ${form.cargos.length}`);\n03567|       console.log(`   - –û–±—â–∏–π –≤–µ—Å: ${totalWeight} –∫–≥`);\n03568|       console.log(`   - –û–±—â–∏–π –æ–±—ä–µ–º: ${totalVolume.toFixed(3)} –º¬≥`);\n03569|       console.log(`   - –û—Ç–∫—É–¥–∞: ${form.fromCity} (${form.fromTerminal ? '—Ç–µ—Ä–º–∏–Ω–∞–ª' : '–∞–¥—Ä–µ—Å'})`);\n03570|       console.log(`   - –ö—É–¥–∞: ${form.toCity} (${form.toTerminal ? '—Ç–µ—Ä–º–∏–Ω–∞–ª' : '–∞–¥—Ä–µ—Å'})`);\n03571|       \n03572|       form.cargos.forEach((cargo, index) => {\n03573|         console.log(`   üì¶ –ú–µ—Å—Ç–æ ${index + 1}:`);\n03574|         console.log(`     - –ì–∞–±–∞—Ä–∏—Ç—ã: ${cargo.length}√ó${cargo.width}√ó${cargo.height} —Å–º`);\n03575|         console.log(`     - –í–µ—Å: ${cargo.weight} –∫–≥`);\n03576|         console.log(`     - –û–±—ä–µ–º: ${((cargo.length * cargo.width * cargo.height) / 1000000).toFixed(3)} –º¬≥`);\n03577|       });\n03578| \n03579|       if (form.cargos.length > 1) {\n03580|         console.log(`   üìê –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã: ${maxLength}√ó${maxWidth}√ó${maxHeight} —Å–º`);\n03581|       }\n03582| \n03583|       // üèôÔ∏è –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ª–æ–∫–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–æ—Ä–º—ã\n03584|       const getDispatchLocation = () => {\n03585|         if (form.fromTerminal) {\n03586|           return {\n03587|             type: 'terminal' as const,\n03588|             // –î–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≥–æ—Ä–æ–¥–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã\n03589|             terminal_id: form.fromCity.toLowerCase().includes('–º–æ—Å–∫–≤–∞') ? '0c7a2795-1220-486d-a7ce-8bcf130a1224' :\n03590|                         form.fromCity.toLowerCase().includes('—Å–∞–Ω–∫—Ç') || form.fromCity.toLowerCase().includes('—Å–ø–±') ? '3ca02b62-3632-4da0-8fde-de9d9c77c553' :\n03591|                         '0c7a2795-1220-486d-a7ce-8bcf130a1224', // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ú–æ—Å–∫–≤–∞\n03592|             city_fias: form.fromCity.toLowerCase().includes('–º–æ—Å–∫–≤–∞') ? '0c5b2444-70a0-4932-980c-b4dc0d3f02b5' :\n03593|                        form.fromCity.toLowerCase().includes('—Å–∞–Ω–∫—Ç') || form.fromCity.toLowerCase().includes('—Å–ø–±') ? 'c2deb16a-0330-4f05-821f-1d09c93331e6' :\n03594|                        '0c5b2444-70a0-4932-980c-b4dc0d3f02b5' // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ú–æ—Å–∫–≤–∞\n03595|           };\n03596|         } else {\n03597|           return {\n03598|             type: 'address' as const,\n03599|             address: form.fromAddress || form.fromCity // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥—Ä–µ—Å –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –≥–æ—Ä–æ–¥\n03600|           };\n03601|         }\n03602|       };\n03603| \n03604|       const getDestinationLocation = () => {\n03605|         if (form.toTerminal) {\n03606|           return {\n03607|             type: 'terminal' as const,\n03608|             // –î–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≥–æ—Ä–æ–¥–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã\n03609|             terminal_id: form.toCity.toLowerCase().includes('–º–æ—Å–∫–≤–∞') ? '0c7a2795-1220-486d-a7ce-8bcf130a1224' :\n03610|                         form.toCity.toLowerCase().includes('—Å–∞–Ω–∫—Ç') || form.toCity.toLowerCase().includes('—Å–ø–±') ? '3ca02b62-3632-4da0-8fde-de9d9c77c553' :\n03611|                         '3ca02b62-3632-4da0-8fde-de9d9c77c553', // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –°–ü–±\n03612|             city_fias: form.toCity.toLowerCase().includes('–º–æ—Å–∫–≤–∞') ? '0c5b2444-70a0-4932-980c-b4dc0d3f02b5' :\n03613|                        form.toCity.toLowerCase().includes('—Å–∞–Ω–∫—Ç') || form.toCity.toLowerCase().includes('—Å–ø–±') ? 'c2deb16a-0330-4f05-821f-1d09c93331e6' :\n03614|                        'c2deb16a-0330-4f05-821f-1d09c93331e6' // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –°–ü–±\n03615|           };\n03616|         } else {\n03617|           return {\n03618|             type: 'address' as const,\n03619|             address: form.toAddress || form.toCity // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥—Ä–µ—Å –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –≥–æ—Ä–æ–¥\n03620|           };\n03621|         }\n03622|       };\n03623| \n03624|       // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è –Ω–æ–≤–æ–≥–æ API NordWheel —Å —É—á–µ—Ç–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–æ—Ä–º—ã\n03625|       const requestData = {\n03626|         dispatch: {\n03627|           location: getDispatchLocation()\n03628|         },\n03629|         destination: {\n03630|           location: getDestinationLocation()\n03631|         },\n03632|         cargo: {\n03633|           total_weight: totalWeight,\n03634|           total_volume: totalVolume,\n03635|           total_quantity: form.cargos.length\n03636|         },\n03637|         insurance: form.needInsurance && form.declaredValue ? form.declaredValue : 0,\n03638|         insurance_refuse: !form.needInsurance,\n03639|         services: {\n03640|           is_package: form.needPackaging,\n03641|           is_documents_return: false,\n03642|           is_fragile: false\n03643|         },\n03644|         promocode: null\n03645|       };\n03646| \n03647|       console.log('üöõ Nord Wheel –Ω–æ–≤—ã–π API –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03648| \n03649|       const response = await fetch(apiUrl, {\n03650|         method: 'POST',\n03651|         headers: {\n03652|           'Content-Type': 'application/json',\n03653|           'Authorization': `Bearer ${process.env.NORDWHEEL_API_KEY}`\n03654|         },\n03655|         body: JSON.stringify(requestData)\n03656|       });\n03657| \n03658|       if (!response.ok) {\n03659|         console.error('‚ùå Nord Wheel API –æ—à–∏–±–∫–∞:', response.status, response.statusText);\n03660|         const errorDetails = response.status === 401 ? '–ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á' :\n03661|                             response.status === 400 ? '–ù–µ–≤–µ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å' :\n03662|                             response.status === 404 ? '–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω' :\n03663|                             response.status === 500 ? '–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' :\n03664|                             `–û—à–∏–±–∫–∞ API: ${response.status} ${response.statusText}`;\n03665|         \n03666|         return {\n03667|           company: 'Nord Wheel',\n03668|           price: 0,\n03669|           days: 0,\n03670|           error: errorDetails,\n03671|           apiUrl,\n03672|           requestData\n03673|         };\n03674|       }\n03675| \n03676|       const data = await response.json();\n03677|       console.log('üöõ Nord Wheel API –æ—Ç–≤–µ—Ç:', data);\n03678| \n03679|       // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ API - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã\n03680|       let price = 0;\n03681|       let days = 0;\n03682|       let details: any = {};\n03683| \n03684|       if (data.success) {\n03685|         // –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç API\n03686|         price = data.price || data.total_cost || data.cost || 0;\n03687|         days = data.days || data.delivery_days || data.delivery_time || 0;\n03688|         details = {\n03689|           totalCost: price,\n03690|           deliveryCost: data.delivery_cost || 0,\n03691|           pickupCost: data.pickup_cost || 0,\n03692|           insuranceCost: data.insurance_cost || 0,\n03693|           services: data.services || [],\n03694|           currency: data.currency || 'RUB'\n03695|         };\n03696|       } else if (data.price !== undefined) {\n03697|         // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞\n03698|         price = data.price;\n03699|         days = data.days || data.delivery_time || 0;\n03700|         details = {\n03701|           totalCost: price,\n03702|           currency: data.currency || 'RUB'\n03703|         };\n03704|       } else {\n03705|         // –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ü–µ–Ω—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É\n03706|         console.error('‚ùå Nord Wheel: –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API:', data);\n03707|         return {\n03708|           company: 'Nord Wheel',\n03709|           price: 0,\n03710|           days: 0,\n03711|           error: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API',\n03712|           apiUrl,\n03713|           requestData,\n03714|           responseData: data\n03715|         };\n03716|       }\n03717| \n03718|       return {\n03719|         company: 'Nord Wheel',\n03720|         price: Math.round(price),\n03721|         days: days,\n03722|         details,\n03723|         requestData,\n03724|         responseData: data,\n03725|         apiUrl\n03726|       };\n03727|     } catch (error: any) {\n03728|       console.error('üöõ Nord Wheel –æ—à–∏–±–∫–∞:', error);\n03729|       return {\n03730|         company: 'Nord Wheel',\n03731|         price: 0,\n03732|         days: 0,\n03733|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03734|         apiUrl\n03735|       };\n03736|     }\n03737|   };\n03738|     const calculateCdek = async (): Promise<CalculationResult> => {\n03739|     const apiUrl = '/api/cdek';\n03740|     \n03741|     try {\n03742|       validateMultipleCargos(form.cargos);\n03743|       \n03744|       const packages = form.cargos.map(cargo => ({\n03745|         height: cargo.height,\n03746|         length: cargo.length,\n03747|         width: cargo.width,\n03748|         weight: cargo.weight * 1000\n03749|       }));\n03750| \n03751|       const requestData: any = {\n03752|         from_city: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n03753|         to_city: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n03754|         packages: packages\n03755|       };\n03756| \n03757|       if (form.needInsurance && form.declaredValue > 0) {\n03758|         requestData.services = [{\n03759|           code: 'INSURANCE',\n03760|           parameter: form.declaredValue\n03761|         }];\n03762|         console.log('üì¶ CDEK: –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ', form.declaredValue);\n03763|       }\n03764| \n03765|       console.log('üì¶ CDEK –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03766|       console.log('üì¶ CDEK –º–∞—Ä—à—Ä—É—Ç:', {\n03767|         fromAddressDelivery: form.fromAddressDelivery,\n03768|         fromLavsiteWarehouse: form.fromLavsiteWarehouse,\n03769|         toAddressDelivery: form.toAddressDelivery\n03770|       });\n03771| \n03772|        const result = await enhancedApiRequest(\n03773|          apiUrl,\n03774|          {\n03775|            method: 'POST',\n03776|            headers: {\n03777|              'Content-Type': 'application/json',\n03778|            },\n03779|            body: JSON.stringify(requestData)\n03780|          },\n03781|          { operation: 'calculate', company: '–°–î–≠–ö' }\n03782|        );\n03783| \n03784|        if (result && typeof result === 'object' && 'success' in result && !result.success) {\n03785|          console.error('‚ùå –°–î–≠–ö API –æ—à–∏–±–∫–∞:', result.error);\n03786|          return {\n03787|            company: '–°–î–≠–ö',\n03788|            price: 0,\n03789|            days: 0,\n03790|            error: result.error.userMessage || result.error.message,\n03791|            requestData,\n03792|            responseData: null,\n03793|            apiUrl\n03794|          };\n03795|        }\n03796| \n03797|        const response = result as Response;\n03798|        const data = await response.json();\n03799|        console.log('üì¶ CDEK –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω, —Ç–∞—Ä–∏—Ñ–æ–≤:', data.tariff_codes?.length || 0);\n03800| \n03801|       if (response.ok && data.tariff_codes && data.tariff_codes.length > 0) {\n03802|         const isFromDoor = form.fromAddressDelivery || form.fromLavsiteWarehouse;\n03803|         const isToDoor = form.toAddressDelivery;\n03804|         \n03805|         let deliveryMode: number;\n03806|         let deliveryModeText: string;\n03807|         \n03808|         if (isFromDoor && isToDoor) {\n03809|           deliveryMode = 1;\n03810|           deliveryModeText = '–¥–≤–µ—Ä—å-–¥–≤–µ—Ä—å';\n03811|         } else if (isFromDoor && !isToDoor) {\n03812|           deliveryMode = 2;\n03813|           deliveryModeText = '–¥–≤–µ—Ä—å-—Å–∫–ª–∞–¥';\n03814|         } else if (!isFromDoor && isToDoor) {\n03815|           deliveryMode = 3;\n03816|           deliveryModeText = '—Å–∫–ª–∞–¥-–¥–≤–µ—Ä—å';\n03817|         } else {\n03818|           deliveryMode = 4;\n03819|           deliveryModeText = '—Å–∫–ª–∞–¥-—Å–∫–ª–∞–¥';\n03820|         }\n03821| \n03822|         console.log(`üì¶ CDEK –≤—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º –¥–æ—Å—Ç–∞–≤–∫–∏: ${deliveryMode} (${deliveryModeText})`);\n03823| \n03824|         const filteredTariffs = data.tariff_codes.filter((t: any) => t.delivery_mode === deliveryMode);\n03825|         \n03826|         console.log(`üì¶ CDEK –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è —Ä–µ–∂–∏–º–∞ ${deliveryModeText}:`, filteredTariffs.length);\n03827| \n03828|         if (filteredTariffs.length === 0) {\n03829|           return {\n03830|             company: '–°–î–≠–ö',\n03831|             price: 0,\n03832|             days: 0,\n03833|             error: `–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∞ ${deliveryModeText}`,\n03834|             requestData,\n03835|             responseData: data,\n03836|             apiUrl\n03837|           };\n03838|         }\n03839| \n03840|         const bestTariff = filteredTariffs.reduce((min: any, tariff: any) => \n03841|           (tariff.delivery_sum < min.delivery_sum) ? tariff : min\n03842|         );\n03843| \n03844|         console.log(`üì¶ CDEK –ª—É—á—à–∏–π —Ç–∞—Ä–∏—Ñ: ${bestTariff.tariff_name} - ${bestTariff.delivery_sum}‚ÇΩ`);\n03845| \n03846|         const detailsRequest: any = {\n03847|           ...requestData,\n03848|           tariff_code: bestTariff.tariff_code,\n03849|           get_details: true\n03850|         };\n03851| \n03852|         console.log('üì¶ CDEK: –∑–∞–ø—Ä–æ—Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏...');\n03853| \n03854|           const detailsResult = await enhancedApiRequest(\n03855|             apiUrl,\n03856|             {\n03857|               method: 'POST',\n03858|               headers: {\n03859|                 'Content-Type': 'application/json',\n03860|               },\n03861|               body: JSON.stringify(detailsRequest)\n03862|             },\n03863|             { operation: 'tariff_details', company: '–°–î–≠–ö' }\n03864|           );\n03865| \n03866|           let tariffDetails: any = null;\n03867|           if (detailsResult && typeof detailsResult === 'object' && 'success' in detailsResult && detailsResult.success) {\n03868|             const detailsResponse = detailsResult as Response;\n03869|             if (detailsResponse.ok) {\n03870|               const detailsData = await detailsResponse.json();\n03871|               tariffDetails = detailsData.tariff_details;\n03872|               console.log('üì¶ –°–î–≠–ö –¥–µ—Ç–∞–ª–∏ —Ç–∞—Ä–∏—Ñ–∞:', tariffDetails);\n03873|             }\n03874|           }\n03875| \n03876|         const finalPrice = tariffDetails?.total_sum || bestTariff.delivery_sum;\n03877|         \n03878|         return {\n03879|           company: '–°–î–≠–ö',\n03880|           price: Math.round(finalPrice),\n03881|           days: bestTariff.period_max || 0,\n03882|           details: {\n03883|             tariff_name: bestTariff.tariff_name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n03884|             tariff_code: bestTariff.tariff_code,\n03885|             delivery_mode: deliveryModeText,\n03886|             period_min: bestTariff.period_min,\n03887|             period_max: bestTariff.period_max,\n03888|             calendar_min: bestTariff.calendar_min,\n03889|             calendar_max: bestTariff.calendar_max,\n03890|             all_tariffs: filteredTariffs,\n03891|             services: tariffDetails?.services || [],\n03892|             delivery_sum: tariffDetails?.delivery_sum || bestTariff.delivery_sum,\n03893|             total_sum: finalPrice,\n03894|             weight_calc: tariffDetails?.weight_calc\n03895|           },\n03896|           requestData,\n03897|           responseData: data,\n03898|           apiUrl\n03899|         };\n03900|       } else {\n03901|         return {\n03902|           company: '–°–î–≠–ö',\n03903|           price: 0,\n03904|           days: 0,\n03905|           error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –°–î–≠–ö',\n03906|           requestData,\n03907|           responseData: data,\n03908|           apiUrl\n03909|         };\n03910|       }\n03911|     } catch (error: any) {\n03912|       console.error('üì¶ –°–î–≠–ö –æ—à–∏–±–∫–∞:', error);\n03913|       return {\n03914|         company: '–°–î–≠–ö',\n03915|         price: 0,\n03916|         days: 0,\n03917|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03918|         apiUrl\n03919|       };\n03920|     }\n03921|   };\n03922| \n03923|   const calculateKit = async (): Promise<CalculationResult> => {\n03924|     const apiUrl = '/api/kit';\n03925|     \n03926|     try {\n03927|       validateMultipleCargos(form.cargos);\n03928|       \n03929|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n03930| \n03931|       const requestData = {\n03932|         from_city: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n03933|         to_city: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n03934|         declared_price: form.declaredValue || 10000,\n03935|         service: ['S089']\n03936|       };\n03937| \n03938|       console.log('üöõ –ö–ò–¢ –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03939| \n03940|        const result = await enhancedApiRequest(\n03941|          apiUrl,\n03942|          {\n03943|            method: 'POST',\n03944|            headers: {\n03945|              'Content-Type': 'application/json',\n03946|            },\n03947|            body: JSON.stringify(requestData)\n03948|          },\n03949|          { operation: 'calculate', company: '–ö–ò–¢' }\n03950|        );\n03951| \n03952|        if (result && typeof result === 'object' && 'success' in result && !result.success) {\n03953|          console.error('‚ùå –ö–ò–¢ API –æ—à–∏–±–∫–∞:', result.error);\n03954|          return {\n03955|            company: '–ö–ò–¢',\n03956|            price: 0,\n03957|            days: 0,\n03958|            error: result.error.userMessage || result.error.message,\n03959|            requestData,\n03960|            responseData: null,\n03961|            apiUrl\n03962|          };\n03963|        }\n03964| \n03965|        const response = result as Response;\n03966|        const data = await response.json();\n03967|        console.log('üöõ –ö–ò–¢ –æ—Ç–≤–µ—Ç:', data);\n03968| \n03969|       if (response.ok && Array.isArray(data) && data.length > 0) {\n03970|         const rubData = data.find((item: any) => {\n03971|           const tariffData: any = Object.values(item)[0];\n03972|           return tariffData?.currency_code === 'RUB';\n03973|         });\n03974|         \n03975|         if (rubData) {\n03976|           const tariffKey = Object.keys(rubData)[0];\n03977|           const tariffData: any = rubData[tariffKey];\n03978|           \n03979|           console.log('üöõ –ö–ò–¢ –≤—ã–±—Ä–∞–Ω —Ç–∞—Ä–∏—Ñ:', tariffKey, tariffData);\n03980| \n03981|           return {\n03982|             company: '–ö–ò–¢',\n03983|             price: Math.round(tariffData.cost || 0),\n03984|             days: tariffData.time || 0,\n03985|             details: {\n03986|               tariff_name: tariffData.name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n03987|               tariff_type: tariffKey,\n03988|               services: tariffData.detail || [],\n03989|               currency: tariffData.currency_code\n03990|             },\n03991|             requestData,\n03992|             responseData: data,\n03993|             apiUrl\n03994|           };\n03995|         }\n03996|       }\n03997| \n03998|       return {\n03999|         company: '–ö–ò–¢',\n04000|         price: 0,\n04001|         days: 0,\n04002|         error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –ö–ò–¢',\n04003|         requestData,\n04004|         responseData: data,\n04005|         apiUrl\n04006|       };\n04007|     } catch (error: any) {\n04008|       console.error('üöõ –ö–ò–¢ –æ—à–∏–±–∫–∞:', error);\n04009|       return {\n04010|         company: '–ö–ò–¢',\n04011|         price: 0,\n04012|         days: 0,\n04013|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n04014|         apiUrl\n04015|       };\n04016|     }\n04017|   };\n04018| \n04019|   const handleCalculate = async () => {\n04020|     const totalStartTime = performance.now();\n04021|     setCalculating(true);\n04022|     setCalculations([]);\n04023|     \n04024|     // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø–æ—Å–ª–µ —Ä–∞—Å—á–µ—Ç–∞ (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ, –±–µ–∑ –¥–µ–±–∞—É–Ω—Å–∞)\n04025|     saveFormData({\n04026|       cargos: form.cargos,\n04027|       fromCity: form.fromCity,\n04028|       toCity: form.toCity,\n04029|       fromAddress: form.fromAddress,\n04030|       toAddress: form.toAddress,\n04031|       declaredValue: form.declaredValue,\n04032|       needPackaging: form.needPackaging,\n04033|       needLoading: form.needLoading,\n04034|       needCarry: form.needCarry,\n04035|       floor: form.floor,\n04036|       hasFreightLift: form.hasFreightLift,\n04037|       needInsurance: form.needInsurance,\n04038|       fromTerminal: form.fromTerminal,\n04039|       toTerminal: form.toTerminal,\n04040|       fromAddressDelivery: form.fromAddressDelivery,\n04041|       toAddressDelivery: form.toAddressDelivery,\n04042|       selectedProducts: form.selectedProducts,\n04043|     });\n04044|     \n04045|     try {\n04046|       console.log('üöÄ === –ù–ê–ß–ê–õ–û –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–û–ì–û –†–ê–°–ß–ï–¢–ê ===');\n04047|       \n04048|       // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞\n04049|       const { optimizedApiClient } = await import('@/lib/optimized-api-client');\n04050|       const { cacheManager } = await import('@/lib/cache-manager');\n04051|       \n04052|       // 1. –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–µ—Å—Å–∏–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ\n04053|       const preloadStartTime = performance.now();\n04054|       await optimizedApiClient.preloadCalculationData(form);\n04055|       const preloadDuration = performance.now() - preloadStartTime;\n04056|       console.log(`‚ö° –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∑–∞ ${preloadDuration.toFixed(0)}–º—Å`);\n04057|       \n04058|       // 2. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∫–ª—é—á–µ–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏\n04059|       const enabledCompaniesList: Array<{ name: string; key: string; func: () => Promise<CalculationResult> }> = [];\n04060|       \n04061|       if (enabledCompanies.pek) enabledCompaniesList.push({ name: '–ü–≠–ö', key: 'pek', func: calculatePEK });\n04062|       if (enabledCompanies.dellin) enabledCompaniesList.push({ name: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏', key: 'dellin', func: calculateDellin });\n04063|       if (enabledCompanies.railcontinent) enabledCompaniesList.push({ name: 'Rail Continent', key: 'railcontinent', func: calculateRailContinent });\n04064|       if (enabledCompanies.vozovoz) enabledCompaniesList.push({ name: '–í–æ–∑–æ–≤–æ–∑', key: 'vozovoz', func: calculateVozovoz });\n04065|       if (enabledCompanies.nordwheel) enabledCompaniesList.push({ name: 'Nord Wheel', key: 'nordwheel', func: calculateNordWheel });\n04066|       if (enabledCompanies.cdek) enabledCompaniesList.push({ name: '–°–¥—ç–∫', key: 'cdek', func: calculateCdek });\n04067|       if (enabledCompanies.kit) enabledCompaniesList.push({ name: '–ö–∏—Ç', key: 'kit', func: calculateKit });\n04068|       \n04069|       // –ï—Å–ª–∏ –Ω–∏ –æ–¥–Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞\n04070|       if (enabledCompaniesList.length === 0) {\n04071|         setCalculations([]);\n04072|         return;\n04073|       }\n04074|       \n04075|       console.log(`üìã –ó–∞–ø—É—Å–∫ —Ä–∞—Å—á–µ—Ç–æ–≤ –¥–ª—è ${enabledCompaniesList.length} –∫–æ–º–ø–∞–Ω–∏–π:`, enabledCompaniesList.map(c => c.name));\n04076|       \n04077|       // 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞\n04078|       setCalculationProgress({\n04079|         companies: enabledCompaniesList.map(company => ({\n04080|           name: company.name,\n04081|           status: 'pending'\n04082|         })),\n04083|         totalDuration: 0\n04084|       });\n04085|       \n04086|       // 4. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ä–∞—Å—á–µ—Ç–æ–≤ —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞\n04087|       const calculationStartTime = performance.now();\n04088|       const calculationPromises = enabledCompaniesList.map(async (company, index) => {\n04089|         const companyStartTime = performance.now();\n04090|         \n04091|         // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ \"loading\"\n04092|         setCalculationProgress(prev => ({\n04093|           ...prev,\n04094|           companies: prev.companies.map((c, i) => \n04095|             i === index ? { ...c, status: 'loading', progress: 0 } : c\n04096|           )\n04097|         }));\n04098|         \n04099|         try {\n04100|           const result = await optimizedApiClient.calculateWithCache(\n04101|             company.key,\n04102|             company.func,\n04103|             form\n04104|           );\n04105|           \n04106|           const duration = performance.now() - companyStartTime;\n04107|           \n04108|           // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ \"completed\"\n04109|           setCalculationProgress(prev => ({\n04110|             ...prev,\n04111|             companies: prev.companies.map((c, i) => \n04112|               i === index ? { \n04113|                 ...c, \n04114|                 status: 'completed', \n04115|                 progress: 100, \n04116|                 duration \n04117|               } : c\n04118|             )\n04119|           }));\n04120|           \n04121|           return result;\n04122|         } catch (error) {\n04123|           const duration = performance.now() - companyStartTime;\n04124|           const errorMessage = error instanceof Error ? error.message : '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞';\n04125|           \n04126|           // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ \"error\"\n04127|           setCalculationProgress(prev => ({\n04128|             ...prev,\n04129|             companies: prev.companies.map((c, i) => \n04130|               i === index ? { \n04131|                 ...c, \n04132|                 status: 'error', \n04133|                 error: errorMessage,\n04134|                 duration \n04135|               } : c\n04136|             )\n04137|           }));\n04138|           \n04139|           console.error(`‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ ${company.name}:`, error);\n04140|           return {\n04141|             company: company.name,\n04142|             price: 0,\n04143|             days: 0,\n04144|             error: errorMessage,\n04145|             duration\n04146|           };\n04147|         }\n04148|       });\n04149|       \n04150|       const results = await Promise.allSettled(calculationPromises);\n04151|       const calculationDuration = performance.now() - calculationStartTime;\n04152|       \n04153|       // 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤\n04154|       const validResults: CalculationResult[] = [];\n04155|       const errors: string[] = [];\n04156|       \n04157|       results.forEach((result, index) => {\n04158|         if (result.status === 'fulfilled') {\n04159|           validResults.push(result.value);\n04160|         } else {\n04161|           const companyName = enabledCompaniesList[index].name;\n04162|           errors.push(`${companyName}: ${result.reason}`);\n04163|           console.error(`‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ ${companyName}:`, result.reason);\n04164|         }\n04165|       });\n04166|       \n04167|       // 5. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤\n04168|       const sortedResults = validResults\n04169|         .filter(result => !result.error)\n04170|         .sort((a, b) => a.price - b.price)\n04171|         .concat(validResults.filter(result => result.error));\n04172|       \n04173|       // 6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n04174|       const totalDuration = performance.now() - totalStartTime;\n04175|       const successCount = sortedResults.filter(r => !r.error).length;\n04176|       const cacheStats = cacheManager.getCacheStats();\n04177|       \n04178|       console.log(`‚úÖ === –†–ê–°–ß–ï–¢ –ó–ê–í–ï–†–®–ï–ù ===`);\n04179|       console.log(`‚è±Ô∏è –û–±—â–µ–µ –≤—Ä–µ–º—è: ${totalDuration.toFixed(0)}–º—Å`);\n04180|       console.log(`‚ö° –†–∞—Å—á–µ—Ç—ã: ${calculationDuration.toFixed(0)}–º—Å`);\n04181|       console.log(`üìä –£—Å–ø–µ—à–Ω–æ: ${successCount}/${enabledCompaniesList.length}`);\n04182|       console.log(`üíæ –ö—ç—à: —Å–µ—Å—Å–∏–π=${cacheStats.sessions}, —Ä–∞—Å—á–µ—Ç–æ–≤=${cacheStats.calculations}`);\n04183|       \n04184|       if (errors.length > 0) {\n04185|         console.warn(`‚ö†Ô∏è –û—à–∏–±–∫–∏: ${errors.join('; ')}`);\n04186|       }\n04187|       \n04188|       // –§–∏–Ω–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞\n04189|       setCalculationProgress(prev => ({\n04190|         ...prev,\n04191|         totalDuration: totalDuration\n04192|       }));\n04193|       \n04194|       setCalculations(sortedResults);\n04195|       \n04196|     } catch (error) {\n04197|       console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ:', error);\n04198|       setCalculations([{\n04199|         company: '–°–∏—Å—Ç–µ–º–∞',\n04200|         price: 0,\n04201|         days: 0,\n04202|         error: error instanceof Error ? error.message : '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞'\n04203|       }]);\n04204|     } finally {\n04205|       setCalculating(false);\n04206|     }\n04207|   };\n04208| \n04209|   const exportToPDF = () => {\n04210|     if (typeof window !== 'undefined') {\n04211|       // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Å–µ –¥–µ—Ç–∞–ª–∏ –ø–µ—Ä–µ–¥ –ø–µ—á–∞—Ç—å—é\n04212|       const allExpanded = calculations.reduce((acc, calc) => {\n04213|         acc[calc.company] = true;\n04214|         return acc;\n04215|       }, {} as { [key: string]: boolean });\n04216|       \n04217|       setExpandedDetails(allExpanded);\n04218|       \n04219|       // –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DOM\n04220|       setTimeout(() => {\n04221|         window.print();\n04222|       }, 100);\n04223|     }\n04224|   };\n04225| \n04226|   const toggleDetails = (company: string) => {\n04227|     setExpandedDetails(prev => ({\n04228|       ...prev,\n04229|       [company]: !prev[company]\n04230|     }));\n04231|   };\n04232| \n04233|   const toggleDebugInfo = (company: string) => {\n04234|     setExpandedDebugInfo(prev => ({\n04235|       ...prev,\n04236|       [company]: !prev[company]\n04237|     }));\n04238|   };\n04239| \n04240|   // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞—Å—á–µ—Ç–∞\n04241|   const handleReset = () => {\n04242|     if (typeof window !== 'undefined') {\n04243|       // –û—á–∏—â–∞–µ–º localStorage\n04244|       localStorage.removeItem('deliveryForm');\n04245|       \n04246|       // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É\n04247|       setForm(initialFormState);\n04248|       \n04249|       // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è\n04250|       setCalculations([]);\n04251|       setExpandedDetails({});\n04252|       setExpandedDebugInfo({});\n04253|       setSuggestions([]);\n04254|       setShowSuggestions(false);\n04255|       setActiveField('');\n04256|       \n04257|       console.log('–§–æ—Ä–º–∞ —Å–±—Ä–æ—à–µ–Ω–∞ –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é');\n04258|     }\n04259|   };\n04260| \n04261|   // –ü–∞—Ä—Å–µ—Ä –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è —á–∏—Ç–∞–µ–º–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞\n04262|   const parseCalculationDetails = (calc: CalculationResult) => {\n04263|     console.log('üîç parseCalculationDetails –ø–æ–ª—É—á–∏–ª calc:', calc?.company || 'undefined');\n04264|     console.log('üîç calc.details:', calc?.details ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n04265|     console.log('üîç typeof calc.details:', typeof calc?.details);\n04266|     \n04267|     const details: { service: string; description: string; price: number }[] = [];\n04268|     \n04269|     try {\n04270|       if (calc.company === '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏' && calc.details) {\n04271|         console.log('üîç –ù–∞—á–∏–Ω–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–µ—Ç–∞–ª–µ–π –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π...');\n04272|       // –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ (—É–∂–µ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –±–∞–∑–æ–≤—ã–µ —É—Å–ª—É–≥–∏ –∏ —É–ø–∞–∫–æ–≤–∫—É)\n04273|       let basePrice = calc.details?.price || calc.price || 0;\n04274|       \n04275|       // –†–∞–∑–±–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ\n04276|       let intercityPrice = 0;\n04277|       let derivalPrice = 0;\n04278|       let arrivalPrice = 0;\n04279|       let packagingPrice = 0;\n04280|       // packagingPremiums –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è - –Ω–∞–¥–±–∞–≤–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ pkg.price\n04281|       let insurancePrice = 0;\n04282|       \n04283|       // –ú–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞\n04284|       if (calc.details?.intercity?.price) {\n04285|         intercityPrice = calc.details.intercity.price;\n04286|         details.push({\n04287|           service: '–ú–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞',\n04288|           description: `${form.fromCity} - ${form.toCity}`,\n04289|           price: intercityPrice\n04290|         });\n04291|       }\n04292|       \n04293|       // –ó–∞–±–æ—Ä –≥—Ä—É–∑–∞\n04294|       if (calc.details?.derival?.price) {\n04295|         derivalPrice = calc.details.derival.price;\n04296|         details.push({\n04297|           service: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n04298|           description: '–û—Ç –∞–¥—Ä–µ—Å–∞',\n04299|           price: derivalPrice\n04300|         });\n04301|       }\n04302|       \n04303|       // –î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞\n04304|       if (calc.details?.arrival?.price) {\n04305|         arrivalPrice = calc.details.arrival.price;\n04306|         details.push({\n04307|           service: '–û—Ç–≤–æ–∑ –≥—Ä—É–∑–∞',\n04308|           description: '–î–æ –∞–¥—Ä–µ—Å–∞',\n04309|           price: arrivalPrice\n04310|         });\n04311|       }\n04312|       \n04313|       // –£–ø–∞–∫–æ–≤–∫–∞ (–Ω–∞–¥–±–∞–≤–∫–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ pkg.price, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏)\n04314|       if (form.needPackaging && calc.details?.packages) {\n04315|         Object.entries(calc.details?.packages || {}).forEach(([key, pkg]: [string, any]) => {\n04316|           if (pkg.price && pkg.price > 0) {\n04317|             // –í—ã—á–∏—Å–ª—è–µ–º –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É —É–ø–∞–∫–æ–≤–∫–∏ (–±–µ–∑ –Ω–∞–¥–±–∞–≤–æ–∫) –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n04318|             let basePkgPrice = pkg.price;\n04319|             let totalPremiums = 0;\n04320|             \n04321|             if (pkg.premiumDetails && Array.isArray(pkg.premiumDetails)) {\n04322|               totalPremiums = pkg.premiumDetails.reduce((sum: number, premium: any) => \n04323|                 sum + (premium.value || 0), 0);\n04324|               basePkgPrice = pkg.price - totalPremiums;\n04325|             }\n04326|             \n04327|             packagingPrice += pkg.price; // –í –æ–±—â—É—é —Å—É–º–º—É –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–Ω—É—é —Ü–µ–Ω—É\n04328|             \n04329|             // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—É—é —É–ø–∞–∫–æ–≤–∫—É\n04330|             details.push({\n04331|               service: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n04332|               description: '–£–ø–∞–∫–æ–≤–∞—Ç—å –≤ –∫–æ–º–ø–ª–µ–∫—Å ¬´–æ–±—Ä–µ—à—ë—Ç–∫–∞ + –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è¬ª',\n04333|               price: basePkgPrice\n04334|             });\n04335|             \n04336|             // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–¥–±–∞–≤–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ (–¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏, –Ω–æ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –∫ –æ–±—â–µ–π —Å—É–º–º–µ)\n04337|             if (pkg.premiumDetails && Array.isArray(pkg.premiumDetails)) {\n04338|               pkg.premiumDetails.forEach((premium: any) => {\n04339|                 if (premium.value && premium.value > 0) {\n04340|                   details.push({\n04341|                     service: '–ù–∞–¥–±–∞–≤–∫–∞ –∫ —É–ø–∞–∫–æ–≤–∫–µ',\n04342|                     description: premium.name || '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–¥–±–∞–≤–∫–∞',\n04343|                     price: premium.value\n04344|                   });\n04345|                 }\n04346|               });\n04347|             }\n04348|           }\n04349|         });\n04350|       }\n04351|       \n04352|       // –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ\n04353|       if (form.needInsurance && calc.details?.insurance) {\n04354|         insurancePrice = calc.details.insurance;\n04355|         details.push({\n04356|           service: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n04357|           description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n04358|           price: insurancePrice\n04359|         });\n04360|       }\n04361|       \n04362|       // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏\n04363|       details.push({\n04364|         service: '–î–æ–ø.—É—Å–ª—É–≥–∏',\n04365|         description: '–ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ –≥—Ä—É–∑–∞',\n04366|         price: 15\n04367|       });\n04368|       \n04369|       // –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –º–µ–∂–¥—É —Å—É–º–º–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é, –¥–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞—Ç–æ–∫\n04370|       const calculatedSum = intercityPrice + derivalPrice + arrivalPrice + packagingPrice + insurancePrice + 15;\n04371|       const remainder = basePrice - calculatedSum;\n04372|       \n04373|       if (Math.abs(remainder) > 1) { // –ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –±–æ–ª—å—à–µ 1 —Ä—É–±–ª—è\n04374|         details.push({\n04375|           service: remainder > 0 ? '–ü—Ä–æ—á–∏–µ —É—Å–ª—É–≥–∏' : '–°–∫–∏–¥–∫–∞',\n04376|           description: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–±–æ—Ä—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏',\n04377|           price: remainder\n04378|         });\n04379|       }\n04380|     } else if (calc.company === 'Nord Wheel' && calc.details) {\n04381|       // –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –¥–ª—è Nord Wheel —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º\n04382|       if (calc.details.totalCost) {\n04383|         details.push({\n04384|           service: '–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',\n04385|           description: '',\n04386|           price: calc.details.totalCost\n04387|         });\n04388|       }\n04389|       if (calc.details.deliveryCost) {\n04390|         details.push({\n04391|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–∑–∫–∏',\n04392|           description: '',\n04393|           price: calc.details.deliveryCost\n04394|         });\n04395|       }\n04396|       if (calc.details.terminalCost) {\n04397|         details.push({\n04398|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –º–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–≤–æ–∑–∫–∏',\n04399|           description: '',\n04400|           price: calc.details.terminalCost\n04401|         });\n04402|       }\n04403|       if (calc.details.pickupCost) {\n04404|         details.push({\n04405|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–±–æ—Ä–∞',\n04406|           description: '',\n04407|           price: calc.details.pickupCost\n04408|         });\n04409|       }\n04410|       if (calc.details.deliveryToDoorCost) {\n04411|         details.push({\n04412|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–æ –¥–≤–µ—Ä–∏',\n04413|           description: '',\n04414|           price: calc.details.deliveryToDoorCost\n04415|         });\n04416|       }\n04417|       if (calc.details.additionalServices && calc.details.additionalServices > 0) {\n04418|         details.push({\n04419|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ–ø.—É—Å–ª—É–≥',\n04420|           description: '',\n04421|           price: calc.details.additionalServices\n04422|         });\n04423|       }\n04424| \n04425|     } else if (calc.company === '–ü–≠–ö' && calc.details?.services) {\n04426|       // –î–ª—è –ü–≠–ö –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ API\n04427|       calc.details.services.forEach((service: any) => {\n04428|         if (service.price > 0) {\n04429|           details.push({\n04430|             service: service.name || '–£—Å–ª—É–≥–∞ –ü–≠–ö',\n04431|             description: service.description || '',\n04432|             price: service.price\n04433|           });\n04434|         }\n04435|       });\n04436|     } else if (calc.company === '–°–î–≠–ö' && calc.details) {\n04437|       const cdekServiceNames: Record<string, string> = {\n04438|         'INSURANCE': '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n04439|         'HEAVY_CARGO': '–¢—è–∂–µ–ª–æ–≤–µ—Å–Ω—ã–π –≥—Ä—É–∑',\n04440|         'DELIVERY_TO_DOOR': '–î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –¥–≤–µ—Ä–∏',\n04441|         'PICKUP_FROM_SENDER': '–ó–∞–±–æ—Ä –æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è',\n04442|         'PACKAGE': '–£–ø–∞–∫–æ–≤–∫–∞',\n04443|         'TRYING_ON': '–ü—Ä–∏–º–µ—Ä–∫–∞ –Ω–∞ –¥–æ–º—É',\n04444|         'PART_DELIVERY': '–ß–∞—Å—Ç–∏—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞'\n04445|       };\n04446| \n04447|       if (calc.details.services && calc.details.services.length > 0) {\n04448|         calc.details.services.forEach((service: any) => {\n04449|           const serviceName = cdekServiceNames[service.code] || service.code || '–£—Å–ª—É–≥–∞ –°–î–≠–ö';\n04450|           const servicePrice = service.total_sum || service.sum || 0;\n04451|           \n04452|           if (servicePrice > 0) {\n04453|             details.push({\n04454|               service: serviceName,\n04455|               description: service.code === 'HEAVY_CARGO' \n04456|                 ? `–°–±–æ—Ä –∑–∞ –≥–∞–±–∞—Ä–∏—Ç–Ω—ã–π –≥—Ä—É–∑ (—Ä–∞—Å—á–µ—Ç–Ω—ã–π –≤–µ—Å: ${(calc.details.weight_calc / 1000).toFixed(0)} –∫–≥)`\n04457|                 : service.code === 'INSURANCE'\n04458|                 ? `–û–±—ä—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${form.declaredValue?.toLocaleString() || 0} ‚ÇΩ`\n04459|                 : '',\n04460|               price: servicePrice\n04461|             });\n04462|           }\n04463|         });\n04464|         \n04465|         if (calc.details.delivery_sum && calc.details.total_sum) {\n04466|           details.push({\n04467|             service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n04468|             description: '',\n04469|             price: 0\n04470|           });\n04471|           details.push({\n04472|             service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',\n04473|             description: calc.details.tariff_name || '–ü–µ—Ä–µ–≤–æ–∑–∫–∞',\n04474|             price: Math.round(calc.details.delivery_sum)\n04475|           });\n04476|           \n04477|           const additionalSum = calc.details.services.reduce((sum: number, s: any) => \n04478|             sum + (s.total_sum || s.sum || 0), 0\n04479|           );\n04480|           \n04481|           if (additionalSum > 0) {\n04482|             details.push({\n04483|               service: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏',\n04484|               description: '–î–æ–ø. —Å–±–æ—Ä—ã',\n04485|               price: Math.round(additionalSum)\n04486|             });\n04487|           }\n04488|           \n04489|           details.push({\n04490|             service: '–ò–¢–û–ì–û',\n04491|             description: '–ö –æ–ø–ª–∞—Ç–µ',\n04492|             price: Math.round(calc.details.total_sum)\n04493|           });\n04494|         }\n04495|       } else {\n04496|         details.push({\n04497|           service: '–¢–∞—Ä–∏—Ñ',\n04498|           description: calc.details.tariff_name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n04499|           price: calc.price\n04500|         });\n04501|         \n04502|         if (calc.details.delivery_mode) {\n04503|           details.push({\n04504|             service: '–†–µ–∂–∏–º –¥–æ—Å—Ç–∞–≤–∫–∏',\n04505|             description: calc.details.delivery_mode,\n04506|             price: 0\n04507|           });\n04508|         }\n04509|       }\n04510|       \n04511|       if (calc.details.period_min && calc.details.period_max) {\n04512|         details.push({\n04513|           service: '–°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏',\n04514|           description: `${calc.details.period_min}-${calc.details.period_max} –¥–Ω–µ–π`,\n04515|           price: 0\n04516|         });\n04517|       }\n04518|       \n04519|       if (calc.details.weight_calc) {\n04520|         details.push({\n04521|           service: '–†–∞—Å—á–µ—Ç–Ω—ã–π –≤–µ—Å',\n04522|           description: `${calc.details.weight_calc} –∫–≥`,\n04523|           price: 0\n04524|         });\n04525|       }\n04526|     } else if (calc.company === '–í–æ–∑–æ–≤–æ–∑' && calc.details?.service) {\n04527|       // ‚úÖ –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –í–æ–∑–æ–≤–æ–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ API –æ—Ç–≤–µ—Ç–∞\n04528|       const basePrice = calc.details.basePrice || 0;\n04529|       const finalPrice = calc.details.price || calc.price || 0;\n04530|       const totalDiscount = basePrice - finalPrice;\n04531|       \n04532|       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é —É—Å–ª—É–≥—É —Å –±–∞–∑–æ–≤–æ–π —Ü–µ–Ω–æ–π –∏ —Å–∫–∏–¥–∫–æ–π\n04533|       calc.details.service.forEach((service: any) => {\n04534|         const serviceDiscount = (service.basePrice || 0) - (service.price || 0);\n04535|         \n04536|         // –û—Å–Ω–æ–≤–Ω–∞—è —É—Å–ª—É–≥–∞\n04537|         details.push({\n04538|           service: service.name || '–£—Å–ª—É–≥–∞ –í–æ–∑–æ–≤–æ–∑',\n04539|           description: '',\n04540|           price: service.price || 0\n04541|         });\n04542|         \n04543|         // –°–∫–∏–¥–∫–∞ –Ω–∞ —É—Å–ª—É–≥—É (–µ—Å–ª–∏ –µ—Å—Ç—å)\n04544|         if (serviceDiscount > 0) {\n04545|           details.push({\n04546|             service: `–°–∫–∏–¥–∫–∞ –Ω–∞ ${service.name?.toLowerCase() || '—É—Å–ª—É–≥—É'}`,\n04547|             description: `${(service.basePrice || 0).toLocaleString()} - ${(service.price || 0).toLocaleString()}`,\n04548|             price: -serviceDiscount\n04549|           });\n04550|         }\n04551|       });\n04552|       \n04553|       // –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Å –æ–±—â–∏–º–∏ —Å–∫–∏–¥–∫–∞–º–∏\n04554|       if (totalDiscount > 0) {\n04555|         details.push({\n04556|           service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n04557|           description: '',\n04558|           price: 0\n04559|         });\n04560|         details.push({\n04561|           service: '–ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å',\n04562|           description: '–î–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–∫–∏–¥–æ–∫',\n04563|           price: basePrice\n04564|         });\n04565|         details.push({\n04566|           service: '–û–±—â–∏–µ —Å–∫–∏–¥–∫–∏',\n04567|           description: `–≠–∫–æ–Ω–æ–º–∏—è ${totalDiscount.toLocaleString()} ‚ÇΩ`,\n04568|           price: -totalDiscount\n04569|         });\n04570|         details.push({\n04571|           service: '–ò–¢–û–ì–û',\n04572|           description: '–ö –æ–ø–ª–∞—Ç–µ',\n04573|           price: finalPrice\n04574|         });\n04575|       }\n04576|     } else if (calc.company === '–ö–ò–¢' && calc.details?.services) {\n04577|       calc.details.services.forEach((service: any) => {\n04578|         details.push({\n04579|           service: service.name || '–£—Å–ª—É–≥–∞ –ö–ò–¢',\n04580|           description: service.code || '',\n04581|           price: service.price || 0\n04582|         });\n04583|       });\n04584|       \n04585|       if (calc.details.tariff_name) {\n04586|         details.push({\n04587|           service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n04588|           description: '',\n04589|           price: 0\n04590|         });\n04591|         details.push({\n04592|           service: '–¢–∞—Ä–∏—Ñ',\n04593|           description: calc.details.tariff_name,\n04594|           price: 0\n04595|         });\n04596|         details.push({\n04597|           service: '–ò–¢–û–ì–û',\n04598|           description: calc.details.currency || 'RUB',\n04599|           price: calc.price\n04600|         });\n04601|       }\n04602|     } else {\n04603|       // –î–ª—è –¥—Ä—É–≥–∏—Ö –¢–ö - –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n04604|       details.push({\n04605|         service: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n04606|         description: `${form.fromCity} - ${form.toCity}`,\n04607|         price: calc.price\n04608|       });\n04609|       \n04610|       if (form.needInsurance && form.declaredValue > 0) {\n04611|         details.push({\n04612|           service: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ',\n04613|           description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n04614|           price: Math.round(form.declaredValue * 0.02)\n04615|         });\n04616|       }\n04617|       \n04618|       if (form.needPackaging) {\n04619|         const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n04620|         details.push({\n04621|           service: '–£–ø–∞–∫–æ–≤–∫–∞',\n04622|           description: '',\n04623|           price: Math.round(totalWeight * 30)\n04624|         });\n04625|       }\n04626|     }\n04627|     \n04628|     return details;\n04629|   } catch (globalError) {\n04630|     console.error('‚ùå –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –û–®–ò–ë–ö–ê –≤ parseCalculationDetails:', globalError);\n04631|     console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', globalError instanceof Error ? globalError.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n04632|     console.log('‚ùå calc object:', calc);\n04633|     // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ\n04634|     return [{\n04635|       service: '–î–æ—Å—Ç–∞–≤–∫–∞',\n04636|       description: '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞',\n04637|       price: calc?.price || 0\n04638|     }];\n04639|   }\n04640| };\n04641| \n04642|   // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –ø–æ–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏)\n04643|   if (!isLoaded) {\n04644|     return (\n04645|       <div className=\"min-h-screen bg-gray-900 text-white p-4 relative flex items-center justify-center\">\n04646|         <div className=\"text-center\">\n04647|           <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400 mx-auto mb-4\"></div>\n04648|           <p className=\"text-blue-400\">–ó–∞–≥—Ä—É–∑–∫–∞...</p>\n04649|         </div>\n04650|       </div>\n04651|     );\n04652|   }\n04653| \n04654|   return (\n04655|     <div className=\"min-h-screen bg-gray-900 text-white p-4 relative\">\n04656|       <div className=\"max-w-7xl mx-auto\">\n04657|         <div className=\"flex items-center justify-between mb-3\">\n04658|           <h1 className=\"text-xl font-bold text-blue-400\">\n04659|             –ú–µ–∂–¥—É–≥–æ—Ä–æ–¥–Ω—è—è –¥–æ—Å—Ç–∞–≤–∫–∞ –õ–∞–≤—Å–∏—Ç\n04660|           </h1>\n04661|           \n04662|           {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è */}\n04663|           <div className=\"flex items-center gap-4\">\n04664|             {isFormChanged ? (\n04665|               <div className=\"flex items-center gap-2 text-yellow-400 text-sm\">\n04666|                 <div className=\"w-2 h-2 bg-yellow-400 rounded-full animate-pulse\"></div>\n04667|                 –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...\n04668|               </div>\n04669|             ) : lastSaveTime ? (\n04670|               <div className=\"flex items-center gap-2 text-green-400 text-sm\">\n04671|                 <div className=\"w-2 h-2 bg-green-400 rounded-full\"></div>\n04672|                 –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ {lastSaveTime.toLocaleTimeString()}\n04673|               </div>\n04674|             ) : hasStoredFormData() ? (\n04675|               <div className=\"flex items-center gap-2 text-blue-400 text-sm\">\n04676|                 <div className=\"w-2 h-2 bg-blue-400 rounded-full\"></div>\n04677|                 –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã\n04678|               </div>\n04679|             ) : null}\n04680|             \n04681|             {/* –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö */}\n04682|             {hasStoredFormData() && (\n04683|               <Button\n04684|                 onClick={() => {\n04685|                   if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã?')) {\n04686|                     clearFormData();\n04687|                     setForm(initialFormState);\n04688|                     setLastSaveTime(null);\n04689|                     setIsFormChanged(false);\n04690|                   }\n04691|                 }}\n04692|                 variant=\"outline\"\n04693|                 size=\"sm\"\n04694|                 className=\"border-red-500 text-red-400 hover:bg-red-900/20\"\n04695|               >\n04696|                 <Trash2 className=\"h-3 w-3 mr-1\" />\n04697|                 –û—á–∏—Å—Ç–∏—Ç—å\n04698|               </Button>\n04699|             )}\n04700|           </div>\n04701|         </div>\n04702|         \n04703|         {/* –ö–Ω–æ–ø–∫–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ */}\n04704|         <div className=\"flex justify-end gap-2 mb-4\">\n04705|           <Button \n04706|             onClick={() => window.open('/diagnostic?tab=api', '_blank')}\n04707|             variant=\"outline\" \n04708|             className=\"border-green-500 text-green-400 hover:bg-green-900/20\"\n04709|           >\n04710|             <Settings className=\"h-4 w-4 mr-2\" />\n04711|             –í—Å–µ API\n04712|           </Button>\n04713|           <Button \n04714|             onClick={() => window.open('/diagnostic?tab=docs', '_blank')}\n04715|             variant=\"outline\" \n04716|             className=\"border-purple-500 text-purple-400 hover:bg-purple-900/20\"\n04717|           >\n04718|             <Package2 className=\"h-4 w-4 mr-2\" />\n04719|             –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è\n04720|           </Button>\n04721|           <Button \n04722|             onClick={() => window.open('/diagnostic', '_blank')}\n04723|             variant=\"outline\" \n04724|             className=\"border-blue-500 text-blue-400 hover:bg-blue-900/20\"\n04725|           >\n04726|             <Settings className=\"h-4 w-4 mr-2\" />\n04727|             –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞\n04728|           </Button>\n04729|         </div>\n04730|         \n04731|         <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-3 h-[85vh]\">\n04732|           {/* –õ–µ–≤–∞—è —á–∞—Å—Ç—å - —Ñ–æ—Ä–º–∞ */}\n04733|           <div className=\"space-y-2 overflow-y-auto pr-2\">\n04734|             {/* –ö–∞—Ç–∞–ª–æ–≥ –º–µ–±–µ–ª–∏ */}\n04735|             <Card className=\"bg-gray-800 border-gray-700\">\n04736|               <CardHeader className=\"pb-2\">\n04737|                 <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n04738|                   <Package2 className=\"h-3 w-3\" />\n04739|                   –ö–∞—Ç–∞–ª–æ–≥ –º–µ–±–µ–ª–∏\n04740|                 </CardTitle>\n04741|               </CardHeader>\n04742|               <CardContent className=\"space-y-2\">\n04743|                 {/* –ü–æ–∏—Å–∫ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ */}\n04744|                 <LazyProductSearch \n04745|                   onProductAdd={handleProductAdd}\n04746|                   disabled={calculating}\n04747|                 />\n04748|                 \n04749|                 {/* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏ */}\n04750|                 <ProductManager\n04751|                   products={form.selectedProducts}\n04752|                   onQuantityChange={handleProductQuantityChange}\n04753|                   onProductRemove={handleProductRemove}\n04754|                   disabled={calculating}\n04755|                 />\n04756|               </CardContent>\n04757|             </Card>\n04758| \n04759|             {/* –ì—Ä—É–∑—ã */}\n04760|             <Card className=\"bg-gray-800 border-gray-700\">\n04761|               <CardHeader className=\"pb-2\">\n04762|                 <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n04763|                   <Truck className=\"h-3 w-3\" />\n04764|                   –ì—Ä—É–∑—ã\n04765|                 </CardTitle>\n04766|               </CardHeader>\n04767|               <CardContent className=\"space-y-2\">\n04768|                 {groupCargosForDisplay(form.cargos).map((group, groupIndex) => (\n04769|                    <div key={`group_${groupIndex}`} className=\"border border-gray-600 rounded p-2\">\n04770|                     <div className=\"flex justify-between items-center mb-2\">\n04771|                       <h4 className=\"text-sm font-medium text-white\">\n04772|                         {group.isEmpty ? (\n04773|                           `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1}`\n04774|                         ) : group.quantity === 1 ? (\n04775|                           `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1}`\n04776|                         ) : (\n04777|                           `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1} - ${group.quantity} –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –º–µ—Å—Ç–∞`\n04778|                         )}\n04779|                       </h4>\n04780|                       {form.cargos.length > 1 && group.quantity === 1 && (\n04781|                         <Button\n04782|                           variant=\"destructive\"\n04783|                           size=\"sm\"\n04784|                           onClick={() => removeCargo(form.cargos[group.indices[0]].id)}\n04785|                           className=\"h-6 text-xs\"\n04786|                         >\n04787|                           –£–¥–∞–ª–∏—Ç—å\n04788|                         </Button>\n04789|                       )}\n04790|                       {group.quantity > 1 && (\n04791|                         <Badge variant=\"secondary\" className=\"text-xs\">\n04792|                           {group.quantity} —à—Ç.\n04793|                         </Badge>\n04794|                       )}\n04795|                     </div>\n04796|                     \n04797|                     {group.isEmpty || group.quantity === 1 ? (\n04798|                       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞ –¥–ª—è –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ –∏–ª–∏ –µ–¥–∏–Ω–∏—á–Ω—ã—Ö\n04799|                       <div className=\"grid grid-cols-2 gap-2\">\n04800|                         <div>\n04801|                           <Label className=\"text-white text-xs\">–î–ª–∏–Ω–∞ (—Å–º)</Label>\n04802|                           <Input\n04803|                             type=\"number\"\n04804|                             value={form.cargos[group.indices[0]].length || ''}\n04805|                             onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'length', Number(e.target.value))}\n04806|                             className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n04807|                           />\n04808|                         </div>\n04809|                         <div>\n04810|                           <Label className=\"text-white text-xs\">–®–∏—Ä–∏–Ω–∞ (—Å–º)</Label>\n04811|                           <Input\n04812|                             type=\"number\"\n04813|                             value={form.cargos[group.indices[0]].width || ''}\n04814|                             onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'width', Number(e.target.value))}\n04815|                             className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n04816|                           />\n04817|                         </div>\n04818|                         <div>\n04819|                           <Label className=\"text-white text-xs\">–í—ã—Å–æ—Ç–∞ (—Å–º)</Label>\n04820|                           <Input\n04821|                             type=\"number\"\n04822|                             value={form.cargos[group.indices[0]].height || ''}\n04823|                             onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'height', Number(e.target.value))}\n04824|                             className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n04825|                           />\n04826|                         </div>\n04827|                         <div>\n04828|                           <Label className=\"text-white text-xs\">–í–µ—Å (–∫–≥)</Label>\n04829|                           <Input\n04830|                             type=\"number\"\n04831|                             value={form.cargos[group.indices[0]].weight || ''}\n04832|                             onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'weight', Number(e.target.value))}\n04833|                             className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n04834|                           />\n04835|                         </div>\n04836|                       </div>\n04837|                     ) : (\n04838|                       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –≥—Ä—É–ø–ø\n04839|                       <div className=\"grid grid-cols-2 gap-2 text-sm text-gray-300\">\n04840|                         <div>–î–ª–∏–Ω–∞: {group.length} —Å–º</div>\n04841|                         <div>–®–∏—Ä–∏–Ω–∞: {group.width} —Å–º</div>\n04842|                         <div>–í—ã—Å–æ—Ç–∞: {group.height} —Å–º</div>\n04843|                         <div>–í–µ—Å: {group.weight} –∫–≥</div>\n04844|                         <div className=\"col-span-2 text-xs text-blue-300 mt-1\">\n04845|                           –û–±—â–∏–π –≤–µ—Å: {(group.weight * group.quantity).toFixed(1)} –∫–≥, \n04846|                           –æ–±—ä–µ–º: {((group.length * group.width * group.height * group.quantity) / 1000000).toFixed(3)} –º¬≥\n04847|                         </div>\n04848|                       </div>\n04849|                     )}\n04850|                   </div>\n04851|                 ))}\n04852|                  <Button onClick={addCargo} className=\"w-full h-7 text-xs\" variant=\"outline\">\n04853|                   <Plus className=\"h-3 w-3 mr-1\" />\n04854|                   –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–∑\n04855|                 </Button>\n04856|               </CardContent>\n04857|             </Card>\n04858| \n04859|             {/* –ú–∞—Ä—à—Ä—É—Ç */}\n04860|             <Card className=\"bg-gray-800 border-gray-700\">\n04861|               <CardHeader className=\"pb-2\">\n04862|                 <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n04863|                   <Map className=\"h-3 w-3\" />\n04864|                   –ú–∞—Ä—à—Ä—É—Ç\n04865|                 </CardTitle>\n04866|               </CardHeader>\n04867|               <CardContent className=\"space-y-2\">\n04868|                 {/* –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */}\n04869|                 <div className=\"space-y-2\">\n04870|                   <Label className=\"text-sm font-medium text-white\">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</Label>\n04871|                   <div className=\"flex gap-3 flex-wrap\">\n04872|                     <label className=\"flex items-center space-x-1\">\n04873|                       <input\n04874|                         type=\"radio\"\n04875|                         name=\"fromDelivery\"\n04876|                         checked={form.fromTerminal}\n04877|                         onChange={() => setForm(prev => ({ ...prev, fromTerminal: true, fromAddressDelivery: false, fromLavsiteWarehouse: false }))}\n04878|                       />\n04879|                       <span className=\"text-white text-xs\">–û—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞</span>\n04880|                     </label>\n04881|                     <label className=\"flex items-center space-x-1\">\n04882|                       <input\n04883|                         type=\"radio\"\n04884|                         name=\"fromDelivery\"\n04885|                         checked={form.fromAddressDelivery && !form.fromLavsiteWarehouse}\n04886|                         onChange={() => setForm(prev => ({ ...prev, fromTerminal: false, fromAddressDelivery: true, fromLavsiteWarehouse: false }))}\n04887|                       />\n04888|                       <span className=\"text-white text-xs\">–û—Ç –∞–¥—Ä–µ—Å–∞</span>\n04889|                     </label>\n04890|                     <label className=\"flex items-center space-x-1\">\n04891|                       <Checkbox\n04892|                         id=\"lavsiteWarehouse\"\n04893|                         checked={form.fromLavsiteWarehouse}\n04894|                         onCheckedChange={handleLavsiteWarehouseChange}\n04895|                       />\n04896|                       <span className=\"text-white text-xs cursor-pointer\">–°–æ —Å–∫–ª–∞–¥–∞ –õ–∞–≤—Å–∏—Ç</span>\n04897|                     </label>\n04898|                   </div>\n04899|                   \n04900|                   <div>\n04901|                     <Label className=\"text-white text-xs\">–ì–æ—Ä–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</Label>\n04902|                     <Input\n04903|                       value={form.fromCity}\n04904|                       onChange={(e) => !form.fromLavsiteWarehouse && handleAddressChange('fromCity', e.target.value, e.target)}\n04905|                       placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –≥–æ—Ä–æ–¥\"\n04906|                       disabled={form.fromLavsiteWarehouse}\n04907|                       className={`bg-gray-700 border-gray-600 h-7 text-white text-xs ${form.fromLavsiteWarehouse ? 'opacity-50 cursor-not-allowed' : ''}`}\n04908|                     />\n04909|                   </div>\n04910|                   \n04911|                   {form.fromAddressDelivery && (\n04912|                     <div>\n04913|                       <Label className=\"text-white text-xs\">–ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</Label>\n04914|                       <Input\n04915|                         value={form.fromAddress}\n04916|                         onChange={(e) => !form.fromLavsiteWarehouse && handleAddressChange('fromAddress', e.target.value, e.target)}\n04917|                         placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å\"\n04918|                         disabled={form.fromLavsiteWarehouse}\n04919|                         className={`bg-gray-700 border-gray-600 h-7 text-white text-xs ${form.fromLavsiteWarehouse ? 'opacity-50 cursor-not-allowed' : ''}`}\n04920|                       />\n04921|                     </div>\n04922|                   )}\n04923|                 </div>\n04924| \n04925|                 {/* –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ */}\n04926|                 <div className=\"space-y-2\">\n04927|                   <Label className=\"text-sm font-medium text-white\">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</Label>\n04928|                   <div className=\"flex gap-3 flex-wrap\">\n04929|                     <label className=\"flex items-center space-x-1\">\n04930|                       <input\n04931|                         type=\"radio\"\n04932|                         name=\"toDelivery\"\n04933|                         checked={form.toTerminal}\n04934|                         onChange={() => setForm(prev => ({ ...prev, toTerminal: true, toAddressDelivery: false }))}\n04935|                       />\n04936|                       <span className=\"text-white text-xs\">–î–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞</span>\n04937|                     </label>\n04938|                     <label className=\"flex items-center space-x-1\">\n04939|                       <input\n04940|                         type=\"radio\"\n04941|                         name=\"toDelivery\"\n04942|                         checked={form.toAddressDelivery}\n04943|                         onChange={() => setForm(prev => ({ ...prev, toTerminal: false, toAddressDelivery: true }))}\n04944|                       />\n04945|                       <span className=\"text-white text-xs\">–î–æ –∞–¥—Ä–µ—Å–∞</span>\n04946|                     </label>\n04947|                   </div>\n04948|                   \n04949|                   <div>\n04950|                     <Label className=\"text-white text-xs\">–ì–æ—Ä–æ–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</Label>\n04951|                     <Input\n04952|                       value={form.toCity}\n04953|                       onChange={(e) => handleAddressChange('toCity', e.target.value, e.target)}\n04954|                       placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –≥–æ—Ä–æ–¥\"\n04955|                       className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n04956|                     />\n04957|                   </div>\n04958|                   \n04959|                   {form.toAddressDelivery && (\n04960|                     <div>\n04961|                       <Label className=\"text-white text-xs\">–ê–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</Label>\n04962|                       <Input\n04963|                         value={form.toAddress}\n04964|                         onChange={(e) => handleAddressChange('toAddress', e.target.value, e.target)}\n04965|                         placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å\"\n04966|                         className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n04967|                       />\n04968|                     </div>\n04969|                   )}\n04970|                 </div>\n04971| \n04972|                 <div>\n04973|                   <Label className=\"text-white text-xs\">–û–±—ä—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (—Ä—É–±.)</Label>\n04974|                   <Input\n04975|                     type=\"number\"\n04976|                     value={form.declaredValue || ''}\n04977|                     onChange={(e) => setForm(prev => ({ ...prev, declaredValue: Number(e.target.value) }))}\n04978|                     className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n04979|                   />\n04980|                 </div>\n04981|                 \n04982|                 <div className=\"space-y-2\">\n04983|                   <div className=\"flex items-center space-x-2\">\n04984|                     <Checkbox\n04985|                       id=\"packaging\"\n04986|                       checked={form.needPackaging}\n04987|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needPackaging: checked as boolean }))}\n04988|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n04989|                     />\n04990|                     <Label htmlFor=\"packaging\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è —É–ø–∞–∫–æ–≤–∫–∞</Label>\n04991|                   </div>\n04992|                   \n04993|                   <div className=\"flex items-center space-x-2\">\n04994|                     <Checkbox\n04995|                       id=\"insurance\"\n04996|                       checked={form.needInsurance}\n04997|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needInsurance: checked as boolean }))}\n04998|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n04999|                     />\n05000|                     <Label htmlFor=\"insurance\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞</Label>\n05001|                   </div>\n05002|                   \n05003|                   <div className=\"flex items-center space-x-2\">\n05004|                     <Checkbox\n05005|                       id=\"loading\"\n05006|                       checked={form.needLoading}\n05007|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needLoading: checked as boolean }))}\n05008|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n05009|                     />\n05010|                     <Label htmlFor=\"loading\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≥—Ä—É–∑–∫–∞/—Ä–∞–∑–≥—Ä—É–∑–∫–∞</Label>\n05011|                   </div>\n05012|                   \n05013|                   <div className=\"flex items-center space-x-2\">\n05014|                     <Checkbox\n05015|                       id=\"carry\"\n05016|                       checked={form.needCarry}\n05017|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needCarry: checked as boolean }))}\n05018|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n05019|                     />\n05020|                     <Label htmlFor=\"carry\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—ä–µ–º</Label>\n05021|                   </div>\n05022|                   \n05023|                   {form.needCarry && (\n05024|                     <div className=\"ml-6 space-y-2 border-l-2 border-gray-600 pl-3\">\n05025|                       <div>\n05026|                         <Label className=\"text-white text-xs\">–≠—Ç–∞–∂</Label>\n05027|                         <Input\n05028|                           type=\"number\"\n05029|                           value={form.floor}\n05030|                           onChange={(e) => setForm(prev => ({ ...prev, floor: Number(e.target.value) }))}\n05031|                           className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n05032|                         />\n05033|                       </div>\n05034|                       <div className=\"flex items-center space-x-2\">\n05035|                         <Checkbox\n05036|                           id=\"freightLift\"\n05037|                           checked={form.hasFreightLift}\n05038|                           onCheckedChange={(checked) => setForm(prev => ({ ...prev, hasFreightLift: checked as boolean }))}\n05039|                         />\n05040|                         <Label htmlFor=\"freightLift\" className=\"text-white text-xs\">–ù–∞–ª–∏—á–∏–µ –≥—Ä—É–∑–æ–≤–æ–≥–æ –ª–∏—Ñ—Ç–∞</Label>\n05041|                       </div>\n05042|                     </div>\n05043|                   )}\n05044|                 </div>\n05045|                 \n05046|                 <div className=\"space-y-2\">\n05047|                   <Button \n05048|                     onClick={handleCalculate} \n05049|                     className=\"w-full bg-blue-600 hover:bg-blue-700 h-7 text-xs\" \n05050|                     disabled={calculating}\n05051|                   >\n05052|                     {calculating ? '–†–∞—Å—á–µ—Ç...' : '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å'}\n05053|                   </Button>\n05054|                   \n05055|                   <Button \n05056|                     onClick={handleReset} \n05057|                     variant=\"outline\" \n05058|                     className=\"w-full h-7 text-xs text-black border-gray-600 hover:bg-gray-700 hover:text-white\" \n05059|                     disabled={calculating}\n05060|                   >\n05061|                     –°–±—Ä–æ—Å–∏—Ç—å —Ä–∞—Å—á–µ—Ç\n05062|                   </Button>\n05063|                 </div>\n05064|               </CardContent>\n05065|             </Card>\n05066|           </div>\n05067| \n05068|           {/* –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã */}\n05069|           <div className=\"space-y-2 overflow-y-auto\">\n05070|             {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Ä–∞—Å—á–µ—Ç–æ–≤ */}\n05071|             <CalculationProgress \n05072|               companies={calculationProgress.companies}\n05073|               totalDuration={calculationProgress.totalDuration}\n05074|               isVisible={calculating}\n05075|             />\n05076|             \n05077|             {calculations.length > 0 && (\n05078|                  <div className=\"space-y-2\">\n05079|                 <div className=\"flex justify-between items-center\">\n05080|                   <h2 className=\"text-lg font-bold text-blue-400\">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞</h2>\n05081|                   <Button \n05082|                     onClick={exportToPDF} \n05083|                     variant=\"outline\" \n05084|                     size=\"sm\" \n05085|                     className=\"h-7 text-xs border-blue-500 text-blue-400 hover:bg-blue-900/20 print:hidden\"\n05086|                   >\n05087|                     –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ PDF\n05088|                   </Button>\n05089|                 </div>\n05090|                 \n05091|                 {calculations\n05092|                   .filter(calc => !hiddenCompanies[calc.company])\n05093|                   .map((calc, index) => (\n05094|                    <Card key={index} className=\"bg-gray-800 border-gray-700 text-xs\">\n05095|                      <CardHeader className=\"pb-1\">\n05096|                       <div className=\"flex justify-between items-center\">\n05097|                          <CardTitle className=\"text-white flex items-center gap-2 text-xs\">\n05098|                            <Building2 className=\"h-3 w-3\" />\n05099|                           {calc.company}\n05100|                         </CardTitle>\n05101|                         {calc.error ? (\n05102|                           <Badge variant=\"destructive\" className=\"text-xs\">–û—à–∏–±–∫–∞</Badge>\n05103|                         ) : (\n05104|                           <Badge variant=\"default\" className=\"bg-green-600 text-xs\">\n05105|                             {calc.price.toLocaleString()} ‚ÇΩ\n05106|                           </Badge>\n05107|                         )}\n05108|                       </div>\n05109|                     </CardHeader>\n05110|                     <CardContent className=\"pt-0\">\n05111|                       <div className=\"space-y-2\">\n05112|                         {calc.error ? (\n05113|                           <div className=\"space-y-2\">\n05114|                             <Alert className=\"border-red-600\">\n05115|                               <AlertDescription className=\"text-white text-xs\">{calc.error}</AlertDescription>\n05116|                             </Alert>\n05117|                             {calc.price > 0 && (\n05118|                               <>\n05119|                                 <p className=\"text-white text-xs\"><strong>–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {calc.price.toLocaleString()} ‚ÇΩ</p>\n05120|                                 <p className=\"text-white text-xs\"><strong>–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Å—Ä–æ–∫:</strong> {calc.days} –¥–Ω–µ–π</p>\n05121|                               </>\n05122|                             )}\n05123|                           </div>\n05124|                         ) : (\n05125|                           <>\n05126|                             <p className=\"text-white text-xs\"><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {calc.price.toLocaleString()} ‚ÇΩ</p>\n05127|                             <p className=\"text-white text-xs\"><strong>–°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> {calc.days} –¥–Ω–µ–π</p>\n05128|                           </>\n05129|                         )}\n05130|                         \n05131|                         <div className=\"flex gap-2 mt-2 flex-wrap\">\n05132|                           {!calc.error && (\n05133|                             <Button\n05134|                               variant=\"outline\"\n05135|                               size=\"sm\"\n05136|                               onClick={() => toggleDetails(calc.company)}\n05137|                               className=\"h-6 text-xs\"\n05138|                             >\n05139|                               {expandedDetails[calc.company] ? '–°–∫—Ä—ã—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ' : '–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ'}\n05140|                             </Button>\n05141|                           )}\n05142|                           <Button\n05143|                             variant=\"outline\"\n05144|                             size=\"sm\"\n05145|                             onClick={() => toggleDebugInfo(calc.company)}\n05146|                             className=\"h-6 text-xs\"\n05147|                           >\n05148|                             {expandedDebugInfo[calc.company] ? '–°–∫—Ä—ã—Ç—å –æ—Ç–ª–∞–¥–∫—É' : '–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'}\n05149|                           </Button>\n05150|                           <Button\n05151|                             variant=\"outline\"\n05152|                             size=\"sm\"\n05153|                             onClick={() => {\n05154|                               setHiddenCompanies(prev => ({\n05155|                                 ...prev,\n05156|                                 [calc.company]: true\n05157|                               }));\n05158|                             }}\n05159|                             className=\"h-6 text-xs border-red-500 text-red-400 hover:bg-red-900/20\"\n05160|                           >\n05161|                             –°–∫—Ä—ã—Ç—å\n05162|                           </Button>\n05163|                         </div>\n05164|                         \n05165|                         {/* –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ */}\n05166|                         {!calc.error && (\n05167|                           <Collapsible open={expandedDetails[calc.company]}>\n05168|                             <CollapsibleContent className=\"mt-2\">\n05169|                               <div className=\"bg-gray-900 p-3 rounded text-xs\">\n05170|                                 <h4 className=\"font-bold mb-2 text-white\">–î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞:</h4>\n05171|                                 {(() => {\n05172|                                   const details = parseCalculationDetails(calc);\n05173|                                   const totalPrice = details.reduce((sum, detail) => sum + detail.price, 0);\n05174|                                   \n05175|                                   return (\n05176|                                     <div className=\"space-y-1\">\n05177|                                       {details.map((detail, idx) => (\n05178|                                         <div key={idx} className=\"flex justify-between text-white\">\n05179|                                           <div>\n05180|                                             <div className=\"font-medium\">{detail.service}</div>\n05181|                                             {detail.description && (\n05182|                                               <div className=\"text-gray-400 text-xs\">{detail.description}</div>\n05183|                                             )}\n05184|                                           </div>\n05185|                                           <div className=\"font-medium\">{detail.price.toLocaleString()} ‚ÇΩ</div>\n05186|                                         </div>\n05187|                                       ))}\n05188|                                     </div>\n05189|                                   );\n05190|                                 })()}\n05191|                               </div>\n05192|                             </CollapsibleContent>\n05193|                           </Collapsible>\n05194|                         )}\n05195|                         \n05196|                         {/* –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è - –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ */}\n05197|                         <Collapsible open={expandedDebugInfo[calc.company]}>\n05198|                           <CollapsibleContent className=\"mt-2\">\n05199|                             <div className=\"bg-gray-900 p-3 rounded text-xs\">\n05200|                               <h4 className=\"font-bold mb-2 text-white\">–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h4>\n05201|                               \n05202|                               {calc.apiUrl && (\n05203|                                 <div className=\"mb-3\">\n05204|                                   <h5 className=\"font-bold mb-1 text-white\">–ó–∞–ø—Ä–æ—Å –∫ API:</h5>\n05205|                                   <p className=\"text-gray-300 break-all text-xs\">URL: {calc.apiUrl}</p>\n05206|                                 </div>\n05207|                               )}\n05208|                               \n05209|                               {calc.sessionId && (\n05210|                                 <div className=\"mb-3\">\n05211|                                   <h5 className=\"font-bold mb-1 text-white\">Session ID:</h5>\n05212|                                   <p className=\"text-gray-300 text-xs\">{calc.sessionId}</p>\n05213|                                 </div>\n05214|                               )}\n05215|                               \n05216|                               {calc.requestData && (\n05217|                                 <div className=\"mb-3\">\n05218|                                   <h5 className=\"font-bold mb-1 text-white\">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å:</h5>\n05219|                                   <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n05220|                                     {JSON.stringify(calc.requestData, null, 2)}\n05221|                                   </pre>\n05222|                                 </div>\n05223|                               )}\n05224|                               \n05225|                               {calc.responseData && (\n05226|                                 <div className=\"mb-3\">\n05227|                                   <h5 className=\"font-bold mb-1 text-white\">–ü–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç:</h5>\n05228|                                   <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n05229|                                     {JSON.stringify(calc.responseData, null, 2)}\n05230|                                   </pre>\n05231|                                 </div>\n05232|                               )}\n05233|                               \n05234|                               {calc.details && (\n05235|                                 <div className=\"mb-3\">\n05236|                                   <h5 className=\"font-bold mb-1 text-white\">–î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ (JSON):</h5>\n05237|                                   <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n05238|                                     {JSON.stringify(calc.details, null, 2)}\n05239|                                   </pre>\n05240|                                 </div>\n05241|                               )}\n05242|                               \n05243|                               {calc.error && (\n05244|                                 <div className=\"mb-3\">\n05245|                                   <h5 className=\"font-bold mb-1 text-red-400\">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ:</h5>\n05246|                                   <p className=\"text-red-300 text-xs\">{calc.error}</p>\n05247|                                 </div>\n05248|                               )}\n05249|                             </div>\n05250|                           </CollapsibleContent>\n05251|                         </Collapsible>\n05252|                       </div>\n05253|                     </CardContent>\n05254|                   </Card>\n05255|                  ))}\n05256|                  \n05257|                  {/* –ë–ª–æ–∫ –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–∫—Ä—ã—Ç—ã—Ö –¢–ö */}\n05258|                  {Object.values(hiddenCompanies).some(hidden => hidden) && (\n05259|                    <div className=\"mt-4 p-3 bg-gray-700 rounded border-gray-600\">\n05260|                      <div className=\"flex items-center justify-between\">\n05261|                        <div className=\"text-sm text-gray-300\">\n05262|                          –°–∫—Ä—ã—Ç–æ –¢–ö: {Object.values(hiddenCompanies).filter(hidden => hidden).length}\n05263|                        </div>\n05264|                        <Button\n05265|                          variant=\"outline\"\n05266|                          size=\"sm\"\n05267|                          onClick={() => setHiddenCompanies({})}\n05268|                          className=\"h-6 text-xs border-green-500 text-green-400 hover:bg-green-900/20\"\n05269|                        >\n05270|                          –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–∫—Ä—ã—Ç—ã–µ\n05271|                        </Button>\n05272|                      </div>\n05273|                    </div>\n05274|                  )}\n05275|                </div>\n05276|             )}\n05277| \n05278|             {/* –°–ø–∏—Å–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –¢–ö - –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º—ã–π */}\n05279|             <Card className=\"bg-gray-800 border-gray-700\">\n05280|               <CardHeader className=\"pb-2\">\n05281|                 <div className=\"flex justify-between items-center\">\n05282|                   <CardTitle className=\"text-white text-sm\">\n05283|                     –ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ ({COMPANIES_BASE.filter(company => showHiddenCompanies || enabledCompanies[company.apiKey]).length}{showHiddenCompanies ? ` –∏–∑ ${COMPANIES_BASE.length}` : ''})\n05284|                   </CardTitle>\n05285|                   <Button\n05286|                     variant=\"outline\"\n05287|                     size=\"sm\"\n05288|                     onClick={() => setShowHiddenCompanies(prev => !prev)}\n05289|                     className=\"h-6 text-xs border-blue-500 text-blue-400 hover:bg-blue-900/20\"\n05290|                   >\n05291|                     {showHiddenCompanies ? '–°–∫—Ä—ã—Ç—å –≤—Å–µ' : '–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ'}\n05292|                   </Button>\n05293|                 </div>\n05294|               </CardHeader>\n05295|               <CardContent>\n05296|                 <div className=\"grid grid-cols-2 gap-2\">\n05297|                   {COMPANIES_BASE\n05298|                     .filter(company => showHiddenCompanies || enabledCompanies[company.apiKey])\n05299|                     .map((company, index) => {\n05300|                     const isConnected = apiStatus[company.apiKey as keyof typeof apiStatus] === '–ø–æ–¥–∫–ª—é—á–µ–Ω–æ';\n05301|                     const statusText = apiStatus[company.apiKey as keyof typeof apiStatus];\n05302|                     const isEnabled = enabledCompanies[company.apiKey];\n05303|                     \n05304|                     // –û—Ç–ª–∞–¥–∫–∞ –¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–æ–º–ø–∞–Ω–∏–π\n05305|                     if (index < 3) {\n05306|                       console.log(`üîç –ö–æ–º–ø–∞–Ω–∏—è ${index}: ${company.name}, apiKey: ${company.apiKey}, isEnabled: ${isEnabled}, statusText: ${statusText}`);\n05307|                     }\n05308|                     \n05309|                     return (\n05310|                       <div key={index} className=\"flex items-center justify-between p-1.5 bg-gray-700 rounded\">\n05311|                         <div className=\"flex items-center gap-2\">\n05312|                           <span className=\"text-lg\">{company.logo}</span>\n05313|                           <div>\n05314|                             <p className=\"font-medium text-white text-[10px] leading-tight\">{company.name}</p>\n05315|                             <Badge \n05316|                               variant={isConnected ? \"default\" : \"destructive\"} \n05317|                               className=\"text-[9px] py-0 px-1\"\n05318|                             >\n05319|                               {isConnected ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–∞' : statusText === '–ø—Ä–æ–≤–µ—Ä–∫–∞...' ? '–ü—Ä–æ–≤–µ—Ä–∫–∞...' : '–û—à–∏–±–∫–∞'}\n05320|                             </Badge>\n05321|                           </div>\n05322|                         </div>\n05323|                         <div className=\"flex items-center gap-2\">\n05324|                           <span className=\"text-[9px] text-gray-300\">\n05325|                             {isEnabled ? '–í–∫–ª' : '–í—ã–∫–ª'}\n05326|                           </span>\n05327|                           <Switch\n05328|                             checked={isEnabled}\n05329|                             onCheckedChange={(checked) => {\n05330|                               setEnabledCompanies(prev => ({\n05331|                                 ...prev,\n05332|                                 [company.apiKey]: checked\n05333|                               }));\n05334|                             }}\n05335|                           />\n05336|                         </div>\n05337|                       </div>\n05338|                     );\n05339|                   })}\n05340|                 </div>\n05341|               </CardContent>\n05342|             </Card>\n05343| \n05344|             {/* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫—É–∑–æ–≤–∞ */}\n05345|             {calculations.length > 0 && (\n05346|               <LazyTruckVisualization \n05347|                 cargos={form.cargos.map(cargo => ({\n05348|                   id: cargo.id,\n05349|                   length: cargo.length * 10, // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n05350|                   width: cargo.width * 10,   // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n05351|                   height: cargo.height * 10, // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n05352|                   weight: cargo.weight,\n05353|                   productName: form.selectedProducts?.find(p => \n05354|                     p.cargoIndexes.includes(form.cargos.indexOf(cargo))\n05355|                   )?.product.name\n05356|                 }))}\n05357|                 isVisible={true}\n05358|               />\n05359|             )}\n05360|           </div>\n05361|         </div>\n05362|       </div>\n05363| \n05364|       {/* –ê–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–∫–∏ */}\n05365|       {showSuggestions && suggestions.length > 0 && (\n05366|         <div \n05367|           className=\"fixed z-50 bg-gray-800 border border-gray-700 rounded-md shadow-lg max-w-sm w-full max-h-60 overflow-y-auto\"\n05368|           style={{\n05369|             top: suggestionPosition.top,\n05370|             left: suggestionPosition.left\n05371|           }}\n05372|         >\n05373|           <div className=\"p-1\">\n05374|             {suggestions.map((suggestion, index) => (\n05375|               <div\n05376|                 key={index}\n05377|                 className=\"p-2 hover:bg-gray-700 cursor-pointer text-xs text-white rounded transition-colors\"\n05378|                 onClick={() => selectSuggestion(suggestion)}\n05379|               >\n05380|                 {suggestion.value}\n05381|               </div>\n05382|             ))}\n05383|           </div>\n05384|         </div>\n05385|       )}\n05386|     </div>\n05387|   );\n05388| }\n</file>",
    "title": "app/page.tsx",
    "metadata": {
      "preview": "    const apiUrl = 'https://api.nordw.orog.ru/api/v1/calculate';\n\n    try {\n      // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      validateMultipleCargos(form.cargos);\n      \n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n      const totalVolume = form.cargos.reduce((sum, cargo) => \n        sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n      );\n\n      // üîß –î–û–ë–ê–í–õ–ï–ù–û: –†–∞—Å—á–µ—Ç –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      const maxLength = Math.max(...form.cargos.map(c => c.length));\n      const maxWidth = Math.max(...form.cargos.map(c => c.width));\n      const maxHeight = Math.max(...form.cargos.map(c => c.height));\n      \n      // üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      console.log('üåê Nord Wheel: –ê–Ω–∞–ª–∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç:');\n      console.log(`   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç: ${form.cargos.length}`);\n      console.log(`   - –û–±—â–∏–π –≤–µ—Å: ${totalWeight} –∫–≥`);"
    },
    "time": {
      "start": 1764030472938,
      "end": 1764030472948
    }
  }
}