{
  "id": "prt_acbe95e01001JNo4fe4XNk61l9",
  "sessionID": "ses_54b97e247ffenCZZa4jZiIWD0l",
  "messageID": "msg_acbe87c010014SBggRTaZShzhk",
  "type": "tool",
  "callID": "call_7369a59f1a8e43e5aa1dff8f",
  "tool": "edit",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/vozovoz-parser/page.tsx",
      "oldString": "import { Loader2, Play, Compare } from 'lucide-react';",
      "newString": "import { Loader2, Play, GitCompare } from 'lucide-react';"
    },
    "output": "",
    "title": "app/vozovoz-parser/page.tsx",
    "metadata": {
      "diagnostics": {},
      "diff": "Index: /home/user/project/app/vozovoz-parser/page.tsx\n===================================================================\n--- /home/user/project/app/vozovoz-parser/page.tsx\n+++ /home/user/project/app/vozovoz-parser/page.tsx\n@@ -6,9 +6,9 @@\n import { Label } from '@/components/ui/label';\n import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\n import { Checkbox } from '@/components/ui/checkbox';\n import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\n-import { Loader2, Play, Compare } from 'lucide-react';\n+import { Loader2, Play, GitCompare } from 'lucide-react';\n \n interface VozovozParserParams {\n   fromCity: string;\n   toCity: string;\n",
      "filediff": {
        "file": "/home/user/project/app/vozovoz-parser/page.tsx",
        "before": "\"use client\";\n\nimport { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Loader2, Play, Compare } from 'lucide-react';\n\ninterface VozovozParserParams {\n  fromCity: string;\n  toCity: string;\n  fromAddressDelivery: boolean;\n  toAddressDelivery: boolean;\n  fromAddress?: string;\n  toAddress?: string;\n  length: number;\n  width: number;\n  height: number;\n  weight: number;\n  needInsurance: boolean;\n  declaredValue?: number;\n  needPackaging: boolean;\n  needLoading: boolean;\n  hasFreightElevator: boolean;\n  floor: number;\n}\n\ninterface ParsedResult {\n  totalCost: number;\n  services: ServiceItem[];\n  deliveryTime?: string;\n  warnings?: string[];\n  parseTime?: number;\n}\n\ninterface ServiceItem {\n  name: string;\n  basePrice?: number;\n  price: number;\n  discount?: number;\n}\n\ninterface ApiResult {\n  price: number;\n  days: number;\n  details?: any;\n  error?: string;\n}\n\nexport default function VozovozParserPage() {\n  const [params, setParams] = useState<VozovozParserParams>({\n    fromCity: '–ú–æ—Å–∫–≤–∞',\n    toCity: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n    fromAddressDelivery: false,\n    toAddressDelivery: true,\n    fromAddress: '',\n    toAddress: '–ù–µ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç –¥.132',\n    length: 200,\n    width: 100,\n    height: 100,\n    weight: 100,\n    needInsurance: false,\n    declaredValue: 0,\n    needPackaging: false,\n    needLoading: false,\n    hasFreightElevator: false,\n    floor: 1\n  });\n\n  const [parserResult, setParserResult] = useState<ParsedResult | null>(null);\n  const [apiResult, setApiResult] = useState<ApiResult | null>(null);\n  const [isParserLoading, setIsParserLoading] = useState(false);\n  const [isApiLoading, setIsApiLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const handleParamChange = (key: keyof VozovozParserParams, value: any) => {\n    setParams(prev => ({ ...prev, [key]: value }));\n  };\n\n  const runParser = async () => {\n    setIsParserLoading(true);\n    setError(null);\n    setParserResult(null);\n\n    try {\n      const response = await fetch('/api/vozovoz-parser', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(params),\n      });\n\n      if (!response.ok) {\n        throw new Error(`–û—à–∏–±–∫–∞ HTTP: ${response.status}`);\n      }\n\n      const result = await response.json();\n      \n      if (result.error) {\n        throw new Error(result.error);\n      }\n\n      setParserResult(result);\n    } catch (err: any) {\n      setError(err.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–∞—Ä—Å–µ—Ä–∞');\n    } finally {\n      setIsParserLoading(false);\n    }\n  };\n\n  const runApiComparison = async () => {\n    setIsApiLoading(true);\n    setApiResult(null);\n\n    try {\n      // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è API –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –æ—Å–Ω–æ–≤–Ω–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é\n      const maxDimensions = {\n        length: params.length / 1000, // –ø–µ—Ä–µ–≤–æ–¥–∏–º –º–º –≤ –º\n        width: params.width / 1000,\n        height: params.height / 1000,\n        weight: params.weight\n      };\n\n      const totalVolume = (params.length * params.width * params.height) / 1000000000; // –º¬≥\n      const totalWeight = params.weight;\n\n      const requestData = {\n        object: \"price\",\n        action: \"get\",\n        params: {\n          cargo: {\n            dimension: {\n              max: maxDimensions,\n              quantity: 1,\n              volume: totalVolume,\n              weight: totalWeight\n            },\n            ...(params.needInsurance && params.declaredValue > 0 ? {\n              insurance: params.declaredValue,\n              insuranceNdv: false\n            } : {\n              insuranceNdv: true\n            }),\n            ...(params.needPackaging ? {\n              wrapping: {\n                \"hardPackageVolume\": totalVolume\n              }\n            } : {})\n          },\n          gateway: {\n            dispatch: {\n              point: {\n                location: params.fromCity,\n                ...(params.fromAddressDelivery ? {\n                  address: params.fromAddress || \"–∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\"\n                } : {\n                  terminal: \"default\"\n                })\n              }\n            },\n            destination: {\n              point: {\n                location: params.toCity,\n                ...(params.toAddressDelivery ? {\n                  address: params.toAddress || \"–∞–¥—Ä–µ—Å –ø–æ–ª—É—á–µ–Ω–∏—è\"\n                } : {\n                  terminal: \"default\"\n                })\n              }\n            }\n          }\n        }\n      };\n\n      const response = await fetch('/api/vozovoz', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(requestData),\n      });\n\n      if (!response.ok) {\n        throw new Error(`–û—à–∏–±–∫–∞ API: ${response.status}`);\n      }\n\n      const result = await response.json();\n      \n      if (result.error) {\n        throw new Error(result.error);\n      }\n\n      setApiResult({\n        price: result.response?.price || 0,\n        days: result.response?.deliveryTime?.to || 1,\n        details: result.response\n      });\n    } catch (err: any) {\n      setError(err.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ API –∑–∞–ø—Ä–æ—Å–∞');\n    } finally {\n      setIsApiLoading(false);\n    }\n  };\n\n  const runBoth = async () => {\n    await Promise.all([runParser(), runApiComparison()]);\n  };\n\n  const calculateDifference = () => {\n    if (!parserResult || !apiResult) return null;\n    \n    const diff = parserResult.totalCost - apiResult.price;\n    const percent = ((diff / apiResult.price) * 100).toFixed(1);\n    \n    return {\n      absolute: diff,\n      percent: parseFloat(percent),\n      parserMore: diff > 0\n    };\n  };\n\n  const difference = calculateDifference();\n\n  return (\n    <div className=\"min-h-screen bg-gray-900 text-white p-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"mb-6\">\n          <h1 className=\"text-3xl font-bold mb-2\">üï∑Ô∏è –ü–∞—Ä—Å–µ—Ä Vozovoz</h1>\n          <p className=\"text-gray-400\">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ –≤–µ–±-–ø–∞—Ä—Å–∏–Ω–≥ —Å–∞–π—Ç–∞</p>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          {/* –§–æ—Ä–º–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ */}\n          <Card className=\"bg-gray-800 border-gray-700\">\n            <CardHeader>\n              <CardTitle className=\"text-xl\">üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥—Ä—É–∑–∞</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {/* –ú–∞—Ä—à—Ä—É—Ç */}\n              <div className=\"space-y-3\">\n                <h3 className=\"text-lg font-semibold text-blue-400\">üõ£Ô∏è –ú–∞—Ä—à—Ä—É—Ç</h3>\n                \n                <div>\n                  <Label>–ì–æ—Ä–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</Label>\n                  <Input\n                    value={params.fromCity}\n                    onChange={(e) => handleParamChange('fromCity', e.target.value)}\n                    placeholder=\"–ú–æ—Å–∫–≤–∞\"\n                    className=\"bg-gray-700 border-gray-600\"\n                  />\n                </div>\n\n                <div className=\"flex items-center space-x-4\">\n                  <Checkbox\n                    checked={params.fromAddressDelivery}\n                    onCheckedChange={(checked) => handleParamChange('fromAddressDelivery', checked)}\n                  />\n                  <Label>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç –∞–¥—Ä–µ—Å–∞</Label>\n                </div>\n\n                {params.fromAddressDelivery && (\n                  <div>\n                    <Label>–ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</Label>\n                    <Input\n                      value={params.fromAddress}\n                      onChange={(e) => handleParamChange('fromAddress', e.target.value)}\n                      placeholder=\"–ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\"\n                      className=\"bg-gray-700 border-gray-600\"\n                    />\n                  </div>\n                )}\n\n                <div>\n                  <Label>–ì–æ—Ä–æ–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</Label>\n                  <Input\n                    value={params.toCity}\n                    onChange={(e) => handleParamChange('toCity', e.target.value)}\n                    placeholder=\"–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥\"\n                    className=\"bg-gray-700 border-gray-600\"\n                  />\n                </div>\n\n                <div className=\"flex items-center space-x-4\">\n                  <Checkbox\n                    checked={params.toAddressDelivery}\n                    onCheckedChange={(checked) => handleParamChange('toAddressDelivery', checked)}\n                  />\n                  <Label>–î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –∞–¥—Ä–µ—Å–∞</Label>\n                </div>\n\n                {params.toAddressDelivery && (\n                  <div>\n                    <Label>–ê–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</Label>\n                    <Input\n                      value={params.toAddress}\n                      onChange={(e) => handleParamChange('toAddress', e.target.value)}\n                      placeholder=\"–ê–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è\"\n                      className=\"bg-gray-700 border-gray-600\"\n                    />\n                  </div>\n                )}\n              </div>\n\n              {/* –ì–∞–±–∞—Ä–∏—Ç—ã */}\n              <div className=\"space-y-3\">\n                <h3 className=\"text-lg font-semibold text-green-400\">üì¶ –ì–∞–±–∞—Ä–∏—Ç—ã –∏ –≤–µ—Å</h3>\n                \n                <div className=\"grid grid-cols-2 gap-3\">\n                  <div>\n                    <Label>–î–ª–∏–Ω–∞ (—Å–º)</Label>\n                    <Input\n                      type=\"number\"\n                      value={params.length}\n                      onChange={(e) => handleParamChange('length', parseInt(e.target.value) || 0)}\n                      className=\"bg-gray-700 border-gray-600\"\n                    />\n                  </div>\n                  <div>\n                    <Label>–®–∏—Ä–∏–Ω–∞ (—Å–º)</Label>\n                    <Input\n                      type=\"number\"\n                      value={params.width}\n                      onChange={(e) => handleParamChange('width', parseInt(e.target.value) || 0)}\n                      className=\"bg-gray-700 border-gray-600\"\n                    />\n                  </div>\n                  <div>\n                    <Label>–í—ã—Å–æ—Ç–∞ (—Å–º)</Label>\n                    <Input\n                      type=\"number\"\n                      value={params.height}\n                      onChange={(e) => handleParamChange('height', parseInt(e.target.value) || 0)}\n                      className=\"bg-gray-700 border-gray-600\"\n                    />\n                  </div>\n                  <div>\n                    <Label>–í–µ—Å (–∫–≥)</Label>\n                    <Input\n                      type=\"number\"\n                      value={params.weight}\n                      onChange={(e) => handleParamChange('weight', parseInt(e.target.value) || 0)}\n                      className=\"bg-gray-700 border-gray-600\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n              {/* –î–æ–ø —É—Å–ª—É–≥–∏ */}\n              <div className=\"space-y-3\">\n                <h3 className=\"text-lg font-semibold text-yellow-400\">üõ°Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏</h3>\n                \n                <div className=\"flex items-center space-x-4\">\n                  <Checkbox\n                    checked={params.needInsurance}\n                    onCheckedChange={(checked) => handleParamChange('needInsurance', checked)}\n                  />\n                  <Label>–¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞</Label>\n                </div>\n\n                {params.needInsurance && (\n                  <div>\n                    <Label>–û–±—ä—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)</Label>\n                    <Input\n                      type=\"number\"\n                      value={params.declaredValue}\n                      onChange={(e) => handleParamChange('declaredValue', parseInt(e.target.value) || 0)}\n                      placeholder=\"50000\"\n                      className=\"bg-gray-700 border-gray-600\"\n                    />\n                  </div>\n                )}\n\n                <div className=\"flex items-center space-x-4\">\n                  <Checkbox\n                    checked={params.needPackaging}\n                    onCheckedChange={(checked) => handleParamChange('needPackaging', checked)}\n                  />\n                  <Label>–¢—Ä–µ–±—É–µ—Ç—Å—è —É–ø–∞–∫–æ–≤–∫–∞</Label>\n                </div>\n\n                <div className=\"flex items-center space-x-4\">\n                  <Checkbox\n                    checked={params.needLoading}\n                    onCheckedChange={(checked) => handleParamChange('needLoading', checked)}\n                  />\n                  <Label>–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≥—Ä—É–∑–∫–∞/—Ä–∞–∑–≥—Ä—É–∑–∫–∞</Label>\n                </div>\n\n                {params.needLoading && (\n                  <div className=\"grid grid-cols-2 gap-3\">\n                    <div>\n                      <Label>–ù–∞–ª–∏—á–∏–µ –≥—Ä—É–∑–æ–≤–æ–≥–æ –ª–∏—Ñ—Ç–∞</Label>\n                      <Select value={params.hasFreightElevator ? 'freight' : 'passenger'} onValueChange={(value) => handleParamChange('hasFreightElevator', value === 'freight')}>\n                        <SelectTrigger className=\"bg-gray-700 border-gray-600\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"passenger\">–ü–∞—Å—Å–∞–∂–∏—Ä—Å–∫–∏–π</SelectItem>\n                          <SelectItem value=\"freight\">–ì—Ä—É–∑–æ–≤–æ–π</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div>\n                      <Label>–≠—Ç–∞–∂</Label>\n                      <Input\n                        type=\"number\"\n                        value={params.floor}\n                        onChange={(e) => handleParamChange('floor', parseInt(e.target.value) || 1)}\n                        className=\"bg-gray-700 border-gray-600\"\n                      />\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */}\n              <div className=\"flex space-x-3 pt-4\">\n                <Button\n                  onClick={runParser}\n                  disabled={isParserLoading}\n                  className=\"bg-blue-600 hover:bg-blue-700\"\n                >\n                  {isParserLoading ? (\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  ) : (\n                    <Play className=\"w-4 h-4 mr-2\" />\n                  )}\n                  –ü–∞—Ä—Å–µ—Ä\n                </Button>\n\n                <Button\n                  onClick={runApiComparison}\n                  disabled={isApiLoading}\n                  variant=\"outline\"\n                  className=\"border-gray-600 hover:bg-gray-700\"\n                >\n                  {isApiLoading ? (\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  ) : (\n                    <Play className=\"w-4 h-4 mr-2\" />\n                  )}\n                  API\n                </Button>\n\n                <Button\n                  onClick={runBoth}\n                  disabled={isParserLoading || isApiLoading}\n                  className=\"bg-green-600 hover:bg-green-700\"\n                >\n                  {isParserLoading || isApiLoading ? (\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  ) : (\n                    <Compare className=\"w-4 h-4 mr-2\" />\n                  )}\n                  –û–±–∞\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}\n          <div className=\"space-y-6\">\n            {/* –û—à–∏–±–∫–∏ */}\n            {error && (\n              <Card className=\"bg-red-900 border-red-700\">\n                <CardContent className=\"pt-6\">\n                  <p className=\"text-red-200\">‚ùå {error}</p>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞ */}\n            {parserResult && (\n              <Card className=\"bg-gray-800 border-gray-700\">\n                <CardHeader>\n                  <CardTitle className=\"text-xl text-green-400\">\n                    üï∑Ô∏è –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞\n                    {parserResult.parseTime && (\n                      <span className=\"text-sm text-gray-400 ml-2\">\n                        ({parserResult.parseTime}—Å)\n                      </span>\n                    )}\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold mb-4\">\n                    –ò—Ç–æ–≥–æ: {parserResult.totalCost.toLocaleString()} ‚ÇΩ\n                  </div>\n                  \n                  {parserResult.services.length > 0 && (\n                    <div className=\"space-y-2\">\n                      <h4 className=\"font-semibold\">–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è:</h4>\n                      {parserResult.services.map((service, index) => (\n                        <div key={index} className=\"flex justify-between text-sm\">\n                          <span>{service.name}</span>\n                          <span>{service.price.toLocaleString()} ‚ÇΩ</span>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n\n                  {parserResult.deliveryTime && (\n                    <div className=\"mt-4 text-sm text-gray-400\">\n                      –°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏: {parserResult.deliveryTime}\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            )}\n\n            {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã API */}\n            {apiResult && (\n              <Card className=\"bg-gray-800 border-gray-700\">\n                <CardHeader>\n                  <CardTitle className=\"text-xl text-blue-400\">üîå –†–µ–∑—É–ª—å—Ç–∞—Ç—ã API</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold mb-4\">\n                    –ò—Ç–æ–≥–æ: {apiResult.price.toLocaleString()} ‚ÇΩ\n                  </div>\n                  \n                  {apiResult.details?.service && (\n                    <div className=\"space-y-2\">\n                      <h4 className=\"font-semibold\">–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è:</h4>\n                      {apiResult.details.service.map((service: any, index: number) => (\n                        <div key={index} className=\"flex justify-between text-sm\">\n                          <span>{service.name}</span>\n                          <span>{service.price.toLocaleString()} ‚ÇΩ</span>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n\n                  <div className=\"mt-4 text-sm text-gray-400\">\n                    –°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏: {apiResult.days} –¥–Ω–µ–π\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* –°—Ä–∞–≤–Ω–µ–Ω–∏–µ */}\n            {difference && (\n              <Card className=\"bg-gray-800 border-gray-700\">\n                <CardHeader>\n                  <CardTitle className=\"text-xl text-yellow-400\">üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-3\">\n                    <div className=\"flex justify-between\">\n                      <span>–†–∞–∑–Ω–∏—Ü–∞:</span>\n                      <span className={`font-bold ${difference.parserMore ? 'text-red-400' : 'text-green-400'}`}>\n                        {difference.parserMore ? '+' : ''}{difference.absolute.toLocaleString()} ‚ÇΩ\n                      </span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span>–†–∞–∑–Ω–∏—Ü–∞ –≤ %:</span>\n                      <span className={`font-bold ${difference.parserMore ? 'text-red-400' : 'text-green-400'}`}>\n                        {difference.parserMore ? '+' : ''}{difference.percent}%\n                      </span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span>–¢–æ—á–Ω–µ–µ:</span>\n                      <span className=\"font-bold text-green-400\">\n                        {difference.parserMore ? 'API' : '–ü–∞—Ä—Å–µ—Ä'}\n                      </span>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}",
        "after": "\"use client\";\n\nimport { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Loader2, Play, GitCompare } from 'lucide-react';\n\ninterface VozovozParserParams {\n  fromCity: string;\n  toCity: string;\n  fromAddressDelivery: boolean;\n  toAddressDelivery: boolean;\n  fromAddress?: string;\n  toAddress?: string;\n  length: number;\n  width: number;\n  height: number;\n  weight: number;\n  needInsurance: boolean;\n  declaredValue?: number;\n  needPackaging: boolean;\n  needLoading: boolean;\n  hasFreightElevator: boolean;\n  floor: number;\n}\n\ninterface ParsedResult {\n  totalCost: number;\n  services: ServiceItem[];\n  deliveryTime?: string;\n  warnings?: string[];\n  parseTime?: number;\n}\n\ninterface ServiceItem {\n  name: string;\n  basePrice?: number;\n  price: number;\n  discount?: number;\n}\n\ninterface ApiResult {\n  price: number;\n  days: number;\n  details?: any;\n  error?: string;\n}\n\nexport default function VozovozParserPage() {\n  const [params, setParams] = useState<VozovozParserParams>({\n    fromCity: '–ú–æ—Å–∫–≤–∞',\n    toCity: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n    fromAddressDelivery: false,\n    toAddressDelivery: true,\n    fromAddress: '',\n    toAddress: '–ù–µ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç –¥.132',\n    length: 200,\n    width: 100,\n    height: 100,\n    weight: 100,\n    needInsurance: false,\n    declaredValue: 0,\n    needPackaging: false,\n    needLoading: false,\n    hasFreightElevator: false,\n    floor: 1\n  });\n\n  const [parserResult, setParserResult] = useState<ParsedResult | null>(null);\n  const [apiResult, setApiResult] = useState<ApiResult | null>(null);\n  const [isParserLoading, setIsParserLoading] = useState(false);\n  const [isApiLoading, setIsApiLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const handleParamChange = (key: keyof VozovozParserParams, value: any) => {\n    setParams(prev => ({ ...prev, [key]: value }));\n  };\n\n  const runParser = async () => {\n    setIsParserLoading(true);\n    setError(null);\n    setParserResult(null);\n\n    try {\n      const response = await fetch('/api/vozovoz-parser', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(params),\n      });\n\n      if (!response.ok) {\n        throw new Error(`–û—à–∏–±–∫–∞ HTTP: ${response.status}`);\n      }\n\n      const result = await response.json();\n      \n      if (result.error) {\n        throw new Error(result.error);\n      }\n\n      setParserResult(result);\n    } catch (err: any) {\n      setError(err.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–∞—Ä—Å–µ—Ä–∞');\n    } finally {\n      setIsParserLoading(false);\n    }\n  };\n\n  const runApiComparison = async () => {\n    setIsApiLoading(true);\n    setApiResult(null);\n\n    try {\n      // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è API –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –æ—Å–Ω–æ–≤–Ω–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é\n      const maxDimensions = {\n        length: params.length / 1000, // –ø–µ—Ä–µ–≤–æ–¥–∏–º –º–º –≤ –º\n        width: params.width / 1000,\n        height: params.height / 1000,\n        weight: params.weight\n      };\n\n      const totalVolume = (params.length * params.width * params.height) / 1000000000; // –º¬≥\n      const totalWeight = params.weight;\n\n      const requestData = {\n        object: \"price\",\n        action: \"get\",\n        params: {\n          cargo: {\n            dimension: {\n              max: maxDimensions,\n              quantity: 1,\n              volume: totalVolume,\n              weight: totalWeight\n            },\n            ...(params.needInsurance && params.declaredValue > 0 ? {\n              insurance: params.declaredValue,\n              insuranceNdv: false\n            } : {\n              insuranceNdv: true\n            }),\n            ...(params.needPackaging ? {\n              wrapping: {\n                \"hardPackageVolume\": totalVolume\n              }\n            } : {})\n          },\n          gateway: {\n            dispatch: {\n              point: {\n                location: params.fromCity,\n                ...(params.fromAddressDelivery ? {\n                  address: params.fromAddress || \"–∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\"\n                } : {\n                  terminal: \"default\"\n                })\n              }\n            },\n            destination: {\n              point: {\n                location: params.toCity,\n                ...(params.toAddressDelivery ? {\n                  address: params.toAddress || \"–∞–¥—Ä–µ—Å –ø–æ–ª—É—á–µ–Ω–∏—è\"\n                } : {\n                  terminal: \"default\"\n                })\n              }\n            }\n          }\n        }\n      };\n\n      const response = await fetch('/api/vozovoz', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(requestData),\n      });\n\n      if (!response.ok) {\n        throw new Error(`–û—à–∏–±–∫–∞ API: ${response.status}`);\n      }\n\n      const result = await response.json();\n      \n      if (result.error) {\n        throw new Error(result.error);\n      }\n\n      setApiResult({\n        price: result.response?.price || 0,\n        days: result.response?.deliveryTime?.to || 1,\n        details: result.response\n      });\n    } catch (err: any) {\n      setError(err.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ API –∑–∞–ø—Ä–æ—Å–∞');\n    } finally {\n      setIsApiLoading(false);\n    }\n  };\n\n  const runBoth = async () => {\n    await Promise.all([runParser(), runApiComparison()]);\n  };\n\n  const calculateDifference = () => {\n    if (!parserResult || !apiResult) return null;\n    \n    const diff = parserResult.totalCost - apiResult.price;\n    const percent = ((diff / apiResult.price) * 100).toFixed(1);\n    \n    return {\n      absolute: diff,\n      percent: parseFloat(percent),\n      parserMore: diff > 0\n    };\n  };\n\n  const difference = calculateDifference();\n\n  return (\n    <div className=\"min-h-screen bg-gray-900 text-white p-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"mb-6\">\n          <h1 className=\"text-3xl font-bold mb-2\">üï∑Ô∏è –ü–∞—Ä—Å–µ—Ä Vozovoz</h1>\n          <p className=\"text-gray-400\">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ –≤–µ–±-–ø–∞—Ä—Å–∏–Ω–≥ —Å–∞–π—Ç–∞</p>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          {/* –§–æ—Ä–º–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ */}\n          <Card className=\"bg-gray-800 border-gray-700\">\n            <CardHeader>\n              <CardTitle className=\"text-xl\">üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥—Ä—É–∑–∞</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {/* –ú–∞—Ä—à—Ä—É—Ç */}\n              <div className=\"space-y-3\">\n                <h3 className=\"text-lg font-semibold text-blue-400\">üõ£Ô∏è –ú–∞—Ä—à—Ä—É—Ç</h3>\n                \n                <div>\n                  <Label>–ì–æ—Ä–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</Label>\n                  <Input\n                    value={params.fromCity}\n                    onChange={(e) => handleParamChange('fromCity', e.target.value)}\n                    placeholder=\"–ú–æ—Å–∫–≤–∞\"\n                    className=\"bg-gray-700 border-gray-600\"\n                  />\n                </div>\n\n                <div className=\"flex items-center space-x-4\">\n                  <Checkbox\n                    checked={params.fromAddressDelivery}\n                    onCheckedChange={(checked) => handleParamChange('fromAddressDelivery', checked)}\n                  />\n                  <Label>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç –∞–¥—Ä–µ—Å–∞</Label>\n                </div>\n\n                {params.fromAddressDelivery && (\n                  <div>\n                    <Label>–ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</Label>\n                    <Input\n                      value={params.fromAddress}\n                      onChange={(e) => handleParamChange('fromAddress', e.target.value)}\n                      placeholder=\"–ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\"\n                      className=\"bg-gray-700 border-gray-600\"\n                    />\n                  </div>\n                )}\n\n                <div>\n                  <Label>–ì–æ—Ä–æ–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</Label>\n                  <Input\n                    value={params.toCity}\n                    onChange={(e) => handleParamChange('toCity', e.target.value)}\n                    placeholder=\"–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥\"\n                    className=\"bg-gray-700 border-gray-600\"\n                  />\n                </div>\n\n                <div className=\"flex items-center space-x-4\">\n                  <Checkbox\n                    checked={params.toAddressDelivery}\n                    onCheckedChange={(checked) => handleParamChange('toAddressDelivery', checked)}\n                  />\n                  <Label>–î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –∞–¥—Ä–µ—Å–∞</Label>\n                </div>\n\n                {params.toAddressDelivery && (\n                  <div>\n                    <Label>–ê–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</Label>\n                    <Input\n                      value={params.toAddress}\n                      onChange={(e) => handleParamChange('toAddress', e.target.value)}\n                      placeholder=\"–ê–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è\"\n                      className=\"bg-gray-700 border-gray-600\"\n                    />\n                  </div>\n                )}\n              </div>\n\n              {/* –ì–∞–±–∞—Ä–∏—Ç—ã */}\n              <div className=\"space-y-3\">\n                <h3 className=\"text-lg font-semibold text-green-400\">üì¶ –ì–∞–±–∞—Ä–∏—Ç—ã –∏ –≤–µ—Å</h3>\n                \n                <div className=\"grid grid-cols-2 gap-3\">\n                  <div>\n                    <Label>–î–ª–∏–Ω–∞ (—Å–º)</Label>\n                    <Input\n                      type=\"number\"\n                      value={params.length}\n                      onChange={(e) => handleParamChange('length', parseInt(e.target.value) || 0)}\n                      className=\"bg-gray-700 border-gray-600\"\n                    />\n                  </div>\n                  <div>\n                    <Label>–®–∏—Ä–∏–Ω–∞ (—Å–º)</Label>\n                    <Input\n                      type=\"number\"\n                      value={params.width}\n                      onChange={(e) => handleParamChange('width', parseInt(e.target.value) || 0)}\n                      className=\"bg-gray-700 border-gray-600\"\n                    />\n                  </div>\n                  <div>\n                    <Label>–í—ã—Å–æ—Ç–∞ (—Å–º)</Label>\n                    <Input\n                      type=\"number\"\n                      value={params.height}\n                      onChange={(e) => handleParamChange('height', parseInt(e.target.value) || 0)}\n                      className=\"bg-gray-700 border-gray-600\"\n                    />\n                  </div>\n                  <div>\n                    <Label>–í–µ—Å (–∫–≥)</Label>\n                    <Input\n                      type=\"number\"\n                      value={params.weight}\n                      onChange={(e) => handleParamChange('weight', parseInt(e.target.value) || 0)}\n                      className=\"bg-gray-700 border-gray-600\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n              {/* –î–æ–ø —É—Å–ª—É–≥–∏ */}\n              <div className=\"space-y-3\">\n                <h3 className=\"text-lg font-semibold text-yellow-400\">üõ°Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏</h3>\n                \n                <div className=\"flex items-center space-x-4\">\n                  <Checkbox\n                    checked={params.needInsurance}\n                    onCheckedChange={(checked) => handleParamChange('needInsurance', checked)}\n                  />\n                  <Label>–¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞</Label>\n                </div>\n\n                {params.needInsurance && (\n                  <div>\n                    <Label>–û–±—ä—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)</Label>\n                    <Input\n                      type=\"number\"\n                      value={params.declaredValue}\n                      onChange={(e) => handleParamChange('declaredValue', parseInt(e.target.value) || 0)}\n                      placeholder=\"50000\"\n                      className=\"bg-gray-700 border-gray-600\"\n                    />\n                  </div>\n                )}\n\n                <div className=\"flex items-center space-x-4\">\n                  <Checkbox\n                    checked={params.needPackaging}\n                    onCheckedChange={(checked) => handleParamChange('needPackaging', checked)}\n                  />\n                  <Label>–¢—Ä–µ–±—É–µ—Ç—Å—è —É–ø–∞–∫–æ–≤–∫–∞</Label>\n                </div>\n\n                <div className=\"flex items-center space-x-4\">\n                  <Checkbox\n                    checked={params.needLoading}\n                    onCheckedChange={(checked) => handleParamChange('needLoading', checked)}\n                  />\n                  <Label>–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≥—Ä—É–∑–∫–∞/—Ä–∞–∑–≥—Ä—É–∑–∫–∞</Label>\n                </div>\n\n                {params.needLoading && (\n                  <div className=\"grid grid-cols-2 gap-3\">\n                    <div>\n                      <Label>–ù–∞–ª–∏—á–∏–µ –≥—Ä—É–∑–æ–≤–æ–≥–æ –ª–∏—Ñ—Ç–∞</Label>\n                      <Select value={params.hasFreightElevator ? 'freight' : 'passenger'} onValueChange={(value) => handleParamChange('hasFreightElevator', value === 'freight')}>\n                        <SelectTrigger className=\"bg-gray-700 border-gray-600\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"passenger\">–ü–∞—Å—Å–∞–∂–∏—Ä—Å–∫–∏–π</SelectItem>\n                          <SelectItem value=\"freight\">–ì—Ä—É–∑–æ–≤–æ–π</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div>\n                      <Label>–≠—Ç–∞–∂</Label>\n                      <Input\n                        type=\"number\"\n                        value={params.floor}\n                        onChange={(e) => handleParamChange('floor', parseInt(e.target.value) || 1)}\n                        className=\"bg-gray-700 border-gray-600\"\n                      />\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */}\n              <div className=\"flex space-x-3 pt-4\">\n                <Button\n                  onClick={runParser}\n                  disabled={isParserLoading}\n                  className=\"bg-blue-600 hover:bg-blue-700\"\n                >\n                  {isParserLoading ? (\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  ) : (\n                    <Play className=\"w-4 h-4 mr-2\" />\n                  )}\n                  –ü–∞—Ä—Å–µ—Ä\n                </Button>\n\n                <Button\n                  onClick={runApiComparison}\n                  disabled={isApiLoading}\n                  variant=\"outline\"\n                  className=\"border-gray-600 hover:bg-gray-700\"\n                >\n                  {isApiLoading ? (\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  ) : (\n                    <Play className=\"w-4 h-4 mr-2\" />\n                  )}\n                  API\n                </Button>\n\n                <Button\n                  onClick={runBoth}\n                  disabled={isParserLoading || isApiLoading}\n                  className=\"bg-green-600 hover:bg-green-700\"\n                >\n                  {isParserLoading || isApiLoading ? (\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  ) : (\n                    <Compare className=\"w-4 h-4 mr-2\" />\n                  )}\n                  –û–±–∞\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}\n          <div className=\"space-y-6\">\n            {/* –û—à–∏–±–∫–∏ */}\n            {error && (\n              <Card className=\"bg-red-900 border-red-700\">\n                <CardContent className=\"pt-6\">\n                  <p className=\"text-red-200\">‚ùå {error}</p>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞ */}\n            {parserResult && (\n              <Card className=\"bg-gray-800 border-gray-700\">\n                <CardHeader>\n                  <CardTitle className=\"text-xl text-green-400\">\n                    üï∑Ô∏è –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞\n                    {parserResult.parseTime && (\n                      <span className=\"text-sm text-gray-400 ml-2\">\n                        ({parserResult.parseTime}—Å)\n                      </span>\n                    )}\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold mb-4\">\n                    –ò—Ç–æ–≥–æ: {parserResult.totalCost.toLocaleString()} ‚ÇΩ\n                  </div>\n                  \n                  {parserResult.services.length > 0 && (\n                    <div className=\"space-y-2\">\n                      <h4 className=\"font-semibold\">–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è:</h4>\n                      {parserResult.services.map((service, index) => (\n                        <div key={index} className=\"flex justify-between text-sm\">\n                          <span>{service.name}</span>\n                          <span>{service.price.toLocaleString()} ‚ÇΩ</span>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n\n                  {parserResult.deliveryTime && (\n                    <div className=\"mt-4 text-sm text-gray-400\">\n                      –°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏: {parserResult.deliveryTime}\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            )}\n\n            {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã API */}\n            {apiResult && (\n              <Card className=\"bg-gray-800 border-gray-700\">\n                <CardHeader>\n                  <CardTitle className=\"text-xl text-blue-400\">üîå –†–µ–∑—É–ª—å—Ç–∞—Ç—ã API</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold mb-4\">\n                    –ò—Ç–æ–≥–æ: {apiResult.price.toLocaleString()} ‚ÇΩ\n                  </div>\n                  \n                  {apiResult.details?.service && (\n                    <div className=\"space-y-2\">\n                      <h4 className=\"font-semibold\">–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è:</h4>\n                      {apiResult.details.service.map((service: any, index: number) => (\n                        <div key={index} className=\"flex justify-between text-sm\">\n                          <span>{service.name}</span>\n                          <span>{service.price.toLocaleString()} ‚ÇΩ</span>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n\n                  <div className=\"mt-4 text-sm text-gray-400\">\n                    –°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏: {apiResult.days} –¥–Ω–µ–π\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* –°—Ä–∞–≤–Ω–µ–Ω–∏–µ */}\n            {difference && (\n              <Card className=\"bg-gray-800 border-gray-700\">\n                <CardHeader>\n                  <CardTitle className=\"text-xl text-yellow-400\">üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-3\">\n                    <div className=\"flex justify-between\">\n                      <span>–†–∞–∑–Ω–∏—Ü–∞:</span>\n                      <span className={`font-bold ${difference.parserMore ? 'text-red-400' : 'text-green-400'}`}>\n                        {difference.parserMore ? '+' : ''}{difference.absolute.toLocaleString()} ‚ÇΩ\n                      </span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span>–†–∞–∑–Ω–∏—Ü–∞ –≤ %:</span>\n                      <span className={`font-bold ${difference.parserMore ? 'text-red-400' : 'text-green-400'}`}>\n                        {difference.parserMore ? '+' : ''}{difference.percent}%\n                      </span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span>–¢–æ—á–Ω–µ–µ:</span>\n                      <span className=\"font-bold text-green-400\">\n                        {difference.parserMore ? 'API' : '–ü–∞—Ä—Å–µ—Ä'}\n                      </span>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}",
        "additions": 1,
        "deletions": 1
      }
    },
    "time": {
      "start": 1764357660163,
      "end": 1764357660169
    }
  }
}