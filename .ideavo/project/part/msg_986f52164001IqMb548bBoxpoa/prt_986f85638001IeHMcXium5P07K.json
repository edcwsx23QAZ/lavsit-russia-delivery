{
  "id": "prt_986f85638001IeHMcXium5P07K",
  "messageID": "msg_986f52164001IqMb548bBoxpoa",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "write",
  "callID": "toolu_01LZFZWYeqVNgD6Kuc97riVV",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/api/pek-simple/route.ts",
      "content": "import { NextRequest, NextResponse } from 'next/server';\n\nexport async function POST(request: NextRequest) {\n  try {\n    console.log('üîß –ü–≠–ö Simple: –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å');\n    \n    const requestData = await request.json();\n    console.log('üìù –î–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞:', JSON.stringify(requestData, null, 2));\n    \n    const { method } = requestData;\n    \n    if (method === 'test') {\n      return NextResponse.json({ \n        status: 'OK', \n        message: '–ü—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–æ–∫—Å–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç',\n        env: {\n          hasLogin: !!process.env.PEK_LOGIN,\n          hasKey: !!process.env.PEK_API_KEY,\n          login: process.env.PEK_LOGIN?.substring(0, 3) + '***'\n        }\n      });\n    }\n    \n    // –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\n    const PEK_API_KEY = process.env.PEK_API_KEY;\n    const PEK_LOGIN = process.env.PEK_LOGIN;\n    \n    if (!PEK_LOGIN || !PEK_API_KEY) {\n      return NextResponse.json({ \n        error: '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏',\n        hasLogin: !!PEK_LOGIN,\n        hasKey: !!PEK_API_KEY\n      }, { status: 500 });\n    }\n    \n    // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ –∫ –ü–≠–ö\n    if (method === 'direct') {\n      const credentials = Buffer.from(`${PEK_LOGIN}:${PEK_API_KEY}`).toString('base64');\n      \n      console.log('üåê –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ –ü–≠–ö API');\n      \n      const response = await fetch('https://kabinet.pecom.ru/api/v1/branches/findzonebyaddress/', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json;charset=utf-8',\n          'Accept': 'application/json',\n          'Authorization': `Basic ${credentials}`,\n        },\n        body: JSON.stringify({ address: '–≥ –ú–æ—Å–∫–≤–∞, –®–º–∏—Ç–æ–≤—Å–∫–∏–π –ø—Ä–æ–µ–∑–¥, –¥ 1' })\n      });\n      \n      console.log('üì° –û—Ç–≤–µ—Ç –ü–≠–ö:', response.status, response.statusText);\n      \n      const responseText = await response.text();\n      console.log('üìÑ –¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞:', responseText.substring(0, 200));\n      \n      if (response.ok) {\n        try {\n          const data = JSON.parse(responseText);\n          return NextResponse.json(data);\n        } catch (e) {\n          return NextResponse.json({ error: '–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞', raw: responseText });\n        }\n      } else {\n        return NextResponse.json({ \n          error: 'API –æ—à–∏–±–∫–∞',\n          status: response.status,\n          response: responseText \n        }, { status: response.status });\n      }\n    }\n    \n    return NextResponse.json({ error: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –º–µ—Ç–æ–¥', method });\n    \n  } catch (error) {\n    console.error('‚ùå –û—à–∏–±–∫–∞:', error);\n    return NextResponse.json({ \n      error: '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞',\n      details: error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'\n    }, { status: 500 });\n  }\n}"
    },
    "output": "",
    "metadata": {
      "diagnostics": {},
      "filepath": "/home/user/project/app/api/pek-simple/route.ts",
      "exists": false
    },
    "title": "app/api/pek-simple/route.ts",
    "time": {
      "start": 1758906056962,
      "end": 1758906056964
    }
  }
}