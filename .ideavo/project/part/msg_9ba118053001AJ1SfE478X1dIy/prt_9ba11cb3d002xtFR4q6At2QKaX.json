{
  "id": "prt_9ba11cb3d002xtFR4q6At2QKaX",
  "messageID": "msg_9ba118053001AJ1SfE478X1dIy",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "read",
  "callID": "toolu_01QCsUV4KNnJfVxsDBjT3kAd",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/lib/form-storage.ts"
    },
    "output": "<file>\n00001| 'use client';\n00002| \n00003| // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –∫–ª—é—á–µ–π localStorage\n00004| const FORM_DATA_KEY = 'deliveryFormData';\n00005| const FORM_VERSION = '1.1'; // –î–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–¥–æ–±–∞–≤–ª–µ–Ω fromLavsiteWarehouse)\n00006| \n00007| export interface StoredFormData {\n00008|   version: string;\n00009|   timestamp: number;\n00010|   cargos: Array<{\n00011|     id: string;\n00012|     length: number;\n00013|     width: number;\n00014|     height: number;\n00015|     weight: number;\n00016|   }>;\n00017|   fromCity: string;\n00018|   toCity: string;\n00019|   fromAddress: string;\n00020|   toAddress: string;\n00021|   declaredValue: number;\n00022|   needPackaging: boolean;\n00023|   needLoading: boolean;\n00024|   needCarry: boolean;\n00025|   floor: number;\n00026|   hasFreightLift: boolean;\n00027|   needInsurance: boolean;\n00028|   fromTerminal: boolean;\n00029|   toTerminal: boolean;\n00030|   fromAddressDelivery: boolean;\n00031|   toAddressDelivery: boolean;\n00032|   fromLavsiteWarehouse: boolean;\n00033|   selectedProducts: Array<{\n00034|     product: {\n00035|       id: string;\n00036|       externalCode: string;\n00037|       name: string;\n00038|       retailPrice: number;\n00039|       isActive: boolean;\n00040|       cargoPlaces: Array<{\n00041|         placeNumber: number;\n00042|         weight: number;\n00043|         height: number;\n00044|         depth: number;\n00045|         length: number;\n00046|       }>;\n00047|     };\n00048|     quantity: number;\n00049|     totalPrice: number;\n00050|     cargoIndexes: number[];\n00051|     addedAt: number;\n00052|   }>;\n00053| }\n00054| \n00055| /**\n00056|  * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –≤ localStorage\n00057|  * –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤ - —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥\n00058|  */\n00059| export const saveFormData = (formData: Partial<StoredFormData>): boolean => {\n00060|   try {\n00061|     if (typeof window === 'undefined') {\n00062|       return false; // SSR safe\n00063|     }\n00064| \n00065|     const dataToSave: StoredFormData = {\n00066|       version: FORM_VERSION,\n00067|       timestamp: Date.now(),\n00068|       cargos: formData.cargos || [],\n00069|       fromCity: formData.fromCity || '',\n00070|       toCity: formData.toCity || '',\n00071|       fromAddress: formData.fromAddress || '',\n00072|       toAddress: formData.toAddress || '',\n00073|       declaredValue: formData.declaredValue || 0,\n00074|       needPackaging: formData.needPackaging || false,\n00075|       needLoading: formData.needLoading || false,\n00076|       needCarry: formData.needCarry || false,\n00077|       floor: formData.floor || 1,\n00078|       hasFreightLift: formData.hasFreightLift || false,\n00079|       needInsurance: formData.needInsurance || false,\n00080|       fromTerminal: formData.fromTerminal ?? true,\n00081|       toTerminal: formData.toTerminal ?? true,\n00082|       fromAddressDelivery: formData.fromAddressDelivery || false,\n00083|       toAddressDelivery: formData.toAddressDelivery || false,\n00084|       fromLavsiteWarehouse: formData.fromLavsiteWarehouse || false,\n00085|       selectedProducts: formData.selectedProducts || [],\n00086|     };\n00087| \n00088|     localStorage.setItem(FORM_DATA_KEY, JSON.stringify(dataToSave));\n00089|     console.log('üíæ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage:', dataToSave);\n00090|     return true;\n00091|   } catch (error) {\n00092|     console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã:', error);\n00093|     return false;\n00094|   }\n00095| };\n00096| \n00097| /**\n00098|  * –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –∏–∑ localStorage\n00099|  */\n00100| export const loadFormData = (): StoredFormData | null => {\n00101|   try {\n00102|     if (typeof window === 'undefined') {\n00103|       return null; // SSR safe\n00104|     }\n00105| \n00106|     const savedData = localStorage.getItem(FORM_DATA_KEY);\n00107|     if (!savedData) {\n00108|       console.log('üìù –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');\n00109|       return null;\n00110|     }\n00111| \n00112|     const parsedData = JSON.parse(savedData) as StoredFormData;\n00113|     \n00114|     // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –¥–∞–Ω–Ω—ã—Ö\n00115|     if (parsedData.version !== FORM_VERSION) {\n00116|       console.warn('‚ö†Ô∏è –í–µ—Ä—Å–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è...');\n00117|       // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã\n00118|       return migrateFormData(parsedData);\n00119|     }\n00120| \n00121|     // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–∞–≤–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ - —É–¥–∞–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π)\n00122|     const thirtyDaysInMs = 30 * 24 * 60 * 60 * 1000;\n00123|     if (Date.now() - parsedData.timestamp > thirtyDaysInMs) {\n00124|       console.log('üóëÔ∏è –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä—ã–µ, —É–¥–∞–ª—è–µ–º...');\n00125|       clearFormData();\n00126|       return null;\n00127|     }\n00128| \n00129|     console.log('üìÇ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ localStorage:', parsedData);\n00130|     return parsedData;\n00131|   } catch (error) {\n00132|     console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã:', error);\n00133|     return null;\n00134|   }\n00135| };\n00136| \n00137| /**\n00138|  * –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã\n00139|  */\n00140| const migrateFormData = (oldData: any): StoredFormData | null => {\n00141|   try {\n00142|     // –ë–∞–∑–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è - –ø—Ä–∏–≤–æ–¥–∏–º –∫ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ\n00143|     const migratedData: StoredFormData = {\n00144|       version: FORM_VERSION,\n00145|       timestamp: Date.now(),\n00146|       cargos: oldData.cargos || [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00147|       fromCity: oldData.fromCity || '',\n00148|       toCity: oldData.toCity || '',\n00149|       fromAddress: oldData.fromAddress || '',\n00150|       toAddress: oldData.toAddress || '',\n00151|       declaredValue: oldData.declaredValue || 0,\n00152|       needPackaging: oldData.needPackaging || false,\n00153|       needLoading: oldData.needLoading || false,\n00154|       needCarry: oldData.needCarry || false,\n00155|       floor: oldData.floor || 1,\n00156|       hasFreightLift: oldData.hasFreightLift || false,\n00157|       needInsurance: oldData.needInsurance || false,\n00158|       fromTerminal: oldData.fromTerminal ?? true,\n00159|       toTerminal: oldData.toTerminal ?? true,\n00160|       fromAddressDelivery: oldData.fromAddressDelivery || false,\n00161|       toAddressDelivery: oldData.toAddressDelivery || false,\n00162|       fromLavsiteWarehouse: oldData.fromLavsiteWarehouse || false,\n00163|       selectedProducts: oldData.selectedProducts || [],\n00164|     };\n00165| \n00166|     // –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n00167|     localStorage.setItem(FORM_DATA_KEY, JSON.stringify(migratedData));\n00168|     console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã');\n00169|     return migratedData;\n00170|   } catch (error) {\n00171|     console.error('‚ùå –û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);\n00172|     return null;\n00173|   }\n00174| };\n00175| \n00176| /**\n00177|  * –û—á–∏—â–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã\n00178|  */\n00179| export const clearFormData = (): boolean => {\n00180|   try {\n00181|     if (typeof window === 'undefined') {\n00182|       return false;\n00183|     }\n00184| \n00185|     localStorage.removeItem(FORM_DATA_KEY);\n00186|     console.log('üóëÔ∏è –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —É–¥–∞–ª–µ–Ω—ã –∏–∑ localStorage');\n00187|     return true;\n00188|   } catch (error) {\n00189|     console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã:', error);\n00190|     return false;\n00191|   }\n00192| };\n00193| \n00194| /**\n00195|  * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n00196|  */\n00197| export const hasStoredFormData = (): boolean => {\n00198|   try {\n00199|     if (typeof window === 'undefined') {\n00200|       return false;\n00201|     }\n00202| \n00203|     return localStorage.getItem(FORM_DATA_KEY) !== null;\n00204|   } catch (error) {\n00205|     return false;\n00206|   }\n00207| };\n00208| \n00209| /**\n00210|  * –î–µ–±–∞—É–Ω—Å —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è\n00211|  */\n00212| export const createDebouncedSaver = (delay: number = 1000) => {\n00213|   let timeoutId: NodeJS.Timeout;\n00214|   \n00215|   return (formData: Partial<StoredFormData>) => {\n00216|     clearTimeout(timeoutId);\n00217|     timeoutId = setTimeout(() => {\n00218|       saveFormData(formData);\n00219|     }, delay);\n00220|   };\n00221| };\n</file>",
    "metadata": {
      "preview": "'use client';\n\n// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –∫–ª—é—á–µ–π localStorage\nconst FORM_DATA_KEY = 'deliveryFormData';\nconst FORM_VERSION = '1.1'; // –î–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–¥–æ–±–∞–≤–ª–µ–Ω fromLavsiteWarehouse)\n\nexport interface StoredFormData {\n  version: string;\n  timestamp: number;\n  cargos: Array<{\n    id: string;\n    length: number;\n    width: number;\n    height: number;\n    weight: number;\n  }>;\n  fromCity: string;\n  toCity: string;\n  fromAddress: string;\n  toAddress: string;"
    },
    "title": "lib/form-storage.ts",
    "time": {
      "start": 1759763352757,
      "end": 1759763352761
    }
  }
}