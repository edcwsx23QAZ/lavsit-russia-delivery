{
  "id": "prt_ab89467860010Rvzy9MD0pDt86",
  "sessionID": "ses_54b97e247ffenCZZa4jZiIWD0l",
  "messageID": "msg_ab8937e910014wfycMA5aiolU4",
  "type": "tool",
  "callID": "call_61b634197d674f52bd58e400",
  "tool": "write",
  "state": {
    "status": "completed",
    "input": {
      "content": "// Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð¿Ð°Ñ€ÑÐ¸Ð½Ð³Ð° NordWheel API\n\nconst testData = {\n  \"auto\": {\n    \"total_amount\": 83645,\n    \"delivery_date\": \"2025-11-26\",\n    \"services\": [\n      {\n        \"id\": \"c9d0e1f2-g3h4-5678-cdef-901234567890\",\n        \"name\": \"Ð­ÐºÑÐ¿ÐµÐ´Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¼ÐµÐ¶Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»ÑŒÐ½Ð¾Ðµ (ÐºÐ³)\",\n        \"price\": 12.9,\n        \"quantity\": 6474.6,\n        \"measure\": \"ÐºÐ³\",\n        \"amount\": 83522\n      },\n      {\n        \"id\": \"v2w3x4y5-z6a7-8901-vwxy-234567890123\",\n        \"name\": \"Ð¡Ñ‚Ñ€Ð°Ñ…Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð³Ñ€ÑƒÐ·Ð°\",\n        \"price\": 122.78,\n        \"quantity\": 1,\n        \"measure\": \"ÑˆÑ‚\",\n        \"amount\": 123\n      }\n    ]\n  },\n  \"avia\": {\n    \"total_amount\": 97663,\n    \"services\": [\n      {\n        \"id\": \"a1b2c3d4-e5f6-7890-abcd-ef1234567890\",\n        \"name\": \"ÐÐ²Ð¸Ð°Ð¿ÐµÑ€ÐµÐ²Ð¾Ð·ÐºÐ°\",\n        \"price\": 96330,\n        \"quantity\": 1,\n        \"measure\": \"ÑˆÑ‚\",\n        \"amount\": 96330\n      },\n      {\n        \"id\": \"a4bfb8d1-6bd7-4065-9972-2cf3563919b8\",\n        \"name\": \"ÐÐ²Ð¸Ð°Ð½Ð°ÐºÐ»Ð°Ð´Ð½Ð°Ñ\",\n        \"price\": 1210,\n        \"quantity\": 1,\n        \"measure\": \"ÑˆÑ‚\",\n        \"amount\": 1210\n      },\n      {\n        \"id\": \"v2w3x4y5-z6a7-8901-vwxy-234567890123\",\n        \"name\": \"Ð¡Ñ‚Ñ€Ð°Ñ…Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð³Ñ€ÑƒÐ·Ð°\",\n        \"price\": 123,\n        \"quantity\": 1,\n        \"measure\": \"ÑˆÑ‚\",\n        \"amount\": 123\n      }\n    ],\n    \"delivery_date\": \"2025-11-28\"\n  }\n};\n\n// Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¿Ð°Ñ€ÑÐ¸Ð½Ð³Ð° Ð¸Ð· Ð½Ð°ÑˆÐµÐ³Ð¾ ÐºÐ¾Ð´Ð°\nfunction parseNordWheelResponse(data) {\n  console.log('ðŸ§ª Ð¢ÐµÑÑ‚ Ð¿Ð°Ñ€ÑÐ¸Ð½Ð³Ð° Ð¾Ñ‚Ð²ÐµÑ‚Ð° NordWheel API');\n  console.log('ðŸ“¥ Ð’Ñ…Ð¾Ð´Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ:', JSON.stringify(data, null, 2));\n  \n  let price = 0;\n  let days = 0;\n  let details = {};\n\n  // ÐÐ¾Ð²Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ API Ñ auto/avia Ð¾Ð±ÑŠÐµÐºÑ‚Ð°Ð¼Ð¸ (Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð±ÐµÐ· data.success)\n  if (data.auto || data.avia) {\n    const options = [];\n    \n    if (data.auto) {\n      const autoPrice = data.auto.total_amount || 0;\n      const autoDeliveryDate = data.auto.delivery_date || '';\n      \n      options.push({\n        type: 'auto',\n        price: autoPrice,\n        days: autoDeliveryDate, // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ ÐºÐ°Ðº ÑÑ‚Ñ€Ð¾ÐºÑƒ Ð´Ð»Ñ Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ¸\n        services: data.auto.services || []\n      });\n    }\n    \n    if (data.avia) {\n      const aviaPrice = data.avia.total_amount || 0;\n      const aviaDeliveryDate = data.avia.delivery_date || '';\n      \n      options.push({\n        type: 'avia',\n        price: aviaPrice,\n        days: aviaDeliveryDate, // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ ÐºÐ°Ðº ÑÑ‚Ñ€Ð¾ÐºÑƒ Ð´Ð»Ñ Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ¸\n        services: data.avia.services || []\n      });\n    }\n    \n    if (options.length === 0) {\n      console.error('âŒ Nord Wheel: ÐÐµÑ‚ Ð¾Ð¿Ñ†Ð¸Ð¹ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸ Ð² Ð¾Ñ‚Ð²ÐµÑ‚Ðµ:', data);\n      return {\n        error: 'ÐÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ñ… Ð¾Ð¿Ñ†Ð¸Ð¹ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸',\n        data\n      };\n    }\n    \n    // Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ ÑÐ°Ð¼Ñ‹Ð¹ Ð´ÐµÑˆÐµÐ²Ñ‹Ð¹ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚\n    const bestOption = options.reduce((best, current) => \n      current.price < best.price ? current : best\n    );\n    \n    price = bestOption.price;\n    \n    // Ð’Ñ‹Ñ‡Ð¸ÑÐ»ÑÐµÐ¼ Ð´Ð½Ð¸ Ð¸Ð· Ð´Ð°Ñ‚Ñ‹ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸\n    try {\n      if (bestOption.days && typeof bestOption.days === 'string') {\n        const deliveryDate = new Date(bestOption.days);\n        const today = new Date();\n        if (!isNaN(deliveryDate.getTime())) {\n          const diffTime = deliveryDate.getTime() - today.getTime();\n          days = Math.max(1, Math.ceil(diffTime / (1000 * 60 * 60 * 24)));\n        } else {\n          days = 3; // ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ\n        }\n      } else {\n        days = 3; // ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ\n      }\n    } catch (dateError) {\n      console.warn('âš ï¸ Nord Wheel: ÐžÑˆÐ¸Ð±ÐºÐ° Ñ€Ð°ÑÑ‡ÐµÑ‚Ð° Ð´Ð½ÐµÐ¹ Ð¸Ð· Ð´Ð°Ñ‚Ñ‹:', dateError);\n      days = 3;\n    }\n    \n    details = {\n      totalCost: price,\n      deliveryCost: price, // Ð’ Ð½Ð¾Ð²Ð¾Ð¼ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ Ð¾Ð±Ñ‰Ð°Ñ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð²ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ Ð²ÑÐµ\n      transportType: bestOption.type,\n      services: bestOption.services,\n      allOptions: options, // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð²ÑÐµ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹ Ð´Ð»Ñ Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ¸\n      currency: 'RUB',\n      deliveryDate: bestOption.days // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¸ÑÑ…Ð¾Ð´Ð½ÑƒÑŽ Ð´Ð°Ñ‚Ñƒ\n    };\n  } else if (data.price !== undefined) {\n    // Ð¡Ñ‚Ð°Ñ€Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð°\n    price = data.price;\n    days = data.days || data.delivery_time || 0;\n    details = {\n      totalCost: price,\n      currency: data.currency || 'RUB'\n    };\n  } else {\n    // Ð•ÑÐ»Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚ Ð½Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ñ†ÐµÐ½Ñ‹, Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ð¾ÑˆÐ¸Ð±ÐºÑƒ\n    console.error('âŒ Nord Wheel: ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð° API:', data);\n    return {\n      error: 'ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð° API',\n      data\n    };\n  }\n\n  return {\n    success: true,\n    price: Math.round(price),\n    days,\n    details\n  };\n}\n\n// Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ñ‚ÐµÑÑ‚\nconst result = parseNordWheelResponse(testData);\n\nconsole.log('\\nðŸ“Š Ð Ð•Ð—Ð£Ð›Ð¬Ð¢ÐÐ¢ ÐŸÐÐ Ð¡Ð˜ÐÐ“Ð:');\nconsole.log('âœ… Ð£ÑÐ¿ÐµÑˆÐ½Ð¾:', result.success);\nconsole.log('ðŸ’° Ð¦ÐµÐ½Ð°:', result.price);\nconsole.log('ðŸ“… Ð”Ð½ÐµÐ¹ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸:', result.days);\nconsole.log('ðŸ“‹ Ð”ÐµÑ‚Ð°Ð»Ð¸:', JSON.stringify(result.details, null, 2));\n\nif (result.success) {\n  console.log('\\nðŸŽ‰ ÐŸÐ°Ñ€ÑÐ¸Ð½Ð³ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾!');\n  console.log(`ðŸš› Ð’Ñ‹Ð±Ñ€Ð°Ð½ Ñ‚Ñ€Ð°Ð½ÑÐ¿Ð¾Ñ€Ñ‚: ${result.details.transportType}`);\n  console.log(`ðŸ“… Ð”Ð°Ñ‚Ð° Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸: ${result.details.deliveryDate}`);\n  console.log(`ðŸ’° Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ: ${result.price} â‚½`);\n} else {\n  console.log('\\nâŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ð°Ñ€ÑÐ¸Ð½Ð³Ð°:', result.error);\n}",
      "filePath": "/home/user/project/test-nordwheel-parsing.js"
    },
    "output": "",
    "title": "test-nordwheel-parsing.js",
    "metadata": {
      "diagnostics": {},
      "filepath": "/home/user/project/test-nordwheel-parsing.js",
      "exists": false
    },
    "time": {
      "start": 1764033324944,
      "end": 1764033324946
    }
  }
}