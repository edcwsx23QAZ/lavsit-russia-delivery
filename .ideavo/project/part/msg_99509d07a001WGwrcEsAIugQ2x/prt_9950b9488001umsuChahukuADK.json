{
  "id": "prt_9950b9488001umsuChahukuADK",
  "messageID": "msg_99509d07a001WGwrcEsAIugQ2x",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "read",
  "callID": "toolu_013AibYuEqDVctNFKBUZp4bz",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx"
    },
    "output": "<file>\n00001| 'use client';\n00002| \n00003| import React, { useState, useEffect, useCallback } from 'react';\n00004| import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\n00005| import { Button } from '@/components/ui/button';\n00006| import { Input } from '@/components/ui/input';\n00007| import { Label } from '@/components/ui/label';\n00008| import { Checkbox } from '@/components/ui/checkbox';\n00009| import { Plus, Truck, Building2, Map, Settings, Package2 } from 'lucide-react';\n00010| import { Alert, AlertDescription } from '@/components/ui/alert';\n00011| import { Badge } from '@/components/ui/badge';\n00012| import { Separator } from '@/components/ui/separator';\n00013| import { Collapsible, CollapsibleContent } from '@/components/ui/collapsible';\n00014| import ProductSearch from '@/components/ProductSearch';\n00015| import ProductManager from '@/components/ProductManager';\n00016| import TruckVisualization from '@/components/TruckVisualization';\n00017| import { FurnitureProduct, ProductInForm, CargoWithMetadata } from '@/lib/furniture-types';\n00018| import { \n00019|   createCargosForProduct, \n00020|   removeCargosForProduct, \n00021|   calculateTotalValue,\n00022|   findCargoIndexesForProduct \n00023| } from '@/lib/furniture-utils';\n00024| \n00025| interface Cargo {\n00026|   id: string;\n00027|   length: number;\n00028|   width: number;\n00029|   height: number;\n00030|   weight: number;\n00031|   // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–≤—è–∑–∏ —Å —Ç–æ–≤–∞—Ä–∞–º–∏\n00032|   productId?: string;\n00033|   placeNumber?: number;\n00034|   isFromProduct?: boolean;\n00035|   addedAt?: number;\n00036| }\n00037| \n00038| interface DeliveryForm {\n00039|   cargos: Cargo[];\n00040|   fromCity: string;\n00041|   toCity: string;\n00042|   fromAddress: string;\n00043|   toAddress: string;\n00044|   declaredValue: number;\n00045|   needPackaging: boolean;\n00046|   needLoading: boolean;\n00047|   needCarry: boolean;\n00048|   floor: number;\n00049|   hasFreightLift: boolean;\n00050|   needInsurance: boolean;\n00051|   fromTerminal: boolean;\n00052|   toTerminal: boolean;\n00053|   fromAddressDelivery: boolean;\n00054|   toAddressDelivery: boolean;\n00055|   // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ç–æ–≤–∞—Ä–æ–≤\n00056|   selectedProducts: ProductInForm[];\n00057| }\n00058| \n00059| interface CalculationResult {\n00060|   company: string;\n00061|   price: number;\n00062|   days: number;\n00063|   details?: any;\n00064|   error?: string;\n00065|   requestData?: any;\n00066|   responseData?: any;\n00067|   apiUrl?: string;\n00068|   sessionId?: string;\n00069| }\n00070| \n00071| interface AddressSuggestion {\n00072|   value: string;\n00073|   unrestricted_value: string;\n00074|   data: {\n00075|     city?: string;\n00076|     street?: string;\n00077|     house?: string;\n00078|   };\n00079| }\n00080| \n00081| // –û–ø—Ä–µ–¥–µ–ª–∏–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–º–ø–∞–Ω–∏–π\n00082| const COMPANIES_BASE = [\n00083|   { name: '–ü–≠–ö', logo: 'üöõ', apiKey: 'pek' },\n00084|   { name: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏', logo: 'üì¶', apiKey: 'dellin' },\n00085|   { name: 'Rail Continent', logo: 'üöÇ', apiKey: 'railcontinent' },\n00086|   { name: '–í–æ–∑–æ–≤–æ–∑', logo: 'üöö', apiKey: 'vozovoz' },\n00087|   { name: 'Nord Wheel', logo: 'üåê', apiKey: 'nordwheel' }\n00088| ];\n00089| \n00090| export default function Home() {\n00091|   // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n00092|   const initialFormState: DeliveryForm = {\n00093|     cargos: [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00094|     fromCity: '',\n00095|     toCity: '',\n00096|     fromAddress: '',\n00097|     toAddress: '',\n00098|     declaredValue: 0,\n00099|     needPackaging: false,\n00100|     needLoading: false,\n00101|     needCarry: false,\n00102|     floor: 1,\n00103|     hasFreightLift: false,\n00104|     needInsurance: false,\n00105|     fromTerminal: true,\n00106|     toTerminal: true,\n00107|     fromAddressDelivery: false,\n00108|     toAddressDelivery: false,\n00109|     selectedProducts: []\n00110|   };\n00111| \n00112|   const [form, setForm] = useState<DeliveryForm>(initialFormState);\n00113|   const [isLoaded, setIsLoaded] = useState(false);\n00114| \n00115|   const [suggestions, setSuggestions] = useState<AddressSuggestion[]>([]);\n00116|   const [showSuggestions, setShowSuggestions] = useState(false);\n00117|   const [activeField, setActiveField] = useState('');\n00118|   const [calculations, setCalculations] = useState<CalculationResult[]>([]);\n00119|   const [calculating, setCalculating] = useState(false);\n00120|   const [expandedDetails, setExpandedDetails] = useState<{ [key: string]: boolean }>({});\n00121|   const [expandedDebugInfo, setExpandedDebugInfo] = useState<{ [key: string]: boolean }>({});\n00122|   const [suggestionPosition, setSuggestionPosition] = useState({ top: 0, left: 0 });\n00123|   const [apiStatus, setApiStatus] = useState({\n00124|     pek: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00125|     dellin: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00126|     railcontinent: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00127|     vozovoz: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00128|     nordwheel: '–ø—Ä–æ–≤–µ—Ä–∫–∞...'\n00129|   });\n00130| \n00131|   // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)\n00132|   useEffect(() => {\n00133|     // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ\n00134|     if (typeof window !== 'undefined' && !isLoaded) {\n00135|       try {\n00136|         const saved = localStorage.getItem('deliveryForm');\n00137|         if (saved) {\n00138|           const savedForm = JSON.parse(saved);\n00139|           // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≥—Ä—É–∑\n00140|           if (!savedForm.cargos || savedForm.cargos.length === 0) {\n00141|             savedForm.cargos = [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }];\n00142|           }\n00143|           setForm(savedForm);\n00144|           console.log('–ó–∞–≥—Ä—É–∂–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã:', savedForm);\n00145|           \n00146|           // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è Supabase\n00147|           const currentTime = Math.floor(Date.now() / 1000);\n00148|           console.log('üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (timestamp):', currentTime);\n00149|           console.log('üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (ISO):', new Date().toISOString());\n00150|         }\n00151|       } catch (error) {\n00152|         console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);\n00153|         // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ\n00154|       } finally {\n00155|         setIsLoaded(true);\n00156|       }\n00157|     }\n00158|   }, [isLoaded]);\n00159| \n00160|   // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ (—Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)\n00161|   useEffect(() => {\n00162|     if (typeof window !== 'undefined' && isLoaded) {\n00163|       try {\n00164|         localStorage.setItem('deliveryForm', JSON.stringify(form));\n00165|         console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –≤ localStorage');\n00166|       } catch (error) {\n00167|         console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);\n00168|       }\n00169|     }\n00170|   }, [form, isLoaded]);\n00171| \n00172|   // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –ø—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n00173|   useEffect(() => {\n00174|     if (form.declaredValue > 0) {\n00175|       setForm(prev => ({ ...prev, needInsurance: true }));\n00176|     }\n00177|   }, [form.declaredValue]);\n00178| \n00179|   // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã\n00180|   useEffect(() => {\n00181|     if (typeof window !== 'undefined' && isLoaded) {\n00182|       checkAllAPIStatus();\n00183|     }\n00184|   }, [isLoaded]);\n00185| \n00186|   const checkAPIStatus = async (apiName: string, testFunction: () => Promise<any>) => {\n00187|     try {\n00188|       const result = await testFunction();\n00189|       if (result && !result.error) {\n00190|         setApiStatus(prev => ({ ...prev, [apiName]: '–ø–æ–¥–∫–ª—é—á–µ–Ω–æ' }));\n00191|       } else {\n00192|         setApiStatus(prev => ({ ...prev, [apiName]: '–æ—à–∏–±–∫–∞' }));\n00193|       }\n00194|     } catch (error) {\n00195|       setApiStatus(prev => ({ ...prev, [apiName]: '–æ—à–∏–±–∫–∞' }));\n00196|     }\n00197|   };\n00198| \n00199|   const checkAllAPIStatus = async () => {\n00200|     // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\n00201|     const testData = {\n00202|       fromCity: '–ú–æ—Å–∫–≤–∞',\n00203|       toCity: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', \n00204|       cargos: [{ id: '1', length: 100, width: 100, height: 100, weight: 10 }],\n00205|       declaredValue: 50000,\n00206|       fromAddressDelivery: false,\n00207|       toAddressDelivery: false,\n00208|       needPackaging: false,\n00209|       needInsurance: false\n00210|     };\n00211| \n00212|     // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n00213|     const currentForm = form;\n00214|     \n00215|     // –í—Ä–µ–º–µ–Ω–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ\n00216|     setForm({\n00217|       ...form,\n00218|       fromCity: testData.fromCity,\n00219|       toCity: testData.toCity,\n00220|       cargos: testData.cargos,\n00221|       declaredValue: testData.declaredValue,\n00222|       fromAddressDelivery: testData.fromAddressDelivery,\n00223|       toAddressDelivery: testData.toAddressDelivery,\n00224|       needPackaging: testData.needPackaging,\n00225|       needInsurance: testData.needInsurance\n00226|     });\n00227| \n00228|     // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ\n00229|     Promise.all([\n00230|       checkAPIStatus('pek', async () => {\n00231|         try {\n00232|           const response = await fetch('/api/pek', {\n00233|             method: 'POST',\n00234|             headers: { 'Content-Type': 'application/json' },\n00235|             body: JSON.stringify({ method: 'test' })\n00236|           });\n00237|           const data = await response.json();\n00238|           if (data.status === 'OK') {\n00239|             return { success: true };\n00240|           } else {\n00241|             return { error: true };\n00242|           }\n00243|         } catch (error) {\n00244|           return { error: true };\n00245|         }\n00246|       }),\n00247|       \n00248|       checkAPIStatus('dellin', async () => {\n00249|         try {\n00250|           // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ sessionID –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π (—Ç–æ—Ç –∂–µ –º–µ—Ç–æ–¥ —á—Ç–æ –≤ calculateDellin)\n00251|           const authResponse = await fetch('https://api.dellin.ru/v3/auth/login.json', {\n00252|             method: 'POST',\n00253|             headers: { 'Content-Type': 'application/json' },\n00254|             body: JSON.stringify({\n00255|               appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n00256|               login: 'service@lavsit.ru',\n00257|               password: 'edcwsx123QAZ'\n00258|             })\n00259|           });\n00260|           const authData = await authResponse.json();\n00261|           \n00262|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ –∫ sessionID –∫–∞–∫ –≤ calculateDellin\n00263|           if (authData.data?.sessionID || authData.sessionID || authData.data?.session) {\n00264|             return { success: true };\n00265|           } else {\n00266|             return { error: true };\n00267|           }\n00268|         } catch (error) {\n00269|           return { error: true };\n00270|         }\n00271|       }),\n00272|       \n00273|       checkAPIStatus('railcontinent', async () => {\n00274|         try {\n00275|           const response = await fetch('/api/rail-continent', {\n00276|             method: 'POST',\n00277|             headers: { 'Content-Type': 'application/json' },\n00278|             body: JSON.stringify({\n00279|               city_sender: testData.fromCity,\n00280|               city_receiver: testData.toCity,\n00281|               weight: 10,\n00282|               volume: 0.1,\n00283|               length: 1,\n00284|               width: 1,\n00285|               height: 1,\n00286|               declared_cost: testData.declaredValue,\n00287|               pickup: '0',\n00288|               delivery: '0',\n00289|               packaging: '0',\n00290|               insurance: '0',\n00291|               tariff: 'auto'\n00292|             })\n00293|           });\n00294|           return await response.json();\n00295|         } catch (error) {\n00296|           return { error: true };\n00297|         }\n00298|       }),\n00299|       \n00300|       checkAPIStatus('vozovoz', async () => {\n00301|         try {\n00302|           const response = await fetch('/api/vozovoz', {\n00303|             method: 'POST',\n00304|             headers: { 'Content-Type': 'application/json' },\n00305|             body: JSON.stringify({\n00306|               object: \"price\",\n00307|               action: \"get\",\n00308|               params: {\n00309|                 cargo: {\n00310|                   dimension: {\n00311|                     quantity: 1,\n00312|                     volume: 0.1,\n00313|                     weight: 10\n00314|                   }\n00315|                 },\n00316|                 gateway: {\n00317|                   dispatch: {\n00318|                     point: {\n00319|                       location: testData.fromCity,\n00320|                       terminal: \"default\"\n00321|                     }\n00322|                   },\n00323|                   destination: {\n00324|                     point: {\n00325|                       location: testData.toCity,\n00326|                       terminal: \"default\"\n00327|                     }\n00328|                   }\n00329|                 }\n00330|               }\n00331|             })\n00332|           });\n00333|           return await response.json();\n00334|         } catch (error) {\n00335|           return { error: true };\n00336|         }\n00337|       }),\n00338|       \n00339|       checkAPIStatus('nordwheel', async () => {\n00340|         try {\n00341|           const totalWeight = 10;\n00342|           const totalVolume = 0.1;\n00343|           \n00344|           const params = new URLSearchParams({\n00345|             from: '91',\n00346|             to: '92',\n00347|             pickup: '1',\n00348|             deliver: '1',\n00349|             weight: totalWeight.toString(),\n00350|             volume: totalVolume.toString(),\n00351|             oversized: '0',\n00352|             package: '1',\n00353|             packageCount: '1',\n00354|             insurance: '1',\n00355|             sum: '50000',\n00356|             documentsReturn: '0',\n00357|             fragile: '1'\n00358|           });\n00359| \n00360|           const fullUrl = `https://nordw.ru/tools/api/calc/calculate/?${params.toString()}`;\n00361|           const response = await fetch(fullUrl);\n00362|           const data = await response.json();\n00363|           \n00364|           if (response.ok && data.status === 'success') {\n00365|             return { success: true };\n00366|           } else {\n00367|             return { error: true };\n00368|           }\n00369|         } catch (error) {\n00370|           return { error: true };\n00371|         }\n00372|       })\n00373|     ]).finally(() => {\n00374|       // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n00375|       setForm(currentForm);\n00376|     });\n00377|   };\n00378| \n00379|   const searchAddresses = useCallback(async (query: string, field: string, element?: HTMLInputElement) => {\n00380|     if (query.length < 3) {\n00381|       setSuggestions([]);\n00382|       setShowSuggestions(false);\n00383|       return;\n00384|     }\n00385| \n00386|     setActiveField(field);\n00387|     \n00388|     // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ –∞–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–æ–∫\n00389|     if (element) {\n00390|       const rect = element.getBoundingClientRect();\n00391|       setSuggestionPosition({\n00392|         top: rect.bottom + window.scrollY,\n00393|         left: rect.left + window.scrollX\n00394|       });\n00395|     }\n00396|     \n00397|     try {\n00398|       const response = await fetch('https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address', {\n00399|         method: 'POST',\n00400|         headers: {\n00401|           'Content-Type': 'application/json',\n00402|           'Accept': 'application/json',\n00403|           'Authorization': 'Token eb87bbb3789bb43ed465f796892ea951f9e91008'\n00404|         },\n00405|         body: JSON.stringify({\n00406|           query: query,\n00407|           count: 10,\n00408|           // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª–µ–π –≥–æ—Ä–æ–¥–æ–≤ - —Ç–æ–ª—å–∫–æ –≥–æ—Ä–æ–¥–∞\n00409|           ...(field === 'fromCity' || field === 'toCity' ? {\n00410|             restrict_value: true,\n00411|             locations: [{\n00412|               country: '–†–æ—Å—Å–∏—è'\n00413|             }],\n00414|             from_bound: { value: 'city' },\n00415|             to_bound: { value: 'city' }\n00416|           } : {})\n00417|         })\n00418|       });\n00419| \n00420|       if (response.ok) {\n00421|         const data = await response.json();\n00422|         setSuggestions(data.suggestions || []);\n00423|         setShowSuggestions(true);\n00424|       }\n00425|     } catch (error) {\n00426|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫:', error);\n00427|     }\n00428|   }, []);\n00429| \n00430|   const debounceTimer = React.useRef<NodeJS.Timeout>();\n00431|   const handleAddressChange = (field: string, value: string, element?: HTMLInputElement) => {\n00432|     setForm(prev => ({ ...prev, [field]: value }));\n00433|     \n00434|     clearTimeout(debounceTimer.current);\n00435|     debounceTimer.current = setTimeout(() => {\n00436|       searchAddresses(value, field, element);\n00437|     }, 50);\n00438|   };\n00439| \n00440|   const selectSuggestion = (suggestion: AddressSuggestion) => {\n00441|     setForm(prev => ({ ...prev, [activeField]: suggestion.value }));\n00442|     setShowSuggestions(false);\n00443|     setSuggestions([]);\n00444|   };\n00445| \n00446|   const addCargo = () => {\n00447|     const newId = (form.cargos.length + 1).toString();\n00448|     setForm(prev => ({\n00449|       ...prev,\n00450|       cargos: [...prev.cargos, { id: newId, length: 0, width: 0, height: 0, weight: 0 }]\n00451|     }));\n00452|   };\n00453| \n00454|   const updateCargo = (id: string, field: string, value: number) => {\n00455|     setForm(prev => {\n00456|       const updatedCargos = prev.cargos.map(cargo => \n00457|         cargo.id === id ? { ...cargo, [field]: value } : cargo\n00458|       );\n00459|       \n00460|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n00461|       const cleanResult = cleanEmptyCargos(updatedCargos, prev.selectedProducts || []);\n00462|       \n00463|       return {\n00464|         ...prev,\n00465|         cargos: cleanResult.cargos,\n00466|         selectedProducts: cleanResult.products\n00467|       };\n00468|     });\n00469|   };\n00470| \n00471|   const removeCargo = (id: string) => {\n00472|     if (form.cargos.length > 1) {\n00473|       setForm(prev => ({\n00474|         ...prev,\n00475|         cargos: prev.cargos.filter(cargo => cargo.id !== id)\n00476|       }));\n00477|     }\n00478|   };\n00479| \n00480|   // üîß –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ (–≤—Å–µ –ø–æ–ª—è —Ä–∞–≤–Ω—ã 0)\n00481|   const isEmptyCargo = (cargo: Cargo) => {\n00482|     return cargo.length === 0 && cargo.width === 0 && cargo.height === 0 && cargo.weight === 0;\n00483|   };\n00484| \n00485|   // üîß –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤\n00486|   const cleanEmptyCargos = (cargos: Cargo[], selectedProducts: ProductInForm[]) => {\n00487|     // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –≥—Ä—É–∑\n00488|     const hasFilledCargos = cargos.some(cargo => !isEmptyCargo(cargo));\n00489|     \n00490|     if (!hasFilledCargos) {\n00491|       // –ï—Å–ª–∏ –Ω–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –ø—É—Å—Ç–æ–π\n00492|       return {\n00493|         cargos: cargos.length > 0 ? [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }] : [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00494|         products: selectedProducts\n00495|       };\n00496|     }\n00497| \n00498|     // –°–æ–∑–¥–∞–µ–º –º–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ä—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –∫ –Ω–æ–≤—ã–º\n00499|     const oldToNewIndexMap = new globalThis.Map<number, number>();\n00500|     let newIndex = 0;\n00501|     \n00502|     cargos.forEach((cargo, oldIndex) => {\n00503|       if (!isEmptyCargo(cargo)) {\n00504|         oldToNewIndexMap.set(oldIndex, newIndex);\n00505|         newIndex++;\n00506|       }\n00507|     });\n00508|     \n00509|     // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –≥—Ä—É–∑—ã\n00510|     const filledCargos = cargos.filter(cargo => !isEmptyCargo(cargo));\n00511|     \n00512|     // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã —É —Ç–æ–≤–∞—Ä–æ–≤\n00513|     const updatedProducts = selectedProducts.map(productItem => ({\n00514|       ...productItem,\n00515|       cargoIndexes: productItem.cargoIndexes\n00516|         .map(oldIndex => oldToNewIndexMap.get(oldIndex))\n00517|         .filter(newIdx => newIdx !== undefined) as number[]\n00518|     }));\n00519|     \n00520|     return {\n00521|       cargos: filledCargos,\n00522|       products: updatedProducts\n00523|     };\n00524|   };\n00525| \n00526|   // üîß –§—É–Ω–∫—Ü–∏—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≥—Ä—É–∑–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n00527|   interface GroupedCargoDisplay {\n00528|     length: number;\n00529|     width: number;\n00530|     height: number;\n00531|     weight: number;\n00532|     quantity: number;\n00533|     indices: number[];\n00534|     isEmpty: boolean;\n00535|   }\n00536| \n00537|   const groupCargosForDisplay = (cargos: Cargo[]): GroupedCargoDisplay[] => {\n00538|     const groups = new globalThis.Map<string, GroupedCargoDisplay>();\n00539|     \n00540|     cargos.forEach((cargo, index) => {\n00541|       const isEmpty = isEmptyCargo(cargo);\n00542|       \n00543|       // –î–ª—è –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ –Ω–µ –≥—Ä—É–ø–ø–∏—Ä—É–µ–º\n00544|       if (isEmpty) {\n00545|         groups.set(`empty_${index}`, {\n00546|           length: 0,\n00547|           width: 0,\n00548|           height: 0,\n00549|           weight: 0,\n00550|           quantity: 1,\n00551|           indices: [index],\n00552|           isEmpty: true\n00553|         });\n00554|         return;\n00555|       }\n00556|       \n00557|       // –°–æ–∑–¥–∞–µ–º –∫–ª—é—á –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –∏ –≤–µ—Å–∞\n00558|       const key = `${cargo.length}_${cargo.width}_${cargo.height}_${cargo.weight}`;\n00559|       \n00560|       if (groups.has(key)) {\n00561|         const existing = groups.get(key)!;\n00562|         existing.quantity += 1;\n00563|         existing.indices.push(index);\n00564|       } else {\n00565|         groups.set(key, {\n00566|           length: cargo.length,\n00567|           width: cargo.width,\n00568|           height: cargo.height,\n00569|           weight: cargo.weight,\n00570|           quantity: 1,\n00571|           indices: [index],\n00572|           isEmpty: false\n00573|         });\n00574|       }\n00575|     });\n00576|     \n00577|     // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤: —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ (–ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É–±—ã–≤–∞–Ω–∏—è), –ø–æ—Ç–æ–º –ø—É—Å—Ç—ã–µ\n00578|     return Array.from(groups.values()).sort((a, b) => {\n00579|       if (a.isEmpty && !b.isEmpty) return 1;\n00580|       if (!a.isEmpty && b.isEmpty) return -1;\n00581|       if (!a.isEmpty && !b.isEmpty) {\n00582|         return b.quantity - a.quantity; // –ü–æ —É–±—ã–≤–∞–Ω–∏—é –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞\n00583|       }\n00584|       return a.indices[0] - b.indices[0]; // –ü—É—Å—Ç—ã–µ –ø–æ –ø–æ—Ä—è–¥–∫—É –∏–Ω–¥–µ–∫—Å–æ–≤\n00585|     });\n00586|   };\n00587| \n00588|   // üîß –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏\n00589|   const handleProductAdd = (product: FurnitureProduct) => {\n00590|     const timestamp = Date.now();\n00591|     \n00592|     console.log(`‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞: ${product.name} (${product.cargoPlaces.length} –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç)`);\n00593|     \n00594|     // –°–æ–∑–¥–∞–µ–º –≥—Ä—É–∑–æ–≤—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è —Ç–æ–≤–∞—Ä–∞\n00595|     const newCargos = createCargosForProduct(product, 1, timestamp);\n00596|     \n00597|     console.log('–°–æ–∑–¥–∞–Ω–æ –Ω–æ–≤—ã—Ö –≥—Ä—É–∑–æ–≤:', newCargos.length);\n00598|     console.log('–ù–æ–≤—ã–µ –≥—Ä—É–∑—ã:', newCargos.map(c => ({ id: c.id, productId: c.productId, addedAt: c.addedAt })));\n00599|     \n00600|     // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç —Ç–æ–≤–∞—Ä–∞ –≤ —Ñ–æ—Ä–º–µ\n00601|     const productInForm: ProductInForm = {\n00602|       product,\n00603|       quantity: 1,\n00604|       totalPrice: product.retailPrice,\n00605|       cargoIndexes: [], // –ó–∞–ø–æ–ª–Ω–∏–º –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–∑–æ–≤\n00606|       addedAt: timestamp\n00607|     };\n00608|     \n00609|     setForm(prev => {\n00610|       let updatedCargos = [...prev.cargos];\n00611|       let cargoIndexes: number[] = [];\n00612|       \n00613|       // –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è\n00614|       const emptyCargos = updatedCargos\n00615|         .map((cargo, index) => ({ cargo, index }))\n00616|         .filter(item => isEmptyCargo(item.cargo));\n00617|       \n00618|       console.log('–ù–∞–π–¥–µ–Ω–æ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤:', emptyCargos.length);\n00619|       console.log('–ù—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –≥—Ä—É–∑–æ–≤:', newCargos.length);\n00620|       \n00621|       // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞\n00622|       let filledCount = 0;\n00623|       for (let i = 0; i < Math.min(emptyCargos.length, newCargos.length); i++) {\n00624|         const emptyCargoIndex = emptyCargos[i].index;\n00625|         const newCargoData = newCargos[i];\n00626|         \n00627|         updatedCargos[emptyCargoIndex] = {\n00628|           ...updatedCargos[emptyCargoIndex],\n00629|           length: newCargoData.length,\n00630|           width: newCargoData.width,\n00631|           height: newCargoData.height,\n00632|           weight: newCargoData.weight,\n00633|           productId: newCargoData.productId,\n00634|           placeNumber: newCargoData.placeNumber,\n00635|           isFromProduct: newCargoData.isFromProduct,\n00636|           addedAt: newCargoData.addedAt\n00637|         };\n00638|         \n00639|         cargoIndexes.push(emptyCargoIndex);\n00640|         filledCount++;\n00641|       }\n00642|       \n00643|       // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –≥—Ä—É–∑–æ–≤, —á–µ–º –µ—Å—Ç—å –ø—É—Å—Ç—ã—Ö - –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ\n00644|       if (filledCount < newCargos.length) {\n00645|         const remainingCargos = newCargos.slice(filledCount);\n00646|         const startIndex = updatedCargos.length;\n00647|         \n00648|         for (let i = 0; i < remainingCargos.length; i++) {\n00649|           updatedCargos.push(remainingCargos[i]);\n00650|           cargoIndexes.push(startIndex + i);\n00651|         }\n00652|       }\n00653|       \n00654|       productInForm.cargoIndexes = cargoIndexes;\n00655|       \n00656|       console.log('–ò–Ω–¥–µ–∫—Å—ã –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤:', cargoIndexes);\n00657|       console.log('–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:', updatedCargos.length);\n00658|       \n00659|       // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n00660|       const prevSelectedProducts = prev.selectedProducts || [];\n00661|       const newSelectedProducts = [...prevSelectedProducts, productInForm];\n00662|       const newDeclaredValue = calculateTotalValue(newSelectedProducts);\n00663|       \n00664|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n00665|       const cleanResult = cleanEmptyCargos(updatedCargos, newSelectedProducts);\n00666|       \n00667|       return {\n00668|         ...prev,\n00669|         cargos: cleanResult.cargos,\n00670|         selectedProducts: cleanResult.products,\n00671|         declaredValue: newDeclaredValue\n00672|       };\n00673|     });\n00674|     \n00675|     console.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä: ${product.name} (${newCargos.length} –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç)`);\n00676|     console.log('–§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥—Ä—É–∑–æ–≤:', newCargos.length);\n00677|   };\n00678| \n00679|   const handleProductQuantityChange = (productId: string, addedAt: number, newQuantity: number) => {\n00680|     setForm(prev => {\n00681|       console.log(`üî¢ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞ ${productId} —Å ${prev.selectedProducts?.find(p => p.product.id === productId && p.addedAt === addedAt)?.quantity || 0} –Ω–∞ ${newQuantity}`);\n00682|       \n00683|       // –ù–∞—Ö–æ–¥–∏–º —Ç–æ–≤–∞—Ä\n00684|       const selectedProducts = prev.selectedProducts || [];\n00685|       const productIndex = selectedProducts.findIndex(p => \n00686|         p.product.id === productId && p.addedAt === addedAt\n00687|       );\n00688|       \n00689|       if (productIndex === -1) {\n00690|         console.warn('‚ùå –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞');\n00691|         return prev;\n00692|       }\n00693|       \n00694|       const product = selectedProducts[productIndex];\n00695|       console.log('–ì—Ä—É–∑—ã –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞:', prev.cargos.length);\n00696|       \n00697|       // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –≥—Ä—É–∑—ã —ç—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞\n00698|       const cargosWithoutProduct = removeCargosForProduct(\n00699|         prev.cargos as CargoWithMetadata[], \n00700|         productId, \n00701|         addedAt\n00702|       );\n00703|       \n00704|       console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö:', cargosWithoutProduct.length);\n00705|       \n00706|       // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –≥—Ä—É–∑—ã —Å –Ω–æ–≤—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º\n00707|       const newCargos = createCargosForProduct(product.product, newQuantity, addedAt);\n00708|       const updatedCargos = [...cargosWithoutProduct, ...newCargos];\n00709|       \n00710|       console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö:', updatedCargos.length);\n00711|       \n00712|       // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä\n00713|       const updatedProduct = {\n00714|         ...product,\n00715|         quantity: newQuantity,\n00716|         totalPrice: product.product.retailPrice * newQuantity,\n00717|         cargoIndexes: findCargoIndexesForProduct(updatedCargos, productId, addedAt)\n00718|       };\n00719|       \n00720|       const updatedProducts = selectedProducts.map((p, index) => \n00721|         index === productIndex ? updatedProduct : p\n00722|       );\n00723|       \n00724|       // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n00725|       const newDeclaredValue = calculateTotalValue(updatedProducts);\n00726|       \n00727|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n00728|       const cleanResult = cleanEmptyCargos(updatedCargos, updatedProducts);\n00729|       \n00730|       return {\n00731|         ...prev,\n00732|         cargos: cleanResult.cargos,\n00733|         selectedProducts: cleanResult.products,\n00734|         declaredValue: newDeclaredValue\n00735|       };\n00736|     });\n00737|     \n00738|     console.log(`üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ ${productId}: ${newQuantity} —à—Ç.`);\n00739|   };\n00740| \n00741|   const handleProductRemove = (productId: string, addedAt: number) => {\n00742|     setForm(prev => {\n00743|       console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ ${productId} (addedAt: ${addedAt})`);\n00744|       \n00745|       // –ù–∞—Ö–æ–¥–∏–º —Ç–æ–≤–∞—Ä –∏ –µ–≥–æ –∏–Ω–¥–µ–∫—Å—ã –≥—Ä—É–∑–æ–≤\n00746|       const selectedProducts = prev.selectedProducts || [];\n00747|       const product = selectedProducts.find(p => \n00748|         p.product.id === productId && p.addedAt === addedAt\n00749|       );\n00750|       \n00751|       if (!product) {\n00752|         console.log('–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω');\n00753|         return prev;\n00754|       }\n00755|       \n00756|       // –û—á–∏—â–∞–µ–º –≥—Ä—É–∑—ã —Ç–æ–≤–∞—Ä–∞ (–¥–µ–ª–∞–µ–º –∏—Ö –ø—É—Å—Ç—ã–º–∏ –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è)\n00757|       const updatedCargos = prev.cargos.map((cargo, index) => {\n00758|         if (product.cargoIndexes.includes(index)) {\n00759|           return {\n00760|             ...cargo,\n00761|             length: 0,\n00762|             width: 0,\n00763|             height: 0,\n00764|             weight: 0,\n00765|             productId: undefined,\n00766|             placeNumber: undefined,\n00767|             isFromProduct: undefined,\n00768|             addedAt: undefined\n00769|           };\n00770|         }\n00771|         return cargo;\n00772|       });\n00773|       \n00774|       // –£–¥–∞–ª—è–µ–º —Ç–æ–≤–∞—Ä –∏–∑ —Å–ø–∏—Å–∫–∞\n00775|       const updatedProducts = selectedProducts.filter(p => \n00776|         !(p.product.id === productId && p.addedAt === addedAt)\n00777|       );\n00778|       \n00779|       // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n00780|       const newDeclaredValue = calculateTotalValue(updatedProducts);\n00781|       \n00782|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n00783|       const cleanResult = cleanEmptyCargos(updatedCargos, updatedProducts);\n00784|       \n00785|       console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:', cleanResult.cargos.length);\n00786|       console.log('–£–¥–∞–ª–µ–Ω–æ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤:', updatedCargos.length - cleanResult.cargos.length);\n00787|       \n00788|       return {\n00789|         ...prev,\n00790|         cargos: cleanResult.cargos,\n00791|         selectedProducts: cleanResult.products,\n00792|         declaredValue: newDeclaredValue\n00793|       };\n00794|     });\n00795|     \n00796|     console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω —Ç–æ–≤–∞—Ä ${productId}`);\n00797|   };\n00798| \n00799|   // –ü–æ–ª—É—á–µ–Ω–∏–µ sessionID –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n00800|   const getDellinSessionId = async (): Promise<string | null> => {\n00801|     try {\n00802|       const authResponse = await fetch('https://api.dellin.ru/v3/auth/login.json', {\n00803|         method: 'POST',\n00804|         headers: {\n00805|           'Content-Type': 'application/json'\n00806|         },\n00807|         body: JSON.stringify({\n00808|           appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n00809|           login: 'service@lavsit.ru',\n00810|           password: 'edcwsx123QAZ'\n00811|         })\n00812|       });\n00813| \n00814|       const authData = await authResponse.json();\n00815|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ response.ok:', authResponse.ok);\n00816|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData:', authData);\n00817|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData.data:', authData.data);\n00818|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData.data?.sessionID:', authData.data?.sessionID);\n00819|       \n00820|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ –∫ sessionID\n00821|       let sessionID = null;\n00822|       \n00823|       if (authData.data?.sessionID) {\n00824|         sessionID = authData.data.sessionID;\n00825|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ data.sessionID:', sessionID);\n00826|       } else if (authData.sessionID) {\n00827|         sessionID = authData.sessionID;\n00828|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ sessionID:', sessionID);\n00829|       } else if (authData.data?.session) {\n00830|         sessionID = authData.data.session;\n00831|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ data.session:', sessionID);\n00832|       }\n00833|       \n00834|       if (authResponse.ok && sessionID) {\n00835|         return sessionID;\n00836|       } else {\n00837|         console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', authData);\n00838|         console.error('‚ùå –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', authResponse.status);\n00839|         console.error('‚ùå –¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞:', authResponse.statusText);\n00840|         return null;\n00841|       }\n00842|     } catch (error) {\n00843|       console.error('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', error);\n00844|     }\n00845|     return null;\n00846|   };\n00847| \n00848|   // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ –¥–ª—è –≥–æ—Ä–æ–¥–∞\n00849|   const getDellinTerminal = async (citySearch: string): Promise<string | null> => {\n00850|     try {\n00851|       const response = await fetch('https://api.dellin.ru/v3/public/terminals.json', {\n00852|         method: 'POST',\n00853|         headers: {\n00854|           'Content-Type': 'application/json'\n00855|         },\n00856|         body: JSON.stringify({\n00857|           appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B'\n00858|         })\n00859|       });\n00860| \n00861|       const data = await response.json();\n00862|       console.log('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã:', data);\n00863|       \n00864|       if (response.ok && data.terminals) {\n00865|         // –ò—â–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –≥–æ—Ä–æ–¥–µ\n00866|         const normalizedCity = citySearch.toLowerCase().trim();\n00867|         const terminal = data.terminals.find((t: any) => \n00868|           t.city?.toLowerCase().includes(normalizedCity) ||\n00869|           normalizedCity.includes(t.city?.toLowerCase())\n00870|         );\n00871|         \n00872|         return terminal?.id || data.terminals[0]?.id || null;\n00873|       }\n00874|       \n00875|       return null;\n00876|     } catch (error) {\n00877|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', error);\n00878|       return null;\n00879|     }\n00880|   };\n00881| \n00882|   // –ü–æ–ª—É—á–µ–Ω–∏–µ UID —É–ø–∞–∫–æ–≤–∫–∏ \"crate_with_bubble\" –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ —É–ø–∞–∫–æ–≤–æ–∫ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n00883|   const getDellinCrateWithBubbleUid = async (): Promise<string | null> => {\n00884|     const maxRetries = 2;\n00885|     \n00886|     for (let attempt = 1; attempt <= maxRetries; attempt++) {\n00887|       try {\n00888|         console.log(`üì¶ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –ø–æ–ø—ã—Ç–∫–∞ ${attempt}/${maxRetries}`);\n00889|         \n00890|         const response = await fetch('/api/dellin-packages', {\n00891|           method: 'GET',\n00892|           headers: {\n00893|             'Content-Type': 'application/json'\n00894|           }\n00895|         });\n00896| \n00897|         const data = await response.json();\n00898|         console.log('üì¶ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö response.ok:', response.ok);\n00899|         console.log('üì¶ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö status:', response.status);\n00900|         console.log('üì¶ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö data:', data);\n00901|         \n00902|         // –ï—Å–ª–∏ 401 Unauthorized - –ø—Ä–æ–±—É–µ–º –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è\n00903|         if (response.status === 401 && attempt < maxRetries) {\n00904|           console.log('üîÑ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –ø–æ–ª—É—á–∏–ª–∏ 401, –≤—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...');\n00905|           const newSessionId = await getDellinSessionId();\n00906|           if (newSessionId) {\n00907|             console.log('‚úÖ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –ø–æ–ª—É—á–µ–Ω –Ω–æ–≤—ã–π SessionID, –ø–æ–≤—Ç–æ—Ä—è–µ–º –∑–∞–ø—Ä–æ—Å...');\n00908|             continue; // –ü—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —Å –Ω–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n00909|           } else {\n00910|             console.error('‚ùå –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π SessionID');\n00911|             return null;\n00912|           }\n00913|         }\n00914|         \n00915|         if (response.ok && data.data && Array.isArray(data.data)) {\n00916|           console.log('üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–ø–∞–∫–æ–≤–æ–∫ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ:', data.data.length);\n00917|           console.log('üì¶ –ü–µ—Ä–≤—ã–µ 3 —É–ø–∞–∫–æ–≤–∫–∏:', data.data.slice(0, 3).map(p => ({name: p.name, uid: p.uid})));\n00918|           \n00919|           // –ù–∞—Ö–æ–¥–∏–º —É–ø–∞–∫–æ–≤–∫—É —Å name \"crate_with_bubble\"\n00920|           const crateWithBubble = data.data.find((pkg: any) => \n00921|             pkg.name === 'crate_with_bubble'\n00922|           );\n00923|           \n00924|           console.log('üì¶ –ü–æ–∏—Å–∫ crate_with_bubble —Ä–µ–∑—É–ª—å—Ç–∞—Ç:', crateWithBubble);\n00925|           \n00926|           if (crateWithBubble && crateWithBubble.uid) {\n00927|             console.log('‚úÖ –ù–∞–π–¥–µ–Ω UID –¥–ª—è crate_with_bubble:', crateWithBubble.uid);\n00928|             return crateWithBubble.uid;\n00929|           } else {\n00930|             console.log('‚ùå crate_with_bubble –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ—Ç UID');\n00931|           }\n00932|         } else {\n00933|           console.log('‚ùå –û—à–∏–±–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–∞ API —É–ø–∞–∫–æ–≤–æ–∫');\n00934|         }\n00935|         \n00936|         // –ï—Å–ª–∏ –¥–æ—à–ª–∏ —Å—é–¥–∞, –∑–Ω–∞—á–∏—Ç –Ω–µ –Ω–∞—à–ª–∏ —É–ø–∞–∫–æ–≤–∫—É –∏–ª–∏ –±—ã–ª–∞ –¥—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞\n00937|         break;\n00938|         \n00939|       } catch (error) {\n00940|         console.error(`‚ùå –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –æ—à–∏–±–∫–∞ –Ω–∞ –ø–æ–ø—ã—Ç–∫–µ ${attempt}:`, error);\n00941|         if (attempt === maxRetries) {\n00942|           console.error('‚ùå –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –∏—Å—á–µ—Ä–ø–∞–Ω—ã –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏');\n00943|           return null;\n00944|         }\n00945|       }\n00946|     }\n00947|     \n00948|     console.warn('–£–ø–∞–∫–æ–≤–∫–∞ —Å name=crate_with_bubble –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ');\n00949|     return null;\n00950|   };\n00951| \n00952|   // –†–∞—Å—á–µ—Ç –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π —á–µ—Ä–µ–∑ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π API v2/calculator.json —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n00953|   const calculateDellin = async (): Promise<CalculationResult> => {\n00954|     const apiUrl = 'https://api.dellin.ru/v2/calculator.json';\n00955|     const maxRetries = 2;\n00956|     \n00957|     try {\n00958|       let sessionID = await getDellinSessionId();\n00959|       \n00960|       if (!sessionID) {\n00961|         return {\n00962|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n00963|           price: 0,\n00964|           days: 0,\n00965|           error: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å sessionID',\n00966|           apiUrl,\n00967|           requestData: null,\n00968|           responseData: null\n00969|         };\n00970|       }\n00971| \n00972|       // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏ –æ–±—ä–µ–º—ã\n00973|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n00974|       const totalVolume = form.cargos.reduce((sum, cargo) => \n00975|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n00976|       );\n00977|       const maxLength = Math.max(...form.cargos.map(c => c.length)) / 100; // –≤ –º–µ—Ç—Ä–∞—Ö\n00978|       const maxWidth = Math.max(...form.cargos.map(c => c.width)) / 100;\n00979|       const maxHeight = Math.max(...form.cargos.map(c => c.height)) / 100;\n00980| \n00981|       // –ü–æ–ª—É—á–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª—ã –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)\n00982|       const fromTerminalId = !form.fromAddressDelivery ? await getDellinTerminal(form.fromCity) : null;\n00983|       const toTerminalId = !form.toAddressDelivery ? await getDellinTerminal(form.toCity) : null;\n00984| \n00985|       // –ü–æ–ª—É—á–∞–µ–º UID —É–ø–∞–∫–æ–≤–∫–∏ crate_with_bubble (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∞)\n00986|       let packageUid: string | null = null;\n00987|       console.log('=== –ù–ê–ß–ê–õ–û –û–¢–õ–ê–î–ö–ò –£–ü–ê–ö–û–í–ö–ò ===');\n00988|       console.log('üîç –û–¢–õ–ê–î–ö–ê –£–ü–ê–ö–û–í–ö–ò: form.needPackaging =', form.needPackaging);\n00989|       console.log('üîç –û–¢–õ–ê–î–ö–ê –£–ü–ê–ö–û–í–ö–ò: typeof form.needPackaging =', typeof form.needPackaging);\n00990|       \n00991|       if (form.needPackaging) {\n00992|         console.log('üîç ‚úÖ –£–ü–ê–ö–û–í–ö–ê –¢–†–ï–ë–£–ï–¢–°–Ø - –ó–ê–ü–†–ê–®–ò–í–ê–ï–ú UID...');\n00993|         try {\n00994|           packageUid = await getDellinCrateWithBubbleUid();\n00995|           console.log('üîç ‚úÖ –ü–û–õ–£–ß–ï–ù packageUid –∏–∑ API:', packageUid);\n00996|           \n00997|           // –í–†–ï–ú–ï–ù–ù–û: –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ UID –∏–∑ API, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π\n00998|           if (!packageUid) {\n00999|             packageUid = '0xa6a7bd2bf950e67f4b2cf7cc3a97c111';\n01000|             console.log('üîç üß™ –ò–°–ü–û–õ–¨–ó–£–ï–ú –¢–ï–°–¢–û–í–´–ô UID:', packageUid);\n01001|           }\n01002|           \n01003|           console.log('üîç ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô packageUid:', packageUid);\n01004|           console.log('üîç ‚úÖ typeof packageUid:', typeof packageUid);\n01005|           console.log('üîç ‚úÖ packageUid truthy:', !!packageUid);\n01006|         } catch (error) {\n01007|           console.log('üîç ‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ packageUid:', error);\n01008|           // –í–†–ï–ú–ï–ù–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π UID –ø—Ä–∏ –æ—à–∏–±–∫–µ\n01009|           packageUid = '0xa6a7bd2bf950e67f4b2cf7cc3a97c111';\n01010|           console.log('üîç üß™ –ò–°–ü–û–õ–¨–ó–£–ï–ú –¢–ï–°–¢–û–í–´–ô UID –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏:', packageUid);\n01011|         }\n01012|       } else {\n01013|         console.log('üîç ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ UID');\n01014|       }\n01015|       console.log('=== –ö–û–ù–ï–¶ –û–¢–õ–ê–î–ö–ò –£–ü–ê–ö–û–í–ö–ò ===');\n01016| \n01017|       // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞—Ç—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞\n01018|       const tomorrow = new Date();\n01019|       tomorrow.setDate(tomorrow.getDate() + 1);\n01020|       const produceDate = tomorrow.toISOString().split('T')[0];\n01021| \n01022|       // –û—Ç–ª–∞–¥–∫–∞ –ø–µ—Ä–µ–¥ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–∞\n01023|       console.log('=== –û–¢–õ–ê–î–ö–ê –§–û–†–ú–ò–†–û–í–ê–ù–ò–Ø –ó–ê–ü–†–û–°–ê ===');\n01024|       console.log('üîç form.needPackaging =', form.needPackaging, '(—Ç–∏–ø:', typeof form.needPackaging, ')');\n01025|       console.log('üîç packageUid =', packageUid, '(—Ç–∏–ø:', typeof packageUid, ')');\n01026|       console.log('üîç packageUid truthy =', !!packageUid);\n01027|       console.log('üîç –£—Å–ª–æ–≤–∏–µ (form.needPackaging && packageUid) =', form.needPackaging && packageUid);\n01028|       \n01029|       if (form.needPackaging && packageUid) {\n01030|         console.log('‚úÖ PACKAGES –ë–£–î–ï–¢ –î–û–ë–ê–í–õ–ï–ù –í –ó–ê–ü–†–û–°!');\n01031|       } else {\n01032|         console.log('‚ùå PACKAGES –ù–ï –ë–£–î–ï–¢ –î–û–ë–ê–í–õ–ï–ù:');\n01033|         if (!form.needPackaging) console.log('  - form.needPackaging = false');\n01034|         if (!packageUid) console.log('  - packageUid –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç/null');\n01035|       }\n01036| \n01037|       // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n01038|       const requestData = {\n01039|         appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n01040|         sessionID: sessionID,\n01041|         delivery: {\n01042|           deliveryType: {\n01043|             type: 'auto'  // –í—Å–µ–≥–¥–∞ \"auto\" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n01044|           },\n01045|           derival: {\n01046|             produceDate: produceDate,  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –¥–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n01047|             variant: form.fromAddressDelivery ? 'address' : 'terminal',\n01048|             ...(form.fromAddressDelivery ? {\n01049|               address: {\n01050|                 search: form.fromAddress || form.fromCity\n01051|               }\n01052|             } : {\n01053|               terminalID: fromTerminalId\n01054|             }),\n01055|             time: {\n01056|               worktimeStart: '10:00',\n01057|               worktimeEnd: '18:00',\n01058|               breakStart: '13:00',\n01059|               breakEnd: '14:00',\n01060|               exactTime: false\n01061|             }\n01062|             // handling –≤ derival –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n01063|           },\n01064|           arrival: {\n01065|             variant: form.toAddressDelivery ? 'address' : 'terminal',\n01066|             ...(form.toAddressDelivery ? {\n01067|               address: {\n01068|                 search: form.toAddress || form.toCity\n01069|               }\n01070|             } : {\n01071|               terminalID: toTerminalId\n01072|             }),\n01073|             time: {\n01074|               worktimeStart: '10:00',\n01075|               worktimeEnd: '18:00',\n01076|               breakStart: '13:00',\n01077|               breakEnd: '14:00',\n01078|               exactTime: false\n01079|             },\n01080|             // handling –≤ arrival –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—ä–µ–º\n01081|             ...(form.needCarry ? {\n01082|               handling: {\n01083|                 freightLift: form.hasFreightLift, // true —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –≥–∞–ª–æ—á–∫–∞ \"–Ω–∞–ª–∏—á–∏–µ –≥—Ä—É–∑–æ–≤–æ–≥–æ –ª–∏—Ñ—Ç–∞\"\n01084|                 toFloor: form.floor, // —ç—Ç–∞–∂ –∏–∑ —Ñ–æ—Ä–º—ã\n01085|                 carry: 0\n01086|               }\n01087|             } : {})\n01088|           },\n01089|           ...(form.needPackaging && packageUid ? {\n01090|             packages: [{\n01091|               uid: packageUid,  // UID —É–ø–∞–∫–æ–≤–∫–∏ crate_with_bubble –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞\n01092|               count: 1  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1\n01093|             }]\n01094|           } : {})\n01095|         },\n01096|         cargo: {\n01097|           quantity: form.cargos.length,\n01098|           length: maxLength,\n01099|           width: maxWidth,\n01100|           height: maxHeight,\n01101|           weight: totalWeight,\n01102|           totalVolume: totalVolume,\n01103|           totalWeight: totalWeight,\n01104|           oversizedWeight: 0,\n01105|           oversizedVolume: 0,\n01106|           hazardClass: 0,  // –í—Å–µ–≥–¥–∞ 0 –µ—Å–ª–∏ –Ω–µ—Ç –æ–ø–∞—Å–Ω—ã—Ö –≥—Ä—É–∑–æ–≤\n01107|           ...(form.needInsurance && form.declaredValue > 0 ? {\n01108|             insurance: {\n01109|               statedValue: form.declaredValue,\n01110|               term: true  // –í—Å–µ–≥–¥–∞ true –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è\n01111|             }\n01112|           } : {})\n01113|         },\n01114|         payment: {\n01115|           type: 'noncash',  // –í—Å–µ–≥–¥–∞ \"noncash\"\n01116|           paymentCitySearch: {\n01117|             search: form.fromCity  // –ì–æ—Ä–æ–¥ –æ–ø–ª–∞—Ç—ã\n01118|           }\n01119|         }\n01120|       };\n01121| \n01122|       console.log('üöÄ –ò–¢–û–ì–û–í–´–ô –ó–ê–ü–†–û–° –ö –î–õ:', JSON.stringify(requestData, null, 2));\n01123|       \n01124|       // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∞ packages\n01125|       if (requestData.delivery.packages) {\n01126|         console.log('‚úÖ PACKAGES –ù–ê–ô–î–ï–ù –í –ó–ê–ü–†–û–°–ï:', requestData.delivery.packages);\n01127|       } else {\n01128|         console.log('‚ùå PACKAGES –ù–ï –ù–ê–ô–î–ï–ù –í –ó–ê–ü–†–û–°–ï');\n01129|         console.log('   form.needPackaging =', form.needPackaging);\n01130|         console.log('   packageUid =', packageUid);\n01131|         console.log('   –£—Å–ª–æ–≤–∏–µ:', form.needPackaging && packageUid);\n01132|       }\n01133| \n01134|       // –ü–æ–ø—ã—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö\n01135|       let response: any = null;\n01136|       let data: any = null;\n01137|       \n01138|       for (let attempt = 1; attempt <= maxRetries; attempt++) {\n01139|         console.log(`üîÑ –î–õ: –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ ${attempt}/${maxRetries}`);\n01140|         \n01141|         response = await fetch(apiUrl, {\n01142|           method: 'POST',\n01143|           headers: {\n01144|             'Content-Type': 'application/json',\n01145|             'Accept': 'application/json'\n01146|           },\n01147|           body: JSON.stringify(requestData)\n01148|         });\n01149| \n01150|         data = await response.json();\n01151|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ response.ok:', response.ok);\n01152|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ status:', response.status);\n01153|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ data:', data);\n01154|         \n01155|         // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\n01156|         const isAuthError = response.status === 401 || \n01157|                            response.status === 403 ||\n01158|                            (response.status === 400 && data?.errors?.some((err: any) => \n01159|                              err.detail?.toLowerCase()?.includes('session') ||\n01160|                              err.detail?.toLowerCase()?.includes('auth') ||\n01161|                              err.detail?.toLowerCase()?.includes('invalid')\n01162|                            ));\n01163| \n01164|         if (isAuthError && attempt < maxRetries) {\n01165|           console.log('üîÑ –î–õ: –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –≤—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...');\n01166|           const newSessionId = await getDellinSessionId();\n01167|           if (newSessionId) {\n01168|             console.log('‚úÖ –î–õ: –ø–æ–ª—É—á–µ–Ω –Ω–æ–≤—ã–π SessionID, –æ–±–Ω–æ–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å...');\n01169|             // –û–±–Ω–æ–≤–ª—è–µ–º sessionID –≤ –∑–∞–ø—Ä–æ—Å–µ\n01170|             requestData.sessionID = newSessionId;\n01171|             sessionID = newSessionId;\n01172|             continue; // –ü—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —Å –Ω–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n01173|           } else {\n01174|             console.error('‚ùå –î–õ: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π SessionID');\n01175|             break;\n01176|           }\n01177|         }\n01178|         \n01179|         if (response.status === 400 && data?.errors) {\n01180|           console.log('=== –ê–ù–ê–õ–ò–ó –û–®–ò–ë–ö–ò 400 ===');\n01181|           console.log('üîç –û—à–∏–±–∫–∏:', data.errors);\n01182|           data.errors.forEach((error: any, index: number) => {\n01183|             console.log(`üîç –û—à–∏–±–∫–∞ ${index + 1}:`, error);\n01184|             console.log(`   - –ü–æ–ª–µ: ${error.field || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`);\n01185|             console.log(`   - –°–æ–æ–±—â–µ–Ω–∏–µ: ${error.detail || error.message || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`);\n01186|           });\n01187|           console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –û–®–ò–ë–ö–ò 400 ===');\n01188|         }\n01189| \n01190|         // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–Ω—ã–π –∏–ª–∏ –Ω–µ —Å–≤—è–∑–∞–Ω —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É\n01191|         break;\n01192|       }\n01193| \n01194|       \n01195|       // –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –°–¢–†–ê–•–û–í–ö–ò\n01196|       console.log('=== –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –°–¢–†–ê–•–û–í–ö–ò ===');\n01197|       console.log('üîç –ü–û–õ–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê data.data:', JSON.stringify(data.data, null, 2));\n01198|       \n01199|       // –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç—Ä–∞—Ö–æ–≤–∫–æ–π\n01200|       console.log('üí≥ –ü–û–ò–°–ö –ö–û–ú–ü–û–ù–ï–ù–¢–û–í –°–¢–†–ê–•–û–í–ö–ò:');\n01201|       console.log('üí≥ data.data.insurance:', data.data?.insurance);\n01202|       console.log('üí≥ data.data.cargoInsurance:', data.data?.cargoInsurance);\n01203|       console.log('üí≥ data.data.termInsurance:', data.data?.termInsurance);\n01204|       console.log('üí≥ data.data.insuranceDetails:', data.data?.insuranceDetails);\n01205|       console.log('üí≥ data.data.services:', data.data?.services);\n01206|       console.log('üí≥ data.data.additionalServices:', data.data?.additionalServices);\n01207|       \n01208|       // –ü–æ–∏—Å–∫ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏ –≤ –¥—Ä—É–≥–∏—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö\n01209|       if (data.data.derival) {\n01210|         console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –ó–ê–ë–û–ï data.data.derival.insurance:', data.data.derival.insurance);\n01211|       }\n01212|       if (data.data.arrival) {\n01213|         console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –î–û–°–¢–ê–í–ö–ï data.data.arrival.insurance:', data.data.arrival.insurance);\n01214|       }\n01215|       if (data.data.intercity) {\n01216|         console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –ü–ï–†–ï–í–û–ó–ö–ï data.data.intercity.insurance:', data.data.intercity.insurance);\n01217|       }\n01218|       \n01219|       // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö \"insurance\"\n01220|       const findInsuranceFields = (obj: any, path = '') => {\n01221|         if (typeof obj !== 'object' || obj === null) return;\n01222|         \n01223|         Object.keys(obj).forEach(key => {\n01224|           const fullPath = path ? `${path}.${key}` : key;\n01225|           if (key.toLowerCase().includes('insurance') || key.toLowerCase().includes('insur')) {\n01226|             console.log(`üí≥ –ù–ê–ô–î–ï–ù–û –ü–û–õ–ï –°–¢–†–ê–•–û–í–ö–ò [${fullPath}]:`, obj[key]);\n01227|           }\n01228|           if (typeof obj[key] === 'object') {\n01229|             findInsuranceFields(obj[key], fullPath);\n01230|           }\n01231|         });\n01232|       };\n01233|       \n01234|       console.log('üí≥ –†–ï–ö–£–†–°–ò–í–ù–´–ô –ü–û–ò–°–ö –ü–û–õ–ï–ô –°–¢–†–ê–•–û–í–ö–ò:');\n01235|       findInsuranceFields(data.data, 'data.data');\n01236|       console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –°–¢–†–ê–•–û–í–ö–ò ===');\n01237|       \n01238|       // –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ packages –≤ –æ—Ç–≤–µ—Ç–µ\n01239|       console.log('=== –ü–û–ò–°–ö PACKAGES –í –û–¢–í–ï–¢–ï ===');\n01240|       console.log('üì¶ data.data =', data.data);\n01241|       console.log('üì¶ data.data.packages =', data.data?.packages);\n01242|       console.log('üì¶ –¢–∏–ø data.data.packages:', typeof data.data?.packages);\n01243|       if (data.data?.packages) {\n01244|         console.log('‚úÖ PACKAGES –ù–ê–ô–î–ï–ù –í –û–¢–í–ï–¢–ï!');\n01245|         console.log('üì¶ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ packages:', JSON.stringify(data.data.packages, null, 2));\n01246|       } else {\n01247|         console.log('‚ùå PACKAGES –ù–ï –ù–ê–ô–î–ï–ù –í –û–¢–í–ï–¢–ï');\n01248|       }\n01249|       console.log('=== –ö–û–ù–ï–¶ –ü–û–ò–°–ö–ê PACKAGES ===');\n01250| \n01251|       if (response.ok && data.data && data.metadata?.status === 200) {\n01252|         let totalPrice = data.data.price || 0;\n01253|         console.log('üí∞ –†–ê–°–ß–ï–¢ –ò–¢–û–ì–û–í–û–ô –°–¢–û–ò–ú–û–°–¢–ò:');\n01254|         console.log('üí∞ –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å data.data.price (–£–ñ–ï –í–ö–õ–Æ–ß–ê–ï–¢ –í–°–ï):', totalPrice);\n01255|         \n01256|         // –°–¢–†–ê–•–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n01257|         if (data.data.insurance) {\n01258|           console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ data.data.insurance (–£–ñ–ï –≤–∫–ª—é—á–µ–Ω–∞ –≤ –±–∞–∑–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):', data.data.insurance);\n01259|           console.log('üí∞ –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞—Ö–æ–≤–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ');\n01260|         } else {\n01261|           console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–≤–µ—Ç–µ');\n01262|         }\n01263|         \n01264|         // –£–ü–ê–ö–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n01265|         console.log('üí∞ –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–ë –£–ü–ê–ö–û–í–ö–ï (–£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –í –û–°–ù–û–í–ù–£–Æ –°–¢–û–ò–ú–û–°–¢–¨):');\n01266|         console.log('üí∞ data.data.packages =', data.data.packages);\n01267|         console.log('üí∞ form.needPackaging =', form.needPackaging);\n01268|         \n01269|         if (data.data.packages && form.needPackaging) {\n01270|           console.log('üí∞ ‚úÖ –£–ü–ê–ö–û–í–ö–ê –ü–†–ò–°–£–¢–°–¢–í–£–ï–¢ –í –û–¢–í–ï–¢–ï (—Ü–µ–Ω–∞ —É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ data.data.price)');\n01271|           console.log('üí∞ –¢–∏–ø packages:', Array.isArray(data.data.packages) ? 'Array' : 'Object');\n01272|           \n01273|           if (Array.isArray(data.data.packages)) {\n01274|             data.data.packages.forEach((pkg: any, index: number) => {\n01275|               console.log(`üí∞ Package [${index}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n01276|             });\n01277|           } else {\n01278|             Object.entries(data.data.packages).forEach(([key, pkg]: [string, any]) => {\n01279|               console.log(`üí∞ Package [${key}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n01280|             });\n01281|           }\n01282|         } else {\n01283|           console.log('üí∞ ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∞—Å—å');\n01284|         }\n01285| \n01286|         // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–∞–∫ —Ä–∞–∑–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –¥–∞—Ç–∞–º–∏ pickup –∏ arrivalToOspReceiver\n01287|         let deliveryDays = 0;\n01288|         try {\n01289|           console.log('=== –ü–û–ò–°–ö –î–ê–¢ –í –û–¢–í–ï–¢–ï ===');\n01290|           \n01291|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–µ—Å—Ç–∞ –≥–¥–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–∞—Ç—ã\n01292|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.pickup:', data.data?.pickup);\n01293|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.pickup:', data.pickup);\n01294|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.pickup:', data?.pickup);\n01295|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.arrivalToOspReceiver:', data.data?.arrivalToOspReceiver);\n01296|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.arrivalToOspReceiver:', data.arrivalToOspReceiver);\n01297|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.arrivalToOspReceiver:', data?.arrivalToOspReceiver);\n01298|           \n01299|           // –ë–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–π –ø–æ–∏—Å–∫ –≤–æ –≤—Å–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ data\n01300|           const findDateInObject = (obj: any, fieldName: string): string | null => {\n01301|             if (!obj || typeof obj !== 'object') return null;\n01302|             \n01303|             for (const [key, value] of Object.entries(obj)) {\n01304|               if (key === fieldName && typeof value === 'string') {\n01305|                 return value;\n01306|               }\n01307|               if (typeof value === 'object' && value !== null) {\n01308|                 const found = findDateInObject(value, fieldName);\n01309|                 if (found) return found;\n01310|               }\n01311|             }\n01312|             return null;\n01313|           };\n01314|           \n01315|           const pickup = findDateInObject(data, 'pickup');\n01316|           const arrivalToOspReceiver = findDateInObject(data, 'arrivalToOspReceiver');\n01317|           \n01318|           console.log('–ù–ê–ô–î–ï–ù–ù–´–ï –î–ê–¢–´:');\n01319|           console.log('pickup:', pickup);\n01320|           console.log('arrivalToOspReceiver:', arrivalToOspReceiver);\n01321|           \n01322|           if (pickup && arrivalToOspReceiver) {\n01323|             // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—ã (—Ñ–æ—Ä–º–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å \"2025-09-27\" –∏–ª–∏ \"2025-09-27 10:00:00\")\n01324|             const pickupDate = new Date(pickup);\n01325|             const arrivalDate = new Date(arrivalToOspReceiver);\n01326|             \n01327|             console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ pickup:', pickupDate);\n01328|             console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ arrival:', arrivalDate);\n01329|             \n01330|             // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã\n01331|             if (!isNaN(pickupDate.getTime()) && !isNaN(arrivalDate.getTime())) {\n01332|               // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–æ—Å—Ç—å –≤ –¥–Ω—è—Ö\n01333|               const timeDiff = arrivalDate.getTime() - pickupDate.getTime();\n01334|               deliveryDays = Math.max(1, Math.ceil(timeDiff / (1000 * 3600 * 24))); // –ú–∏–Ω–∏–º—É–º 1 –¥–µ–Ω—å\n01335|               \n01336|               console.log('–†–∞–∑–Ω–æ—Å—Ç—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö:', timeDiff);\n01337|               console.log('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –í–´–ß–ò–°–õ–ï–ù —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:', deliveryDays, '–¥–Ω–µ–π');\n01338|             } else {\n01339|               console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞—Ç—ã –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞');\n01340|               console.error('pickup Date object:', pickupDate);\n01341|               console.error('arrival Date object:', arrivalDate);\n01342|             }\n01343|           } else {\n01344|             console.warn('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ –Ω–∞–π–¥–µ–Ω—ã –¥–∞—Ç—ã pickup –∏–ª–∏ arrivalToOspReceiver');\n01345|             console.log('pickup –Ω–∞–π–¥–µ–Ω:', !!pickup, pickup);\n01346|             console.log('arrivalToOspReceiver –Ω–∞–π–¥–µ–Ω:', !!arrivalToOspReceiver, arrivalToOspReceiver);\n01347|           }\n01348|         } catch (error) {\n01349|           console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –û—à–∏–±–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:', error);\n01350|         }\n01351| \n01352|         console.log('üí∞ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ò–¢–û–ì–û–í–ê–Ø –°–¢–û–ò–ú–û–°–¢–¨:', Math.round(totalPrice));\n01353|         \n01354|         return {\n01355|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01356|           price: Math.round(totalPrice),\n01357|           days: deliveryDays || 0,\n01358|           details: data.data,\n01359|           requestData,\n01360|           responseData: data,\n01361|           apiUrl,\n01362|           sessionId: sessionID\n01363|         };\n01364|       } else {\n01365|         const errorMessage = data.metadata?.detail || \n01366|                            data.metadata?.message || \n01367|                            data.errors?.[0]?.detail || \n01368|                            (data.metadata?.status !== 200 ? `HTTP ${data.metadata?.status}` : '') ||\n01369|                            '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏';\n01370|         return {\n01371|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01372|           price: 0,\n01373|           days: 0,\n01374|           error: errorMessage,\n01375|           requestData,\n01376|           responseData: data,\n01377|           apiUrl,\n01378|           sessionId: sessionID\n01379|         };\n01380|       }\n01381|     } catch (error: any) {\n01382|       return {\n01383|         company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01384|         price: 0,\n01385|         days: 0,\n01386|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n01387|         requestData: null,\n01388|         responseData: null,\n01389|         apiUrl\n01390|       };\n01391|     }\n01392|   };\n01393| \n01394| \n01395| \n01396|   // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–Ω–æ–π –∑–æ–Ω—ã –∏ —Å–∫–ª–∞–¥–∞ –ü–≠–ö –ø–æ –∞–¥—Ä–µ—Å—É —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏\n01397|   const getPekZoneByAddress = async (address: string) => {\n01398|     try {\n01399|       console.log(`üîç –ü–≠–ö: –ø–æ–∏—Å–∫ –∑–æ–Ω—ã –¥–ª—è –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n01400|       \n01401|       const response = await fetch('/api/pek', {\n01402|         method: 'POST',\n01403|         headers: {\n01404|           'Content-Type': 'application/json',\n01405|         },\n01406|         body: JSON.stringify({\n01407|           method: 'findzonebyaddress',\n01408|           address: address\n01409|         })\n01410|       });\n01411| \n01412|       console.log(`üì° –ü–≠–ö API —Å—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`);\n01413|       \n01414|       if (!response.ok) {\n01415|         let errorData;\n01416|         try {\n01417|           errorData = await response.json();\n01418|         } catch {\n01419|           errorData = { error: '–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç' };\n01420|         }\n01421|         \n01422|         console.error(`‚ùå –ü–≠–ö API –æ—à–∏–±–∫–∞ ${response.status}:`, errorData);\n01423|         \n01424|         // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫\n01425|         if (response.status === 401) {\n01426|           console.error('‚ùå –ü–≠–ö: –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω');\n01427|         } else if (response.status === 404) {\n01428|           console.error('‚ùå –ü–≠–ö: –ú–µ—Ç–æ–¥ API –Ω–µ –Ω–∞–π–¥–µ–Ω');\n01429|         } else if (response.status === 400) {\n01430|           console.error('‚ùå –ü–≠–ö: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞');\n01431|         } else if (response.status >= 500) {\n01432|           console.error('‚ùå –ü–≠–ö: –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ü–≠–ö');\n01433|         }\n01434|         \n01435|         console.log(`üîÑ –ü–≠–ö: –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥—É –¥–ª—è \"${address}\"`);\n01436|         return getPekZoneFallback(address);\n01437|       }\n01438| \n01439|       const data = await response.json();\n01440|       console.log(`‚úÖ –ü–≠–ö –∑–æ–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞:`, data);\n01441|       \n01442|       if (data.zoneId && data.mainWarehouseId) {\n01443|         return {\n01444|           zoneId: data.zoneId,\n01445|           zoneName: data.zoneName,\n01446|           branchUID: data.branchUID,\n01447|           branchCode: data.branchCode,\n01448|           branchTitle: data.branchTitle,\n01449|           mainWarehouseId: data.mainWarehouseId,\n01450|           warehousePoint: data.warehousePoint,\n01451|           geoData: data.GeoData,\n01452|           precision: data.GeoData?.precision\n01453|         };\n01454|       }\n01455|       \n01456|       console.warn(`‚ö†Ô∏è –ü–≠–ö: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç:`, data);\n01457|       return getPekZoneFallback(address);\n01458|       \n01459|     } catch (error) {\n01460|       console.error('‚ùå –ü–≠–ö: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∑–æ–Ω—ã:', error);\n01461|       return getPekZoneFallback(address);\n01462|     }\n01463|   };\n01464| \n01465|   // –§–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–æ–Ω—ã –ü–≠–ö\n01466|   const getPekZoneFallback = (address: string) => {\n01467|     console.log(`üîÑ –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –∞–Ω–∞–ª–∏–∑ –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n01468|     \n01469|     const addressLower = address.toLowerCase();\n01470|     \n01471|     // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –∏ –∏—Ö –¥–∞–Ω–Ω—ã–µ\n01472|     const cityMappings: { [key: string]: any } = {\n01473|       '–º–æ—Å–∫–≤–∞': {\n01474|         zoneId: 'moscow-zone-001',\n01475|         zoneName: '–ú–æ—Å–∫–≤–∞',\n01476|         branchUID: 'moscow-branch-001',\n01477|         branchCode: '–ú–°–ö',\n01478|         branchTitle: '–ú–æ—Å–∫–≤–∞',\n01479|         mainWarehouseId: 'dc6c746d-812d-11e4-bbfc-001999d8b3c5',\n01480|         warehousePoint: {\n01481|           latitude: 55.755826,\n01482|           longitude: 37.6173\n01483|         }\n01484|       },\n01485|       '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': {\n01486|         zoneId: 'spb-zone-001',\n01487|         zoneName: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n01488|         branchUID: 'spb-branch-001',\n01489|         branchCode: '–°–ü–ë',\n01490|         branchTitle: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n01491|         mainWarehouseId: 'b436c978-086d-11e6-b6ca-00155d668909',\n01492|         warehousePoint: {\n01493|           latitude: 59.9311,\n01494|           longitude: 30.3609\n01495|         }\n01496|       },\n01497|       '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': {\n01498|         zoneId: 'ekb-zone-001',\n01499|         zoneName: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',\n01500|         branchUID: 'ekb-branch-001',\n01501|         branchCode: '–ï–ö–ë',\n01502|         branchTitle: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',\n01503|         mainWarehouseId: 'f8d9c8e3-8e2d-11e4-bbfc-001999d8b3c5',\n01504|         warehousePoint: {\n01505|           latitude: 56.8431,\n01506|           longitude: 60.6454\n01507|         }\n01508|       }\n01509|     };\n01510|     \n01511|     for (const [city, data] of Object.entries(cityMappings)) {\n01512|       if (addressLower.includes(city) || addressLower.includes(city.replace('-', ' '))) {\n01513|         console.log(`‚úÖ –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –Ω–∞–π–¥–µ–Ω –≥–æ—Ä–æ–¥ ${city}`);\n01514|         return {\n01515|           ...data,\n01516|           geoData: {\n01517|             precision: 'fallback',\n01518|             kind: 'locality'\n01519|           },\n01520|           precision: 'fallback'\n01521|         };\n01522|       }\n01523|     }\n01524|     \n01525|     console.warn(`‚ùå –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –≥–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ \"${address}\"`);\n01526|     return null;\n01527|   };\n01528| \n01529|   // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –ü–≠–ö\n01530|   const getPekNearestDepartments = async (address: string, coordinates?: { latitude: string, longitude: string }) => {\n01531|     try {\n01532|       console.log(`üè¢ –ü–≠–ö: –ø–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –¥–ª—è \"${address}\"`);\n01533|       \n01534|       const requestBody: any = {\n01535|         departmentOperation: 3, // –≤—ã–¥–∞—á–∞ –≥—Ä—É–∑–æ–≤\n01536|         type: 3, // –∞–≤—Ç–æ-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç\n01537|         searchRadius: 50, // –∫–º\n01538|         limit: 5\n01539|       };\n01540|       \n01541|       // –ü–≠–ö API —Ç—Ä–µ–±—É–µ—Ç –∏ –∞–¥—Ä–µ—Å, –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ\n01542|       requestBody.address = address;\n01543|       \n01544|       if (coordinates) {\n01545|         requestBody.coordinates = coordinates;\n01546|         console.log(`üìç –ü–≠–ö: –ø–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\" –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º`, coordinates);\n01547|       } else {\n01548|         console.log(`üìç –ü–≠–ö: –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\"`);\n01549|       }\n01550|       \n01551|       const response = await fetch('/api/pek', {\n01552|         method: 'POST',\n01553|         headers: {\n01554|           'Content-Type': 'application/json',\n01555|         },\n01556|         body: JSON.stringify({\n01557|           method: 'nearestdepartments',\n01558|           ...requestBody\n01559|         })\n01560|       });\n01561| \n01562|       console.log(`üì° –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API —Å—Ç–∞—Ç—É—Å: ${response.status}`);\n01563|       \n01564|       if (!response.ok) {\n01565|         const errorText = await response.text();\n01566|         console.error(`‚ùå –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API –æ—à–∏–±–∫–∞: ${response.status} ${response.statusText}`);\n01567|         console.error(`‚ùå –û—Ç–≤–µ—Ç:`, errorText.substring(0, 500));\n01568|         return null;\n01569|       }\n01570| \n01571|       const data = await response.json();\n01572|       console.log(`‚úÖ –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–∞–π–¥–µ–Ω—ã:`, data);\n01573|       \n01574|       // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤–æ–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ —Å –Ω–∞–∏–≤—ã—Å—à–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º\n01575|       if (data.freeDepartments && data.freeDepartments.length > 0) {\n01576|         const bestDepartment = data.freeDepartments.sort((a: any, b: any) => b.priority - a.priority)[0];\n01577|         console.log(`‚úÖ –ü–≠–ö: –≤—ã–±—Ä–∞–Ω–æ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ`, bestDepartment.divisionName);\n01578|         return {\n01579|           warehouseId: bestDepartment.warehouseId,\n01580|           branchId: bestDepartment.branchId,\n01581|           branchName: bestDepartment.branchName,\n01582|           divisionName: bestDepartment.divisionName,\n01583|           address: bestDepartment.address,\n01584|           coordinates: bestDepartment.coordinates,\n01585|           phone: bestDepartment.phone,\n01586|           email: bestDepartment.email\n01587|         };\n01588|       }\n01589|       \n01590|       console.warn(`‚ùå –ü–≠–ö: –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è \"${address}\"`);\n01591|       return null;\n01592|     } catch (error) {\n01593|       console.error('‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –æ—Ç–¥–µ–ª–µ–Ω–∏–π:', error);\n01594|       return null;\n01595|     }\n01596|   };\n01597| \n01598|   // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ü–≠–ö)\n01599|   const getYandexCoordinates = async (address: string): Promise<{ latitude: string, longitude: string } | null> => {\n01600|     try {\n01601|       const encodedAddress = encodeURIComponent(address);\n01602|       const response = await fetch(`https://geocode-maps.yandex.ru/1.x/?apikey=YOUR_API_KEY&geocode=${encodedAddress}&format=json`);\n01603|       \n01604|       if (!response.ok) return null;\n01605|       \n01606|       const data = await response.json();\n01607|       const coords = data?.response?.GeoObjectCollection?.featureMember?.[0]?.GeoObject?.Point?.pos?.split(' ');\n01608|       \n01609|       if (coords && coords.length === 2) {\n01610|         return {\n01611|           longitude: coords[0],\n01612|           latitude: coords[1]\n01613|         };\n01614|       }\n01615|       \n01616|       return null;\n01617|     } catch (error) {\n01618|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ø–Ω–¥–µ–∫—Å:', error);\n01619|       return null;\n01620|     }\n01621|   };\n01622| \n01623|   // –†–∞—Å—á–µ—Ç –¥–ª—è –ü–≠–ö —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API v1/calculateprice/\n01624|   const calculatePEK = async (): Promise<CalculationResult> => {\n01625|     const apiUrl = 'https://kabinet.pecom.ru/api/v1/calculateprice/';\n01626|     \n01627|     // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç\n01628|     const validateCoordinates = (coords: any) => {\n01629|       console.log('üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:', coords);\n01630|       \n01631|       if (!coords) {\n01632|         console.log('‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç');\n01633|         return null;\n01634|       }\n01635|       \n01636|       if (typeof coords.latitude !== 'number' || typeof coords.longitude !== 'number') {\n01637|         console.warn(`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ —è–≤–ª—è—é—Ç—Å—è —á–∏—Å–ª–∞–º–∏:`, { \n01638|           lat: coords.latitude, \n01639|           lng: coords.longitude,\n01640|           latType: typeof coords.latitude,\n01641|           lngType: typeof coords.longitude\n01642|         });\n01643|         return null;\n01644|       }\n01645|       \n01646|       const lat = Number(coords.latitude);\n01647|       const lng = Number(coords.longitude);\n01648|       \n01649|       console.log(`üìç –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: lat=${lat}, lng=${lng}`);\n01650|       \n01651|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω—ã\n01652|       if (lat < -90 || lat > 90 || lng < -180 || lng > 180 || isNaN(lat) || isNaN(lng)) {\n01653|         console.warn(`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–Ω–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞:`, { \n01654|           lat, lng, \n01655|           latValid: lat >= -90 && lat <= 90,\n01656|           lngValid: lng >= -180 && lng <= 180,\n01657|           latIsNaN: isNaN(lat),\n01658|           lngIsNaN: isNaN(lng)\n01659|         });\n01660|         return null;\n01661|       }\n01662|       \n01663|       console.log('‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã:', { latitude: lat, longitude: lng });\n01664|       return { latitude: lat, longitude: lng };\n01665|     };\n01666|     \n01667|     try {\n01668|       // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–æ–Ω–∞—Ö –∏ —Å–∫–ª–∞–¥–∞—Ö –ø–æ –∞–¥—Ä–µ—Å–∞–º\n01669|       console.log(`üöÄ –ü–≠–ö: –Ω–∞—á–∏–Ω–∞–µ–º —Ä–∞—Å—á–µ—Ç`);\n01670|       console.log(`üìç –û—Ç: ${form.fromAddress || form.fromCity}`);\n01671|       console.log(`üìç –î–æ: ${form.toAddress || form.toCity}`);\n01672|       \n01673|       const senderZone = await getPekZoneByAddress(form.fromAddress || `–≥ ${form.fromCity}`);\n01674|       const receiverZone = await getPekZoneByAddress(form.toAddress || `–≥ ${form.toCity}`);\n01675|       \n01676|       console.log(`üîç –ü–≠–ö –∑–æ–Ω—ã:`);\n01677|       console.log(`üìç –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å:`, senderZone ? `${senderZone.branchTitle} (${senderZone.mainWarehouseId})` : '–ù–ï –ù–ê–ô–î–ï–ù–ê');\n01678|       console.log(`üìç –ü–æ–ª—É—á–∞—Ç–µ–ª—å:`, receiverZone ? `${receiverZone.branchTitle} (${receiverZone.mainWarehouseId})` : '–ù–ï –ù–ê–ô–î–ï–ù–ê');\n01679|       \n01680|       if (!senderZone || !receiverZone) {\n01681|         // –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞\n01682|         const debugInfo = {\n01683|           senderAddress: form.fromAddress || form.fromCity,\n01684|           receiverAddress: form.toAddress || form.toCity,\n01685|           senderZoneFound: !!senderZone,\n01686|           receiverZoneFound: !!receiverZone,\n01687|           apiTested: true\n01688|         };\n01689|         \n01690|         console.error(`‚ùå –ü–≠–ö: –∑–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã`, debugInfo);\n01691|         \n01692|         return {\n01693|           company: '–ü–≠–ö',\n01694|           price: 0,\n01695|           days: 0,\n01696|           error: `–ó–æ–Ω–∞ –ü–≠–ö –Ω–µ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥—Ä–µ—Å–∞: ${!senderZone ? (form.fromAddress || form.fromCity) : ''} ${!receiverZone ? (form.toAddress || form.toCity) : ''}`.trim(),\n01697|           apiUrl,\n01698|           requestData: debugInfo,\n01699|           responseData: { senderZone, receiverZone }\n01700|         };\n01701|       }\n01702| \n01703|       // –ü–æ–ª—É—á–∞–µ–º –±–ª–∏–∂–∞–π—à–∏–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –∞–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞\n01704|       let senderWarehouseId = senderZone.mainWarehouseId;\n01705|       let receiverWarehouseId = receiverZone.mainWarehouseId;\n01706|       \n01707|       if (form.fromAddressDelivery && senderZone.warehousePoint) {\n01708|         const validSenderCoords = validateCoordinates(senderZone.warehousePoint);\n01709|         if (validSenderCoords) {\n01710|           try {\n01711|             const senderDepartment = await getPekNearestDepartments(\n01712|               form.fromAddress || form.fromCity,\n01713|               {\n01714|                 latitude: validSenderCoords.latitude.toString(),\n01715|                 longitude: validSenderCoords.longitude.toString()\n01716|               }\n01717|             );\n01718|             if (senderDepartment) {\n01719|               senderWarehouseId = senderDepartment.warehouseId;\n01720|               console.log('‚úÖ –ù–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π —Å–∫–ª–∞–¥ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è:', senderDepartment.warehouseId);\n01721|             }\n01722|           } catch (error) {\n01723|             console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥:', error);\n01724|           }\n01725|         } else {\n01726|           console.warn('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥');\n01727|         }\n01728|       }\n01729|       \n01730|       if (form.toAddressDelivery && receiverZone.warehousePoint) {\n01731|         const validReceiverCoords = validateCoordinates(receiverZone.warehousePoint);\n01732|         if (validReceiverCoords) {\n01733|           try {\n01734|             const receiverDepartment = await getPekNearestDepartments(\n01735|               form.toAddress || form.toCity,\n01736|               {\n01737|                 latitude: validReceiverCoords.latitude.toString(),\n01738|                 longitude: validReceiverCoords.longitude.toString()\n01739|               }\n01740|             );\n01741|             if (receiverDepartment) {\n01742|               receiverWarehouseId = receiverDepartment.warehouseId;\n01743|               console.log('‚úÖ –ù–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π —Å–∫–ª–∞–¥ –ø–æ–ª—É—á–∞—Ç–µ–ª—è:', receiverDepartment.warehouseId);\n01744|             }\n01745|           } catch (error) {\n01746|             console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥:', error);\n01747|           }\n01748|         } else {\n01749|           console.warn('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥');\n01750|         }\n01751|       }\n01752| \n01753|       // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞—Ç—ã N –¥–Ω–µ–π –æ—Ç —Å–µ–≥–æ–¥–Ω—è\n01754|       const getDateForCalculation = (daysFromToday: number): string => {\n01755|         const date = new Date();\n01756|         date.setDate(date.getDate() + daysFromToday);\n01757|         return date.toISOString().slice(0, 19); // 2025-09-28T14:00:00\n01758|       };\n01759| \n01760|       // –ù–∞—á–∏–Ω–∞–µ–º —Å –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–≥–æ –¥–Ω—è\n01761|       let currentDayOffset = 1;\n01762|       let plannedDateTime = getDateForCalculation(currentDayOffset);\n01763| \n01764|       // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤ (–±–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç)\n01765|       const cargos = form.cargos.map(cargo => {\n01766|         const cargoData = {\n01767|           length: cargo.length / 100, // –ø–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–µ—Ç—Ä—ã\n01768|           width: cargo.width / 100,\n01769|           height: cargo.height / 100,\n01770|           volume: (cargo.length * cargo.width * cargo.height) / 1000000, // –º3\n01771|           weight: cargo.weight,\n01772|           isHP: form.needPackaging, // –∑–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n01773|           sealingPositionsCount: 0\n01774|         };\n01775|         \n01776|         console.log('üì¶ –ì—Ä—É–∑ –¥–ª—è –ü–≠–ö:', cargoData);\n01777|         return cargoData;\n01778|       });\n01779| \n01780|       // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (–Ω—É–∂–Ω–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ)\n01781|       let finalRequestData: any = null;\n01782|       \n01783|       // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ —Ä–∞—Å—á–µ—Ç–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç–æ–π\n01784|       const tryCalculateWithDate = async (plannedDateTime: string): Promise<any> => {\n01785|         // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –∫ API –ü–≠–ö —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n01786|         const requestData: any = {\n01787|           currencyCode: \"643\", // —Ä—É–±–ª–∏\n01788|           types: [3], // —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ –ø–µ—Ä–µ–≤–æ–∑–∫–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –º–∞—Å—Å–∏–≤)\n01789|           senderWarehouseId,\n01790|           receiverWarehouseId,\n01791|           isOpenCarSender: false,\n01792|           isOpenCarReceiver: false,\n01793|           isHyperMarket: false,\n01794|           plannedDateTime,\n01795|           isInsurance: form.needInsurance && form.declaredValue > 0,\n01796|           isInsurancePrice: form.needInsurance ? form.declaredValue : 0,\n01797|           isPickUp: form.fromAddressDelivery,\n01798|           isDelivery: form.toAddressDelivery,\n01799|           needReturnDocuments: false,\n01800|           needArrangeTransportationDocuments: false,\n01801|           senderDistanceType: 0,\n01802|           receiverDistanceType: 0,\n01803|           cargos // –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤\n01804|         };\n01805|         \n01806|         console.log('üìã –ü–≠–ö: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ requestData:', JSON.stringify(requestData, null, 2));\n01807| \n01808|         // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏ –ü–†–† –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\n01809|         if (form.needCarry) {\n01810|           requestData.pickupServices = {\n01811|             isLoading: true,\n01812|             floor: Math.max(0, form.floor - 1), // –ü–≠–ö —Å—á–∏—Ç–∞–µ—Ç —Å 0\n01813|             carryingDistance: 0,\n01814|             isElevator: form.hasFreightLift\n01815|           };\n01816|           requestData.deliveryServices = {\n01817|             isLoading: true,\n01818|             floor: Math.max(0, form.floor - 1),\n01819|             carryingDistance: 0,\n01820|             isElevator: form.hasFreightLift\n01821|           };\n01822|         }\n01823| \n01824|         // –î–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫–∏ pickup/delivery —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ü–≠–ö\n01825|         if (form.fromAddressDelivery) {\n01826|           console.log('üìç –ü–≠–ö: –¥–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ pickup –¥–ª—è –∑–∞–±–æ—Ä–∞');\n01827|           requestData.pickup = {\n01828|             address: form.fromAddress || `–†–æ—Å—Å–∏—è, ${form.fromCity}`\n01829|             // coordinates –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏\n01830|           };\n01831|         }\n01832|         \n01833|         if (form.toAddressDelivery) {\n01834|           console.log('üìç –ü–≠–ö: –¥–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ delivery –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏');\n01835|           requestData.delivery = {\n01836|             address: form.toAddress || `–†–æ—Å—Å–∏—è, ${form.toCity}`\n01837|             // coordinates –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏\n01838|           };\n01839|         }\n01840| \n01841|         // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n01842|         const requiredFields = ['types', 'senderWarehouseId', 'receiverWarehouseId', 'plannedDateTime', 'cargos'];\n01843|         const missingFields = requiredFields.filter(field => !requestData[field]);\n01844|         \n01845|         if (missingFields.length > 0) {\n01846|           throw new Error(`–ü–≠–ö: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: ${missingFields.join(', ')}`);\n01847|         }\n01848|         \n01849|         if (!Array.isArray(requestData.types) || requestData.types.length === 0) {\n01850|           throw new Error('–ü–≠–ö: –ø–æ–ª–µ types –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º');\n01851|         }\n01852|         \n01853|         if (!Array.isArray(requestData.cargos) || requestData.cargos.length === 0) {\n01854|           throw new Error('–ü–≠–ö: –ø–æ–ª–µ cargos –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º');\n01855|         }\n01856|         \n01857|         console.log('‚úÖ –ü–≠–ö: –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –ø—Ä–æ–π–¥–µ–Ω–∞');\n01858| \n01859|         // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏\n01860|         finalRequestData = {\n01861|           method: 'calculateprice',\n01862|           ...requestData\n01863|         };\n01864|         \n01865|         console.log('üöÄ –ü–≠–ö API –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å:', JSON.stringify(finalRequestData, null, 2));\n01866|         console.log('üåê –ü–≠–ö API URL:', apiUrl);\n01867|         console.log('üìã –ü–≠–ö: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–ø–æ–≤ —Ç–∞—Ä–∏—Ñ–æ–≤:', requestData.types.length);\n01868|         console.log('üìã –ü–≠–ö: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤:', requestData.cargos.length);\n01869|       \n01870|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π\n01871|       if (finalRequestData.pickup?.coordinates) {\n01872|         console.log('üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã pickup:', finalRequestData.pickup.coordinates);\n01873|       }\n01874|       if (finalRequestData.delivery?.coordinates) {\n01875|         console.log('üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã delivery:', finalRequestData.delivery.coordinates);\n01876|       }\n01877| \n01878|       const response = await fetch('/api/pek', {\n01879|         method: 'POST',\n01880|         headers: {\n01881|           'Content-Type': 'application/json',\n01882|         },\n01883|         body: JSON.stringify(finalRequestData)\n01884|       });\n01885| \n01886|       console.log(`üì° –ü–≠–ö API —Ä–∞—Å—á–µ—Ç —Å—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`);\n01887|       console.log(`üì° –ü–≠–ö API URL: ${response.url}`);\n01888|       \n01889|       const responseText = await response.text();\n01890|       console.log(`üì° –ü–≠–ö API —Å—ã—Ä–æ–π –æ—Ç–≤–µ—Ç:`, responseText.substring(0, 1000));\n01891|       \n01892|       let data;\n01893|       try {\n01894|         data = JSON.parse(responseText);\n01895|         console.log('üöÄ –ü–≠–ö API –æ—Ç–≤–µ—Ç:', JSON.stringify(data, null, 2));\n01896|       } catch (parseError) {\n01897|         console.error('‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', parseError);\n01898|         throw new Error(`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç API: ${responseText.substring(0, 200)}`);\n01899|       }\n01900| \n01901|         return { response, data };\n01902|       };\n01903| \n01904|       // –î–æ–±–∞–≤–ª—è–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞—Å—á–µ—Ç–∞\n01905|       console.log('üîß –ü–≠–ö: –≥–æ—Ç–æ–≤–∏–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞...');\n01906|       console.log('üìç senderWarehouseId:', senderWarehouseId);\n01907|       console.log('üìç receiverWarehouseId:', receiverWarehouseId);\n01908|       console.log('üìÖ –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞:', plannedDateTime);\n01909|       console.log('üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤:', cargos.length);\n01910|       console.log('üîß form.fromAddressDelivery:', form.fromAddressDelivery);\n01911|       console.log('üîß form.toAddressDelivery:', form.toAddressDelivery);\n01912|       \n01913|       // –¶–∏–∫–ª –ø–æ–ø—ã—Ç–æ–∫ —Å —Ä–∞–∑–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏ (–º–∞–∫—Å–∏–º—É–º 7 –¥–Ω–µ–π)\n01914|       const maxRetries = 7;\n01915|       let lastError: Error | null = null;\n01916|       \n01917|       console.log('üöÄ –ü–≠–ö: –∑–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª —Ä–∞—Å—á–µ—Ç–∞...');\n01918|       \n01919|       for (let attempt = 0; attempt < maxRetries; attempt++) {\n01920|         try {\n01921|           console.log(`üìÖ –ü–≠–ö: –ø–æ–ø—ã—Ç–∫–∞ ${attempt + 1}/${maxRetries}, –¥–∞—Ç–∞: ${plannedDateTime}`);\n01922|           \n01923|           const { response, data } = await tryCalculateWithDate(plannedDateTime);\n01924|           \n01925|           if (response.ok && !data.hasError && data.transfers && data.transfers.length > 0) {\n01926|             const transfer = data.transfers[0]; // –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Ç–∞—Ä–∏—Ñ (–∞–≤—Ç–æ)\n01927|             \n01928|             if (!transfer.hasError) {\n01929|           // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —É—Å–ª—É–≥\n01930|           const services: { name: string; description: string; price: number }[] = [];\n01931|           let totalCalculated = 0;\n01932| \n01933|           const processServices = (servicesList: any[], parentName = '') => {\n01934|             servicesList.forEach(service => {\n01935|               const serviceName = parentName ? `${parentName} - ${service.info}` : service.info;\n01936|               const serviceCost = parseFloat(service.cost) || 0;\n01937|               \n01938|               if (serviceCost > 0) {\n01939|                 services.push({\n01940|                   name: serviceName,\n01941|                   description: service.serviceType || '',\n01942|                   price: serviceCost\n01943|                 });\n01944|                 totalCalculated += serviceCost;\n01945|               }\n01946| \n01947|               // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏\n01948|               if (service.services && Array.isArray(service.services)) {\n01949|                 processServices(service.services, serviceName);\n01950|               }\n01951|             });\n01952|           };\n01953| \n01954|           if (transfer.services) {\n01955|             processServices(transfer.services);\n01956|           }\n01957| \n01958|           // –ï—Å–ª–∏ –Ω–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —É—Å–ª—É–≥, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n01959|           if (services.length === 0) {\n01960|             services.push({\n01961|               name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n01962|               description: `${senderZone.branchTitle} - ${receiverZone.branchTitle}`,\n01963|               price: Math.round(transfer.costTotal)\n01964|             });\n01965|           }\n01966| \n01967|           return {\n01968|             company: '–ü–≠–ö',\n01969|             price: Math.round(transfer.costTotal),\n01970|             days: transfer.estDeliveryTime || 3,\n01971|             details: {\n01972|               note: `–î–æ—Å—Ç–∞–≤–∫–∞ ${senderZone.branchTitle} - ${receiverZone.branchTitle} (–∞–≤—Ç–æ)`,\n01973|               services,\n01974|               senderZone: {\n01975|                 title: senderZone.branchTitle,\n01976|                 zone: senderZone.zoneName,\n01977|                 warehouseId: senderWarehouseId\n01978|               },\n01979|               receiverZone: {\n01980|                 title: receiverZone.branchTitle,\n01981|                 zone: receiverZone.zoneName,\n01982|                 warehouseId: receiverWarehouseId\n01983|               }\n01984|             },\n01985|             requestData: finalRequestData,\n01986|             responseData: data,\n01987|             apiUrl\n01988|               };\n01989|             } else {\n01990|               // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ–±–ª–µ–º–æ–π —Å –¥–∞—Ç–æ–π\n01991|               const errorMessage = transfer.errorMessage || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞ –ü–≠–ö';\n01992|               if (errorMessage.includes('–∑–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω') || errorMessage.includes('–≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã')) {\n01993|                 console.log(`üìÖ –ü–≠–ö: ${errorMessage}. –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...`);\n01994|                 lastError = new Error(errorMessage);\n01995|                 // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é\n01996|                 currentDayOffset++;\n01997|                 plannedDateTime = getDateForCalculation(currentDayOffset);\n01998|                 continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –¥–∞—Ç—É\n01999|               } else {\n02000|                 throw new Error(errorMessage);\n\n(File has more lines. Use 'offset' parameter to read beyond line 2000)\n</file>",
    "metadata": {
      "preview": "'use client';\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Plus, Truck, Building2, Map, Settings, Package2 } from 'lucide-react';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { Collapsible, CollapsibleContent } from '@/components/ui/collapsible';\nimport ProductSearch from '@/components/ProductSearch';\nimport ProductManager from '@/components/ProductManager';\nimport TruckVisualization from '@/components/TruckVisualization';\nimport { FurnitureProduct, ProductInForm, CargoWithMetadata } from '@/lib/furniture-types';\nimport { \n  createCargosForProduct, \n  removeCargosForProduct, "
    },
    "title": "app/page.tsx",
    "time": {
      "start": 1759142188486,
      "end": 1759142188491
    }
  }
}