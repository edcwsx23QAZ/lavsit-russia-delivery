{
  "id": "prt_b230ace88001nHEFClEG2BhNwV",
  "sessionID": "ses_4dcf54091ffe1XHg1W7jdm1ovr",
  "messageID": "msg_b230ac012001S2hRtl00q3gGEL",
  "type": "tool",
  "callID": "toolu_01EmKu1w6pNZxMMvYAVxzJEE",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/api/dellin-freight/route.ts"
    },
    "output": "<file>\n00001| import { NextRequest, NextResponse } from 'next/server'\n00002| import { apiRequestWithTimeout, PerformanceMonitor } from '@/lib/api-utils'\n00003| \n00004| // –ö—ç—à –¥–ª—è freight types (24 —á–∞—Å–∞)\n00005| interface FreightCache {\n00006|   data: any[];\n00007|   timestamp: number;\n00008|   ttl: number;\n00009| }\n00010| \n00011| let freightCache: FreightCache | null = null;\n00012| const CACHE_TTL = 24 * 60 * 60 * 1000; // 24 —á–∞—Å–∞\n00013| \n00014| /**\n00015|  * GET - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –≥—Ä—É–∑–∞ \"–ú–µ–±–µ–ª—å\" –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n00016|  * –í—Å–µ–≥–¥–∞ —Ñ–∏–∫—Å–∏—Ä—É–µ–º –ø–æ–∏—Å–∫ –ø–æ \"–ú–µ–±–µ–ª—å\" —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º\n00017|  */\n00018| export async function GET() {\n00019|   const endTiming = PerformanceMonitor.startMeasurement('dellin_freight_get');\n00020|   \n00021|   try {\n00022|     // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à\n00023|     const now = Date.now();\n00024|     if (freightCache && (now - freightCache.timestamp) < freightCache.ttl) {\n00025|       console.log('üì¶ –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä –≥—Ä—É–∑–∞ –∏–∑ –∫—ç—à–∞');\n00026|       const timing = endTiming();\n00027|       return NextResponse.json({\n00028|         success: true,\n00029|         data: freightCache.data,\n00030|         cached: true,\n00031|         timing\n00032|       }, {\n00033|         headers: {\n00034|           'Access-Control-Allow-Origin': '*',\n00035|           'Access-Control-Allow-Methods': 'GET, POST',\n00036|           'Access-Control-Allow-Headers': 'Content-Type',\n00037|         },\n00038|       });\n00039|     }\n00040| \n00041|     console.log('üì¶ –ü–æ–ª—É—á–µ–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –≥—Ä—É–∑–∞ \"–ú–µ–±–µ–ª—å\" –æ—Ç API –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π...');\n00042|     \n00043|     const appKey = process.env.DELLIN_APP_KEY || 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B';\n00044|     \n00045|     // –ó–∞–ø—Ä–æ—Å –∫ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –≥—Ä—É–∑–∞ \"–ú–µ–±–µ–ª—å\"\n00046|     const response = await apiRequestWithTimeout('https://api.dellin.ru/v1/ftl/freight_types.json', {\n00047|       method: 'POST',\n00048|       headers: {\n00049|         'Content-Type': 'application/json',\n00050|       },\n00051|       body: JSON.stringify({\n00052|         appKey: appKey,\n00053|         search: '–ú–µ–±–µ–ª—å'\n00054|       })\n00055|     }, { timeout: 15000, retries: 2 });\n00056| \n00057|     if (!response.ok) {\n00058|       console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –≥—Ä—É–∑–∞:', response.status, response.statusText);\n00059|       endTiming();\n00060|       return NextResponse.json(\n00061|         { \n00062|           error: '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –≥—Ä—É–∑–∞', \n00063|           status: response.status,\n00064|           details: response.statusText\n00065|         },\n00066|         { status: response.status }\n00067|       );\n00068|     }\n00069| \n00070|     const responseData = await response.json();\n00071|     console.log('üì¶ –û—Ç–≤–µ—Ç API freight_types:', JSON.stringify(responseData, null, 2));\n00072| \n00073|     // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞\n00074|     if (responseData.metadata?.status !== 200) {\n00075|       console.error('‚ùå API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É:', responseData.metadata?.status);\n00076|       endTiming();\n00077|       return NextResponse.json(\n00078|         { \n00079|           error: 'API –≤–µ—Ä–Ω—É–ª —Å—Ç–∞—Ç—É—Å –æ—à–∏–±–∫–∏',\n00080|           apiStatus: responseData.metadata?.status,\n00081|           details: responseData\n00082|         },\n00083|         { status: responseData.metadata?.status || 500 }\n00084|       );\n00085|     }\n00086| \n00087|     if (!responseData.data || !Array.isArray(responseData.data)) {\n00088|       console.error('‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ç–≤–µ—Ç–µ API');\n00089|       endTiming();\n00090|       return NextResponse.json(\n00091|         { \n00092|           error: '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö',\n00093|           details: '–û–∂–∏–¥–∞–ª—Å—è –º–∞—Å—Å–∏–≤ data —Å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞–º–∏ –≥—Ä—É–∑–∞'\n00094|         },\n00095|         { status: 500 }\n00096|       );\n00097|     }\n00098| \n00099|     const freightData = responseData.data;\n00100|     console.log(`üì¶ –ü–æ–ª—É—á–µ–Ω–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–≤ –≥—Ä—É–∑–∞ \"–ú–µ–±–µ–ª—å\": ${freightData.length}`);\n00101|     \n00102|     // –í—ã–≤–æ–¥–∏–º –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n00103|     freightData.forEach((freight: any, index: number) => {\n00104|       console.log(`  ${index + 1}. ${freight.name} ‚Üí UID: ${freight.uid}`);\n00105|     });\n00106| \n00107|     // –ö—ç—à–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç\n00108|     freightCache = {\n00109|       data: freightData,\n00110|       timestamp: now,\n00111|       ttl: CACHE_TTL\n00112|     };\n00113| \n00114|     const timing = endTiming();\n00115|     return NextResponse.json({\n00116|       success: true,\n00117|       data: freightData,\n00118|       cached: false,\n00119|       search: '–ú–µ–±–µ–ª—å',\n00120|       count: freightData.length,\n00121|       generatedAt: responseData.metadata?.generated_at,\n00122|       timing\n00123|     }, {\n00124|       headers: {\n00125|         'Access-Control-Allow-Origin': '*',\n00126|         'Access-Control-Allow-Methods': 'GET, POST',\n00127|         'Access-Control-Allow-Headers': 'Content-Type',\n00128|       },\n00129|     });\n00130| \n00131|   } catch (error) {\n00132|     endTiming();\n00133|     console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –≥—Ä—É–∑–∞:', error);\n00134|     return NextResponse.json(\n00135|       { \n00136|         error: '–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –≥—Ä—É–∑–∞',\n00137|         details: error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'\n00138|       },\n00139|       { status: 500 }\n00140|     );\n00141|   }\n00142| }\n00143| \n00144| /**\n00145|  * POST - –¢–µ—Å—Ç–æ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API\n00146|  */\n00147| export async function POST(request: NextRequest) {\n00148|   const endTiming = PerformanceMonitor.startMeasurement('dellin_freight_post');\n00149|   \n00150|   try {\n00151|     const body = await request.json();\n00152|     console.log('üöõ Dellin Freight API POST –∑–∞–ø—Ä–æ—Å:', JSON.stringify(body, null, 2));\n00153|     \n00154|     // Handle test method\n00155|     if (body.method === 'test') {\n00156|       console.log('üß™ Dellin Freight API —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å');\n00157|       const timing = endTiming();\n00158|       return NextResponse.json({ \n00159|         status: 'OK', \n00160|         service: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –•–∞—Ä–∞–∫—Ç–µ—Ä –≥—Ä—É–∑–∞',\n00161|         message: 'API —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –≥—Ä—É–∑–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ',\n00162|         timestamp: new Date().toISOString(),\n00163|         defaultSearch: '–ú–µ–±–µ–ª—å',\n00164|         endpoints: {\n00165|           getFreightTypes: '/api/dellin-freight (GET)',\n00166|           test: '/api/dellin-freight (POST)'\n00167|         },\n00168|         timing\n00169|       });\n00170|     }\n00171| \n00172|     // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º GET endpoint\n00173|     const getResponse = await GET();\n00174|     const timing = endTiming();\n00175|     \n00176|     if (getResponse.status === 200) {\n00177|       const getData = await getResponse.json();\n00178|       return NextResponse.json({ \n00179|         success: true,\n00180|         data: getData.data,\n00181|         timing,\n00182|         requestMethod: body.method || 'get_freight_types',\n00183|         workflow: 'API –î–õ ‚Üí freight_types ‚Üí –ø–æ–∏—Å–∫ \"–ú–µ–±–µ–ª—å\" ‚Üí –ø–æ–ª—É—á–∏—Ç—å UID'\n00184|       }, {\n00185|         headers: {\n00186|           'Access-Control-Allow-Origin': '*',\n00187|           'Access-Control-Allow-Methods': 'GET, POST',\n00188|           'Access-Control-Allow-Headers': 'Content-Type',\n00189|         },\n00190|       });\n00191|     } else {\n00192|       const errorData = await getResponse.json();\n00193|       return NextResponse.json(errorData, { status: getResponse.status });\n00194|     }\n00195| \n00196|   } catch (error) {\n00197|     endTiming();\n00198|     console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ Dellin Freight API:', error);\n00199|     \n00200|     return NextResponse.json({ \n00201|       error: '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞',\n00202|       details: error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞',\n00203|       type: error instanceof Error ? error.name : 'Unknown'\n00204|     }, { status: 500 });\n00205|   }\n00206| }\n00207| \n00208| export async function OPTIONS() {\n00209|   return new NextResponse(null, {\n00210|     status: 200,\n00211|     headers: {\n00212|       'Access-Control-Allow-Origin': '*',\n00213|       'Access-Control-Allow-Methods': 'GET, POST',\n00214|       'Access-Control-Allow-Headers': 'Content-Type',\n00215|     },\n00216|   })\n00217| }\n00218| \n\n(End of file - total 218 lines)\n</file>",
    "title": "app/api/dellin-freight/route.ts",
    "metadata": {
      "preview": "import { NextRequest, NextResponse } from 'next/server'\nimport { apiRequestWithTimeout, PerformanceMonitor } from '@/lib/api-utils'\n\n// –ö—ç—à –¥–ª—è freight types (24 —á–∞—Å–∞)\ninterface FreightCache {\n  data: any[];\n  timestamp: number;\n  ttl: number;\n}\n\nlet freightCache: FreightCache | null = null;\nconst CACHE_TTL = 24 * 60 * 60 * 1000; // 24 —á–∞—Å–∞\n\n/**\n * GET - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –≥—Ä—É–∑–∞ \"–ú–µ–±–µ–ª—å\" –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n * –í—Å–µ–≥–¥–∞ —Ñ–∏–∫—Å–∏—Ä—É–µ–º –ø–æ–∏—Å–∫ –ø–æ \"–ú–µ–±–µ–ª—å\" —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º\n */\nexport async function GET() {\n  const endTiming = PerformanceMonitor.startMeasurement('dellin_freight_get');\n  "
    },
    "time": {
      "start": 1765819470450,
      "end": 1765819470460
    }
  }
}