{
  "id": "prt_b22cba704001MuXW01CpW996Cj",
  "sessionID": "ses_4dd34592affehJqMoLA2ZOxuZo",
  "messageID": "msg_b22cba6fd0010iG0CfwpYfanqD",
  "type": "text",
  "text": "–†–µ–∞–ª–∏–∑—É–π —Å–ª–µ–¥—É—é—â–∏–π –ø–ª–∞–Ω:\n\n–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø–ª–∞–Ω –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è API Nordwheel –î–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –ø–ª–∞–Ω—É\n\n–£–¥–∞–ª–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ü—Ä–∏—á–∏–Ω–∞: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ Dadata –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.\n\n–ò–∑–º–µ–Ω–µ–Ω–∏–µ fallback –ª–æ–≥–∏–∫–∏ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ: –ï—Å–ª–∏ Dadata –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ä–æ–¥ –∫–∞–∫ —Å—Ç—Ä–æ–∫—É –≤–º–µ—Å—Ç–æ FIAS –∫–æ–¥–∞.\n\n–ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ getNordwheelCityFias:\n\nasync function getNordwheelCityFias(cityName: string): Promise<string> { try { // –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ Dadata findById const response = await fetch('/api/dadata?fias_id=' + encodeURIComponent(cityName) + '&type=findById'); const data = await response.json();\n\nif (data.success && data.data?.data?.city_fias_id) {\n  console.log(`üöõ Nordwheel: –ü–æ–ª—É—á–µ–Ω –∞–∫—Ç—É–∞–ª—å–Ω—ã–π FIAS –¥–ª—è ${cityName}:`, data.data.data.city_fias_id);\n  return data.data.data.city_fias_id;\n} else {\n  // FIAS –Ω–µ –Ω–∞–π–¥–µ–Ω - –≤—ã–≤–æ–¥–∏–º –æ—à–∏–±–∫—É\n  console.error(`üöõ Nordwheel: FIAS –∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –≥–æ—Ä–æ–¥–∞ ${cityName}`);\n  throw new Error(`FIAS –∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –≥–æ—Ä–æ–¥–∞ ${cityName}`);\n}\n} catch (error) { console.warn(üöõ Nordwheel: Dadata –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è ${cityName}, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–æ—Ä–æ–¥ –∫–∞–∫ —Å—Ç—Ä–æ–∫—É:, error); // Fallback: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≥–æ—Ä–æ–¥ –∫–∞–∫ —Å—Ç—Ä–æ–∫—É –≤–º–µ—Å—Ç–æ FIAS –∫–æ–¥–∞ return cityName; } } 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ FIAS –∫–æ–¥–∞ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ: –ï—Å–ª–∏ FIAS –Ω–µ –Ω–∞–π–¥–µ–Ω, –≤—ã–≤–µ—Å—Ç–∏ –æ—à–∏–±–∫—É.\n\n–ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ getDispatchLocation –∏ getDestinationLocation:\n\nconst getDispatchLocation = async () => { try { if (form.fromTerminal) { return { type: 'terminal' as const, city_fias: await getNordwheelCityFias(form.fromCity) }; } else if (form.fromLavsiteWarehouse) { return { type: 'address' as const, address: form.fromAddress || '–¥–µ—Ä–µ–≤–Ω—è –û—Å–µ–µ–≤–æ, 202, –≥–æ—Ä–æ–¥—Å–∫–æ–π –æ–∫—Ä—É–≥ –õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π, –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å' }; } else { return { type: 'address' as const, address: form.fromAddress || form.fromCity }; } } catch (error) { console.error(üöõ Nordwheel: –û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è:, error); throw error; // –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –≤—ã—à–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ calculateNordWheel } }; 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ calculateNordWheel –î–æ–±–∞–≤–ª–µ–Ω–∏–µ: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –æ—Ç —Ñ—É–Ω–∫—Ü–∏–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–π.\n\ntry { const requestData = { dispatch: { location: await getDispatchLocation() }, destination: { location: await getDestinationLocation() }, cargo: { total_weight: totalWeight, total_volume: totalVolume, total_quantity: 1 }, insurance: form.needInsurance && form.declaredValue ? form.declaredValue : null, insurance_refuse: !form.needInsurance, services: { is_package: form.needPackaging, is_documents_return: false, is_fragile: false }, promocode: null };\n\n// ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ } catch (locationError) { console.error('üöõ Nordwheel: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–π:', locationError); return { company: 'Nord Wheel', price: 0, days: 0, error: –û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞–¥—Ä–µ—Å–æ–≤: ${locationError.message}, apiUrl }; } –ò—Ç–æ–≥–æ–≤—ã–π –ø–ª–∞–Ω –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Ç–æ–ª—å–∫–æ –¥–ª—è Nordwheel) –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è: app/page.tsx (—Ñ—É–Ω–∫—Ü–∏—è calculateNordWheel) –î–æ–±–∞–≤–ª—è–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: getNordwheelCityFias() - –ª–æ–∫–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è FIAS —á–µ—Ä–µ–∑ Dadata –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ getDispatchLocation() - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ getDestinationLocation() - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è: –°–∫–ª–∞–¥ –õ–∞–≤—Å–∏—Ç ‚Üí type: 'address' –≤–º–µ—Å—Ç–æ type: 'terminal' Dadata –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö FIAS –∫–æ–¥–æ–≤ Fallback –ª–æ–≥–∏–∫–∞ ‚Üí –≥–æ—Ä–æ–¥ –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Dadata –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ ‚Üí –≤—ã–≤–æ–¥ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ FIAS –∫–æ–¥–∞ –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è:\n\n–¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞: type: 'terminal' + FIAS –∫–æ–¥ –ê–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞: type: 'address' + –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å –°–∫–ª–∞–¥ –õ–∞–≤—Å–∏—Ç: type: 'address' + –∞–¥—Ä–µ—Å —Å–∫–ª–∞–¥–∞ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Dadata –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:\n\n–£—Å–ø–µ—à–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ FIAS –∫–æ–¥–∞ Fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è FIAS –∫–æ–¥–∞ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –¥—Ä—É–≥–∏–º–∏ –¢–ö:\n\n–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç –¥—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞—Å—á–µ—Ç–∞"
}