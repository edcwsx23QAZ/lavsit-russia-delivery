{
  "id": "prt_ab882d169001JUjUwTLFrGXzfg",
  "sessionID": "ses_54b97e247ffenCZZa4jZiIWD0l",
  "messageID": "msg_ab882af7c001HWJfNp757Fgzdb",
  "type": "tool",
  "callID": "call_6ba0a846408b4a3d862487e7",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx",
      "limit": 200,
      "offset": 3547
    },
    "output": "<file>\n03548|     const apiUrl = 'https://api.nordw.orog.ru/api/v1/calculate';\n03549| \n03550|     try {\n03551|       // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03552|       validateMultipleCargos(form.cargos);\n03553|       \n03554|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n03555|       const totalVolume = form.cargos.reduce((sum, cargo) => \n03556|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n03557|       );\n03558| \n03559|       // üîß –î–û–ë–ê–í–õ–ï–ù–û: –†–∞—Å—á–µ—Ç –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03560|       const maxLength = Math.max(...form.cargos.map(c => c.length));\n03561|       const maxWidth = Math.max(...form.cargos.map(c => c.width));\n03562|       const maxHeight = Math.max(...form.cargos.map(c => c.height));\n03563|       \n03564|       // üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03565|       console.log('üåê Nord Wheel: –ê–Ω–∞–ª–∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç:');\n03566|       console.log(`   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç: ${form.cargos.length}`);\n03567|       console.log(`   - –û–±—â–∏–π –≤–µ—Å: ${totalWeight} –∫–≥`);\n03568|       console.log(`   - –û–±—â–∏–π –æ–±—ä–µ–º: ${totalVolume.toFixed(3)} –º¬≥`);\n03569|       console.log(`   - –û—Ç–∫—É–¥–∞: ${form.fromCity} (${form.fromTerminal ? '—Ç–µ—Ä–º–∏–Ω–∞–ª' : '–∞–¥—Ä–µ—Å'})`);\n03570|       console.log(`   - –ö—É–¥–∞: ${form.toCity} (${form.toTerminal ? '—Ç–µ—Ä–º–∏–Ω–∞–ª' : '–∞–¥—Ä–µ—Å'})`);\n03571|       \n03572|       form.cargos.forEach((cargo, index) => {\n03573|         console.log(`   üì¶ –ú–µ—Å—Ç–æ ${index + 1}:`);\n03574|         console.log(`     - –ì–∞–±–∞—Ä–∏—Ç—ã: ${cargo.length}√ó${cargo.width}√ó${cargo.height} —Å–º`);\n03575|         console.log(`     - –í–µ—Å: ${cargo.weight} –∫–≥`);\n03576|         console.log(`     - –û–±—ä–µ–º: ${((cargo.length * cargo.width * cargo.height) / 1000000).toFixed(3)} –º¬≥`);\n03577|       });\n03578| \n03579|       if (form.cargos.length > 1) {\n03580|         console.log(`   üìê –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã: ${maxLength}√ó${maxWidth}√ó${maxHeight} —Å–º`);\n03581|       }\n03582| \n03583|       // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è FIAS –∫–æ–¥–∞ –≥–æ—Ä–æ–¥–∞\n03584|       const getCityFias = (cityName: string): string => {\n03585|         const cityFiasMap: Record<string, string> = {\n03586|           '–º–æ—Å–∫–≤–∞': '0c5b2444-70a0-4932-980c-b4dc0d3f02b5',\n03587|           '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': 'c2deb16a-0330-4f05-821f-1d09c93331e6',\n03588|           '—Å–ø–±': 'c2deb16a-0330-4f05-821f-1d09c93331e6',\n03589|           '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': '2763c110-cb8b-416a-9dac-ad28a55b4402',\n03590|           '–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫': '8dea00e3-9aab-4d8e-887c-ef2aaa546456',\n03591|           '–∫–∞–∑–∞–Ω—å': '93b3df57-4c89-44df-ac42-96f05e9cd3b9',\n03592|           '–Ω–∏–∂–Ω–∏–π –Ω–æ–≤–≥–æ—Ä–æ–¥': '555e7d61-d9a7-4ba6-9770-6caa8198c483',\n03593|           '—á–µ–ª—è–±–∏–Ω—Å–∫': 'a376e68d-724a-4472-be7c-891bdb09ae32',\n03594|           '–æ–º—Å–∫': 'bb035cc3-1dc2-4627-9d25-a1bf5fed073d',\n03595|           '—Ä–æ—Å—Ç–æ–≤-–Ω–∞-–¥–æ–Ω—É': 'c1cfe4b9-f7c2-423c-abfa-6ed5cb24d83e',\n03596|           '—É—Ñ–∞': '7339e834-2cb4-473c-9c6e-93f3dcd66011',\n03597|           '–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫': '9b968c73-f4d4-4012-8da8-3dacd4d4c1bd',\n03598|           '–ø–µ—Ä–º—å': '4dc222e8-1f6a-4c36-894b-2b4a8c8a9b08',\n03599|           '–≤–æ—Ä–æ–Ω–µ–∂': '5bf5ddff-6353-4a3d-80c4-6fb27f00c6c1',\n03600|           '–≤–æ–ª–≥–æ–≥—Ä–∞–¥': 'da051ec8-da2e-4a66-b542-473b8d221ab6'\n03601|         };\n03602| \n03603|         const normalizedCity = cityName.toLowerCase().trim()\n03604|           .replace(/^–≥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥ \"\n03605|           .replace(/^–≥–æ—Ä–æ–¥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥–æ—Ä–æ–¥ \"\n03606|           .replace(/\\s+/g, ' '); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—Ä–æ–±–µ–ª—ã\n03607| \n03608|         return cityFiasMap[normalizedCity] || '0c5b2444-70a0-4932-980c-b4dc0d3f02b5'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ú–æ—Å–∫–≤–∞\n03609|       };\n03610|       // üèôÔ∏è –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ª–æ–∫–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–æ—Ä–º—ã\n03611|       const getDispatchLocation = () => {\n03612|         if (form.fromTerminal) {\n03613|           return {\n03614|             type: 'terminal' as const,\n03615|             // –î–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π FIAS –∫–æ–¥ –≥–æ—Ä–æ–¥–∞\n03616|             city_fias: getCityFias(form.fromCity)\n03617|           };\n03618|         } else {\n03619|           return {\n03620|             type: 'address' as const,\n03621|             address: form.fromAddress || form.fromCity // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥—Ä–µ—Å –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –≥–æ—Ä–æ–¥\n03622|           };\n03623|         }\n03624|       };\n03625| \n03626|       const getDestinationLocation = () => {\n03627|         if (form.toTerminal) {\n03628|           return {\n03629|             type: 'terminal' as const,\n03630|             // –î–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π FIAS –∫–æ–¥ –≥–æ—Ä–æ–¥–∞\n03631|             city_fias: getCityFias(form.toCity)\n03632|           };\n03633|         } else {\n03634|           return {\n03635|             type: 'address' as const,\n03636|             address: form.toAddress || form.toCity // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥—Ä–µ—Å –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –≥–æ—Ä–æ–¥\n03637|           };\n03638|         }\n03639|       };\n03640| \n03641|       // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è –Ω–æ–≤–æ–≥–æ API NordWheel —Å —É—á–µ—Ç–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–æ—Ä–º—ã\n03642|       const requestData = {\n03643|         dispatch: {\n03644|           location: getDispatchLocation()\n03645|         },\n03646|         destination: {\n03647|           location: getDestinationLocation()\n03648|         },\n03649|         cargo: {\n03650|           total_weight: totalWeight,\n03651|           total_volume: totalVolume,\n03652|           total_quantity: form.cargos.length\n03653|         },\n03654|         insurance: form.needInsurance && form.declaredValue ? form.declaredValue : 0,\n03655|         insurance_refuse: !form.needInsurance,\n03656|         services: {\n03657|           is_package: form.needPackaging,\n03658|           is_documents_return: false,\n03659|           is_fragile: false\n03660|         },\n03661|         promocode: null\n03662|       };\n03663| \n03664|       console.log('üöõ Nord Wheel –Ω–æ–≤—ã–π API –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03665| \n03666|       const response = await fetch(apiUrl, {\n03667|         method: 'POST',\n03668|         headers: {\n03669|           'Content-Type': 'application/json',\n03670|           'Authorization': `Bearer ${process.env.NORDWHEEL_API_KEY || '5|WYpV9f788Y2ASobpv3xy6N5qxtIUaKhxFF4yWETOfc398950'}`\n03671|         },\n03672|         body: JSON.stringify(requestData)\n03673|       });\n03674| \n03675|       if (!response.ok) {\n03676|         console.error('‚ùå Nord Wheel API –æ—à–∏–±–∫–∞:', response.status, response.statusText);\n03677|         const errorDetails = response.status === 401 ? '–ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á' :\n03678|                             response.status === 400 ? '–ù–µ–≤–µ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å' :\n03679|                             response.status === 404 ? '–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω' :\n03680|                             response.status === 500 ? '–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' :\n03681|                             `–û—à–∏–±–∫–∞ API: ${response.status} ${response.statusText}`;\n03682|         \n03683|         return {\n03684|           company: 'Nord Wheel',\n03685|           price: 0,\n03686|           days: 0,\n03687|           error: errorDetails,\n03688|           apiUrl,\n03689|           requestData\n03690|         };\n03691|       }\n03692| \n03693|       const data = await response.json();\n03694|       console.log('üöõ Nord Wheel API –æ—Ç–≤–µ—Ç:', data);\n03695| \n03696|        // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ API - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã\n03697|        let price = 0;\n03698|        let days = 0;\n03699|        let details: any = {};\n03700| \n03701|        if (data.success) {\n03702|          // –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç API —Å auto/avia –æ–±—ä–µ–∫—Ç–∞–º–∏\n03703|          if (data.auto || data.avia) {\n03704|            const options: Array<{type: string, price: number, days: number, services: any[]}> = [];\n03705|            \n03706|            if (data.auto) {\n03707|              options.push({\n03708|                type: 'auto',\n03709|                price: data.auto.total_price || 0,\n03710|                days: data.auto.delivery_date || 0,\n03711|                services: data.auto.services || []\n03712|              });\n03713|            }\n03714|            \n03715|            if (data.avia) {\n03716|              options.push({\n03717|                type: 'avia',\n03718|                price: data.avia.total_price || 0,\n03719|                days: data.avia.delivery_date || 0,\n03720|                services: data.avia.services || []\n03721|              });\n03722|            }\n03723|            \n03724|            // –í—ã–±–∏—Ä–∞–µ–º —Å–∞–º—ã–π –¥–µ—à–µ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç\n03725|            const bestOption = options.reduce((best, current) => \n03726|              current.price < best.price ? current : best\n03727|            );\n03728|            \n03729|            price = bestOption.price;\n03730|            days = bestOption.days;\n03731|            details = {\n03732|              totalCost: price,\n03733|              deliveryCost: price, // –í –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ\n03734|              transportType: bestOption.type,\n03735|              services: bestOption.services,\n03736|              allOptions: options, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n03737|              currency: 'RUB'\n03738|            };\n03739|          } else {\n03740|            // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞\n03741|            price = data.price || data.total_cost || data.cost || 0;\n03742|            days = data.days || data.delivery_days || data.delivery_time || 0;\n03743|            details = {\n03744|              totalCost: price,\n03745|              deliveryCost: data.delivery_cost || 0,\n03746|              pickupCost: data.pickup_cost || 0,\n03747|              insuranceCost: data.insurance_cost || 0,\n\n(File has more lines. Use 'offset' parameter to read beyond line 3747)\n</file>",
    "title": "app/page.tsx",
    "metadata": {
      "preview": "    const apiUrl = 'https://api.nordw.orog.ru/api/v1/calculate';\n\n    try {\n      // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      validateMultipleCargos(form.cargos);\n      \n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n      const totalVolume = form.cargos.reduce((sum, cargo) => \n        sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n      );\n\n      // üîß –î–û–ë–ê–í–õ–ï–ù–û: –†–∞—Å—á–µ—Ç –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      const maxLength = Math.max(...form.cargos.map(c => c.length));\n      const maxWidth = Math.max(...form.cargos.map(c => c.width));\n      const maxHeight = Math.max(...form.cargos.map(c => c.height));\n      \n      // üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      console.log('üåê Nord Wheel: –ê–Ω–∞–ª–∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç:');\n      console.log(`   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç: ${form.cargos.length}`);\n      console.log(`   - –û–±—â–∏–π –≤–µ—Å: ${totalWeight} –∫–≥`);"
    },
    "time": {
      "start": 1764032172396,
      "end": 1764032172403
    }
  }
}