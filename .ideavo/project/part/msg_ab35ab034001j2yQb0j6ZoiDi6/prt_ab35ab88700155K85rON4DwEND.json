{
  "id": "prt_ab35ab88700155K85rON4DwEND",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "messageID": "msg_ab35ab034001j2yQb0j6ZoiDi6",
  "type": "tool",
  "callID": "call_28593103",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "app/page.tsx",
      "offset": 2000
    },
    "output": "<file>\n02001|             data.data.packages.forEach((pkg: any, index: number) => {\n02002|               console.log(`üí∞ Package [${index}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n02003|             });\n02004|           } else {\n02005|             Object.entries(data.data.packages).forEach(([key, pkg]: [string, any]) => {\n02006|               console.log(`üí∞ Package [${key}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n02007|             });\n02008|           }\n02009|         } else {\n02010|           console.log('üí∞ ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∞—Å—å');\n02011|         }\n02012| \n02013|         // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–∞–∫ —Ä–∞–∑–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –¥–∞—Ç–∞–º–∏ pickup –∏ arrivalToOspReceiver\n02014|         let deliveryDays = 0;\n02015|         try {\n02016|           console.log('=== –ü–û–ò–°–ö –î–ê–¢ –í –û–¢–í–ï–¢–ï ===');\n02017|           \n02018|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–µ—Å—Ç–∞ –≥–¥–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–∞—Ç—ã\n02019|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.pickup:', data.data?.pickup);\n02020|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.pickup:', data.pickup);\n02021|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.pickup:', data?.pickup);\n02022|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.arrivalToOspReceiver:', data.data?.arrivalToOspReceiver);\n02023|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.arrivalToOspReceiver:', data.arrivalToOspReceiver);\n02024|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.arrivalToOspReceiver:', data?.arrivalToOspReceiver);\n02025|           \n02026|           // –ë–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–π –ø–æ–∏—Å–∫ –≤–æ –≤—Å–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ data\n02027|           const findDateInObject = (obj: any, fieldName: string): string | null => {\n02028|             if (!obj || typeof obj !== 'object') return null;\n02029|             \n02030|             for (const [key, value] of Object.entries(obj)) {\n02031|               if (key === fieldName && typeof value === 'string') {\n02032|                 return value;\n02033|               }\n02034|               if (typeof value === 'object' && value !== null) {\n02035|                 const found = findDateInObject(value, fieldName);\n02036|                 if (found) return found;\n02037|               }\n02038|             }\n02039|             return null;\n02040|           };\n02041|           \n02042|           const pickup = findDateInObject(data, 'pickup');\n02043|           const arrivalToOspReceiver = findDateInObject(data, 'arrivalToOspReceiver');\n02044|           \n02045|           console.log('–ù–ê–ô–î–ï–ù–ù–´–ï –î–ê–¢–´:');\n02046|           console.log('pickup:', pickup);\n02047|           console.log('arrivalToOspReceiver:', arrivalToOspReceiver);\n02048|           \n02049|           if (pickup && arrivalToOspReceiver) {\n02050|             // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—ã (—Ñ–æ—Ä–º–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å \"2025-09-27\" –∏–ª–∏ \"2025-09-27 10:00:00\")\n02051|             const pickupDate = new Date(pickup);\n02052|             const arrivalDate = new Date(arrivalToOspReceiver);\n02053|             \n02054|             console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ pickup:', pickupDate);\n02055|             console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ arrival:', arrivalDate);\n02056|             \n02057|             // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã\n02058|             if (!isNaN(pickupDate.getTime()) && !isNaN(arrivalDate.getTime())) {\n02059|               // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–æ—Å—Ç—å –≤ –¥–Ω—è—Ö\n02060|               const timeDiff = arrivalDate.getTime() - pickupDate.getTime();\n02061|               deliveryDays = Math.max(1, Math.ceil(timeDiff / (1000 * 3600 * 24))); // –ú–∏–Ω–∏–º—É–º 1 –¥–µ–Ω—å\n02062|               \n02063|               console.log('–†–∞–∑–Ω–æ—Å—Ç—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö:', timeDiff);\n02064|               console.log('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –í–´–ß–ò–°–õ–ï–ù —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:', deliveryDays, '–¥–Ω–µ–π');\n02065|             } else {\n02066|               console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞—Ç—ã –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞');\n02067|               console.error('pickup Date object:', pickupDate);\n02068|               console.error('arrival Date object:', arrivalDate);\n02069|             }\n02070|           } else {\n02071|             console.warn('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ –Ω–∞–π–¥–µ–Ω—ã –¥–∞—Ç—ã pickup –∏–ª–∏ arrivalToOspReceiver');\n02072|             console.log('pickup –Ω–∞–π–¥–µ–Ω:', !!pickup, pickup);\n02073|             console.log('arrivalToOspReceiver –Ω–∞–π–¥–µ–Ω:', !!arrivalToOspReceiver, arrivalToOspReceiver);\n02074|           }\n02075|         } catch (error) {\n02076|           console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –û—à–∏–±–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:', error);\n02077|         }\n02078| \n02079|         console.log('üí∞ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ò–¢–û–ì–û–í–ê–Ø –°–¢–û–ò–ú–û–°–¢–¨:', Math.round(totalPrice));\n02080|         \n02081|         return {\n02082|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n02083|           price: Math.round(totalPrice),\n02084|           days: deliveryDays || 0,\n02085|           details: data.data || {},\n02086|           requestData,\n02087|           responseData: data,\n02088|           apiUrl,\n02089|           sessionId: sessionID\n02090|         };\n02091|       } else {\n02092|         const errorMessage = data.metadata?.detail || \n02093|                            data.metadata?.message || \n02094|                            data.errors?.[0]?.detail || \n02095|                            (data.metadata?.status !== 200 ? `HTTP ${data.metadata?.status}` : '') ||\n02096|                            '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏';\n02097|         return {\n02098|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n02099|           price: 0,\n02100|           days: 0,\n02101|           error: errorMessage,\n02102|           requestData,\n02103|           responseData: data,\n02104|           apiUrl,\n02105|           sessionId: sessionID\n02106|         };\n02107|       }\n02108|     } catch (error: any) {\n02109|       return {\n02110|         company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n02111|         price: 0,\n02112|         days: 0,\n02113|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n02114|         requestData: null,\n02115|         responseData: null,\n02116|         apiUrl\n02117|       };\n02118|     }\n02119|   };\n02120| \n02121| \n02122| \n02123|   // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–Ω–æ–π –∑–æ–Ω—ã –∏ —Å–∫–ª–∞–¥–∞ –ü–≠–ö –ø–æ –∞–¥—Ä–µ—Å—É —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏\n02124|   const getPekZoneByAddress = async (address: string) => {\n02125|     try {\n02126|       console.log(`üîç –ü–≠–ö: –ø–æ–∏—Å–∫ –∑–æ–Ω—ã –¥–ª—è –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n02127| \n02128|       const result = await enhancedApiRequest(\n02129|         '/api/pek',\n02130|         {\n02131|           method: 'POST',\n02132|           headers: {\n02133|             'Content-Type': 'application/json',\n02134|           },\n02135|           body: JSON.stringify({\n02136|             method: 'findzonebyaddress',\n02137|             address: address\n02138|           })\n02139|         },\n02140|         { operation: 'findzonebyaddress', company: '–ü–≠–ö' }\n02141|       );\n02142| \n02143|       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n02144|         console.error(`‚ùå –ü–≠–ö API –æ—à–∏–±–∫–∞:`, result.error);\n02145|         console.log(`üîÑ –ü–≠–ö: –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥—É –¥–ª—è \"${address}\"`);\n02146|         return getPekZoneFallback(address);\n02147|       }\n02148| \n02149|       const response = result as Response;\n02150|       console.log(`üì° –ü–≠–ö API —Å—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`);\n02151| \n02152|       if (!response.ok) {\n02153|         let errorData;\n02154|         try {\n02155|           errorData = await response.json();\n02156|         } catch {\n02157|           errorData = { error: '–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç' };\n02158|         }\n02159| \n02160|         console.error(`‚ùå –ü–≠–ö API –æ—à–∏–±–∫–∞ ${response.status}:`, errorData);\n02161| \n02162|         // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫\n02163|         if (response.status === 401) {\n02164|           console.error('‚ùå –ü–≠–ö: –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω');\n02165|         } else if (response.status === 404) {\n02166|           console.error('‚ùå –ü–≠–ö: –ú–µ—Ç–æ–¥ API –Ω–µ –Ω–∞–π–¥–µ–Ω');\n02167|         } else if (response.status === 400) {\n02168|           console.error('‚ùå –ü–≠–ö: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞');\n02169|         } else if (response.status >= 500) {\n02170|           console.error('‚ùå –ü–≠–ö: –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ü–≠–ö');\n02171|         }\n02172| \n02173|         console.log(`üîÑ –ü–≠–ö: –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥—É –¥–ª—è \"${address}\"`);\n02174|         return getPekZoneFallback(address);\n02175|       }\n02176| \n02177|       const data = await response.json();\n02178|       console.log(`‚úÖ –ü–≠–ö –∑–æ–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞:`, data);\n02179| \n02180|       if (data.zoneId && data.mainWarehouseId) {\n02181|         return {\n02182|           zoneId: data.zoneId,\n02183|           zoneName: data.zoneName,\n02184|           branchUID: data.branchUID,\n02185|           branchCode: data.branchCode,\n02186|           branchTitle: data.branchTitle,\n02187|           mainWarehouseId: data.mainWarehouseId,\n02188|           warehousePoint: data.warehousePoint,\n02189|           geoData: data.GeoData,\n02190|           precision: data.GeoData?.precision\n02191|         };\n02192|       }\n02193| \n02194|       console.warn(`‚ö†Ô∏è –ü–≠–ö: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç:`, data);\n02195|       return getPekZoneFallback(address);\n02196| \n02197|     } catch (error) {\n02198|       console.error('‚ùå –ü–≠–ö: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∑–æ–Ω—ã:', error);\n02199|       return getPekZoneFallback(address);\n02200|     }\n02201|   };\n02202| \n02203|   // –§–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–æ–Ω—ã –ü–≠–ö\n02204|   const getPekZoneFallback = (address: string) => {\n02205|     console.log(`üîÑ –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –∞–Ω–∞–ª–∏–∑ –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n02206|     \n02207|     const addressLower = address.toLowerCase();\n02208|     \n02209|     // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –∏ –∏—Ö –¥–∞–Ω–Ω—ã–µ\n02210|     const cityMappings: { [key: string]: any } = {\n02211|       '–º–æ—Å–∫–≤–∞': {\n02212|         zoneId: 'moscow-zone-001',\n02213|         zoneName: '–ú–æ—Å–∫–≤–∞',\n02214|         branchUID: 'moscow-branch-001',\n02215|         branchCode: '–ú–°–ö',\n02216|         branchTitle: '–ú–æ—Å–∫–≤–∞',\n02217|         mainWarehouseId: 'dc6c746d-812d-11e4-bbfc-001999d8b3c5',\n02218|         warehousePoint: {\n02219|           latitude: 55.755826,\n02220|           longitude: 37.6173\n02221|         }\n02222|       },\n02223|       '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': {\n02224|         zoneId: 'spb-zone-001',\n02225|         zoneName: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n02226|         branchUID: 'spb-branch-001',\n02227|         branchCode: '–°–ü–ë',\n02228|         branchTitle: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n02229|         mainWarehouseId: 'b436c978-086d-11e6-b6ca-00155d668909',\n02230|         warehousePoint: {\n02231|           latitude: 59.9311,\n02232|           longitude: 30.3609\n02233|         }\n02234|       },\n02235|       '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': {\n02236|         zoneId: 'ekb-zone-001',\n02237|         zoneName: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',\n02238|         branchUID: 'ekb-branch-001',\n02239|         branchCode: '–ï–ö–ë',\n02240|         branchTitle: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',\n02241|         mainWarehouseId: 'f8d9c8e3-8e2d-11e4-bbfc-001999d8b3c5',\n02242|         warehousePoint: {\n02243|           latitude: 56.8431,\n02244|           longitude: 60.6454\n02245|         }\n02246|       }\n02247|     };\n02248|     \n02249|     for (const [city, data] of Object.entries(cityMappings)) {\n02250|       if (addressLower.includes(city) || addressLower.includes(city.replace('-', ' '))) {\n02251|         console.log(`‚úÖ –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –Ω–∞–π–¥–µ–Ω –≥–æ—Ä–æ–¥ ${city}`);\n02252|         return {\n02253|           ...data,\n02254|           geoData: {\n02255|             precision: 'fallback',\n02256|             kind: 'locality'\n02257|           },\n02258|           precision: 'fallback'\n02259|         };\n02260|       }\n02261|     }\n02262|     \n02263|     console.warn(`‚ùå –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –≥–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ \"${address}\"`);\n02264|     return null;\n02265|   };\n02266| \n02267|   // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –ü–≠–ö\n02268|   const getPekNearestDepartments = async (address: string, coordinates?: { latitude: string, longitude: string }) => {\n02269|     try {\n02270|       console.log(`üè¢ –ü–≠–ö: –ø–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –¥–ª—è \"${address}\"`);\n02271| \n02272|       const requestBody: any = {\n02273|         departmentOperation: 3, // –≤—ã–¥–∞—á–∞ –≥—Ä—É–∑–æ–≤\n02274|         type: 3, // –∞–≤—Ç–æ-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç\n02275|         searchRadius: 50, // –∫–º\n02276|         limit: 5\n02277|       };\n02278| \n02279|       // –ü–≠–ö API —Ç—Ä–µ–±—É–µ—Ç –∏ –∞–¥—Ä–µ—Å, –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ\n02280|       requestBody.address = address;\n02281| \n02282|       if (coordinates) {\n02283|         requestBody.coordinates = coordinates;\n02284|         console.log(`üìç –ü–≠–ö: –ø–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\" –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º`, coordinates);\n02285|       } else {\n02286|         console.log(`üìç –ü–≠–ö: –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\"`);\n02287|       }\n02288| \n02289|       const result = await enhancedApiRequest(\n02290|         '/api/pek',\n02291|         {\n02292|           method: 'POST',\n02293|           headers: {\n02294|             'Content-Type': 'application/json',\n02295|           },\n02296|           body: JSON.stringify({\n02297|             method: 'nearestdepartments',\n02298|             ...requestBody\n02299|           })\n02300|         },\n02301|         { operation: 'nearestdepartments', company: '–ü–≠–ö' }\n02302|       );\n02303| \n02304|       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n02305|         console.error(`‚ùå –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API –æ—à–∏–±–∫–∞:`, result.error);\n02306|         return null;\n02307|       }\n02308| \n02309|       const response = result as Response;\n02310|       console.log(`üì° –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API —Å—Ç–∞—Ç—É—Å: ${response.status}`);\n02311| \n02312|       if (!response.ok) {\n02313|         const errorText = await response.text();\n02314|         console.error(`‚ùå –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API –æ—à–∏–±–∫–∞: ${response.status} ${response.statusText}`);\n02315|         console.error(`‚ùå –û—Ç–≤–µ—Ç:`, errorText.substring(0, 500));\n02316|         return null;\n02317|       }\n02318| \n02319|       const data = await response.json();\n02320|       console.log(`‚úÖ –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–∞–π–¥–µ–Ω—ã:`, data);\n02321| \n02322|       // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤–æ–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ —Å –Ω–∞–∏–≤—ã—Å—à–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º\n02323|       if (data.freeDepartments && data.freeDepartments.length > 0) {\n02324|         const bestDepartment = data.freeDepartments.sort((a: any, b: any) => b.priority - a.priority)[0];\n02325|         console.log(`‚úÖ –ü–≠–ö: –≤—ã–±—Ä–∞–Ω–æ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ`, bestDepartment.divisionName);\n02326|         return {\n02327|           warehouseId: bestDepartment.warehouseId,\n02328|           branchId: bestDepartment.branchId,\n02329|           branchName: bestDepartment.branchName,\n02330|           divisionName: bestDepartment.divisionName,\n02331|           address: bestDepartment.address,\n02332|           coordinates: bestDepartment.coordinates,\n02333|           phone: bestDepartment.phone,\n02334|           email: bestDepartment.email\n02335|         };\n02336|       }\n02337| \n02338|       console.warn(`‚ùå –ü–≠–ö: –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è \"${address}\"`);\n02339|       return null;\n02340|     } catch (error) {\n02341|       console.error('‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –æ—Ç–¥–µ–ª–µ–Ω–∏–π:', error);\n02342|       return null;\n02343|     }\n02344|   };\n02345| \n02346|   // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ü–≠–ö)\n02347|   const getYandexCoordinates = async (address: string): Promise<{ latitude: string, longitude: string } | null> => {\n02348|     try {\n02349|       const encodedAddress = encodeURIComponent(address);\n02350|       const response = await fetch(`https://geocode-maps.yandex.ru/1.x/?apikey=YOUR_API_KEY&geocode=${encodedAddress}&format=json`);\n02351|       \n02352|       if (!response.ok) return null;\n02353|       \n02354|       const data = await response.json();\n02355|       const coords = data?.response?.GeoObjectCollection?.featureMember?.[0]?.GeoObject?.Point?.pos?.split(' ');\n02356|       \n02357|       if (coords && coords.length === 2) {\n02358|         return {\n02359|           longitude: coords[0],\n02360|           latitude: coords[1]\n02361|         };\n02362|       }\n02363|       \n02364|       return null;\n02365|     } catch (error) {\n02366|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ø–Ω–¥–µ–∫—Å:', error);\n02367|       return null;\n02368|     }\n02369|   };\n02370| \n02371|   // –†–∞—Å—á–µ—Ç –¥–ª—è –ü–≠–ö —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API v1/calculateprice/\n02372|   const calculatePEK = async (): Promise<CalculationResult> => {\n02373|     const apiUrl = 'https://kabinet.pecom.ru/api/v1/calculateprice/';\n02374|     \n02375|     // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç\n02376|     const validateCoordinates = (coords: any) => {\n02377|       console.log('üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:', coords);\n02378|       \n02379|       if (!coords) {\n02380|         console.log('‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç');\n02381|         return null;\n02382|       }\n02383|       \n02384|       if (typeof coords.latitude !== 'number' || typeof coords.longitude !== 'number') {\n02385|         console.warn(`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ —è–≤–ª—è—é—Ç—Å—è —á–∏—Å–ª–∞–º–∏:`, { \n02386|           lat: coords.latitude, \n02387|           lng: coords.longitude,\n02388|           latType: typeof coords.latitude,\n02389|           lngType: typeof coords.longitude\n02390|         });\n02391|         return null;\n02392|       }\n02393|       \n02394|       const lat = Number(coords.latitude);\n02395|       const lng = Number(coords.longitude);\n02396|       \n02397|       console.log(`üìç –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: lat=${lat}, lng=${lng}`);\n02398|       \n02399|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω—ã\n02400|       if (lat < -90 || lat > 90 || lng < -180 || lng > 180 || isNaN(lat) || isNaN(lng)) {\n02401|         console.warn(`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–Ω–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞:`, { \n02402|           lat, lng, \n02403|           latValid: lat >= -90 && lat <= 90,\n02404|           lngValid: lng >= -180 && lng <= 180,\n02405|           latIsNaN: isNaN(lat),\n02406|           lngIsNaN: isNaN(lng)\n02407|         });\n02408|         return null;\n02409|       }\n02410|       \n02411|       console.log('‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã:', { latitude: lat, longitude: lng });\n02412|       return { latitude: lat, longitude: lng };\n02413|     };\n02414|     \n02415|     try {\n02416|       // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–æ–Ω–∞—Ö –∏ —Å–∫–ª–∞–¥–∞—Ö –ø–æ –∞–¥—Ä–µ—Å–∞–º\n02417|       console.log(`üöÄ –ü–≠–ö: –Ω–∞—á–∏–Ω–∞–µ–º —Ä–∞—Å—á–µ—Ç`);\n02418|       console.log(`üìç –û—Ç: ${form.fromAddress || form.fromCity}`);\n02419|       console.log(`üìç –î–æ: ${form.toAddress || form.toCity}`);\n02420|       \n02421|       const senderZone = await getPekZoneByAddress(form.fromAddress || `–≥ ${form.fromCity}`);\n02422|       const receiverZone = await getPekZoneByAddress(form.toAddress || `–≥ ${form.toCity}`);\n02423|       \n02424|       console.log(`üîç –ü–≠–ö –∑–æ–Ω—ã:`);\n02425|       console.log(`üìç –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å:`, senderZone ? `${senderZone.branchTitle} (${senderZone.mainWarehouseId})` : '–ù–ï –ù–ê–ô–î–ï–ù–ê');\n02426|       console.log(`üìç –ü–æ–ª—É—á–∞—Ç–µ–ª—å:`, receiverZone ? `${receiverZone.branchTitle} (${receiverZone.mainWarehouseId})` : '–ù–ï –ù–ê–ô–î–ï–ù–ê');\n02427|       \n02428|       if (!senderZone || !receiverZone) {\n02429|         // –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞\n02430|         const debugInfo = {\n02431|           senderAddress: form.fromAddress || form.fromCity,\n02432|           receiverAddress: form.toAddress || form.toCity,\n02433|           senderZoneFound: !!senderZone,\n02434|           receiverZoneFound: !!receiverZone,\n02435|           apiTested: true\n02436|         };\n02437|         \n02438|         console.error(`‚ùå –ü–≠–ö: –∑–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã`, debugInfo);\n02439|         \n02440|         return {\n02441|           company: '–ü–≠–ö',\n02442|           price: 0,\n02443|           days: 0,\n02444|           error: `–ó–æ–Ω–∞ –ü–≠–ö –Ω–µ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥—Ä–µ—Å–∞: ${!senderZone ? (form.fromAddress || form.fromCity) : ''} ${!receiverZone ? (form.toAddress || form.toCity) : ''}`.trim(),\n02445|           apiUrl,\n02446|           requestData: debugInfo,\n02447|           responseData: { senderZone, receiverZone }\n02448|         };\n02449|       }\n02450| \n02451|       // –ü–æ–ª—É—á–∞–µ–º –±–ª–∏–∂–∞–π—à–∏–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –∞–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞\n02452|       let senderWarehouseId = senderZone.mainWarehouseId;\n02453|       let receiverWarehouseId = receiverZone.mainWarehouseId;\n02454|       \n02455|       if (form.fromAddressDelivery && senderZone.warehousePoint) {\n02456|         const validSenderCoords = validateCoordinates(senderZone.warehousePoint);\n02457|         if (validSenderCoords) {\n02458|           try {\n02459|             const senderDepartment = await getPekNearestDepartments(\n02460|               form.fromAddress || form.fromCity,\n02461|               {\n02462|                 latitude: validSenderCoords.latitude.toString(),\n02463|                 longitude: validSenderCoords.longitude.toString()\n02464|               }\n02465|             );\n02466|             if (senderDepartment) {\n02467|               senderWarehouseId = senderDepartment.warehouseId;\n02468|               console.log('‚úÖ –ù–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π —Å–∫–ª–∞–¥ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è:', senderDepartment.warehouseId);\n02469|             }\n02470|           } catch (error) {\n02471|             console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥:', error);\n02472|           }\n02473|         } else {\n02474|           console.warn('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥');\n02475|         }\n02476|       }\n02477|       \n02478|       if (form.toAddressDelivery && receiverZone.warehousePoint) {\n02479|         const validReceiverCoords = validateCoordinates(receiverZone.warehousePoint);\n02480|         if (validReceiverCoords) {\n02481|           try {\n02482|             const receiverDepartment = await getPekNearestDepartments(\n02483|               form.toAddress || form.toCity,\n02484|               {\n02485|                 latitude: validReceiverCoords.latitude.toString(),\n02486|                 longitude: validReceiverCoords.longitude.toString()\n02487|               }\n02488|             );\n02489|             if (receiverDepartment) {\n02490|               receiverWarehouseId = receiverDepartment.warehouseId;\n02491|               console.log('‚úÖ –ù–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π —Å–∫–ª–∞–¥ –ø–æ–ª—É—á–∞—Ç–µ–ª—è:', receiverDepartment.warehouseId);\n02492|             }\n02493|           } catch (error) {\n02494|             console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥:', error);\n02495|           }\n02496|         } else {\n02497|           console.warn('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥');\n02498|         }\n02499|       }\n02500| \n02501|       // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞—Ç—ã N –¥–Ω–µ–π –æ—Ç —Å–µ–≥–æ–¥–Ω—è\n02502|       const getDateForCalculation = (daysFromToday: number): string => {\n02503|         const date = new Date();\n02504|         date.setDate(date.getDate() + daysFromToday);\n02505|         return date.toISOString().slice(0, 19); // 2025-09-28T14:00:00\n02506|       };\n02507| \n02508|       // –ù–∞—á–∏–Ω–∞–µ–º —Å –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–≥–æ –¥–Ω—è\n02509|       let currentDayOffset = 1;\n02510|       let plannedDateTime = getDateForCalculation(currentDayOffset);\n02511| \n02512|       // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤ (–±–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç)\n02513|       const cargos = form.cargos.map(cargo => {\n02514|         const cargoData = {\n02515|           length: cargo.length / 100, // –ø–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–µ—Ç—Ä—ã\n02516|           width: cargo.width / 100,\n02517|           height: cargo.height / 100,\n02518|           volume: (cargo.length * cargo.width * cargo.height) / 1000000, // –º3\n02519|           weight: cargo.weight,\n02520|           isHP: form.needPackaging, // –∑–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n02521|           sealingPositionsCount: 0\n02522|         };\n02523|         \n02524|         console.log('üì¶ –ì—Ä—É–∑ –¥–ª—è –ü–≠–ö:', cargoData);\n02525|         return cargoData;\n02526|       });\n02527| \n02528|       // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (–Ω—É–∂–Ω–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ)\n02529|       let finalRequestData: any = null;\n02530|       \n02531|       // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ —Ä–∞—Å—á–µ—Ç–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç–æ–π\n02532|       const tryCalculateWithDate = async (plannedDateTime: string): Promise<any> => {\n02533|         // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –∫ API –ü–≠–ö —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n02534|         const requestData: any = {\n02535|           currencyCode: \"643\", // —Ä—É–±–ª–∏\n02536|           types: [3], // —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ –ø–µ—Ä–µ–≤–æ–∑–∫–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –º–∞—Å—Å–∏–≤)\n02537|           senderWarehouseId,\n02538|           receiverWarehouseId,\n02539|           isOpenCarSender: false,\n02540|           isOpenCarReceiver: false,\n02541|           isHyperMarket: false,\n02542|           plannedDateTime,\n02543|           isInsurance: form.needInsurance && form.declaredValue > 0,\n02544|           isInsurancePrice: form.needInsurance ? form.declaredValue : 0,\n02545|           isPickUp: form.fromAddressDelivery,\n02546|           isDelivery: form.toAddressDelivery,\n02547|           needReturnDocuments: false,\n02548|           needArrangeTransportationDocuments: false,\n02549|           senderDistanceType: 0,\n02550|           receiverDistanceType: 0,\n02551|           cargos // –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤\n02552|         };\n02553|         \n02554|         console.log('üìã –ü–≠–ö: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ requestData:', JSON.stringify(requestData, null, 2));\n02555| \n02556|         // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏ –ü–†–† –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\n02557|         if (form.needCarry) {\n02558|           requestData.pickupServices = {\n02559|             isLoading: true,\n02560|             floor: Math.max(0, form.floor - 1), // –ü–≠–ö —Å—á–∏—Ç–∞–µ—Ç —Å 0\n02561|             carryingDistance: 0,\n02562|             isElevator: form.hasFreightLift\n02563|           };\n02564|           requestData.deliveryServices = {\n02565|             isLoading: true,\n02566|             floor: Math.max(0, form.floor - 1),\n02567|             carryingDistance: 0,\n02568|             isElevator: form.hasFreightLift\n02569|           };\n02570|         }\n02571| \n02572|         // –î–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫–∏ pickup/delivery —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ü–≠–ö\n02573|         if (form.fromAddressDelivery) {\n02574|           console.log('üìç –ü–≠–ö: –¥–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ pickup –¥–ª—è –∑–∞–±–æ—Ä–∞');\n02575|           requestData.pickup = {\n02576|             address: form.fromAddress || `–†–æ—Å—Å–∏—è, ${form.fromCity}`\n02577|             // coordinates –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏\n02578|           };\n02579|         }\n02580|         \n02581|         if (form.toAddressDelivery) {\n02582|           console.log('üìç –ü–≠–ö: –¥–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ delivery –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏');\n02583|           requestData.delivery = {\n02584|             address: form.toAddress || `–†–æ—Å—Å–∏—è, ${form.toCity}`\n02585|             // coordinates –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏\n02586|           };\n02587|         }\n02588| \n02589|         // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n02590|         const requiredFields = ['types', 'senderWarehouseId', 'receiverWarehouseId', 'plannedDateTime', 'cargos'];\n02591|         const missingFields = requiredFields.filter(field => !requestData[field]);\n02592|         \n02593|         if (missingFields.length > 0) {\n02594|           throw new Error(`–ü–≠–ö: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: ${missingFields.join(', ')}`);\n02595|         }\n02596|         \n02597|         if (!Array.isArray(requestData.types) || requestData.types.length === 0) {\n02598|           throw new Error('–ü–≠–ö: –ø–æ–ª–µ types –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º');\n02599|         }\n02600|         \n02601|         if (!Array.isArray(requestData.cargos) || requestData.cargos.length === 0) {\n02602|           throw new Error('–ü–≠–ö: –ø–æ–ª–µ cargos –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º');\n02603|         }\n02604|         \n02605|         console.log('‚úÖ –ü–≠–ö: –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –ø—Ä–æ–π–¥–µ–Ω–∞');\n02606| \n02607|         // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏\n02608|         finalRequestData = {\n02609|           method: 'calculateprice',\n02610|           ...requestData\n02611|         };\n02612|         \n02613|         console.log('üöÄ –ü–≠–ö API –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å:', JSON.stringify(finalRequestData, null, 2));\n02614|         console.log('üåê –ü–≠–ö API URL:', apiUrl);\n02615|         console.log('üìã –ü–≠–ö: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–ø–æ–≤ —Ç–∞—Ä–∏—Ñ–æ–≤:', requestData.types.length);\n02616|         console.log('üìã –ü–≠–ö: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤:', requestData.cargos.length);\n02617|       \n02618|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π\n02619|       if (finalRequestData.pickup?.coordinates) {\n02620|         console.log('üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã pickup:', finalRequestData.pickup.coordinates);\n02621|       }\n02622|       if (finalRequestData.delivery?.coordinates) {\n02623|         console.log('üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã delivery:', finalRequestData.delivery.coordinates);\n02624|       }\n02625| \n02626|        const result = await enhancedApiRequest(\n02627|          '/api/pek',\n02628|          {\n02629|            method: 'POST',\n02630|            headers: {\n02631|              'Content-Type': 'application/json',\n02632|            },\n02633|            body: JSON.stringify(finalRequestData)\n02634|          },\n02635|          { operation: 'calculateprice', company: '–ü–≠–ö' }\n02636|        );\n02637| \n02638|        if (result && typeof result === 'object' && 'success' in result && !result.success) {\n02639|          console.error('‚ùå –ü–≠–ö API —Ä–∞—Å—á–µ—Ç –æ—à–∏–±–∫–∞:', result.error);\n02640|          throw new Error(result.error.userMessage || result.error.message);\n02641|        }\n02642| \n02643|        const response = result as Response;\n02644|        console.log(`üì° –ü–≠–ö API —Ä–∞—Å—á–µ—Ç —Å—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`);\n02645|        console.log(`üì° –ü–≠–ö API URL: ${response.url}`);\n02646| \n02647|        const responseText = await response.text();\n02648|        console.log(`üì° –ü–≠–ö API —Å—ã—Ä–æ–π –æ—Ç–≤–µ—Ç:`, responseText.substring(0, 1000));\n02649| \n02650|        let data;\n02651|        try {\n02652|          data = JSON.parse(responseText);\n02653|          console.log('üöÄ –ü–≠–ö API –æ—Ç–≤–µ—Ç:', JSON.stringify(data, null, 2));\n02654|        } catch (parseError) {\n02655|          console.error('‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', parseError);\n02656|          throw new Error(`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç API: ${responseText.substring(0, 200)}`);\n02657|        }\n02658| \n02659|         return { response, data };\n02660|       };\n02661| \n02662|       // –î–æ–±–∞–≤–ª—è–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞—Å—á–µ—Ç–∞\n02663|       console.log('üîß –ü–≠–ö: –≥–æ—Ç–æ–≤–∏–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞...');\n02664|       console.log('üìç senderWarehouseId:', senderWarehouseId);\n02665|       console.log('üìç receiverWarehouseId:', receiverWarehouseId);\n02666|       console.log('üìÖ –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞:', plannedDateTime);\n02667|       console.log('üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤:', cargos.length);\n02668|       console.log('üîß form.fromAddressDelivery:', form.fromAddressDelivery);\n02669|       console.log('üîß form.toAddressDelivery:', form.toAddressDelivery);\n02670|       \n02671|       // –¶–∏–∫–ª –ø–æ–ø—ã—Ç–æ–∫ —Å —Ä–∞–∑–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏ (–º–∞–∫—Å–∏–º—É–º 7 –¥–Ω–µ–π)\n02672|       const maxRetries = 7;\n02673|       let lastError: Error | null = null;\n02674|       \n02675|       console.log('üöÄ –ü–≠–ö: –∑–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª —Ä–∞—Å—á–µ—Ç–∞...');\n02676|       \n02677|       for (let attempt = 0; attempt < maxRetries; attempt++) {\n02678|         try {\n02679|           console.log(`üìÖ –ü–≠–ö: –ø–æ–ø—ã—Ç–∫–∞ ${attempt + 1}/${maxRetries}, –¥–∞—Ç–∞: ${plannedDateTime}`);\n02680|           \n02681|           const { response, data } = await tryCalculateWithDate(plannedDateTime);\n02682|           \n02683|           if (response.ok && !data.hasError && data.transfers && data.transfers.length > 0) {\n02684|             const transfer = data.transfers[0]; // –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Ç–∞—Ä–∏—Ñ (–∞–≤—Ç–æ)\n02685|             \n02686|             if (!transfer.hasError) {\n02687|           // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —É—Å–ª—É–≥\n02688|           const services: { name: string; description: string; price: number }[] = [];\n02689|           let totalCalculated = 0;\n02690| \n02691|           const processServices = (servicesList: any[], parentName = '') => {\n02692|             servicesList.forEach(service => {\n02693|               const serviceName = parentName ? `${parentName} - ${service.info}` : service.info;\n02694|               const serviceCost = parseFloat(service.cost) || 0;\n02695|               \n02696|               if (serviceCost > 0) {\n02697|                 services.push({\n02698|                   name: serviceName,\n02699|                   description: service.serviceType || '',\n02700|                   price: serviceCost\n02701|                 });\n02702|                 totalCalculated += serviceCost;\n02703|               }\n02704| \n02705|               // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏\n02706|               if (service.services && Array.isArray(service.services)) {\n02707|                 processServices(service.services, serviceName);\n02708|               }\n02709|             });\n02710|           };\n02711| \n02712|           if (transfer.services) {\n02713|             processServices(transfer.services);\n02714|           }\n02715| \n02716|           // –ï—Å–ª–∏ –Ω–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —É—Å–ª—É–≥, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n02717|           if (services.length === 0) {\n02718|             services.push({\n02719|               name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n02720|               description: `${senderZone.branchTitle} - ${receiverZone.branchTitle}`,\n02721|               price: Math.round(transfer.costTotal)\n02722|             });\n02723|           }\n02724| \n02725|           return {\n02726|             company: '–ü–≠–ö',\n02727|             price: Math.round(transfer.costTotal),\n02728|             days: transfer.estDeliveryTime || 3,\n02729|             details: {\n02730|               note: `–î–æ—Å—Ç–∞–≤–∫–∞ ${senderZone.branchTitle} - ${receiverZone.branchTitle} (–∞–≤—Ç–æ)`,\n02731|               services,\n02732|               senderZone: {\n02733|                 title: senderZone.branchTitle,\n02734|                 zone: senderZone.zoneName,\n02735|                 warehouseId: senderWarehouseId\n02736|               },\n02737|               receiverZone: {\n02738|                 title: receiverZone.branchTitle,\n02739|                 zone: receiverZone.zoneName,\n02740|                 warehouseId: receiverWarehouseId\n02741|               }\n02742|             },\n02743|             requestData: finalRequestData,\n02744|             responseData: data,\n02745|             apiUrl\n02746|               };\n02747|             } else {\n02748|               // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ–±–ª–µ–º–æ–π —Å –¥–∞—Ç–æ–π\n02749|               const errorMessage = transfer.errorMessage || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞ –ü–≠–ö';\n02750|               if (errorMessage.includes('–∑–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω') || errorMessage.includes('–≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã')) {\n02751|                 console.log(`üìÖ –ü–≠–ö: ${errorMessage}. –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...`);\n02752|                 lastError = new Error(errorMessage);\n02753|                 // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é\n02754|                 currentDayOffset++;\n02755|                 plannedDateTime = getDateForCalculation(currentDayOffset);\n02756|                 continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –¥–∞—Ç—É\n02757|               } else {\n02758|                 throw new Error(errorMessage);\n02759|               }\n02760|             }\n02761|           } else {\n02762|             // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—à–∏–±–∫—É –Ω–∞ —É—Ä–æ–≤–Ω–µ –¥–∞–Ω–Ω—ã—Ö\n02763|             const errorMessage = data.errorMessage || data.message || '–û—à–∏–±–∫–∞ API –ü–≠–ö';\n02764|             if (errorMessage.includes('–∑–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω') || errorMessage.includes('–≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã')) {\n02765|               console.log(`üìÖ –ü–≠–ö: ${errorMessage}. –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...`);\n02766|               lastError = new Error(errorMessage);\n02767|               // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é\n02768|               currentDayOffset++;\n02769|               plannedDateTime = getDateForCalculation(currentDayOffset);\n02770|               continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –¥–∞—Ç—É\n02771|             } else {\n02772|               throw new Error(errorMessage);\n02773|             }\n02774|           }\n02775|         } catch (error: any) {\n02776|           console.error(`‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –Ω–∞ –ø–æ–ø—ã—Ç–∫–µ ${attempt + 1}:`, error.message);\n02777|           \n02778|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ–±–ª–µ–º–æ–π —Å –¥–∞—Ç–æ–π\n02779|           if (error.message?.includes('–∑–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω') || error.message?.includes('–≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã')) {\n02780|             console.log(`üìÖ –ü–≠–ö: –ø—Ä–æ–±–ª–µ–º–∞ —Å –¥–∞—Ç–æ–π. –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...`);\n02781|             lastError = error;\n02782|             // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é\n02783|             currentDayOffset++;\n02784|             plannedDateTime = getDateForCalculation(currentDayOffset);\n02785|             continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –¥–∞—Ç—É\n02786|           } else {\n02787|             // –î—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞ - –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ä–∞–∑—É\n02788|             throw error;\n02789|           }\n02790|         }\n02791|       }\n02792|       \n02793|       // –ï—Å–ª–∏ –¥–æ—à–ª–∏ –¥–æ —Å—é–¥–∞ - –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã\n02794|       console.error(`‚ùå –ü–≠–ö: –≤—Å–µ ${maxRetries} –ø–æ–ø—ã—Ç–æ–∫ –∏—Å—á–µ—Ä–ø–∞–Ω—ã. –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞:`, lastError?.message);\n02795|       throw lastError || new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—É—é –¥–∞—Ç—É –¥–ª—è –∑–∞–±–æ—Ä–∞ –≥—Ä—É–∑–∞');\n02796|       \n02797|     } catch (error: any) {\n02798|       console.error('üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ü–≠–ö API:', error);\n02799|       \n02800|       // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –æ—à–∏–±–∫–∏\n02801|       let errorDescription = '–û—à–∏–±–∫–∞ API –ü–≠–ö';\n02802|       \n02803|       if (error.message?.includes('Failed to fetch')) {\n02804|         errorDescription = 'API –ü–≠–ö –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';\n02805|       } else if (error.message?.includes('401')) {\n02806|         errorDescription = '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ü–≠–ö';\n02807|       } else if (error.message?.includes('400')) {\n02808|         errorDescription = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞';\n02809|       } else if (error.message?.includes('timeout')) {\n02810|         errorDescription = '–¢–∞–π–º-–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ API';\n02811|       }\n02812|       \n02813|       console.error(`üö® –ü–≠–ö: ${errorDescription}. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ñ–æ–ª–ª–±—ç–∫ —Ä–∞—Å—á–µ—Ç—É`);\n02814|       \n02815|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n02816|       const totalVolume = form.cargos.reduce((sum, cargo) => \n02817|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n02818|       );\n02819|       \n02820|       // –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π —Ñ–æ–ª–ª–±—ç–∫ —Ä–∞—Å—á–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Å–∞ –∏ –æ–±—ä–µ–º–∞\n02821|       let basePrice = Math.max(\n02822|         totalWeight * 18, // 18 —Ä—É–± –∑–∞ –∫–≥\n02823|         totalVolume * 4500 // 4500 —Ä—É–± –∑–∞ –º3\n02824|       );\n02825|       \n02826|       // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏\n02827|       const services: { name: string; description: string; price: number }[] = [];\n02828|       \n02829|       services.push({\n02830|         name: '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞',\n02831|         description: `${form.fromCity} - ${form.toCity} (${totalWeight} –∫–≥, ${totalVolume.toFixed(3)} –º¬≥)`,\n02832|         price: Math.round(basePrice)\n02833|       });\n02834|       \n02835|       if (form.fromAddressDelivery) {\n02836|         const pickupCost = 600;\n02837|         basePrice += pickupCost;\n02838|         services.push({\n02839|           name: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n02840|           description: '–û—Ç –∞–¥—Ä–µ—Å–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è',\n02841|           price: pickupCost\n02842|         });\n02843|       }\n02844|       \n02845|       if (form.toAddressDelivery) {\n02846|         const deliveryCost = 600;\n02847|         basePrice += deliveryCost;\n02848|         services.push({\n02849|           name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n02850|           description: '–î–æ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è',\n02851|           price: deliveryCost\n02852|         });\n02853|       }\n02854|       \n02855|       if (form.needInsurance && form.declaredValue > 0) {\n02856|         const insuranceCost = form.declaredValue * 0.012;\n02857|         basePrice += insuranceCost;\n02858|         services.push({\n02859|           name: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ',\n02860|           description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n02861|           price: Math.round(insuranceCost)\n02862|         });\n02863|       }\n02864|       \n02865|       if (form.needPackaging) {\n02866|         const packagingCost = totalWeight * 25;\n02867|         basePrice += packagingCost;\n02868|         services.push({\n02869|           name: '–ó–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞',\n02870|           description: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n02871|           price: Math.round(packagingCost)\n02872|         });\n02873|       }\n02874|       \n02875|       if (form.needCarry) {\n02876|         const carryCost = 500;\n02877|         basePrice += carryCost;\n02878|         services.push({\n02879|           name: '–ü–æ–¥—ä–µ–º –Ω–∞ —ç—Ç–∞–∂',\n02880|           description: `–ù–∞ ${form.floor} —ç—Ç–∞–∂ ${form.hasFreightLift ? '(—Å –ª–∏—Ñ—Ç–æ–º)' : '(–±–µ–∑ –ª–∏—Ñ—Ç–∞)'}`,\n02881|           price: carryCost\n02882|         });\n02883|       }\n02884|       \n02885|       return {\n02886|         company: '–ü–≠–ö',\n02887|         price: Math.round(basePrice),\n02888|         days: 3,\n02889|         details: {\n02890|           note: '–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º –ü–≠–ö (API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)',\n02891|           services,\n02892|           totalWeight,\n02893|           totalVolume,\n02894|           errorInfo: error.message\n02895|         },\n02896|         requestData: null,\n02897|         responseData: null,\n02898|         apiUrl,\n02899|         error: `${errorDescription}. –ü–æ–∫–∞–∑–∞–Ω –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º.`\n02900|       };\n02901|     }\n02902|   };\n02903| \n02904| \n02905| \n02906|   // üîß –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö\n02907|   const calculateOptimalLength = (cargos: typeof form.cargos) => {\n02908|     if (cargos.length === 1) {\n02909|       return cargos[0].length / 100; // –û–¥–Ω–æ –º–µ—Å—Ç–æ - —Ç–æ—á–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã\n02910|     }\n02911|     \n02912|     // –î–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç:\n02913|     const maxLength = Math.max(...cargos.map(c => c.length)) / 100;\n02914|     const totalLength = cargos.reduce((sum, c) => sum + c.length, 0) / 100;\n02915|     \n02916|     // –ï—Å–ª–∏ –º–µ—Å—Ç –º–Ω–æ–≥–æ (>3), –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É–º–º–∞—Ä–Ω—É—é –¥–ª–∏–Ω—É (–º–µ—Å—Ç–∞ –≤ —Ä—è–¥)\n02917|     // –ò–Ω–∞—á–µ - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é (–º–µ—Å—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ)\n02918|     return cargos.length > 3 ? totalLength : maxLength;\n02919|   };\n02920| \n02921|   const calculateOptimalWidth = (cargos: typeof form.cargos) => {\n02922|     // –î–ª—è —à–∏—Ä–∏–Ω—ã –ª–æ–≥–∏—á–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é\n02923|     return Math.max(...cargos.map(c => c.width)) / 100;\n02924|   };\n02925| \n02926|   const calculateOptimalHeight = (cargos: typeof form.cargos) => {\n02927|     if (cargos.length === 1) {\n02928|       return cargos[0].height / 100;\n02929|     }\n02930|     \n02931|     const maxHeight = Math.max(...cargos.map(c => c.height)) / 100;\n02932|     const totalHeight = cargos.reduce((sum, c) => sum + c.height, 0) / 100;\n02933|     \n02934|     // –ï—Å–ª–∏ –º–Ω–æ–≥–æ –º–µ–ª–∫–∏—Ö –º–µ—Å—Ç - –º–æ–∂–µ–º —Å—Ç–∞–∫–∏—Ä–æ–≤–∞—Ç—å\n02935|     const avgHeight = totalHeight / cargos.length;\n02936|     return avgHeight < 0.5 ? totalHeight : maxHeight; // 50—Å–º –ø–æ—Ä–æ–≥ –¥–ª—è —Å—Ç–∞–∫–∏—Ä–æ–≤–∞–Ω–∏—è\n02937|   };\n02938| \n02939|   // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç\n02940|   const validateMultipleCargos = (cargos: typeof form.cargos) => {\n02941|     if (!cargos || cargos.length === 0) {\n02942|       throw new Error('–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≥—Ä—É–∑–æ–≤—ã–µ –º–µ—Å—Ç–∞');\n02943|     }\n02944|     \n02945|     if (cargos.length > 50) {\n02946|       throw new Error(`–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç (${cargos.length}). –ú–∞–∫—Å–∏–º—É–º: 50`);\n02947|     }\n02948|     \n02949|     const totalVolume = cargos.reduce((sum, cargo) => \n02950|       sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n02951|     );\n02952|     \n02953|     if (totalVolume > 100) {\n02954|       console.warn('‚ö†Ô∏è –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π –æ–±—ä–µ–º –≥—Ä—É–∑–∞ (>100 –º¬≥). –í–æ–∑–º–æ–∂–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.');\n02955|     }\n02956|     \n02957|     return true;\n02958|   };\n02959| \n02960|   const calculateRailContinent = async (): Promise<CalculationResult> => {\n02961|     const apiUrl = '/api/rail-continent';\n02962|     \n02963|     try {\n02964|       // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n02965|       validateMultipleCargos(form.cargos);\n02966|       \n02967|       // –í—ã—á–∏—Å–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥—Ä—É–∑–∞\n02968|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n02969|       const totalVolume = form.cargos.reduce((sum, cargo) => \n02970|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n02971|       );\n02972|       \n02973|       // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–º–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n02974|       const optimalLength = calculateOptimalLength(form.cargos);\n02975|       const optimalWidth = calculateOptimalWidth(form.cargos);\n02976|       const optimalHeight = calculateOptimalHeight(form.cargos);\n02977|       \n02978|       // üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n02979|       console.log('üöÇ Rail Continent: –ê–Ω–∞–ª–∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç:');\n02980|       console.log(`   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç: ${form.cargos.length}`);\n02981|       console.log(`   - –û–±—â–∏–π –≤–µ—Å: ${totalWeight} –∫–≥`);\n02982|       console.log(`   - –û–±—â–∏–π –æ–±—ä–µ–º: ${totalVolume.toFixed(3)} –º¬≥`);\n02983|       \n02984|       form.cargos.forEach((cargo, index) => {\n02985|         console.log(`   üì¶ –ú–µ—Å—Ç–æ ${index + 1}:`);\n02986|         console.log(`     - –ì–∞–±–∞—Ä–∏—Ç—ã: ${cargo.length}√ó${cargo.width}√ó${cargo.height} —Å–º`);\n02987|         console.log(`     - –í–µ—Å: ${cargo.weight} –∫–≥`);\n02988|         console.log(`     - –û–±—ä–µ–º: ${((cargo.length * cargo.width * cargo.height) / 1000000).toFixed(3)} –º¬≥`);\n02989|       });\n02990|       \n02991|       if (form.cargos.length > 1) {\n02992|         const maxLength = Math.max(...form.cargos.map(c => c.length));\n02993|         const maxWidth = Math.max(...form.cargos.map(c => c.width));\n02994|         const maxHeight = Math.max(...form.cargos.map(c => c.height));\n02995|         console.log(`   üìê –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã: ${maxLength}√ó${maxWidth}√ó${maxHeight} —Å–º`);\n02996|         console.log(`   üîß –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã: ${(optimalLength*100).toFixed(0)}√ó${(optimalWidth*100).toFixed(0)}√ó${(optimalHeight*100).toFixed(0)} —Å–º`);\n02997|       }\n02998|       \n02999|       // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä quantity –∏ —É–ª—É—á—à–µ–Ω–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã\n03000|       const requestData = {\n03001|         city_sender: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n03002|         city_receiver: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n03003|         weight: totalWeight,\n03004|         volume: totalVolume,\n03005|         quantity: form.cargos.length, // üîß –î–û–ë–ê–í–õ–ï–ù–û: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç\n03006|         length: optimalLength,        // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞\n03007|         width: optimalWidth,          // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞  \n03008|         height: optimalHeight,        // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞\n03009|         declared_cost: form.declaredValue,\n03010|         pickup: form.fromAddressDelivery ? '1' : '0',\n03011|         delivery: form.toAddressDelivery ? '1' : '0',\n03012|         packaging: form.needPackaging ? '1' : '0',\n03013|         insurance: form.needInsurance ? '1' : '0',\n03014|         tariff: 'auto' // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞\n03015|       };\n03016| \n03017|       console.log('üöÇ Rail Continent –∑–∞–ø—Ä–æ—Å:', requestData);\n03018| \n03019|        const result = await enhancedApiRequest(\n03020|          apiUrl,\n03021|          {\n03022|            method: 'POST',\n03023|            headers: {\n03024|              'Content-Type': 'application/json',\n03025|            },\n03026|            body: JSON.stringify(requestData)\n03027|          },\n03028|          { operation: 'calculate', company: 'Rail Continent' }\n03029|        );\n03030| \n03031|        if (result && typeof result === 'object' && 'success' in result && !result.success) {\n03032|          console.error('‚ùå Rail Continent API –æ—à–∏–±–∫–∞:', result.error);\n03033|          return {\n03034|            company: 'Rail Continent',\n03035|            price: 0,\n03036|            days: 0,\n03037|            error: result.error.userMessage || result.error.message,\n03038|            requestData,\n03039|            responseData: null,\n03040|            apiUrl\n03041|          };\n03042|        }\n03043| \n03044|        const response = result as Response;\n03045|        const data = await response.json();\n03046|        console.log('üöÇ Rail Continent –æ—Ç–≤–µ—Ç:', data);\n03047| \n03048|       if (response.ok && data.result === 'success' && data.data) {\n03049|         // –í—ã–±–∏—Ä–∞–µ–º –∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã–π —Ç–∞—Ä–∏—Ñ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π (—Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π)\n03050|         const autoTariff = data.data.auto;\n03051|         \n03052|         if (autoTariff) {\n03053|           // –°–æ–±–∏—Ä–∞–µ–º –¥–µ—Ç–∞–ª–∏ –ø–æ —É—Å–ª—É–≥–∞–º –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n03054|           const services: { name: string; description: string; price: number }[] = [];\n03055|           let totalPrice = 0;\n03056|           \n03057|           console.log('üöÇ Rail Continent –¥–µ—Ç–∞–ª–∏ —Ç–∞—Ä–∏—Ñ–∞:', {\n03058|             price_with_out_sale: autoTariff.price_with_out_sale,\n03059|             pricePackage: autoTariff.pricePackage,\n03060|             priceInsurance: autoTariff.priceInsurance,\n03061|             needPackaging: form.needPackaging,\n03062|             needInsurance: form.needInsurance,\n03063|             declaredValue: form.declaredValue\n03064|           });\n03065|           \n03066|           console.log('üöÇ Rail Continent —á–µ–∫–±–æ–∫—Å—ã —Å–æ—Å—Ç–æ—è–Ω–∏–µ:');\n03067|           console.log('   - –£–ø–∞–∫–æ–≤–∫–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è:', form.needPackaging);\n03068|           console.log('   - –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è:', form.needInsurance);\n03069|           console.log('   - –ó–∞—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:', form.declaredValue);\n03070|           \n03071|           // –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ –≥—Ä—É–∑–∞\n03072|           if (autoTariff.price_with_out_sale) {\n03073|             const deliveryPrice = parseFloat(autoTariff.price_with_out_sale);\n03074|             console.log('üöÇ –î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞:', deliveryPrice);\n03075|             services.push({\n03076|               name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n03077|               description: `${autoTariff.type} (${autoTariff.rsType})`,\n03078|               price: deliveryPrice\n03079|             });\n03080|             totalPrice += deliveryPrice;\n03081|           }\n03082|           \n03083|           // –£–ø–∞–∫–æ–≤–∫–∞\n03084|           if (form.needPackaging && autoTariff.pricePackage) {\n03085|             const packagingPrice = parseFloat(autoTariff.pricePackage);\n03086|             console.log('üöÇ –£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞:', packagingPrice);\n03087|             services.push({\n03088|               name: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n03089|               description: '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞',\n03090|               price: packagingPrice\n03091|             });\n03092|             totalPrice += packagingPrice;\n03093|           }\n03094|           \n03095|           // –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ\n03096|           if (form.needInsurance && autoTariff.priceInsurance) {\n03097|             const insuranceCost = Math.round(form.declaredValue * parseFloat(autoTariff.priceInsurance) / 100);\n03098|             console.log('üöÇ –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞:', insuranceCost, '(', form.declaredValue, '*', autoTariff.priceInsurance, '%)');\n03099|             services.push({\n03100|               name: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n03101|               description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n03102|               price: insuranceCost\n03103|             });\n03104|             totalPrice += insuranceCost;\n03105|           }\n03106| \n03107|           console.log('üöÇ Rail Continent –∏—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:', totalPrice);\n03108|           console.log('üöÇ Rail Continent —É—Å–ª—É–≥–∏:', services);\n03109| \n03110|           // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º, –Ω–æ –Ω–µ –≤–∫–ª—é—á–∞–µ–º –≤ –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å)\n03111|           const additionalServices: { name: string; description: string; price: number }[] = [];\n03112|           \n03113|           // –¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–µ —Å–±–æ—Ä—ã\n03114|           if (autoTariff.terminalEnter1) {\n03115|             additionalServices.push({\n03116|               name: '–¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–π —Å–±–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è',\n03117|               description: '–û–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä—É–∑–∞ –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ',\n03118|               price: parseInt(autoTariff.terminalEnter1)\n03119|             });\n03120|           }\n03121|           \n03122|           // –ó–∞–±–æ—Ä/–¥–æ—Å—Ç–∞–≤–∫–∞\n03123|           if (form.fromAddressDelivery && autoTariff.pricePickup && parseInt(autoTariff.pricePickup) > 0) {\n03124|             additionalServices.push({\n03125|               name: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n03126|               description: '–û—Ç –∞–¥—Ä–µ—Å–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è',\n03127|               price: parseInt(autoTariff.pricePickup)\n03128|             });\n03129|           }\n03130|           \n03131|           if (form.toAddressDelivery && autoTariff.priceDelivery && parseInt(autoTariff.priceDelivery) > 0) {\n03132|             additionalServices.push({\n03133|               name: '–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –∞–¥—Ä–µ—Å—É',\n03134|               description: '–î–æ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è',\n03135|               price: parseInt(autoTariff.priceDelivery)\n03136|             });\n03137|           }\n03138| \n03139|           return {\n03140|             company: 'Rail Continent',\n03141|             price: Math.round(totalPrice),\n03142|             days: parseInt(autoTariff.duration) || 5,\n03143|             details: {\n03144|               tariff: `${autoTariff.type} - ${autoTariff.service}`,\n03145|               transportType: autoTariff.rsType,\n03146|               weight: totalWeight,\n03147|               volume: totalVolume,\n03148|               route: `${form.fromCity} - ${form.toCity}`,\n03149|               services,\n03150|               additionalServices,\n03151|               allTariffs: data.data\n03152|             },\n03153|             requestData,\n03154|             responseData: data,\n03155|             apiUrl\n03156|           };\n03157|         } else {\n03158|           return {\n03159|             company: 'Rail Continent',\n03160|             price: 0,\n03161|             days: 0,\n03162|             error: '–ê–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã–π —Ç–∞—Ä–∏—Ñ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞',\n03163|             requestData,\n03164|             responseData: data,\n03165|             apiUrl\n03166|           };\n03167|         }\n03168|       } else {\n03169|         return {\n03170|           company: 'Rail Continent',\n03171|           price: 0,\n03172|           days: 0,\n03173|           error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ Rail Continent',\n03174|           requestData,\n03175|           responseData: data,\n03176|           apiUrl\n03177|         };\n03178|       }\n03179|     } catch (error: any) {\n03180|       console.error('üöÇ Rail Continent –æ—à–∏–±–∫–∞:', error);\n03181|       return {\n03182|         company: 'Rail Continent',\n03183|         price: 0,\n03184|         days: 0,\n03185|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03186|         apiUrl\n03187|       };\n03188|     }\n03189|   };\n03190| \n03191|   const calculateVozovoz = async (): Promise<CalculationResult> => {\n03192|     const apiUrl = '/api/vozovoz';\n03193|     \n03194|     try {\n03195|       // –í—ã—á–∏—Å–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥—Ä—É–∑–∞\n03196|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n03197|       const totalVolume = form.cargos.reduce((sum, cargo) => \n03198|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n03199|       );\n03200|       \n03201|       // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –í–æ–∑–æ–≤–æ–∑\n03202|       const maxDimensions = form.cargos.reduce((max, cargo) => {\n03203|         const length = cargo.length / 1000; // –ø–µ—Ä–µ–≤–æ–¥–∏–º –º–º –≤ –º\n03204|         const width = cargo.width / 1000;\n03205|         const height = cargo.height / 1000;\n03206|         const weight = cargo.weight;\n03207|         \n03208|         return {\n03209|           length: Math.max(max.length, length),\n03210|           width: Math.max(max.width, width),\n03211|           height: Math.max(max.height, height),\n03212|           weight: Math.max(max.weight, weight)\n03213|         };\n03214|       }, { length: 0, width: 0, height: 0, weight: 0 });\n03215|       \n03216|       console.log('üöö –í–æ–∑–æ–≤–æ–∑: –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');\n03217|       console.log('   - –û–±—â–∏–π –≤–µ—Å:', totalWeight, '–∫–≥');\n03218|       console.log('   - –û–±—â–∏–π –æ–±—ä–µ–º:', totalVolume, '–º¬≥');\n03219|       console.log('   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã:', maxDimensions);\n03220|       console.log('   - –û—Ç–∫—É–¥–∞:', form.fromCity);\n03221|       console.log('   - –ö—É–¥–∞:', form.toCity);\n03222|       \n03223|       // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º —Ç–∏–ø–æ–º –¥–æ—Å—Ç–∞–≤–∫–∏\n03224|       const createRequestData = (useAddressType: boolean) => ({\n03225|         object: \"price\",\n03226|         action: \"get\",\n03227|         params: {\n03228|           cargo: {\n03229|             dimension: {\n03230|               max: {                              // ‚úÖ –î–æ–±–∞–≤–ª—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É max\n03231|                 length: maxDimensions.length,     // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –≤ –º–µ—Ç—Ä–∞—Ö\n03232|                 width: maxDimensions.width,       // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –≤ –º–µ—Ç—Ä–∞—Ö\n03233|                 height: maxDimensions.height,     // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –≤ –º–µ—Ç—Ä–∞—Ö\n03234|                 weight: maxDimensions.weight      // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –≤ –∫–≥\n03235|               },\n03236|               quantity: form.cargos.length,       // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç\n03237|               volume: totalVolume,                // –û–±—â–∏–π –æ–±—ä–µ–º –≤ –º¬≥\n03238|               weight: totalWeight                 // –û–±—â–∏–π –≤–µ—Å –≤ –∫–≥\n03239|             },\n03240|             ...(form.needInsurance && form.declaredValue > 0 ? {\n03241|               insurance: form.declaredValue,      // ‚úÖ –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n03242|               insuranceNdv: false                 // –û—Ç–∫–ª—é—á–∞–µ–º —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –±–µ–∑ –æ–±—ä—è–≤–ª–µ–Ω–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n03243|             } : {\n03244|               insuranceNdv: true                  // –í–∫–ª—é—á–∞–µ–º —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –±–µ–∑ –æ–±—ä—è–≤–ª–µ–Ω–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n03245|             }),\n03246|              ...(form.needPackaging ? {\n03247|                wrapping: {\n03248|                  \"hardPackageVolume\": totalVolume  // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥ \"–ñ—ë—Å—Ç–∫–∞—è —É–ø–∞–∫–æ–≤–∫–∞\" –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n03249|                }\n03250|              } : {})\n03251|           },\n03252|           gateway: {\n03253|             dispatch: {\n03254|               point: {\n03255|                 location: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n03256|                 // ‚úÖ –ü–æ–ª—è address –∏ terminal –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n03257|                 ...(useAddressType || form.fromAddressDelivery ? {\n03258|                   address: form.fromAddress || \"–∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\"\n03259|                 } : {\n03260|                   terminal: \"default\"\n03261|                 })\n03262|               }\n03263|             },\n03264|             destination: {\n03265|               point: {\n03266|                 location: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n03267|                 // ‚úÖ –ü–æ–ª—è address –∏ terminal –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n03268|                 ...(useAddressType || form.toAddressDelivery ? {\n03269|                   address: form.toAddress || \"–∞–¥—Ä–µ—Å –ø–æ–ª—É—á–µ–Ω–∏—è\"\n03270|                 } : {\n03271|                   terminal: \"default\"\n03272|                 })\n03273|               }\n03274|             }\n03275|           }\n03276|         }\n03277|       });\n03278| \n03279|       // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º —Å terminal —Ç–∏–ø–æ–º (–µ—Å–ª–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω address delivery)\n03280|       let useAddressType = false;\n03281|       let requestData = createRequestData(useAddressType);\n03282|       \n03283|       console.log('üöö –í–æ–∑–æ–≤–æ–∑ –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03284| \n03285|       let result = await enhancedApiRequest(\n03286|         apiUrl,\n03287|         {\n03288|           method: 'POST',\n03289|           headers: {\n03290|             'Content-Type': 'application/json',\n03291|           },\n03292|           body: JSON.stringify(requestData)\n03293|         },\n03294|         { operation: 'calculate', company: '–í–æ–∑–æ–≤–æ–∑' }\n03295|       );\n03296| \n03297|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –æ—à–∏–±–∫—É API —É—Ä–æ–≤–Ω—è\n03298|       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n03299|         console.error('‚ùå –í–æ–∑–æ–≤–æ–∑ API –æ—à–∏–±–∫–∞:', result.error);\n03300|         return {\n03301|           company: '–í–æ–∑–æ–≤–æ–∑',\n03302|           price: 0,\n03303|           days: 0,\n03304|           error: result.error.userMessage || result.error.message,\n03305|           requestData,\n03306|           responseData: null,\n03307|           apiUrl\n03308|         };\n03309|       }\n03310| \n03311|       const response = result as Response;\n03312|       const data = await response.json();\n03313|       console.log('üöö –í–æ–∑–æ–≤–æ–∑ –æ—Ç–≤–µ—Ç:', JSON.stringify(data, null, 2));\n03314| \n03315|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ –ò–õ–ò –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–∫–∏ –≤ –æ—Ç–≤–µ—Ç–µ\n03316|       if (response.ok && data.response) {\n03317|         // –£—Å–ø–µ—à–Ω—ã–π —Ä–∞—Å—á–µ—Ç\n03318|         const responseData = data.response;\n03319|         \n03320|         console.log('üöö –í–æ–∑–æ–≤–æ–∑ –∞–Ω–∞–ª–∏–∑ –æ—Ç–≤–µ—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:', responseData);\n03321|         \n03322|         // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n03323|         const services: { name: string; description: string; price: number }[] = [];\n03324|         let totalPrice = responseData.price || responseData.basePrice || 0;\n03325|         \n03326|         // ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –º–∞—Å—Å–∏–≤ —É—Å–ª—É–≥ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API\n03327|         if (responseData.service && Array.isArray(responseData.service)) {\n03328|           console.log('üöö –í–æ–∑–æ–≤–æ–∑ –Ω–∞–π–¥–µ–Ω –º–∞—Å—Å–∏–≤ —É—Å–ª—É–≥:', responseData.service.length);\n03329|           \n03330|           responseData.service.forEach((service: any, index: number) => {\n03331|             console.log(`üöö –£—Å–ª—É–≥–∞ [${index}]:`, service);\n03332|             if (service.price > 0) {\n03333|               services.push({\n03334|                 name: service.name || '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —É—Å–ª—É–≥–∞',\n03335|                 description: service.description || '',\n03336|                 price: service.price\n03337|               });\n03338|             }\n03339|           });\n03340|         } else {\n03341|           console.log('üöö –í–æ–∑–æ–≤–æ–∑: –º–∞—Å—Å–∏–≤ —É—Å–ª—É–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –ø—É—Å—Ç');\n03342|           \n03343|           // –ï—Å–ª–∏ –º–∞—Å—Å–∏–≤–∞ —É—Å–ª—É–≥ –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n03344|           if (responseData.basePrice && responseData.basePrice > 0) {\n03345|             services.push({\n03346|               name: '–ë–∞–∑–æ–≤–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞',\n03347|               description: `${form.fromCity} - ${form.toCity}`,\n03348|               price: responseData.basePrice\n03349|             });\n03350|           }\n03351|           \n03352|           // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–∫–∏–¥–∫–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—ë –æ—Ç–¥–µ–ª—å–Ω–æ\n03353|           if (responseData.price !== responseData.basePrice && responseData.price > 0) {\n03354|             const discount = (responseData.basePrice || 0) - responseData.price;\n03355|             if (discount > 0) {\n03356|               services.push({\n03357|                 name: '–°–∫–∏–¥–∫–∞',\n03358|                 description: '–ü—Ä–∏–º–µ–Ω–µ–Ω–∞ —Å–∫–∏–¥–∫–∞',\n03359|                 price: -discount\n03360|               });\n03361|             }\n03362|           }\n03363|         }\n03364|         \n03365|         // –ï—Å–ª–∏ –Ω–∏–∫–∞–∫–∏—Ö —É—Å–ª—É–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n03366|         if (services.length === 0 && totalPrice > 0) {\n03367|           services.push({\n03368|             name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n03369|             description: `${form.fromCity} - ${form.toCity}`,\n03370|             price: totalPrice\n03371|           });\n03372|         }\n03373| \n03374|         console.log('üöö –í–æ–∑–æ–≤–æ–∑ –∏—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:', totalPrice);\n03375|         console.log('üöö –í–æ–∑–æ–≤–æ–∑ —É—Å–ª—É–≥–∏:', services);\n03376| \n03377|         return {\n03378|           company: '–í–æ–∑–æ–≤–æ–∑',\n03379|           price: Math.round(totalPrice),\n03380|           days: responseData.deliveryTime?.to || responseData.deliveryTime?.from || 3,\n03381|           details: {\n03382|             note: `–î–æ—Å—Ç–∞–≤–∫–∞ ${form.fromCity} - ${form.toCity}`,\n03383|             services,\n03384|             basePrice: responseData.basePrice,\n03385|             finalPrice: responseData.price,\n03386|             deliveryTime: responseData.deliveryTime,\n03387|             weight: totalWeight,\n03388|             volume: totalVolume\n03389|           },\n03390|           requestData,\n03391|           responseData: data,\n03392|           apiUrl\n03393|         };\n03394|       } else {\n03395|         // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –∏–∑ API –æ—Ç–≤–µ—Ç–∞\n03396|         const errorMessage = data.error || data.message || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –í–æ–∑–æ–≤–æ–∑';\n03397|         console.log('üöö –í–æ–∑–æ–≤–æ–∑: –ø–æ–ª—É—á–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≤ –æ—Ç–≤–µ—Ç–µ API:', errorMessage);\n03398|         \n03399|         // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–≤—è–∑–∞–Ω–∞ –ª–∏ –æ—à–∏–±–∫–∞ —Å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–∞\n03400|         const isTerminalError = errorMessage.toLowerCase().includes('—Ç–µ—Ä–º–∏–Ω–∞–ª') || \n03401|                                errorMessage.toLowerCase().includes('–ª–æ–∫–∞—Ü–∏—è') ||\n03402|                                errorMessage.toLowerCase().includes('–Ω–µ –∏–º–µ–µ—Ç') ||\n03403|                                errorMessage.toLowerCase().includes('terminal') ||\n03404|                                errorMessage.toLowerCase().includes('location');\n03405|         \n03406|         // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–º –∏ –º—ã –µ—â–µ –Ω–µ –ø—Ä–æ–±–æ–≤–∞–ª–∏ address —Ç–∏–ø, –ø—Ä–æ–±—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è\n03407|         if (isTerminalError && !useAddressType) {\n03408|           console.log('üöö –í–æ–∑–æ–≤–æ–∑: –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–º, –ø—Ä–æ–±—É–µ–º —Å address —Ç–∏–ø–æ–º...');\n03409|           \n03410|           useAddressType = true;\n03411|           requestData = createRequestData(useAddressType);\n03412|           \n03413|           console.log('üöö –í–æ–∑–æ–≤–æ–∑ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å address:', JSON.stringify(requestData, null, 2));\n03414|           \n03415|           result = await enhancedApiRequest(\n03416|             apiUrl,\n03417|             {\n03418|               method: 'POST',\n03419|               headers: {\n03420|                 'Content-Type': 'application/json',\n03421|               },\n03422|               body: JSON.stringify(requestData)\n03423|             },\n03424|             { operation: 'calculate', company: '–í–æ–∑–æ–≤–æ–∑' }\n03425|           );\n03426| \n03427|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –æ—à–∏–±–∫—É API —É—Ä–æ–≤–Ω—è –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞\n03428|           if (result && typeof result === 'object' && 'success' in result && !result.success) {\n03429|             console.error('‚ùå –í–æ–∑–æ–≤–æ–∑ API –æ—à–∏–±–∫–∞ (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å):', result.error);\n03430|             return {\n03431|               company: '–í–æ–∑–æ–≤–æ–∑',\n03432|               price: 0,\n03433|               days: 0,\n03434|               error: result.error.userMessage || result.error.message,\n03435|               requestData,\n03436|               responseData: null,\n03437|               apiUrl\n03438|             };\n03439|           }\n03440| \n03441|           const retryResponse = result as Response;\n03442|           const retryData = await retryResponse.json();\n03443|           console.log('üöö –í–æ–∑–æ–≤–æ–∑ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç:', JSON.stringify(retryData, null, 2));\n03444| \n03445|           if (retryResponse.ok && retryData.response) {\n03446|             // –£—Å–ø–µ—à–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è\n03447|             const responseData = retryData.response;\n03448|             \n03449|             console.log('üöö –í–æ–∑–æ–≤–æ–∑: —É—Å–ø–µ—à–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ address');\n03450|             \n03451|             const services: { name: string; description: string; price: number }[] = [];\n03452|             let totalPrice = responseData.price || responseData.basePrice || 0;\n03453|             \n03454|             if (responseData.service && Array.isArray(responseData.service)) {\n03455|               responseData.service.forEach((service: any, index: number) => {\n03456|                 if (service.price > 0) {\n03457|                   services.push({\n03458|                     name: service.name || '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —É—Å–ª—É–≥–∞',\n03459|                     description: service.description || '',\n03460|                     price: service.price\n03461|                   });\n03462|                 }\n03463|               });\n03464|             }\n03465|             \n03466|             if (services.length === 0 && totalPrice > 0) {\n03467|               services.push({\n03468|                 name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞ (–∞–¥—Ä–µ—Å–Ω–∞—è)',\n03469|                 description: `${form.fromCity} - ${form.toCity}`,\n03470|                 price: totalPrice\n03471|               });\n03472|             }\n03473| \n03474|             return {\n03475|               company: '–í–æ–∑–æ–≤–æ–∑',\n03476|               price: Math.round(totalPrice),\n03477|               days: responseData.deliveryTime?.to || responseData.deliveryTime?.from || 3,\n03478|               details: {\n03479|                 note: `–î–æ—Å—Ç–∞–≤–∫–∞ ${form.fromCity} - ${form.toCity} (–∞–¥—Ä–µ—Å–Ω–∞—è)`,\n03480|                 services,\n03481|                 basePrice: responseData.basePrice,\n03482|                 finalPrice: responseData.price,\n03483|                 deliveryTime: responseData.deliveryTime,\n03484|                 weight: totalWeight,\n03485|                 volume: totalVolume\n03486|               },\n03487|               requestData,\n03488|               responseData: retryData,\n03489|               apiUrl\n03490|             };\n03491|           } else {\n03492|             // –ò –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å address –Ω–µ —É–¥–∞–ª—Å—è\n03493|             const retryErrorMessage = retryData.error || retryData.message || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Å –∞–¥—Ä–µ—Å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–æ–π';\n03494|             console.log('üöö –í–æ–∑–æ–≤–æ–∑: –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å address –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É:', retryErrorMessage);\n03495|             \n03496|             return {\n03497|               company: '–í–æ–∑–æ–≤–æ–∑',\n03498|               price: 0,\n03499|               days: 0,\n03500|               error: `–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –∏ –∞–¥—Ä–µ—Å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏. ${retryErrorMessage}`,\n03501|               requestData,\n03502|               responseData: retryData,\n03503|               apiUrl\n03504|             };\n03505|           }\n03506|         } else {\n03507|           // –û—à–∏–±–∫–∞ –Ω–µ —Å–≤—è–∑–∞–Ω–∞ —Å —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–º –∏–ª–∏ —É–∂–µ –ø—Ä–æ–±–æ–≤–∞–ª–∏ address\n03508|           return {\n03509|             company: '–í–æ–∑–æ–≤–æ–∑',\n03510|             price: 0,\n03511|             days: 0,\n03512|             error: errorMessage,\n03513|             requestData,\n03514|             responseData: data,\n03515|             apiUrl\n03516|           };\n03517|         }\n03518|       }\n03519|     } catch (error: any) {\n03520|       console.error('üöö –í–æ–∑–æ–≤–æ–∑ –æ—à–∏–±–∫–∞:', error);\n03521|       return {\n03522|         company: '–í–æ–∑–æ–≤–æ–∑',\n03523|         price: 0,\n03524|         days: 0,\n03525|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03526|         apiUrl\n03527|       };\n03528|     }\n03529|   };\n03530| \n03531|   // –†–∞—Å—á–µ—Ç –¥–ª—è Nord Wheel\n03532|   const calculateNordWheel = async (): Promise<CalculationResult> => {\n03533|     const apiUrl = 'https://api.nordw.orog.ru/api/v1/calculate';\n03534| \n03535|     try {\n03536|       // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03537|       validateMultipleCargos(form.cargos);\n03538|       \n03539|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n03540|       const totalVolume = form.cargos.reduce((sum, cargo) => \n03541|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n03542|       );\n03543| \n03544|       // üîß –î–û–ë–ê–í–õ–ï–ù–û: –†–∞—Å—á–µ—Ç –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03545|       const maxLength = Math.max(...form.cargos.map(c => c.length));\n03546|       const maxWidth = Math.max(...form.cargos.map(c => c.width));\n03547|       const maxHeight = Math.max(...form.cargos.map(c => c.height));\n03548|       \n03549|       // üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03550|       console.log('üåê Nord Wheel: –ê–Ω–∞–ª–∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç:');\n03551|       console.log(`   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç: ${form.cargos.length}`);\n03552|       console.log(`   - –û–±—â–∏–π –≤–µ—Å: ${totalWeight} –∫–≥`);\n03553|       console.log(`   - –û–±—â–∏–π –æ–±—ä–µ–º: ${totalVolume.toFixed(3)} –º¬≥`);\n03554|       \n03555|       form.cargos.forEach((cargo, index) => {\n03556|         console.log(`   üì¶ –ú–µ—Å—Ç–æ ${index + 1}:`);\n03557|         console.log(`     - –ì–∞–±–∞—Ä–∏—Ç—ã: ${cargo.length}√ó${cargo.width}√ó${cargo.height} —Å–º`);\n03558|         console.log(`     - –í–µ—Å: ${cargo.weight} –∫–≥`);\n03559|         console.log(`     - –û–±—ä–µ–º: ${((cargo.length * cargo.width * cargo.height) / 1000000).toFixed(3)} –º¬≥`);\n03560|       });\n03561| \n03562|       if (form.cargos.length > 1) {\n03563|         console.log(`   üìê –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã: ${maxLength}√ó${maxWidth}√ó${maxHeight} —Å–º`);\n03564|       }\n03565| \n03566|       // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è –Ω–æ–≤–æ–≥–æ API NordWheel\n03567|       const requestData = {\n03568|         dispatch: {\n03569|           location: {\n03570|             type: 'terminal',\n03571|             terminal_id: '0c7a2795-1220-486d-a7ce-8bcf130a1224', // –ú–æ—Å–∫–≤–∞ terminal GUID\n03572|             city_fias: '0c5b2444-70a0-4932-980c-b4dc0d3f02b5' // –ú–æ—Å–∫–≤–∞ FIAS (—Ç—Ä–µ–±—É–µ—Ç—Å—è API, –Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - TODO: –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –≥–æ—Ä–æ–¥–æ–≤)\n03573|           }\n03574|         },\n03575|         destination: {\n03576|           location: {\n03577|             type: 'terminal',\n03578|             terminal_id: '3ca02b62-3632-4da0-8fde-de9d9c77c553', // –°–ü–± terminal GUID\n03579|             city_fias: 'c2deb16a-0330-4f05-821f-1d09c93331e6' // –°–ü–± FIAS (—Ç—Ä–µ–±—É–µ—Ç—Å—è API, –Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - TODO: –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –≥–æ—Ä–æ–¥–æ–≤)\n03580|           }\n03581|         },\n03582|         cargo: {\n03583|           total_weight: totalWeight,\n03584|           total_volume: totalVolume,\n03585|           total_quantity: form.cargos.length\n03586|         },\n03587|         insurance: form.needInsurance && form.declaredValue ? form.declaredValue : 0,\n03588|         insurance_refuse: !form.needInsurance,\n03589|         services: {\n03590|           is_package: form.needPackaging,\n03591|           is_documents_return: false,\n03592|           is_fragile: false\n03593|         },\n03594|         promocode: null\n03595|       };\n03596| \n03597|       console.log('üöõ Nord Wheel –Ω–æ–≤—ã–π API –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03598| \n03599|       const response = await fetch(apiUrl, {\n03600|         method: 'POST',\n03601|         headers: {\n03602|           'Content-Type': 'application/json',\n03603|           'Authorization': `Bearer ${process.env.NORDWHEEL_API_KEY}`\n03604|         },\n03605|         body: JSON.stringify(requestData)\n03606|       });\n03607| \n03608|       if (!response.ok) {\n03609|         console.error('‚ùå Nord Wheel API –æ—à–∏–±–∫–∞:', response.status, response.statusText);\n03610|         return {\n03611|           company: 'Nord Wheel',\n03612|           price: 0,\n03613|           days: 0,\n03614|           error: `–û—à–∏–±–∫–∞ API: ${response.status} ${response.statusText}`,\n03615|           apiUrl,\n03616|           requestData\n03617|         };\n03618|       }\n03619| \n03620|       const data = await response.json();\n03621|       console.log('üöõ Nord Wheel –Ω–æ–≤—ã–π API –æ—Ç–≤–µ—Ç:', data);\n03622| \n03623|       // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ –Ω–æ–≤–æ–≥–æ API\n03624|       if (data.success) {\n03625|         const price = data.price || 0;\n03626|         const days = data.days || 0;\n03627| \n03628|         return {\n03629|           company: 'Nord Wheel',\n03630|           price: Math.round(price),\n03631|           days: days,\n03632|           details: {\n03633|             totalCost: price,\n03634|             deliveryCost: data.delivery_cost || 0,\n03635|             pickupCost: data.pickup_cost || 0,\n03636|             insuranceCost: data.insurance_cost || 0,\n03637|             services: data.services || []\n03638|           },\n03639|           requestData,\n03640|           responseData: data,\n03641|           apiUrl\n03642|         };\n03643|       } else {\n03644|         return {\n03645|           company: 'Nord Wheel',\n03646|           price: 0,\n03647|           days: 0,\n03648|           error: data.message || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ Nord Wheel - –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö',\n03649|           requestData,\n03650|           responseData: data,\n03651|           apiUrl\n03652|         };\n03653|       }\n03654|     } catch (error: any) {\n03655|       console.error('üöõ Nord Wheel –æ—à–∏–±–∫–∞:', error);\n03656|       return {\n03657|         company: 'Nord Wheel',\n03658|         price: 0,\n03659|         days: 0,\n03660|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03661|         apiUrl\n03662|       };\n03663|     }\n03664|   };\n03665|     const calculateCdek = async (): Promise<CalculationResult> => {\n03666|     const apiUrl = '/api/cdek';\n03667|     \n03668|     try {\n03669|       validateMultipleCargos(form.cargos);\n03670|       \n03671|       const packages = form.cargos.map(cargo => ({\n03672|         height: cargo.height,\n03673|         length: cargo.length,\n03674|         width: cargo.width,\n03675|         weight: cargo.weight * 1000\n03676|       }));\n03677| \n03678|       const requestData: any = {\n03679|         from_city: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n03680|         to_city: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n03681|         packages: packages\n03682|       };\n03683| \n03684|       if (form.needInsurance && form.declaredValue > 0) {\n03685|         requestData.services = [{\n03686|           code: 'INSURANCE',\n03687|           parameter: form.declaredValue\n03688|         }];\n03689|         console.log('üì¶ CDEK: –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ', form.declaredValue);\n03690|       }\n03691| \n03692|       console.log('üì¶ CDEK –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03693|       console.log('üì¶ CDEK –º–∞—Ä—à—Ä—É—Ç:', {\n03694|         fromAddressDelivery: form.fromAddressDelivery,\n03695|         fromLavsiteWarehouse: form.fromLavsiteWarehouse,\n03696|         toAddressDelivery: form.toAddressDelivery\n03697|       });\n03698| \n03699|        const result = await enhancedApiRequest(\n03700|          apiUrl,\n03701|          {\n03702|            method: 'POST',\n03703|            headers: {\n03704|              'Content-Type': 'application/json',\n03705|            },\n03706|            body: JSON.stringify(requestData)\n03707|          },\n03708|          { operation: 'calculate', company: '–°–î–≠–ö' }\n03709|        );\n03710| \n03711|        if (result && typeof result === 'object' && 'success' in result && !result.success) {\n03712|          console.error('‚ùå –°–î–≠–ö API –æ—à–∏–±–∫–∞:', result.error);\n03713|          return {\n03714|            company: '–°–î–≠–ö',\n03715|            price: 0,\n03716|            days: 0,\n03717|            error: result.error.userMessage || result.error.message,\n03718|            requestData,\n03719|            responseData: null,\n03720|            apiUrl\n03721|          };\n03722|        }\n03723| \n03724|        const response = result as Response;\n03725|        const data = await response.json();\n03726|        console.log('üì¶ CDEK –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω, —Ç–∞—Ä–∏—Ñ–æ–≤:', data.tariff_codes?.length || 0);\n03727| \n03728|       if (response.ok && data.tariff_codes && data.tariff_codes.length > 0) {\n03729|         const isFromDoor = form.fromAddressDelivery || form.fromLavsiteWarehouse;\n03730|         const isToDoor = form.toAddressDelivery;\n03731|         \n03732|         let deliveryMode: number;\n03733|         let deliveryModeText: string;\n03734|         \n03735|         if (isFromDoor && isToDoor) {\n03736|           deliveryMode = 1;\n03737|           deliveryModeText = '–¥–≤–µ—Ä—å-–¥–≤–µ—Ä—å';\n03738|         } else if (isFromDoor && !isToDoor) {\n03739|           deliveryMode = 2;\n03740|           deliveryModeText = '–¥–≤–µ—Ä—å-—Å–∫–ª–∞–¥';\n03741|         } else if (!isFromDoor && isToDoor) {\n03742|           deliveryMode = 3;\n03743|           deliveryModeText = '—Å–∫–ª–∞–¥-–¥–≤–µ—Ä—å';\n03744|         } else {\n03745|           deliveryMode = 4;\n03746|           deliveryModeText = '—Å–∫–ª–∞–¥-—Å–∫–ª–∞–¥';\n03747|         }\n03748| \n03749|         console.log(`üì¶ CDEK –≤—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º –¥–æ—Å—Ç–∞–≤–∫–∏: ${deliveryMode} (${deliveryModeText})`);\n03750| \n03751|         const filteredTariffs = data.tariff_codes.filter((t: any) => t.delivery_mode === deliveryMode);\n03752|         \n03753|         console.log(`üì¶ CDEK –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è —Ä–µ–∂–∏–º–∞ ${deliveryModeText}:`, filteredTariffs.length);\n03754| \n03755|         if (filteredTariffs.length === 0) {\n03756|           return {\n03757|             company: '–°–î–≠–ö',\n03758|             price: 0,\n03759|             days: 0,\n03760|             error: `–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∞ ${deliveryModeText}`,\n03761|             requestData,\n03762|             responseData: data,\n03763|             apiUrl\n03764|           };\n03765|         }\n03766| \n03767|         const bestTariff = filteredTariffs.reduce((min: any, tariff: any) => \n03768|           (tariff.delivery_sum < min.delivery_sum) ? tariff : min\n03769|         );\n03770| \n03771|         console.log(`üì¶ CDEK –ª—É—á—à–∏–π —Ç–∞—Ä–∏—Ñ: ${bestTariff.tariff_name} - ${bestTariff.delivery_sum}‚ÇΩ`);\n03772| \n03773|         const detailsRequest: any = {\n03774|           ...requestData,\n03775|           tariff_code: bestTariff.tariff_code,\n03776|           get_details: true\n03777|         };\n03778| \n03779|         console.log('üì¶ CDEK: –∑–∞–ø—Ä–æ—Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏...');\n03780| \n03781|           const detailsResult = await enhancedApiRequest(\n03782|             apiUrl,\n03783|             {\n03784|               method: 'POST',\n03785|               headers: {\n03786|                 'Content-Type': 'application/json',\n03787|               },\n03788|               body: JSON.stringify(detailsRequest)\n03789|             },\n03790|             { operation: 'tariff_details', company: '–°–î–≠–ö' }\n03791|           );\n03792| \n03793|           let tariffDetails: any = null;\n03794|           if (detailsResult && typeof detailsResult === 'object' && 'success' in detailsResult && detailsResult.success) {\n03795|             const detailsResponse = detailsResult as Response;\n03796|             if (detailsResponse.ok) {\n03797|               const detailsData = await detailsResponse.json();\n03798|               tariffDetails = detailsData.tariff_details;\n03799|               console.log('üì¶ –°–î–≠–ö –¥–µ—Ç–∞–ª–∏ —Ç–∞—Ä–∏—Ñ–∞:', tariffDetails);\n03800|             }\n03801|           }\n03802| \n03803|         const finalPrice = tariffDetails?.total_sum || bestTariff.delivery_sum;\n03804|         \n03805|         return {\n03806|           company: '–°–î–≠–ö',\n03807|           price: Math.round(finalPrice),\n03808|           days: bestTariff.period_max || 0,\n03809|           details: {\n03810|             tariff_name: bestTariff.tariff_name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n03811|             tariff_code: bestTariff.tariff_code,\n03812|             delivery_mode: deliveryModeText,\n03813|             period_min: bestTariff.period_min,\n03814|             period_max: bestTariff.period_max,\n03815|             calendar_min: bestTariff.calendar_min,\n03816|             calendar_max: bestTariff.calendar_max,\n03817|             all_tariffs: filteredTariffs,\n03818|             services: tariffDetails?.services || [],\n03819|             delivery_sum: tariffDetails?.delivery_sum || bestTariff.delivery_sum,\n03820|             total_sum: finalPrice,\n03821|             weight_calc: tariffDetails?.weight_calc\n03822|           },\n03823|           requestData,\n03824|           responseData: data,\n03825|           apiUrl\n03826|         };\n03827|       } else {\n03828|         return {\n03829|           company: '–°–î–≠–ö',\n03830|           price: 0,\n03831|           days: 0,\n03832|           error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –°–î–≠–ö',\n03833|           requestData,\n03834|           responseData: data,\n03835|           apiUrl\n03836|         };\n03837|       }\n03838|     } catch (error: any) {\n03839|       console.error('üì¶ –°–î–≠–ö –æ—à–∏–±–∫–∞:', error);\n03840|       return {\n03841|         company: '–°–î–≠–ö',\n03842|         price: 0,\n03843|         days: 0,\n03844|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03845|         apiUrl\n03846|       };\n03847|     }\n03848|   };\n03849| \n03850|   const calculateKit = async (): Promise<CalculationResult> => {\n03851|     const apiUrl = '/api/kit';\n03852|     \n03853|     try {\n03854|       validateMultipleCargos(form.cargos);\n03855|       \n03856|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n03857| \n03858|       const requestData = {\n03859|         from_city: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n03860|         to_city: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n03861|         declared_price: form.declaredValue || 10000,\n03862|         service: ['S089']\n03863|       };\n03864| \n03865|       console.log('üöõ –ö–ò–¢ –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03866| \n03867|        const result = await enhancedApiRequest(\n03868|          apiUrl,\n03869|          {\n03870|            method: 'POST',\n03871|            headers: {\n03872|              'Content-Type': 'application/json',\n03873|            },\n03874|            body: JSON.stringify(requestData)\n03875|          },\n03876|          { operation: 'calculate', company: '–ö–ò–¢' }\n03877|        );\n03878| \n03879|        if (result && typeof result === 'object' && 'success' in result && !result.success) {\n03880|          console.error('‚ùå –ö–ò–¢ API –æ—à–∏–±–∫–∞:', result.error);\n03881|          return {\n03882|            company: '–ö–ò–¢',\n03883|            price: 0,\n03884|            days: 0,\n03885|            error: result.error.userMessage || result.error.message,\n03886|            requestData,\n03887|            responseData: null,\n03888|            apiUrl\n03889|          };\n03890|        }\n03891| \n03892|        const response = result as Response;\n03893|        const data = await response.json();\n03894|        console.log('üöõ –ö–ò–¢ –æ—Ç–≤–µ—Ç:', data);\n03895| \n03896|       if (response.ok && Array.isArray(data) && data.length > 0) {\n03897|         const rubData = data.find((item: any) => {\n03898|           const tariffData: any = Object.values(item)[0];\n03899|           return tariffData?.currency_code === 'RUB';\n03900|         });\n03901|         \n03902|         if (rubData) {\n03903|           const tariffKey = Object.keys(rubData)[0];\n03904|           const tariffData: any = rubData[tariffKey];\n03905|           \n03906|           console.log('üöõ –ö–ò–¢ –≤—ã–±—Ä–∞–Ω —Ç–∞—Ä–∏—Ñ:', tariffKey, tariffData);\n03907| \n03908|           return {\n03909|             company: '–ö–ò–¢',\n03910|             price: Math.round(tariffData.cost || 0),\n03911|             days: tariffData.time || 0,\n03912|             details: {\n03913|               tariff_name: tariffData.name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n03914|               tariff_type: tariffKey,\n03915|               services: tariffData.detail || [],\n03916|               currency: tariffData.currency_code\n03917|             },\n03918|             requestData,\n03919|             responseData: data,\n03920|             apiUrl\n03921|           };\n03922|         }\n03923|       }\n03924| \n03925|       return {\n03926|         company: '–ö–ò–¢',\n03927|         price: 0,\n03928|         days: 0,\n03929|         error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –ö–ò–¢',\n03930|         requestData,\n03931|         responseData: data,\n03932|         apiUrl\n03933|       };\n03934|     } catch (error: any) {\n03935|       console.error('üöõ –ö–ò–¢ –æ—à–∏–±–∫–∞:', error);\n03936|       return {\n03937|         company: '–ö–ò–¢',\n03938|         price: 0,\n03939|         days: 0,\n03940|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03941|         apiUrl\n03942|       };\n03943|     }\n03944|   };\n03945| \n03946|   const handleCalculate = async () => {\n03947|     setCalculating(true);\n03948|     setCalculations([]);\n03949|     \n03950|     // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø–æ—Å–ª–µ —Ä–∞—Å—á–µ—Ç–∞ (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ, –±–µ–∑ –¥–µ–±–∞—É–Ω—Å–∞)\n03951|     saveFormData({\n03952|       cargos: form.cargos,\n03953|       fromCity: form.fromCity,\n03954|       toCity: form.toCity,\n03955|       fromAddress: form.fromAddress,\n03956|       toAddress: form.toAddress,\n03957|       declaredValue: form.declaredValue,\n03958|       needPackaging: form.needPackaging,\n03959|       needLoading: form.needLoading,\n03960|       needCarry: form.needCarry,\n03961|       floor: form.floor,\n03962|       hasFreightLift: form.hasFreightLift,\n03963|       needInsurance: form.needInsurance,\n03964|       fromTerminal: form.fromTerminal,\n03965|       toTerminal: form.toTerminal,\n03966|       fromAddressDelivery: form.fromAddressDelivery,\n03967|       toAddressDelivery: form.toAddressDelivery,\n03968|       selectedProducts: form.selectedProducts,\n03969|     });\n03970|     \n03971|     try {\n03972|       // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ —Ñ—É–Ω–∫—Ü–∏–π —Ä–∞—Å—á–µ—Ç–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n03973|       const calculationFunctions: Promise<CalculationResult>[] = [];\n03974|       \n03975|       if (enabledCompanies.dellin) {\n03976|         calculationFunctions.push(calculateDellin());\n03977|       }\n03978|       if (enabledCompanies.pek) {\n03979|         calculationFunctions.push(calculatePEK());\n03980|       }\n03981|       if (enabledCompanies.nordwheel) {\n03982|         calculationFunctions.push(calculateNordWheel());\n03983|       }\n03984|       if (enabledCompanies.railcontinent) {\n03985|         calculationFunctions.push(calculateRailContinent());\n03986|       }\n03987|       if (enabledCompanies.vozovoz) {\n03988|         calculationFunctions.push(calculateVozovoz());\n03989|       }\n03990|       if (enabledCompanies.cdek) {\n03991|         calculationFunctions.push(calculateCdek());\n03992|       }\n03993|       if (enabledCompanies.kit) {\n03994|         calculationFunctions.push(calculateKit());\n03995|       }\n03996|       \n03997|       // –ï—Å–ª–∏ –Ω–∏ –æ–¥–Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞\n03998|       if (calculationFunctions.length === 0) {\n03999|         setCalculations([]);\n04000|         return;\n\n(File has more lines. Use 'offset' parameter to read beyond line 4000)\n</file>",
    "title": "app/page.tsx",
    "metadata": {
      "preview": "            data.data.packages.forEach((pkg: any, index: number) => {\n              console.log(`üí∞ Package [${index}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n            });\n          } else {\n            Object.entries(data.data.packages).forEach(([key, pkg]: [string, any]) => {\n              console.log(`üí∞ Package [${key}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n            });\n          }\n        } else {\n          console.log('üí∞ ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∞—Å—å');\n        }\n\n        // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–∞–∫ —Ä–∞–∑–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –¥–∞—Ç–∞–º–∏ pickup –∏ arrivalToOspReceiver\n        let deliveryDays = 0;\n        try {\n          console.log('=== –ü–û–ò–°–ö –î–ê–¢ –í –û–¢–í–ï–¢–ï ===');\n          \n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–µ—Å—Ç–∞ –≥–¥–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–∞—Ç—ã\n          console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.pickup:', data.data?.pickup);\n          console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.pickup:', data.pickup);"
    },
    "time": {
      "start": 1763945658504,
      "end": 1763945658509
    }
  }
}