{
  "id": "prt_b13c055f90011eK1khjinXDT9U",
  "sessionID": "ses_4ec3ff722ffeBPzPNwp55I8TOz",
  "messageID": "msg_b13c05109001SiJWjcI6DQ0XtS",
  "type": "tool",
  "callID": "call_78126028",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "app/api/vozovoz-parser-hybrid/route.ts",
      "limit": 150
    },
    "output": "<file>\n00001| import { NextRequest, NextResponse } from 'next/server';\n00002| \n00003| interface VozovozParserParams {\n00004|   fromCity: string;\n00005|   toCity: string;\n00006|   fromAddressDelivery: boolean;\n00007|   toAddressDelivery: boolean;\n00008|   fromAddress?: string;\n00009|   toAddress?: string;\n00010|   length: number;\n00011|   width: number;\n00012|   height: number;\n00013|   weight: number;\n00014|   needInsurance: boolean;\n00015|   declaredValue?: number;\n00016|   needPackaging: boolean;\n00017|   needLoading: boolean;\n00018|   hasFreightElevator: boolean;\n00019|   floor: number;\n00020| }\n00021| \n00022| interface ParsedResult {\n00023|   totalCost: number;\n00024|   services: ServiceItem[];\n00025|   deliveryTime?: string;\n00026|   warnings?: string[];\n00027|   parseTime?: number;\n00028| }\n00029| \n00030| interface ServiceItem {\n00031|   name: string;\n00032|   basePrice?: number;\n00033|   price: number;\n00034|   discount?: number;\n00035| }\n00036| \n00037| // –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–∞—Ä—Å–µ—Ä: API + —ç–º—É–ª—è—Ü–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è\n00038| async function parseVozovozHybrid(params: VozovozParserParams): Promise<ParsedResult> {\n00039|   const startTime = Date.now();\n00040|   \n00041|   try {\n00042|     console.log('üï∑Ô∏è –ó–∞–ø—É—Å–∫ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞ Vozovoz...');\n00043|     \n00044|     // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π API Vozovoz –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö\n00045|     const maxDimensions = {\n00046|       length: params.length / 1000, // –ø–µ—Ä–µ–≤–æ–¥–∏–º –º–º –≤ –º\n00047|       width: params.width / 1000,\n00048|       height: params.height / 1000,\n00049|       weight: params.weight\n00050|     };\n00051| \n00052|     // –≠–º—É–ª—è—Ü–∏—è –ª–æ–≥–∏–∫–∏ —Å–∞–π—Ç–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–±—ä–µ–º–∞\n00053|     const calculateVolume = (length: number, width: number, height: number) => {\n00054|       const rawVolume = (length * width * height) / 1000000; // —Å–º¬≥ ‚Üí –º¬≥\n00055|       // –°–∞–π—Ç –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä–µ–º 1 –º¬≥ –∏–ª–∏ –¥—Ä—É–≥–∏–µ –ø—Ä–∞–≤–∏–ª–∞\n00056|       return Math.max(rawVolume, 1.0); // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä–µ–º 1 –º¬≥\n00057|     };\n00058|     \n00059|     const totalVolume = calculateVolume(params.length, params.width, params.height);\n00060|     const totalWeight = params.weight;\n00061| \n00062|     const requestData = {\n00063|       object: \"price\",\n00064|       action: \"get\",\n00065|       params: {\n00066|         cargo: {\n00067|           dimension: {\n00068|             max: maxDimensions,\n00069|             quantity: 1,\n00070|             volume: totalVolume,\n00071|             weight: totalWeight\n00072|           },\n00073|           ...(params.needInsurance && params.declaredValue && params.declaredValue > 0 ? {\n00074|             insurance: params.declaredValue,\n00075|             insuranceNdv: false\n00076|           } : {\n00077|             insuranceNdv: true\n00078|           }),\n00079|           ...(params.needPackaging ? {\n00080|             wrapping: {\n00081|               \"hardPackageVolume\": totalVolume\n00082|             }\n00083|           } : {})\n00084|         },\n00085|         gateway: {\n00086|           dispatch: {\n00087|             point: {\n00088|               location: params.fromCity,\n00089|               ...(params.fromAddressDelivery ? {\n00090|                 address: params.fromAddress || \"–∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\"\n00091|               } : {\n00092|                 terminal: \"default\"\n00093|               })\n00094|             }\n00095|           },\n00096|           destination: {\n00097|             point: {\n00098|               location: params.toCity,\n00099|               ...(params.toAddressDelivery ? {\n00100|                 address: params.toAddress || \"–∞–¥—Ä–µ—Å –ø–æ–ª—É—á–µ–Ω–∏—è\"\n00101|               } : {\n00102|                 terminal: \"default\"\n00103|               })\n00104|             }\n00105|           }\n00106|         }\n00107|       }\n00108|     };\n00109| \n00110|     console.log('üîå –ó–∞–ø—Ä–æ—Å –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É API Vozovoz...');\n00111|     \n00112|     // –ó–∞–ø—Ä–æ—Å –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É API Vozovoz\n00113|     const apiResponse = await fetch('https://vozovoz.ru/api/?token=sBDUaEmzVBO6syQWHvHxmjxJQiON2BZplQaqrU3N', {\n00114|       method: 'POST',\n00115|       headers: {\n00116|         'Content-Type': 'application/json',\n00117|         'Accept': 'application/json',\n00118|         'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'\n00119|       },\n00120|       body: JSON.stringify(requestData)\n00121|     });\n00122| \n00123|     if (!apiResponse.ok) {\n00124|       throw new Error(`API –æ—à–∏–±–∫–∞: ${apiResponse.status} ${apiResponse.statusText}`);\n00125|     }\n00126| \n00127|     const data = await apiResponse.json();\n00128|     console.log('üì• –û—Ç–≤–µ—Ç –æ—Ç API Vozovoz:', JSON.stringify(data, null, 2));\n00129| \n00130|     if (data.error) {\n00131|       throw new Error(`API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É: ${data.error.message || data.error}`);\n00132|     }\n00133| \n00134|     if (!data.response) {\n00135|       throw new Error('API –Ω–µ –≤–µ—Ä–Ω—É–ª –¥–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–∞');\n00136|     }\n00137| \n00138|     const responseData = data.response;\n00139|     \n00140|     // –≠–º—É–ª–∏—Ä—É–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∞–π—Ç–∞ —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π\n00141|     console.log('üé≠ –≠–º—É–ª—è—Ü–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è —Å–∞–π—Ç–∞ —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π...');\n00142|     \n00143|     const services: ServiceItem[] = [];\n00144|     let totalPrice = responseData.price || responseData.basePrice || 0;\n00145|     \n00146|     // –í—ã—á–∏—Å–ª—è–µ–º –æ–±—ä–µ–º –∫–∞–∫ –Ω–∞ —Å–∞–π—Ç–µ (—Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –ø–æ—Ä–æ–≥–æ–º)\n00147|     const siteVolume = Math.max((params.length * params.width * params.height) / 1000000, 1.0);\n00148|     console.log('üì¶ –û–±—ä–µ–º –∫–∞–∫ –Ω–∞ —Å–∞–π—Ç–µ:', siteVolume, '–º¬≥');\n00149|     \n00150|     // –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —ç–º—É–ª—è—Ü–∏—é —Å–∞–π—Ç–∞ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è\n\n(File has more lines. Use 'offset' parameter to read beyond line 150)\n</file>",
    "title": "app/api/vozovoz-parser-hybrid/route.ts",
    "metadata": {
      "preview": "import { NextRequest, NextResponse } from 'next/server';\n\ninterface VozovozParserParams {\n  fromCity: string;\n  toCity: string;\n  fromAddressDelivery: boolean;\n  toAddressDelivery: boolean;\n  fromAddress?: string;\n  toAddress?: string;\n  length: number;\n  width: number;\n  height: number;\n  weight: number;\n  needInsurance: boolean;\n  declaredValue?: number;\n  needPackaging: boolean;\n  needLoading: boolean;\n  hasFreightElevator: boolean;\n  floor: number;\n}"
    },
    "time": {
      "start": 1765562930687,
      "end": 1765562930695
    }
  }
}