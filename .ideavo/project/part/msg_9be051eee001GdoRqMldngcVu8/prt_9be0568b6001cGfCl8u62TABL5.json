{
  "id": "prt_9be0568b6001cGfCl8u62TABL5",
  "messageID": "msg_9be051eee001GdoRqMldngcVu8",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "write",
  "callID": "toolu_012WFLAeuxQRngCWbAAQxKWn",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/components/diagnostic/ManualTesting.tsx",
      "content": "'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Collapsible, CollapsibleTrigger, CollapsibleContent } from '@/components/ui/collapsible';\nimport { ChevronDown, ChevronRight, Save, RotateCcw, CheckCircle, XCircle, AlertCircle } from 'lucide-react';\n\n// Test case structure\ninterface TestCase {\n  id: string;\n  name: string;\n  description: string;\n  category: string;\n  priority: 'high' | 'medium' | 'low';\n  expectedResult: string;\n  testData: {\n    fromCity: string;\n    toCity: string;\n    fromAddress?: string;\n    toAddress?: string;\n    fromTerminal?: boolean;\n    toTerminal?: boolean;\n    cargo: {\n      length: number;\n      width: number;\n      height: number;\n      weight: number;\n    }[];\n    packaging?: boolean;\n    insurance?: boolean;\n    loading?: boolean;\n    lifting?: boolean;\n  };\n}\n\ninterface TestResult {\n  id: string;\n  status: 'passed' | 'failed' | 'pending';\n  ourPrice?: number;\n  officialPrice?: number;\n  difference?: number;\n  notes?: string;\n  testedAt?: string;\n  testerName?: string;\n}\n\n// Transport companies\nconst transportCompanies = [\n  { id: 'pek', name: 'ПЭК', officialSite: 'https://pecom.ru/calc/' },\n  { id: 'dellin', name: 'Деловые Линии', officialSite: 'https://www.dellin.ru/calculator/' },\n  { id: 'railcontinent', name: 'Rail Continent', officialSite: 'https://railcont.ru/calc/' },\n  { id: 'vozovoz', name: 'Возовоз', officialSite: 'https://vozovoz.ru/calculator/' },\n];\n\n// Test cases for each company\nconst generateTestCases = (companyId: string): TestCase[] => [\n  // Terminal to Terminal tests\n  {\n    id: `${companyId}_t2t_single`,\n    name: 'Терминал → Терминал (1 место)',\n    description: 'Доставка одного места стандартного размера от терминала до терминала',\n    category: 'terminal_to_terminal',\n    priority: 'high',\n    expectedResult: 'Расчет должен совпадать с официальным сайтом ±100₽',\n    testData: {\n      fromCity: 'Москва',\n      toCity: 'Санкт-Петербург',\n      fromTerminal: true,\n      toTerminal: true,\n      cargo: [{ length: 120, width: 80, height: 100, weight: 50 }]\n    }\n  },\n  {\n    id: `${companyId}_t2t_multi`,\n    name: 'Терминал → Терминал (3 места)',\n    description: 'Доставка нескольких мест разного размера',\n    category: 'terminal_to_terminal',\n    priority: 'high',\n    expectedResult: 'Расчет должен совпадать с официальным сайтом ±100₽',\n    testData: {\n      fromCity: 'Москва',\n      toCity: 'Екатеринбург',\n      fromTerminal: true,\n      toTerminal: true,\n      cargo: [\n        { length: 120, width: 80, height: 100, weight: 50 },\n        { length: 60, width: 40, height: 30, weight: 15 },\n        { length: 200, width: 100, height: 150, weight: 80 }\n      ]\n    }\n  },\n  {\n    id: `${companyId}_t2t_oversized`,\n    name: 'Терминал → Терминал (негабарит 250см)',\n    description: 'Доставка негабаритного груза с одной стороной 250см',\n    category: 'terminal_to_terminal',\n    priority: 'high',\n    expectedResult: 'Расчет должен включать доплату за негабарит',\n    testData: {\n      fromCity: 'Москва',\n      toCity: 'Новосибирск',\n      fromTerminal: true,\n      toTerminal: true,\n      cargo: [{ length: 250, width: 120, height: 100, weight: 200 }]\n    }\n  },\n  \n  // Terminal to Address tests\n  {\n    id: `${companyId}_t2a_single`,\n    name: 'Терминал → Адрес (1 место)',\n    description: 'Доставка от терминала до адреса получателя',\n    category: 'terminal_to_address',\n    priority: 'high',\n    expectedResult: 'Расчет должен включать доставку до адреса',\n    testData: {\n      fromCity: 'Москва',\n      toCity: 'Казань',\n      toAddress: 'ул. Баумана, 58',\n      fromTerminal: true,\n      toTerminal: false,\n      cargo: [{ length: 100, width: 70, height: 80, weight: 35 }]\n    }\n  },\n  {\n    id: `${companyId}_t2a_lifting`,\n    name: 'Терминал → Адрес + подъем',\n    description: 'Доставка с подъемом на этаж',\n    category: 'terminal_to_address',\n    priority: 'medium',\n    expectedResult: 'Расчет должен включать стоимость подъема',\n    testData: {\n      fromCity: 'Санкт-Петербург',\n      toCity: 'Москва',\n      toAddress: 'ул. Тверская, 1, кв. 15, 3 этаж',\n      fromTerminal: true,\n      toTerminal: false,\n      lifting: true,\n      cargo: [{ length: 150, width: 100, height: 120, weight: 75 }]\n    }\n  },\n\n  // Address to Terminal tests  \n  {\n    id: `${companyId}_a2t_single`,\n    name: 'Адрес → Терминал (1 место)',\n    description: 'Забор груза с адреса до терминала',\n    category: 'address_to_terminal',\n    priority: 'high',\n    expectedResult: 'Расчет должен включать забор с адреса',\n    testData: {\n      fromCity: 'Москва',\n      fromAddress: 'ул. Арбат, 25',\n      toCity: 'Уфа',\n      fromTerminal: false,\n      toTerminal: true,\n      cargo: [{ length: 90, width: 60, height: 70, weight: 25 }]\n    }\n  },\n  {\n    id: `${companyId}_a2t_loading`,\n    name: 'Адрес → Терминал + погрузка',\n    description: 'Забор с адреса с услугой погрузки',\n    category: 'address_to_terminal',\n    priority: 'medium',\n    expectedResult: 'Расчет должен включать стоимость погрузки',\n    testData: {\n      fromCity: 'Екатеринбург',\n      fromAddress: 'ул. Ленина, 10',\n      toCity: 'Челябинск',\n      fromTerminal: false,\n      toTerminal: true,\n      loading: true,\n      cargo: [{ length: 180, width: 120, height: 100, weight: 150 }]\n    }\n  },\n\n  // Address to Address tests\n  {\n    id: `${companyId}_a2a_single`,\n    name: 'Адрес → Адрес (1 место)',\n    description: 'Доставка от адреса до адреса',\n    category: 'address_to_address',\n    priority: 'high',\n    expectedResult: 'Расчет должен включать забор и доставку',\n    testData: {\n      fromCity: 'Москва',\n      fromAddress: 'ул. Садовая, 15',\n      toCity: 'Воронеж',\n      toAddress: 'ул. Революции, 25',\n      fromTerminal: false,\n      toTerminal: false,\n      cargo: [{ length: 110, width: 80, height: 90, weight: 45 }]\n    }\n  },\n  {\n    id: `${companyId}_a2a_full_service`,\n    name: 'Адрес → Адрес (полный сервис)',\n    description: 'Доставка с упаковкой, страховкой, погрузкой и подъемом',\n    category: 'address_to_address',\n    priority: 'medium',\n    expectedResult: 'Расчет должен включать все дополнительные услуги',\n    testData: {\n      fromCity: 'Санкт-Петербург',\n      fromAddress: 'Невский пр., 100',\n      toCity: 'Краснодар',\n      toAddress: 'ул. Красная, 50, 5 этаж',\n      fromTerminal: false,\n      toTerminal: false,\n      packaging: true,\n      insurance: true,\n      loading: true,\n      lifting: true,\n      cargo: [{ length: 160, width: 90, height: 110, weight: 85 }]\n    }\n  },\n\n  // Package and insurance tests\n  {\n    id: `${companyId}_packaging_test`,\n    name: 'Тест упаковки',\n    description: 'Сравнение расчета с упаковкой и без',\n    category: 'packaging',\n    priority: 'medium',\n    expectedResult: 'Разница должна соответствовать стоимости упаковки',\n    testData: {\n      fromCity: 'Москва',\n      toCity: 'Нижний Новгород',\n      fromTerminal: true,\n      toTerminal: true,\n      packaging: true,\n      cargo: [{ length: 100, width: 80, height: 60, weight: 30 }]\n    }\n  },\n  {\n    id: `${companyId}_insurance_test`,\n    name: 'Тест страхования',\n    description: 'Сравнение расчета со страхованием и без',\n    category: 'insurance',\n    priority: 'medium',\n    expectedResult: 'Разница должна составлять % от объявленной стоимости',\n    testData: {\n      fromCity: 'Москва',\n      toCity: 'Самара',\n      fromTerminal: true,\n      toTerminal: true,\n      insurance: true,\n      cargo: [{ length: 120, width: 100, height: 80, weight: 60 }]\n    }\n  },\n\n  // Heavy cargo test\n  {\n    id: `${companyId}_heavy_cargo`,\n    name: 'Тяжелый груз (500кг)',\n    description: 'Доставка тяжелого груза',\n    category: 'heavy_cargo',\n    priority: 'low',\n    expectedResult: 'Должен быть расчет по весу или объему в зависимости от коэффициента',\n    testData: {\n      fromCity: 'Москва',\n      toCity: 'Ростов-на-Дону',\n      fromTerminal: true,\n      toTerminal: true,\n      cargo: [{ length: 200, width: 120, height: 100, weight: 500 }]\n    }\n  }\n];\n\nexport default function ManualTesting() {\n  const [selectedCompany, setSelectedCompany] = useState<string>('pek');\n  const [testResults, setTestResults] = useState<Record<string, TestResult>>({});\n  const [openCategories, setOpenCategories] = useState<Set<string>>(new Set(['terminal_to_terminal']));\n  const [testerName, setTesterName] = useState<string>('');\n\n  // Load saved test results and tester name\n  useEffect(() => {\n    const savedResults = localStorage.getItem('manualTestResults');\n    if (savedResults) {\n      try {\n        setTestResults(JSON.parse(savedResults));\n      } catch (error) {\n        console.error('Error loading test results:', error);\n      }\n    }\n\n    const savedTester = localStorage.getItem('testerName');\n    if (savedTester) {\n      setTesterName(savedTester);\n    }\n  }, []);\n\n  // Save test results to localStorage\n  const saveTestResults = () => {\n    localStorage.setItem('manualTestResults', JSON.stringify(testResults));\n    localStorage.setItem('testerName', testerName);\n  };\n\n  // Update test result\n  const updateTestResult = (testId: string, updates: Partial<TestResult>) => {\n    setTestResults(prev => ({\n      ...prev,\n      [testId]: {\n        ...prev[testId],\n        id: testId,\n        ...updates,\n        testedAt: new Date().toLocaleString('ru-RU'),\n        testerName: testerName\n      }\n    }));\n  };\n\n  // Toggle category collapse\n  const toggleCategory = (category: string) => {\n    setOpenCategories(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(category)) {\n        newSet.delete(category);\n      } else {\n        newSet.add(category);\n      }\n      return newSet;\n    });\n  };\n\n  // Get test cases for selected company\n  const testCases = generateTestCases(selectedCompany);\n  \n  // Group test cases by category\n  const categorizedTests = testCases.reduce((acc, test) => {\n    if (!acc[test.category]) acc[test.category] = [];\n    acc[test.category].push(test);\n    return acc;\n  }, {} as Record<string, TestCase[]>);\n\n  // Category names for display\n  const categoryNames = {\n    terminal_to_terminal: 'Терминал → Терминал',\n    terminal_to_address: 'Терминал → Адрес',\n    address_to_terminal: 'Адрес → Терминал',\n    address_to_address: 'Адрес → Адрес',\n    packaging: 'Упаковка',\n    insurance: 'Страхование',\n    heavy_cargo: 'Тяжелые грузы'\n  };\n\n  // Calculate statistics\n  const stats = {\n    total: testCases.length,\n    passed: Object.values(testResults).filter(r => r.status === 'passed').length,\n    failed: Object.values(testResults).filter(r => r.status === 'failed').length,\n    pending: testCases.length - Object.values(testResults).filter(r => r.status !== 'pending').length\n  };\n\n  const currentCompany = transportCompanies.find(c => c.id === selectedCompany);\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <CheckCircle className=\"h-5 w-5\" />\n            Ручное тестирование 2.0 - Проверка точности расчетов\n          </CardTitle>\n          <div className=\"text-sm text-gray-600\">\n            Сравнение расчетов нашего приложения с официальными сайтами ТК (точность ±100₽)\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            {/* Tester name input */}\n            <div className=\"flex items-center gap-4\">\n              <label className=\"text-sm font-medium\">Тестировщик:</label>\n              <Input\n                value={testerName}\n                onChange={(e) => setTesterName(e.target.value)}\n                placeholder=\"Введите ваше имя\"\n                className=\"max-w-xs\"\n              />\n              <Button onClick={saveTestResults} variant=\"outline\" size=\"sm\">\n                <Save className=\"h-4 w-4 mr-1\" />\n                Сохранить\n              </Button>\n            </div>\n\n            {/* Company selector */}\n            <div className=\"flex items-center gap-4\">\n              <label className=\"text-sm font-medium\">Транспортная компания:</label>\n              <div className=\"flex gap-2\">\n                {transportCompanies.map(company => (\n                  <Button\n                    key={company.id}\n                    variant={selectedCompany === company.id ? 'default' : 'outline'}\n                    size=\"sm\"\n                    onClick={() => setSelectedCompany(company.id)}\n                  >\n                    {company.name}\n                  </Button>\n                ))}\n              </div>\n            </div>\n\n            {/* Statistics */}\n            <div className=\"flex gap-4 p-4 bg-gray-50 rounded-lg\">\n              <div className=\"flex items-center gap-2\">\n                <Badge variant=\"secondary\">Всего: {stats.total}</Badge>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Badge variant=\"default\" className=\"bg-green-600\">\n                  <CheckCircle className=\"h-3 w-3 mr-1\" />\n                  Пройдено: {stats.passed}\n                </Badge>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Badge variant=\"destructive\">\n                  <XCircle className=\"h-3 w-3 mr-1\" />\n                  Провалено: {stats.failed}\n                </Badge>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Badge variant=\"outline\">\n                  <AlertCircle className=\"h-3 w-3 mr-1\" />\n                  Ожидают: {stats.pending}\n                </Badge>\n              </div>\n            </div>\n\n            {/* Official site link */}\n            {currentCompany && (\n              <div className=\"p-3 border border-blue-200 bg-blue-50 rounded-lg\">\n                <div className=\"text-sm\">\n                  <strong>Официальный калькулятор {currentCompany.name}:</strong>\n                  <a\n                    href={currentCompany.officialSite}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"ml-2 text-blue-600 hover:underline\"\n                  >\n                    {currentCompany.officialSite}\n                  </a>\n                </div>\n              </div>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Test cases by category */}\n      {Object.entries(categorizedTests).map(([category, tests]) => (\n        <Card key={category}>\n          <Collapsible \n            open={openCategories.has(category)}\n            onOpenChange={() => toggleCategory(category)}\n          >\n            <CollapsibleTrigger asChild>\n              <CardHeader className=\"cursor-pointer hover:bg-gray-50 transition-colors\">\n                <CardTitle className=\"flex items-center justify-between\">\n                  <span className=\"flex items-center gap-2\">\n                    {openCategories.has(category) ? \n                      <ChevronDown className=\"h-4 w-4\" /> : \n                      <ChevronRight className=\"h-4 w-4\" />\n                    }\n                    {categoryNames[category as keyof typeof categoryNames]} ({tests.length})\n                  </span>\n                  <div className=\"flex gap-1\">\n                    {tests.map(test => {\n                      const result = testResults[test.id];\n                      const status = result?.status || 'pending';\n                      return (\n                        <div\n                          key={test.id}\n                          className={`w-3 h-3 rounded-full ${\n                            status === 'passed' ? 'bg-green-500' :\n                            status === 'failed' ? 'bg-red-500' : 'bg-gray-300'\n                          }`}\n                        />\n                      );\n                    })}\n                  </div>\n                </CardTitle>\n              </CardHeader>\n            </CollapsibleTrigger>\n\n            <CollapsibleContent>\n              <CardContent className=\"space-y-4\">\n                {tests.map(test => (\n                  <TestCaseComponent\n                    key={test.id}\n                    test={test}\n                    result={testResults[test.id]}\n                    onUpdateResult={(updates) => updateTestResult(test.id, updates)}\n                    companyName={currentCompany?.name || ''}\n                  />\n                ))}\n              </CardContent>\n            </CollapsibleContent>\n          </Collapsible>\n        </Card>\n      ))}\n\n      {/* Reset button */}\n      <div className=\"flex justify-center\">\n        <Button\n          variant=\"outline\"\n          onClick={() => {\n            if (confirm('Вы уверены, что хотите сбросить все результаты тестов?')) {\n              setTestResults({});\n              localStorage.removeItem('manualTestResults');\n            }\n          }}\n        >\n          <RotateCcw className=\"h-4 w-4 mr-2\" />\n          Сбросить все результаты\n        </Button>\n      </div>\n    </div>\n  );\n}\n\n// Individual test case component\nfunction TestCaseComponent({ \n  test, \n  result, \n  onUpdateResult, \n  companyName \n}: { \n  test: TestCase;\n  result?: TestResult;\n  onUpdateResult: (updates: Partial<TestResult>) => void;\n  companyName: string;\n}) {\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  const getPriorityColor = (priority: string) => {\n    switch (priority) {\n      case 'high': return 'bg-red-100 text-red-800';\n      case 'medium': return 'bg-yellow-100 text-yellow-800';\n      case 'low': return 'bg-blue-100 text-blue-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const formatCargoData = (cargo: any[]) => {\n    return cargo.map((item, index) => \n      `Место ${index + 1}: ${item.length}×${item.width}×${item.height}см, ${item.weight}кг`\n    ).join('; ');\n  };\n\n  const difference = result?.ourPrice && result?.officialPrice ? \n    Math.abs(result.ourPrice - result.officialPrice) : null;\n  \n  const isWithinTolerance = difference !== null ? difference <= 100 : null;\n\n  return (\n    <div className=\"border border-gray-200 rounded-lg p-4\">\n      <div className=\"flex items-start justify-between\">\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <h4 className=\"font-medium\">{test.name}</h4>\n            <Badge className={getPriorityColor(test.priority)} variant=\"secondary\">\n              {test.priority}\n            </Badge>\n            {result && (\n              <Badge \n                variant={result.status === 'passed' ? 'default' : \n                        result.status === 'failed' ? 'destructive' : 'secondary'}\n                className={result.status === 'passed' ? 'bg-green-600' : ''}\n              >\n                {result.status === 'passed' ? 'Пройден' :\n                 result.status === 'failed' ? 'Провален' : 'Ожидает'}\n              </Badge>\n            )}\n          </div>\n          <p className=\"text-sm text-gray-600 mb-2\">{test.description}</p>\n          \n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setIsExpanded(!isExpanded)}\n            className=\"text-xs\"\n          >\n            {isExpanded ? <ChevronDown className=\"h-3 w-3 mr-1\" /> : <ChevronRight className=\"h-3 w-3 mr-1\" />}\n            {isExpanded ? 'Скрыть детали' : 'Показать детали'}\n          </Button>\n\n          {isExpanded && (\n            <div className=\"mt-3 p-3 bg-gray-50 rounded text-xs space-y-1\">\n              <p><strong>Маршрут:</strong> {test.testData.fromCity} → {test.testData.toCity}</p>\n              <p><strong>Тип доставки:</strong> \n                {test.testData.fromTerminal ? 'Терминал' : `Адрес (${test.testData.fromAddress})`} → \n                {test.testData.toTerminal ? 'Терминал' : `Адрес (${test.testData.toAddress})`}\n              </p>\n              <p><strong>Груз:</strong> {formatCargoData(test.testData.cargo)}</p>\n              {(test.testData.packaging || test.testData.insurance || test.testData.loading || test.testData.lifting) && (\n                <p><strong>Доп. услуги:</strong> {[\n                  test.testData.packaging && 'Упаковка',\n                  test.testData.insurance && 'Страхование', \n                  test.testData.loading && 'Погрузка',\n                  test.testData.lifting && 'Подъем'\n                ].filter(Boolean).join(', ')}</p>\n              )}\n              <p><strong>Ожидаемый результат:</strong> {test.expectedResult}</p>\n            </div>\n          )}\n        </div>\n\n        <div className=\"ml-4 space-y-2 min-w-[300px]\">\n          <div className=\"flex items-center gap-2\">\n            <Checkbox\n              checked={result?.status === 'passed'}\n              onCheckedChange={(checked) => \n                onUpdateResult({ status: checked ? 'passed' : 'failed' })\n              }\n            />\n            <span className=\"text-sm\">Тест пройден</span>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-2 text-xs\">\n            <div>\n              <label className=\"block text-gray-600\">Наш расчет:</label>\n              <Input\n                type=\"number\"\n                value={result?.ourPrice || ''}\n                onChange={(e) => onUpdateResult({ ourPrice: Number(e.target.value) })}\n                placeholder=\"₽\"\n                className=\"h-7\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-gray-600\">Офиц. сайт:</label>\n              <Input\n                type=\"number\" \n                value={result?.officialPrice || ''}\n                onChange={(e) => onUpdateResult({ officialPrice: Number(e.target.value) })}\n                placeholder=\"₽\"\n                className=\"h-7\"\n              />\n            </div>\n          </div>\n\n          {difference !== null && (\n            <div className={`text-xs p-2 rounded ${isWithinTolerance ? 'bg-green-50 text-green-700' : 'bg-red-50 text-red-700'}`}>\n              Разница: {difference}₽ {isWithinTolerance ? '(в пределах нормы)' : '(превышает 100₽)'}\n            </div>\n          )}\n\n          <Textarea\n            value={result?.notes || ''}\n            onChange={(e) => onUpdateResult({ notes: e.target.value })}\n            placeholder=\"Комментарии и заметки...\"\n            className=\"text-xs h-16\"\n          />\n\n          {result?.testedAt && (\n            <div className=\"text-xs text-gray-500\">\n              Проверено: {result.testedAt}\n              {result.testerName && ` (${result.testerName})`}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}"
    },
    "output": "",
    "metadata": {
      "diagnostics": {},
      "filepath": "/home/user/project/components/diagnostic/ManualTesting.tsx",
      "exists": false
    },
    "title": "components/diagnostic/ManualTesting.tsx",
    "time": {
      "start": 1759829731853,
      "end": 1759829731855
    }
  }
}