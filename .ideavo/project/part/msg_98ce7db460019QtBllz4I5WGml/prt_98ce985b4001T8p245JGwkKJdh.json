{
  "id": "prt_98ce985b4001T8p245JGwkKJdh",
  "messageID": "msg_98ce7db460019QtBllz4I5WGml",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "edit",
  "callID": "toolu_019hukky7furpfDu5bvGKFFQ",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx",
      "oldString": "  // Автоматическая страховка при указании стоимости\n  useEffect(() => {\n    if (form.declaredValue > 0) {\n      setForm(prev => ({ ...prev, needInsurance: true }));\n    }\n  }, [form.declaredValue]);",
      "newString": "  // Автоматическая страховка при указании стоимости\n  useEffect(() => {\n    if (form.declaredValue > 0) {\n      setForm(prev => ({ ...prev, needInsurance: true }));\n    }\n  }, [form.declaredValue]);\n\n  // Проверка статуса API при загрузке страницы\n  useEffect(() => {\n    if (typeof window !== 'undefined' && isLoaded) {\n      checkAllAPIStatus();\n    }\n  }, [isLoaded]);\n\n  const checkAPIStatus = async (apiName: string, testFunction: () => Promise<any>) => {\n    try {\n      const result = await testFunction();\n      if (result && !result.error) {\n        setApiStatus(prev => ({ ...prev, [apiName]: 'подключено' }));\n      } else {\n        setApiStatus(prev => ({ ...prev, [apiName]: 'ошибка' }));\n      }\n    } catch (error) {\n      setApiStatus(prev => ({ ...prev, [apiName]: 'ошибка' }));\n    }\n  };\n\n  const checkAllAPIStatus = async () => {\n    // Тестовые данные для проверки\n    const testData = {\n      fromCity: 'Москва',\n      toCity: 'Санкт-Петербург', \n      cargos: [{ length: 100, width: 100, height: 100, weight: 10 }],\n      declaredValue: 50000,\n      fromAddressDelivery: false,\n      toAddressDelivery: false,\n      needPackaging: false,\n      needInsurance: false\n    };\n\n    // Сохраняем текущее состояние формы\n    const currentForm = form;\n    \n    // Временно устанавливаем тестовые данные\n    setForm({\n      ...form,\n      fromCity: testData.fromCity,\n      toCity: testData.toCity,\n      cargos: testData.cargos,\n      declaredValue: testData.declaredValue,\n      fromAddressDelivery: testData.fromAddressDelivery,\n      toAddressDelivery: testData.toAddressDelivery,\n      needPackaging: testData.needPackaging,\n      needInsurance: testData.needInsurance\n    });\n\n    // Запускаем проверки параллельно\n    Promise.all([\n      checkAPIStatus('pek', async () => {\n        try {\n          const response = await fetch('/api/pek', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(testData)\n          });\n          return await response.json();\n        } catch (error) {\n          return { error: true };\n        }\n      }),\n      \n      checkAPIStatus('dellin', async () => {\n        try {\n          const response = await fetch('/api/dellin-packages', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(testData)\n          });\n          return await response.json();\n        } catch (error) {\n          return { error: true };\n        }\n      }),\n      \n      checkAPIStatus('railcontinent', async () => {\n        try {\n          const response = await fetch('/api/rail-continent', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              city_sender: testData.fromCity,\n              city_receiver: testData.toCity,\n              weight: 10,\n              volume: 0.1,\n              length: 1,\n              width: 1,\n              height: 1,\n              declared_cost: testData.declaredValue,\n              pickup: '0',\n              delivery: '0',\n              packaging: '0',\n              insurance: '0',\n              tariff: 'auto'\n            })\n          });\n          return await response.json();\n        } catch (error) {\n          return { error: true };\n        }\n      }),\n      \n      checkAPIStatus('vozovoz', async () => {\n        try {\n          const response = await fetch('/api/vozovoz', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              object: \"price\",\n              action: \"get\",\n              params: {\n                cargo: {\n                  dimension: {\n                    quantity: 1,\n                    volume: 0.1,\n                    weight: 10\n                  }\n                },\n                gateway: {\n                  dispatch: {\n                    point: {\n                      location: testData.fromCity,\n                      terminal: \"default\"\n                    }\n                  },\n                  destination: {\n                    point: {\n                      location: testData.toCity,\n                      terminal: \"default\"\n                    }\n                  }\n                }\n              }\n            })\n          });\n          return await response.json();\n        } catch (error) {\n          return { error: true };\n        }\n      })\n    ]).finally(() => {\n      // Восстанавливаем исходное состояние формы\n      setForm(currentForm);\n    });\n  };"
    },
    "output": "",
    "metadata": {
      "diagnostics": {},
      "diff": "Index: /home/user/project/app/page.tsx\n===================================================================\n--- /home/user/project/app/page.tsx\n+++ /home/user/project/app/page.tsx\n@@ -154,8 +154,156 @@\n     setForm(prev => ({ ...prev, needInsurance: true }));\n   }\n }, [form.declaredValue]);\n \n+// Проверка статуса API при загрузке страницы\n+useEffect(() => {\n+  if (typeof window !== 'undefined' && isLoaded) {\n+    checkAllAPIStatus();\n+  }\n+}, [isLoaded]);\n+\n+const checkAPIStatus = async (apiName: string, testFunction: () => Promise<any>) => {\n+  try {\n+    const result = await testFunction();\n+    if (result && !result.error) {\n+      setApiStatus(prev => ({ ...prev, [apiName]: 'подключено' }));\n+    } else {\n+      setApiStatus(prev => ({ ...prev, [apiName]: 'ошибка' }));\n+    }\n+  } catch (error) {\n+    setApiStatus(prev => ({ ...prev, [apiName]: 'ошибка' }));\n+  }\n+};\n+\n+const checkAllAPIStatus = async () => {\n+  // Тестовые данные для проверки\n+  const testData = {\n+    fromCity: 'Москва',\n+    toCity: 'Санкт-Петербург', \n+    cargos: [{ length: 100, width: 100, height: 100, weight: 10 }],\n+    declaredValue: 50000,\n+    fromAddressDelivery: false,\n+    toAddressDelivery: false,\n+    needPackaging: false,\n+    needInsurance: false\n+  };\n+\n+  // Сохраняем текущее состояние формы\n+  const currentForm = form;\n+  \n+  // Временно устанавливаем тестовые данные\n+  setForm({\n+    ...form,\n+    fromCity: testData.fromCity,\n+    toCity: testData.toCity,\n+    cargos: testData.cargos,\n+    declaredValue: testData.declaredValue,\n+    fromAddressDelivery: testData.fromAddressDelivery,\n+    toAddressDelivery: testData.toAddressDelivery,\n+    needPackaging: testData.needPackaging,\n+    needInsurance: testData.needInsurance\n+  });\n+\n+  // Запускаем проверки параллельно\n+  Promise.all([\n+    checkAPIStatus('pek', async () => {\n+      try {\n+        const response = await fetch('/api/pek', {\n+          method: 'POST',\n+          headers: { 'Content-Type': 'application/json' },\n+          body: JSON.stringify(testData)\n+        });\n+        return await response.json();\n+      } catch (error) {\n+        return { error: true };\n+      }\n+    }),\n+    \n+    checkAPIStatus('dellin', async () => {\n+      try {\n+        const response = await fetch('/api/dellin-packages', {\n+          method: 'POST',\n+          headers: { 'Content-Type': 'application/json' },\n+          body: JSON.stringify(testData)\n+        });\n+        return await response.json();\n+      } catch (error) {\n+        return { error: true };\n+      }\n+    }),\n+    \n+    checkAPIStatus('railcontinent', async () => {\n+      try {\n+        const response = await fetch('/api/rail-continent', {\n+          method: 'POST',\n+          headers: { 'Content-Type': 'application/json' },\n+          body: JSON.stringify({\n+            city_sender: testData.fromCity,\n+            city_receiver: testData.toCity,\n+            weight: 10,\n+            volume: 0.1,\n+            length: 1,\n+            width: 1,\n+            height: 1,\n+            declared_cost: testData.declaredValue,\n+            pickup: '0',\n+            delivery: '0',\n+            packaging: '0',\n+            insurance: '0',\n+            tariff: 'auto'\n+          })\n+        });\n+        return await response.json();\n+      } catch (error) {\n+        return { error: true };\n+      }\n+    }),\n+    \n+    checkAPIStatus('vozovoz', async () => {\n+      try {\n+        const response = await fetch('/api/vozovoz', {\n+          method: 'POST',\n+          headers: { 'Content-Type': 'application/json' },\n+          body: JSON.stringify({\n+            object: \"price\",\n+            action: \"get\",\n+            params: {\n+              cargo: {\n+                dimension: {\n+                  quantity: 1,\n+                  volume: 0.1,\n+                  weight: 10\n+                }\n+              },\n+              gateway: {\n+                dispatch: {\n+                  point: {\n+                    location: testData.fromCity,\n+                    terminal: \"default\"\n+                  }\n+                },\n+                destination: {\n+                  point: {\n+                    location: testData.toCity,\n+                    terminal: \"default\"\n+                  }\n+                }\n+              }\n+            }\n+          })\n+        });\n+        return await response.json();\n+      } catch (error) {\n+        return { error: true };\n+      }\n+    })\n+  ]).finally(() => {\n+    // Восстанавливаем исходное состояние формы\n+    setForm(currentForm);\n+  });\n+};\n+\n const searchAddresses = useCallback(async (query: string, field: string, element?: HTMLInputElement) => {\n   if (query.length < 3) {\n     setSuggestions([]);\n     setShowSuggestions(false);\n"
    },
    "title": "app/page.tsx",
    "time": {
      "start": 1759005755245,
      "end": 1759005755268
    }
  }
}