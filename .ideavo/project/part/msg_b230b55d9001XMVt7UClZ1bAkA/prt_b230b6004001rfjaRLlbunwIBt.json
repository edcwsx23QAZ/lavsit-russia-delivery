{
  "id": "prt_b230b6004001rfjaRLlbunwIBt",
  "sessionID": "ses_4dcf54091ffe1XHg1W7jdm1ovr",
  "messageID": "msg_b230b55d9001XMVt7UClZ1bAkA",
  "type": "tool",
  "callID": "toolu_017Ry54GkHXFzKdAQ4JfpSWj",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx",
      "offset": 0,
      "limit": 500
    },
    "output": "<file>\n00001| 'use client';\n00002| \n00003| import React, { useState, useEffect, useCallback, useMemo } from 'react';\n00004| import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\n00005| import { Button } from '@/components/ui/button';\n00006| import { Input } from '@/components/ui/input';\n00007| import { Label } from '@/components/ui/label';\n00008| import { Checkbox } from '@/components/ui/checkbox';\n00009| import { Switch } from '@/components/ui/switch';\n00010| import { Plus, Truck, Building2, Map, Settings, Package2, Trash2, Loader2 } from 'lucide-react';\n00011| import { Alert, AlertDescription } from '@/components/ui/alert';\n00012| import { Badge } from '@/components/ui/badge';\n00013| import { Separator } from '@/components/ui/separator';\n00014| import { Collapsible, CollapsibleContent } from '@/components/ui/collapsible';\n00015| import { LazyProductSearch, LazyTruckVisualization } from '@/components/LazyLoadedComponents';\n00016| import ProductManager from '@/components/ProductManager';\n00017| import CalculationProgress from '@/components/CalculationProgress';\n00018| import { FurnitureProduct, ProductInForm, CargoWithMetadata } from '@/lib/furniture-types';\n00019| import { saveFormData, loadFormData, hasStoredFormData, createDebouncedSaver, clearFormData } from '@/lib/form-storage';\n00020| import {\n00021|   createCargosForProduct,\n00022|   removeCargosForProduct,\n00023|   calculateTotalValue,\n00024|   findCargoIndexesForProduct\n00025| } from '@/lib/furniture-utils';\n00026| import { enhancedApiRequest } from '@/lib/api-utils';\n00027| import { cacheManager } from '@/lib/cache-manager';\n00028| import { optimizedApiClient } from '@/lib/optimized-api-client';\n00029| import SaveCalculation from '@/components/SaveCalculation';\n00030| import CalculationHistory from '@/components/CalculationHistory';\n00031| \n00032| interface Cargo {\n00033|   id: string;\n00034|   length: number;\n00035|   width: number;\n00036|   height: number;\n00037|   weight: number;\n00038|   // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–≤—è–∑–∏ —Å —Ç–æ–≤–∞—Ä–∞–º–∏\n00039|   productId?: string;\n00040|   placeNumber?: number;\n00041|   isFromProduct?: boolean;\n00042|   addedAt?: number;\n00043| }\n00044| \n00045| interface DeliveryForm {\n00046|   cargos: Cargo[];\n00047|   fromCity: string;\n00048|   toCity: string;\n00049|   fromAddress: string;\n00050|   toAddress: string;\n00051|   declaredValue: number;\n00052|   needPackaging: boolean;\n00053|   needLoading: boolean;\n00054|   needCarry: boolean;\n00055|   floor: number;\n00056|   hasFreightLift: boolean;\n00057|   needInsurance: boolean;\n00058|   fromTerminal: boolean;\n00059|   toTerminal: boolean;\n00060|   fromAddressDelivery: boolean;\n00061|   toAddressDelivery: boolean;\n00062|   fromLavsiteWarehouse: boolean;\n00063|   // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ç–æ–≤–∞—Ä–æ–≤\n00064|   selectedProducts: ProductInForm[];\n00065| }\n00066| \n00067| interface CalculationResult {\n00068|   company: string;\n00069|   price: number;\n00070|   days: number;\n00071|   details?: any;\n00072|   error?: string;\n00073|   requestData?: any;\n00074|   responseData?: any;\n00075|   apiUrl?: string;\n00076|   sessionId?: string;\n00077| }\n00078| \n00079| interface AddressSuggestion {\n00080|   value: string;\n00081|   unrestricted_value: string;\n00082|   data: {\n00083|     city?: string;\n00084|     street?: string;\n00085|     house?: string;\n00086|   };\n00087| }\n00088| \n00089| // –û–ø—Ä–µ–¥–µ–ª–∏–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–º–ø–∞–Ω–∏–π\n00090| const COMPANIES_BASE = [\n00091|   { name: '–ü–≠–ö', logo: 'üöõ', apiKey: 'pek' },\n00092|   { name: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏', logo: 'üì¶', apiKey: 'dellin' },\n00093|   { name: 'Rail Continent', logo: 'üöÇ', apiKey: 'railcontinent' },\n00094|   { name: '–í–æ–∑–æ–≤–æ–∑', logo: 'üöö', apiKey: 'vozovoz' },\n00095|   { name: 'Nord Wheel', logo: 'üåê', apiKey: 'nordwheel' },\n00096|   { name: '–°–¥—ç–∫', logo: 'üìÆ', apiKey: 'cdek' },\n00097|   { name: '–ù–æ–≤–∞—è –ª–∏–Ω–∏—è', logo: 'üõ£Ô∏è', apiKey: 'newline' },\n00098|   { name: '–ò—Ä-–¢—Ä–∞—Å—Ç', logo: 'üè≠', apiKey: 'irtrust' },\n00099|   { name: '–ú–∞–π–æ—Ä —Ç—Ä–∞–Ω—Å', logo: '‚≠ê', apiKey: 'majortrans' },\n00100|   { name: '–ë–ê–ô–ö–ê–õ –°–ï–†–í–ò–°', logo: 'üåä', apiKey: 'baikalservice' },\n00101|   { name: '–ê–¥–∞–º–∞–Ω—Ç', logo: 'üíé', apiKey: 'adamant' },\n00102|   { name: '–≠–ù–ï–†–ì–ò–Ø', logo: '‚ö°', apiKey: 'energiya' },\n00103|   { name: '–¶–ê–ü', logo: 'üéØ', apiKey: 'cap' },\n00104|   { name: '–£—Ä–∞–ª–¢—Ä–∞–Ω—Å–ö–æ–º–ø–∞–Ω–∏', logo: '‚õ∞Ô∏è', apiKey: 'uraltrans' },\n00105|   { name: '–ù–û–í–û–¢–≠–ö', logo: 'üîß', apiKey: 'novotek' },\n00106|   { name: '–ö–∏—Ç', logo: 'üêã', apiKey: 'kit' },\n00107|   { name: '–ö–∞—Ä–∞–≤–∞–Ω', logo: 'üê™', apiKey: 'karavan' },\n00108|   { name: '–ñ–µ–ª–î–æ—Ä–≠–∫—Å–ø–µ–¥–∏—Ü–∏—è', logo: 'üöÑ', apiKey: 'zeldor' },\n00109|   { name: '–î–ö –¢—Ä–∞–Ω–∑–∏—Ç', logo: 'üöê', apiKey: 'dktransit' },\n00110|   { name: '–ì–ª–∞–≤—Ç—Ä–∞—Å—Å–∞', logo: 'üõ§Ô∏è', apiKey: 'glavtrassa' },\n00111|   { name: '–ë–∞–ª—Ç–∏–π—Å–∫–∞—è –°–ª—É–∂–±–∞ –î–æ—Å—Ç–∞–≤–∫–∏', logo: '‚öì', apiKey: 'baltservice' },\n00112|   { name: '–ê–ù–ö–û–†', logo: 'üîó', apiKey: 'ankor' }\n00113| ];\n00114| \n00115| export default function Home() {\n00116|   // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n00117|   const initialFormState: DeliveryForm = {\n00118|     cargos: [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00119|     fromCity: '',\n00120|     toCity: '',\n00121|     fromAddress: '',\n00122|     toAddress: '',\n00123|     declaredValue: 0,\n00124|     needPackaging: false,\n00125|     needLoading: false,\n00126|     needCarry: false,\n00127|     floor: 1,\n00128|     hasFreightLift: false,\n00129|     needInsurance: false,\n00130|     fromTerminal: true,\n00131|     toTerminal: true,\n00132|     fromAddressDelivery: false,\n00133|     toAddressDelivery: false,\n00134|     fromLavsiteWarehouse: false,\n00135|     selectedProducts: []\n00136|   };\n00137| \n00138|   const [form, setForm] = useState<DeliveryForm>(initialFormState);\n00139|   const [isLoaded, setIsLoaded] = useState(false);\n00140|   const [isRestoring, setIsRestoring] = useState(false);\n00141|   const [lastSaveTime, setLastSaveTime] = useState<Date | null>(null);\n00142|   const [isFormChanged, setIsFormChanged] = useState(false);\n00143|   \n00144|   // –°–æ–∑–¥–∞–µ–º –¥–µ–±–∞—É–Ω—Å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (—Å–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è)\n00145|   const debouncedSave = useMemo(() => {\n00146|     const saver = createDebouncedSaver(1000);\n00147|     // –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã\n00148|     return (formData: any) => {\n00149|       setIsFormChanged(true);\n00150|       saver(formData);\n00151|       // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É\n00152|       setTimeout(() => {\n00153|         setLastSaveTime(new Date());\n00154|         setIsFormChanged(false);\n00155|       }, 1100);\n00156|     };\n00157|   }, []);\n00158| \n00159|   const [suggestions, setSuggestions] = useState<AddressSuggestion[]>([]);\n00160|   const [showSuggestions, setShowSuggestions] = useState(false);\n00161|   const [activeField, setActiveField] = useState('');\n00162|   \n00163|   // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω–∏–µ–º/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n00164|   const [enabledCompanies, setEnabledCompanies] = useState<Record<string, boolean>>({\n00165|     pek: true,\n00166|     dellin: true,\n00167|     railcontinent: true,\n00168|     vozovoz: true,\n00169|     nordwheel: true,\n00170|     cdek: true,\n00171|     newline: false,\n00172|     irtrust: false,\n00173|     majortrans: false,\n00174|     baikalservice: false,\n00175|     adamant: false,\n00176|     energiya: false,\n00177|     cap: false,\n00178|     uraltrans: false,\n00179|     novotek: false,\n00180|     kit: true,\n00181|     karavan: false,\n00182|     zeldor: false,\n00183|     dktransit: false,\n00184|     glavtrassa: false,\n00185|     baltservice: false,\n00186|     ankor: false\n00187|   });\n00188|   const [calculations, setCalculations] = useState<CalculationResult[]>([]);\n00189|   const [calculating, setCalculating] = useState(false);\n00190|   const [calculationProgress, setCalculationProgress] = useState<{\n00191|     companies: Array<{\n00192|       name: string;\n00193|       status: 'pending' | 'loading' | 'completed' | 'error';\n00194|       progress?: number;\n00195|       error?: string;\n00196|       duration?: number;\n00197|     }>;\n00198|     totalDuration: number;\n00199|   }>({\n00200|     companies: [],\n00201|     totalDuration: 0\n00202|   });\n00203|   const [expandedDetails, setExpandedDetails] = useState<{ [key: string]: boolean }>({});\n00204|   const [expandedDebugInfo, setExpandedDebugInfo] = useState<{ [key: string]: boolean }>({});\n00205|   const [suggestionPosition, setSuggestionPosition] = useState({ top: 0, left: 0 });\n00206|   const [apiStatus, setApiStatus] = useState({\n00207|     pek: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00208|     dellin: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00209|     railcontinent: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00210|     vozovoz: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00211|     nordwheel: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00212|     cdek: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00213|     kit: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00214|     newline: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00215|     irtrust: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00216|     majortrans: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00217|     baikalservice: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00218|     adamant: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00219|     energiya: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00220|     cap: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00221|     uraltrans: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00222|     novotek: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00223|     karavan: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00224|     zeldor: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00225|     dktransit: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00226|     glavtrassa: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00227|     baltservice: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00228|     ankor: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ'\n00229|   });\n00230| \n00231|   // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–∫—Ä—ã—Ç—ã—Ö —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n00232|   const [hiddenCompanies, setHiddenCompanies] = useState<Record<string, boolean>>({});\n00233|   const [showHiddenCompanies, setShowHiddenCompanies] = useState(false);\n00234| \n00235|   // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö - –ù–ï –æ—á–∏—â–∞–µ–º localStorage –≤ dev —Ä–µ–∂–∏–º–µ\n00236|   // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞–º–∏\n00237| \n00238|   // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏\n00239|   useEffect(() => {\n00240|     if (typeof window !== 'undefined' && isLoaded) {\n00241|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ (–ø–æ—Å–ª–µ Clear-Site-Data)\n00242|       const delayedCheck = setTimeout(() => {\n00243|         const currentFormData = loadFormData();\n00244|         if (!currentFormData) {\n00245|           console.log('üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –∏—â–µ–º backup...');\n00246|           \n00247|           // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ backup –¥–∞–Ω–Ω—ã–µ\n00248|           const backupKeys = ['formBackup1', 'formBackup2', 'formBackup3'];\n00249|           for (const key of backupKeys) {\n00250|             const backup = localStorage.getItem(key);\n00251|             if (backup) {\n00252|               try {\n00253|                 localStorage.setItem('deliveryFormData', backup);\n00254|                 console.log('üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ backup:', key);\n00255|                 \n00256|                 // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ\n00257|                 const restoredData = loadFormData();\n00258|                 if (restoredData) {\n00259|                   setIsRestoring(true);\n00260|                   const restoredForm: DeliveryForm = {\n00261|                     cargos: restoredData.cargos.length > 0 ? restoredData.cargos : [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00262|                     fromCity: restoredData.fromCity,\n00263|                     toCity: restoredData.toCity,\n00264|                     fromAddress: restoredData.fromAddress,\n00265|                     toAddress: restoredData.toAddress,\n00266|                     declaredValue: restoredData.declaredValue,\n00267|                     needPackaging: restoredData.needPackaging,\n00268|                     needLoading: restoredData.needLoading,\n00269|                     needCarry: restoredData.needCarry,\n00270|                     floor: restoredData.floor,\n00271|                     hasFreightLift: restoredData.hasFreightLift,\n00272|                     needInsurance: restoredData.needInsurance,\n00273|                     fromTerminal: restoredData.fromTerminal,\n00274|                     toTerminal: restoredData.toTerminal,\n00275|                     fromAddressDelivery: restoredData.fromAddressDelivery,\n00276|                     toAddressDelivery: restoredData.toAddressDelivery,\n00277|                     fromLavsiteWarehouse: restoredData.fromLavsiteWarehouse || false,\n00278|                     selectedProducts: restoredData.selectedProducts,\n00279|                   };\n00280|                   setForm(restoredForm);\n00281|                   if (restoredData.enabledCompanies && Object.keys(restoredData.enabledCompanies).length > 0) {\n00282|                     setEnabledCompanies(restoredData.enabledCompanies);\n00283|                   }\n00284|                   if (restoredData.hiddenCompanies && Object.keys(restoredData.hiddenCompanies).length > 0) {\n00285|                     setHiddenCompanies(restoredData.hiddenCompanies);\n00286|                   }\n00287|                   setTimeout(() => setIsRestoring(false), 100);\n00288|                   console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!');\n00289|                 }\n00290|                 break;\n00291|               } catch (e) {\n00292|                 console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ backup:', key, e);\n00293|               }\n00294|             }\n00295|           }\n00296|         }\n00297|       }, 2000);\n00298|       \n00299|       return () => clearTimeout(delayedCheck);\n00300|     }\n00301|   }, [isLoaded]);\n00302| \n00303|   // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)\n00304|   useEffect(() => {\n00305|     // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ\n00306|     if (typeof window !== 'undefined' && !isLoaded) {\n00307|       let dataRestored = false;\n00308|       try {\n00309|         setIsRestoring(true); // –ë–ª–æ–∫–∏—Ä—É–µ–º –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è\n00310|         \n00311|         // –ú—è–≥–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –±–µ–∑ –æ—á–∏—Å—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö\n00312|         const currentVersion = 'v2.4.0-persistent-storage'; // –í–µ—Ä—Å–∏—è —Å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º\n00313|         const savedVersion = localStorage.getItem('appVersion');\n00314|         \n00315|         if (savedVersion !== currentVersion) {\n00316|           console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ', currentVersion);\n00317|           // –ù–ï –æ—á–∏—â–∞–µ–º localStorage - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ\n00318|           localStorage.setItem('appVersion', currentVersion);\n00319|         }\n00320|         \n00321|         // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É\n00322|         const savedFormData = loadFormData();\n00323|         if (savedFormData) {\n00324|           // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞\n00325|           const restoredForm: DeliveryForm = {\n00326|             cargos: savedFormData.cargos.length > 0 ? savedFormData.cargos : [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00327|             fromCity: savedFormData.fromCity,\n00328|             toCity: savedFormData.toCity,\n00329|             fromAddress: savedFormData.fromAddress,\n00330|             toAddress: savedFormData.toAddress,\n00331|             declaredValue: savedFormData.declaredValue,\n00332|             needPackaging: savedFormData.needPackaging,\n00333|             needLoading: savedFormData.needLoading,\n00334|             needCarry: savedFormData.needCarry,\n00335|             floor: savedFormData.floor,\n00336|             hasFreightLift: savedFormData.hasFreightLift,\n00337|             needInsurance: savedFormData.needInsurance,\n00338|             fromTerminal: savedFormData.fromTerminal,\n00339|             toTerminal: savedFormData.toTerminal,\n00340|             fromAddressDelivery: savedFormData.fromAddressDelivery,\n00341|             toAddressDelivery: savedFormData.toAddressDelivery,\n00342|             fromLavsiteWarehouse: savedFormData.fromLavsiteWarehouse || false,\n00343|             selectedProducts: savedFormData.selectedProducts,\n00344|           };\n00345|           \n00346|           setForm(restoredForm);\n00347|           \n00348|           // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n00349|             if (savedFormData.enabledCompanies && Object.keys(savedFormData.enabledCompanies).length > 0) {\n00350|               setEnabledCompanies(savedFormData.enabledCompanies);\n00351|             }\n00352|             if (savedFormData.hiddenCompanies && Object.keys(savedFormData.hiddenCompanies).length > 0) {\n00353|               setHiddenCompanies(savedFormData.hiddenCompanies);\n00354|             }\n00355|           console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ localStorage');\n00356|           \n00357|           // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è Supabase\n00358|           const currentTime = Math.floor(Date.now() / 1000);\n00359|           console.log('üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (timestamp):', currentTime);\n00360|           console.log('üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (ISO):', new Date().toISOString());\n00361|           \n00362|           dataRestored = true;\n00363|           // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—Å–ø–µ–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è\n00364|           setTimeout(() => {\n00365|             setIsRestoring(false);\n00366|           }, 100);\n00367|         } else {\n00368|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏\n00369|           const oldSaved = localStorage.getItem('deliveryForm');\n00370|           if (oldSaved) {\n00371|             console.log('üîÑ –ù–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç–∞—Ä–æ–º —Ñ–æ—Ä–º–∞—Ç–µ, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è...');\n00372|             const oldForm = JSON.parse(oldSaved);\n00373|             if (!oldForm.cargos || oldForm.cargos.length === 0) {\n00374|               oldForm.cargos = [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }];\n00375|             }\n00376|             setForm(oldForm);\n00377|             \n00378|             // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –∏ —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ\n00379|             saveFormData(oldForm);\n00380|             localStorage.removeItem('deliveryForm');\n00381|             console.log('‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');\n00382|             \n00383|             dataRestored = true;\n00384|             // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—Å–ø–µ–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è\n00385|             setTimeout(() => {\n00386|               setIsRestoring(false);\n00387|             }, 100);\n00388|           }\n00389|         }\n00390|         \n00391|         // –í—ã–≤–æ–¥–∏–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¢–ö –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n00392|         console.log('üìã –í—Å–µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ –¢–ö:', COMPANIES_BASE.length);\n00393|         console.log('üìã –°–ø–∏—Å–æ–∫ –¢–ö:', COMPANIES_BASE.map(c => c.name));\n00394|         \n00395|       } catch (error) {\n00396|         console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);\n00397|         // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ\n00398|       } finally {\n00399|         // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, —Å—Ä–∞–∑—É —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ\n00400|         if (!dataRestored) {\n00401|           setIsRestoring(false);\n00402|         }\n00403|         setIsLoaded(true);\n00404|       }\n00405|     }\n00406|   }, [isLoaded]);\n00407| \n00408|   // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–æ—Ä–º—ã (—Å –¥–µ–±–∞—É–Ω—Å–æ–º)\n00409|   useEffect(() => {\n00410|     if (typeof window !== 'undefined' && isLoaded && !isRestoring) {\n00411|       // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–±–∞—É–Ω—Å –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è\n00412|       debouncedSave({\n00413|         cargos: form.cargos,\n00414|         fromCity: form.fromCity,\n00415|         toCity: form.toCity,\n00416|         fromAddress: form.fromAddress,\n00417|         toAddress: form.toAddress,\n00418|         declaredValue: form.declaredValue,\n00419|         needPackaging: form.needPackaging,\n00420|         needLoading: form.needLoading,\n00421|         needCarry: form.needCarry,\n00422|         floor: form.floor,\n00423|         hasFreightLift: form.hasFreightLift,\n00424|         needInsurance: form.needInsurance,\n00425|         fromTerminal: form.fromTerminal,\n00426|         toTerminal: form.toTerminal,\n00427|         fromAddressDelivery: form.fromAddressDelivery,\n00428|         toAddressDelivery: form.toAddressDelivery,\n00429|         fromLavsiteWarehouse: form.fromLavsiteWarehouse,\n00430|         selectedProducts: form.selectedProducts,\n00431|         enabledCompanies: enabledCompanies,\n00432|         hiddenCompanies: hiddenCompanies,\n00433|       });\n00434|     }\n00435|   }, [form, enabledCompanies, isLoaded, isRestoring, debouncedSave]);\n00436| \n00437|   // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –ø—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n00438|   useEffect(() => {\n00439|     if (form.declaredValue > 0) {\n00440|       setForm(prev => ({ ...prev, needInsurance: true }));\n00441|     }\n00442|   }, [form.declaredValue]);\n00443| \n00444|   // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤\n00445|   useEffect(() => {\n00446|     const handleMessage = (event: MessageEvent) => {\n00447|       if (event.data && event.data.type === 'PRODUCTS_UPDATED') {\n00448|         console.log('üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤:', event.data.data);\n00449|         \n00450|         // –û—á–∏—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫—ç—à–∏ —Ç–æ–≤–∞—Ä–æ–≤\n00451|         const keysToRemove: string[] = [];\n00452|         for (let i = 0; i < localStorage.length; i++) {\n00453|           const key = localStorage.key(i);\n00454|           if (key && (key.startsWith('furniture_') || key.startsWith('product_') || key.includes('ProductSearch'))) {\n00455|             keysToRemove.push(key);\n00456|           }\n00457|         }\n00458|         keysToRemove.forEach(key => localStorage.removeItem(key));\n00459|         console.log(`üßΩ –û—á–∏—â–µ–Ω–æ ${keysToRemove.length} –∫–ª—é—á–µ–π –∫—ç—à–∞ —Ç–æ–≤–∞—Ä–æ–≤`);\n00460|         \n00461|         // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É ProductSearch –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è\n00462|         window.dispatchEvent(new CustomEvent('forceProductsReload', {\n00463|           detail: event.data.data\n00464|         }));\n00465|       }\n00466|     };\n00467|     \n00468|     window.addEventListener('message', handleMessage);\n00469|     \n00470|     return () => {\n00471|       window.removeEventListener('message', handleMessage);\n00472|     };\n00473|   }, []);\n00474| \n00475|   // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã\n00476|   useEffect(() => {\n00477|     if (typeof window !== 'undefined' && isLoaded) {\n00478|       checkAllAPIStatus();\n00479|     }\n00480|   }, [isLoaded]);\n00481| \n00482|   const checkAPIStatus = async (apiName: string, testFunction: () => Promise<any>) => {\n00483|     try {\n00484|       const result = await testFunction();\n00485|       if (result && !result.error) {\n00486|         setApiStatus(prev => ({ ...prev, [apiName]: '–ø–æ–¥–∫–ª—é—á–µ–Ω–æ' }));\n00487|       } else {\n00488|         setApiStatus(prev => ({ ...prev, [apiName]: '–æ—à–∏–±–∫–∞' }));\n00489|       }\n00490|     } catch (error) {\n00491|       setApiStatus(prev => ({ ...prev, [apiName]: '–æ—à–∏–±–∫–∞' }));\n00492|     }\n00493|   };\n00494| \n00495|   const checkAllAPIStatus = async () => {\n00496|     // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\n00497|     const testData = {\n00498|       fromCity: '–ú–æ—Å–∫–≤–∞',\n00499|       toCity: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', \n00500|       cargos: [{ id: '1', length: 100, width: 100, height: 100, weight: 10 }],\n\n(File has more lines. Use 'offset' parameter to read beyond line 500)\n</file>",
    "title": "app/page.tsx",
    "metadata": {
      "preview": "'use client';\n\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Switch } from '@/components/ui/switch';\nimport { Plus, Truck, Building2, Map, Settings, Package2, Trash2, Loader2 } from 'lucide-react';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { Collapsible, CollapsibleContent } from '@/components/ui/collapsible';\nimport { LazyProductSearch, LazyTruckVisualization } from '@/components/LazyLoadedComponents';\nimport ProductManager from '@/components/ProductManager';\nimport CalculationProgress from '@/components/CalculationProgress';\nimport { FurnitureProduct, ProductInForm, CargoWithMetadata } from '@/lib/furniture-types';\nimport { saveFormData, loadFormData, hasStoredFormData, createDebouncedSaver, clearFormData } from '@/lib/form-storage';\nimport {"
    },
    "time": {
      "start": 1765819507453,
      "end": 1765819507460
    }
  }
}