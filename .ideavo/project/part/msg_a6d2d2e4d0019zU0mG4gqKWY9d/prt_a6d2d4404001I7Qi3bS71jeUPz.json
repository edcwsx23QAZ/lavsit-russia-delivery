{
  "id": "prt_a6d2d4404001I7Qi3bS71jeUPz",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "messageID": "msg_a6d2d2e4d0019zU0mG4gqKWY9d",
  "type": "tool",
  "callID": "toolu_012ksSSqgUxJN648rJSoonku",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "app/api/pek/route.ts"
    },
    "output": "<file>\n00001| import { NextRequest, NextResponse } from 'next/server';\n00002| import { apiRequestWithTimeout, validateApiInput, validationRules, PerformanceMonitor } from '@/lib/api-utils';\n00003| \n00004| export async function POST(request: NextRequest) {\n00005|   const endTiming = PerformanceMonitor.startMeasurement('pek_api_total');\n00006|   \n00007|   try {\n00008|     console.log('üîß –ü–≠–ö –ü—Ä–æ–∫—Å–∏: –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å (–ø–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)');\n00009|     \n00010|     const requestData = await request.json();\n00011|     console.log('üìù –î–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞:', JSON.stringify(requestData, null, 2));\n00012|     \n00013|     // Input validation\n00014|     validateApiInput(requestData, {\n00015|       method: validationRules.required('method'),\n00016|     });\n00017|     \n00018|     const { method, address, coordinates } = requestData;\n00019|     \n00020|     // –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ü–≠–ö\n00021|     const PEK_API_KEY = process.env.PEK_API_KEY || '624FC93CA677B23673BB476D4982294DC27E246F';\n00022|     const PEK_LOGIN = process.env.PEK_LOGIN || 'demo';\n00023|     \n00024|     // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ-—Ç–µ—Å—Ç–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤\n00025|     if (method !== 'test' && (!process.env.PEK_LOGIN || !process.env.PEK_API_KEY)) {\n00026|       console.warn('‚ö†Ô∏è –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è PEK_LOGIN –∏ PEK_API_KEY');\n00027|       console.warn('‚ö†Ô∏è –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ /env-check –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏');\n00028|       \n00029|       return NextResponse.json({ \n00030|         error: '–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –ü–≠–ö',\n00031|         details: '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å PEK_LOGIN –∏ PEK_API_KEY –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è',\n00032|         suggestion: '–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ /env-check –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏',\n00033|         requiredVars: ['PEK_LOGIN', 'PEK_API_KEY'],\n00034|         currentEnv: {\n00035|           hasLogin: !!process.env.PEK_LOGIN,\n00036|           hasKey: !!process.env.PEK_API_KEY,\n00037|           loginPreview: process.env.PEK_LOGIN ? process.env.PEK_LOGIN.substring(0, 3) + '***' : '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'\n00038|         }\n00039|       }, { status: 500 });\n00040|     }\n00041|     \n00042|     // –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –±–∞–∑–æ–≤—ã–π URL —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n00043|     const BASE_URL = 'https://kabinet.pecom.ru/api/v1';\n00044|     \n00045|     let urlPath = '';\n00046|     let body = {};\n00047|     \n00048|     switch (method) {\n00049|       case 'findzonebyaddress':\n00050|         urlPath = '/branches/findzonebyaddress/';\n00051|         console.log('üîç –ü–≠–ö API: findzonebyaddress –¥–ª—è –∞–¥—Ä–µ—Å–∞:', address);\n00052|         body = { address: address };\n00053|         break;\n00054|         \n00055|       case 'findzonebycoordinates':\n00056|         urlPath = '/branches/findzonebycoordinates/';\n00057|         \n00058|         // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç\n00059|         const lat = Number(coordinates.latitude);\n00060|         const lng = Number(coordinates.longitude);\n00061|         \n00062|         if (isNaN(lat) || isNaN(lng) || lat < -90 || lat > 90 || lng < -180 || lng > 180) {\n00063|           return NextResponse.json({ \n00064|             error: '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã',\n00065|             details: `–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å: latitude –æ—Ç -90 –¥–æ 90, longitude –æ—Ç -180 –¥–æ 180`,\n00066|             received: { latitude: coordinates.latitude, longitude: coordinates.longitude },\n00067|             validated: { latitude: lat, longitude: lng }\n00068|           }, { status: 400 });\n00069|         }\n00070|         \n00071|         body = {\n00072|           longitude: lng,\n00073|           latitude: lat\n00074|         };\n00075|         break;\n00076|         \n00077|       case 'calculateprice':\n00078|         urlPath = '/calculator/calculateprice/';\n00079|         const { method: methodName, ...calculationData } = requestData;\n00080|         \n00081|         // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤ –∞–¥—Ä–µ—Å–∞—Ö –¥–æ—Å—Ç–∞–≤–∫–∏\n00082|         console.log('üß™ API –ü—Ä–æ–∫—Å–∏: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤ calculateprice');\n00083|         \n00084|         if (calculationData.pickup?.coordinates) {\n00085|           console.log('üìç API –ü—Ä–æ–∫—Å–∏: pickup.coordinates =', calculationData.pickup.coordinates);\n00086|           const lat = Number(calculationData.pickup.coordinates.latitude);\n00087|           const lng = Number(calculationData.pickup.coordinates.longitude);\n00088|           \n00089|           console.log('üìç API –ü—Ä–æ–∫—Å–∏: pickup –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω–æ: lat=' + lat + ', lng=' + lng);\n00090|           \n00091|           if (isNaN(lat) || isNaN(lng) || lat < -90 || lat > 90 || lng < -180 || lng > 180) {\n00092|             console.warn('‚ö†Ô∏è API –ü—Ä–æ–∫—Å–∏: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã pickup:', calculationData.pickup.coordinates);\n00093|             console.warn('‚ö†Ô∏è API –ü—Ä–æ–∫—Å–∏: –£–¥–∞–ª—è–µ–º pickup.coordinates');\n00094|             delete calculationData.pickup.coordinates;\n00095|           } else {\n00096|             console.log('‚úÖ API –ü—Ä–æ–∫—Å–∏: pickup.coordinates –≤–∞–ª–∏–¥–Ω—ã');\n00097|             calculationData.pickup.coordinates = { latitude: lat, longitude: lng };\n00098|           }\n00099|         }\n00100|         \n00101|         if (calculationData.delivery?.coordinates) {\n00102|           console.log('üìç API –ü—Ä–æ–∫—Å–∏: delivery.coordinates =', calculationData.delivery.coordinates);\n00103|           const lat = Number(calculationData.delivery.coordinates.latitude);\n00104|           const lng = Number(calculationData.delivery.coordinates.longitude);\n00105|           \n00106|           console.log('üìç API –ü—Ä–æ–∫—Å–∏: delivery –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω–æ: lat=' + lat + ', lng=' + lng);\n00107|           \n00108|           if (isNaN(lat) || isNaN(lng) || lat < -90 || lat > 90 || lng < -180 || lng > 180) {\n00109|             console.warn('‚ö†Ô∏è API –ü—Ä–æ–∫—Å–∏: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã delivery:', calculationData.delivery.coordinates);\n00110|             console.warn('‚ö†Ô∏è API –ü—Ä–æ–∫—Å–∏: –£–¥–∞–ª—è–µ–º delivery.coordinates');\n00111|             delete calculationData.delivery.coordinates;\n00112|           } else {\n00113|             console.log('‚úÖ API –ü—Ä–æ–∫—Å–∏: delivery.coordinates –≤–∞–ª–∏–¥–Ω—ã');\n00114|             calculationData.delivery.coordinates = { latitude: lat, longitude: lng };\n00115|           }\n00116|         }\n00117|         \n00118|         // –ü–æ–∏—Å–∫ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤ –ª—é–±—ã—Ö –ø–æ–ª—è—Ö (–≥–ª—É–±–æ–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)\n00119|         const removeInvalidCoordinates = (obj: any, path = '') => {\n00120|           if (obj && typeof obj === 'object') {\n00121|             for (const [key, value] of Object.entries(obj)) {\n00122|               const currentPath = path ? `${path}.${key}` : key;\n00123|               \n00124|               if (key === 'coordinates' && value && typeof value === 'object') {\n00125|                 const coords = value as any;\n00126|                 if (coords.latitude !== undefined || coords.longitude !== undefined) {\n00127|                   const lat = Number(coords.latitude);\n00128|                   const lng = Number(coords.longitude);\n00129|                   \n00130|                   console.log(`üìç API –ü—Ä–æ–∫—Å–∏: –ù–∞–π–¥–µ–Ω—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ ${currentPath}:`, coords);\n00131|                   \n00132|                   if (isNaN(lat) || isNaN(lng) || lat < -90 || lat > 90 || lng < -180 || lng > 180) {\n00133|                     console.warn(`‚ö†Ô∏è API –ü—Ä–æ–∫—Å–∏: –£–¥–∞–ª—è–µ–º –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ ${currentPath}`);\n00134|                     delete obj[key];\n00135|                   } else {\n00136|                     console.log(`‚úÖ API –ü—Ä–æ–∫—Å–∏: –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ ${currentPath} –≤–∞–ª–∏–¥–Ω—ã`);\n00137|                     obj[key] = { latitude: lat, longitude: lng };\n00138|                   }\n00139|                 }\n00140|               } else if (typeof value === 'object' && value !== null) {\n00141|                 removeInvalidCoordinates(value, currentPath);\n00142|               }\n00143|             }\n00144|           }\n00145|         };\n00146|         \n00147|         removeInvalidCoordinates(calculationData);\n00148|         \n00149|         console.log('üöÄ API –ü—Ä–æ–∫—Å–∏: –û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ü–≠–ö:', JSON.stringify(calculationData, null, 2));\n00150|         body = calculationData;\n00151|         break;\n00152|         \n00153|       case 'nearestdepartments':\n00154|         urlPath = '/branches/nearestdepartments/';\n00155|         const { method: nearestMethod, ...departmentData } = requestData;\n00156|         body = departmentData;\n00157|         break;\n00158|         \n00159|       case 'test':\n00160|         console.log('üîß –¢–µ—Å—Ç–æ–≤—ã–π –º–µ—Ç–æ–¥ –ø—Ä–æ–∫—Å–∏');\n00161|         return NextResponse.json({ \n00162|           status: 'OK', \n00163|           message: '–ü—Ä–æ–∫—Å–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)',\n00164|           timestamp: new Date().toISOString(),\n00165|           receivedData: requestData,\n00166|           authMethod: 'Basic Auth',\n00167|           baseUrl: BASE_URL\n00168|         });\n00169|         \n00170|       default:\n00171|         console.log('‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –º–µ—Ç–æ–¥:', method);\n00172|         return NextResponse.json({ error: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –º–µ—Ç–æ–¥', method }, { status: 400 });\n00173|     }\n00174|     \n00175|     const fullUrl = BASE_URL + urlPath;\n00176|     \n00177|     // Basic Auth —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏: base64(login:api_key)\n00178|     const credentials = Buffer.from(`${PEK_LOGIN}:${PEK_API_KEY}`).toString('base64');\n00179|     \n00180|     console.log('üåê –ó–∞–ø—Ä–æ—Å –∫ –ü–≠–ö API (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è):');\n00181|     console.log('URL:', fullUrl);\n00182|     console.log('Auth: Basic (–ª–æ–≥–∏–Ω + API –∫–ª—é—á)');\n00183|     console.log('EXACT BODY TO PEK:', JSON.stringify(body, null, 2));\n00184|     \n00185|     // –ü–æ–∏—Å–∫ –ª—é–±—ã—Ö —Å–ª–æ–≤ latitude/longitude –≤ JSON\n00186|     const bodyStr = JSON.stringify(body);\n00187|     if (bodyStr.includes('latitude') || bodyStr.includes('longitude')) {\n00188|       console.warn('üö® –û–ë–ù–ê–†–£–ñ–ï–ù–´ –ö–û–û–†–î–ò–ù–ê–¢–´ –í –ó–ê–ü–†–û–°–ï –ö –ü–≠–ö!');\n00189|       console.warn('Full body string:', bodyStr);\n00190|     }\n00191|     \n00192|     try {\n00193|       const response = await apiRequestWithTimeout(fullUrl, {\n00194|         method: 'POST',\n00195|         headers: {\n00196|           // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n00197|           'Content-Type': 'application/json;charset=utf-8',\n00198|           'Accept': 'application/json',\n00199|           // 'Accept-Encoding': 'gzip', // –£–±–∏—Ä–∞–µ–º –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –æ—Ç–ª–∞–¥–∫–∏\n00200|           'Authorization': `Basic ${credentials}`,\n00201|         },\n00202|         body: JSON.stringify(body)\n00203|       }, { timeout: 15000, retries: 2 });\n00204|       \n00205|       console.log('üì° –û—Ç–≤–µ—Ç –æ—Ç –ü–≠–ö API:');\n00206|       console.log('Status:', response.status, response.statusText);\n00207|       console.log('Headers:', Object.fromEntries(response.headers.entries()));\n00208|       \n00209|       if (!response.ok) {\n00210|         const errorText = await response.text();\n00211|         console.error('‚ùå –ü–≠–ö API –æ—à–∏–±–∫–∞:', response.status, response.statusText);\n00212|         console.error('‚ùå –û—Ç–≤–µ—Ç:', errorText.substring(0, 1000));\n00213|         \n00214|         // –î–µ—Ç–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n00215|         if (response.status === 404) {\n00216|           return NextResponse.json({ \n00217|             error: '–ú–µ—Ç–æ–¥ API –Ω–µ –Ω–∞–π–¥–µ–Ω',\n00218|             details: 'URL –º–µ—Ç–æ–¥–∞ –Ω–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –º–µ—Ç–æ–¥ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç',\n00219|             url: fullUrl,\n00220|             method: method,\n00221|             suggestion: '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø—É—Ç–∏ –∫ –º–µ—Ç–æ–¥—É'\n00222|           }, { status: 404 });\n00223|         }\n00224|         \n00225|         if (response.status === 403) {\n00226|           return NextResponse.json({ \n00227|             error: '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω',\n00228|             details: '–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ—Ç–æ–¥—É',\n00229|             suggestion: '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞'\n00230|           }, { status: 403 });\n00231|         }\n00232|         \n00233|         if (response.status === 401) {\n00234|           return NextResponse.json({ \n00235|             error: '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏',\n00236|             details: '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ API –∫–ª—é—á',\n00237|             suggestion: '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ü–≠–ö'\n00238|           }, { status: 401 });\n00239|         }\n00240|         \n00241|         return NextResponse.json({ \n00242|           error: `–ü–≠–ö API –æ—à–∏–±–∫–∞: ${response.status} ${response.statusText}`,\n00243|           details: errorText,\n00244|           url: fullUrl,\n00245|           method,\n00246|           requestBody: body\n00247|         }, { status: response.status });\n00248|       }\n00249|       \n00250|       const responseText = await response.text();\n00251|       console.log('‚úÖ –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç –ü–≠–ö:', responseText.substring(0, 500));\n00252|       \n00253|       try {\n00254|         const data = JSON.parse(responseText);\n00255|         \n00256|         // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –æ—à–∏–±–∫–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n00257|         if (data.error) {\n00258|           console.error('‚ùå –õ–æ–≥–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ü–≠–ö:', data.error);\n00259|           return NextResponse.json({ \n00260|             error: data.error.title || '–õ–æ–≥–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ API',\n00261|             details: data.error.message || '–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã',\n00262|             apiError: true,\n00263|             originalError: data.error\n00264|           }, { status: 400 });\n00265|         }\n00266|         \n00267|         const timing = endTiming();\n00268|         return NextResponse.json({ ...data, timing });\n00269|       } catch (parseError) {\n00270|         console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', parseError);\n00271|         endTiming();\n00272|         return NextResponse.json({ \n00273|           error: '–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞',\n00274|           details: responseText.substring(0, 1000)\n00275|         }, { status: 500 });\n00276|       }\n00277|       \n00278|     } catch (fetchError) {\n00279|       console.error('‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞:', fetchError);\n00280|       return NextResponse.json({ \n00281|         error: '–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞',\n00282|         details: fetchError instanceof Error ? fetchError.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞',\n00283|         url: fullUrl\n00284|       }, { status: 503 });\n00285|     }\n00286|     \n00287|     } catch (error) {\n00288|     endTiming();\n00289|     console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–æ–∫—Å–∏ –ü–≠–ö API:', error);\n00290|     \n00291|     if (error instanceof Error) {\n00292|       console.error('Stack trace:', error.stack);\n00293|     }\n00294|     \n00295|     return NextResponse.json({ \n00296|       error: '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞',\n00297|       details: error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞',\n00298|       type: error instanceof Error ? error.name : 'Unknown',\n00299|       stack: error instanceof Error ? error.stack : undefined\n00300|     }, { status: 500 });\n00301|   }\n00302| }\n</file>",
    "title": "app/api/pek/route.ts",
    "metadata": {
      "preview": "import { NextRequest, NextResponse } from 'next/server';\nimport { apiRequestWithTimeout, validateApiInput, validationRules, PerformanceMonitor } from '@/lib/api-utils';\n\nexport async function POST(request: NextRequest) {\n  const endTiming = PerformanceMonitor.startMeasurement('pek_api_total');\n  \n  try {\n    console.log('üîß –ü–≠–ö –ü—Ä–æ–∫—Å–∏: –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å (–ø–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)');\n    \n    const requestData = await request.json();\n    console.log('üìù –î–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞:', JSON.stringify(requestData, null, 2));\n    \n    // Input validation\n    validateApiInput(requestData, {\n      method: validationRules.required('method'),\n    });\n    \n    const { method, address, coordinates } = requestData;\n    \n    // –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ü–≠–ö"
    },
    "time": {
      "start": 1762768274929,
      "end": 1762768274937,
      "compacted": 1763403135398
    }
  }
}