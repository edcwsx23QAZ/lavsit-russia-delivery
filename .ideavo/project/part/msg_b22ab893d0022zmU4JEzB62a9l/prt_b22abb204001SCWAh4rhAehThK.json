{
  "id": "prt_b22abb204001SCWAh4rhAehThK",
  "sessionID": "ses_4ec400949ffekDUyPGFumLInaA",
  "messageID": "msg_b22ab893d0022zmU4JEzB62a9l",
  "type": "tool",
  "callID": "call_20484268",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "app/page.tsx",
      "offset": 3570
    },
    "output": "<file>\n03571|         return cityFiasMap[normalizedCity] || '0c5b2444-70a0-4932-980c-b4dc0d3f02b5'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ú–æ—Å–∫–≤–∞\n03572|       };\n03573|       // üèôÔ∏è –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ª–æ–∫–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–æ—Ä–º—ã\n03574|       const getDispatchLocation = () => {\n03575|         if (form.fromTerminal) {\n03576|           return {\n03577|             type: 'terminal' as const,\n03578|             // –î–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π FIAS –∫–æ–¥ –≥–æ—Ä–æ–¥–∞\n03579|             city_fias: getCityFias(form.fromCity)\n03580|           };\n03581|         } else if (form.fromLavsiteWarehouse) {\n03582|           // üè≠ –î–ª—è —Å–∫–ª–∞–¥–∞ –õ–∞–≤—Å–∏—Ç –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å FIAS –∫–æ–¥–æ–º –≥–æ—Ä–æ–¥–∞\n03583|           return {\n03584|             type: 'terminal' as const, // –ò—Å–ø–æ–ª—å–∑—É–µ–º terminal —Ç–∏–ø –¥–ª—è —Å–∫–ª–∞–¥–∞\n03585|             city_fias: getCityFias('–õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π') // –ò—Å–ø–æ–ª—å–∑—É–µ–º FIAS –≥–æ—Ä–æ–¥–∞ —Å–∫–ª–∞–¥–∞\n03586|           };\n03587|         } else {\n03588|           return {\n03589|             type: 'address' as const,\n03590|             address: form.fromAddress || form.fromCity // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥—Ä–µ—Å –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –≥–æ—Ä–æ–¥\n03591|           };\n03592|         }\n03593|       };\n03594| \n03595|       const getDestinationLocation = () => {\n03596|         if (form.toTerminal) {\n03597|           return {\n03598|             type: 'terminal' as const,\n03599|             // –î–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π FIAS –∫–æ–¥ –≥–æ—Ä–æ–¥–∞\n03600|             city_fias: getCityFias(form.toCity)\n03601|           };\n03602|         } else {\n03603|           return {\n03604|             type: 'address' as const,\n03605|             address: form.toAddress || form.toCity // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥—Ä–µ—Å –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –≥–æ—Ä–æ–¥\n03606|           };\n03607|         }\n03608|       };\n03609| \n03610|       // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è –Ω–æ–≤–æ–≥–æ API NordWheel —Å —É—á–µ—Ç–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–æ—Ä–º—ã\n03611|       const requestData = {\n03612|         dispatch: {\n03613|           location: getDispatchLocation()\n03614|         },\n03615|         destination: {\n03616|           location: getDestinationLocation()\n03617|         },\n03618|         cargo: {\n03619|           total_weight: totalWeight,\n03620|           total_volume: totalVolume,\n03621|           total_quantity: 1 // –í—Å–µ–≥–¥–∞ 1, —á—Ç–æ–±—ã NordWheel –Ω–µ —É–º–Ω–æ–∂–∞–ª —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –∫–æ–ª-–≤–æ –º–µ—Å—Ç\n03622|         },\n03623|         insurance: form.needInsurance && form.declaredValue ? form.declaredValue : null,\n03624|         insurance_refuse: !form.needInsurance,\n03625|         services: {\n03626|           is_package: form.needPackaging,\n03627|           is_documents_return: false,\n03628|           is_fragile: false\n03629|         },\n03630|         promocode: null\n03631|       };\n03632| \n03633|       console.log('üöõ Nord Wheel –Ω–æ–≤—ã–π API –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03634| \n03635|       const result = await enhancedApiRequest(\n03636|         apiUrl,\n03637|         {\n03638|           method: 'POST',\n03639|           headers: {\n03640|             'Content-Type': 'application/json'\n03641|           },\n03642|           body: JSON.stringify(requestData)\n03643|         },\n03644|         { operation: 'calculate', company: 'Nord Wheel' }\n03645|       );\n03646| \n03647|       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n03648|         console.error('‚ùå Nord Wheel API –æ—à–∏–±–∫–∞:', result.error);\n03649|         \n03650|         // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ 400 –∏ –±–æ–ª—å—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø—Ä–æ–±—É–µ–º —Å —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏\n03651|         if (result.error.status === 400 && (totalWeight > 1000 || totalVolume > 5)) {\n03652|           console.log('üîÑ Nord Wheel: –ü—Ä–æ–±—É–µ–º fallback —Ä–∞—Å—á–µ—Ç —Å —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏...');\n03653|           \n03654|           const fallbackRequestData = {\n03655|             ...requestData,\n03656|             cargo: {\n03657|               total_weight: Math.min(totalWeight, 999),\n03658|               total_volume: Math.min(totalVolume, 4.9),\n03659|               total_quantity: 1 // –¢–∞–∫–∂–µ –≤—Å–µ–≥–¥–∞ 1 –¥–ª—è fallback\n03660|             }\n03661|           };\n03662|           \n03663|           console.log('üîÑ Fallback –∑–∞–ø—Ä–æ—Å:', JSON.stringify(fallbackRequestData, null, 2));\n03664|           \n03665|           const fallbackResult = await enhancedApiRequest(\n03666|             apiUrl,\n03667|             {\n03668|               method: 'POST',\n03669|               headers: {\n03670|                 'Content-Type': 'application/json'\n03671|               },\n03672|               body: JSON.stringify(fallbackRequestData)\n03673|             },\n03674|             { operation: 'calculate', company: 'Nord Wheel (fallback)' }\n03675|           );\n03676|           \n03677|           if (fallbackResult && typeof fallbackResult === 'object' && 'success' in fallbackResult && !fallbackResult.success) {\n03678|             console.error('‚ùå Nord Wheel fallback —Ç–æ–∂–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:', fallbackResult.error);\n03679|           } else {\n03680|             console.log('‚úÖ Nord Wheel fallback —Å—Ä–∞–±–æ—Ç–∞–ª! –ò—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.');\n03681|             // –ò—Å–ø–æ–ª—å–∑—É–µ–º fallback —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞\n03682|             const fallbackResponse = fallbackResult as Response;\n03683|             const fallbackData = await fallbackResponse.json();\n03684|             \n03685|             // –ü–∞—Ä—Å–∏–º fallback —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º —Ü–µ–Ω—É\n03686|             const scaleFactor = Math.max(totalWeight / 999, totalVolume / 4.9);\n03687|             \n03688|             if (fallbackData.auto || fallbackData.avia) {\n03689|               const options: Array<{\n03690|                 type: string;\n03691|                 price: number;\n03692|                 days: any;\n03693|                 services: any;\n03694|               }> = [];\n03695|               \n03696|               if (fallbackData.auto) {\n03697|                 const scaledPrice = Math.round((fallbackData.auto.total_amount || 0) * scaleFactor);\n03698|                 options.push({\n03699|                   type: 'auto',\n03700|                   price: scaledPrice,\n03701|                   days: fallbackData.auto.delivery_date || '',\n03702|                   services: fallbackData.auto.services || []\n03703|                 });\n03704|               }\n03705|               \n03706|               if (fallbackData.avia) {\n03707|                 const scaledPrice = Math.round((fallbackData.avia.total_amount || 0) * scaleFactor);\n03708|                 options.push({\n03709|                   type: 'avia',\n03710|                   price: scaledPrice,\n03711|                   days: fallbackData.avia.delivery_date || '',\n03712|                   services: fallbackData.avia.services || []\n03713|                 });\n03714|               }\n03715|               \n03716|               if (options.length > 0) {\n03717|                 const bestOption = options.reduce((best, current) => \n03718|                   current.price < best.price ? current : best\n03719|                 );\n03720|                 \n03721|                 // –í—ã—á–∏—Å–ª—è–µ–º –¥–Ω–∏\n03722|                 let calculatedDays = 3;\n03723|                 try {\n03724|                   if (bestOption.days) {\n03725|                     const deliveryDate = new Date(bestOption.days);\n03726|                     const today = new Date();\n03727|                     if (!isNaN(deliveryDate.getTime())) {\n03728|                       const diffTime = deliveryDate.getTime() - today.getTime();\n03729|                       calculatedDays = Math.max(1, Math.ceil(diffTime / (1000 * 60 * 60 * 24)));\n03730|                     }\n03731|                   }\n03732|                 } catch (e) {\n03733|                   // –û—Å—Ç–∞–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n03734|                 }\n03735|                 \n03736|                 return {\n03737|                   company: 'Nord Wheel',\n03738|                   price: bestOption.price,\n03739|                   days: calculatedDays,\n03740|                   details: {\n03741|                     totalCost: bestOption.price,\n03742|                     deliveryCost: bestOption.price,\n03743|                     transportType: bestOption.type,\n03744|                     services: bestOption.services,\n03745|                     allOptions: options,\n03746|                     currency: 'RUB',\n03747|                     deliveryDate: bestOption.days,\n03748|                     note: `–†–∞—Å—á–µ—Ç –ø–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º (–∫–æ—ç—Ñ. ${scaleFactor.toFixed(2)})`\n03749|                   },\n03750|                   requestData: {\n03751|                     original: requestData,\n03752|                     fallback: fallbackRequestData,\n03753|                     scaleFactor\n03754|                   },\n03755|                   responseData: fallbackData,\n03756|                   apiUrl\n03757|                 };\n03758|               }\n03759|             }\n03760|           }\n03761|         }\n03762|         \n03763|         // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫ 400\n03764|         let errorMessage = result.error.userMessage || result.error.message || '–û—à–∏–±–∫–∞ API NordWheel';\n03765|         \n03766|         if (result.error.status === 400) {\n03767|           errorMessage += `. –ü—Ä–µ–≤—ã—à–µ–Ω—ã –ª–∏–º–∏—Ç—ã API: –≤–µ—Å >1000–∫–≥ –∏–ª–∏ –æ–±—ä–µ–º >5–º¬≥. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –≥—Ä—É–∑ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–π.`;\n03768|         }\n03769|         \n03770|         return {\n03771|           company: 'Nord Wheel',\n03772|           price: 0,\n03773|           days: 0,\n03774|           error: errorMessage,\n03775|           apiUrl,\n03776|           requestData\n03777|         };\n03778|       }\n03779| \n03780|       const response = result as Response;\n03781|       const data = await response.json();\n03782|       console.log('üöõ Nord Wheel API –æ—Ç–≤–µ—Ç:', data);\n03783| \n03784|        // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ API - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã\n03785|        let price = 0;\n03786|        let days = 0;\n03787|        let details: any = {};\n03788| \n03789|        // –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç API —Å auto/avia –æ–±—ä–µ–∫—Ç–∞–º–∏ (–ø—Ä–æ–≤–µ—Ä—è–µ–º –±–µ–∑ data.success)\n03790|        if (data.auto || data.avia) {\n03791|          const options: Array<{type: string, price: number, days: number, services: any[]}> = [];\n03792|          \n03793|          if (data.auto) {\n03794|            const autoPrice = data.auto.total_amount || 0;\n03795|            const autoDeliveryDate = data.auto.delivery_date || '';\n03796|            \n03797|            options.push({\n03798|              type: 'auto',\n03799|              price: autoPrice,\n03800|              days: autoDeliveryDate, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ —Å—Ç—Ä–æ–∫—É –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n03801|              services: data.auto.services || []\n03802|            });\n03803|          }\n03804|          \n03805|          if (data.avia) {\n03806|            const aviaPrice = data.avia.total_amount || 0;\n03807|            const aviaDeliveryDate = data.avia.delivery_date || '';\n03808|            \n03809|            options.push({\n03810|              type: 'avia',\n03811|              price: aviaPrice,\n03812|              days: aviaDeliveryDate, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ —Å—Ç—Ä–æ–∫—É –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n03813|              services: data.avia.services || []\n03814|            });\n03815|          }\n03816|          \n03817|          if (options.length === 0) {\n03818|            console.error('‚ùå Nord Wheel: –ù–µ—Ç –æ–ø—Ü–∏–π –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ –æ—Ç–≤–µ—Ç–µ:', data);\n03819|            return {\n03820|              company: 'Nord Wheel',\n03821|              price: 0,\n03822|              days: 0,\n03823|              error: '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–ø—Ü–∏–π –¥–æ—Å—Ç–∞–≤–∫–∏',\n03824|              apiUrl,\n03825|              requestData,\n03826|              responseData: data\n03827|            };\n03828|          }\n03829|          \n03830|          // –í—ã–±–∏—Ä–∞–µ–º —Å–∞–º—ã–π –¥–µ—à–µ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç\n03831|          const bestOption = options.reduce((best, current) => \n03832|            current.price < best.price ? current : best\n03833|          );\n03834|          \n03835|          price = bestOption.price;\n03836|          \n03837|          // –í—ã—á–∏—Å–ª—è–µ–º –¥–Ω–∏ –∏–∑ –¥–∞—Ç—ã –¥–æ—Å—Ç–∞–≤–∫–∏\n03838|          try {\n03839|            if (bestOption.days && typeof bestOption.days === 'string') {\n03840|              const deliveryDate = new Date(bestOption.days);\n03841|              const today = new Date();\n03842|              if (!isNaN(deliveryDate.getTime())) {\n03843|                const diffTime = deliveryDate.getTime() - today.getTime();\n03844|                days = Math.max(1, Math.ceil(diffTime / (1000 * 60 * 60 * 24)));\n03845|              } else {\n03846|                days = 3; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é\n03847|              }\n03848|            } else {\n03849|              days = 3; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é\n03850|            }\n03851|          } catch (dateError) {\n03852|            console.warn('‚ö†Ô∏è Nord Wheel: –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –¥–Ω–µ–π –∏–∑ –¥–∞—Ç—ã:', dateError);\n03853|            days = 3;\n03854|          }\n03855|          \n03856|          details = {\n03857|            totalCost: price,\n03858|            deliveryCost: price, // –í –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ\n03859|            transportType: bestOption.type,\n03860|            services: bestOption.services,\n03861|            allOptions: options, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n03862|            currency: 'RUB',\n03863|            deliveryDate: bestOption.days // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—É—é –¥–∞—Ç—É\n03864|          };\n03865|        } else if (data.price !== undefined) {\n03866|          // –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞\n03867|          price = data.price;\n03868|          days = data.days || data.delivery_time || 0;\n03869|          details = {\n03870|            totalCost: price,\n03871|            currency: data.currency || 'RUB'\n03872|          };\n03873|        } else {\n03874|          // –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ü–µ–Ω—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É\n03875|          console.error('‚ùå Nord Wheel: –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API:', data);\n03876|          return {\n03877|            company: 'Nord Wheel',\n03878|            price: 0,\n03879|            days: 0,\n03880|            error: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API',\n03881|            apiUrl,\n03882|            requestData,\n03883|            responseData: data\n03884|          };\n03885|        }\n03886| \n03887|       return {\n03888|         company: 'Nord Wheel',\n03889|         price: Math.round(price),\n03890|         days: days,\n03891|         details,\n03892|         requestData,\n03893|         responseData: data,\n03894|         apiUrl\n03895|       };\n03896|     } catch (error: any) {\n03897|       console.error('üöõ Nord Wheel –æ—à–∏–±–∫–∞:', error);\n03898|       return {\n03899|         company: 'Nord Wheel',\n03900|         price: 0,\n03901|         days: 0,\n03902|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03903|         apiUrl\n03904|       };\n03905|     }\n03906|   };\n03907|     const calculateCdek = async (): Promise<CalculationResult> => {\n03908|     const apiUrl = '/api/cdek';\n03909|     \n03910|     try {\n03911|       validateMultipleCargos(form.cargos);\n03912|       \n03913|       const packages = form.cargos.map(cargo => ({\n03914|         height: cargo.height,\n03915|         length: cargo.length,\n03916|         width: cargo.width,\n03917|         weight: cargo.weight * 1000\n03918|       }));\n03919| \n03920|       const requestData: any = {\n03921|         from_city: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n03922|         to_city: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n03923|         packages: packages\n03924|       };\n03925| \n03926|       if (form.needInsurance && form.declaredValue > 0) {\n03927|         requestData.services = [{\n03928|           code: 'INSURANCE',\n03929|           parameter: form.declaredValue\n03930|         }];\n03931|         console.log('üì¶ CDEK: –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ', form.declaredValue);\n03932|       }\n03933| \n03934|       console.log('üì¶ CDEK –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03935|       console.log('üì¶ CDEK –º–∞—Ä—à—Ä—É—Ç:', {\n03936|         fromAddressDelivery: form.fromAddressDelivery,\n03937|         fromLavsiteWarehouse: form.fromLavsiteWarehouse,\n03938|         toAddressDelivery: form.toAddressDelivery\n03939|       });\n03940| \n03941|        const result = await enhancedApiRequest(\n03942|          apiUrl,\n03943|          {\n03944|            method: 'POST',\n03945|            headers: {\n03946|              'Content-Type': 'application/json',\n03947|            },\n03948|            body: JSON.stringify(requestData)\n03949|          },\n03950|          { operation: 'calculate', company: '–°–î–≠–ö' }\n03951|        );\n03952| \n03953|        if (result && typeof result === 'object' && 'success' in result && !result.success) {\n03954|          console.error('‚ùå –°–î–≠–ö API –æ—à–∏–±–∫–∞:', result.error);\n03955|          return {\n03956|            company: '–°–î–≠–ö',\n03957|            price: 0,\n03958|            days: 0,\n03959|            error: result.error.userMessage || result.error.message,\n03960|            requestData,\n03961|            responseData: null,\n03962|            apiUrl\n03963|          };\n03964|        }\n03965| \n03966|        const response = result as Response;\n03967|        const data = await response.json();\n03968|        console.log('üì¶ CDEK –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω, —Ç–∞—Ä–∏—Ñ–æ–≤:', data.tariff_codes?.length || 0);\n03969| \n03970|       if (response.ok && data.tariff_codes && data.tariff_codes.length > 0) {\n03971|         const isFromDoor = form.fromAddressDelivery || form.fromLavsiteWarehouse;\n03972|         const isToDoor = form.toAddressDelivery;\n03973|         \n03974|         let deliveryMode: number;\n03975|         let deliveryModeText: string;\n03976|         \n03977|         if (isFromDoor && isToDoor) {\n03978|           deliveryMode = 1;\n03979|           deliveryModeText = '–¥–≤–µ—Ä—å-–¥–≤–µ—Ä—å';\n03980|         } else if (isFromDoor && !isToDoor) {\n03981|           deliveryMode = 2;\n03982|           deliveryModeText = '–¥–≤–µ—Ä—å-—Å–∫–ª–∞–¥';\n03983|         } else if (!isFromDoor && isToDoor) {\n03984|           deliveryMode = 3;\n03985|           deliveryModeText = '—Å–∫–ª–∞–¥-–¥–≤–µ—Ä—å';\n03986|         } else {\n03987|           deliveryMode = 4;\n03988|           deliveryModeText = '—Å–∫–ª–∞–¥-—Å–∫–ª–∞–¥';\n03989|         }\n03990| \n03991|         console.log(`üì¶ CDEK –≤—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º –¥–æ—Å—Ç–∞–≤–∫–∏: ${deliveryMode} (${deliveryModeText})`);\n03992| \n03993|         const filteredTariffs = data.tariff_codes.filter((t: any) => t.delivery_mode === deliveryMode);\n03994|         \n03995|         console.log(`üì¶ CDEK –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è —Ä–µ–∂–∏–º–∞ ${deliveryModeText}:`, filteredTariffs.length);\n03996| \n03997|         if (filteredTariffs.length === 0) {\n03998|           return {\n03999|             company: '–°–î–≠–ö',\n04000|             price: 0,\n04001|             days: 0,\n04002|             error: `–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∞ ${deliveryModeText}`,\n04003|             requestData,\n04004|             responseData: data,\n04005|             apiUrl\n04006|           };\n04007|         }\n04008| \n04009|         const bestTariff = filteredTariffs.reduce((min: any, tariff: any) => \n04010|           (tariff.delivery_sum < min.delivery_sum) ? tariff : min\n04011|         );\n04012| \n04013|         console.log(`üì¶ CDEK –ª—É—á—à–∏–π —Ç–∞—Ä–∏—Ñ: ${bestTariff.tariff_name} - ${bestTariff.delivery_sum}‚ÇΩ`);\n04014| \n04015|         const detailsRequest: any = {\n04016|           ...requestData,\n04017|           tariff_code: bestTariff.tariff_code,\n04018|           get_details: true\n04019|         };\n04020| \n04021|         console.log('üì¶ CDEK: –∑–∞–ø—Ä–æ—Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏...');\n04022| \n04023|           const detailsResult = await enhancedApiRequest(\n04024|             apiUrl,\n04025|             {\n04026|               method: 'POST',\n04027|               headers: {\n04028|                 'Content-Type': 'application/json',\n04029|               },\n04030|               body: JSON.stringify(detailsRequest)\n04031|             },\n04032|             { operation: 'tariff_details', company: '–°–î–≠–ö' }\n04033|           );\n04034| \n04035|           let tariffDetails: any = null;\n04036|           if (detailsResult && typeof detailsResult === 'object' && 'success' in detailsResult && detailsResult.success) {\n04037|             const detailsResponse = detailsResult as Response;\n04038|             if (detailsResponse.ok) {\n04039|               const detailsData = await detailsResponse.json();\n04040|               tariffDetails = detailsData.tariff_details;\n04041|               console.log('üì¶ –°–î–≠–ö –¥–µ—Ç–∞–ª–∏ —Ç–∞—Ä–∏—Ñ–∞:', tariffDetails);\n04042|             }\n04043|           }\n04044| \n04045|         const finalPrice = tariffDetails?.total_sum || bestTariff.delivery_sum;\n04046|         \n04047|         return {\n04048|           company: '–°–î–≠–ö',\n04049|           price: Math.round(finalPrice),\n04050|           days: bestTariff.period_max || 0,\n04051|           details: {\n04052|             tariff_name: bestTariff.tariff_name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n04053|             tariff_code: bestTariff.tariff_code,\n04054|             delivery_mode: deliveryModeText,\n04055|             period_min: bestTariff.period_min,\n04056|             period_max: bestTariff.period_max,\n04057|             calendar_min: bestTariff.calendar_min,\n04058|             calendar_max: bestTariff.calendar_max,\n04059|             all_tariffs: filteredTariffs,\n04060|             services: tariffDetails?.services || [],\n04061|             delivery_sum: tariffDetails?.delivery_sum || bestTariff.delivery_sum,\n04062|             total_sum: finalPrice,\n04063|             weight_calc: tariffDetails?.weight_calc\n04064|           },\n04065|           requestData,\n04066|           responseData: data,\n04067|           apiUrl\n04068|         };\n04069|       } else {\n04070|         return {\n04071|           company: '–°–î–≠–ö',\n04072|           price: 0,\n04073|           days: 0,\n04074|           error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –°–î–≠–ö',\n04075|           requestData,\n04076|           responseData: data,\n04077|           apiUrl\n04078|         };\n04079|       }\n04080|     } catch (error: any) {\n04081|       console.error('üì¶ –°–î–≠–ö –æ—à–∏–±–∫–∞:', error);\n04082|       return {\n04083|         company: '–°–î–≠–ö',\n04084|         price: 0,\n04085|         days: 0,\n04086|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n04087|         apiUrl\n04088|       };\n04089|     }\n04090|   };\n04091| \n04092|   const calculateKit = async (): Promise<CalculationResult> => {\n04093|     const apiUrl = '/api/kit';\n04094|     \n04095|     try {\n04096|       validateMultipleCargos(form.cargos);\n04097|       \n04098|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n04099| \n04100|       const requestData = {\n04101|         from_city: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n04102|         to_city: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n04103|         declared_price: form.declaredValue || 10000,\n04104|         service: ['S089']\n04105|       };\n04106| \n04107|       console.log('üöõ –ö–ò–¢ –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n04108| \n04109|        const result = await enhancedApiRequest(\n04110|          apiUrl,\n04111|          {\n04112|            method: 'POST',\n04113|            headers: {\n04114|              'Content-Type': 'application/json',\n04115|            },\n04116|            body: JSON.stringify(requestData)\n04117|          },\n04118|          { operation: 'calculate', company: '–ö–ò–¢' }\n04119|        );\n04120| \n04121|        if (result && typeof result === 'object' && 'success' in result && !result.success) {\n04122|          console.error('‚ùå –ö–ò–¢ API –æ—à–∏–±–∫–∞:', result.error);\n04123|          return {\n04124|            company: '–ö–ò–¢',\n04125|            price: 0,\n04126|            days: 0,\n04127|            error: result.error.userMessage || result.error.message,\n04128|            requestData,\n04129|            responseData: null,\n04130|            apiUrl\n04131|          };\n04132|        }\n04133| \n04134|        const response = result as Response;\n04135|        const data = await response.json();\n04136|        console.log('üöõ –ö–ò–¢ –æ—Ç–≤–µ—Ç:', data);\n04137| \n04138|       if (response.ok && Array.isArray(data) && data.length > 0) {\n04139|         const rubData = data.find((item: any) => {\n04140|           const tariffData: any = Object.values(item)[0];\n04141|           return tariffData?.currency_code === 'RUB';\n04142|         });\n04143|         \n04144|         if (rubData) {\n04145|           const tariffKey = Object.keys(rubData)[0];\n04146|           const tariffData: any = rubData[tariffKey];\n04147|           \n04148|           console.log('üöõ –ö–ò–¢ –≤—ã–±—Ä–∞–Ω —Ç–∞—Ä–∏—Ñ:', tariffKey, tariffData);\n04149| \n04150|           return {\n04151|             company: '–ö–ò–¢',\n04152|             price: Math.round(tariffData.cost || 0),\n04153|             days: tariffData.time || 0,\n04154|             details: {\n04155|               tariff_name: tariffData.name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n04156|               tariff_type: tariffKey,\n04157|               services: tariffData.detail || [],\n04158|               currency: tariffData.currency_code\n04159|             },\n04160|             requestData,\n04161|             responseData: data,\n04162|             apiUrl\n04163|           };\n04164|         }\n04165|       }\n04166| \n04167|       return {\n04168|         company: '–ö–ò–¢',\n04169|         price: 0,\n04170|         days: 0,\n04171|         error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –ö–ò–¢',\n04172|         requestData,\n04173|         responseData: data,\n04174|         apiUrl\n04175|       };\n04176|     } catch (error: any) {\n04177|       console.error('üöõ –ö–ò–¢ –æ—à–∏–±–∫–∞:', error);\n04178|       return {\n04179|         company: '–ö–ò–¢',\n04180|         price: 0,\n04181|         days: 0,\n04182|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n04183|         apiUrl\n04184|       };\n04185|     }\n04186|   };\n04187| \n04188|   const handleCalculate = async () => {\n04189|     const totalStartTime = performance.now();\n04190|     setCalculating(true);\n04191|     setCalculations([]);\n04192|     \n04193|     // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø–æ—Å–ª–µ —Ä–∞—Å—á–µ—Ç–∞ (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ, –±–µ–∑ –¥–µ–±–∞—É–Ω—Å–∞)\n04194|     saveFormData({\n04195|       cargos: form.cargos,\n04196|       fromCity: form.fromCity,\n04197|       toCity: form.toCity,\n04198|       fromAddress: form.fromAddress,\n04199|       toAddress: form.toAddress,\n04200|       declaredValue: form.declaredValue,\n04201|       needPackaging: form.needPackaging,\n04202|       needLoading: form.needLoading,\n04203|       needCarry: form.needCarry,\n04204|       floor: form.floor,\n04205|       hasFreightLift: form.hasFreightLift,\n04206|       needInsurance: form.needInsurance,\n04207|       fromTerminal: form.fromTerminal,\n04208|       toTerminal: form.toTerminal,\n04209|       fromAddressDelivery: form.fromAddressDelivery,\n04210|       toAddressDelivery: form.toAddressDelivery,\n04211|       selectedProducts: form.selectedProducts,\n04212|     });\n04213|     \n04214|     try {\n04215|       console.log('üöÄ === –ù–ê–ß–ê–õ–û –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–û–ì–û –†–ê–°–ß–ï–¢–ê ===');\n04216|       \n04217|       // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞\n04218|       const { optimizedApiClient } = await import('@/lib/optimized-api-client');\n04219|       const { cacheManager } = await import('@/lib/cache-manager');\n04220|       \n04221|       // 1. –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–µ—Å—Å–∏–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ\n04222|       const preloadStartTime = performance.now();\n04223|       await optimizedApiClient.preloadCalculationData(form);\n04224|       const preloadDuration = performance.now() - preloadStartTime;\n04225|       console.log(`‚ö° –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∑–∞ ${preloadDuration.toFixed(0)}–º—Å`);\n04226|       \n04227|       // 2. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∫–ª—é—á–µ–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏\n04228|       const enabledCompaniesList: Array<{ name: string; key: string; func: () => Promise<CalculationResult> }> = [];\n04229|       \n04230|       if (enabledCompanies.pek) enabledCompaniesList.push({ name: '–ü–≠–ö', key: 'pek', func: calculatePEK });\n04231|       if (enabledCompanies.dellin) enabledCompaniesList.push({ name: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏', key: 'dellin', func: calculateDellin });\n04232|       if (enabledCompanies.railcontinent) enabledCompaniesList.push({ name: 'Rail Continent', key: 'railcontinent', func: calculateRailContinent });\n04233|       if (enabledCompanies.vozovoz) enabledCompaniesList.push({ name: '–í–æ–∑–æ–≤–æ–∑', key: 'vozovoz', func: calculateVozovoz });\n04234|       if (enabledCompanies.nordwheel) enabledCompaniesList.push({ name: 'Nord Wheel', key: 'nordwheel', func: calculateNordWheel });\n04235|       if (enabledCompanies.cdek) enabledCompaniesList.push({ name: '–°–¥—ç–∫', key: 'cdek', func: calculateCdek });\n04236|       if (enabledCompanies.kit) enabledCompaniesList.push({ name: '–ö–∏—Ç', key: 'kit', func: calculateKit });\n04237|       \n04238|       // –ï—Å–ª–∏ –Ω–∏ –æ–¥–Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞\n04239|       if (enabledCompaniesList.length === 0) {\n04240|         setCalculations([]);\n04241|         return;\n04242|       }\n04243|       \n04244|       console.log(`üìã –ó–∞–ø—É—Å–∫ —Ä–∞—Å—á–µ—Ç–æ–≤ –¥–ª—è ${enabledCompaniesList.length} –∫–æ–º–ø–∞–Ω–∏–π:`, enabledCompaniesList.map(c => c.name));\n04245|       \n04246|       // 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞\n04247|       setCalculationProgress({\n04248|         companies: enabledCompaniesList.map(company => ({\n04249|           name: company.name,\n04250|           status: 'pending'\n04251|         })),\n04252|         totalDuration: 0\n04253|       });\n04254|       \n04255|       // 4. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ä–∞—Å—á–µ—Ç–æ–≤ —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞\n04256|       const calculationStartTime = performance.now();\n04257|       const calculationPromises = enabledCompaniesList.map(async (company, index) => {\n04258|         const companyStartTime = performance.now();\n04259|         \n04260|         // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ \"loading\"\n04261|         setCalculationProgress(prev => ({\n04262|           ...prev,\n04263|           companies: prev.companies.map((c, i) => \n04264|             i === index ? { ...c, status: 'loading', progress: 0 } : c\n04265|           )\n04266|         }));\n04267|         \n04268|         try {\n04269|           const result = await optimizedApiClient.calculateWithCache(\n04270|             company.key,\n04271|             company.func,\n04272|             form\n04273|           );\n04274|           \n04275|           const duration = performance.now() - companyStartTime;\n04276|           \n04277|           // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ \"completed\"\n04278|           setCalculationProgress(prev => ({\n04279|             ...prev,\n04280|             companies: prev.companies.map((c, i) => \n04281|               i === index ? { \n04282|                 ...c, \n04283|                 status: 'completed', \n04284|                 progress: 100, \n04285|                 duration \n04286|               } : c\n04287|             )\n04288|           }));\n04289|           \n04290|           return result;\n04291|         } catch (error) {\n04292|           const duration = performance.now() - companyStartTime;\n04293|           const errorMessage = error instanceof Error ? error.message : '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞';\n04294|           \n04295|           // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ \"error\"\n04296|           setCalculationProgress(prev => ({\n04297|             ...prev,\n04298|             companies: prev.companies.map((c, i) => \n04299|               i === index ? { \n04300|                 ...c, \n04301|                 status: 'error', \n04302|                 error: errorMessage,\n04303|                 duration \n04304|               } : c\n04305|             )\n04306|           }));\n04307|           \n04308|           console.error(`‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ ${company.name}:`, error);\n04309|           return {\n04310|             company: company.name,\n04311|             price: 0,\n04312|             days: 0,\n04313|             error: errorMessage,\n04314|             duration\n04315|           };\n04316|         }\n04317|       });\n04318|       \n04319|       const results = await Promise.allSettled(calculationPromises);\n04320|       const calculationDuration = performance.now() - calculationStartTime;\n04321|       \n04322|       // 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤\n04323|       const validResults: CalculationResult[] = [];\n04324|       const errors: string[] = [];\n04325|       \n04326|       results.forEach((result, index) => {\n04327|         if (result.status === 'fulfilled') {\n04328|           validResults.push(result.value);\n04329|         } else {\n04330|           const companyName = enabledCompaniesList[index].name;\n04331|           errors.push(`${companyName}: ${result.reason}`);\n04332|           console.error(`‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ ${companyName}:`, result.reason);\n04333|         }\n04334|       });\n04335|       \n04336|       // 5. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤\n04337|       const sortedResults = validResults\n04338|         .filter(result => !result.error)\n04339|         .sort((a, b) => a.price - b.price)\n04340|         .concat(validResults.filter(result => result.error));\n04341|       \n04342|       // 6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n04343|       const totalDuration = performance.now() - totalStartTime;\n04344|       const successCount = sortedResults.filter(r => !r.error).length;\n04345|       const cacheStats = cacheManager.getCacheStats();\n04346|       \n04347|       console.log(`‚úÖ === –†–ê–°–ß–ï–¢ –ó–ê–í–ï–†–®–ï–ù ===`);\n04348|       console.log(`‚è±Ô∏è –û–±—â–µ–µ –≤—Ä–µ–º—è: ${totalDuration.toFixed(0)}–º—Å`);\n04349|       console.log(`‚ö° –†–∞—Å—á–µ—Ç—ã: ${calculationDuration.toFixed(0)}–º—Å`);\n04350|       console.log(`üìä –£—Å–ø–µ—à–Ω–æ: ${successCount}/${enabledCompaniesList.length}`);\n04351|       console.log(`üíæ –ö—ç—à: —Å–µ—Å—Å–∏–π=${cacheStats.sessions}, —Ä–∞—Å—á–µ—Ç–æ–≤=${cacheStats.calculations}`);\n04352|       \n04353|       if (errors.length > 0) {\n04354|         console.warn(`‚ö†Ô∏è –û—à–∏–±–∫–∏: ${errors.join('; ')}`);\n04355|       }\n04356|       \n04357|       // –§–∏–Ω–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞\n04358|       setCalculationProgress(prev => ({\n04359|         ...prev,\n04360|         totalDuration: totalDuration\n04361|       }));\n04362|       \n04363|       setCalculations(sortedResults);\n04364|       \n04365|     } catch (error) {\n04366|       console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ:', error);\n04367|       setCalculations([{\n04368|         company: '–°–∏—Å—Ç–µ–º–∞',\n04369|         price: 0,\n04370|         days: 0,\n04371|         error: error instanceof Error ? error.message : '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞'\n04372|       }]);\n04373|     } finally {\n04374|       setCalculating(false);\n04375|     }\n04376|   };\n04377| \n04378|   const exportToPDF = () => {\n04379|     if (typeof window !== 'undefined') {\n04380|       // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Å–µ –¥–µ—Ç–∞–ª–∏ –ø–µ—Ä–µ–¥ –ø–µ—á–∞—Ç—å—é\n04381|       const allExpanded = calculations.reduce((acc, calc) => {\n04382|         acc[calc.company] = true;\n04383|         return acc;\n04384|       }, {} as { [key: string]: boolean });\n04385|       \n04386|       setExpandedDetails(allExpanded);\n04387|       \n04388|       // –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DOM\n04389|       setTimeout(() => {\n04390|         window.print();\n04391|       }, 100);\n04392|     }\n04393|   };\n04394| \n04395|   const toggleDetails = (company: string) => {\n04396|     setExpandedDetails(prev => ({\n04397|       ...prev,\n04398|       [company]: !prev[company]\n04399|     }));\n04400|   };\n04401| \n04402|   const toggleDebugInfo = (company: string) => {\n04403|     setExpandedDebugInfo(prev => ({\n04404|       ...prev,\n04405|       [company]: !prev[company]\n04406|     }));\n04407|   };\n04408| \n04409|   // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞—Å—á–µ—Ç–∞\n04410|   const handleReset = () => {\n04411|     if (typeof window !== 'undefined') {\n04412|       // –û—á–∏—â–∞–µ–º localStorage\n04413|       localStorage.removeItem('deliveryForm');\n04414|       \n04415|       // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É\n04416|       setForm(initialFormState);\n04417|       \n04418|       // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è\n04419|       setCalculations([]);\n04420|       setExpandedDetails({});\n04421|       setExpandedDebugInfo({});\n04422|       setSuggestions([]);\n04423|       setShowSuggestions(false);\n04424|       setActiveField('');\n04425|       \n04426|       console.log('–§–æ—Ä–º–∞ —Å–±—Ä–æ—à–µ–Ω–∞ –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é');\n04427|     }\n04428|   };\n04429| \n04430|   // –ü–∞—Ä—Å–µ—Ä –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è —á–∏—Ç–∞–µ–º–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞\n04431|   const parseCalculationDetails = (calc: CalculationResult) => {\n04432|     console.log('üîç parseCalculationDetails –ø–æ–ª—É—á–∏–ª calc:', calc?.company || 'undefined');\n04433|     console.log('üîç calc.details:', calc?.details ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n04434|     console.log('üîç typeof calc.details:', typeof calc?.details);\n04435|     \n04436|     const details: { service: string; description: string; price: number }[] = [];\n04437|     \n04438|     try {\n04439|       if (calc.company === '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏' && calc.details) {\n04440|         console.log('üîç –ù–∞—á–∏–Ω–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–µ—Ç–∞–ª–µ–π –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π...');\n04441|       // –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ (—É–∂–µ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –±–∞–∑–æ–≤—ã–µ —É—Å–ª—É–≥–∏ –∏ —É–ø–∞–∫–æ–≤–∫—É)\n04442|       let basePrice = calc.details?.price || calc.price || 0;\n04443|       \n04444|       // –†–∞–∑–±–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ\n04445|       let intercityPrice = 0;\n04446|       let derivalPrice = 0;\n04447|       let arrivalPrice = 0;\n04448|       let packagingPrice = 0;\n04449|       // packagingPremiums –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è - –Ω–∞–¥–±–∞–≤–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ pkg.price\n04450|       let insurancePrice = 0;\n04451|       \n04452|       // –ú–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞\n04453|       if (calc.details?.intercity?.price) {\n04454|         intercityPrice = calc.details.intercity.price;\n04455|         details.push({\n04456|           service: '–ú–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞',\n04457|           description: `${form.fromCity} - ${form.toCity}`,\n04458|           price: intercityPrice\n04459|         });\n04460|       }\n04461|       \n04462|       // –ó–∞–±–æ—Ä –≥—Ä—É–∑–∞\n04463|       if (calc.details?.derival?.price) {\n04464|         derivalPrice = calc.details.derival.price;\n04465|         details.push({\n04466|           service: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n04467|           description: '–û—Ç –∞–¥—Ä–µ—Å–∞',\n04468|           price: derivalPrice\n04469|         });\n04470|       }\n04471|       \n04472|       // –î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞\n04473|       if (calc.details?.arrival?.price) {\n04474|         arrivalPrice = calc.details.arrival.price;\n04475|         details.push({\n04476|           service: '–û—Ç–≤–æ–∑ –≥—Ä—É–∑–∞',\n04477|           description: '–î–æ –∞–¥—Ä–µ—Å–∞',\n04478|           price: arrivalPrice\n04479|         });\n04480|       }\n04481|       \n04482|       // –£–ø–∞–∫–æ–≤–∫–∞ (–Ω–∞–¥–±–∞–≤–∫–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ pkg.price, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏)\n04483|       if (form.needPackaging && calc.details?.packages) {\n04484|         Object.entries(calc.details?.packages || {}).forEach(([key, pkg]: [string, any]) => {\n04485|           if (pkg.price && pkg.price > 0) {\n04486|             // –í—ã—á–∏—Å–ª—è–µ–º –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É —É–ø–∞–∫–æ–≤–∫–∏ (–±–µ–∑ –Ω–∞–¥–±–∞–≤–æ–∫) –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n04487|             let basePkgPrice = pkg.price;\n04488|             let totalPremiums = 0;\n04489|             \n04490|             if (pkg.premiumDetails && Array.isArray(pkg.premiumDetails)) {\n04491|               totalPremiums = pkg.premiumDetails.reduce((sum: number, premium: any) => \n04492|                 sum + (premium.value || 0), 0);\n04493|               basePkgPrice = pkg.price - totalPremiums;\n04494|             }\n04495|             \n04496|             packagingPrice += pkg.price; // –í –æ–±—â—É—é —Å—É–º–º—É –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–Ω—É—é —Ü–µ–Ω—É\n04497|             \n04498|             // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—É—é —É–ø–∞–∫–æ–≤–∫—É\n04499|             details.push({\n04500|               service: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n04501|               description: '–£–ø–∞–∫–æ–≤–∞—Ç—å –≤ –∫–æ–º–ø–ª–µ–∫—Å ¬´–æ–±—Ä–µ—à—ë—Ç–∫–∞ + –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è¬ª',\n04502|               price: basePkgPrice\n04503|             });\n04504|             \n04505|             // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–¥–±–∞–≤–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ (–¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏, –Ω–æ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –∫ –æ–±—â–µ–π —Å—É–º–º–µ)\n04506|             if (pkg.premiumDetails && Array.isArray(pkg.premiumDetails)) {\n04507|               pkg.premiumDetails.forEach((premium: any) => {\n04508|                 if (premium.value && premium.value > 0) {\n04509|                   details.push({\n04510|                     service: '–ù–∞–¥–±–∞–≤–∫–∞ –∫ —É–ø–∞–∫–æ–≤–∫–µ',\n04511|                     description: premium.name || '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–¥–±–∞–≤–∫–∞',\n04512|                     price: premium.value\n04513|                   });\n04514|                 }\n04515|               });\n04516|             }\n04517|           }\n04518|         });\n04519|       }\n04520|       \n04521|       // –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ\n04522|       if (form.needInsurance && calc.details?.insurance) {\n04523|         insurancePrice = calc.details.insurance;\n04524|         details.push({\n04525|           service: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n04526|           description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n04527|           price: insurancePrice\n04528|         });\n04529|       }\n04530|       \n04531|       // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏\n04532|       details.push({\n04533|         service: '–î–æ–ø.—É—Å–ª—É–≥–∏',\n04534|         description: '–ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ –≥—Ä—É–∑–∞',\n04535|         price: 15\n04536|       });\n04537|       \n04538|       // –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –º–µ–∂–¥—É —Å—É–º–º–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é, –¥–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞—Ç–æ–∫\n04539|       const calculatedSum = intercityPrice + derivalPrice + arrivalPrice + packagingPrice + insurancePrice + 15;\n04540|       const remainder = basePrice - calculatedSum;\n04541|       \n04542|       if (Math.abs(remainder) > 1) { // –ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –±–æ–ª—å—à–µ 1 —Ä—É–±–ª—è\n04543|         details.push({\n04544|           service: remainder > 0 ? '–ü—Ä–æ—á–∏–µ —É—Å–ª—É–≥–∏' : '–°–∫–∏–¥–∫–∞',\n04545|           description: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–±–æ—Ä—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏',\n04546|           price: remainder\n04547|         });\n04548|       }\n04549|      } else if (calc.company === 'Nord Wheel' && calc.details) {\n04550|        // –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –¥–ª—è Nord Wheel —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º\n04551|        if (calc.details.totalCost) {\n04552|          details.push({\n04553|            service: '–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',\n04554|            description: calc.details.transportType ? `–¢–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞: ${calc.details.transportType}` : '',\n04555|            price: calc.details.totalCost\n04556|          });\n04557|        }\n04558|        \n04559|        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ª—É–≥–∏ –∏–∑ –æ—Ç–≤–µ—Ç–∞ API\n04560|        if (calc.details.services && Array.isArray(calc.details.services)) {\n04561|          calc.details.services.forEach((service: any) => {\n04562|            if (service.name && service.price) {\n04563|              details.push({\n04564|                service: service.name,\n04565|                description: service.description || '',\n04566|                price: service.price\n04567|              });\n04568|            }\n04569|          });\n04570|        }\n04571|        \n04572|        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n04573|        if (calc.details.allOptions && Array.isArray(calc.details.allOptions)) {\n04574|          details.push({\n04575|            service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n04576|            description: '',\n04577|            price: 0\n04578|          });\n04579|          details.push({\n04580|            service: '–î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã',\n04581|            description: `–í—ã–±—Ä–∞–Ω: ${calc.details.transportType}`,\n04582|            price: 0\n04583|          });\n04584|          \n04585|          calc.details.allOptions.forEach((option: any) => {\n04586|            details.push({\n04587|              service: `–í–∞—Ä–∏–∞–Ω—Ç ${option.type}`,\n04588|              description: `${option.days} –¥–Ω–µ–π`,\n04589|              price: option.price\n04590|            });\n04591|          });\n04592|        }\n04593| \n04594|     } else if (calc.company === '–ü–≠–ö' && calc.details?.services) {\n04595|       // –î–ª—è –ü–≠–ö –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ API\n04596|       calc.details.services.forEach((service: any) => {\n04597|         if (service.price > 0) {\n04598|           details.push({\n04599|             service: service.name || '–£—Å–ª—É–≥–∞ –ü–≠–ö',\n04600|             description: service.description || '',\n04601|             price: service.price\n04602|           });\n04603|         }\n04604|       });\n04605|     } else if (calc.company === '–°–î–≠–ö' && calc.details) {\n04606|       const cdekServiceNames: Record<string, string> = {\n04607|         'INSURANCE': '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n04608|         'HEAVY_CARGO': '–¢—è–∂–µ–ª–æ–≤–µ—Å–Ω—ã–π –≥—Ä—É–∑',\n04609|         'DELIVERY_TO_DOOR': '–î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –¥–≤–µ—Ä–∏',\n04610|         'PICKUP_FROM_SENDER': '–ó–∞–±–æ—Ä –æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è',\n04611|         'PACKAGE': '–£–ø–∞–∫–æ–≤–∫–∞',\n04612|         'TRYING_ON': '–ü—Ä–∏–º–µ—Ä–∫–∞ –Ω–∞ –¥–æ–º—É',\n04613|         'PART_DELIVERY': '–ß–∞—Å—Ç–∏—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞'\n04614|       };\n04615| \n04616|       if (calc.details.services && calc.details.services.length > 0) {\n04617|         calc.details.services.forEach((service: any) => {\n04618|           const serviceName = cdekServiceNames[service.code] || service.code || '–£—Å–ª—É–≥–∞ –°–î–≠–ö';\n04619|           const servicePrice = service.total_sum || service.sum || 0;\n04620|           \n04621|           if (servicePrice > 0) {\n04622|             details.push({\n04623|               service: serviceName,\n04624|               description: service.code === 'HEAVY_CARGO' \n04625|                 ? `–°–±–æ—Ä –∑–∞ –≥–∞–±–∞—Ä–∏—Ç–Ω—ã–π –≥—Ä—É–∑ (—Ä–∞—Å—á–µ—Ç–Ω—ã–π –≤–µ—Å: ${(calc.details.weight_calc / 1000).toFixed(0)} –∫–≥)`\n04626|                 : service.code === 'INSURANCE'\n04627|                 ? `–û–±—ä—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${form.declaredValue?.toLocaleString() || 0} ‚ÇΩ`\n04628|                 : '',\n04629|               price: servicePrice\n04630|             });\n04631|           }\n04632|         });\n04633|         \n04634|         if (calc.details.delivery_sum && calc.details.total_sum) {\n04635|           details.push({\n04636|             service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n04637|             description: '',\n04638|             price: 0\n04639|           });\n04640|           details.push({\n04641|             service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',\n04642|             description: calc.details.tariff_name || '–ü–µ—Ä–µ–≤–æ–∑–∫–∞',\n04643|             price: Math.round(calc.details.delivery_sum)\n04644|           });\n04645|           \n04646|           const additionalSum = calc.details.services.reduce((sum: number, s: any) => \n04647|             sum + (s.total_sum || s.sum || 0), 0\n04648|           );\n04649|           \n04650|           if (additionalSum > 0) {\n04651|             details.push({\n04652|               service: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏',\n04653|               description: '–î–æ–ø. —Å–±–æ—Ä—ã',\n04654|               price: Math.round(additionalSum)\n04655|             });\n04656|           }\n04657|           \n04658|           details.push({\n04659|             service: '–ò–¢–û–ì–û',\n04660|             description: '–ö –æ–ø–ª–∞—Ç–µ',\n04661|             price: Math.round(calc.details.total_sum)\n04662|           });\n04663|         }\n04664|       } else {\n04665|         details.push({\n04666|           service: '–¢–∞—Ä–∏—Ñ',\n04667|           description: calc.details.tariff_name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n04668|           price: calc.price\n04669|         });\n04670|         \n04671|         if (calc.details.delivery_mode) {\n04672|           details.push({\n04673|             service: '–†–µ–∂–∏–º –¥–æ—Å—Ç–∞–≤–∫–∏',\n04674|             description: calc.details.delivery_mode,\n04675|             price: 0\n04676|           });\n04677|         }\n04678|       }\n04679|       \n04680|       if (calc.details.period_min && calc.details.period_max) {\n04681|         details.push({\n04682|           service: '–°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏',\n04683|           description: `${calc.details.period_min}-${calc.details.period_max} –¥–Ω–µ–π`,\n04684|           price: 0\n04685|         });\n04686|       }\n04687|       \n04688|       if (calc.details.weight_calc) {\n04689|         details.push({\n04690|           service: '–†–∞—Å—á–µ—Ç–Ω—ã–π –≤–µ—Å',\n04691|           description: `${calc.details.weight_calc} –∫–≥`,\n04692|           price: 0\n04693|         });\n04694|       }\n04695|     } else if (calc.company === '–í–æ–∑–æ–≤–æ–∑' && calc.details?.service) {\n04696|       // ‚úÖ –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –í–æ–∑–æ–≤–æ–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ API –æ—Ç–≤–µ—Ç–∞\n04697|       const basePrice = calc.details.basePrice || 0;\n04698|       const finalPrice = calc.details.price || calc.price || 0;\n04699|       const totalDiscount = basePrice - finalPrice;\n04700|       \n04701|       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é —É—Å–ª—É–≥—É —Å –±–∞–∑–æ–≤–æ–π —Ü–µ–Ω–æ–π –∏ —Å–∫–∏–¥–∫–æ–π\n04702|       calc.details.service.forEach((service: any) => {\n04703|         const serviceDiscount = (service.basePrice || 0) - (service.price || 0);\n04704|         \n04705|         // –û—Å–Ω–æ–≤–Ω–∞—è —É—Å–ª—É–≥–∞\n04706|         details.push({\n04707|           service: service.name || '–£—Å–ª—É–≥–∞ –í–æ–∑–æ–≤–æ–∑',\n04708|           description: '',\n04709|           price: service.price || 0\n04710|         });\n04711|         \n04712|         // –°–∫–∏–¥–∫–∞ –Ω–∞ —É—Å–ª—É–≥—É (–µ—Å–ª–∏ –µ—Å—Ç—å)\n04713|         if (serviceDiscount > 0) {\n04714|           details.push({\n04715|             service: `–°–∫–∏–¥–∫–∞ –Ω–∞ ${service.name?.toLowerCase() || '—É—Å–ª—É–≥—É'}`,\n04716|             description: `${(service.basePrice || 0).toLocaleString()} - ${(service.price || 0).toLocaleString()}`,\n04717|             price: -serviceDiscount\n04718|           });\n04719|         }\n04720|       });\n04721|       \n04722|       // –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Å –æ–±—â–∏–º–∏ —Å–∫–∏–¥–∫–∞–º–∏\n04723|       if (totalDiscount > 0) {\n04724|         details.push({\n04725|           service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n04726|           description: '',\n04727|           price: 0\n04728|         });\n04729|         details.push({\n04730|           service: '–ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å',\n04731|           description: '–î–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–∫–∏–¥–æ–∫',\n04732|           price: basePrice\n04733|         });\n04734|         details.push({\n04735|           service: '–û–±—â–∏–µ —Å–∫–∏–¥–∫–∏',\n04736|           description: `–≠–∫–æ–Ω–æ–º–∏—è ${totalDiscount.toLocaleString()} ‚ÇΩ`,\n04737|           price: -totalDiscount\n04738|         });\n04739|         details.push({\n04740|           service: '–ò–¢–û–ì–û',\n04741|           description: '–ö –æ–ø–ª–∞—Ç–µ',\n04742|           price: finalPrice\n04743|         });\n04744|       }\n04745|     } else if (calc.company === '–ö–ò–¢' && calc.details?.services) {\n04746|       calc.details.services.forEach((service: any) => {\n04747|         details.push({\n04748|           service: service.name || '–£—Å–ª—É–≥–∞ –ö–ò–¢',\n04749|           description: service.code || '',\n04750|           price: service.price || 0\n04751|         });\n04752|       });\n04753|       \n04754|       if (calc.details.tariff_name) {\n04755|         details.push({\n04756|           service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n04757|           description: '',\n04758|           price: 0\n04759|         });\n04760|         details.push({\n04761|           service: '–¢–∞—Ä–∏—Ñ',\n04762|           description: calc.details.tariff_name,\n04763|           price: 0\n04764|         });\n04765|         details.push({\n04766|           service: '–ò–¢–û–ì–û',\n04767|           description: calc.details.currency || 'RUB',\n04768|           price: calc.price\n04769|         });\n04770|       }\n04771|     } else {\n04772|       // –î–ª—è –¥—Ä—É–≥–∏—Ö –¢–ö - –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n04773|       details.push({\n04774|         service: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n04775|         description: `${form.fromCity} - ${form.toCity}`,\n04776|         price: calc.price\n04777|       });\n04778|       \n04779|       if (form.needInsurance && form.declaredValue > 0) {\n04780|         details.push({\n04781|           service: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ',\n04782|           description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n04783|           price: Math.round(form.declaredValue * 0.02)\n04784|         });\n04785|       }\n04786|       \n04787|       if (form.needPackaging) {\n04788|         const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n04789|         details.push({\n04790|           service: '–£–ø–∞–∫–æ–≤–∫–∞',\n04791|           description: '',\n04792|           price: Math.round(totalWeight * 30)\n04793|         });\n04794|       }\n04795|     }\n04796|     \n04797|     return details;\n04798|   } catch (globalError) {\n04799|     console.error('‚ùå –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –û–®–ò–ë–ö–ê –≤ parseCalculationDetails:', globalError);\n04800|     console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', globalError instanceof Error ? globalError.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n04801|     console.log('‚ùå calc object:', calc);\n04802|     // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ\n04803|     return [{\n04804|       service: '–î–æ—Å—Ç–∞–≤–∫–∞',\n04805|       description: '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞',\n04806|       price: calc?.price || 0\n04807|     }];\n04808|   }\n04809| };\n04810| \n04811|   // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –ø–æ–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏)\n04812|   if (!isLoaded) {\n04813|     return (\n04814|       <div className=\"min-h-screen bg-gray-900 text-white p-4 relative flex items-center justify-center\">\n04815|         <div className=\"text-center\">\n04816|           <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400 mx-auto mb-4\"></div>\n04817|           <p className=\"text-blue-400\">–ó–∞–≥—Ä—É–∑–∫–∞...</p>\n04818|         </div>\n04819|       </div>\n04820|     );\n04821|   }\n04822| \n04823|   return (\n04824|     <div className=\"min-h-screen bg-gray-900 text-white p-4 relative\">\n04825|       <div className=\"max-w-7xl mx-auto\">\n04826|         <div className=\"flex items-center justify-between mb-3\">\n04827|           <h1 className=\"text-xl font-bold text-blue-400\">\n04828|             –ú–µ–∂–¥—É–≥–æ—Ä–æ–¥–Ω—è—è –¥–æ—Å—Ç–∞–≤–∫–∞ –õ–∞–≤—Å–∏—Ç\n04829|           </h1>\n04830|           \n04831|           {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è */}\n04832|           <div className=\"flex items-center gap-4\">\n04833|             {isFormChanged ? (\n04834|               <div className=\"flex items-center gap-2 text-yellow-400 text-sm\">\n04835|                 <div className=\"w-2 h-2 bg-yellow-400 rounded-full animate-pulse\"></div>\n04836|                 –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...\n04837|               </div>\n04838|             ) : lastSaveTime ? (\n04839|               <div className=\"flex items-center gap-2 text-green-400 text-sm\">\n04840|                 <div className=\"w-2 h-2 bg-green-400 rounded-full\"></div>\n04841|                 –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ {lastSaveTime.toLocaleTimeString()}\n04842|               </div>\n04843|             ) : hasStoredFormData() ? (\n04844|               <div className=\"flex items-center gap-2 text-blue-400 text-sm\">\n04845|                 <div className=\"w-2 h-2 bg-blue-400 rounded-full\"></div>\n04846|                 –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã\n04847|               </div>\n04848|             ) : null}\n04849|             \n04850|             {/* –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö */}\n04851|             {hasStoredFormData() && (\n04852|               <Button\n04853|                 onClick={() => {\n04854|                   if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã?')) {\n04855|                     clearFormData();\n04856|                     setForm(initialFormState);\n04857|                     setLastSaveTime(null);\n04858|                     setIsFormChanged(false);\n04859|                   }\n04860|                 }}\n04861|                 variant=\"outline\"\n04862|                 size=\"sm\"\n04863|                 className=\"border-red-500 text-red-400 hover:bg-red-900/20\"\n04864|               >\n04865|                 <Trash2 className=\"h-3 w-3 mr-1\" />\n04866|                 –û—á–∏—Å—Ç–∏—Ç—å\n04867|               </Button>\n04868|             )}\n04869|           </div>\n04870|         </div>\n04871|         \n04872|         {/* –ö–Ω–æ–ø–∫–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ */}\n04873|         <div className=\"flex justify-end gap-2 mb-4\">\n04874|           <Button \n04875|             onClick={() => window.open('/diagnostic?tab=api', '_blank')}\n04876|             variant=\"outline\" \n04877|             className=\"border-green-500 text-green-400 hover:bg-green-900/20\"\n04878|           >\n04879|             <Settings className=\"h-4 w-4 mr-2\" />\n04880|             –í—Å–µ API\n04881|           </Button>\n04882|           <Button \n04883|             onClick={() => window.open('/diagnostic?tab=docs', '_blank')}\n04884|             variant=\"outline\" \n04885|             className=\"border-purple-500 text-purple-400 hover:bg-purple-900/20\"\n04886|           >\n04887|             <Package2 className=\"h-4 w-4 mr-2\" />\n04888|             –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è\n04889|           </Button>\n04890|           <Button \n04891|             onClick={() => window.open('/diagnostic', '_blank')}\n04892|             variant=\"outline\" \n04893|             className=\"border-blue-500 text-blue-400 hover:bg-blue-900/20\"\n04894|           >\n04895|             <Settings className=\"h-4 w-4 mr-2\" />\n04896|             –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞\n04897|           </Button>\n04898|         </div>\n04899|         \n04900|         <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-3 h-[85vh]\">\n04901|           {/* –õ–µ–≤–∞—è —á–∞—Å—Ç—å - —Ñ–æ—Ä–º–∞ */}\n04902|           <div className=\"space-y-2 overflow-y-auto pr-2\">\n04903|             {/* –ö–∞—Ç–∞–ª–æ–≥ –º–µ–±–µ–ª–∏ */}\n04904|             <Card className=\"bg-gray-800 border-gray-700\">\n04905|               <CardHeader className=\"pb-2\">\n04906|                 <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n04907|                   <Package2 className=\"h-3 w-3\" />\n04908|                   –ö–∞—Ç–∞–ª–æ–≥ –º–µ–±–µ–ª–∏\n04909|                 </CardTitle>\n04910|               </CardHeader>\n04911|               <CardContent className=\"space-y-2\">\n04912|                 {/* –ü–æ–∏—Å–∫ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ */}\n04913|                 <LazyProductSearch \n04914|                   onProductAdd={handleProductAdd}\n04915|                   disabled={calculating}\n04916|                 />\n04917|                 \n04918|                 {/* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏ */}\n04919|                 <ProductManager\n04920|                   products={form.selectedProducts}\n04921|                   onQuantityChange={handleProductQuantityChange}\n04922|                   onProductRemove={handleProductRemove}\n04923|                   disabled={calculating}\n04924|                 />\n04925|               </CardContent>\n04926|             </Card>\n04927| \n04928|             {/* –ì—Ä—É–∑—ã */}\n04929|             <Card className=\"bg-gray-800 border-gray-700\">\n04930|               <CardHeader className=\"pb-2\">\n04931|                 <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n04932|                   <Truck className=\"h-3 w-3\" />\n04933|                   –ì—Ä—É–∑—ã\n04934|                 </CardTitle>\n04935|               </CardHeader>\n04936|               <CardContent className=\"space-y-2\">\n04937|                 {groupCargosForDisplay(form.cargos).map((group, groupIndex) => (\n04938|                    <div key={`group_${groupIndex}`} className=\"border border-gray-600 rounded p-2\">\n04939|                     <div className=\"flex justify-between items-center mb-2\">\n04940|                       <h4 className=\"text-sm font-medium text-white\">\n04941|                         {group.isEmpty ? (\n04942|                           `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1}`\n04943|                         ) : group.quantity === 1 ? (\n04944|                           `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1}`\n04945|                         ) : (\n04946|                           `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1} - ${group.quantity} –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –º–µ—Å—Ç–∞`\n04947|                         )}\n04948|                       </h4>\n04949|                       {form.cargos.length > 1 && group.quantity === 1 && (\n04950|                         <Button\n04951|                           variant=\"destructive\"\n04952|                           size=\"sm\"\n04953|                           onClick={() => removeCargo(form.cargos[group.indices[0]].id)}\n04954|                           className=\"h-6 text-xs\"\n04955|                         >\n04956|                           –£–¥–∞–ª–∏—Ç—å\n04957|                         </Button>\n04958|                       )}\n04959|                       {group.quantity > 1 && (\n04960|                         <Badge variant=\"secondary\" className=\"text-xs\">\n04961|                           {group.quantity} —à—Ç.\n04962|                         </Badge>\n04963|                       )}\n04964|                     </div>\n04965|                     \n04966|                     {group.isEmpty || group.quantity === 1 ? (\n04967|                       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞ –¥–ª—è –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ –∏–ª–∏ –µ–¥–∏–Ω–∏—á–Ω—ã—Ö\n04968|                       <div className=\"grid grid-cols-2 gap-2\">\n04969|                         <div>\n04970|                           <Label className=\"text-white text-xs\">–î–ª–∏–Ω–∞ (—Å–º)</Label>\n04971|                           <Input\n04972|                             type=\"number\"\n04973|                             value={form.cargos[group.indices[0]].length || ''}\n04974|                             onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'length', Number(e.target.value))}\n04975|                             className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n04976|                           />\n04977|                         </div>\n04978|                         <div>\n04979|                           <Label className=\"text-white text-xs\">–®–∏—Ä–∏–Ω–∞ (—Å–º)</Label>\n04980|                           <Input\n04981|                             type=\"number\"\n04982|                             value={form.cargos[group.indices[0]].width || ''}\n04983|                             onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'width', Number(e.target.value))}\n04984|                             className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n04985|                           />\n04986|                         </div>\n04987|                         <div>\n04988|                           <Label className=\"text-white text-xs\">–í—ã—Å–æ—Ç–∞ (—Å–º)</Label>\n04989|                           <Input\n04990|                             type=\"number\"\n04991|                             value={form.cargos[group.indices[0]].height || ''}\n04992|                             onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'height', Number(e.target.value))}\n04993|                             className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n04994|                           />\n04995|                         </div>\n04996|                         <div>\n04997|                           <Label className=\"text-white text-xs\">–í–µ—Å (–∫–≥)</Label>\n04998|                           <Input\n04999|                             type=\"number\"\n05000|                             value={form.cargos[group.indices[0]].weight || ''}\n05001|                             onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'weight', Number(e.target.value))}\n05002|                             className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n05003|                           />\n05004|                         </div>\n05005|                       </div>\n05006|                     ) : (\n05007|                       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –≥—Ä—É–ø–ø\n05008|                       <div className=\"grid grid-cols-2 gap-2 text-sm text-gray-300\">\n05009|                         <div>–î–ª–∏–Ω–∞: {group.length} —Å–º</div>\n05010|                         <div>–®–∏—Ä–∏–Ω–∞: {group.width} —Å–º</div>\n05011|                         <div>–í—ã—Å–æ—Ç–∞: {group.height} —Å–º</div>\n05012|                         <div>–í–µ—Å: {group.weight} –∫–≥</div>\n05013|                         <div className=\"col-span-2 text-xs text-blue-300 mt-1\">\n05014|                           –û–±—â–∏–π –≤–µ—Å: {(group.weight * group.quantity).toFixed(1)} –∫–≥, \n05015|                           –æ–±—ä–µ–º: {((group.length * group.width * group.height * group.quantity) / 1000000).toFixed(3)} –º¬≥\n05016|                         </div>\n05017|                       </div>\n05018|                     )}\n05019|                   </div>\n05020|                 ))}\n05021|                  <Button onClick={addCargo} className=\"w-full h-7 text-xs\" variant=\"outline\">\n05022|                   <Plus className=\"h-3 w-3 mr-1\" />\n05023|                   –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–∑\n05024|                 </Button>\n05025|               </CardContent>\n05026|             </Card>\n05027| \n05028|             {/* –ú–∞—Ä—à—Ä—É—Ç */}\n05029|             <Card className=\"bg-gray-800 border-gray-700\">\n05030|               <CardHeader className=\"pb-2\">\n05031|                 <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n05032|                   <Map className=\"h-3 w-3\" />\n05033|                   –ú–∞—Ä—à—Ä—É—Ç\n05034|                 </CardTitle>\n05035|               </CardHeader>\n05036|               <CardContent className=\"space-y-2\">\n05037|                 {/* –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */}\n05038|                 <div className=\"space-y-2\">\n05039|                   <Label className=\"text-sm font-medium text-white\">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</Label>\n05040|                   <div className=\"flex gap-3 flex-wrap\">\n05041|                     <label className=\"flex items-center space-x-1\">\n05042|                       <input\n05043|                         type=\"radio\"\n05044|                         name=\"fromDelivery\"\n05045|                         checked={form.fromTerminal}\n05046|                         onChange={() => setForm(prev => ({ ...prev, fromTerminal: true, fromAddressDelivery: false, fromLavsiteWarehouse: false }))}\n05047|                       />\n05048|                       <span className=\"text-white text-xs\">–û—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞</span>\n05049|                     </label>\n05050|                     <label className=\"flex items-center space-x-1\">\n05051|                       <input\n05052|                         type=\"radio\"\n05053|                         name=\"fromDelivery\"\n05054|                         checked={form.fromAddressDelivery && !form.fromLavsiteWarehouse}\n05055|                         onChange={() => setForm(prev => ({ ...prev, fromTerminal: false, fromAddressDelivery: true, fromLavsiteWarehouse: false }))}\n05056|                       />\n05057|                       <span className=\"text-white text-xs\">–û—Ç –∞–¥—Ä–µ—Å–∞</span>\n05058|                     </label>\n05059|                     <label className=\"flex items-center space-x-1\">\n05060|                       <Checkbox\n05061|                         id=\"lavsiteWarehouse\"\n05062|                         checked={form.fromLavsiteWarehouse}\n05063|                         onCheckedChange={handleLavsiteWarehouseChange}\n05064|                       />\n05065|                       <span className=\"text-white text-xs cursor-pointer\">–°–æ —Å–∫–ª–∞–¥–∞ –õ–∞–≤—Å–∏—Ç</span>\n05066|                     </label>\n05067|                   </div>\n05068|                   \n05069|                   <div>\n05070|                     <Label className=\"text-white text-xs\">–ì–æ—Ä–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</Label>\n05071|                     <Input\n05072|                       value={form.fromCity}\n05073|                       onChange={(e) => !form.fromLavsiteWarehouse && handleAddressChange('fromCity', e.target.value, e.target)}\n05074|                       placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –≥–æ—Ä–æ–¥\"\n05075|                       disabled={form.fromLavsiteWarehouse}\n05076|                       className={`bg-gray-700 border-gray-600 h-7 text-white text-xs ${form.fromLavsiteWarehouse ? 'opacity-50 cursor-not-allowed' : ''}`}\n05077|                     />\n05078|                   </div>\n05079|                   \n05080|                   {form.fromAddressDelivery && (\n05081|                     <div>\n05082|                       <Label className=\"text-white text-xs\">–ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</Label>\n05083|                       <Input\n05084|                         value={form.fromAddress}\n05085|                         onChange={(e) => !form.fromLavsiteWarehouse && handleAddressChange('fromAddress', e.target.value, e.target)}\n05086|                         placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å\"\n05087|                         disabled={form.fromLavsiteWarehouse}\n05088|                         className={`bg-gray-700 border-gray-600 h-7 text-white text-xs ${form.fromLavsiteWarehouse ? 'opacity-50 cursor-not-allowed' : ''}`}\n05089|                       />\n05090|                     </div>\n05091|                   )}\n05092|                 </div>\n05093| \n05094|                 {/* –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ */}\n05095|                 <div className=\"space-y-2\">\n05096|                   <Label className=\"text-sm font-medium text-white\">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</Label>\n05097|                   <div className=\"flex gap-3 flex-wrap\">\n05098|                     <label className=\"flex items-center space-x-1\">\n05099|                       <input\n05100|                         type=\"radio\"\n05101|                         name=\"toDelivery\"\n05102|                         checked={form.toTerminal}\n05103|                         onChange={() => setForm(prev => ({ ...prev, toTerminal: true, toAddressDelivery: false }))}\n05104|                       />\n05105|                       <span className=\"text-white text-xs\">–î–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞</span>\n05106|                     </label>\n05107|                     <label className=\"flex items-center space-x-1\">\n05108|                       <input\n05109|                         type=\"radio\"\n05110|                         name=\"toDelivery\"\n05111|                         checked={form.toAddressDelivery}\n05112|                         onChange={() => setForm(prev => ({ ...prev, toTerminal: false, toAddressDelivery: true }))}\n05113|                       />\n05114|                       <span className=\"text-white text-xs\">–î–æ –∞–¥—Ä–µ—Å–∞</span>\n05115|                     </label>\n05116|                   </div>\n05117|                   \n05118|                   <div>\n05119|                     <Label className=\"text-white text-xs\">–ì–æ—Ä–æ–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</Label>\n05120|                     <Input\n05121|                       value={form.toCity}\n05122|                       onChange={(e) => handleAddressChange('toCity', e.target.value, e.target)}\n05123|                       placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –≥–æ—Ä–æ–¥\"\n05124|                       className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n05125|                     />\n05126|                   </div>\n05127|                   \n05128|                   {form.toAddressDelivery && (\n05129|                     <div>\n05130|                       <Label className=\"text-white text-xs\">–ê–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</Label>\n05131|                       <Input\n05132|                         value={form.toAddress}\n05133|                         onChange={(e) => handleAddressChange('toAddress', e.target.value, e.target)}\n05134|                         placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å\"\n05135|                         className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n05136|                       />\n05137|                     </div>\n05138|                   )}\n05139|                 </div>\n05140| \n05141|                 <div>\n05142|                   <Label className=\"text-white text-xs\">–û–±—ä—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (—Ä—É–±.)</Label>\n05143|                   <Input\n05144|                     type=\"number\"\n05145|                     value={form.declaredValue || ''}\n05146|                     onChange={(e) => setForm(prev => ({ ...prev, declaredValue: Number(e.target.value) }))}\n05147|                     className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n05148|                   />\n05149|                 </div>\n05150|                 \n05151|                 <div className=\"space-y-2\">\n05152|                   <div className=\"flex items-center space-x-2\">\n05153|                     <Checkbox\n05154|                       id=\"packaging\"\n05155|                       checked={form.needPackaging}\n05156|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needPackaging: checked as boolean }))}\n05157|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n05158|                     />\n05159|                     <Label htmlFor=\"packaging\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è —É–ø–∞–∫–æ–≤–∫–∞</Label>\n05160|                   </div>\n05161|                   \n05162|                   <div className=\"flex items-center space-x-2\">\n05163|                     <Checkbox\n05164|                       id=\"insurance\"\n05165|                       checked={form.needInsurance}\n05166|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needInsurance: checked as boolean }))}\n05167|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n05168|                     />\n05169|                     <Label htmlFor=\"insurance\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞</Label>\n05170|                   </div>\n05171|                   \n05172|                   <div className=\"flex items-center space-x-2\">\n05173|                     <Checkbox\n05174|                       id=\"loading\"\n05175|                       checked={form.needLoading}\n05176|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needLoading: checked as boolean }))}\n05177|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n05178|                     />\n05179|                     <Label htmlFor=\"loading\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≥—Ä—É–∑–∫–∞/—Ä–∞–∑–≥—Ä—É–∑–∫–∞</Label>\n05180|                   </div>\n05181|                   \n05182|                   <div className=\"flex items-center space-x-2\">\n05183|                     <Checkbox\n05184|                       id=\"carry\"\n05185|                       checked={form.needCarry}\n05186|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needCarry: checked as boolean }))}\n05187|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n05188|                     />\n05189|                     <Label htmlFor=\"carry\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—ä–µ–º</Label>\n05190|                   </div>\n05191|                   \n05192|                   {form.needCarry && (\n05193|                     <div className=\"ml-6 space-y-2 border-l-2 border-gray-600 pl-3\">\n05194|                       <div>\n05195|                         <Label className=\"text-white text-xs\">–≠—Ç–∞–∂</Label>\n05196|                         <Input\n05197|                           type=\"number\"\n05198|                           value={form.floor}\n05199|                           onChange={(e) => setForm(prev => ({ ...prev, floor: Number(e.target.value) }))}\n05200|                           className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n05201|                         />\n05202|                       </div>\n05203|                       <div className=\"flex items-center space-x-2\">\n05204|                         <Checkbox\n05205|                           id=\"freightLift\"\n05206|                           checked={form.hasFreightLift}\n05207|                           onCheckedChange={(checked) => setForm(prev => ({ ...prev, hasFreightLift: checked as boolean }))}\n05208|                         />\n05209|                         <Label htmlFor=\"freightLift\" className=\"text-white text-xs\">–ù–∞–ª–∏—á–∏–µ –≥—Ä—É–∑–æ–≤–æ–≥–æ –ª–∏—Ñ—Ç–∞</Label>\n05210|                       </div>\n05211|                     </div>\n05212|                   )}\n05213|                 </div>\n05214|                 \n05215|                 <div className=\"space-y-2\">\n05216|                   <Button \n05217|                     onClick={handleCalculate} \n05218|                     className=\"w-full bg-blue-600 hover:bg-blue-700 h-7 text-xs\" \n05219|                     disabled={calculating}\n05220|                   >\n05221|                     {calculating ? '–†–∞—Å—á–µ—Ç...' : '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å'}\n05222|                   </Button>\n05223|                   \n05224|                   <Button \n05225|                     onClick={handleReset} \n05226|                     variant=\"outline\" \n05227|                     className=\"w-full h-7 text-xs text-black border-gray-600 hover:bg-gray-700 hover:text-white\" \n05228|                     disabled={calculating}\n05229|                   >\n05230|                     –°–±—Ä–æ—Å–∏—Ç—å —Ä–∞—Å—á–µ—Ç\n05231|                   </Button>\n05232|                 </div>\n05233|               </CardContent>\n05234|             </Card>\n05235|           </div>\n05236| \n05237|           {/* –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã */}\n05238|           <div className=\"space-y-2 overflow-y-auto\">\n05239|             {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Ä–∞—Å—á–µ—Ç–æ–≤ */}\n05240|             <CalculationProgress \n05241|               companies={calculationProgress.companies}\n05242|               totalDuration={calculationProgress.totalDuration}\n05243|               isVisible={calculating}\n05244|             />\n05245|             \n05246|             {calculations.length > 0 && (\n05247|                  <div className=\"space-y-2\">\n05248|                 <div className=\"flex justify-between items-center\">\n05249|                   <h2 className=\"text-lg font-bold text-blue-400\">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞</h2>\n05250|                   <div className=\"flex gap-2 flex-wrap\">\n05251|                     <SaveCalculation \n05252|                       formData={form}\n05253|                       calculations={calculations}\n05254|                       enabledCompanies={hiddenCompanies}\n05255|                       onSave={(result) => {\n05256|                         console.log('–†–∞—Å—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω:', result);\n05257|                       }}\n05258|                     />\n05259|                     <CalculationHistory \n05260|                       onLoadCalculation={(calculation) => {\n05261|                         console.log('–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å—á–µ—Ç–∞:', calculation.orderNumber);\n05262|                         // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞\n05263|                       }}\n05264|                     />\n05265|                   </div>\n05266|                 </div>\n05267|                 \n05268|                 {calculations\n05269|                   .filter(calc => !hiddenCompanies[calc.company])\n05270|                   .map((calc, index) => (\n05271|                    <Card key={index} className=\"bg-gray-800 border-gray-700 text-xs\">\n05272|                      <CardHeader className=\"pb-1\">\n05273|                       <div className=\"flex justify-between items-center\">\n05274|                          <CardTitle className=\"text-white flex items-center gap-2 text-xs\">\n05275|                            <Building2 className=\"h-3 w-3\" />\n05276|                           {calc.company}\n05277|                         </CardTitle>\n05278|                         {calc.error ? (\n05279|                           <Badge variant=\"destructive\" className=\"text-xs\">–û—à–∏–±–∫–∞</Badge>\n05280|                         ) : (\n05281|                           <Badge variant=\"default\" className=\"bg-green-600 text-xs\">\n05282|                             {calc.price.toLocaleString()} ‚ÇΩ\n05283|                           </Badge>\n05284|                         )}\n05285|                       </div>\n05286|                     </CardHeader>\n05287|                     <CardContent className=\"pt-0\">\n05288|                       <div className=\"space-y-2\">\n05289|                         {calc.error ? (\n05290|                           <div className=\"space-y-2\">\n05291|                             <Alert className=\"border-red-600\">\n05292|                               <AlertDescription className=\"text-white text-xs\">{calc.error}</AlertDescription>\n05293|                             </Alert>\n05294|                             {calc.price > 0 && (\n05295|                               <>\n05296|                                 <p className=\"text-white text-xs\"><strong>–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {calc.price.toLocaleString()} ‚ÇΩ</p>\n05297|                                 <p className=\"text-white text-xs\"><strong>–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Å—Ä–æ–∫:</strong> {calc.days} –¥–Ω–µ–π</p>\n05298|                               </>\n05299|                             )}\n05300|                           </div>\n05301|                         ) : (\n05302|                           <>\n05303|                             <p className=\"text-white text-xs\"><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {calc.price.toLocaleString()} ‚ÇΩ</p>\n05304|                             <p className=\"text-white text-xs\"><strong>–°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> {calc.days} –¥–Ω–µ–π</p>\n05305|                           </>\n05306|                         )}\n05307|                         \n05308|                         <div className=\"flex gap-2 mt-2 flex-wrap\">\n05309|                           {!calc.error && (\n05310|                             <Button\n05311|                               variant=\"outline\"\n05312|                               size=\"sm\"\n05313|                               onClick={() => toggleDetails(calc.company)}\n05314|                               className=\"h-6 text-xs\"\n05315|                             >\n05316|                               {expandedDetails[calc.company] ? '–°–∫—Ä—ã—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ' : '–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ'}\n05317|                             </Button>\n05318|                           )}\n05319|                           <Button\n05320|                             variant=\"outline\"\n05321|                             size=\"sm\"\n05322|                             onClick={() => toggleDebugInfo(calc.company)}\n05323|                             className=\"h-6 text-xs\"\n05324|                           >\n05325|                             {expandedDebugInfo[calc.company] ? '–°–∫—Ä—ã—Ç—å –æ—Ç–ª–∞–¥–∫—É' : '–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'}\n05326|                           </Button>\n05327|                           <Button\n05328|                             variant=\"outline\"\n05329|                             size=\"sm\"\n05330|                             onClick={() => {\n05331|                               setHiddenCompanies(prev => ({\n05332|                                 ...prev,\n05333|                                 [calc.company]: true\n05334|                               }));\n05335|                             }}\n05336|                             className=\"h-6 text-xs border-red-500 text-red-400 hover:bg-red-900/20\"\n05337|                           >\n05338|                             –°–∫—Ä—ã—Ç—å\n05339|                           </Button>\n05340|                         </div>\n05341|                         \n05342|                         {/* –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ */}\n05343|                         {!calc.error && (\n05344|                           <Collapsible open={expandedDetails[calc.company]}>\n05345|                             <CollapsibleContent className=\"mt-2\">\n05346|                               <div className=\"bg-gray-900 p-3 rounded text-xs\">\n05347|                                 <h4 className=\"font-bold mb-2 text-white\">–î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞:</h4>\n05348|                                 {(() => {\n05349|                                   const details = parseCalculationDetails(calc);\n05350|                                   const totalPrice = details.reduce((sum, detail) => sum + detail.price, 0);\n05351|                                   \n05352|                                   return (\n05353|                                     <div className=\"space-y-1\">\n05354|                                       {details.map((detail, idx) => (\n05355|                                         <div key={idx} className=\"flex justify-between text-white\">\n05356|                                           <div>\n05357|                                             <div className=\"font-medium\">{detail.service}</div>\n05358|                                             {detail.description && (\n05359|                                               <div className=\"text-gray-400 text-xs\">{detail.description}</div>\n05360|                                             )}\n05361|                                           </div>\n05362|                                           <div className=\"font-medium\">{detail.price.toLocaleString()} ‚ÇΩ</div>\n05363|                                         </div>\n05364|                                       ))}\n05365|                                     </div>\n05366|                                   );\n05367|                                 })()}\n05368|                               </div>\n05369|                             </CollapsibleContent>\n05370|                           </Collapsible>\n05371|                         )}\n05372|                         \n05373|                         {/* –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è - –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ */}\n05374|                         <Collapsible open={expandedDebugInfo[calc.company]}>\n05375|                           <CollapsibleContent className=\"mt-2\">\n05376|                             <div className=\"bg-gray-900 p-3 rounded text-xs\">\n05377|                               <h4 className=\"font-bold mb-2 text-white\">–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h4>\n05378|                               \n05379|                               {calc.apiUrl && (\n05380|                                 <div className=\"mb-3\">\n05381|                                   <h5 className=\"font-bold mb-1 text-white\">–ó–∞–ø—Ä–æ—Å –∫ API:</h5>\n05382|                                   <p className=\"text-gray-300 break-all text-xs\">URL: {calc.apiUrl}</p>\n05383|                                 </div>\n05384|                               )}\n05385|                               \n05386|                               {calc.sessionId && (\n05387|                                 <div className=\"mb-3\">\n05388|                                   <h5 className=\"font-bold mb-1 text-white\">Session ID:</h5>\n05389|                                   <p className=\"text-gray-300 text-xs\">{calc.sessionId}</p>\n05390|                                 </div>\n05391|                               )}\n05392|                               \n05393|                               {calc.requestData && (\n05394|                                 <div className=\"mb-3\">\n05395|                                   <h5 className=\"font-bold mb-1 text-white\">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å:</h5>\n05396|                                   <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n05397|                                     {JSON.stringify(calc.requestData, null, 2)}\n05398|                                   </pre>\n05399|                                 </div>\n05400|                               )}\n05401|                               \n05402|                               {calc.responseData && (\n05403|                                 <div className=\"mb-3\">\n05404|                                   <h5 className=\"font-bold mb-1 text-white\">–ü–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç:</h5>\n05405|                                   <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n05406|                                     {JSON.stringify(calc.responseData, null, 2)}\n05407|                                   </pre>\n05408|                                 </div>\n05409|                               )}\n05410|                               \n05411|                               {calc.details && (\n05412|                                 <div className=\"mb-3\">\n05413|                                   <h5 className=\"font-bold mb-1 text-white\">–î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ (JSON):</h5>\n05414|                                   <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n05415|                                     {JSON.stringify(calc.details, null, 2)}\n05416|                                   </pre>\n05417|                                 </div>\n05418|                               )}\n05419|                               \n05420|                               {calc.error && (\n05421|                                 <div className=\"mb-3\">\n05422|                                   <h5 className=\"font-bold mb-1 text-red-400\">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ:</h5>\n05423|                                   <p className=\"text-red-300 text-xs\">{calc.error}</p>\n05424|                                 </div>\n05425|                               )}\n05426|                             </div>\n05427|                           </CollapsibleContent>\n05428|                         </Collapsible>\n05429|                       </div>\n05430|                     </CardContent>\n05431|                   </Card>\n05432|                  ))}\n05433|                  \n05434|                  {/* –ë–ª–æ–∫ –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–∫—Ä—ã—Ç—ã—Ö –¢–ö */}\n05435|                  {Object.values(hiddenCompanies).some(hidden => hidden) && (\n05436|                    <div className=\"mt-4 p-3 bg-gray-700 rounded border-gray-600\">\n05437|                      <div className=\"flex items-center justify-between\">\n05438|                        <div className=\"text-sm text-gray-300\">\n05439|                          –°–∫—Ä—ã—Ç–æ –¢–ö: {Object.values(hiddenCompanies).filter(hidden => hidden).length}\n05440|                        </div>\n05441|                        <Button\n05442|                          variant=\"outline\"\n05443|                          size=\"sm\"\n05444|                          onClick={() => setHiddenCompanies({})}\n05445|                          className=\"h-6 text-xs border-green-500 text-green-400 hover:bg-green-900/20\"\n05446|                        >\n05447|                          –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–∫—Ä—ã—Ç—ã–µ\n05448|                        </Button>\n05449|                      </div>\n05450|                    </div>\n05451|                  )}\n05452|                </div>\n05453|             )}\n05454| \n05455|             {/* –°–ø–∏—Å–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –¢–ö - –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º—ã–π */}\n05456|             <Card className=\"bg-gray-800 border-gray-700\">\n05457|               <CardHeader className=\"pb-2\">\n05458|                 <div className=\"flex justify-between items-center\">\n05459|                   <CardTitle className=\"text-white text-sm\">\n05460|                     –ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ ({COMPANIES_BASE.filter(company => showHiddenCompanies || enabledCompanies[company.apiKey]).length}{showHiddenCompanies ? ` –∏–∑ ${COMPANIES_BASE.length}` : ''})\n05461|                   </CardTitle>\n05462|                   <Button\n05463|                     variant=\"outline\"\n05464|                     size=\"sm\"\n05465|                     onClick={() => setShowHiddenCompanies(prev => !prev)}\n05466|                     className=\"h-6 text-xs border-blue-500 text-blue-400 hover:bg-blue-900/20\"\n05467|                   >\n05468|                     {showHiddenCompanies ? '–°–∫—Ä—ã—Ç—å –≤—Å–µ' : '–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ'}\n05469|                   </Button>\n05470|                 </div>\n05471|               </CardHeader>\n05472|               <CardContent>\n05473|                 <div className=\"grid grid-cols-2 gap-2\">\n05474|                   {COMPANIES_BASE\n05475|                     .filter(company => showHiddenCompanies || enabledCompanies[company.apiKey])\n05476|                     .map((company, index) => {\n05477|                     const isConnected = apiStatus[company.apiKey as keyof typeof apiStatus] === '–ø–æ–¥–∫–ª—é—á–µ–Ω–æ';\n05478|                     const statusText = apiStatus[company.apiKey as keyof typeof apiStatus];\n05479|                     const isEnabled = enabledCompanies[company.apiKey];\n05480|                     \n05481|                     // –û—Ç–ª–∞–¥–∫–∞ –¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–æ–º–ø–∞–Ω–∏–π\n05482|                     if (index < 3) {\n05483|                       console.log(`üîç –ö–æ–º–ø–∞–Ω–∏—è ${index}: ${company.name}, apiKey: ${company.apiKey}, isEnabled: ${isEnabled}, statusText: ${statusText}`);\n05484|                     }\n05485|                     \n05486|                     return (\n05487|                       <div key={index} className=\"flex items-center justify-between p-1.5 bg-gray-700 rounded\">\n05488|                         <div className=\"flex items-center gap-2\">\n05489|                           <span className=\"text-lg\">{company.logo}</span>\n05490|                           <div>\n05491|                             <p className=\"font-medium text-white text-[10px] leading-tight\">{company.name}</p>\n05492|                             <Badge \n05493|                               variant={isConnected ? \"default\" : \"destructive\"} \n05494|                               className=\"text-[9px] py-0 px-1\"\n05495|                             >\n05496|                               {isConnected ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–∞' : statusText === '–ø—Ä–æ–≤–µ—Ä–∫–∞...' ? '–ü—Ä–æ–≤–µ—Ä–∫–∞...' : '–û—à–∏–±–∫–∞'}\n05497|                             </Badge>\n05498|                           </div>\n05499|                         </div>\n05500|                         <div className=\"flex items-center gap-2\">\n05501|                           <span className=\"text-[9px] text-gray-300\">\n05502|                             {isEnabled ? '–í–∫–ª' : '–í—ã–∫–ª'}\n05503|                           </span>\n05504|                           <Switch\n05505|                             checked={isEnabled}\n05506|                             onCheckedChange={(checked) => {\n05507|                               setEnabledCompanies(prev => ({\n05508|                                 ...prev,\n05509|                                 [company.apiKey]: checked\n05510|                               }));\n05511|                             }}\n05512|                           />\n05513|                         </div>\n05514|                       </div>\n05515|                     );\n05516|                   })}\n05517|                 </div>\n05518|               </CardContent>\n05519|             </Card>\n05520| \n05521|             {/* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫—É–∑–æ–≤–∞ */}\n05522|             {calculations.length > 0 && (\n05523|               <LazyTruckVisualization \n05524|                 cargos={form.cargos.map(cargo => ({\n05525|                   id: cargo.id,\n05526|                   length: cargo.length * 10, // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n05527|                   width: cargo.width * 10,   // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n05528|                   height: cargo.height * 10, // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n05529|                   weight: cargo.weight,\n05530|                   productName: form.selectedProducts?.find(p => \n05531|                     p.cargoIndexes.includes(form.cargos.indexOf(cargo))\n05532|                   )?.product.name\n05533|                 }))}\n05534|                 isVisible={true}\n05535|               />\n05536|             )}\n05537|           </div>\n05538|         </div>\n05539|       </div>\n05540| \n05541|       {/* –ê–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–∫–∏ */}\n05542|       {showSuggestions && suggestions.length > 0 && (\n05543|         <div \n05544|           className=\"fixed z-50 bg-gray-800 border border-gray-700 rounded-md shadow-lg max-w-sm w-full max-h-60 overflow-y-auto\"\n05545|           style={{\n05546|             top: suggestionPosition.top,\n05547|             left: suggestionPosition.left\n05548|           }}\n05549|         >\n05550|           <div className=\"p-1\">\n05551|             {suggestions.map((suggestion, index) => (\n05552|               <div\n05553|                 key={index}\n05554|                 className=\"p-2 hover:bg-gray-700 cursor-pointer text-xs text-white rounded transition-colors\"\n05555|                 onClick={() => selectSuggestion(suggestion)}\n05556|               >\n05557|                 {suggestion.value}\n05558|               </div>\n05559|             ))}\n05560|           </div>\n05561|         </div>\n05562|       )}\n05563|     </div>\n05564|   );\n05565| }\n\n(End of file - total 5565 lines)\n</file>",
    "title": "app/page.tsx",
    "metadata": {
      "preview": "        return cityFiasMap[normalizedCity] || '0c5b2444-70a0-4932-980c-b4dc0d3f02b5'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ú–æ—Å–∫–≤–∞\n      };\n      // üèôÔ∏è –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ª–æ–∫–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–æ—Ä–º—ã\n      const getDispatchLocation = () => {\n        if (form.fromTerminal) {\n          return {\n            type: 'terminal' as const,\n            // –î–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π FIAS –∫–æ–¥ –≥–æ—Ä–æ–¥–∞\n            city_fias: getCityFias(form.fromCity)\n          };\n        } else if (form.fromLavsiteWarehouse) {\n          // üè≠ –î–ª—è —Å–∫–ª–∞–¥–∞ –õ–∞–≤—Å–∏—Ç –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å FIAS –∫–æ–¥–æ–º –≥–æ—Ä–æ–¥–∞\n          return {\n            type: 'terminal' as const, // –ò—Å–ø–æ–ª—å–∑—É–µ–º terminal —Ç–∏–ø –¥–ª—è —Å–∫–ª–∞–¥–∞\n            city_fias: getCityFias('–õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π') // –ò—Å–ø–æ–ª—å–∑—É–µ–º FIAS –≥–æ—Ä–æ–¥–∞ —Å–∫–ª–∞–¥–∞\n          };\n        } else {\n          return {\n            type: 'address' as const,\n            address: form.fromAddress || form.fromCity // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥—Ä–µ—Å –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –≥–æ—Ä–æ–¥"
    },
    "time": {
      "start": 1765813236240,
      "end": 1765813236254
    }
  }
}