{
  "id": "prt_b13c08dcc001GABTAlJMFNp8px",
  "sessionID": "ses_4ec3ff722ffeBPzPNwp55I8TOz",
  "messageID": "msg_b13c087f8001LwXnExirgPB9Wu",
  "type": "tool",
  "callID": "call_30862254",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "components/diagnostic/TechnicalDocumentation.tsx",
      "limit": 200
    },
    "output": "<file>\n00001| 'use client';\n00002| \n00003| import React, { useState, useEffect, useCallback } from 'react';\n00004| import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\n00005| import { Button } from '@/components/ui/button';\n00006| import { Badge } from '@/components/ui/badge';\n00007| import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\n00008| import { Alert, AlertDescription } from '@/components/ui/alert';\n00009| import { ScrollArea } from '@/components/ui/scroll-area';\n00010| import {\n00011|   FileText,\n00012|   RefreshCw,\n00013|   Code,\n00014|   Settings,\n00015|   Truck,\n00016|   Database,\n00017|   Globe,\n00018|   AlertTriangle,\n00019|   CheckCircle,\n00020|   Clock\n00021| } from 'lucide-react';\n00022| \n00023| interface DocumentationBlock {\n00024|   id: string;\n00025|   title: string;\n00026|   type: 'function' | 'component' | 'api' | 'logic' | 'data';\n00027|   description: string;\n00028|   code?: string;\n00029|   dependencies?: string[];\n00030|   relatedFiles?: string[];\n00031|   apiEndpoints?: string[];\n00032|   lastModified?: Date;\n00033| }\n00034| \n00035| interface ChangeRecord {\n00036|   id: string;\n00037|   timestamp: Date;\n00038|   type: 'added' | 'modified' | 'deleted';\n00039|   impact: 'low' | 'medium' | 'high';\n00040|   description: string;\n00041|   affectedFunctions: string[];\n00042|   files: string[];\n00043| }\n00044| \n00045| const TechnicalDocumentation: React.FC = () => {\n00046|   const [documentation, setDocumentation] = useState<DocumentationBlock[]>([]);\n00047|   const [changes, setChanges] = useState<ChangeRecord[]>([]);\n00048|   const [loading, setLoading] = useState(false);\n00049|   const [lastAnalysis, setLastAnalysis] = useState<Date | null>(null);\n00050|   const [activeTab, setActiveTab] = useState('overview');\n00051| \n00052|   // Load saved documentation and changes\n00053|   useEffect(() => {\n00054|     try {\n00055|       const savedDocs = localStorage.getItem('technicalDocumentation');\n00056|       const savedChanges = localStorage.getItem('documentationChanges');\n00057|       const savedLastAnalysis = localStorage.getItem('lastDocumentationAnalysis');\n00058| \n00059|       if (savedDocs) {\n00060|         const parsed = JSON.parse(savedDocs);\n00061|         setDocumentation(parsed.map((doc: any) => ({\n00062|           ...doc,\n00063|           lastModified: doc.lastModified ? new Date(doc.lastModified) : undefined\n00064|         })));\n00065|       }\n00066| \n00067|       if (savedChanges) {\n00068|         const parsed = JSON.parse(savedChanges);\n00069|         setChanges(parsed.map((change: any) => ({\n00070|           ...change,\n00071|           timestamp: new Date(change.timestamp)\n00072|         })));\n00073|       }\n00074| \n00075|       if (savedLastAnalysis) {\n00076|         setLastAnalysis(new Date(savedLastAnalysis));\n00077|       }\n00078|     } catch (error) {\n00079|       console.error('Error loading documentation:', error);\n00080|     }\n00081|   }, []);\n00082| \n00083|   const analyzeApplication = useCallback(async () => {\n00084|     setLoading(true);\n00085| \n00086|     try {\n00087|       // Get git changes since last analysis\n00088|       const changesResponse = await fetch('/api/run-tests?analyze=true', {\n00089|         method: 'POST',\n00090|         headers: { 'Content-Type': 'application/json' },\n00091|         body: JSON.stringify({\n00092|           action: 'analyze_changes',\n00093|           since: lastAnalysis?.toISOString()\n00094|         })\n00095|       });\n00096| \n00097|       let newChanges: ChangeRecord[] = [];\n00098|       if (changesResponse.ok) {\n00099|         const changesData = await changesResponse.json();\n00100|         newChanges = changesData.changes || [];\n00101|       }\n00102| \n00103|       // Generate comprehensive documentation\n00104|       const docs: DocumentationBlock[] = [\n00105|         // Core Functions\n00106|         {\n00107|           id: 'calculatePEK',\n00108|           title: 'Функция расчета доставки ПЭК (calculatePEK)',\n00109|           type: 'function',\n00110|           description: `Основная функция расчета стоимости и сроков доставки для транспортной компании ПЭК.\n00111|           \n00112| **Назначение:** Выполняет полный цикл расчета доставки от получения данных формы до возврата результата.\n00113| \n00114| **Алгоритм работы:**\n00115| 1. Валидация входных данных (города, грузы, веса)\n00116| 2. Получение зоны доставки через API findzonebyaddress\n00117| 3. Расчет стоимости через API calculator\n00118| 4. Обработка ошибок и возврат результата\n00119| \n00120| **Параметры:**\n00121| - form: DeliveryForm - данные формы доставки\n00122| - Возвращает: Promise<CalculationResult>\n00123| \n00124| **Обработка ошибок:**\n00125| - ZONE_NOT_SERVED - зона не обслуживается\n00126| - INVALID_CREDENTIALS - неверные учетные данные\n00127| - NETWORK_ERROR - проблемы с сетью\n00128| \n00129| **Связанные файлы:**\n00130| - app/page.tsx:2368-2500 (основная логика)\n00131| - app/api/pek/route.ts (API обработчик)\n00132| - lib/api-utils.ts (утилиты API)`,\n00133|           code: `const calculatePEK = async (): Promise<CalculationResult> => {\n00134|   // Валидация данных\n00135|   validateMultipleCargos(form.cargos);\n00136|   \n00137|   // Получение зоны доставки\n00138|   const zoneData = await getPekZoneByAddress(fromAddress, toAddress);\n00139|   \n00140|   // Расчет через API\n00141|   const result = await enhancedApiRequest('/api/pek', {\n00142|     method: 'POST',\n00143|     body: JSON.stringify(requestData)\n00144|   }, { operation: 'calculate', company: 'ПЭК' });\n00145|   \n00146|   return processPekResult(result);\n00147| };`,\n00148|           dependencies: ['enhancedApiRequest', 'validateMultipleCargos', 'getPekZoneByAddress'],\n00149|           relatedFiles: ['app/page.tsx', 'app/api/pek/route.ts', 'lib/api-utils.ts'],\n00150|           apiEndpoints: ['/api/pek'],\n00151|           lastModified: new Date()\n00152|         },\n00153| \n00154|         {\n00155|           id: 'calculateVozovoz',\n00156|           title: 'Функция расчета доставки Возовоз (calculateVozovoz)',\n00157|           type: 'function',\n00158|           description: `Функция расчета стоимости доставки для транспортной компании Возовоз.\n00159|           \n00160| **Особенности:**\n00161| - Использует API 2.5 Vozovoz\n00162| - Поддерживает множественные грузы\n00163| - Учитывает страхование и упаковку\n00164| - Максимальные габариты одного места\n00165| \n00166| **Структура запроса:**\n00167| \\`\\`\\`json\n00168| {\n00169|   \"object\": \"price\",\n00170|   \"action\": \"get\",\n00171|   \"params\": {\n00172|     \"cargo\": {\n00173|       \"dimension\": {\n00174|         \"max\": { \"length\": 0.5, \"width\": 0.3, \"height\": 0.2, \"weight\": 15 },\n00175|         \"quantity\": 2,\n00176|         \"volume\": 0.03,\n00177|         \"weight\": 15\n00178|       },\n00179|       \"insurance\": 10000,\n00180|       \"wrapping\": { \"hardPackageVolume\": 0.03 }\n00181|     },\n00182|     \"gateway\": {\n00183|       \"dispatch\": { \"point\": { \"location\": \"Москва\", \"terminal\": \"default\" } },\n00184|       \"destination\": { \"point\": { \"location\": \"СПб\", \"terminal\": \"default\" } }\n00185|     }\n00186|   }\n00187| }\n00188| \\`\\`\\`\n00189| \n00190| **Текущие проблемы:**\n00191| - Токен устарел: \\`sBDUaEmzVBO6syQWHvHxmjxJQiON2BZplQaqrU3N\\`\n00192| - Возвращает HTML вместо JSON при ошибке авторизации`,\n00193|           dependencies: ['enhancedApiRequest', 'validateMultipleCargos'],\n00194|           relatedFiles: ['app/page.tsx', 'app/api/vozovoz/route.ts'],\n00195|           apiEndpoints: ['/api/vozovoz'],\n00196|           lastModified: new Date()\n00197|         },\n00198| \n00199|         {\n00200|           id: 'enhancedApiRequest',\n\n(File has more lines. Use 'offset' parameter to read beyond line 200)\n</file>",
    "title": "components/diagnostic/TechnicalDocumentation.tsx",
    "metadata": {
      "preview": "'use client';\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport {\n  FileText,\n  RefreshCw,\n  Code,\n  Settings,\n  Truck,\n  Database,\n  Globe,\n  AlertTriangle,\n  CheckCircle,\n  Clock"
    },
    "time": {
      "start": 1765562944977,
      "end": 1765562944985
    }
  }
}