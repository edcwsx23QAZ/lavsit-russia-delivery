{
  "id": "prt_b22cbe18c001eCqp5SISgU2Phh",
  "sessionID": "ses_4dd34592affehJqMoLA2ZOxuZo",
  "messageID": "msg_b22cbd0ca001Bp3esvHFCIxOFh",
  "type": "tool",
  "callID": "toolu_01GPkuMA5hrAwWJKCZm3qy73",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx",
      "offset": 3480,
      "limit": 250
    },
    "output": "<file>\n03481|   };\n03482| \n03483|   // –†–∞—Å—á–µ—Ç –¥–ª—è Nord Wheel\n03484|   const calculateNordWheel = async (): Promise<CalculationResult> => {\n03485|     const apiUrl = '/api/nordwheel';\n03486| \n03487|     try {\n03488|       // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03489|       validateMultipleCargos(form.cargos);\n03490|       \n03491|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n03492|       const totalVolume = form.cargos.reduce((sum, cargo) => \n03493|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n03494|       );\n03495| \n03496|       // üîß –î–û–ë–ê–í–õ–ï–ù–û: –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π API NordWheel\n03497|       if (totalWeight > 1000) {\n03498|         console.warn('‚ö†Ô∏è Nord Wheel: –í–µ—Å –ø—Ä–µ–≤—ã—à–∞–µ—Ç 1000 –∫–≥, –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∞ API');\n03499|       }\n03500|       if (totalVolume > 5) {\n03501|         console.warn('‚ö†Ô∏è Nord Wheel: –û–±—ä–µ–º –ø—Ä–µ–≤—ã—à–∞–µ—Ç 5 –º¬≥, –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∞ API');\n03502|       }\n03503| \n03504|       // üîß –î–û–ë–ê–í–õ–ï–ù–û: –†–∞—Å—á–µ—Ç –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03505|       const maxLength = Math.max(...form.cargos.map(c => c.length));\n03506|       const maxWidth = Math.max(...form.cargos.map(c => c.width));\n03507|       const maxHeight = Math.max(...form.cargos.map(c => c.height));\n03508|       \n03509|       // üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03510|       console.log('üåê Nord Wheel: –ê–Ω–∞–ª–∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç:');\n03511|       console.log(`   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç: ${form.cargos.length}`);\n03512|       console.log(`   - –û–±—â–∏–π –≤–µ—Å: ${totalWeight} –∫–≥`);\n03513|       console.log(`   - –û–±—â–∏–π –æ–±—ä–µ–º: ${totalVolume.toFixed(3)} –º¬≥`);\n03514|       \n03515|       // –î–µ—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏—Å—Ç–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n03516|       let dispatchType = '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';\n03517|       if (form.fromLavsiteWarehouse) {\n03518|         dispatchType = '—Å–∫–ª–∞–¥ –õ–∞–≤—Å–∏—Ç';\n03519|       } else if (form.fromTerminal) {\n03520|         dispatchType = '—Ç–µ—Ä–º–∏–Ω–∞–ª';\n03521|       } else if (form.fromAddressDelivery) {\n03522|         dispatchType = '–∞–¥—Ä–µ—Å';\n03523|       } else {\n03524|         dispatchType = '—Ç–µ—Ä–º–∏–Ω–∞–ª (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)';\n03525|       }\n03526|       \n03527|       console.log(`   - –û—Ç–∫—É–¥–∞: ${form.fromCity} (${dispatchType})`);\n03528|       console.log(`   - –ö—É–¥–∞: ${form.toCity} (${form.toTerminal ? '—Ç–µ—Ä–º–∏–Ω–∞–ª' : '–∞–¥—Ä–µ—Å'})`);\n03529|       \n03530|       if (form.fromLavsiteWarehouse) {\n03531|         console.log(`   - –ê–¥—Ä–µ—Å —Å–∫–ª–∞–¥–∞: ${form.fromAddress}`);\n03532|       }\n03533|       \n03534|       form.cargos.forEach((cargo, index) => {\n03535|         console.log(`   üì¶ –ú–µ—Å—Ç–æ ${index + 1}:`);\n03536|         console.log(`     - –ì–∞–±–∞—Ä–∏—Ç—ã: ${cargo.length}√ó${cargo.width}√ó${cargo.height} —Å–º`);\n03537|         console.log(`     - –í–µ—Å: ${cargo.weight} –∫–≥`);\n03538|         console.log(`     - –û–±—ä–µ–º: ${((cargo.length * cargo.width * cargo.height) / 1000000).toFixed(3)} –º¬≥`);\n03539|       });\n03540| \n03541|       if (form.cargos.length > 1) {\n03542|         console.log(`   üìê –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã: ${maxLength}√ó${maxWidth}√ó${maxHeight} —Å–º`);\n03543|       }\n03544| \n03545|       // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è FIAS –∫–æ–¥–∞ –≥–æ—Ä–æ–¥–∞\n03546|       const getCityFias = (cityName: string): string => {\n03547|         const cityFiasMap: Record<string, string> = {\n03548|           '–º–æ—Å–∫–≤–∞': '0c5b2444-70a0-4932-980c-b4dc0d3f02b5',\n03549|           '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': 'c2deb16a-0330-4f05-821f-1d09c93331e6',\n03550|           '—Å–ø–±': 'c2deb16a-0330-4f05-821f-1d09c93331e6',\n03551|           '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': '2763c110-cb8b-416a-9dac-ad28a55b4402',\n03552|           '–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫': '8dea00e3-9aab-4d8e-887c-ef2aaa546456',\n03553|           '–∫–∞–∑–∞–Ω—å': '93b3df57-4c89-44df-ac42-96f05e9cd3b9',\n03554|           '–Ω–∏–∂–Ω–∏–π –Ω–æ–≤–≥–æ—Ä–æ–¥': '555e7d61-d9a7-4ba6-9770-6caa8198c483',\n03555|           '—á–µ–ª—è–±–∏–Ω—Å–∫': 'a376e68d-724a-4472-be7c-891bdb09ae32',\n03556|           '–æ–º—Å–∫': 'bb035cc3-1dc2-4627-9d25-a1bf5fed073d',\n03557|           '—Ä–æ—Å—Ç–æ–≤-–Ω–∞-–¥–æ–Ω—É': 'c1cfe4b9-f7c2-423c-abfa-6ed5cb24d83e',\n03558|           '—É—Ñ–∞': '7339e834-2cb4-473c-9c6e-93f3dcd66011',\n03559|           '–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫': '9b968c73-f4d4-4012-8da8-3dacd4d4c1bd',\n03560|           '–ø–µ—Ä–º—å': '4dc222e8-1f6a-4c36-894b-2b4a8c8a9b08',\n03561|           '–≤–æ—Ä–æ–Ω–µ–∂': '5bf5ddff-6353-4a3d-80c4-6fb27f00c6c1',\n03562|           '–≤–æ–ª–≥–æ–≥—Ä–∞–¥': 'da051ec8-da2e-4a66-b542-473b8d221ab6',\n03563|           '–ª–æ—Å–∏–Ω–æ-–ø–µ—Ç—Ä–æ–≤—Å–∫–∏–π': '0c5b2444-70a0-4932-980c-b4dc0d3f02b5', // –ò—Å–ø–æ–ª—å–∑—É–µ–º FIAS –ú–æ—Å–∫–≤—ã (–±–ª–∏–∂–∞–π—à–∏–π –∫—Ä—É–ø–Ω—ã–π –≥–æ—Ä–æ–¥)\n03564|         };\n03565| \n03566|         const normalizedCity = cityName.toLowerCase().trim()\n03567|           .replace(/^–≥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥ \"\n03568|           .replace(/^–≥–æ—Ä–æ–¥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥–æ—Ä–æ–¥ \"\n03569|           .replace(/\\s+/g, ' '); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—Ä–æ–±–µ–ª—ã\n03570| \n03571|         return cityFiasMap[normalizedCity] || '0c5b2444-70a0-4932-980c-b4dc0d3f02b5'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ú–æ—Å–∫–≤–∞\n03572|       };\n03573|       // üèôÔ∏è –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ª–æ–∫–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–æ—Ä–º—ã\n03574|       const getDispatchLocation = () => {\n03575|         if (form.fromTerminal) {\n03576|           return {\n03577|             type: 'terminal' as const,\n03578|             // –î–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π FIAS –∫–æ–¥ –≥–æ—Ä–æ–¥–∞\n03579|             city_fias: getCityFias(form.fromCity)\n03580|           };\n03581|         } else if (form.fromLavsiteWarehouse) {\n03582|           // üè≠ –î–ª—è —Å–∫–ª–∞–¥–∞ –õ–∞–≤—Å–∏—Ç –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å FIAS –∫–æ–¥–æ–º –≥–æ—Ä–æ–¥–∞\n03583|           return {\n03584|             type: 'terminal' as const, // –ò—Å–ø–æ–ª—å–∑—É–µ–º terminal —Ç–∏–ø –¥–ª—è —Å–∫–ª–∞–¥–∞\n03585|             city_fias: getCityFias('–õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π') // –ò—Å–ø–æ–ª—å–∑—É–µ–º FIAS –≥–æ—Ä–æ–¥–∞ —Å–∫–ª–∞–¥–∞\n03586|           };\n03587|         } else {\n03588|           return {\n03589|             type: 'address' as const,\n03590|             address: form.fromAddress || form.fromCity // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥—Ä–µ—Å –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –≥–æ—Ä–æ–¥\n03591|           };\n03592|         }\n03593|       };\n03594| \n03595|       const getDestinationLocation = () => {\n03596|         if (form.toTerminal) {\n03597|           return {\n03598|             type: 'terminal' as const,\n03599|             // –î–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π FIAS –∫–æ–¥ –≥–æ—Ä–æ–¥–∞\n03600|             city_fias: getCityFias(form.toCity)\n03601|           };\n03602|         } else {\n03603|           return {\n03604|             type: 'address' as const,\n03605|             address: form.toAddress || form.toCity // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥—Ä–µ—Å –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –≥–æ—Ä–æ–¥\n03606|           };\n03607|         }\n03608|       };\n03609| \n03610|       // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è –Ω–æ–≤–æ–≥–æ API NordWheel —Å —É—á–µ—Ç–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–æ—Ä–º—ã\n03611|       const requestData = {\n03612|         dispatch: {\n03613|           location: getDispatchLocation()\n03614|         },\n03615|         destination: {\n03616|           location: getDestinationLocation()\n03617|         },\n03618|         cargo: {\n03619|           total_weight: totalWeight,\n03620|           total_volume: totalVolume,\n03621|           total_quantity: 1 // –í—Å–µ–≥–¥–∞ 1, —á—Ç–æ–±—ã NordWheel –Ω–µ —É–º–Ω–æ–∂–∞–ª —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –∫–æ–ª-–≤–æ –º–µ—Å—Ç\n03622|         },\n03623|         insurance: form.needInsurance && form.declaredValue ? form.declaredValue : null,\n03624|         insurance_refuse: !form.needInsurance,\n03625|         services: {\n03626|           is_package: form.needPackaging,\n03627|           is_documents_return: false,\n03628|           is_fragile: false\n03629|         },\n03630|         promocode: null\n03631|       };\n03632| \n03633|       console.log('üöõ Nord Wheel –Ω–æ–≤—ã–π API –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03634| \n03635|       const result = await enhancedApiRequest(\n03636|         apiUrl,\n03637|         {\n03638|           method: 'POST',\n03639|           headers: {\n03640|             'Content-Type': 'application/json'\n03641|           },\n03642|           body: JSON.stringify(requestData)\n03643|         },\n03644|         { operation: 'calculate', company: 'Nord Wheel' }\n03645|       );\n03646| \n03647|       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n03648|         console.error('‚ùå Nord Wheel API –æ—à–∏–±–∫–∞:', result.error);\n03649|         \n03650|         // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ 400 –∏ –±–æ–ª—å—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø—Ä–æ–±—É–µ–º —Å —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏\n03651|         if (result.error.status === 400 && (totalWeight > 1000 || totalVolume > 5)) {\n03652|           console.log('üîÑ Nord Wheel: –ü—Ä–æ–±—É–µ–º fallback —Ä–∞—Å—á–µ—Ç —Å —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏...');\n03653|           \n03654|           const fallbackRequestData = {\n03655|             ...requestData,\n03656|             cargo: {\n03657|               total_weight: Math.min(totalWeight, 999),\n03658|               total_volume: Math.min(totalVolume, 4.9),\n03659|               total_quantity: 1 // –¢–∞–∫–∂–µ –≤—Å–µ–≥–¥–∞ 1 –¥–ª—è fallback\n03660|             }\n03661|           };\n03662|           \n03663|           console.log('üîÑ Fallback –∑–∞–ø—Ä–æ—Å:', JSON.stringify(fallbackRequestData, null, 2));\n03664|           \n03665|           const fallbackResult = await enhancedApiRequest(\n03666|             apiUrl,\n03667|             {\n03668|               method: 'POST',\n03669|               headers: {\n03670|                 'Content-Type': 'application/json'\n03671|               },\n03672|               body: JSON.stringify(fallbackRequestData)\n03673|             },\n03674|             { operation: 'calculate', company: 'Nord Wheel (fallback)' }\n03675|           );\n03676|           \n03677|           if (fallbackResult && typeof fallbackResult === 'object' && 'success' in fallbackResult && !fallbackResult.success) {\n03678|             console.error('‚ùå Nord Wheel fallback —Ç–æ–∂–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:', fallbackResult.error);\n03679|           } else {\n03680|             console.log('‚úÖ Nord Wheel fallback —Å—Ä–∞–±–æ—Ç–∞–ª! –ò—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.');\n03681|             // –ò—Å–ø–æ–ª—å–∑—É–µ–º fallback —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞\n03682|             const fallbackResponse = fallbackResult as Response;\n03683|             const fallbackData = await fallbackResponse.json();\n03684|             \n03685|             // –ü–∞—Ä—Å–∏–º fallback —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º —Ü–µ–Ω—É\n03686|             const scaleFactor = Math.max(totalWeight / 999, totalVolume / 4.9);\n03687|             \n03688|             if (fallbackData.auto || fallbackData.avia) {\n03689|               const options: Array<{\n03690|                 type: string;\n03691|                 price: number;\n03692|                 days: any;\n03693|                 services: any;\n03694|               }> = [];\n03695|               \n03696|               if (fallbackData.auto) {\n03697|                 const scaledPrice = Math.round((fallbackData.auto.total_amount || 0) * scaleFactor);\n03698|                 options.push({\n03699|                   type: 'auto',\n03700|                   price: scaledPrice,\n03701|                   days: fallbackData.auto.delivery_date || '',\n03702|                   services: fallbackData.auto.services || []\n03703|                 });\n03704|               }\n03705|               \n03706|               if (fallbackData.avia) {\n03707|                 const scaledPrice = Math.round((fallbackData.avia.total_amount || 0) * scaleFactor);\n03708|                 options.push({\n03709|                   type: 'avia',\n03710|                   price: scaledPrice,\n03711|                   days: fallbackData.avia.delivery_date || '',\n03712|                   services: fallbackData.avia.services || []\n03713|                 });\n03714|               }\n03715|               \n03716|               if (options.length > 0) {\n03717|                 const bestOption = options.reduce((best, current) => \n03718|                   current.price < best.price ? current : best\n03719|                 );\n03720|                 \n03721|                 // –í—ã—á–∏—Å–ª—è–µ–º –¥–Ω–∏\n03722|                 let calculatedDays = 3;\n03723|                 try {\n03724|                   if (bestOption.days) {\n03725|                     const deliveryDate = new Date(bestOption.days);\n03726|                     const today = new Date();\n03727|                     if (!isNaN(deliveryDate.getTime())) {\n03728|                       const diffTime = deliveryDate.getTime() - today.getTime();\n03729|                       calculatedDays = Math.max(1, Math.ceil(diffTime / (1000 * 60 * 60 * 24)));\n03730|                     }\n\n(File has more lines. Use 'offset' parameter to read beyond line 3730)\n</file>",
    "title": "app/page.tsx",
    "metadata": {
      "preview": "  };\n\n  // –†–∞—Å—á–µ—Ç –¥–ª—è Nord Wheel\n  const calculateNordWheel = async (): Promise<CalculationResult> => {\n    const apiUrl = '/api/nordwheel';\n\n    try {\n      // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      validateMultipleCargos(form.cargos);\n      \n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n      const totalVolume = form.cargos.reduce((sum, cargo) => \n        sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n      );\n\n      // üîß –î–û–ë–ê–í–õ–ï–ù–û: –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π API NordWheel\n      if (totalWeight > 1000) {\n        console.warn('‚ö†Ô∏è Nord Wheel: –í–µ—Å –ø—Ä–µ–≤—ã—à–∞–µ—Ç 1000 –∫–≥, –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∞ API');\n      }\n      if (totalVolume > 5) {"
    },
    "time": {
      "start": 1765815346145,
      "end": 1765815346152
    }
  }
}