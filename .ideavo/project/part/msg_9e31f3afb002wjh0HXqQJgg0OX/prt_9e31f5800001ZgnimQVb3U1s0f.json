{
  "id": "prt_9e31f5800001ZgnimQVb3U1s0f",
  "messageID": "msg_9e31f3afb002wjh0HXqQJgg0OX",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "write",
  "callID": "call_27315551",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "components/ErrorFallback.tsx",
      "content": "import React from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { AlertTriangle, RefreshCw, Home, MessageSquare } from 'lucide-react';\nimport { ErrorResult } from '@/lib/error-handling';\n\ninterface ErrorFallbackProps {\n  error: ErrorResult;\n  onRetry?: () => void;\n  showHomeButton?: boolean;\n}\n\nexport default function ErrorFallback({\n  error,\n  onRetry,\n  showHomeButton = true\n}: ErrorFallbackProps) {\n  const handleRetry = () => {\n    if (onRetry) {\n      onRetry();\n    } else {\n      window.location.reload();\n    }\n  };\n\n  const handleGoHome = () => {\n    window.location.href = '/';\n  };\n\n  const handleContactSupport = () => {\n    // This could open a support chat or email\n    const subject = encodeURIComponent('Ошибка в приложении Freight Calculator');\n    const body = encodeURIComponent(`\nОшибка: ${error.error.message}\nТип: ${error.error.type}\nВремя: ${error.error.context.timestamp}\nОперация: ${error.error.context.operation}\n\nПожалуйста, опишите что вы делали когда произошла ошибка.\n    `.trim());\n\n    window.open(`mailto:support@freightcalc.com?subject=${subject}&body=${body}`);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-red-50 to-orange-50 flex items-center justify-center p-4\">\n      <Card className=\"max-w-2xl w-full border-red-200 bg-white/95 backdrop-blur-sm shadow-xl\">\n        <CardHeader className=\"text-center\">\n          <div className=\"mx-auto mb-4 p-4 bg-red-100 rounded-full w-fit\">\n            <AlertTriangle className=\"h-12 w-12 text-red-600\" />\n          </div>\n          <CardTitle className=\"text-2xl text-red-800 mb-2\">\n            Что-то пошло не так\n          </CardTitle>\n          <CardDescription className=\"text-lg text-gray-600\">\n            {error.error.userMessage}\n          </CardDescription>\n        </CardHeader>\n\n        <CardContent className=\"space-y-6\">\n          {/* Error Details */}\n          <div className=\"bg-gray-50 p-4 rounded-lg border\">\n            <h4 className=\"font-semibold text-gray-800 mb-2\">Детали ошибки:</h4>\n            <div className=\"space-y-1 text-sm text-gray-600\">\n              <div><strong>Тип:</strong> {error.error.type}</div>\n              <div><strong>Операция:</strong> {error.error.context.operation}</div>\n              {error.error.context.company && (\n                <div><strong>Компания:</strong> {error.error.context.company}</div>\n              )}\n              <div><strong>Время:</strong> {new Date(error.error.context.timestamp).toLocaleString('ru-RU')}</div>\n              {error.error.context.retryCount && error.error.context.retryCount > 0 && (\n                <div><strong>Попыток:</strong> {error.error.context.retryCount + 1}</div>\n              )}\n            </div>\n          </div>\n\n          {/* Suggested Action */}\n          {error.error.suggestedAction && (\n            <div className=\"bg-blue-50 p-4 rounded-lg border border-blue-200\">\n              <h4 className=\"font-semibold text-blue-800 mb-2\">Рекомендуемое действие:</h4>\n              <p className=\"text-blue-700\">{error.error.suggestedAction}</p>\n            </div>\n          )}\n\n          {/* Fallback Data Notice */}\n          {error.fallbackData && (\n            <div className=\"bg-yellow-50 p-4 rounded-lg border border-yellow-200\">\n              <h4 className=\"font-semibold text-yellow-800 mb-2\">⚠️ Показаны кешированные данные</h4>\n              <p className=\"text-yellow-700 text-sm\">\n                Данные могут быть не актуальными. Попробуйте обновить страницу позже.\n              </p>\n            </div>\n          )}\n\n          {/* Action Buttons */}\n          <div className=\"flex flex-col sm:flex-row gap-3\">\n            {error.error.retryable && (\n              <Button\n                onClick={handleRetry}\n                className=\"flex-1 bg-blue-600 hover:bg-blue-700\"\n              >\n                <RefreshCw className=\"h-4 w-4 mr-2\" />\n                Попробовать снова\n              </Button>\n            )}\n\n            {showHomeButton && (\n              <Button\n                onClick={handleGoHome}\n                variant=\"outline\"\n                className=\"flex-1\"\n              >\n                <Home className=\"h-4 w-4 mr-2\" />\n                На главную\n              </Button>\n            )}\n\n            <Button\n              onClick={handleContactSupport}\n              variant=\"outline\"\n              className=\"flex-1\"\n            >\n              <MessageSquare className=\"h-4 w-4 mr-2\" />\n              Поддержка\n            </Button>\n          </div>\n\n          {/* Technical Details (only in development) */}\n          {process.env.NODE_ENV === 'development' && error.error.technicalDetails && (\n            <details className=\"mt-4\">\n              <summary className=\"cursor-pointer text-sm text-gray-500 hover:text-gray-700\">\n                Технические детали (для разработчиков)\n              </summary>\n              <pre className=\"mt-2 p-3 bg-gray-100 rounded text-xs overflow-x-auto\">\n                {JSON.stringify(error.error.technicalDetails, null, 2)}\n              </pre>\n            </details>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}"
    },
    "output": "",
    "metadata": {
      "diagnostics": {},
      "filepath": "/home/user/project/components/ErrorFallback.tsx",
      "exists": false
    },
    "title": "components/ErrorFallback.tsx",
    "time": {
      "start": 1760452106242,
      "end": 1760452106242
    }
  }
}