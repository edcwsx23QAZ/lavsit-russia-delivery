{
  "id": "prt_9ba21a06a0012qkuw7uIUbdYmj",
  "messageID": "msg_9ba20c3f5001qc5KFhdoTH9vaK",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "bash",
  "callID": "toolu_015YQb53vQmLTHt13QD95u3S",
  "state": {
    "status": "completed",
    "input": {
      "command": "cat > /home/user/project/public/clear-dev-cache.js << 'EOF'\n// CRITICAL DEV CACHE CLEARING SCRIPT\n// Очищает ВСЕ кроме данных формы пользователя\n(function() {\n  'use strict';\n  \n  console.log('[CACHE-CLEAR] Starting selective cache clearing...');\n  \n  // Сохраняем пользовательские данные формы перед очисткой\n  let savedFormData = null;\n  let savedAppVersion = null;\n  try {\n    if (typeof localStorage !== 'undefined') {\n      // Сохраняем только данные формы и версию приложения\n      savedFormData = localStorage.getItem('deliveryFormData');\n      savedAppVersion = localStorage.getItem('appVersion');\n      \n      // Полная очистка localStorage\n      localStorage.clear();\n      console.log('[CACHE-CLEAR] localStorage cleared');\n      \n      // Восстанавливаем только пользовательские данные\n      if (savedFormData) {\n        localStorage.setItem('deliveryFormData', savedFormData);\n        console.log('[CACHE-CLEAR] Form data restored');\n      }\n      if (savedAppVersion) {\n        localStorage.setItem('appVersion', savedAppVersion);\n        console.log('[CACHE-CLEAR] App version restored');\n      }\n    }\n  } catch (e) {\n    console.warn('[CACHE-CLEAR] localStorage selective clear failed:', e);\n  }\n  \n  try {\n    if (typeof sessionStorage !== 'undefined') {\n      sessionStorage.clear();\n      console.log('[CACHE-CLEAR] sessionStorage cleared');\n    }\n  } catch (e) {\n    console.warn('[CACHE-CLEAR] sessionStorage clear failed:', e);\n  }\n  \n  // Clear all caches\n  if ('caches' in window) {\n    caches.keys().then(function(cacheNames) {\n      console.log('[CACHE-CLEAR] Found caches:', cacheNames);\n      return Promise.all(\n        cacheNames.map(function(cacheName) {\n          console.log('[CACHE-CLEAR] Deleting cache:', cacheName);\n          return caches.delete(cacheName);\n        })\n      );\n    }).then(function() {\n      console.log('[CACHE-CLEAR] All caches cleared');\n    }).catch(function(error) {\n      console.warn('[CACHE-CLEAR] Cache clearing failed:', error);\n    });\n  }\n  \n  // Unregister all service workers\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.getRegistrations().then(function(registrations) {\n      console.log('[CACHE-CLEAR] Found service workers:', registrations.length);\n      return Promise.all(\n        registrations.map(function(registration) {\n          console.log('[CACHE-CLEAR] Unregistering SW:', registration.scope);\n          return registration.unregister();\n        })\n      );\n    }).then(function() {\n      console.log('[CACHE-CLEAR] All service workers unregistered');\n    }).catch(function(error) {\n      console.warn('[CACHE-CLEAR] SW unregistration failed:', error);\n    });\n  }\n  \n  console.log('[CACHE-CLEAR] Selective cache clearing completed');\n})();\nEOF",
      "description": "Rewrite clear-dev-cache.js with selective clearing"
    },
    "output": "",
    "metadata": {
      "output": "",
      "exit": 0,
      "description": "Rewrite clear-dev-cache.js with selective clearing"
    },
    "title": "cat > /home/user/project/public/clear-dev-cache.js << 'EOF'\n// CRITICAL DEV CACHE CLEARING SCRIPT\n// Очищает ВСЕ кроме данных формы пользователя\n(function() {\n  'use strict';\n  \n  console.log('[CACHE-CLEAR] Starting selective cache clearing...');\n  \n  // Сохраняем пользовательские данные формы перед очисткой\n  let savedFormData = null;\n  let savedAppVersion = null;\n  try {\n    if (typeof localStorage !== 'undefined') {\n      // Сохраняем только данные формы и версию приложения\n      savedFormData = localStorage.getItem('deliveryFormData');\n      savedAppVersion = localStorage.getItem('appVersion');\n      \n      // Полная очистка localStorage\n      localStorage.clear();\n      console.log('[CACHE-CLEAR] localStorage cleared');\n      \n      // Восстанавливаем только пользовательские данные\n      if (savedFormData) {\n        localStorage.setItem('deliveryFormData', savedFormData);\n        console.log('[CACHE-CLEAR] Form data restored');\n      }\n      if (savedAppVersion) {\n        localStorage.setItem('appVersion', savedAppVersion);\n        console.log('[CACHE-CLEAR] App version restored');\n      }\n    }\n  } catch (e) {\n    console.warn('[CACHE-CLEAR] localStorage selective clear failed:', e);\n  }\n  \n  try {\n    if (typeof sessionStorage !== 'undefined') {\n      sessionStorage.clear();\n      console.log('[CACHE-CLEAR] sessionStorage cleared');\n    }\n  } catch (e) {\n    console.warn('[CACHE-CLEAR] sessionStorage clear failed:', e);\n  }\n  \n  // Clear all caches\n  if ('caches' in window) {\n    caches.keys().then(function(cacheNames) {\n      console.log('[CACHE-CLEAR] Found caches:', cacheNames);\n      return Promise.all(\n        cacheNames.map(function(cacheName) {\n          console.log('[CACHE-CLEAR] Deleting cache:', cacheName);\n          return caches.delete(cacheName);\n        })\n      );\n    }).then(function() {\n      console.log('[CACHE-CLEAR] All caches cleared');\n    }).catch(function(error) {\n      console.warn('[CACHE-CLEAR] Cache clearing failed:', error);\n    });\n  }\n  \n  // Unregister all service workers\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.getRegistrations().then(function(registrations) {\n      console.log('[CACHE-CLEAR] Found service workers:', registrations.length);\n      return Promise.all(\n        registrations.map(function(registration) {\n          console.log('[CACHE-CLEAR] Unregistering SW:', registration.scope);\n          return registration.unregister();\n        })\n      );\n    }).then(function() {\n      console.log('[CACHE-CLEAR] All service workers unregistered');\n    }).catch(function(error) {\n      console.warn('[CACHE-CLEAR] SW unregistration failed:', error);\n    });\n  }\n  \n  console.log('[CACHE-CLEAR] Selective cache clearing completed');\n})();\nEOF",
    "time": {
      "start": 1759764400819,
      "end": 1759764400832
    }
  }
}