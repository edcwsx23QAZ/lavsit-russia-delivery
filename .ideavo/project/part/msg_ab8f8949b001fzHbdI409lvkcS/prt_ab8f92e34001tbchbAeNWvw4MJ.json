{
  "id": "prt_ab8f92e34001tbchbAeNWvw4MJ",
  "sessionID": "ses_54b97e247ffenCZZa4jZiIWD0l",
  "messageID": "msg_ab8f8949b001fzHbdI409lvkcS",
  "type": "tool",
  "callID": "call_ca8573de8bb440df89f7c6a6",
  "tool": "edit",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/components/CalculationHistory.tsx",
      "oldString": "      </DialogContent>\n\n      {/* Диалог с деталями расчета */}\n      <Dialog open={showDetails} onOpenChange={setShowDetails}>\n        <DialogContent className=\"sm:max-w-2xl max-h-[80vh]\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Eye className=\"w-5 h-5\" />\n              Детали расчета\n            </DialogTitle>\n          </DialogHeader>\n          \n          {selectedCalculation && (\n            <ScrollArea className=\"h-[60vh]\">\n              <div className=\"space-y-4\">\n                {/* Информация о расчете */}\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"text-sm\">Информация о расчете</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Номер заказа:</span>\n                      <span>{selectedCalculation.orderNumber || 'Без номера'}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Дата создания:</span>\n                      <span>{formatDate(selectedCalculation.createdAt)}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Статус:</span>\n                      <Badge variant=\"outline\">{selectedCalculation.status}</Badge>\n                    </div>\n                    {selectedCalculation.note && (\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-gray-600\">Примечание:</span>\n                        <span className=\"text-xs\">{selectedCalculation.note}</span>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n\n                {/* Маршрут */}\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"text-sm\">Маршрут</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Откуда:</span>\n                      <span>{selectedCalculation.formData.fromCity}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Куда:</span>\n                      <span>{selectedCalculation.formData.toCity}</span>\n                    </div>\n                    {selectedCalculation.formData.fromAddress && (\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-gray-600\">Адрес отправления:</span>\n                        <span>{selectedCalculation.formData.fromAddress}</span>\n                      </div>\n                    )}\n                    {selectedCalculation.formData.toAddress && (\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-gray-600\">Адрес доставки:</span>\n                        <span>{selectedCalculation.formData.toAddress}</span>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n\n                {/* Грузы */}\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"text-sm\">Грузы ({getCargoCount(selectedCalculation.formData)})</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-2\">\n                      {selectedCalculation.formData.cargos\n                        .filter((cargo: any) => \n                          cargo.length > 0 || cargo.width > 0 || cargo.height > 0 || cargo.weight > 0\n                        )\n                        .map((cargo: any, index: number) => (\n                          <div key={index} className=\"flex justify-between text-sm p-2 bg-gray-50 rounded\">\n                            <span>Груз {index + 1}</span>\n                            <span>\n                              {cargo.length}×{cargo.width}×{cargo.height} см, {cargo.weight} кг\n                            </span>\n                          </div>\n                        ))}\n                    </div>\n                  </CardContent>\n                </Card>\n\n                {/* Результаты расчета */}\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"text-sm\">Результаты расчета</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-2\">\n                      {selectedCalculation.results.map((result: any, index: number) => (\n                        <div key={index} className=\"flex justify-between items-center p-2 bg-gray-50 rounded\">\n                          <div>\n                            <div className=\"font-medium text-sm\">{result.company}</div>\n                            {result.error && (\n                              <div className=\"text-xs text-red-600\">{result.error}</div>\n                            )}\n                          </div>\n                          <div className=\"text-right\">\n                            {!result.error && (\n                              <>\n                                <div className=\"font-bold text-sm\">{result.price.toLocaleString()} ₽</div>\n                                <div className=\"text-xs text-gray-600\">{result.days} дней</div>\n                              </>\n                            )}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </CardContent>\n                </Card>\n\n                {/* Скриншот */}\n                {selectedCalculation.screenshot && (\n                  <Card>\n                    <CardHeader>\n                      <CardTitle className=\"text-sm\">Скриншот расчета</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <img \n                        src={selectedCalculation.screenshot} \n                        alt=\"Скриншот расчета\"\n                        className=\"w-full rounded border\"\n                      />\n                    </CardContent>\n                  </Card>\n                )}\n              </div>\n            </ScrollArea>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );",
      "newString": "      </DialogContent>\n    </Dialog>\n\n    {/* Диалог с деталями расчета */}\n    <Dialog open={showDetails} onOpenChange={setShowDetails}>\n      <DialogContent className=\"sm:max-w-2xl max-h-[80vh]\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Eye className=\"w-5 h-5\" />\n            Детали расчета\n          </DialogTitle>\n        </DialogHeader>\n        \n        {selectedCalculation && (\n          <ScrollArea className=\"h-[60vh]\">\n            <div className=\"space-y-4\">\n              {/* Информация о расчете */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-sm\">Информация о расчете</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-2 text-sm\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">Номер заказа:</span>\n                    <span>{selectedCalculation.orderNumber || 'Без номера'}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">Дата создания:</span>\n                    <span>{formatDate(selectedCalculation.createdAt)}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">Статус:</span>\n                    <Badge variant=\"outline\">{selectedCalculation.status}</Badge>\n                  </div>\n                  {selectedCalculation.note && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Примечание:</span>\n                      <span className=\"text-xs\">{selectedCalculation.note}</span>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Маршрут */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-sm\">Маршрут</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-2 text-sm\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">Откуда:</span>\n                    <span>{selectedCalculation.formData.fromCity}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">Куда:</span>\n                    <span>{selectedCalculation.formData.toCity}</span>\n                  </div>\n                  {selectedCalculation.formData.fromAddress && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Адрес отправления:</span>\n                      <span>{selectedCalculation.formData.fromAddress}</span>\n                    </div>\n                  )}\n                  {selectedCalculation.formData.toAddress && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Адрес доставки:</span>\n                      <span>{selectedCalculation.formData.toAddress}</span>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Грузы */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-sm\">Грузы ({getCargoCount(selectedCalculation.formData)})</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-2\">\n                    {selectedCalculation.formData.cargos\n                      .filter((cargo: any) => \n                        cargo.length > 0 || cargo.width > 0 || cargo.height > 0 || cargo.weight > 0\n                      )\n                      .map((cargo: any, index: number) => (\n                        <div key={index} className=\"flex justify-between text-sm p-2 bg-gray-50 rounded\">\n                          <span>Груз {index + 1}</span>\n                          <span>\n                            {cargo.length}×{cargo.width}×{cargo.height} см, {cargo.weight} кг\n                          </span>\n                        </div>\n                      ))}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Результаты расчета */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-sm\">Результаты расчета</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-2\">\n                    {selectedCalculation.results.map((result: any, index: number) => (\n                      <div key={index} className=\"flex justify-between items-center p-2 bg-gray-50 rounded\">\n                        <div>\n                          <div className=\"font-medium text-sm\">{result.company}</div>\n                          {result.error && (\n                            <div className=\"text-xs text-red-600\">{result.error}</div>\n                          )}\n                        </div>\n                        <div className=\"text-right\">\n                          {!result.error && (\n                            <>\n                              <div className=\"font-bold text-sm\">{result.price.toLocaleString()} ₽</div>\n                              <div className=\"text-xs text-gray-600\">{result.days} дней</div>\n                            </>\n                          )}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Скриншот */}\n              {selectedCalculation.screenshot && (\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"text-sm\">Скриншот расчета</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <img \n                      src={selectedCalculation.screenshot} \n                      alt=\"Скриншот расчета\"\n                      className=\"w-full rounded border\"\n                    />\n                  </CardContent>\n                </Card>\n              )}\n            </div>\n          </ScrollArea>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n}"
    },
    "output": "",
    "title": "components/CalculationHistory.tsx",
    "metadata": {
      "diagnostics": {},
      "diff": "Index: /home/user/project/components/CalculationHistory.tsx\n===================================================================\n--- /home/user/project/components/CalculationHistory.tsx\n+++ /home/user/project/components/CalculationHistory.tsx\n@@ -245,149 +245,150 @@\n             </div>\n           )}\n         </div>\n       </DialogContent>\n+    </Dialog>\n \n-      {/* Диалог с деталями расчета */}\n-      <Dialog open={showDetails} onOpenChange={setShowDetails}>\n-        <DialogContent className=\"sm:max-w-2xl max-h-[80vh]\">\n-          <DialogHeader>\n-            <DialogTitle className=\"flex items-center gap-2\">\n-              <Eye className=\"w-5 h-5\" />\n-              Детали расчета\n-            </DialogTitle>\n-          </DialogHeader>\n-          \n-          {selectedCalculation && (\n-            <ScrollArea className=\"h-[60vh]\">\n-              <div className=\"space-y-4\">\n-                {/* Информация о расчете */}\n-                <Card>\n-                  <CardHeader>\n-                    <CardTitle className=\"text-sm\">Информация о расчете</CardTitle>\n-                  </CardHeader>\n-                  <CardContent className=\"space-y-2 text-sm\">\n+    {/* Диалог с деталями расчета */}\n+    <Dialog open={showDetails} onOpenChange={setShowDetails}>\n+      <DialogContent className=\"sm:max-w-2xl max-h-[80vh]\">\n+        <DialogHeader>\n+          <DialogTitle className=\"flex items-center gap-2\">\n+            <Eye className=\"w-5 h-5\" />\n+            Детали расчета\n+          </DialogTitle>\n+        </DialogHeader>\n+        \n+        {selectedCalculation && (\n+          <ScrollArea className=\"h-[60vh]\">\n+            <div className=\"space-y-4\">\n+              {/* Информация о расчете */}\n+              <Card>\n+                <CardHeader>\n+                  <CardTitle className=\"text-sm\">Информация о расчете</CardTitle>\n+                </CardHeader>\n+                <CardContent className=\"space-y-2 text-sm\">\n+                  <div className=\"flex justify-between\">\n+                    <span className=\"text-gray-600\">Номер заказа:</span>\n+                    <span>{selectedCalculation.orderNumber || 'Без номера'}</span>\n+                  </div>\n+                  <div className=\"flex justify-between\">\n+                    <span className=\"text-gray-600\">Дата создания:</span>\n+                    <span>{formatDate(selectedCalculation.createdAt)}</span>\n+                  </div>\n+                  <div className=\"flex justify-between\">\n+                    <span className=\"text-gray-600\">Статус:</span>\n+                    <Badge variant=\"outline\">{selectedCalculation.status}</Badge>\n+                  </div>\n+                  {selectedCalculation.note && (\n                     <div className=\"flex justify-between\">\n-                      <span className=\"text-gray-600\">Номер заказа:</span>\n-                      <span>{selectedCalculation.orderNumber || 'Без номера'}</span>\n+                      <span className=\"text-gray-600\">Примечание:</span>\n+                      <span className=\"text-xs\">{selectedCalculation.note}</span>\n                     </div>\n-                    <div className=\"flex justify-between\">\n-                      <span className=\"text-gray-600\">Дата создания:</span>\n-                      <span>{formatDate(selectedCalculation.createdAt)}</span>\n-                    </div>\n-                    <div className=\"flex justify-between\">\n-                      <span className=\"text-gray-600\">Статус:</span>\n-                      <Badge variant=\"outline\">{selectedCalculation.status}</Badge>\n-                    </div>\n-                    {selectedCalculation.note && (\n-                      <div className=\"flex justify-between\">\n-                        <span className=\"text-gray-600\">Примечание:</span>\n-                        <span className=\"text-xs\">{selectedCalculation.note}</span>\n-                      </div>\n-                    )}\n-                  </CardContent>\n-                </Card>\n+                  )}\n+                </CardContent>\n+              </Card>\n \n-                {/* Маршрут */}\n-                <Card>\n-                  <CardHeader>\n-                    <CardTitle className=\"text-sm\">Маршрут</CardTitle>\n-                  </CardHeader>\n-                  <CardContent className=\"space-y-2 text-sm\">\n+              {/* Маршрут */}\n+              <Card>\n+                <CardHeader>\n+                  <CardTitle className=\"text-sm\">Маршрут</CardTitle>\n+                </CardHeader>\n+                <CardContent className=\"space-y-2 text-sm\">\n+                  <div className=\"flex justify-between\">\n+                    <span className=\"text-gray-600\">Откуда:</span>\n+                    <span>{selectedCalculation.formData.fromCity}</span>\n+                  </div>\n+                  <div className=\"flex justify-between\">\n+                    <span className=\"text-gray-600\">Куда:</span>\n+                    <span>{selectedCalculation.formData.toCity}</span>\n+                  </div>\n+                  {selectedCalculation.formData.fromAddress && (\n                     <div className=\"flex justify-between\">\n-                      <span className=\"text-gray-600\">Откуда:</span>\n-                      <span>{selectedCalculation.formData.fromCity}</span>\n+                      <span className=\"text-gray-600\">Адрес отправления:</span>\n+                      <span>{selectedCalculation.formData.fromAddress}</span>\n                     </div>\n+                  )}\n+                  {selectedCalculation.formData.toAddress && (\n                     <div className=\"flex justify-between\">\n-                      <span className=\"text-gray-600\">Куда:</span>\n-                      <span>{selectedCalculation.formData.toCity}</span>\n+                      <span className=\"text-gray-600\">Адрес доставки:</span>\n+                      <span>{selectedCalculation.formData.toAddress}</span>\n                     </div>\n-                    {selectedCalculation.formData.fromAddress && (\n-                      <div className=\"flex justify-between\">\n-                        <span className=\"text-gray-600\">Адрес отправления:</span>\n-                        <span>{selectedCalculation.formData.fromAddress}</span>\n+                  )}\n+                </CardContent>\n+              </Card>\n+\n+              {/* Грузы */}\n+              <Card>\n+                <CardHeader>\n+                  <CardTitle className=\"text-sm\">Грузы ({getCargoCount(selectedCalculation.formData)})</CardTitle>\n+                </CardHeader>\n+                <CardContent>\n+                  <div className=\"space-y-2\">\n+                    {selectedCalculation.formData.cargos\n+                      .filter((cargo: any) => \n+                        cargo.length > 0 || cargo.width > 0 || cargo.height > 0 || cargo.weight > 0\n+                      )\n+                      .map((cargo: any, index: number) => (\n+                        <div key={index} className=\"flex justify-between text-sm p-2 bg-gray-50 rounded\">\n+                          <span>Груз {index + 1}</span>\n+                          <span>\n+                            {cargo.length}×{cargo.width}×{cargo.height} см, {cargo.weight} кг\n+                          </span>\n+                        </div>\n+                      ))}\n+                  </div>\n+                </CardContent>\n+              </Card>\n+\n+              {/* Результаты расчета */}\n+              <Card>\n+                <CardHeader>\n+                  <CardTitle className=\"text-sm\">Результаты расчета</CardTitle>\n+                </CardHeader>\n+                <CardContent>\n+                  <div className=\"space-y-2\">\n+                    {selectedCalculation.results.map((result: any, index: number) => (\n+                      <div key={index} className=\"flex justify-between items-center p-2 bg-gray-50 rounded\">\n+                        <div>\n+                          <div className=\"font-medium text-sm\">{result.company}</div>\n+                          {result.error && (\n+                            <div className=\"text-xs text-red-600\">{result.error}</div>\n+                          )}\n+                        </div>\n+                        <div className=\"text-right\">\n+                          {!result.error && (\n+                            <>\n+                              <div className=\"font-bold text-sm\">{result.price.toLocaleString()} ₽</div>\n+                              <div className=\"text-xs text-gray-600\">{result.days} дней</div>\n+                            </>\n+                          )}\n+                        </div>\n                       </div>\n-                    )}\n-                    {selectedCalculation.formData.toAddress && (\n-                      <div className=\"flex justify-between\">\n-                        <span className=\"text-gray-600\">Адрес доставки:</span>\n-                        <span>{selectedCalculation.formData.toAddress}</span>\n-                      </div>\n-                    )}\n-                  </CardContent>\n-                </Card>\n+                    ))}\n+                  </div>\n+                </CardContent>\n+              </Card>\n \n-                {/* Грузы */}\n+              {/* Скриншот */}\n+              {selectedCalculation.screenshot && (\n                 <Card>\n                   <CardHeader>\n-                    <CardTitle className=\"text-sm\">Грузы ({getCargoCount(selectedCalculation.formData)})</CardTitle>\n+                    <CardTitle className=\"text-sm\">Скриншот расчета</CardTitle>\n                   </CardHeader>\n                   <CardContent>\n-                    <div className=\"space-y-2\">\n-                      {selectedCalculation.formData.cargos\n-                        .filter((cargo: any) => \n-                          cargo.length > 0 || cargo.width > 0 || cargo.height > 0 || cargo.weight > 0\n-                        )\n-                        .map((cargo: any, index: number) => (\n-                          <div key={index} className=\"flex justify-between text-sm p-2 bg-gray-50 rounded\">\n-                            <span>Груз {index + 1}</span>\n-                            <span>\n-                              {cargo.length}×{cargo.width}×{cargo.height} см, {cargo.weight} кг\n-                            </span>\n-                          </div>\n-                        ))}\n-                    </div>\n+                    <img \n+                      src={selectedCalculation.screenshot} \n+                      alt=\"Скриншот расчета\"\n+                      className=\"w-full rounded border\"\n+                    />\n                   </CardContent>\n                 </Card>\n-\n-                {/* Результаты расчета */}\n-                <Card>\n-                  <CardHeader>\n-                    <CardTitle className=\"text-sm\">Результаты расчета</CardTitle>\n-                  </CardHeader>\n-                  <CardContent>\n-                    <div className=\"space-y-2\">\n-                      {selectedCalculation.results.map((result: any, index: number) => (\n-                        <div key={index} className=\"flex justify-between items-center p-2 bg-gray-50 rounded\">\n-                          <div>\n-                            <div className=\"font-medium text-sm\">{result.company}</div>\n-                            {result.error && (\n-                              <div className=\"text-xs text-red-600\">{result.error}</div>\n-                            )}\n-                          </div>\n-                          <div className=\"text-right\">\n-                            {!result.error && (\n-                              <>\n-                                <div className=\"font-bold text-sm\">{result.price.toLocaleString()} ₽</div>\n-                                <div className=\"text-xs text-gray-600\">{result.days} дней</div>\n-                              </>\n-                            )}\n-                          </div>\n-                        </div>\n-                      ))}\n-                    </div>\n-                  </CardContent>\n-                </Card>\n-\n-                {/* Скриншот */}\n-                {selectedCalculation.screenshot && (\n-                  <Card>\n-                    <CardHeader>\n-                      <CardTitle className=\"text-sm\">Скриншот расчета</CardTitle>\n-                    </CardHeader>\n-                    <CardContent>\n-                      <img \n-                        src={selectedCalculation.screenshot} \n-                        alt=\"Скриншот расчета\"\n-                        className=\"w-full rounded border\"\n-                      />\n-                    </CardContent>\n-                  </Card>\n-                )}\n-              </div>\n-            </ScrollArea>\n-          )}\n-        </DialogContent>\n-      </Dialog>\n-    </div>\n+              )}\n+            </div>\n+          </ScrollArea>\n+        )}\n+      </DialogContent>\n+    </Dialog>\n   );\n+}\n }\n\\ No newline at end of file\n"
    },
    "time": {
      "start": 1764039929398,
      "end": 1764039929434
    }
  }
}