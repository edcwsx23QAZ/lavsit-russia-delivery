{
  "id": "prt_b22b4483a001wqEXsYhW7rViEe",
  "sessionID": "ses_4ec400949ffekDUyPGFumLInaA",
  "messageID": "msg_b22b431f3002Bt7LXeQgF3y0zr",
  "type": "text",
  "text": "## –ü–ª–∞–Ω –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è API Nordwheel\n\n### –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–æ–±–ª–µ–º Nordwheel\n\n1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —Å–∫–ª–∞–¥–∞ –õ–∞–≤—Å–∏—Ç**: –ö–æ–≥–¥–∞ `form.fromLavsiteWarehouse = true`, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `type: 'terminal'`, –Ω–æ —Å–∫–ª–∞–¥ –õ–∞–≤—Å–∏—Ç - —ç—Ç–æ –∞–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞.\n\n2. **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –º–∞–ø–ø–∏–Ω–≥ FIAS –∫–æ–¥–æ–≤**: –§—É–Ω–∫—Ü–∏—è `getCityFias` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—ã–º.\n\n### –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è Nordwheel)\n\n#### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ `getDispatchLocation` –≤ `calculateNordWheel`\n\n**–§–∞–π–ª:** `app/page.tsx` (—Å—Ç—Ä–æ–∫–∏ ~3574-3593)\n\n**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è —Å–∫–ª–∞–¥–∞ –õ–∞–≤—Å–∏—Ç —Å `type: 'terminal'` –Ω–∞ `type: 'address'` —Å –ø–æ–ª–Ω—ã–º –∞–¥—Ä–µ—Å–æ–º.\n\n```typescript\n} else if (form.fromLavsiteWarehouse) {\n  // üè≠ –°–∫–ª–∞–¥ –õ–∞–≤—Å–∏—Ç - —ç—Ç–æ –∞–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞, –∞ –Ω–µ —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è\n  return {\n    type: 'address' as const,\n    address: form.fromAddress || '–¥–µ—Ä–µ–≤–Ω—è –û—Å–µ–µ–≤–æ, 202, –≥–æ—Ä–æ–¥—Å–∫–æ–π –æ–∫—Ä—É–≥ –õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π, –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å'\n  };\n```\n\n#### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è FIAS –∫–æ–¥–æ–≤ —á–µ—Ä–µ–∑ Dadata (—Ç–æ–ª—å–∫–æ –¥–ª—è Nordwheel)\n\n**–§–∞–π–ª:** `app/page.tsx` (–≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ `calculateNordWheel`)\n\n**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ:** –õ–æ–∫–∞–ª—å–Ω–∞—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö FIAS –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Dadata findById API.\n\n```typescript\n// –õ–æ–∫–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è Nordwheel - –ø–æ–ª—É—á–µ–Ω–∏–µ FIAS —á–µ—Ä–µ–∑ Dadata\nasync function getNordwheelCityFias(cityName: string): Promise<string> {\n  try {\n    // –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ Dadata findById\n    const response = await fetch('/api/dadata?fias_id=' + encodeURIComponent(cityName) + '&type=findById');\n    const data = await response.json();\n    \n    if (data.success && data.data?.data?.city_fias_id) {\n      console.log(`üöõ Nordwheel: –ü–æ–ª—É—á–µ–Ω –∞–∫—Ç—É–∞–ª—å–Ω—ã–π FIAS –¥–ª—è ${cityName}:`, data.data.data.city_fias_id);\n      return data.data.data.city_fias_id;\n    }\n  } catch (error) {\n    console.warn(`üöõ Nordwheel: –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è FIAS —á–µ—Ä–µ–∑ Dadata –¥–ª—è ${cityName}:`, error);\n  }\n  \n  // Fallback –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏\n  return getCityFias(cityName);\n}\n```\n\n#### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `getDispatchLocation` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö FIAS –∫–æ–¥–æ–≤\n\n**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –°–¥–µ–ª–∞—Ç—å `getDispatchLocation` –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é.\n\n```typescript\nconst getDispatchLocation = async () => {\n  if (form.fromTerminal) {\n    return {\n      type: 'terminal' as const,\n      city_fias: await getNordwheelCityFias(form.fromCity)\n    };\n  } else if (form.fromLavsiteWarehouse) {\n    // üè≠ –°–∫–ª–∞–¥ –õ–∞–≤—Å–∏—Ç - –∞–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞\n    return {\n      type: 'address' as const,\n      address: form.fromAddress || '–¥–µ—Ä–µ–≤–Ω—è –û—Å–µ–µ–≤–æ, 202, –≥–æ—Ä–æ–¥—Å–∫–æ–π –æ–∫—Ä—É–≥ –õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π, –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å'\n    };\n  } else {\n    return {\n      type: 'address' as const,\n      address: form.fromAddress || form.fromCity\n    };\n  }\n};\n```\n\n#### 4. –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è `getDestinationLocation`\n\n```typescript\nconst getDestinationLocation = async () => {\n  if (form.toTerminal) {\n    return {\n      type: 'terminal' as const,\n      city_fias: await getNordwheelCityFias(form.toCity)\n    };\n  } else {\n    return {\n      type: 'address' as const,\n      address: form.toAddress || form.toCity\n    };\n  }\n};\n```\n\n#### 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–π –≤ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞\n\n```typescript\nconst requestData = {\n  dispatch: {\n    location: await getDispatchLocation()\n  },\n  destination: {\n    location: await getDestinationLocation()\n  },\n  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥\n};\n```\n\n### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è\n\n1. **–ò–∑–æ–ª—è—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π**: –í—Å–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ `calculateNordWheel`\n2. **–ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ –¢–ö**: –î—Ä—É–≥–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É\n3. **–£–ª—É—á—à–µ–Ω–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å**: –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ FIAS –∫–æ–¥—ã –¥–ª—è Nordwheel\n4. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∫–ª–∞–¥–∞ –õ–∞–≤—Å–∏—Ç**: –ê–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –≤–º–µ—Å—Ç–æ —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π\n\n### –†–∏—Å–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏\n\n1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É Nordwheel —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n2. **API –ª–∏–º–∏—Ç—ã**: Dadata –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã\n3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ API\n\n### –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è\n\n1. –ù—É–∂–Ω–æ –ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ Dadata findById –¥–ª—è Nordwheel?\n2. –ö–∞–∫–æ–π fallback –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –µ—Å–ª–∏ Dadata –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ - —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –º–∞–ø–ø–∏–Ω–≥ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –≥–æ—Ä–æ–¥ –∫–∞–∫ —Å—Ç—Ä–æ–∫—É?\n3. –¢—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ FIAS –∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω?\n\n–•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è –ø—Ä–∏—Å—Ç—É–ø–∏–ª –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π?",
  "time": {
    "start": 1765813806169,
    "end": 1765813806169
  }
}