{
  "id": "prt_98d3946000016cxESE2Ba2zviS",
  "messageID": "msg_98d36dfb30010WSs60YY13MCV9",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "write",
  "callID": "toolu_01Hpuzp36rCEVXAxDpxYTFZy",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/components/ProductManager.tsx",
      "content": "'use client';\n\nimport React from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Trash2, Package, Minus, Plus } from 'lucide-react';\nimport { ProductInForm } from '@/lib/furniture-types';\nimport { formatPrice, getProductSummary } from '@/lib/furniture-utils';\n\ninterface ProductManagerProps {\n  products: ProductInForm[];\n  onQuantityChange: (productId: string, addedAt: number, newQuantity: number) => void;\n  onProductRemove: (productId: string, addedAt: number) => void;\n  disabled?: boolean;\n}\n\nexport default function ProductManager({ \n  products, \n  onQuantityChange, \n  onProductRemove, \n  disabled = false \n}: ProductManagerProps) {\n  \n  if (products.length === 0) {\n    return (\n      <div className=\"text-gray-400 text-sm py-3 text-center\">\n        Товары не добавлены. Используйте поиск выше для добавления мебели.\n      </div>\n    );\n  }\n  \n  return (\n    <div className=\"space-y-3\">\n      {products.map((productInForm) => (\n        <Card \n          key={`${productInForm.product.id}_${productInForm.addedAt}`}\n          className=\"bg-gray-700 border-gray-600\"\n        >\n          <CardContent className=\"p-3\">\n            <div className=\"space-y-3\">\n              {/* Заголовок товара */}\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1 min-w-0\">\n                  <h4 className=\"text-white font-medium text-sm truncate\">\n                    {productInForm.product.name}\n                  </h4>\n                  <div className=\"flex items-center gap-2 mt-1\">\n                    <Badge variant=\"outline\" className=\"text-xs border-gray-500\">\n                      {productInForm.product.externalCode}\n                    </Badge>\n                    <div className=\"flex items-center text-gray-400 text-xs\">\n                      <Package className=\"h-3 w-3 mr-1\" />\n                      {getProductSummary(productInForm.product)}\n                    </div>\n                  </div>\n                </div>\n                \n                {/* Цена за единицу */}\n                <div className=\"text-right ml-3\">\n                  <div className=\"text-green-400 font-medium text-sm\">\n                    {formatPrice(productInForm.product.retailPrice)}\n                  </div>\n                  <div className=\"text-gray-400 text-xs\">\n                    за единицу\n                  </div>\n                </div>\n              </div>\n              \n              {/* Управление количеством и удаление */}\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-gray-300 text-sm\">Количество:</span>\n                  \n                  {/* Кнопки изменения количества */}\n                  <div className=\"flex items-center bg-gray-800 rounded border border-gray-600\">\n                    <Button\n                      type=\"button\"\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => {\n                        const newQuantity = Math.max(1, productInForm.quantity - 1);\n                        onQuantityChange(productInForm.product.id, productInForm.addedAt, newQuantity);\n                      }}\n                      disabled={disabled || productInForm.quantity <= 1}\n                      className=\"h-8 w-8 p-0 hover:bg-gray-700\"\n                    >\n                      <Minus className=\"h-3 w-3\" />\n                    </Button>\n                    \n                    <Input\n                      type=\"number\"\n                      min=\"1\"\n                      max=\"99\"\n                      value={productInForm.quantity}\n                      onChange={(e) => {\n                        const newQuantity = Math.max(1, Math.min(99, parseInt(e.target.value) || 1));\n                        onQuantityChange(productInForm.product.id, productInForm.addedAt, newQuantity);\n                      }}\n                      className=\"w-16 h-8 text-center bg-transparent border-0 text-white focus:ring-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\n                      disabled={disabled}\n                    />\n                    \n                    <Button\n                      type=\"button\"\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => {\n                        const newQuantity = Math.min(99, productInForm.quantity + 1);\n                        onQuantityChange(productInForm.product.id, productInForm.addedAt, newQuantity);\n                      }}\n                      disabled={disabled || productInForm.quantity >= 99}\n                      className=\"h-8 w-8 p-0 hover:bg-gray-700\"\n                    >\n                      <Plus className=\"h-3 w-3\" />\n                    </Button>\n                  </div>\n                  \n                  <span className=\"text-gray-400 text-xs\">шт.</span>\n                </div>\n                \n                {/* Кнопка удаления */}\n                <Button\n                  type=\"button\"\n                  variant=\"destructive\"\n                  size=\"sm\"\n                  onClick={() => onProductRemove(productInForm.product.id, productInForm.addedAt)}\n                  disabled={disabled}\n                  className=\"h-8 px-3\"\n                >\n                  <Trash2 className=\"h-3 w-3 mr-1\" />\n                  Удалить\n                </Button>\n              </div>\n              \n              {/* Итоговая стоимость товара */}\n              {productInForm.quantity > 1 && (\n                <div className=\"pt-2 border-t border-gray-600\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-gray-300 text-sm\">Итого за товар:</span>\n                    <span className=\"text-green-400 font-medium\">\n                      {formatPrice(productInForm.totalPrice)}\n                    </span>\n                  </div>\n                </div>\n              )}\n              \n              {/* Детали грузовых мест */}\n              <details className=\"mt-2\">\n                <summary className=\"cursor-pointer text-xs text-gray-400 hover:text-gray-300\">\n                  Грузовые места ({productInForm.product.cargoPlaces.length} на единицу, всего {productInForm.product.cargoPlaces.length * productInForm.quantity})\n                </summary>\n                <div className=\"mt-2 space-y-1\">\n                  {productInForm.product.cargoPlaces.map((place) => (\n                    <div key={place.placeNumber} className=\"text-xs text-gray-400 bg-gray-800 p-2 rounded\">\n                      <span className=\"font-medium\">Место №{place.placeNumber}:</span>\n                      {' '}\n                      {place.length}×{place.depth}×{place.height} см, {place.weight} кг\n                      {productInForm.quantity > 1 && (\n                        <span className=\"ml-2 text-yellow-400\">\n                          (×{productInForm.quantity} = {productInForm.quantity * place.weight} кг)\n                        </span>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              </details>\n            </div>\n          </CardContent>\n        </Card>\n      ))}\n      \n      {/* Итоговая статистика */}\n      {products.length > 0 && (\n        <Card className=\"bg-blue-900/20 border-blue-700\">\n          <CardContent className=\"p-3\">\n            <div className=\"space-y-2\">\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-blue-300 font-medium\">Всего товаров:</span>\n                <span className=\"text-white\">\n                  {products.reduce((sum, p) => sum + p.quantity, 0)} шт.\n                </span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-blue-300 font-medium\">Грузовых мест:</span>\n                <span className=\"text-white\">\n                  {products.reduce((sum, p) => sum + p.product.cargoPlaces.length * p.quantity, 0)} шт.\n                </span>\n              </div>\n              <div className=\"flex justify-between items-center border-t border-blue-700 pt-2\">\n                <span className=\"text-blue-300 font-medium\">Общая стоимость:</span>\n                <span className=\"text-green-400 font-bold text-lg\">\n                  {formatPrice(products.reduce((sum, p) => sum + p.totalPrice, 0))}\n                </span>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}"
    },
    "output": "",
    "metadata": {
      "diagnostics": {},
      "filepath": "/home/user/project/components/ProductManager.tsx",
      "exists": false
    },
    "title": "components/ProductManager.tsx",
    "time": {
      "start": 1759010990714,
      "end": 1759010990715
    }
  }
}