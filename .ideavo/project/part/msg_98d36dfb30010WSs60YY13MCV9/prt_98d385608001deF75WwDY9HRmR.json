{
  "id": "prt_98d385608001deF75WwDY9HRmR",
  "messageID": "msg_98d36dfb30010WSs60YY13MCV9",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "write",
  "callID": "toolu_01BntPy2ZTDwHexhzVwHcA8h",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/lib/furniture-utils.ts",
      "content": "import { \n  FurnitureProduct, \n  CargoPlace, \n  CargoWithMetadata, \n  ProductInForm \n} from './furniture-types';\n\n// üîß –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–µ–±–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏\n\n/**\n * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç CargoPlace –≤ —Ñ–æ—Ä–º–∞—Ç Cargo –¥–ª—è —Ñ–æ—Ä–º—ã\n */\nexport function cargoPlaceToFormCargo(\n  place: CargoPlace, \n  productId: string, \n  uniqueId: string\n): CargoWithMetadata {\n  return {\n    id: uniqueId,\n    length: place.length,\n    width: place.depth,  // –≤ —Ç–∞–±–ª–∏—Ü–µ depth, –≤ —Ñ–æ—Ä–º–µ width\n    height: place.height,\n    weight: place.weight,\n    productId,\n    placeNumber: place.placeNumber,\n    isFromProduct: true\n  };\n}\n\n/**\n * –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∑–∞–ø—Ä–æ—Å—É\n */\nexport function searchProducts(products: FurnitureProduct[], query: string): FurnitureProduct[] {\n  if (!query.trim()) return [];\n  \n  const normalizedQuery = query.toLowerCase().trim();\n  \n  return products.filter(product => {\n    const nameMatch = product.name.toLowerCase().includes(normalizedQuery);\n    const codeMatch = product.externalCode.toLowerCase().includes(normalizedQuery);\n    return (nameMatch || codeMatch) && product.isActive;\n  }).slice(0, 20); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã\n}\n\n/**\n * –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–∞\n */\nexport function validateProduct(product: FurnitureProduct): { isValid: boolean; errors: string[] } {\n  const errors: string[] = [];\n  \n  if (!product.name?.trim()) {\n    errors.push('–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞');\n  }\n  \n  if (!product.cargoPlaces || product.cargoPlaces.length === 0) {\n    errors.push('–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≥—Ä—É–∑–æ–≤—ã–µ –º–µ—Å—Ç–∞');\n  }\n  \n  if (product.retailPrice < 0) {\n    errors.push('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ü–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞');\n  }\n  \n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä—É–∑–æ–≤—ã–µ –º–µ—Å—Ç–∞\n  product.cargoPlaces?.forEach((place, index) => {\n    if (place.weight <= 0 && place.length <= 0 && place.width <= 0 && place.height <= 0) {\n      errors.push(`–ì—Ä—É–∑–æ–≤–æ–µ –º–µ—Å—Ç–æ ‚Ññ${place.placeNumber} –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–∞–∑–º–µ—Ä–æ–≤`);\n    }\n    \n    if (place.weight > 10000) {\n      errors.push(`–ì—Ä—É–∑–æ–≤–æ–µ –º–µ—Å—Ç–æ ‚Ññ${place.placeNumber} –∏–º–µ–µ—Ç —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –≤–µ—Å: ${place.weight}–∫–≥`);\n    }\n    \n    const maxDimension = Math.max(place.length, place.depth, place.height);\n    if (maxDimension > 1000) {\n      errors.push(`–ì—Ä—É–∑–æ–≤–æ–µ –º–µ—Å—Ç–æ ‚Ññ${place.placeNumber} –∏–º–µ–µ—Ç —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ —Ä–∞–∑–º–µ—Ä—ã: ${maxDimension}—Å–º`);\n    }\n  });\n  \n  return {\n    isValid: errors.length === 0,\n    errors\n  };\n}\n\n/**\n * –†–∞—Å—á–µ—Ç –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–æ–≤\n */\nexport function calculateTotalValue(productsInForm: ProductInForm[]): number {\n  return productsInForm.reduce((total, item) => {\n    return total + (item.product.retailPrice * item.quantity);\n  }, 0);\n}\n\n/**\n * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID –¥–ª—è –≥—Ä—É–∑–∞\n */\nexport function generateCargoId(productId: string, placeNumber: number, timestamp: number): string {\n  return `${productId}_p${placeNumber}_${timestamp}`;\n}\n\n/**\n * –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç –¥–ª—è —Ç–æ–≤–∞—Ä–∞ —Å —É—á–µ—Ç–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞\n */\nexport function createCargosForProduct(\n  product: FurnitureProduct, \n  quantity: number, \n  timestamp: number\n): CargoWithMetadata[] {\n  const cargos: CargoWithMetadata[] = [];\n  \n  for (let q = 0; q < quantity; q++) {\n    product.cargoPlaces.forEach(place => {\n      const uniqueId = generateCargoId(product.id, place.placeNumber, timestamp + q * 1000 + place.placeNumber);\n      const cargo = cargoPlaceToFormCargo(place, product.id, uniqueId);\n      cargos.push(cargo);\n    });\n  }\n  \n  return cargos;\n}\n\n/**\n * –ü–æ–∏—Å–∫ –∏–Ω–¥–µ–∫—Å–æ–≤ –≥—Ä—É–∑–æ–≤, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–∏—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ç–æ–≤–∞—Ä—É\n */\nexport function findCargoIndexesForProduct(\n  cargos: CargoWithMetadata[], \n  productId: string, \n  addedAt: number\n): number[] {\n  const indexes: number[] = [];\n  \n  cargos.forEach((cargo, index) => {\n    if (cargo.productId === productId && cargo.id.includes(`_${addedAt}`)) {\n      indexes.push(index);\n    }\n  });\n  \n  return indexes;\n}\n\n/**\n * –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –≥—Ä—É–∑–æ–≤ —Ç–æ–≤–∞—Ä–∞\n */\nexport function removeCargosForProduct(\n  cargos: CargoWithMetadata[], \n  productId: string, \n  addedAt: number\n): CargoWithMetadata[] {\n  return cargos.filter(cargo => {\n    return !(cargo.productId === productId && cargo.id.includes(`_${addedAt}`));\n  });\n}\n\n/**\n * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã\n */\nexport function formatPrice(price: number): string {\n  return new Intl.NumberFormat('ru-RU', {\n    style: 'currency',\n    currency: 'RUB',\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 0\n  }).format(price);\n}\n\n/**\n * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–∞–±–∞—Ä–∏—Ç–æ–≤\n */\nexport function formatDimensions(length: number, width: number, height: number): string {\n  return `${length}√ó${width}√ó${height} —Å–º`;\n}\n\n/**\n * –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—Ä–∞—Ç–∫–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞\n */\nexport function getProductSummary(product: FurnitureProduct): string {\n  const placesCount = product.cargoPlaces.length;\n  const totalWeight = product.cargoPlaces.reduce((sum, place) => sum + place.weight, 0);\n  \n  return `${placesCount} ${getPlaceWord(placesCount)}, ${totalWeight}–∫–≥`;\n}\n\n/**\n * –°–∫–ª–æ–Ω–µ–Ω–∏–µ —Å–ª–æ–≤–∞ \"–º–µ—Å—Ç–æ\"\n */\nfunction getPlaceWord(count: number): string {\n  if (count % 10 === 1 && count % 100 !== 11) {\n    return '–º–µ—Å—Ç–æ';\n  } else if ([2, 3, 4].includes(count % 10) && ![12, 13, 14].includes(count % 100)) {\n    return '–º–µ—Å—Ç–∞';\n  } else {\n    return '–º–µ—Å—Ç';\n  }\n}\n\n/**\n * –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ localStorage\n */\nexport function cacheProducts(products: FurnitureProduct[]): void {\n  try {\n    const cacheData = {\n      products,\n      timestamp: Date.now()\n    };\n    localStorage.setItem('furniture_products_cache', JSON.stringify(cacheData));\n  } catch (error) {\n    console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã:', error);\n  }\n}\n\n/**\n * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏–∑ –∫—ç—à–∞\n */\nexport function getCachedProducts(): FurnitureProduct[] | null {\n  try {\n    const cached = localStorage.getItem('furniture_products_cache');\n    if (!cached) return null;\n    \n    const cacheData = JSON.parse(cached);\n    const now = Date.now();\n    const cacheAge = now - cacheData.timestamp;\n    \n    // –ö—ç—à –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 30 –º–∏–Ω—É—Ç\n    if (cacheAge > 30 * 60 * 1000) {\n      localStorage.removeItem('furniture_products_cache');\n      return null;\n    }\n    \n    return cacheData.products;\n  } catch (error) {\n    console.warn('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –∫—ç—à–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤:', error);\n    return null;\n  }\n}"
    },
    "output": "",
    "metadata": {
      "diagnostics": {},
      "filepath": "/home/user/project/lib/furniture-utils.ts",
      "exists": false
    },
    "title": "lib/furniture-utils.ts",
    "time": {
      "start": 1759010927335,
      "end": 1759010927336
    }
  }
}