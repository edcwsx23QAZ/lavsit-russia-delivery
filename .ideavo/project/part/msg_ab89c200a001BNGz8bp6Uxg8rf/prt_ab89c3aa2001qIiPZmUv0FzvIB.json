{
  "id": "prt_ab89c3aa2001qIiPZmUv0FzvIB",
  "sessionID": "ses_54b97e247ffenCZZa4jZiIWD0l",
  "messageID": "msg_ab89c200a001BNGz8bp6Uxg8rf",
  "type": "tool",
  "callID": "call_9245ef51991649949778c410",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx",
      "limit": 200,
      "offset": 3553
    },
    "output": "<file>\n03554|     const apiUrl = '/api/nordwheel';\n03555| \n03556|     try {\n03557|       // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03558|       validateMultipleCargos(form.cargos);\n03559|       \n03560|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n03561|       const totalVolume = form.cargos.reduce((sum, cargo) => \n03562|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n03563|       );\n03564| \n03565|       // üîß –î–û–ë–ê–í–õ–ï–ù–û: –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π API NordWheel\n03566|       if (totalWeight > 1000) {\n03567|         console.warn('‚ö†Ô∏è Nord Wheel: –í–µ—Å –ø—Ä–µ–≤—ã—à–∞–µ—Ç 1000 –∫–≥, –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∞ API');\n03568|       }\n03569|       if (totalVolume > 5) {\n03570|         console.warn('‚ö†Ô∏è Nord Wheel: –û–±—ä–µ–º –ø—Ä–µ–≤—ã—à–∞–µ—Ç 5 –º¬≥, –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∞ API');\n03571|       }\n03572| \n03573|       // üîß –î–û–ë–ê–í–õ–ï–ù–û: –†–∞—Å—á–µ—Ç –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03574|       const maxLength = Math.max(...form.cargos.map(c => c.length));\n03575|       const maxWidth = Math.max(...form.cargos.map(c => c.width));\n03576|       const maxHeight = Math.max(...form.cargos.map(c => c.height));\n03577|       \n03578|       // üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03579|       console.log('üåê Nord Wheel: –ê–Ω–∞–ª–∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç:');\n03580|       console.log(`   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç: ${form.cargos.length}`);\n03581|       console.log(`   - –û–±—â–∏–π –≤–µ—Å: ${totalWeight} –∫–≥`);\n03582|       console.log(`   - –û–±—â–∏–π –æ–±—ä–µ–º: ${totalVolume.toFixed(3)} –º¬≥`);\n03583|       console.log(`   - –û—Ç–∫—É–¥–∞: ${form.fromCity} (${form.fromTerminal ? '—Ç–µ—Ä–º–∏–Ω–∞–ª' : '–∞–¥—Ä–µ—Å'})`);\n03584|       console.log(`   - –ö—É–¥–∞: ${form.toCity} (${form.toTerminal ? '—Ç–µ—Ä–º–∏–Ω–∞–ª' : '–∞–¥—Ä–µ—Å'})`);\n03585|       \n03586|       form.cargos.forEach((cargo, index) => {\n03587|         console.log(`   üì¶ –ú–µ—Å—Ç–æ ${index + 1}:`);\n03588|         console.log(`     - –ì–∞–±–∞—Ä–∏—Ç—ã: ${cargo.length}√ó${cargo.width}√ó${cargo.height} —Å–º`);\n03589|         console.log(`     - –í–µ—Å: ${cargo.weight} –∫–≥`);\n03590|         console.log(`     - –û–±—ä–µ–º: ${((cargo.length * cargo.width * cargo.height) / 1000000).toFixed(3)} –º¬≥`);\n03591|       });\n03592| \n03593|       if (form.cargos.length > 1) {\n03594|         console.log(`   üìê –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã: ${maxLength}√ó${maxWidth}√ó${maxHeight} —Å–º`);\n03595|       }\n03596| \n03597|       // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è FIAS –∫–æ–¥–∞ –≥–æ—Ä–æ–¥–∞\n03598|       const getCityFias = (cityName: string): string => {\n03599|         const cityFiasMap: Record<string, string> = {\n03600|           '–º–æ—Å–∫–≤–∞': '0c5b2444-70a0-4932-980c-b4dc0d3f02b5',\n03601|           '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': 'c2deb16a-0330-4f05-821f-1d09c93331e6',\n03602|           '—Å–ø–±': 'c2deb16a-0330-4f05-821f-1d09c93331e6',\n03603|           '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': '2763c110-cb8b-416a-9dac-ad28a55b4402',\n03604|           '–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫': '8dea00e3-9aab-4d8e-887c-ef2aaa546456',\n03605|           '–∫–∞–∑–∞–Ω—å': '93b3df57-4c89-44df-ac42-96f05e9cd3b9',\n03606|           '–Ω–∏–∂–Ω–∏–π –Ω–æ–≤–≥–æ—Ä–æ–¥': '555e7d61-d9a7-4ba6-9770-6caa8198c483',\n03607|           '—á–µ–ª—è–±–∏–Ω—Å–∫': 'a376e68d-724a-4472-be7c-891bdb09ae32',\n03608|           '–æ–º—Å–∫': 'bb035cc3-1dc2-4627-9d25-a1bf5fed073d',\n03609|           '—Ä–æ—Å—Ç–æ–≤-–Ω–∞-–¥–æ–Ω—É': 'c1cfe4b9-f7c2-423c-abfa-6ed5cb24d83e',\n03610|           '—É—Ñ–∞': '7339e834-2cb4-473c-9c6e-93f3dcd66011',\n03611|           '–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫': '9b968c73-f4d4-4012-8da8-3dacd4d4c1bd',\n03612|           '–ø–µ—Ä–º—å': '4dc222e8-1f6a-4c36-894b-2b4a8c8a9b08',\n03613|           '–≤–æ—Ä–æ–Ω–µ–∂': '5bf5ddff-6353-4a3d-80c4-6fb27f00c6c1',\n03614|           '–≤–æ–ª–≥–æ–≥—Ä–∞–¥': 'da051ec8-da2e-4a66-b542-473b8d221ab6'\n03615|         };\n03616| \n03617|         const normalizedCity = cityName.toLowerCase().trim()\n03618|           .replace(/^–≥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥ \"\n03619|           .replace(/^–≥–æ—Ä–æ–¥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥–æ—Ä–æ–¥ \"\n03620|           .replace(/\\s+/g, ' '); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—Ä–æ–±–µ–ª—ã\n03621| \n03622|         return cityFiasMap[normalizedCity] || '0c5b2444-70a0-4932-980c-b4dc0d3f02b5'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ú–æ—Å–∫–≤–∞\n03623|       };\n03624|       // üèôÔ∏è –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ª–æ–∫–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–æ—Ä–º—ã\n03625|       const getDispatchLocation = () => {\n03626|         if (form.fromTerminal) {\n03627|           return {\n03628|             type: 'terminal' as const,\n03629|             // –î–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π FIAS –∫–æ–¥ –≥–æ—Ä–æ–¥–∞\n03630|             city_fias: getCityFias(form.fromCity)\n03631|           };\n03632|         } else {\n03633|           return {\n03634|             type: 'address' as const,\n03635|             address: form.fromAddress || form.fromCity // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥—Ä–µ—Å –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –≥–æ—Ä–æ–¥\n03636|           };\n03637|         }\n03638|       };\n03639| \n03640|       const getDestinationLocation = () => {\n03641|         if (form.toTerminal) {\n03642|           return {\n03643|             type: 'terminal' as const,\n03644|             // –î–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π FIAS –∫–æ–¥ –≥–æ—Ä–æ–¥–∞\n03645|             city_fias: getCityFias(form.toCity)\n03646|           };\n03647|         } else {\n03648|           return {\n03649|             type: 'address' as const,\n03650|             address: form.toAddress || form.toCity // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥—Ä–µ—Å –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –≥–æ—Ä–æ–¥\n03651|           };\n03652|         }\n03653|       };\n03654| \n03655|       // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è –Ω–æ–≤–æ–≥–æ API NordWheel —Å —É—á–µ—Ç–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–æ—Ä–º—ã\n03656|       const requestData = {\n03657|         dispatch: {\n03658|           location: getDispatchLocation()\n03659|         },\n03660|         destination: {\n03661|           location: getDestinationLocation()\n03662|         },\n03663|         cargo: {\n03664|           total_weight: totalWeight,\n03665|           total_volume: totalVolume,\n03666|           total_quantity: form.cargos.length\n03667|         },\n03668|         insurance: form.needInsurance && form.declaredValue ? form.declaredValue : 0,\n03669|         insurance_refuse: !form.needInsurance,\n03670|         services: {\n03671|           is_package: form.needPackaging,\n03672|           is_documents_return: false,\n03673|           is_fragile: false\n03674|         },\n03675|         promocode: null\n03676|       };\n03677| \n03678|       console.log('üöõ Nord Wheel –Ω–æ–≤—ã–π API –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03679| \n03680|       const result = await enhancedApiRequest(\n03681|         apiUrl,\n03682|         {\n03683|           method: 'POST',\n03684|           headers: {\n03685|             'Content-Type': 'application/json'\n03686|           },\n03687|           body: JSON.stringify(requestData)\n03688|         },\n03689|         { operation: 'calculate', company: 'Nord Wheel' }\n03690|       );\n03691| \n03692|       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n03693|         console.error('‚ùå Nord Wheel API –æ—à–∏–±–∫–∞:', result.error);\n03694|         \n03695|         // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ 400 –∏ –±–æ–ª—å—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø—Ä–æ–±—É–µ–º —Å —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏\n03696|         if (result.error.status === 400 && (totalWeight > 1000 || totalVolume > 5)) {\n03697|           console.log('üîÑ Nord Wheel: –ü—Ä–æ–±—É–µ–º fallback —Ä–∞—Å—á–µ—Ç —Å —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏...');\n03698|           \n03699|           const fallbackRequestData = {\n03700|             ...requestData,\n03701|             cargo: {\n03702|               total_weight: Math.min(totalWeight, 999),\n03703|               total_volume: Math.min(totalVolume, 4.9),\n03704|               total_quantity: form.cargos.length\n03705|             }\n03706|           };\n03707|           \n03708|           console.log('üîÑ Fallback –∑–∞–ø—Ä–æ—Å:', JSON.stringify(fallbackRequestData, null, 2));\n03709|           \n03710|           const fallbackResult = await enhancedApiRequest(\n03711|             apiUrl,\n03712|             {\n03713|               method: 'POST',\n03714|               headers: {\n03715|                 'Content-Type': 'application/json'\n03716|               },\n03717|               body: JSON.stringify(fallbackRequestData)\n03718|             },\n03719|             { operation: 'calculate', company: 'Nord Wheel (fallback)' }\n03720|           );\n03721|           \n03722|           if (fallbackResult && typeof fallbackResult === 'object' && 'success' in fallbackResult && !fallbackResult.success) {\n03723|             console.error('‚ùå Nord Wheel fallback —Ç–æ–∂–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:', fallbackResult.error);\n03724|           } else {\n03725|             console.log('‚úÖ Nord Wheel fallback —Å—Ä–∞–±–æ—Ç–∞–ª! –ò—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.');\n03726|             // –ò—Å–ø–æ–ª—å–∑—É–µ–º fallback —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞\n03727|             const fallbackResponse = fallbackResult as Response;\n03728|             const fallbackData = await fallbackResponse.json();\n03729|             \n03730|             // –ü–∞—Ä—Å–∏–º fallback —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º —Ü–µ–Ω—É\n03731|             const scaleFactor = Math.max(totalWeight / 999, totalVolume / 4.9);\n03732|             \n03733|             if (fallbackData.auto || fallbackData.avia) {\n03734|               const options = [];\n03735|               \n03736|               if (fallbackData.auto) {\n03737|                 const scaledPrice = Math.round((fallbackData.auto.total_amount || 0) * scaleFactor);\n03738|                 options.push({\n03739|                   type: 'auto',\n03740|                   price: scaledPrice,\n03741|                   days: fallbackData.auto.delivery_date || '',\n03742|                   services: fallbackData.auto.services || []\n03743|                 });\n03744|               }\n03745|               \n03746|               if (fallbackData.avia) {\n03747|                 const scaledPrice = Math.round((fallbackData.avia.total_amount || 0) * scaleFactor);\n03748|                 options.push({\n03749|                   type: 'avia',\n03750|                   price: scaledPrice,\n03751|                   days: fallbackData.avia.delivery_date || '',\n03752|                   services: fallbackData.avia.services || []\n03753|                 });\n\n(File has more lines. Use 'offset' parameter to read beyond line 3753)\n</file>",
    "title": "app/page.tsx",
    "metadata": {
      "preview": "    const apiUrl = '/api/nordwheel';\n\n    try {\n      // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      validateMultipleCargos(form.cargos);\n      \n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n      const totalVolume = form.cargos.reduce((sum, cargo) => \n        sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n      );\n\n      // üîß –î–û–ë–ê–í–õ–ï–ù–û: –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π API NordWheel\n      if (totalWeight > 1000) {\n        console.warn('‚ö†Ô∏è Nord Wheel: –í–µ—Å –ø—Ä–µ–≤—ã—à–∞–µ—Ç 1000 –∫–≥, –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∞ API');\n      }\n      if (totalVolume > 5) {\n        console.warn('‚ö†Ô∏è Nord Wheel: –û–±—ä–µ–º –ø—Ä–µ–≤—ã—à–∞–µ—Ç 5 –º¬≥, –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∞ API');\n      }\n\n      // üîß –î–û–ë–ê–í–õ–ï–ù–û: –†–∞—Å—á–µ—Ç –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç"
    },
    "time": {
      "start": 1764033837732,
      "end": 1764033837736
    }
  }
}