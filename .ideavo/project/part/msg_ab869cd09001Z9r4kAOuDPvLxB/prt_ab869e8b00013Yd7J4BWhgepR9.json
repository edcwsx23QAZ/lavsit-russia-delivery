{
  "id": "prt_ab869e8b00013Yd7J4BWhgepR9",
  "sessionID": "ses_54b97e247ffenCZZa4jZiIWD0l",
  "messageID": "msg_ab869cd09001Z9r4kAOuDPvLxB",
  "type": "tool",
  "callID": "call_64733942",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx",
      "offset": 3584
    },
    "output": "<file>\n03585|         const cityFiasMap: Record<string, string> = {\n03586|           '–º–æ—Å–∫–≤–∞': '0c5b2444-70a0-4932-980c-b4dc0d3f02b5',\n03587|           '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': 'c2deb16a-0330-4f05-821f-1d09c93331e6',\n03588|           '—Å–ø–±': 'c2deb16a-0330-4f05-821f-1d09c93331e6',\n03589|           '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': '2763c110-cb8b-416a-9dac-ad28a55b4402',\n03590|           '–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫': '8dea00e3-9aab-4d8e-887c-ef2aaa546456',\n03591|           '–∫–∞–∑–∞–Ω—å': '93b3df57-4c89-44df-ac42-96f05e9cd3b9',\n03592|           '–Ω–∏–∂–Ω–∏–π –Ω–æ–≤–≥–æ—Ä–æ–¥': '555e7d61-d9a7-4ba6-9770-6caa8198c483',\n03593|           '—á–µ–ª—è–±–∏–Ω—Å–∫': 'a376e68d-724a-4472-be7c-891bdb09ae32',\n03594|           '–æ–º—Å–∫': 'bb035cc3-1dc2-4627-9d25-a1bf5fed073d',\n03595|           '—Ä–æ—Å—Ç–æ–≤-–Ω–∞-–¥–æ–Ω—É': 'c1cfe4b9-f7c2-423c-abfa-6ed5cb24d83e',\n03596|           '—É—Ñ–∞': '7339e834-2cb4-473c-9c6e-93f3dcd66011',\n03597|           '–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫': '9b968c73-f4d4-4012-8da8-3dacd4d4c1bd',\n03598|           '–ø–µ—Ä–º—å': '4dc222e8-1f6a-4c36-894b-2b4a8c8a9b08',\n03599|           '–≤–æ—Ä–æ–Ω–µ–∂': '5bf5ddff-6353-4a3d-80c4-6fb27f00c6c1',\n03600|           '–≤–æ–ª–≥–æ–≥—Ä–∞–¥': 'da051ec8-da2e-4a66-b542-473b8d221ab6'\n03601|         };\n03602| \n03603|         const normalizedCity = cityName.toLowerCase().trim()\n03604|           .replace(/^–≥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥ \"\n03605|           .replace(/^–≥–æ—Ä–æ–¥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥–æ—Ä–æ–¥ \"\n03606|           .replace(/\\s+/g, ' '); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—Ä–æ–±–µ–ª—ã\n03607| \n03608|         return cityFiasMap[normalizedCity] || '0c5b2444-70a0-4932-980c-b4dc0d3f02b5'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ú–æ—Å–∫–≤–∞\n03609|       };\n03610|         if (form.fromTerminal) {\n03611|           return {\n03612|             type: 'terminal' as const,\n03613|             // –î–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≥–æ—Ä–æ–¥–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã\n03614|             terminal_id: form.fromCity.toLowerCase().includes('–º–æ—Å–∫–≤–∞') ? '0c7a2795-1220-486d-a7ce-8bcf130a1224' :\n03615|                         form.fromCity.toLowerCase().includes('—Å–∞–Ω–∫—Ç') || form.fromCity.toLowerCase().includes('—Å–ø–±') ? '3ca02b62-3632-4da0-8fde-de9d9c77c553' :\n03616|                         '0c7a2795-1220-486d-a7ce-8bcf130a1224', // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ú–æ—Å–∫–≤–∞\n03617|             city_fias: form.fromCity.toLowerCase().includes('–º–æ—Å–∫–≤–∞') ? '0c5b2444-70a0-4932-980c-b4dc0d3f02b5' :\n03618|                        form.fromCity.toLowerCase().includes('—Å–∞–Ω–∫—Ç') || form.fromCity.toLowerCase().includes('—Å–ø–±') ? 'c2deb16a-0330-4f05-821f-1d09c93331e6' :\n03619|                        '0c5b2444-70a0-4932-980c-b4dc0d3f02b5' // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ú–æ—Å–∫–≤–∞\n03620|           };\n03621|         } else {\n03622|           return {\n03623|             type: 'address' as const,\n03624|             address: form.fromAddress || form.fromCity // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥—Ä–µ—Å –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –≥–æ—Ä–æ–¥\n03625|           };\n03626|         }\n03627|       };\n03628| \n03629|       const getDestinationLocation = () => {\n03630|         if (form.toTerminal) {\n03631|           return {\n03632|             type: 'terminal' as const,\n03633|             // –î–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≥–æ—Ä–æ–¥–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã\n03634|             terminal_id: form.toCity.toLowerCase().includes('–º–æ—Å–∫–≤–∞') ? '0c7a2795-1220-486d-a7ce-8bcf130a1224' :\n03635|                         form.toCity.toLowerCase().includes('—Å–∞–Ω–∫—Ç') || form.toCity.toLowerCase().includes('—Å–ø–±') ? '3ca02b62-3632-4da0-8fde-de9d9c77c553' :\n03636|                         '3ca02b62-3632-4da0-8fde-de9d9c77c553', // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –°–ü–±\n03637|             city_fias: form.toCity.toLowerCase().includes('–º–æ—Å–∫–≤–∞') ? '0c5b2444-70a0-4932-980c-b4dc0d3f02b5' :\n03638|                        form.toCity.toLowerCase().includes('—Å–∞–Ω–∫—Ç') || form.toCity.toLowerCase().includes('—Å–ø–±') ? 'c2deb16a-0330-4f05-821f-1d09c93331e6' :\n03639|                        'c2deb16a-0330-4f05-821f-1d09c93331e6' // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –°–ü–±\n03640|           };\n03641|         } else {\n03642|           return {\n03643|             type: 'address' as const,\n03644|             address: form.toAddress || form.toCity // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥—Ä–µ—Å –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –≥–æ—Ä–æ–¥\n03645|           };\n03646|         }\n03647|       };\n03648| \n03649|       // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è –Ω–æ–≤–æ–≥–æ API NordWheel —Å —É—á–µ—Ç–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–æ—Ä–º—ã\n03650|       const requestData = {\n03651|         dispatch: {\n03652|           location: getDispatchLocation()\n03653|         },\n03654|         destination: {\n03655|           location: getDestinationLocation()\n03656|         },\n03657|         cargo: {\n03658|           total_weight: totalWeight,\n03659|           total_volume: totalVolume,\n03660|           total_quantity: form.cargos.length\n03661|         },\n03662|         insurance: form.needInsurance && form.declaredValue ? form.declaredValue : 0,\n03663|         insurance_refuse: !form.needInsurance,\n03664|         services: {\n03665|           is_package: form.needPackaging,\n03666|           is_documents_return: false,\n03667|           is_fragile: false\n03668|         },\n03669|         promocode: null\n03670|       };\n03671| \n03672|       console.log('üöõ Nord Wheel –Ω–æ–≤—ã–π API –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03673| \n03674|       const response = await fetch(apiUrl, {\n03675|         method: 'POST',\n03676|         headers: {\n03677|           'Content-Type': 'application/json',\n03678|           'Authorization': `Bearer ${process.env.NORDWHEEL_API_KEY || '5|WYpV9f788Y2ASobpv3xy6N5qxtIUaKhxFF4yWETOfc398950'}`\n03679|         },\n03680|         body: JSON.stringify(requestData)\n03681|       });\n03682| \n03683|       if (!response.ok) {\n03684|         console.error('‚ùå Nord Wheel API –æ—à–∏–±–∫–∞:', response.status, response.statusText);\n03685|         const errorDetails = response.status === 401 ? '–ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á' :\n03686|                             response.status === 400 ? '–ù–µ–≤–µ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å' :\n03687|                             response.status === 404 ? '–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω' :\n03688|                             response.status === 500 ? '–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' :\n03689|                             `–û—à–∏–±–∫–∞ API: ${response.status} ${response.statusText}`;\n03690|         \n03691|         return {\n03692|           company: 'Nord Wheel',\n03693|           price: 0,\n03694|           days: 0,\n03695|           error: errorDetails,\n03696|           apiUrl,\n03697|           requestData\n03698|         };\n03699|       }\n03700| \n03701|       const data = await response.json();\n03702|       console.log('üöõ Nord Wheel API –æ—Ç–≤–µ—Ç:', data);\n03703| \n03704|       // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ API - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã\n03705|       let price = 0;\n03706|       let days = 0;\n03707|       let details: any = {};\n03708| \n03709|       if (data.success) {\n03710|         // –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç API\n03711|         price = data.price || data.total_cost || data.cost || 0;\n03712|         days = data.days || data.delivery_days || data.delivery_time || 0;\n03713|         details = {\n03714|           totalCost: price,\n03715|           deliveryCost: data.delivery_cost || 0,\n03716|           pickupCost: data.pickup_cost || 0,\n03717|           insuranceCost: data.insurance_cost || 0,\n03718|           services: data.services || [],\n03719|           currency: data.currency || 'RUB'\n03720|         };\n03721|       } else if (data.price !== undefined) {\n03722|         // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞\n03723|         price = data.price;\n03724|         days = data.days || data.delivery_time || 0;\n03725|         details = {\n03726|           totalCost: price,\n03727|           currency: data.currency || 'RUB'\n03728|         };\n03729|       } else {\n03730|         // –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ü–µ–Ω—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É\n03731|         console.error('‚ùå Nord Wheel: –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API:', data);\n03732|         return {\n03733|           company: 'Nord Wheel',\n03734|           price: 0,\n03735|           days: 0,\n03736|           error: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API',\n03737|           apiUrl,\n03738|           requestData,\n03739|           responseData: data\n03740|         };\n03741|       }\n03742| \n03743|       return {\n03744|         company: 'Nord Wheel',\n03745|         price: Math.round(price),\n03746|         days: days,\n03747|         details,\n03748|         requestData,\n03749|         responseData: data,\n03750|         apiUrl\n03751|       };\n03752|     } catch (error: any) {\n03753|       console.error('üöõ Nord Wheel –æ—à–∏–±–∫–∞:', error);\n03754|       return {\n03755|         company: 'Nord Wheel',\n03756|         price: 0,\n03757|         days: 0,\n03758|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03759|         apiUrl\n03760|       };\n03761|     }\n03762|   };\n03763|     const calculateCdek = async (): Promise<CalculationResult> => {\n03764|     const apiUrl = '/api/cdek';\n03765|     \n03766|     try {\n03767|       validateMultipleCargos(form.cargos);\n03768|       \n03769|       const packages = form.cargos.map(cargo => ({\n03770|         height: cargo.height,\n03771|         length: cargo.length,\n03772|         width: cargo.width,\n03773|         weight: cargo.weight * 1000\n03774|       }));\n03775| \n03776|       const requestData: any = {\n03777|         from_city: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n03778|         to_city: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n03779|         packages: packages\n03780|       };\n03781| \n03782|       if (form.needInsurance && form.declaredValue > 0) {\n03783|         requestData.services = [{\n03784|           code: 'INSURANCE',\n03785|           parameter: form.declaredValue\n03786|         }];\n03787|         console.log('üì¶ CDEK: –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ', form.declaredValue);\n03788|       }\n03789| \n03790|       console.log('üì¶ CDEK –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03791|       console.log('üì¶ CDEK –º–∞—Ä—à—Ä—É—Ç:', {\n03792|         fromAddressDelivery: form.fromAddressDelivery,\n03793|         fromLavsiteWarehouse: form.fromLavsiteWarehouse,\n03794|         toAddressDelivery: form.toAddressDelivery\n03795|       });\n03796| \n03797|        const result = await enhancedApiRequest(\n03798|          apiUrl,\n03799|          {\n03800|            method: 'POST',\n03801|            headers: {\n03802|              'Content-Type': 'application/json',\n03803|            },\n03804|            body: JSON.stringify(requestData)\n03805|          },\n03806|          { operation: 'calculate', company: '–°–î–≠–ö' }\n03807|        );\n03808| \n03809|        if (result && typeof result === 'object' && 'success' in result && !result.success) {\n03810|          console.error('‚ùå –°–î–≠–ö API –æ—à–∏–±–∫–∞:', result.error);\n03811|          return {\n03812|            company: '–°–î–≠–ö',\n03813|            price: 0,\n03814|            days: 0,\n03815|            error: result.error.userMessage || result.error.message,\n03816|            requestData,\n03817|            responseData: null,\n03818|            apiUrl\n03819|          };\n03820|        }\n03821| \n03822|        const response = result as Response;\n03823|        const data = await response.json();\n03824|        console.log('üì¶ CDEK –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω, —Ç–∞—Ä–∏—Ñ–æ–≤:', data.tariff_codes?.length || 0);\n03825| \n03826|       if (response.ok && data.tariff_codes && data.tariff_codes.length > 0) {\n03827|         const isFromDoor = form.fromAddressDelivery || form.fromLavsiteWarehouse;\n03828|         const isToDoor = form.toAddressDelivery;\n03829|         \n03830|         let deliveryMode: number;\n03831|         let deliveryModeText: string;\n03832|         \n03833|         if (isFromDoor && isToDoor) {\n03834|           deliveryMode = 1;\n03835|           deliveryModeText = '–¥–≤–µ—Ä—å-–¥–≤–µ—Ä—å';\n03836|         } else if (isFromDoor && !isToDoor) {\n03837|           deliveryMode = 2;\n03838|           deliveryModeText = '–¥–≤–µ—Ä—å-—Å–∫–ª–∞–¥';\n03839|         } else if (!isFromDoor && isToDoor) {\n03840|           deliveryMode = 3;\n03841|           deliveryModeText = '—Å–∫–ª–∞–¥-–¥–≤–µ—Ä—å';\n03842|         } else {\n03843|           deliveryMode = 4;\n03844|           deliveryModeText = '—Å–∫–ª–∞–¥-—Å–∫–ª–∞–¥';\n03845|         }\n03846| \n03847|         console.log(`üì¶ CDEK –≤—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º –¥–æ—Å—Ç–∞–≤–∫–∏: ${deliveryMode} (${deliveryModeText})`);\n03848| \n03849|         const filteredTariffs = data.tariff_codes.filter((t: any) => t.delivery_mode === deliveryMode);\n03850|         \n03851|         console.log(`üì¶ CDEK –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è —Ä–µ–∂–∏–º–∞ ${deliveryModeText}:`, filteredTariffs.length);\n03852| \n03853|         if (filteredTariffs.length === 0) {\n03854|           return {\n03855|             company: '–°–î–≠–ö',\n03856|             price: 0,\n03857|             days: 0,\n03858|             error: `–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∞ ${deliveryModeText}`,\n03859|             requestData,\n03860|             responseData: data,\n03861|             apiUrl\n03862|           };\n03863|         }\n03864| \n03865|         const bestTariff = filteredTariffs.reduce((min: any, tariff: any) => \n03866|           (tariff.delivery_sum < min.delivery_sum) ? tariff : min\n03867|         );\n03868| \n03869|         console.log(`üì¶ CDEK –ª—É—á—à–∏–π —Ç–∞—Ä–∏—Ñ: ${bestTariff.tariff_name} - ${bestTariff.delivery_sum}‚ÇΩ`);\n03870| \n03871|         const detailsRequest: any = {\n03872|           ...requestData,\n03873|           tariff_code: bestTariff.tariff_code,\n03874|           get_details: true\n03875|         };\n03876| \n03877|         console.log('üì¶ CDEK: –∑–∞–ø—Ä–æ—Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏...');\n03878| \n03879|           const detailsResult = await enhancedApiRequest(\n03880|             apiUrl,\n03881|             {\n03882|               method: 'POST',\n03883|               headers: {\n03884|                 'Content-Type': 'application/json',\n03885|               },\n03886|               body: JSON.stringify(detailsRequest)\n03887|             },\n03888|             { operation: 'tariff_details', company: '–°–î–≠–ö' }\n03889|           );\n03890| \n03891|           let tariffDetails: any = null;\n03892|           if (detailsResult && typeof detailsResult === 'object' && 'success' in detailsResult && detailsResult.success) {\n03893|             const detailsResponse = detailsResult as Response;\n03894|             if (detailsResponse.ok) {\n03895|               const detailsData = await detailsResponse.json();\n03896|               tariffDetails = detailsData.tariff_details;\n03897|               console.log('üì¶ –°–î–≠–ö –¥–µ—Ç–∞–ª–∏ —Ç–∞—Ä–∏—Ñ–∞:', tariffDetails);\n03898|             }\n03899|           }\n03900| \n03901|         const finalPrice = tariffDetails?.total_sum || bestTariff.delivery_sum;\n03902|         \n03903|         return {\n03904|           company: '–°–î–≠–ö',\n03905|           price: Math.round(finalPrice),\n03906|           days: bestTariff.period_max || 0,\n03907|           details: {\n03908|             tariff_name: bestTariff.tariff_name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n03909|             tariff_code: bestTariff.tariff_code,\n03910|             delivery_mode: deliveryModeText,\n03911|             period_min: bestTariff.period_min,\n03912|             period_max: bestTariff.period_max,\n03913|             calendar_min: bestTariff.calendar_min,\n03914|             calendar_max: bestTariff.calendar_max,\n03915|             all_tariffs: filteredTariffs,\n03916|             services: tariffDetails?.services || [],\n03917|             delivery_sum: tariffDetails?.delivery_sum || bestTariff.delivery_sum,\n03918|             total_sum: finalPrice,\n03919|             weight_calc: tariffDetails?.weight_calc\n03920|           },\n03921|           requestData,\n03922|           responseData: data,\n03923|           apiUrl\n03924|         };\n03925|       } else {\n03926|         return {\n03927|           company: '–°–î–≠–ö',\n03928|           price: 0,\n03929|           days: 0,\n03930|           error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –°–î–≠–ö',\n03931|           requestData,\n03932|           responseData: data,\n03933|           apiUrl\n03934|         };\n03935|       }\n03936|     } catch (error: any) {\n03937|       console.error('üì¶ –°–î–≠–ö –æ—à–∏–±–∫–∞:', error);\n03938|       return {\n03939|         company: '–°–î–≠–ö',\n03940|         price: 0,\n03941|         days: 0,\n03942|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03943|         apiUrl\n03944|       };\n03945|     }\n03946|   };\n03947| \n03948|   const calculateKit = async (): Promise<CalculationResult> => {\n03949|     const apiUrl = '/api/kit';\n03950|     \n03951|     try {\n03952|       validateMultipleCargos(form.cargos);\n03953|       \n03954|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n03955| \n03956|       const requestData = {\n03957|         from_city: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n03958|         to_city: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n03959|         declared_price: form.declaredValue || 10000,\n03960|         service: ['S089']\n03961|       };\n03962| \n03963|       console.log('üöõ –ö–ò–¢ –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03964| \n03965|        const result = await enhancedApiRequest(\n03966|          apiUrl,\n03967|          {\n03968|            method: 'POST',\n03969|            headers: {\n03970|              'Content-Type': 'application/json',\n03971|            },\n03972|            body: JSON.stringify(requestData)\n03973|          },\n03974|          { operation: 'calculate', company: '–ö–ò–¢' }\n03975|        );\n03976| \n03977|        if (result && typeof result === 'object' && 'success' in result && !result.success) {\n03978|          console.error('‚ùå –ö–ò–¢ API –æ—à–∏–±–∫–∞:', result.error);\n03979|          return {\n03980|            company: '–ö–ò–¢',\n03981|            price: 0,\n03982|            days: 0,\n03983|            error: result.error.userMessage || result.error.message,\n03984|            requestData,\n03985|            responseData: null,\n03986|            apiUrl\n03987|          };\n03988|        }\n03989| \n03990|        const response = result as Response;\n03991|        const data = await response.json();\n03992|        console.log('üöõ –ö–ò–¢ –æ—Ç–≤–µ—Ç:', data);\n03993| \n03994|       if (response.ok && Array.isArray(data) && data.length > 0) {\n03995|         const rubData = data.find((item: any) => {\n03996|           const tariffData: any = Object.values(item)[0];\n03997|           return tariffData?.currency_code === 'RUB';\n03998|         });\n03999|         \n04000|         if (rubData) {\n04001|           const tariffKey = Object.keys(rubData)[0];\n04002|           const tariffData: any = rubData[tariffKey];\n04003|           \n04004|           console.log('üöõ –ö–ò–¢ –≤—ã–±—Ä–∞–Ω —Ç–∞—Ä–∏—Ñ:', tariffKey, tariffData);\n04005| \n04006|           return {\n04007|             company: '–ö–ò–¢',\n04008|             price: Math.round(tariffData.cost || 0),\n04009|             days: tariffData.time || 0,\n04010|             details: {\n04011|               tariff_name: tariffData.name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n04012|               tariff_type: tariffKey,\n04013|               services: tariffData.detail || [],\n04014|               currency: tariffData.currency_code\n04015|             },\n04016|             requestData,\n04017|             responseData: data,\n04018|             apiUrl\n04019|           };\n04020|         }\n04021|       }\n04022| \n04023|       return {\n04024|         company: '–ö–ò–¢',\n04025|         price: 0,\n04026|         days: 0,\n04027|         error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –ö–ò–¢',\n04028|         requestData,\n04029|         responseData: data,\n04030|         apiUrl\n04031|       };\n04032|     } catch (error: any) {\n04033|       console.error('üöõ –ö–ò–¢ –æ—à–∏–±–∫–∞:', error);\n04034|       return {\n04035|         company: '–ö–ò–¢',\n04036|         price: 0,\n04037|         days: 0,\n04038|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n04039|         apiUrl\n04040|       };\n04041|     }\n04042|   };\n04043| \n04044|   const handleCalculate = async () => {\n04045|     const totalStartTime = performance.now();\n04046|     setCalculating(true);\n04047|     setCalculations([]);\n04048|     \n04049|     // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø–æ—Å–ª–µ —Ä–∞—Å—á–µ—Ç–∞ (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ, –±–µ–∑ –¥–µ–±–∞—É–Ω—Å–∞)\n04050|     saveFormData({\n04051|       cargos: form.cargos,\n04052|       fromCity: form.fromCity,\n04053|       toCity: form.toCity,\n04054|       fromAddress: form.fromAddress,\n04055|       toAddress: form.toAddress,\n04056|       declaredValue: form.declaredValue,\n04057|       needPackaging: form.needPackaging,\n04058|       needLoading: form.needLoading,\n04059|       needCarry: form.needCarry,\n04060|       floor: form.floor,\n04061|       hasFreightLift: form.hasFreightLift,\n04062|       needInsurance: form.needInsurance,\n04063|       fromTerminal: form.fromTerminal,\n04064|       toTerminal: form.toTerminal,\n04065|       fromAddressDelivery: form.fromAddressDelivery,\n04066|       toAddressDelivery: form.toAddressDelivery,\n04067|       selectedProducts: form.selectedProducts,\n04068|     });\n04069|     \n04070|     try {\n04071|       console.log('üöÄ === –ù–ê–ß–ê–õ–û –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–û–ì–û –†–ê–°–ß–ï–¢–ê ===');\n04072|       \n04073|       // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞\n04074|       const { optimizedApiClient } = await import('@/lib/optimized-api-client');\n04075|       const { cacheManager } = await import('@/lib/cache-manager');\n04076|       \n04077|       // 1. –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–µ—Å—Å–∏–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ\n04078|       const preloadStartTime = performance.now();\n04079|       await optimizedApiClient.preloadCalculationData(form);\n04080|       const preloadDuration = performance.now() - preloadStartTime;\n04081|       console.log(`‚ö° –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∑–∞ ${preloadDuration.toFixed(0)}–º—Å`);\n04082|       \n04083|       // 2. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∫–ª—é—á–µ–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏\n04084|       const enabledCompaniesList: Array<{ name: string; key: string; func: () => Promise<CalculationResult> }> = [];\n04085|       \n04086|       if (enabledCompanies.pek) enabledCompaniesList.push({ name: '–ü–≠–ö', key: 'pek', func: calculatePEK });\n04087|       if (enabledCompanies.dellin) enabledCompaniesList.push({ name: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏', key: 'dellin', func: calculateDellin });\n04088|       if (enabledCompanies.railcontinent) enabledCompaniesList.push({ name: 'Rail Continent', key: 'railcontinent', func: calculateRailContinent });\n04089|       if (enabledCompanies.vozovoz) enabledCompaniesList.push({ name: '–í–æ–∑–æ–≤–æ–∑', key: 'vozovoz', func: calculateVozovoz });\n04090|       if (enabledCompanies.nordwheel) enabledCompaniesList.push({ name: 'Nord Wheel', key: 'nordwheel', func: calculateNordWheel });\n04091|       if (enabledCompanies.cdek) enabledCompaniesList.push({ name: '–°–¥—ç–∫', key: 'cdek', func: calculateCdek });\n04092|       if (enabledCompanies.kit) enabledCompaniesList.push({ name: '–ö–∏—Ç', key: 'kit', func: calculateKit });\n04093|       \n04094|       // –ï—Å–ª–∏ –Ω–∏ –æ–¥–Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞\n04095|       if (enabledCompaniesList.length === 0) {\n04096|         setCalculations([]);\n04097|         return;\n04098|       }\n04099|       \n04100|       console.log(`üìã –ó–∞–ø—É—Å–∫ —Ä–∞—Å—á–µ—Ç–æ–≤ –¥–ª—è ${enabledCompaniesList.length} –∫–æ–º–ø–∞–Ω–∏–π:`, enabledCompaniesList.map(c => c.name));\n04101|       \n04102|       // 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞\n04103|       setCalculationProgress({\n04104|         companies: enabledCompaniesList.map(company => ({\n04105|           name: company.name,\n04106|           status: 'pending'\n04107|         })),\n04108|         totalDuration: 0\n04109|       });\n04110|       \n04111|       // 4. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ä–∞—Å—á–µ—Ç–æ–≤ —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞\n04112|       const calculationStartTime = performance.now();\n04113|       const calculationPromises = enabledCompaniesList.map(async (company, index) => {\n04114|         const companyStartTime = performance.now();\n04115|         \n04116|         // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ \"loading\"\n04117|         setCalculationProgress(prev => ({\n04118|           ...prev,\n04119|           companies: prev.companies.map((c, i) => \n04120|             i === index ? { ...c, status: 'loading', progress: 0 } : c\n04121|           )\n04122|         }));\n04123|         \n04124|         try {\n04125|           const result = await optimizedApiClient.calculateWithCache(\n04126|             company.key,\n04127|             company.func,\n04128|             form\n04129|           );\n04130|           \n04131|           const duration = performance.now() - companyStartTime;\n04132|           \n04133|           // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ \"completed\"\n04134|           setCalculationProgress(prev => ({\n04135|             ...prev,\n04136|             companies: prev.companies.map((c, i) => \n04137|               i === index ? { \n04138|                 ...c, \n04139|                 status: 'completed', \n04140|                 progress: 100, \n04141|                 duration \n04142|               } : c\n04143|             )\n04144|           }));\n04145|           \n04146|           return result;\n04147|         } catch (error) {\n04148|           const duration = performance.now() - companyStartTime;\n04149|           const errorMessage = error instanceof Error ? error.message : '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞';\n04150|           \n04151|           // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ \"error\"\n04152|           setCalculationProgress(prev => ({\n04153|             ...prev,\n04154|             companies: prev.companies.map((c, i) => \n04155|               i === index ? { \n04156|                 ...c, \n04157|                 status: 'error', \n04158|                 error: errorMessage,\n04159|                 duration \n04160|               } : c\n04161|             )\n04162|           }));\n04163|           \n04164|           console.error(`‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ ${company.name}:`, error);\n04165|           return {\n04166|             company: company.name,\n04167|             price: 0,\n04168|             days: 0,\n04169|             error: errorMessage,\n04170|             duration\n04171|           };\n04172|         }\n04173|       });\n04174|       \n04175|       const results = await Promise.allSettled(calculationPromises);\n04176|       const calculationDuration = performance.now() - calculationStartTime;\n04177|       \n04178|       // 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤\n04179|       const validResults: CalculationResult[] = [];\n04180|       const errors: string[] = [];\n04181|       \n04182|       results.forEach((result, index) => {\n04183|         if (result.status === 'fulfilled') {\n04184|           validResults.push(result.value);\n04185|         } else {\n04186|           const companyName = enabledCompaniesList[index].name;\n04187|           errors.push(`${companyName}: ${result.reason}`);\n04188|           console.error(`‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ ${companyName}:`, result.reason);\n04189|         }\n04190|       });\n04191|       \n04192|       // 5. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤\n04193|       const sortedResults = validResults\n04194|         .filter(result => !result.error)\n04195|         .sort((a, b) => a.price - b.price)\n04196|         .concat(validResults.filter(result => result.error));\n04197|       \n04198|       // 6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n04199|       const totalDuration = performance.now() - totalStartTime;\n04200|       const successCount = sortedResults.filter(r => !r.error).length;\n04201|       const cacheStats = cacheManager.getCacheStats();\n04202|       \n04203|       console.log(`‚úÖ === –†–ê–°–ß–ï–¢ –ó–ê–í–ï–†–®–ï–ù ===`);\n04204|       console.log(`‚è±Ô∏è –û–±—â–µ–µ –≤—Ä–µ–º—è: ${totalDuration.toFixed(0)}–º—Å`);\n04205|       console.log(`‚ö° –†–∞—Å—á–µ—Ç—ã: ${calculationDuration.toFixed(0)}–º—Å`);\n04206|       console.log(`üìä –£—Å–ø–µ—à–Ω–æ: ${successCount}/${enabledCompaniesList.length}`);\n04207|       console.log(`üíæ –ö—ç—à: —Å–µ—Å—Å–∏–π=${cacheStats.sessions}, —Ä–∞—Å—á–µ—Ç–æ–≤=${cacheStats.calculations}`);\n04208|       \n04209|       if (errors.length > 0) {\n04210|         console.warn(`‚ö†Ô∏è –û—à–∏–±–∫–∏: ${errors.join('; ')}`);\n04211|       }\n04212|       \n04213|       // –§–∏–Ω–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞\n04214|       setCalculationProgress(prev => ({\n04215|         ...prev,\n04216|         totalDuration: totalDuration\n04217|       }));\n04218|       \n04219|       setCalculations(sortedResults);\n04220|       \n04221|     } catch (error) {\n04222|       console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ:', error);\n04223|       setCalculations([{\n04224|         company: '–°–∏—Å—Ç–µ–º–∞',\n04225|         price: 0,\n04226|         days: 0,\n04227|         error: error instanceof Error ? error.message : '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞'\n04228|       }]);\n04229|     } finally {\n04230|       setCalculating(false);\n04231|     }\n04232|   };\n04233| \n04234|   const exportToPDF = () => {\n04235|     if (typeof window !== 'undefined') {\n04236|       // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Å–µ –¥–µ—Ç–∞–ª–∏ –ø–µ—Ä–µ–¥ –ø–µ—á–∞—Ç—å—é\n04237|       const allExpanded = calculations.reduce((acc, calc) => {\n04238|         acc[calc.company] = true;\n04239|         return acc;\n04240|       }, {} as { [key: string]: boolean });\n04241|       \n04242|       setExpandedDetails(allExpanded);\n04243|       \n04244|       // –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DOM\n04245|       setTimeout(() => {\n04246|         window.print();\n04247|       }, 100);\n04248|     }\n04249|   };\n04250| \n04251|   const toggleDetails = (company: string) => {\n04252|     setExpandedDetails(prev => ({\n04253|       ...prev,\n04254|       [company]: !prev[company]\n04255|     }));\n04256|   };\n04257| \n04258|   const toggleDebugInfo = (company: string) => {\n04259|     setExpandedDebugInfo(prev => ({\n04260|       ...prev,\n04261|       [company]: !prev[company]\n04262|     }));\n04263|   };\n04264| \n04265|   // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞—Å—á–µ—Ç–∞\n04266|   const handleReset = () => {\n04267|     if (typeof window !== 'undefined') {\n04268|       // –û—á–∏—â–∞–µ–º localStorage\n04269|       localStorage.removeItem('deliveryForm');\n04270|       \n04271|       // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É\n04272|       setForm(initialFormState);\n04273|       \n04274|       // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è\n04275|       setCalculations([]);\n04276|       setExpandedDetails({});\n04277|       setExpandedDebugInfo({});\n04278|       setSuggestions([]);\n04279|       setShowSuggestions(false);\n04280|       setActiveField('');\n04281|       \n04282|       console.log('–§–æ—Ä–º–∞ —Å–±—Ä–æ—à–µ–Ω–∞ –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é');\n04283|     }\n04284|   };\n04285| \n04286|   // –ü–∞—Ä—Å–µ—Ä –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è —á–∏—Ç–∞–µ–º–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞\n04287|   const parseCalculationDetails = (calc: CalculationResult) => {\n04288|     console.log('üîç parseCalculationDetails –ø–æ–ª—É—á–∏–ª calc:', calc?.company || 'undefined');\n04289|     console.log('üîç calc.details:', calc?.details ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n04290|     console.log('üîç typeof calc.details:', typeof calc?.details);\n04291|     \n04292|     const details: { service: string; description: string; price: number }[] = [];\n04293|     \n04294|     try {\n04295|       if (calc.company === '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏' && calc.details) {\n04296|         console.log('üîç –ù–∞—á–∏–Ω–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–µ—Ç–∞–ª–µ–π –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π...');\n04297|       // –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ (—É–∂–µ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –±–∞–∑–æ–≤—ã–µ —É—Å–ª—É–≥–∏ –∏ —É–ø–∞–∫–æ–≤–∫—É)\n04298|       let basePrice = calc.details?.price || calc.price || 0;\n04299|       \n04300|       // –†–∞–∑–±–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ\n04301|       let intercityPrice = 0;\n04302|       let derivalPrice = 0;\n04303|       let arrivalPrice = 0;\n04304|       let packagingPrice = 0;\n04305|       // packagingPremiums –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è - –Ω–∞–¥–±–∞–≤–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ pkg.price\n04306|       let insurancePrice = 0;\n04307|       \n04308|       // –ú–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞\n04309|       if (calc.details?.intercity?.price) {\n04310|         intercityPrice = calc.details.intercity.price;\n04311|         details.push({\n04312|           service: '–ú–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞',\n04313|           description: `${form.fromCity} - ${form.toCity}`,\n04314|           price: intercityPrice\n04315|         });\n04316|       }\n04317|       \n04318|       // –ó–∞–±–æ—Ä –≥—Ä—É–∑–∞\n04319|       if (calc.details?.derival?.price) {\n04320|         derivalPrice = calc.details.derival.price;\n04321|         details.push({\n04322|           service: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n04323|           description: '–û—Ç –∞–¥—Ä–µ—Å–∞',\n04324|           price: derivalPrice\n04325|         });\n04326|       }\n04327|       \n04328|       // –î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞\n04329|       if (calc.details?.arrival?.price) {\n04330|         arrivalPrice = calc.details.arrival.price;\n04331|         details.push({\n04332|           service: '–û—Ç–≤–æ–∑ –≥—Ä—É–∑–∞',\n04333|           description: '–î–æ –∞–¥—Ä–µ—Å–∞',\n04334|           price: arrivalPrice\n04335|         });\n04336|       }\n04337|       \n04338|       // –£–ø–∞–∫–æ–≤–∫–∞ (–Ω–∞–¥–±–∞–≤–∫–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ pkg.price, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏)\n04339|       if (form.needPackaging && calc.details?.packages) {\n04340|         Object.entries(calc.details?.packages || {}).forEach(([key, pkg]: [string, any]) => {\n04341|           if (pkg.price && pkg.price > 0) {\n04342|             // –í—ã—á–∏—Å–ª—è–µ–º –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É —É–ø–∞–∫–æ–≤–∫–∏ (–±–µ–∑ –Ω–∞–¥–±–∞–≤–æ–∫) –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n04343|             let basePkgPrice = pkg.price;\n04344|             let totalPremiums = 0;\n04345|             \n04346|             if (pkg.premiumDetails && Array.isArray(pkg.premiumDetails)) {\n04347|               totalPremiums = pkg.premiumDetails.reduce((sum: number, premium: any) => \n04348|                 sum + (premium.value || 0), 0);\n04349|               basePkgPrice = pkg.price - totalPremiums;\n04350|             }\n04351|             \n04352|             packagingPrice += pkg.price; // –í –æ–±—â—É—é —Å—É–º–º—É –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–Ω—É—é —Ü–µ–Ω—É\n04353|             \n04354|             // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—É—é —É–ø–∞–∫–æ–≤–∫—É\n04355|             details.push({\n04356|               service: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n04357|               description: '–£–ø–∞–∫–æ–≤–∞—Ç—å –≤ –∫–æ–º–ø–ª–µ–∫—Å ¬´–æ–±—Ä–µ—à—ë—Ç–∫–∞ + –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è¬ª',\n04358|               price: basePkgPrice\n04359|             });\n04360|             \n04361|             // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–¥–±–∞–≤–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ (–¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏, –Ω–æ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –∫ –æ–±—â–µ–π —Å—É–º–º–µ)\n04362|             if (pkg.premiumDetails && Array.isArray(pkg.premiumDetails)) {\n04363|               pkg.premiumDetails.forEach((premium: any) => {\n04364|                 if (premium.value && premium.value > 0) {\n04365|                   details.push({\n04366|                     service: '–ù–∞–¥–±–∞–≤–∫–∞ –∫ —É–ø–∞–∫–æ–≤–∫–µ',\n04367|                     description: premium.name || '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–¥–±–∞–≤–∫–∞',\n04368|                     price: premium.value\n04369|                   });\n04370|                 }\n04371|               });\n04372|             }\n04373|           }\n04374|         });\n04375|       }\n04376|       \n04377|       // –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ\n04378|       if (form.needInsurance && calc.details?.insurance) {\n04379|         insurancePrice = calc.details.insurance;\n04380|         details.push({\n04381|           service: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n04382|           description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n04383|           price: insurancePrice\n04384|         });\n04385|       }\n04386|       \n04387|       // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏\n04388|       details.push({\n04389|         service: '–î–æ–ø.—É—Å–ª—É–≥–∏',\n04390|         description: '–ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ –≥—Ä—É–∑–∞',\n04391|         price: 15\n04392|       });\n04393|       \n04394|       // –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –º–µ–∂–¥—É —Å—É–º–º–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é, –¥–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞—Ç–æ–∫\n04395|       const calculatedSum = intercityPrice + derivalPrice + arrivalPrice + packagingPrice + insurancePrice + 15;\n04396|       const remainder = basePrice - calculatedSum;\n04397|       \n04398|       if (Math.abs(remainder) > 1) { // –ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –±–æ–ª—å—à–µ 1 —Ä—É–±–ª—è\n04399|         details.push({\n04400|           service: remainder > 0 ? '–ü—Ä–æ—á–∏–µ —É—Å–ª—É–≥–∏' : '–°–∫–∏–¥–∫–∞',\n04401|           description: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–±–æ—Ä—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏',\n04402|           price: remainder\n04403|         });\n04404|       }\n04405|     } else if (calc.company === 'Nord Wheel' && calc.details) {\n04406|       // –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –¥–ª—è Nord Wheel —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º\n04407|       if (calc.details.totalCost) {\n04408|         details.push({\n04409|           service: '–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',\n04410|           description: '',\n04411|           price: calc.details.totalCost\n04412|         });\n04413|       }\n04414|       if (calc.details.deliveryCost) {\n04415|         details.push({\n04416|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–∑–∫–∏',\n04417|           description: '',\n04418|           price: calc.details.deliveryCost\n04419|         });\n04420|       }\n04421|       if (calc.details.terminalCost) {\n04422|         details.push({\n04423|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –º–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–≤–æ–∑–∫–∏',\n04424|           description: '',\n04425|           price: calc.details.terminalCost\n04426|         });\n04427|       }\n04428|       if (calc.details.pickupCost) {\n04429|         details.push({\n04430|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–±–æ—Ä–∞',\n04431|           description: '',\n04432|           price: calc.details.pickupCost\n04433|         });\n04434|       }\n04435|       if (calc.details.deliveryToDoorCost) {\n04436|         details.push({\n04437|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–æ –¥–≤–µ—Ä–∏',\n04438|           description: '',\n04439|           price: calc.details.deliveryToDoorCost\n04440|         });\n04441|       }\n04442|       if (calc.details.additionalServices && calc.details.additionalServices > 0) {\n04443|         details.push({\n04444|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ–ø.—É—Å–ª—É–≥',\n04445|           description: '',\n04446|           price: calc.details.additionalServices\n04447|         });\n04448|       }\n04449| \n04450|     } else if (calc.company === '–ü–≠–ö' && calc.details?.services) {\n04451|       // –î–ª—è –ü–≠–ö –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ API\n04452|       calc.details.services.forEach((service: any) => {\n04453|         if (service.price > 0) {\n04454|           details.push({\n04455|             service: service.name || '–£—Å–ª—É–≥–∞ –ü–≠–ö',\n04456|             description: service.description || '',\n04457|             price: service.price\n04458|           });\n04459|         }\n04460|       });\n04461|     } else if (calc.company === '–°–î–≠–ö' && calc.details) {\n04462|       const cdekServiceNames: Record<string, string> = {\n04463|         'INSURANCE': '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n04464|         'HEAVY_CARGO': '–¢—è–∂–µ–ª–æ–≤–µ—Å–Ω—ã–π –≥—Ä—É–∑',\n04465|         'DELIVERY_TO_DOOR': '–î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –¥–≤–µ—Ä–∏',\n04466|         'PICKUP_FROM_SENDER': '–ó–∞–±–æ—Ä –æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è',\n04467|         'PACKAGE': '–£–ø–∞–∫–æ–≤–∫–∞',\n04468|         'TRYING_ON': '–ü—Ä–∏–º–µ—Ä–∫–∞ –Ω–∞ –¥–æ–º—É',\n04469|         'PART_DELIVERY': '–ß–∞—Å—Ç–∏—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞'\n04470|       };\n04471| \n04472|       if (calc.details.services && calc.details.services.length > 0) {\n04473|         calc.details.services.forEach((service: any) => {\n04474|           const serviceName = cdekServiceNames[service.code] || service.code || '–£—Å–ª—É–≥–∞ –°–î–≠–ö';\n04475|           const servicePrice = service.total_sum || service.sum || 0;\n04476|           \n04477|           if (servicePrice > 0) {\n04478|             details.push({\n04479|               service: serviceName,\n04480|               description: service.code === 'HEAVY_CARGO' \n04481|                 ? `–°–±–æ—Ä –∑–∞ –≥–∞–±–∞—Ä–∏—Ç–Ω—ã–π –≥—Ä—É–∑ (—Ä–∞—Å—á–µ—Ç–Ω—ã–π –≤–µ—Å: ${(calc.details.weight_calc / 1000).toFixed(0)} –∫–≥)`\n04482|                 : service.code === 'INSURANCE'\n04483|                 ? `–û–±—ä—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${form.declaredValue?.toLocaleString() || 0} ‚ÇΩ`\n04484|                 : '',\n04485|               price: servicePrice\n04486|             });\n04487|           }\n04488|         });\n04489|         \n04490|         if (calc.details.delivery_sum && calc.details.total_sum) {\n04491|           details.push({\n04492|             service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n04493|             description: '',\n04494|             price: 0\n04495|           });\n04496|           details.push({\n04497|             service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',\n04498|             description: calc.details.tariff_name || '–ü–µ—Ä–µ–≤–æ–∑–∫–∞',\n04499|             price: Math.round(calc.details.delivery_sum)\n04500|           });\n04501|           \n04502|           const additionalSum = calc.details.services.reduce((sum: number, s: any) => \n04503|             sum + (s.total_sum || s.sum || 0), 0\n04504|           );\n04505|           \n04506|           if (additionalSum > 0) {\n04507|             details.push({\n04508|               service: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏',\n04509|               description: '–î–æ–ø. —Å–±–æ—Ä—ã',\n04510|               price: Math.round(additionalSum)\n04511|             });\n04512|           }\n04513|           \n04514|           details.push({\n04515|             service: '–ò–¢–û–ì–û',\n04516|             description: '–ö –æ–ø–ª–∞—Ç–µ',\n04517|             price: Math.round(calc.details.total_sum)\n04518|           });\n04519|         }\n04520|       } else {\n04521|         details.push({\n04522|           service: '–¢–∞—Ä–∏—Ñ',\n04523|           description: calc.details.tariff_name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n04524|           price: calc.price\n04525|         });\n04526|         \n04527|         if (calc.details.delivery_mode) {\n04528|           details.push({\n04529|             service: '–†–µ–∂–∏–º –¥–æ—Å—Ç–∞–≤–∫–∏',\n04530|             description: calc.details.delivery_mode,\n04531|             price: 0\n04532|           });\n04533|         }\n04534|       }\n04535|       \n04536|       if (calc.details.period_min && calc.details.period_max) {\n04537|         details.push({\n04538|           service: '–°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏',\n04539|           description: `${calc.details.period_min}-${calc.details.period_max} –¥–Ω–µ–π`,\n04540|           price: 0\n04541|         });\n04542|       }\n04543|       \n04544|       if (calc.details.weight_calc) {\n04545|         details.push({\n04546|           service: '–†–∞—Å—á–µ—Ç–Ω—ã–π –≤–µ—Å',\n04547|           description: `${calc.details.weight_calc} –∫–≥`,\n04548|           price: 0\n04549|         });\n04550|       }\n04551|     } else if (calc.company === '–í–æ–∑–æ–≤–æ–∑' && calc.details?.service) {\n04552|       // ‚úÖ –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –í–æ–∑–æ–≤–æ–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ API –æ—Ç–≤–µ—Ç–∞\n04553|       const basePrice = calc.details.basePrice || 0;\n04554|       const finalPrice = calc.details.price || calc.price || 0;\n04555|       const totalDiscount = basePrice - finalPrice;\n04556|       \n04557|       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é —É—Å–ª—É–≥—É —Å –±–∞–∑–æ–≤–æ–π —Ü–µ–Ω–æ–π –∏ —Å–∫–∏–¥–∫–æ–π\n04558|       calc.details.service.forEach((service: any) => {\n04559|         const serviceDiscount = (service.basePrice || 0) - (service.price || 0);\n04560|         \n04561|         // –û—Å–Ω–æ–≤–Ω–∞—è —É—Å–ª—É–≥–∞\n04562|         details.push({\n04563|           service: service.name || '–£—Å–ª—É–≥–∞ –í–æ–∑–æ–≤–æ–∑',\n04564|           description: '',\n04565|           price: service.price || 0\n04566|         });\n04567|         \n04568|         // –°–∫–∏–¥–∫–∞ –Ω–∞ —É—Å–ª—É–≥—É (–µ—Å–ª–∏ –µ—Å—Ç—å)\n04569|         if (serviceDiscount > 0) {\n04570|           details.push({\n04571|             service: `–°–∫–∏–¥–∫–∞ –Ω–∞ ${service.name?.toLowerCase() || '—É—Å–ª—É–≥—É'}`,\n04572|             description: `${(service.basePrice || 0).toLocaleString()} - ${(service.price || 0).toLocaleString()}`,\n04573|             price: -serviceDiscount\n04574|           });\n04575|         }\n04576|       });\n04577|       \n04578|       // –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Å –æ–±—â–∏–º–∏ —Å–∫–∏–¥–∫–∞–º–∏\n04579|       if (totalDiscount > 0) {\n04580|         details.push({\n04581|           service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n04582|           description: '',\n04583|           price: 0\n04584|         });\n04585|         details.push({\n04586|           service: '–ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å',\n04587|           description: '–î–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–∫–∏–¥–æ–∫',\n04588|           price: basePrice\n04589|         });\n04590|         details.push({\n04591|           service: '–û–±—â–∏–µ —Å–∫–∏–¥–∫–∏',\n04592|           description: `–≠–∫–æ–Ω–æ–º–∏—è ${totalDiscount.toLocaleString()} ‚ÇΩ`,\n04593|           price: -totalDiscount\n04594|         });\n04595|         details.push({\n04596|           service: '–ò–¢–û–ì–û',\n04597|           description: '–ö –æ–ø–ª–∞—Ç–µ',\n04598|           price: finalPrice\n04599|         });\n04600|       }\n04601|     } else if (calc.company === '–ö–ò–¢' && calc.details?.services) {\n04602|       calc.details.services.forEach((service: any) => {\n04603|         details.push({\n04604|           service: service.name || '–£—Å–ª—É–≥–∞ –ö–ò–¢',\n04605|           description: service.code || '',\n04606|           price: service.price || 0\n04607|         });\n04608|       });\n04609|       \n04610|       if (calc.details.tariff_name) {\n04611|         details.push({\n04612|           service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n04613|           description: '',\n04614|           price: 0\n04615|         });\n04616|         details.push({\n04617|           service: '–¢–∞—Ä–∏—Ñ',\n04618|           description: calc.details.tariff_name,\n04619|           price: 0\n04620|         });\n04621|         details.push({\n04622|           service: '–ò–¢–û–ì–û',\n04623|           description: calc.details.currency || 'RUB',\n04624|           price: calc.price\n04625|         });\n04626|       }\n04627|     } else {\n04628|       // –î–ª—è –¥—Ä—É–≥–∏—Ö –¢–ö - –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n04629|       details.push({\n04630|         service: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n04631|         description: `${form.fromCity} - ${form.toCity}`,\n04632|         price: calc.price\n04633|       });\n04634|       \n04635|       if (form.needInsurance && form.declaredValue > 0) {\n04636|         details.push({\n04637|           service: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ',\n04638|           description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n04639|           price: Math.round(form.declaredValue * 0.02)\n04640|         });\n04641|       }\n04642|       \n04643|       if (form.needPackaging) {\n04644|         const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n04645|         details.push({\n04646|           service: '–£–ø–∞–∫–æ–≤–∫–∞',\n04647|           description: '',\n04648|           price: Math.round(totalWeight * 30)\n04649|         });\n04650|       }\n04651|     }\n04652|     \n04653|     return details;\n04654|   } catch (globalError) {\n04655|     console.error('‚ùå –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –û–®–ò–ë–ö–ê –≤ parseCalculationDetails:', globalError);\n04656|     console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', globalError instanceof Error ? globalError.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n04657|     console.log('‚ùå calc object:', calc);\n04658|     // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ\n04659|     return [{\n04660|       service: '–î–æ—Å—Ç–∞–≤–∫–∞',\n04661|       description: '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞',\n04662|       price: calc?.price || 0\n04663|     }];\n04664|   }\n04665| };\n04666| \n04667|   // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –ø–æ–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏)\n04668|   if (!isLoaded) {\n04669|     return (\n04670|       <div className=\"min-h-screen bg-gray-900 text-white p-4 relative flex items-center justify-center\">\n04671|         <div className=\"text-center\">\n04672|           <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400 mx-auto mb-4\"></div>\n04673|           <p className=\"text-blue-400\">–ó–∞–≥—Ä—É–∑–∫–∞...</p>\n04674|         </div>\n04675|       </div>\n04676|     );\n04677|   }\n04678| \n04679|   return (\n04680|     <div className=\"min-h-screen bg-gray-900 text-white p-4 relative\">\n04681|       <div className=\"max-w-7xl mx-auto\">\n04682|         <div className=\"flex items-center justify-between mb-3\">\n04683|           <h1 className=\"text-xl font-bold text-blue-400\">\n04684|             –ú–µ–∂–¥—É–≥–æ—Ä–æ–¥–Ω—è—è –¥–æ—Å—Ç–∞–≤–∫–∞ –õ–∞–≤—Å–∏—Ç\n04685|           </h1>\n04686|           \n04687|           {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è */}\n04688|           <div className=\"flex items-center gap-4\">\n04689|             {isFormChanged ? (\n04690|               <div className=\"flex items-center gap-2 text-yellow-400 text-sm\">\n04691|                 <div className=\"w-2 h-2 bg-yellow-400 rounded-full animate-pulse\"></div>\n04692|                 –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...\n04693|               </div>\n04694|             ) : lastSaveTime ? (\n04695|               <div className=\"flex items-center gap-2 text-green-400 text-sm\">\n04696|                 <div className=\"w-2 h-2 bg-green-400 rounded-full\"></div>\n04697|                 –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ {lastSaveTime.toLocaleTimeString()}\n04698|               </div>\n04699|             ) : hasStoredFormData() ? (\n04700|               <div className=\"flex items-center gap-2 text-blue-400 text-sm\">\n04701|                 <div className=\"w-2 h-2 bg-blue-400 rounded-full\"></div>\n04702|                 –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã\n04703|               </div>\n04704|             ) : null}\n04705|             \n04706|             {/* –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö */}\n04707|             {hasStoredFormData() && (\n04708|               <Button\n04709|                 onClick={() => {\n04710|                   if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã?')) {\n04711|                     clearFormData();\n04712|                     setForm(initialFormState);\n04713|                     setLastSaveTime(null);\n04714|                     setIsFormChanged(false);\n04715|                   }\n04716|                 }}\n04717|                 variant=\"outline\"\n04718|                 size=\"sm\"\n04719|                 className=\"border-red-500 text-red-400 hover:bg-red-900/20\"\n04720|               >\n04721|                 <Trash2 className=\"h-3 w-3 mr-1\" />\n04722|                 –û—á–∏—Å—Ç–∏—Ç—å\n04723|               </Button>\n04724|             )}\n04725|           </div>\n04726|         </div>\n04727|         \n04728|         {/* –ö–Ω–æ–ø–∫–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ */}\n04729|         <div className=\"flex justify-end gap-2 mb-4\">\n04730|           <Button \n04731|             onClick={() => window.open('/diagnostic?tab=api', '_blank')}\n04732|             variant=\"outline\" \n04733|             className=\"border-green-500 text-green-400 hover:bg-green-900/20\"\n04734|           >\n04735|             <Settings className=\"h-4 w-4 mr-2\" />\n04736|             –í—Å–µ API\n04737|           </Button>\n04738|           <Button \n04739|             onClick={() => window.open('/diagnostic?tab=docs', '_blank')}\n04740|             variant=\"outline\" \n04741|             className=\"border-purple-500 text-purple-400 hover:bg-purple-900/20\"\n04742|           >\n04743|             <Package2 className=\"h-4 w-4 mr-2\" />\n04744|             –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è\n04745|           </Button>\n04746|           <Button \n04747|             onClick={() => window.open('/diagnostic', '_blank')}\n04748|             variant=\"outline\" \n04749|             className=\"border-blue-500 text-blue-400 hover:bg-blue-900/20\"\n04750|           >\n04751|             <Settings className=\"h-4 w-4 mr-2\" />\n04752|             –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞\n04753|           </Button>\n04754|         </div>\n04755|         \n04756|         <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-3 h-[85vh]\">\n04757|           {/* –õ–µ–≤–∞—è —á–∞—Å—Ç—å - —Ñ–æ—Ä–º–∞ */}\n04758|           <div className=\"space-y-2 overflow-y-auto pr-2\">\n04759|             {/* –ö–∞—Ç–∞–ª–æ–≥ –º–µ–±–µ–ª–∏ */}\n04760|             <Card className=\"bg-gray-800 border-gray-700\">\n04761|               <CardHeader className=\"pb-2\">\n04762|                 <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n04763|                   <Package2 className=\"h-3 w-3\" />\n04764|                   –ö–∞—Ç–∞–ª–æ–≥ –º–µ–±–µ–ª–∏\n04765|                 </CardTitle>\n04766|               </CardHeader>\n04767|               <CardContent className=\"space-y-2\">\n04768|                 {/* –ü–æ–∏—Å–∫ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ */}\n04769|                 <LazyProductSearch \n04770|                   onProductAdd={handleProductAdd}\n04771|                   disabled={calculating}\n04772|                 />\n04773|                 \n04774|                 {/* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏ */}\n04775|                 <ProductManager\n04776|                   products={form.selectedProducts}\n04777|                   onQuantityChange={handleProductQuantityChange}\n04778|                   onProductRemove={handleProductRemove}\n04779|                   disabled={calculating}\n04780|                 />\n04781|               </CardContent>\n04782|             </Card>\n04783| \n04784|             {/* –ì—Ä—É–∑—ã */}\n04785|             <Card className=\"bg-gray-800 border-gray-700\">\n04786|               <CardHeader className=\"pb-2\">\n04787|                 <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n04788|                   <Truck className=\"h-3 w-3\" />\n04789|                   –ì—Ä—É–∑—ã\n04790|                 </CardTitle>\n04791|               </CardHeader>\n04792|               <CardContent className=\"space-y-2\">\n04793|                 {groupCargosForDisplay(form.cargos).map((group, groupIndex) => (\n04794|                    <div key={`group_${groupIndex}`} className=\"border border-gray-600 rounded p-2\">\n04795|                     <div className=\"flex justify-between items-center mb-2\">\n04796|                       <h4 className=\"text-sm font-medium text-white\">\n04797|                         {group.isEmpty ? (\n04798|                           `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1}`\n04799|                         ) : group.quantity === 1 ? (\n04800|                           `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1}`\n04801|                         ) : (\n04802|                           `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1} - ${group.quantity} –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –º–µ—Å—Ç–∞`\n04803|                         )}\n04804|                       </h4>\n04805|                       {form.cargos.length > 1 && group.quantity === 1 && (\n04806|                         <Button\n04807|                           variant=\"destructive\"\n04808|                           size=\"sm\"\n04809|                           onClick={() => removeCargo(form.cargos[group.indices[0]].id)}\n04810|                           className=\"h-6 text-xs\"\n04811|                         >\n04812|                           –£–¥–∞–ª–∏—Ç—å\n04813|                         </Button>\n04814|                       )}\n04815|                       {group.quantity > 1 && (\n04816|                         <Badge variant=\"secondary\" className=\"text-xs\">\n04817|                           {group.quantity} —à—Ç.\n04818|                         </Badge>\n04819|                       )}\n04820|                     </div>\n04821|                     \n04822|                     {group.isEmpty || group.quantity === 1 ? (\n04823|                       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞ –¥–ª—è –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ –∏–ª–∏ –µ–¥–∏–Ω–∏—á–Ω—ã—Ö\n04824|                       <div className=\"grid grid-cols-2 gap-2\">\n04825|                         <div>\n04826|                           <Label className=\"text-white text-xs\">–î–ª–∏–Ω–∞ (—Å–º)</Label>\n04827|                           <Input\n04828|                             type=\"number\"\n04829|                             value={form.cargos[group.indices[0]].length || ''}\n04830|                             onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'length', Number(e.target.value))}\n04831|                             className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n04832|                           />\n04833|                         </div>\n04834|                         <div>\n04835|                           <Label className=\"text-white text-xs\">–®–∏—Ä–∏–Ω–∞ (—Å–º)</Label>\n04836|                           <Input\n04837|                             type=\"number\"\n04838|                             value={form.cargos[group.indices[0]].width || ''}\n04839|                             onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'width', Number(e.target.value))}\n04840|                             className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n04841|                           />\n04842|                         </div>\n04843|                         <div>\n04844|                           <Label className=\"text-white text-xs\">–í—ã—Å–æ—Ç–∞ (—Å–º)</Label>\n04845|                           <Input\n04846|                             type=\"number\"\n04847|                             value={form.cargos[group.indices[0]].height || ''}\n04848|                             onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'height', Number(e.target.value))}\n04849|                             className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n04850|                           />\n04851|                         </div>\n04852|                         <div>\n04853|                           <Label className=\"text-white text-xs\">–í–µ—Å (–∫–≥)</Label>\n04854|                           <Input\n04855|                             type=\"number\"\n04856|                             value={form.cargos[group.indices[0]].weight || ''}\n04857|                             onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'weight', Number(e.target.value))}\n04858|                             className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n04859|                           />\n04860|                         </div>\n04861|                       </div>\n04862|                     ) : (\n04863|                       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –≥—Ä—É–ø–ø\n04864|                       <div className=\"grid grid-cols-2 gap-2 text-sm text-gray-300\">\n04865|                         <div>–î–ª–∏–Ω–∞: {group.length} —Å–º</div>\n04866|                         <div>–®–∏—Ä–∏–Ω–∞: {group.width} —Å–º</div>\n04867|                         <div>–í—ã—Å–æ—Ç–∞: {group.height} —Å–º</div>\n04868|                         <div>–í–µ—Å: {group.weight} –∫–≥</div>\n04869|                         <div className=\"col-span-2 text-xs text-blue-300 mt-1\">\n04870|                           –û–±—â–∏–π –≤–µ—Å: {(group.weight * group.quantity).toFixed(1)} –∫–≥, \n04871|                           –æ–±—ä–µ–º: {((group.length * group.width * group.height * group.quantity) / 1000000).toFixed(3)} –º¬≥\n04872|                         </div>\n04873|                       </div>\n04874|                     )}\n04875|                   </div>\n04876|                 ))}\n04877|                  <Button onClick={addCargo} className=\"w-full h-7 text-xs\" variant=\"outline\">\n04878|                   <Plus className=\"h-3 w-3 mr-1\" />\n04879|                   –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–∑\n04880|                 </Button>\n04881|               </CardContent>\n04882|             </Card>\n04883| \n04884|             {/* –ú–∞—Ä—à—Ä—É—Ç */}\n04885|             <Card className=\"bg-gray-800 border-gray-700\">\n04886|               <CardHeader className=\"pb-2\">\n04887|                 <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n04888|                   <Map className=\"h-3 w-3\" />\n04889|                   –ú–∞—Ä—à—Ä—É—Ç\n04890|                 </CardTitle>\n04891|               </CardHeader>\n04892|               <CardContent className=\"space-y-2\">\n04893|                 {/* –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */}\n04894|                 <div className=\"space-y-2\">\n04895|                   <Label className=\"text-sm font-medium text-white\">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</Label>\n04896|                   <div className=\"flex gap-3 flex-wrap\">\n04897|                     <label className=\"flex items-center space-x-1\">\n04898|                       <input\n04899|                         type=\"radio\"\n04900|                         name=\"fromDelivery\"\n04901|                         checked={form.fromTerminal}\n04902|                         onChange={() => setForm(prev => ({ ...prev, fromTerminal: true, fromAddressDelivery: false, fromLavsiteWarehouse: false }))}\n04903|                       />\n04904|                       <span className=\"text-white text-xs\">–û—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞</span>\n04905|                     </label>\n04906|                     <label className=\"flex items-center space-x-1\">\n04907|                       <input\n04908|                         type=\"radio\"\n04909|                         name=\"fromDelivery\"\n04910|                         checked={form.fromAddressDelivery && !form.fromLavsiteWarehouse}\n04911|                         onChange={() => setForm(prev => ({ ...prev, fromTerminal: false, fromAddressDelivery: true, fromLavsiteWarehouse: false }))}\n04912|                       />\n04913|                       <span className=\"text-white text-xs\">–û—Ç –∞–¥—Ä–µ—Å–∞</span>\n04914|                     </label>\n04915|                     <label className=\"flex items-center space-x-1\">\n04916|                       <Checkbox\n04917|                         id=\"lavsiteWarehouse\"\n04918|                         checked={form.fromLavsiteWarehouse}\n04919|                         onCheckedChange={handleLavsiteWarehouseChange}\n04920|                       />\n04921|                       <span className=\"text-white text-xs cursor-pointer\">–°–æ —Å–∫–ª–∞–¥–∞ –õ–∞–≤—Å–∏—Ç</span>\n04922|                     </label>\n04923|                   </div>\n04924|                   \n04925|                   <div>\n04926|                     <Label className=\"text-white text-xs\">–ì–æ—Ä–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</Label>\n04927|                     <Input\n04928|                       value={form.fromCity}\n04929|                       onChange={(e) => !form.fromLavsiteWarehouse && handleAddressChange('fromCity', e.target.value, e.target)}\n04930|                       placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –≥–æ—Ä–æ–¥\"\n04931|                       disabled={form.fromLavsiteWarehouse}\n04932|                       className={`bg-gray-700 border-gray-600 h-7 text-white text-xs ${form.fromLavsiteWarehouse ? 'opacity-50 cursor-not-allowed' : ''}`}\n04933|                     />\n04934|                   </div>\n04935|                   \n04936|                   {form.fromAddressDelivery && (\n04937|                     <div>\n04938|                       <Label className=\"text-white text-xs\">–ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</Label>\n04939|                       <Input\n04940|                         value={form.fromAddress}\n04941|                         onChange={(e) => !form.fromLavsiteWarehouse && handleAddressChange('fromAddress', e.target.value, e.target)}\n04942|                         placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å\"\n04943|                         disabled={form.fromLavsiteWarehouse}\n04944|                         className={`bg-gray-700 border-gray-600 h-7 text-white text-xs ${form.fromLavsiteWarehouse ? 'opacity-50 cursor-not-allowed' : ''}`}\n04945|                       />\n04946|                     </div>\n04947|                   )}\n04948|                 </div>\n04949| \n04950|                 {/* –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ */}\n04951|                 <div className=\"space-y-2\">\n04952|                   <Label className=\"text-sm font-medium text-white\">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</Label>\n04953|                   <div className=\"flex gap-3 flex-wrap\">\n04954|                     <label className=\"flex items-center space-x-1\">\n04955|                       <input\n04956|                         type=\"radio\"\n04957|                         name=\"toDelivery\"\n04958|                         checked={form.toTerminal}\n04959|                         onChange={() => setForm(prev => ({ ...prev, toTerminal: true, toAddressDelivery: false }))}\n04960|                       />\n04961|                       <span className=\"text-white text-xs\">–î–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞</span>\n04962|                     </label>\n04963|                     <label className=\"flex items-center space-x-1\">\n04964|                       <input\n04965|                         type=\"radio\"\n04966|                         name=\"toDelivery\"\n04967|                         checked={form.toAddressDelivery}\n04968|                         onChange={() => setForm(prev => ({ ...prev, toTerminal: false, toAddressDelivery: true }))}\n04969|                       />\n04970|                       <span className=\"text-white text-xs\">–î–æ –∞–¥—Ä–µ—Å–∞</span>\n04971|                     </label>\n04972|                   </div>\n04973|                   \n04974|                   <div>\n04975|                     <Label className=\"text-white text-xs\">–ì–æ—Ä–æ–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</Label>\n04976|                     <Input\n04977|                       value={form.toCity}\n04978|                       onChange={(e) => handleAddressChange('toCity', e.target.value, e.target)}\n04979|                       placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –≥–æ—Ä–æ–¥\"\n04980|                       className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n04981|                     />\n04982|                   </div>\n04983|                   \n04984|                   {form.toAddressDelivery && (\n04985|                     <div>\n04986|                       <Label className=\"text-white text-xs\">–ê–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</Label>\n04987|                       <Input\n04988|                         value={form.toAddress}\n04989|                         onChange={(e) => handleAddressChange('toAddress', e.target.value, e.target)}\n04990|                         placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å\"\n04991|                         className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n04992|                       />\n04993|                     </div>\n04994|                   )}\n04995|                 </div>\n04996| \n04997|                 <div>\n04998|                   <Label className=\"text-white text-xs\">–û–±—ä—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (—Ä—É–±.)</Label>\n04999|                   <Input\n05000|                     type=\"number\"\n05001|                     value={form.declaredValue || ''}\n05002|                     onChange={(e) => setForm(prev => ({ ...prev, declaredValue: Number(e.target.value) }))}\n05003|                     className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n05004|                   />\n05005|                 </div>\n05006|                 \n05007|                 <div className=\"space-y-2\">\n05008|                   <div className=\"flex items-center space-x-2\">\n05009|                     <Checkbox\n05010|                       id=\"packaging\"\n05011|                       checked={form.needPackaging}\n05012|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needPackaging: checked as boolean }))}\n05013|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n05014|                     />\n05015|                     <Label htmlFor=\"packaging\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è —É–ø–∞–∫–æ–≤–∫–∞</Label>\n05016|                   </div>\n05017|                   \n05018|                   <div className=\"flex items-center space-x-2\">\n05019|                     <Checkbox\n05020|                       id=\"insurance\"\n05021|                       checked={form.needInsurance}\n05022|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needInsurance: checked as boolean }))}\n05023|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n05024|                     />\n05025|                     <Label htmlFor=\"insurance\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞</Label>\n05026|                   </div>\n05027|                   \n05028|                   <div className=\"flex items-center space-x-2\">\n05029|                     <Checkbox\n05030|                       id=\"loading\"\n05031|                       checked={form.needLoading}\n05032|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needLoading: checked as boolean }))}\n05033|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n05034|                     />\n05035|                     <Label htmlFor=\"loading\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≥—Ä—É–∑–∫–∞/—Ä–∞–∑–≥—Ä—É–∑–∫–∞</Label>\n05036|                   </div>\n05037|                   \n05038|                   <div className=\"flex items-center space-x-2\">\n05039|                     <Checkbox\n05040|                       id=\"carry\"\n05041|                       checked={form.needCarry}\n05042|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needCarry: checked as boolean }))}\n05043|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n05044|                     />\n05045|                     <Label htmlFor=\"carry\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—ä–µ–º</Label>\n05046|                   </div>\n05047|                   \n05048|                   {form.needCarry && (\n05049|                     <div className=\"ml-6 space-y-2 border-l-2 border-gray-600 pl-3\">\n05050|                       <div>\n05051|                         <Label className=\"text-white text-xs\">–≠—Ç–∞–∂</Label>\n05052|                         <Input\n05053|                           type=\"number\"\n05054|                           value={form.floor}\n05055|                           onChange={(e) => setForm(prev => ({ ...prev, floor: Number(e.target.value) }))}\n05056|                           className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n05057|                         />\n05058|                       </div>\n05059|                       <div className=\"flex items-center space-x-2\">\n05060|                         <Checkbox\n05061|                           id=\"freightLift\"\n05062|                           checked={form.hasFreightLift}\n05063|                           onCheckedChange={(checked) => setForm(prev => ({ ...prev, hasFreightLift: checked as boolean }))}\n05064|                         />\n05065|                         <Label htmlFor=\"freightLift\" className=\"text-white text-xs\">–ù–∞–ª–∏—á–∏–µ –≥—Ä—É–∑–æ–≤–æ–≥–æ –ª–∏—Ñ—Ç–∞</Label>\n05066|                       </div>\n05067|                     </div>\n05068|                   )}\n05069|                 </div>\n05070|                 \n05071|                 <div className=\"space-y-2\">\n05072|                   <Button \n05073|                     onClick={handleCalculate} \n05074|                     className=\"w-full bg-blue-600 hover:bg-blue-700 h-7 text-xs\" \n05075|                     disabled={calculating}\n05076|                   >\n05077|                     {calculating ? '–†–∞—Å—á–µ—Ç...' : '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å'}\n05078|                   </Button>\n05079|                   \n05080|                   <Button \n05081|                     onClick={handleReset} \n05082|                     variant=\"outline\" \n05083|                     className=\"w-full h-7 text-xs text-black border-gray-600 hover:bg-gray-700 hover:text-white\" \n05084|                     disabled={calculating}\n05085|                   >\n05086|                     –°–±—Ä–æ—Å–∏—Ç—å —Ä–∞—Å—á–µ—Ç\n05087|                   </Button>\n05088|                 </div>\n05089|               </CardContent>\n05090|             </Card>\n05091|           </div>\n05092| \n05093|           {/* –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã */}\n05094|           <div className=\"space-y-2 overflow-y-auto\">\n05095|             {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Ä–∞—Å—á–µ—Ç–æ–≤ */}\n05096|             <CalculationProgress \n05097|               companies={calculationProgress.companies}\n05098|               totalDuration={calculationProgress.totalDuration}\n05099|               isVisible={calculating}\n05100|             />\n05101|             \n05102|             {calculations.length > 0 && (\n05103|                  <div className=\"space-y-2\">\n05104|                 <div className=\"flex justify-between items-center\">\n05105|                   <h2 className=\"text-lg font-bold text-blue-400\">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞</h2>\n05106|                   <Button \n05107|                     onClick={exportToPDF} \n05108|                     variant=\"outline\" \n05109|                     size=\"sm\" \n05110|                     className=\"h-7 text-xs border-blue-500 text-blue-400 hover:bg-blue-900/20 print:hidden\"\n05111|                   >\n05112|                     –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ PDF\n05113|                   </Button>\n05114|                 </div>\n05115|                 \n05116|                 {calculations\n05117|                   .filter(calc => !hiddenCompanies[calc.company])\n05118|                   .map((calc, index) => (\n05119|                    <Card key={index} className=\"bg-gray-800 border-gray-700 text-xs\">\n05120|                      <CardHeader className=\"pb-1\">\n05121|                       <div className=\"flex justify-between items-center\">\n05122|                          <CardTitle className=\"text-white flex items-center gap-2 text-xs\">\n05123|                            <Building2 className=\"h-3 w-3\" />\n05124|                           {calc.company}\n05125|                         </CardTitle>\n05126|                         {calc.error ? (\n05127|                           <Badge variant=\"destructive\" className=\"text-xs\">–û—à–∏–±–∫–∞</Badge>\n05128|                         ) : (\n05129|                           <Badge variant=\"default\" className=\"bg-green-600 text-xs\">\n05130|                             {calc.price.toLocaleString()} ‚ÇΩ\n05131|                           </Badge>\n05132|                         )}\n05133|                       </div>\n05134|                     </CardHeader>\n05135|                     <CardContent className=\"pt-0\">\n05136|                       <div className=\"space-y-2\">\n05137|                         {calc.error ? (\n05138|                           <div className=\"space-y-2\">\n05139|                             <Alert className=\"border-red-600\">\n05140|                               <AlertDescription className=\"text-white text-xs\">{calc.error}</AlertDescription>\n05141|                             </Alert>\n05142|                             {calc.price > 0 && (\n05143|                               <>\n05144|                                 <p className=\"text-white text-xs\"><strong>–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {calc.price.toLocaleString()} ‚ÇΩ</p>\n05145|                                 <p className=\"text-white text-xs\"><strong>–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Å—Ä–æ–∫:</strong> {calc.days} –¥–Ω–µ–π</p>\n05146|                               </>\n05147|                             )}\n05148|                           </div>\n05149|                         ) : (\n05150|                           <>\n05151|                             <p className=\"text-white text-xs\"><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {calc.price.toLocaleString()} ‚ÇΩ</p>\n05152|                             <p className=\"text-white text-xs\"><strong>–°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> {calc.days} –¥–Ω–µ–π</p>\n05153|                           </>\n05154|                         )}\n05155|                         \n05156|                         <div className=\"flex gap-2 mt-2 flex-wrap\">\n05157|                           {!calc.error && (\n05158|                             <Button\n05159|                               variant=\"outline\"\n05160|                               size=\"sm\"\n05161|                               onClick={() => toggleDetails(calc.company)}\n05162|                               className=\"h-6 text-xs\"\n05163|                             >\n05164|                               {expandedDetails[calc.company] ? '–°–∫—Ä—ã—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ' : '–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ'}\n05165|                             </Button>\n05166|                           )}\n05167|                           <Button\n05168|                             variant=\"outline\"\n05169|                             size=\"sm\"\n05170|                             onClick={() => toggleDebugInfo(calc.company)}\n05171|                             className=\"h-6 text-xs\"\n05172|                           >\n05173|                             {expandedDebugInfo[calc.company] ? '–°–∫—Ä—ã—Ç—å –æ—Ç–ª–∞–¥–∫—É' : '–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'}\n05174|                           </Button>\n05175|                           <Button\n05176|                             variant=\"outline\"\n05177|                             size=\"sm\"\n05178|                             onClick={() => {\n05179|                               setHiddenCompanies(prev => ({\n05180|                                 ...prev,\n05181|                                 [calc.company]: true\n05182|                               }));\n05183|                             }}\n05184|                             className=\"h-6 text-xs border-red-500 text-red-400 hover:bg-red-900/20\"\n05185|                           >\n05186|                             –°–∫—Ä—ã—Ç—å\n05187|                           </Button>\n05188|                         </div>\n05189|                         \n05190|                         {/* –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ */}\n05191|                         {!calc.error && (\n05192|                           <Collapsible open={expandedDetails[calc.company]}>\n05193|                             <CollapsibleContent className=\"mt-2\">\n05194|                               <div className=\"bg-gray-900 p-3 rounded text-xs\">\n05195|                                 <h4 className=\"font-bold mb-2 text-white\">–î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞:</h4>\n05196|                                 {(() => {\n05197|                                   const details = parseCalculationDetails(calc);\n05198|                                   const totalPrice = details.reduce((sum, detail) => sum + detail.price, 0);\n05199|                                   \n05200|                                   return (\n05201|                                     <div className=\"space-y-1\">\n05202|                                       {details.map((detail, idx) => (\n05203|                                         <div key={idx} className=\"flex justify-between text-white\">\n05204|                                           <div>\n05205|                                             <div className=\"font-medium\">{detail.service}</div>\n05206|                                             {detail.description && (\n05207|                                               <div className=\"text-gray-400 text-xs\">{detail.description}</div>\n05208|                                             )}\n05209|                                           </div>\n05210|                                           <div className=\"font-medium\">{detail.price.toLocaleString()} ‚ÇΩ</div>\n05211|                                         </div>\n05212|                                       ))}\n05213|                                     </div>\n05214|                                   );\n05215|                                 })()}\n05216|                               </div>\n05217|                             </CollapsibleContent>\n05218|                           </Collapsible>\n05219|                         )}\n05220|                         \n05221|                         {/* –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è - –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ */}\n05222|                         <Collapsible open={expandedDebugInfo[calc.company]}>\n05223|                           <CollapsibleContent className=\"mt-2\">\n05224|                             <div className=\"bg-gray-900 p-3 rounded text-xs\">\n05225|                               <h4 className=\"font-bold mb-2 text-white\">–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h4>\n05226|                               \n05227|                               {calc.apiUrl && (\n05228|                                 <div className=\"mb-3\">\n05229|                                   <h5 className=\"font-bold mb-1 text-white\">–ó–∞–ø—Ä–æ—Å –∫ API:</h5>\n05230|                                   <p className=\"text-gray-300 break-all text-xs\">URL: {calc.apiUrl}</p>\n05231|                                 </div>\n05232|                               )}\n05233|                               \n05234|                               {calc.sessionId && (\n05235|                                 <div className=\"mb-3\">\n05236|                                   <h5 className=\"font-bold mb-1 text-white\">Session ID:</h5>\n05237|                                   <p className=\"text-gray-300 text-xs\">{calc.sessionId}</p>\n05238|                                 </div>\n05239|                               )}\n05240|                               \n05241|                               {calc.requestData && (\n05242|                                 <div className=\"mb-3\">\n05243|                                   <h5 className=\"font-bold mb-1 text-white\">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å:</h5>\n05244|                                   <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n05245|                                     {JSON.stringify(calc.requestData, null, 2)}\n05246|                                   </pre>\n05247|                                 </div>\n05248|                               )}\n05249|                               \n05250|                               {calc.responseData && (\n05251|                                 <div className=\"mb-3\">\n05252|                                   <h5 className=\"font-bold mb-1 text-white\">–ü–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç:</h5>\n05253|                                   <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n05254|                                     {JSON.stringify(calc.responseData, null, 2)}\n05255|                                   </pre>\n05256|                                 </div>\n05257|                               )}\n05258|                               \n05259|                               {calc.details && (\n05260|                                 <div className=\"mb-3\">\n05261|                                   <h5 className=\"font-bold mb-1 text-white\">–î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ (JSON):</h5>\n05262|                                   <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n05263|                                     {JSON.stringify(calc.details, null, 2)}\n05264|                                   </pre>\n05265|                                 </div>\n05266|                               )}\n05267|                               \n05268|                               {calc.error && (\n05269|                                 <div className=\"mb-3\">\n05270|                                   <h5 className=\"font-bold mb-1 text-red-400\">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ:</h5>\n05271|                                   <p className=\"text-red-300 text-xs\">{calc.error}</p>\n05272|                                 </div>\n05273|                               )}\n05274|                             </div>\n05275|                           </CollapsibleContent>\n05276|                         </Collapsible>\n05277|                       </div>\n05278|                     </CardContent>\n05279|                   </Card>\n05280|                  ))}\n05281|                  \n05282|                  {/* –ë–ª–æ–∫ –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–∫—Ä—ã—Ç—ã—Ö –¢–ö */}\n05283|                  {Object.values(hiddenCompanies).some(hidden => hidden) && (\n05284|                    <div className=\"mt-4 p-3 bg-gray-700 rounded border-gray-600\">\n05285|                      <div className=\"flex items-center justify-between\">\n05286|                        <div className=\"text-sm text-gray-300\">\n05287|                          –°–∫—Ä—ã—Ç–æ –¢–ö: {Object.values(hiddenCompanies).filter(hidden => hidden).length}\n05288|                        </div>\n05289|                        <Button\n05290|                          variant=\"outline\"\n05291|                          size=\"sm\"\n05292|                          onClick={() => setHiddenCompanies({})}\n05293|                          className=\"h-6 text-xs border-green-500 text-green-400 hover:bg-green-900/20\"\n05294|                        >\n05295|                          –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–∫—Ä—ã—Ç—ã–µ\n05296|                        </Button>\n05297|                      </div>\n05298|                    </div>\n05299|                  )}\n05300|                </div>\n05301|             )}\n05302| \n05303|             {/* –°–ø–∏—Å–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –¢–ö - –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º—ã–π */}\n05304|             <Card className=\"bg-gray-800 border-gray-700\">\n05305|               <CardHeader className=\"pb-2\">\n05306|                 <div className=\"flex justify-between items-center\">\n05307|                   <CardTitle className=\"text-white text-sm\">\n05308|                     –ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ ({COMPANIES_BASE.filter(company => showHiddenCompanies || enabledCompanies[company.apiKey]).length}{showHiddenCompanies ? ` –∏–∑ ${COMPANIES_BASE.length}` : ''})\n05309|                   </CardTitle>\n05310|                   <Button\n05311|                     variant=\"outline\"\n05312|                     size=\"sm\"\n05313|                     onClick={() => setShowHiddenCompanies(prev => !prev)}\n05314|                     className=\"h-6 text-xs border-blue-500 text-blue-400 hover:bg-blue-900/20\"\n05315|                   >\n05316|                     {showHiddenCompanies ? '–°–∫—Ä—ã—Ç—å –≤—Å–µ' : '–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ'}\n05317|                   </Button>\n05318|                 </div>\n05319|               </CardHeader>\n05320|               <CardContent>\n05321|                 <div className=\"grid grid-cols-2 gap-2\">\n05322|                   {COMPANIES_BASE\n05323|                     .filter(company => showHiddenCompanies || enabledCompanies[company.apiKey])\n05324|                     .map((company, index) => {\n05325|                     const isConnected = apiStatus[company.apiKey as keyof typeof apiStatus] === '–ø–æ–¥–∫–ª—é—á–µ–Ω–æ';\n05326|                     const statusText = apiStatus[company.apiKey as keyof typeof apiStatus];\n05327|                     const isEnabled = enabledCompanies[company.apiKey];\n05328|                     \n05329|                     // –û—Ç–ª–∞–¥–∫–∞ –¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–æ–º–ø–∞–Ω–∏–π\n05330|                     if (index < 3) {\n05331|                       console.log(`üîç –ö–æ–º–ø–∞–Ω–∏—è ${index}: ${company.name}, apiKey: ${company.apiKey}, isEnabled: ${isEnabled}, statusText: ${statusText}`);\n05332|                     }\n05333|                     \n05334|                     return (\n05335|                       <div key={index} className=\"flex items-center justify-between p-1.5 bg-gray-700 rounded\">\n05336|                         <div className=\"flex items-center gap-2\">\n05337|                           <span className=\"text-lg\">{company.logo}</span>\n05338|                           <div>\n05339|                             <p className=\"font-medium text-white text-[10px] leading-tight\">{company.name}</p>\n05340|                             <Badge \n05341|                               variant={isConnected ? \"default\" : \"destructive\"} \n05342|                               className=\"text-[9px] py-0 px-1\"\n05343|                             >\n05344|                               {isConnected ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–∞' : statusText === '–ø—Ä–æ–≤–µ—Ä–∫–∞...' ? '–ü—Ä–æ–≤–µ—Ä–∫–∞...' : '–û—à–∏–±–∫–∞'}\n05345|                             </Badge>\n05346|                           </div>\n05347|                         </div>\n05348|                         <div className=\"flex items-center gap-2\">\n05349|                           <span className=\"text-[9px] text-gray-300\">\n05350|                             {isEnabled ? '–í–∫–ª' : '–í—ã–∫–ª'}\n05351|                           </span>\n05352|                           <Switch\n05353|                             checked={isEnabled}\n05354|                             onCheckedChange={(checked) => {\n05355|                               setEnabledCompanies(prev => ({\n05356|                                 ...prev,\n05357|                                 [company.apiKey]: checked\n05358|                               }));\n05359|                             }}\n05360|                           />\n05361|                         </div>\n05362|                       </div>\n05363|                     );\n05364|                   })}\n05365|                 </div>\n05366|               </CardContent>\n05367|             </Card>\n05368| \n05369|             {/* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫—É–∑–æ–≤–∞ */}\n05370|             {calculations.length > 0 && (\n05371|               <LazyTruckVisualization \n05372|                 cargos={form.cargos.map(cargo => ({\n05373|                   id: cargo.id,\n05374|                   length: cargo.length * 10, // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n05375|                   width: cargo.width * 10,   // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n05376|                   height: cargo.height * 10, // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n05377|                   weight: cargo.weight,\n05378|                   productName: form.selectedProducts?.find(p => \n05379|                     p.cargoIndexes.includes(form.cargos.indexOf(cargo))\n05380|                   )?.product.name\n05381|                 }))}\n05382|                 isVisible={true}\n05383|               />\n05384|             )}\n05385|           </div>\n05386|         </div>\n05387|       </div>\n05388| \n05389|       {/* –ê–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–∫–∏ */}\n05390|       {showSuggestions && suggestions.length > 0 && (\n05391|         <div \n05392|           className=\"fixed z-50 bg-gray-800 border border-gray-700 rounded-md shadow-lg max-w-sm w-full max-h-60 overflow-y-auto\"\n05393|           style={{\n05394|             top: suggestionPosition.top,\n05395|             left: suggestionPosition.left\n05396|           }}\n05397|         >\n05398|           <div className=\"p-1\">\n05399|             {suggestions.map((suggestion, index) => (\n05400|               <div\n05401|                 key={index}\n05402|                 className=\"p-2 hover:bg-gray-700 cursor-pointer text-xs text-white rounded transition-colors\"\n05403|                 onClick={() => selectSuggestion(suggestion)}\n05404|               >\n05405|                 {suggestion.value}\n05406|               </div>\n05407|             ))}\n05408|           </div>\n05409|         </div>\n05410|       )}\n05411|     </div>\n05412|   );\n05413| }\n</file>",
    "title": "app/page.tsx",
    "metadata": {
      "preview": "        const cityFiasMap: Record<string, string> = {\n          '–º–æ—Å–∫–≤–∞': '0c5b2444-70a0-4932-980c-b4dc0d3f02b5',\n          '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': 'c2deb16a-0330-4f05-821f-1d09c93331e6',\n          '—Å–ø–±': 'c2deb16a-0330-4f05-821f-1d09c93331e6',\n          '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': '2763c110-cb8b-416a-9dac-ad28a55b4402',\n          '–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫': '8dea00e3-9aab-4d8e-887c-ef2aaa546456',\n          '–∫–∞–∑–∞–Ω—å': '93b3df57-4c89-44df-ac42-96f05e9cd3b9',\n          '–Ω–∏–∂–Ω–∏–π –Ω–æ–≤–≥–æ—Ä–æ–¥': '555e7d61-d9a7-4ba6-9770-6caa8198c483',\n          '—á–µ–ª—è–±–∏–Ω—Å–∫': 'a376e68d-724a-4472-be7c-891bdb09ae32',\n          '–æ–º—Å–∫': 'bb035cc3-1dc2-4627-9d25-a1bf5fed073d',\n          '—Ä–æ—Å—Ç–æ–≤-–Ω–∞-–¥–æ–Ω—É': 'c1cfe4b9-f7c2-423c-abfa-6ed5cb24d83e',\n          '—É—Ñ–∞': '7339e834-2cb4-473c-9c6e-93f3dcd66011',\n          '–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫': '9b968c73-f4d4-4012-8da8-3dacd4d4c1bd',\n          '–ø–µ—Ä–º—å': '4dc222e8-1f6a-4c36-894b-2b4a8c8a9b08',\n          '–≤–æ—Ä–æ–Ω–µ–∂': '5bf5ddff-6353-4a3d-80c4-6fb27f00c6c1',\n          '–≤–æ–ª–≥–æ–≥—Ä–∞–¥': 'da051ec8-da2e-4a66-b542-473b8d221ab6'\n        };\n\n        const normalizedCity = cityName.toLowerCase().trim()\n          .replace(/^–≥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥ \""
    },
    "time": {
      "start": 1764030539954,
      "end": 1764030539959
    }
  }
}