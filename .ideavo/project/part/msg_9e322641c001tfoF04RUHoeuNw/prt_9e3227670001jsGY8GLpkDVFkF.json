{
  "id": "prt_9e3227670001jsGY8GLpkDVFkF",
  "messageID": "msg_9e322641c001tfoF04RUHoeuNw",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "edit",
  "callID": "call_78099494",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "app/page.tsx",
      "oldString": "       const response = await fetch(apiUrl, {\n         method: 'POST',\n         headers: {\n           'Content-Type': 'application/json',\n         },\n         body: JSON.stringify(requestData)\n       });\n\n       const data = await response.json();\n       console.log('ðŸ“¦ CDEK Ð¾Ñ‚Ð²ÐµÑ‚ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½, Ñ‚Ð°Ñ€Ð¸Ñ„Ð¾Ð²:', data.tariff_codes?.length || 0);",
      "newString": "       const result = await enhancedApiRequest(\n         apiUrl,\n         {\n           method: 'POST',\n           headers: {\n             'Content-Type': 'application/json',\n           },\n           body: JSON.stringify(requestData)\n         },\n         { operation: 'calculate', company: 'Ð¡Ð”Ð­Ðš' }\n       );\n\n       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n         console.error('âŒ Ð¡Ð”Ð­Ðš API Ð¾ÑˆÐ¸Ð±ÐºÐ°:', result.error);\n         return {\n           company: 'Ð¡Ð”Ð­Ðš',\n           price: 0,\n           days: 0,\n           error: result.error.userMessage || result.error.message,\n           requestData,\n           responseData: null,\n           apiUrl\n         };\n       }\n\n       const response = result as Response;\n       const data = await response.json();\n       console.log('ðŸ“¦ CDEK Ð¾Ñ‚Ð²ÐµÑ‚ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½, Ñ‚Ð°Ñ€Ð¸Ñ„Ð¾Ð²:', data.tariff_codes?.length || 0);"
    },
    "output": "",
    "metadata": {
      "diagnostics": {},
      "diff": "Index: /home/user/project/app/page.tsx\n===================================================================\n--- /home/user/project/app/page.tsx\n+++ /home/user/project/app/page.tsx\n@@ -3470,19 +3470,37 @@\n   fromLavsiteWarehouse: form.fromLavsiteWarehouse,\n   toAddressDelivery: form.toAddressDelivery\n });\n \n-const response = await fetch(apiUrl, {\n-  method: 'POST',\n-  headers: {\n-    'Content-Type': 'application/json',\n-  },\n-  body: JSON.stringify(requestData)\n-});\n+ const result = await enhancedApiRequest(\n+   apiUrl,\n+   {\n+     method: 'POST',\n+     headers: {\n+       'Content-Type': 'application/json',\n+     },\n+     body: JSON.stringify(requestData)\n+   },\n+   { operation: 'calculate', company: 'Ð¡Ð”Ð­Ðš' }\n+ );\n \n-const data = await response.json();\n-console.log('ðŸ“¦ CDEK Ð¾Ñ‚Ð²ÐµÑ‚ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½, Ñ‚Ð°Ñ€Ð¸Ñ„Ð¾Ð²:', data.tariff_codes?.length || 0);\n+ if (result && typeof result === 'object' && 'success' in result && !result.success) {\n+   console.error('âŒ Ð¡Ð”Ð­Ðš API Ð¾ÑˆÐ¸Ð±ÐºÐ°:', result.error);\n+   return {\n+     company: 'Ð¡Ð”Ð­Ðš',\n+     price: 0,\n+     days: 0,\n+     error: result.error.userMessage || result.error.message,\n+     requestData,\n+     responseData: null,\n+     apiUrl\n+   };\n+ }\n \n+ const response = result as Response;\n+ const data = await response.json();\n+ console.log('ðŸ“¦ CDEK Ð¾Ñ‚Ð²ÐµÑ‚ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½, Ñ‚Ð°Ñ€Ð¸Ñ„Ð¾Ð²:', data.tariff_codes?.length || 0);\n+\n if (response.ok && data.tariff_codes && data.tariff_codes.length > 0) {\n   const isFromDoor = form.fromAddressDelivery || form.fromLavsiteWarehouse;\n   const isToDoor = form.toAddressDelivery;\n   \n"
    },
    "title": "app/page.tsx",
    "time": {
      "start": 1760452310642,
      "end": 1760452310662
    }
  }
}