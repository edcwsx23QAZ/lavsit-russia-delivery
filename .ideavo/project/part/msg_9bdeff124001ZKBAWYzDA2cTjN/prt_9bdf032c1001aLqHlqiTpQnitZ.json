{
  "id": "prt_9bdf032c1001aLqHlqiTpQnitZ",
  "messageID": "msg_9bdeff124001ZKBAWYzDA2cTjN",
  "sessionID": "ses_642100efaffewo9B0P8I80dZaA",
  "type": "tool",
  "tool": "read",
  "callID": "toolu_01SuebEGxYCP9Jc62sGsPR16",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/api/dellin-packages/route.ts"
    },
    "output": "<file>\n00001| import { NextRequest, NextResponse } from 'next/server'\n00002| import { apiRequestWithTimeout, validateApiInput, validationRules, PerformanceMonitor } from '@/lib/api-utils'\n00003| \n00004| export async function GET() {\n00005|   try {\n00006|     const response = await fetch('https://api.dellin.ru/v1/references/packages.json', {\n00007|       method: 'GET',\n00008|       headers: {\n00009|         'Content-Type': 'application/json',\n00010|       },\n00011|     })\n00012| \n00013|     if (!response.ok) {\n00014|       console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç API –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π:', response.status, response.statusText)\n00015|       return NextResponse.json(\n00016|         { error: '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ —É–ø–∞–∫–æ–≤–æ–∫' },\n00017|         { status: response.status }\n00018|       )\n00019|     }\n00020| \n00021|     const data = await response.json()\n00022|     \n00023|     return NextResponse.json(data, {\n00024|       headers: {\n00025|         'Access-Control-Allow-Origin': '*',\n00026|       'Access-Control-Allow-Methods': 'GET, POST',\n00027|         'Access-Control-Allow-Headers': 'Content-Type',\n00028|       },\n00029|     })\n00030| \n00031|   } catch (error) {\n00032|     console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ API –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π:', error)\n00033|     return NextResponse.json(\n00034|       { error: '–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞' },\n00035|       { status: 500 }\n00036|     )\n00037|   }\n00038| }\n00039| \n00040| export async function POST(request: NextRequest) {\n00041|   const endTiming = PerformanceMonitor.startMeasurement('dellin_api_total');\n00042|   \n00043|   try {\n00044|     const body = await request.json();\n00045|     console.log('üöõ Dellin API POST –∑–∞–ø—Ä–æ—Å:', JSON.stringify(body, null, 2));\n00046|     \n00047|     // Validate input\n00048|     if (body.method && typeof body.method !== 'string') {\n00049|       endTiming();\n00050|       return NextResponse.json({ \n00051|         error: 'Invalid method parameter',\n00052|         details: 'method must be a string'\n00053|       }, { status: 400 });\n00054|     }\n00055| \n00056|     // Handle test method\n00057|     if (body.method === 'test') {\n00058|       console.log('üß™ Dellin API —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å');\n00059|       const timing = endTiming();\n00060|       return NextResponse.json({ \n00061|         status: 'OK', \n00062|         service: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n00063|         message: 'API –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ',\n00064|         timestamp: new Date().toISOString(),\n00065|         features: [\n00066|           '–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —É–ø–∞–∫–æ–≤–æ–∫',\n00067|           '–†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏',\n00068|           '–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–π'\n00069|         ],\n00070|         endpoints: {\n00071|           packages: '/api/dellin-packages (GET)',\n00072|           test: '/api/dellin-packages (POST)'\n00073|         },\n00074|         timing\n00075|       });\n00076|     }\n00077| \n00078|     // For other methods, try to fetch from actual API\n00079|     try {\n00080|       const response = await apiRequestWithTimeout('https://api.dellin.ru/v1/references/packages.json', {\n00081|         method: 'GET',\n00082|         headers: {\n00083|           'Content-Type': 'application/json',\n00084|         },\n00085|       }, { timeout: 10000, retries: 1 });\n00086| \n00087|       if (!response.ok) {\n00088|         console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç API –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π:', response.status, response.statusText);\n00089|         endTiming();\n00090|         return NextResponse.json({\n00091|           error: '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π',\n00092|           status: response.status,\n00093|           statusText: response.statusText\n00094|         }, { status: response.status });\n00095|       }\n00096| \n00097|       const data = await response.json();\n00098|       const timing = endTiming();\n00099|       \n00100|       return NextResponse.json({ \n00101|         success: true,\n00102|         data,\n00103|         timing,\n00104|         requestMethod: body.method || 'unknown'\n00105|       }, {\n00106|         headers: {\n00107|           'Access-Control-Allow-Origin': '*',\n00108|           'Access-Control-Allow-Methods': 'GET, POST',\n00109|           'Access-Control-Allow-Headers': 'Content-Type',\n00110|         },\n00111|       });\n00112| \n00113|     } catch (fetchError) {\n00114|       console.error('‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ Dellin API:', fetchError);\n00115|       endTiming();\n00116|       return NextResponse.json({\n00117|         error: '–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ API –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π',\n00118|         details: fetchError instanceof Error ? fetchError.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'\n00119|       }, { status: 503 });\n00120|     }\n00121| \n00122|   } catch (error) {\n00123|     endTiming();\n00124|     console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ Dellin API:', error);\n00125|     \n00126|     return NextResponse.json({ \n00127|       error: '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞',\n00128|       details: error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞',\n00129|       type: error instanceof Error ? error.name : 'Unknown'\n00130|     }, { status: 500 });\n00131|   }\n00132| }\n00133| \n00134| export async function OPTIONS() {\n00135|   return new NextResponse(null, {\n00136|     status: 200,\n00137|     headers: {\n00138|       'Access-Control-Allow-Origin': '*',\n00139|       'Access-Control-Allow-Methods': 'GET',\n00140|       'Access-Control-Allow-Headers': 'Content-Type',\n00141|     },\n00142|   })\n00143| }\n</file>",
    "metadata": {
      "preview": "import { NextRequest, NextResponse } from 'next/server'\nimport { apiRequestWithTimeout, validateApiInput, validationRules, PerformanceMonitor } from '@/lib/api-utils'\n\nexport async function GET() {\n  try {\n    const response = await fetch('https://api.dellin.ru/v1/references/packages.json', {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    })\n\n    if (!response.ok) {\n      console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç API –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π:', response.status, response.statusText)\n      return NextResponse.json(\n        { error: '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ —É–ø–∞–∫–æ–≤–æ–∫' },\n        { status: response.status }\n      )\n    }\n"
    },
    "title": "app/api/dellin-packages/route.ts",
    "time": {
      "start": 1759828259821,
      "end": 1759828259841
    }
  }
}