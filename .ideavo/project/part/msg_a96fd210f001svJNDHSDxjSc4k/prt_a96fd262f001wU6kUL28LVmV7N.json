{
  "id": "prt_a96fd262f001wU6kUL28LVmV7N",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "messageID": "msg_a96fd210f001svJNDHSDxjSc4k",
  "type": "tool",
  "callID": "call_93999992",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "app/page.tsx",
      "offset": 3440
    },
    "output": "<file>\n03441|       // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è –Ω–æ–≤–æ–≥–æ API NordWheel\n03442|       const requestData = {\n03443|         dispatch: {\n03444|           location: {\n03445|             type: 'terminal',\n03446|             terminal_id: '0c7a2795-1220-486d-a7ce-8bcf130a1224', // –ú–æ—Å–∫–≤–∞ terminal GUID\n03447|             city_fias: '0c5b2444-70a0-4932-980c-b4dc0d3f02b5' // –ú–æ—Å–∫–≤–∞ FIAS\n03448|           }\n03449|         },\n03450|         destination: {\n03451|           location: {\n03452|             type: 'terminal',\n03453|             terminal_id: '3ca02b62-3632-4da0-8fde-de9d9c77c553', // –°–ü–± terminal GUID\n03454|             city_fias: 'c2deb16a-0330-4f05-821f-1d09c93331e6' // –°–ü–± FIAS\n03455|           }\n03456|         },\n03457|         cargo: {\n03458|           total_weight: totalWeight,\n03459|           total_volume: totalVolume,\n03460|           total_quantity: form.cargos.length\n03461|         },\n03462|         insurance: form.needInsurance && form.declaredValue ? form.declaredValue : 0,\n03463|         insurance_refuse: !form.needInsurance,\n03464|         services: {\n03465|           is_package: form.needPackaging,\n03466|           is_documents_return: false,\n03467|           is_fragile: false\n03468|         },\n03469|         promocode: null\n03470|       };\n03471| \n03472|       console.log('üöõ Nord Wheel –Ω–æ–≤—ã–π API –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03473| \n03474|       const response = await fetch(apiUrl, {\n03475|         method: 'POST',\n03476|         headers: {\n03477|           'Content-Type': 'application/json',\n03478|           'Authorization': `Bearer ${process.env.NORDWHEEL_API_KEY}`\n03479|         },\n03480|         body: JSON.stringify(requestData)\n03481|       });\n03482| \n03483|       if (!response.ok) {\n03484|         console.error('‚ùå Nord Wheel API –æ—à–∏–±–∫–∞:', response.status, response.statusText);\n03485|         return {\n03486|           company: 'Nord Wheel',\n03487|           price: 0,\n03488|           days: 0,\n03489|           error: `–û—à–∏–±–∫–∞ API: ${response.status} ${response.statusText}`,\n03490|           apiUrl,\n03491|           requestData\n03492|         };\n03493|       }\n03494| \n03495|       const data = await response.json();\n03496|       console.log('üöõ Nord Wheel –Ω–æ–≤—ã–π API –æ—Ç–≤–µ—Ç:', data);\n03497| \n03498|       // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ –Ω–æ–≤–æ–≥–æ API\n03499|       if (data.success) {\n03500|         const price = data.price || 0;\n03501|         const days = data.days || 0;\n03502| \n03503|         return {\n03504|           company: 'Nord Wheel',\n03505|           price: Math.round(price),\n03506|           days: days,\n03507|           details: {\n03508|             totalCost: price,\n03509|             deliveryCost: data.delivery_cost || 0,\n03510|             pickupCost: data.pickup_cost || 0,\n03511|             insuranceCost: data.insurance_cost || 0,\n03512|             services: data.services || []\n03513|           },\n03514|           requestData,\n03515|           responseData: data,\n03516|           apiUrl\n03517|         };\n03518|       } else {\n03519|         return {\n03520|           company: 'Nord Wheel',\n03521|           price: 0,\n03522|           days: 0,\n03523|           error: data.message || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ Nord Wheel - –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö',\n03524|           requestData,\n03525|           responseData: data,\n03526|           apiUrl\n03527|         };\n03528|       }\n03529|     } catch (error: any) {\n03530|       console.error('üöõ Nord Wheel –æ—à–∏–±–∫–∞:', error);\n03531|       return {\n03532|         company: 'Nord Wheel',\n03533|         price: 0,\n03534|         days: 0,\n03535|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03536|         apiUrl\n03537|       };\n03538|     }\n03539|   };\n03540|     const calculateCdek = async (): Promise<CalculationResult> => {\n03541|     const apiUrl = '/api/cdek';\n03542|     \n03543|     try {\n03544|       validateMultipleCargos(form.cargos);\n03545|       \n03546|       const packages = form.cargos.map(cargo => ({\n03547|         height: cargo.height,\n03548|         length: cargo.length,\n03549|         width: cargo.width,\n03550|         weight: cargo.weight * 1000\n03551|       }));\n03552| \n03553|       const requestData: any = {\n03554|         from_city: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n03555|         to_city: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n03556|         packages: packages\n03557|       };\n03558| \n03559|       if (form.needInsurance && form.declaredValue > 0) {\n03560|         requestData.services = [{\n03561|           code: 'INSURANCE',\n03562|           parameter: form.declaredValue\n03563|         }];\n03564|         console.log('üì¶ CDEK: –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ', form.declaredValue);\n03565|       }\n03566| \n03567|       console.log('üì¶ CDEK –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03568|       console.log('üì¶ CDEK –º–∞—Ä—à—Ä—É—Ç:', {\n03569|         fromAddressDelivery: form.fromAddressDelivery,\n03570|         fromLavsiteWarehouse: form.fromLavsiteWarehouse,\n03571|         toAddressDelivery: form.toAddressDelivery\n03572|       });\n03573| \n03574|        const result = await enhancedApiRequest(\n03575|          apiUrl,\n03576|          {\n03577|            method: 'POST',\n03578|            headers: {\n03579|              'Content-Type': 'application/json',\n03580|            },\n03581|            body: JSON.stringify(requestData)\n03582|          },\n03583|          { operation: 'calculate', company: '–°–î–≠–ö' }\n03584|        );\n03585| \n03586|        if (result && typeof result === 'object' && 'success' in result && !result.success) {\n03587|          console.error('‚ùå –°–î–≠–ö API –æ—à–∏–±–∫–∞:', result.error);\n03588|          return {\n03589|            company: '–°–î–≠–ö',\n03590|            price: 0,\n03591|            days: 0,\n03592|            error: result.error.userMessage || result.error.message,\n03593|            requestData,\n03594|            responseData: null,\n03595|            apiUrl\n03596|          };\n03597|        }\n03598| \n03599|        const response = result as Response;\n03600|        const data = await response.json();\n03601|        console.log('üì¶ CDEK –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω, —Ç–∞—Ä–∏—Ñ–æ–≤:', data.tariff_codes?.length || 0);\n03602| \n03603|       if (response.ok && data.tariff_codes && data.tariff_codes.length > 0) {\n03604|         const isFromDoor = form.fromAddressDelivery || form.fromLavsiteWarehouse;\n03605|         const isToDoor = form.toAddressDelivery;\n03606|         \n03607|         let deliveryMode: number;\n03608|         let deliveryModeText: string;\n03609|         \n03610|         if (isFromDoor && isToDoor) {\n03611|           deliveryMode = 1;\n03612|           deliveryModeText = '–¥–≤–µ—Ä—å-–¥–≤–µ—Ä—å';\n03613|         } else if (isFromDoor && !isToDoor) {\n03614|           deliveryMode = 2;\n03615|           deliveryModeText = '–¥–≤–µ—Ä—å-—Å–∫–ª–∞–¥';\n03616|         } else if (!isFromDoor && isToDoor) {\n03617|           deliveryMode = 3;\n03618|           deliveryModeText = '—Å–∫–ª–∞–¥-–¥–≤–µ—Ä—å';\n03619|         } else {\n03620|           deliveryMode = 4;\n03621|           deliveryModeText = '—Å–∫–ª–∞–¥-—Å–∫–ª–∞–¥';\n03622|         }\n03623| \n03624|         console.log(`üì¶ CDEK –≤—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º –¥–æ—Å—Ç–∞–≤–∫–∏: ${deliveryMode} (${deliveryModeText})`);\n03625| \n03626|         const filteredTariffs = data.tariff_codes.filter((t: any) => t.delivery_mode === deliveryMode);\n03627|         \n03628|         console.log(`üì¶ CDEK –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è —Ä–µ–∂–∏–º–∞ ${deliveryModeText}:`, filteredTariffs.length);\n03629| \n03630|         if (filteredTariffs.length === 0) {\n03631|           return {\n03632|             company: '–°–î–≠–ö',\n03633|             price: 0,\n03634|             days: 0,\n03635|             error: `–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∞ ${deliveryModeText}`,\n03636|             requestData,\n03637|             responseData: data,\n03638|             apiUrl\n03639|           };\n03640|         }\n03641| \n03642|         const bestTariff = filteredTariffs.reduce((min: any, tariff: any) => \n03643|           (tariff.delivery_sum < min.delivery_sum) ? tariff : min\n03644|         );\n03645| \n03646|         console.log(`üì¶ CDEK –ª—É—á—à–∏–π —Ç–∞—Ä–∏—Ñ: ${bestTariff.tariff_name} - ${bestTariff.delivery_sum}‚ÇΩ`);\n03647| \n03648|         const detailsRequest: any = {\n03649|           ...requestData,\n03650|           tariff_code: bestTariff.tariff_code,\n03651|           get_details: true\n03652|         };\n03653| \n03654|         console.log('üì¶ CDEK: –∑–∞–ø—Ä–æ—Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏...');\n03655| \n03656|           const detailsResult = await enhancedApiRequest(\n03657|             apiUrl,\n03658|             {\n03659|               method: 'POST',\n03660|               headers: {\n03661|                 'Content-Type': 'application/json',\n03662|               },\n03663|               body: JSON.stringify(detailsRequest)\n03664|             },\n03665|             { operation: 'tariff_details', company: '–°–î–≠–ö' }\n03666|           );\n03667| \n03668|           let tariffDetails: any = null;\n03669|           if (detailsResult && typeof detailsResult === 'object' && 'success' in detailsResult && detailsResult.success) {\n03670|             const detailsResponse = detailsResult as Response;\n03671|             if (detailsResponse.ok) {\n03672|               const detailsData = await detailsResponse.json();\n03673|               tariffDetails = detailsData.tariff_details;\n03674|               console.log('üì¶ –°–î–≠–ö –¥–µ—Ç–∞–ª–∏ —Ç–∞—Ä–∏—Ñ–∞:', tariffDetails);\n03675|             }\n03676|           }\n03677| \n03678|         const finalPrice = tariffDetails?.total_sum || bestTariff.delivery_sum;\n03679|         \n03680|         return {\n03681|           company: '–°–î–≠–ö',\n03682|           price: Math.round(finalPrice),\n03683|           days: bestTariff.period_max || 0,\n03684|           details: {\n03685|             tariff_name: bestTariff.tariff_name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n03686|             tariff_code: bestTariff.tariff_code,\n03687|             delivery_mode: deliveryModeText,\n03688|             period_min: bestTariff.period_min,\n03689|             period_max: bestTariff.period_max,\n03690|             calendar_min: bestTariff.calendar_min,\n03691|             calendar_max: bestTariff.calendar_max,\n03692|             all_tariffs: filteredTariffs,\n03693|             services: tariffDetails?.services || [],\n03694|             delivery_sum: tariffDetails?.delivery_sum || bestTariff.delivery_sum,\n03695|             total_sum: finalPrice,\n03696|             weight_calc: tariffDetails?.weight_calc\n03697|           },\n03698|           requestData,\n03699|           responseData: data,\n03700|           apiUrl\n03701|         };\n03702|       } else {\n03703|         return {\n03704|           company: '–°–î–≠–ö',\n03705|           price: 0,\n03706|           days: 0,\n03707|           error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –°–î–≠–ö',\n03708|           requestData,\n03709|           responseData: data,\n03710|           apiUrl\n03711|         };\n03712|       }\n03713|     } catch (error: any) {\n03714|       console.error('üì¶ –°–î–≠–ö –æ—à–∏–±–∫–∞:', error);\n03715|       return {\n03716|         company: '–°–î–≠–ö',\n03717|         price: 0,\n03718|         days: 0,\n03719|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03720|         apiUrl\n03721|       };\n03722|     }\n03723|   };\n03724| \n03725|   const calculateKit = async (): Promise<CalculationResult> => {\n03726|     const apiUrl = '/api/kit';\n03727|     \n03728|     try {\n03729|       validateMultipleCargos(form.cargos);\n03730|       \n03731|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n03732| \n03733|       const requestData = {\n03734|         from_city: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n03735|         to_city: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n03736|         declared_price: form.declaredValue || 10000,\n03737|         service: ['S089']\n03738|       };\n03739| \n03740|       console.log('üöõ –ö–ò–¢ –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03741| \n03742|        const result = await enhancedApiRequest(\n03743|          apiUrl,\n03744|          {\n03745|            method: 'POST',\n03746|            headers: {\n03747|              'Content-Type': 'application/json',\n03748|            },\n03749|            body: JSON.stringify(requestData)\n03750|          },\n03751|          { operation: 'calculate', company: '–ö–ò–¢' }\n03752|        );\n03753| \n03754|        if (result && typeof result === 'object' && 'success' in result && !result.success) {\n03755|          console.error('‚ùå –ö–ò–¢ API –æ—à–∏–±–∫–∞:', result.error);\n03756|          return {\n03757|            company: '–ö–ò–¢',\n03758|            price: 0,\n03759|            days: 0,\n03760|            error: result.error.userMessage || result.error.message,\n03761|            requestData,\n03762|            responseData: null,\n03763|            apiUrl\n03764|          };\n03765|        }\n03766| \n03767|        const response = result as Response;\n03768|        const data = await response.json();\n03769|        console.log('üöõ –ö–ò–¢ –æ—Ç–≤–µ—Ç:', data);\n03770| \n03771|       if (response.ok && Array.isArray(data) && data.length > 0) {\n03772|         const rubData = data.find((item: any) => {\n03773|           const tariffData: any = Object.values(item)[0];\n03774|           return tariffData?.currency_code === 'RUB';\n03775|         });\n03776|         \n03777|         if (rubData) {\n03778|           const tariffKey = Object.keys(rubData)[0];\n03779|           const tariffData: any = rubData[tariffKey];\n03780|           \n03781|           console.log('üöõ –ö–ò–¢ –≤—ã–±—Ä–∞–Ω —Ç–∞—Ä–∏—Ñ:', tariffKey, tariffData);\n03782| \n03783|           return {\n03784|             company: '–ö–ò–¢',\n03785|             price: Math.round(tariffData.cost || 0),\n03786|             days: tariffData.time || 0,\n03787|             details: {\n03788|               tariff_name: tariffData.name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n03789|               tariff_type: tariffKey,\n03790|               services: tariffData.detail || [],\n03791|               currency: tariffData.currency_code\n03792|             },\n03793|             requestData,\n03794|             responseData: data,\n03795|             apiUrl\n03796|           };\n03797|         }\n03798|       }\n03799| \n03800|       return {\n03801|         company: '–ö–ò–¢',\n03802|         price: 0,\n03803|         days: 0,\n03804|         error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –ö–ò–¢',\n03805|         requestData,\n03806|         responseData: data,\n03807|         apiUrl\n03808|       };\n03809|     } catch (error: any) {\n03810|       console.error('üöõ –ö–ò–¢ –æ—à–∏–±–∫–∞:', error);\n03811|       return {\n03812|         company: '–ö–ò–¢',\n03813|         price: 0,\n03814|         days: 0,\n03815|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03816|         apiUrl\n03817|       };\n03818|     }\n03819|   };\n03820| \n03821|   const handleCalculate = async () => {\n03822|     setCalculating(true);\n03823|     setCalculations([]);\n03824|     \n03825|     // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø–æ—Å–ª–µ —Ä–∞—Å—á–µ—Ç–∞ (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ, –±–µ–∑ –¥–µ–±–∞—É–Ω—Å–∞)\n03826|     saveFormData({\n03827|       cargos: form.cargos,\n03828|       fromCity: form.fromCity,\n03829|       toCity: form.toCity,\n03830|       fromAddress: form.fromAddress,\n03831|       toAddress: form.toAddress,\n03832|       declaredValue: form.declaredValue,\n03833|       needPackaging: form.needPackaging,\n03834|       needLoading: form.needLoading,\n03835|       needCarry: form.needCarry,\n03836|       floor: form.floor,\n03837|       hasFreightLift: form.hasFreightLift,\n03838|       needInsurance: form.needInsurance,\n03839|       fromTerminal: form.fromTerminal,\n03840|       toTerminal: form.toTerminal,\n03841|       fromAddressDelivery: form.fromAddressDelivery,\n03842|       toAddressDelivery: form.toAddressDelivery,\n03843|       selectedProducts: form.selectedProducts,\n03844|     });\n03845|     \n03846|     try {\n03847|       // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ —Ñ—É–Ω–∫—Ü–∏–π —Ä–∞—Å—á–µ—Ç–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n03848|       const calculationFunctions: Promise<CalculationResult>[] = [];\n03849|       \n03850|       if (enabledCompanies.dellin) {\n03851|         calculationFunctions.push(calculateDellin());\n03852|       }\n03853|       if (enabledCompanies.pek) {\n03854|         calculationFunctions.push(calculatePEK());\n03855|       }\n03856|       if (enabledCompanies.nordwheel) {\n03857|         calculationFunctions.push(calculateNordWheel());\n03858|       }\n03859|       if (enabledCompanies.railcontinent) {\n03860|         calculationFunctions.push(calculateRailContinent());\n03861|       }\n03862|       if (enabledCompanies.vozovoz) {\n03863|         calculationFunctions.push(calculateVozovoz());\n03864|       }\n03865|       if (enabledCompanies.cdek) {\n03866|         calculationFunctions.push(calculateCdek());\n03867|       }\n03868|       if (enabledCompanies.kit) {\n03869|         calculationFunctions.push(calculateKit());\n03870|       }\n03871|       \n03872|       // –ï—Å–ª–∏ –Ω–∏ –æ–¥–Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞\n03873|       if (calculationFunctions.length === 0) {\n03874|         setCalculations([]);\n03875|         return;\n03876|       }\n03877|       \n03878|       const results = await Promise.all(calculationFunctions);\n03879|       \n03880|       // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ü–µ–Ω–µ\n03881|       const sortedResults = results\n03882|         .filter(result => !result.error)\n03883|         .sort((a, b) => a.price - b.price)\n03884|         .concat(results.filter(result => result.error));\n03885|       \n03886|       setCalculations(sortedResults);\n03887|     } catch (error) {\n03888|       console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ:', error);\n03889|     } finally {\n03890|       setCalculating(false);\n03891|     }\n03892|   };\n03893| \n03894|   const exportToPDF = () => {\n03895|     if (typeof window !== 'undefined') {\n03896|       // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Å–µ –¥–µ—Ç–∞–ª–∏ –ø–µ—Ä–µ–¥ –ø–µ—á–∞—Ç—å—é\n03897|       const allExpanded = calculations.reduce((acc, calc) => {\n03898|         acc[calc.company] = true;\n03899|         return acc;\n03900|       }, {} as { [key: string]: boolean });\n03901|       \n03902|       setExpandedDetails(allExpanded);\n03903|       \n03904|       // –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DOM\n03905|       setTimeout(() => {\n03906|         window.print();\n03907|       }, 100);\n03908|     }\n03909|   };\n03910| \n03911|   const toggleDetails = (company: string) => {\n03912|     setExpandedDetails(prev => ({\n03913|       ...prev,\n03914|       [company]: !prev[company]\n03915|     }));\n03916|   };\n03917| \n03918|   const toggleDebugInfo = (company: string) => {\n03919|     setExpandedDebugInfo(prev => ({\n03920|       ...prev,\n03921|       [company]: !prev[company]\n03922|     }));\n03923|   };\n03924| \n03925|   // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞—Å—á–µ—Ç–∞\n03926|   const handleReset = () => {\n03927|     if (typeof window !== 'undefined') {\n03928|       // –û—á–∏—â–∞–µ–º localStorage\n03929|       localStorage.removeItem('deliveryForm');\n03930|       \n03931|       // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É\n03932|       setForm(initialFormState);\n03933|       \n03934|       // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è\n03935|       setCalculations([]);\n03936|       setExpandedDetails({});\n03937|       setExpandedDebugInfo({});\n03938|       setSuggestions([]);\n03939|       setShowSuggestions(false);\n03940|       setActiveField('');\n03941|       \n03942|       console.log('–§–æ—Ä–º–∞ —Å–±—Ä–æ—à–µ–Ω–∞ –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é');\n03943|     }\n03944|   };\n03945| \n03946|   // –ü–∞—Ä—Å–µ—Ä –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è —á–∏—Ç–∞–µ–º–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞\n03947|   const parseCalculationDetails = (calc: CalculationResult) => {\n03948|     console.log('üîç parseCalculationDetails –ø–æ–ª—É—á–∏–ª calc:', calc?.company || 'undefined');\n03949|     console.log('üîç calc.details:', calc?.details ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n03950|     console.log('üîç typeof calc.details:', typeof calc?.details);\n03951|     \n03952|     const details: { service: string; description: string; price: number }[] = [];\n03953|     \n03954|     try {\n03955|       if (calc.company === '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏' && calc.details) {\n03956|         console.log('üîç –ù–∞—á–∏–Ω–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–µ—Ç–∞–ª–µ–π –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π...');\n03957|       // –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ (—É–∂–µ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –±–∞–∑–æ–≤—ã–µ —É—Å–ª—É–≥–∏ –∏ —É–ø–∞–∫–æ–≤–∫—É)\n03958|       let basePrice = calc.details?.price || calc.price || 0;\n03959|       \n03960|       // –†–∞–∑–±–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ\n03961|       let intercityPrice = 0;\n03962|       let derivalPrice = 0;\n03963|       let arrivalPrice = 0;\n03964|       let packagingPrice = 0;\n03965|       // packagingPremiums –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è - –Ω–∞–¥–±–∞–≤–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ pkg.price\n03966|       let insurancePrice = 0;\n03967|       \n03968|       // –ú–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞\n03969|       if (calc.details?.intercity?.price) {\n03970|         intercityPrice = calc.details.intercity.price;\n03971|         details.push({\n03972|           service: '–ú–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞',\n03973|           description: `${form.fromCity} - ${form.toCity}`,\n03974|           price: intercityPrice\n03975|         });\n03976|       }\n03977|       \n03978|       // –ó–∞–±–æ—Ä –≥—Ä—É–∑–∞\n03979|       if (calc.details?.derival?.price) {\n03980|         derivalPrice = calc.details.derival.price;\n03981|         details.push({\n03982|           service: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n03983|           description: '–û—Ç –∞–¥—Ä–µ—Å–∞',\n03984|           price: derivalPrice\n03985|         });\n03986|       }\n03987|       \n03988|       // –î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞\n03989|       if (calc.details?.arrival?.price) {\n03990|         arrivalPrice = calc.details.arrival.price;\n03991|         details.push({\n03992|           service: '–û—Ç–≤–æ–∑ –≥—Ä—É–∑–∞',\n03993|           description: '–î–æ –∞–¥—Ä–µ—Å–∞',\n03994|           price: arrivalPrice\n03995|         });\n03996|       }\n03997|       \n03998|       // –£–ø–∞–∫–æ–≤–∫–∞ (–Ω–∞–¥–±–∞–≤–∫–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ pkg.price, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏)\n03999|       if (form.needPackaging && calc.details?.packages) {\n04000|         Object.entries(calc.details?.packages || {}).forEach(([key, pkg]: [string, any]) => {\n04001|           if (pkg.price && pkg.price > 0) {\n04002|             // –í—ã—á–∏—Å–ª—è–µ–º –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É —É–ø–∞–∫–æ–≤–∫–∏ (–±–µ–∑ –Ω–∞–¥–±–∞–≤–æ–∫) –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n04003|             let basePkgPrice = pkg.price;\n04004|             let totalPremiums = 0;\n04005|             \n04006|             if (pkg.premiumDetails && Array.isArray(pkg.premiumDetails)) {\n04007|               totalPremiums = pkg.premiumDetails.reduce((sum: number, premium: any) => \n04008|                 sum + (premium.value || 0), 0);\n04009|               basePkgPrice = pkg.price - totalPremiums;\n04010|             }\n04011|             \n04012|             packagingPrice += pkg.price; // –í –æ–±—â—É—é —Å—É–º–º—É –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–Ω—É—é —Ü–µ–Ω—É\n04013|             \n04014|             // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—É—é —É–ø–∞–∫–æ–≤–∫—É\n04015|             details.push({\n04016|               service: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n04017|               description: '–£–ø–∞–∫–æ–≤–∞—Ç—å –≤ –∫–æ–º–ø–ª–µ–∫—Å ¬´–æ–±—Ä–µ—à—ë—Ç–∫–∞ + –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è¬ª',\n04018|               price: basePkgPrice\n04019|             });\n04020|             \n04021|             // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–¥–±–∞–≤–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ (–¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏, –Ω–æ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –∫ –æ–±—â–µ–π —Å—É–º–º–µ)\n04022|             if (pkg.premiumDetails && Array.isArray(pkg.premiumDetails)) {\n04023|               pkg.premiumDetails.forEach((premium: any) => {\n04024|                 if (premium.value && premium.value > 0) {\n04025|                   details.push({\n04026|                     service: '–ù–∞–¥–±–∞–≤–∫–∞ –∫ —É–ø–∞–∫–æ–≤–∫–µ',\n04027|                     description: premium.name || '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–¥–±–∞–≤–∫–∞',\n04028|                     price: premium.value\n04029|                   });\n04030|                 }\n04031|               });\n04032|             }\n04033|           }\n04034|         });\n04035|       }\n04036|       \n04037|       // –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ\n04038|       if (form.needInsurance && calc.details?.insurance) {\n04039|         insurancePrice = calc.details.insurance;\n04040|         details.push({\n04041|           service: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n04042|           description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n04043|           price: insurancePrice\n04044|         });\n04045|       }\n04046|       \n04047|       // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏\n04048|       details.push({\n04049|         service: '–î–æ–ø.—É—Å–ª—É–≥–∏',\n04050|         description: '–ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ –≥—Ä—É–∑–∞',\n04051|         price: 15\n04052|       });\n04053|       \n04054|       // –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –º–µ–∂–¥—É —Å—É–º–º–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é, –¥–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞—Ç–æ–∫\n04055|       const calculatedSum = intercityPrice + derivalPrice + arrivalPrice + packagingPrice + insurancePrice + 15;\n04056|       const remainder = basePrice - calculatedSum;\n04057|       \n04058|       if (Math.abs(remainder) > 1) { // –ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –±–æ–ª—å—à–µ 1 —Ä—É–±–ª—è\n04059|         details.push({\n04060|           service: remainder > 0 ? '–ü—Ä–æ—á–∏–µ —É—Å–ª—É–≥–∏' : '–°–∫–∏–¥–∫–∞',\n04061|           description: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–±–æ—Ä—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏',\n04062|           price: remainder\n04063|         });\n04064|       }\n04065|     } else if (calc.company === 'Nord Wheel' && calc.details) {\n04066|       // –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –¥–ª—è Nord Wheel —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º\n04067|       if (calc.details.totalCost) {\n04068|         details.push({\n04069|           service: '–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',\n04070|           description: '',\n04071|           price: calc.details.totalCost\n04072|         });\n04073|       }\n04074|       if (calc.details.deliveryCost) {\n04075|         details.push({\n04076|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–∑–∫–∏',\n04077|           description: '',\n04078|           price: calc.details.deliveryCost\n04079|         });\n04080|       }\n04081|       if (calc.details.terminalCost) {\n04082|         details.push({\n04083|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –º–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–≤–æ–∑–∫–∏',\n04084|           description: '',\n04085|           price: calc.details.terminalCost\n04086|         });\n04087|       }\n04088|       if (calc.details.pickupCost) {\n04089|         details.push({\n04090|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–±–æ—Ä–∞',\n04091|           description: '',\n04092|           price: calc.details.pickupCost\n04093|         });\n04094|       }\n04095|       if (calc.details.deliveryToDoorCost) {\n04096|         details.push({\n04097|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–æ –¥–≤–µ—Ä–∏',\n04098|           description: '',\n04099|           price: calc.details.deliveryToDoorCost\n04100|         });\n04101|       }\n04102|       if (calc.details.additionalServices && calc.details.additionalServices > 0) {\n04103|         details.push({\n04104|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ–ø.—É—Å–ª—É–≥',\n04105|           description: '',\n04106|           price: calc.details.additionalServices\n04107|         });\n04108|       }\n04109| \n04110|     } else if (calc.company === '–ü–≠–ö' && calc.details?.services) {\n04111|       // –î–ª—è –ü–≠–ö –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ API\n04112|       calc.details.services.forEach((service: any) => {\n04113|         if (service.price > 0) {\n04114|           details.push({\n04115|             service: service.name || '–£—Å–ª—É–≥–∞ –ü–≠–ö',\n04116|             description: service.description || '',\n04117|             price: service.price\n04118|           });\n04119|         }\n04120|       });\n04121|     } else if (calc.company === '–°–î–≠–ö' && calc.details) {\n04122|       const cdekServiceNames: Record<string, string> = {\n04123|         'INSURANCE': '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n04124|         'HEAVY_CARGO': '–¢—è–∂–µ–ª–æ–≤–µ—Å–Ω—ã–π –≥—Ä—É–∑',\n04125|         'DELIVERY_TO_DOOR': '–î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –¥–≤–µ—Ä–∏',\n04126|         'PICKUP_FROM_SENDER': '–ó–∞–±–æ—Ä –æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è',\n04127|         'PACKAGE': '–£–ø–∞–∫–æ–≤–∫–∞',\n04128|         'TRYING_ON': '–ü—Ä–∏–º–µ—Ä–∫–∞ –Ω–∞ –¥–æ–º—É',\n04129|         'PART_DELIVERY': '–ß–∞—Å—Ç–∏—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞'\n04130|       };\n04131| \n04132|       if (calc.details.services && calc.details.services.length > 0) {\n04133|         calc.details.services.forEach((service: any) => {\n04134|           const serviceName = cdekServiceNames[service.code] || service.code || '–£—Å–ª—É–≥–∞ –°–î–≠–ö';\n04135|           const servicePrice = service.total_sum || service.sum || 0;\n04136|           \n04137|           if (servicePrice > 0) {\n04138|             details.push({\n04139|               service: serviceName,\n04140|               description: service.code === 'HEAVY_CARGO' \n04141|                 ? `–°–±–æ—Ä –∑–∞ –≥–∞–±–∞—Ä–∏—Ç–Ω—ã–π –≥—Ä—É–∑ (—Ä–∞—Å—á–µ—Ç–Ω—ã–π –≤–µ—Å: ${(calc.details.weight_calc / 1000).toFixed(0)} –∫–≥)`\n04142|                 : service.code === 'INSURANCE'\n04143|                 ? `–û–±—ä—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${form.declaredValue?.toLocaleString() || 0} ‚ÇΩ`\n04144|                 : '',\n04145|               price: servicePrice\n04146|             });\n04147|           }\n04148|         });\n04149|         \n04150|         if (calc.details.delivery_sum && calc.details.total_sum) {\n04151|           details.push({\n04152|             service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n04153|             description: '',\n04154|             price: 0\n04155|           });\n04156|           details.push({\n04157|             service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',\n04158|             description: calc.details.tariff_name || '–ü–µ—Ä–µ–≤–æ–∑–∫–∞',\n04159|             price: Math.round(calc.details.delivery_sum)\n04160|           });\n04161|           \n04162|           const additionalSum = calc.details.services.reduce((sum: number, s: any) => \n04163|             sum + (s.total_sum || s.sum || 0), 0\n04164|           );\n04165|           \n04166|           if (additionalSum > 0) {\n04167|             details.push({\n04168|               service: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏',\n04169|               description: '–î–æ–ø. —Å–±–æ—Ä—ã',\n04170|               price: Math.round(additionalSum)\n04171|             });\n04172|           }\n04173|           \n04174|           details.push({\n04175|             service: '–ò–¢–û–ì–û',\n04176|             description: '–ö –æ–ø–ª–∞—Ç–µ',\n04177|             price: Math.round(calc.details.total_sum)\n04178|           });\n04179|         }\n04180|       } else {\n04181|         details.push({\n04182|           service: '–¢–∞—Ä–∏—Ñ',\n04183|           description: calc.details.tariff_name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n04184|           price: calc.price\n04185|         });\n04186|         \n04187|         if (calc.details.delivery_mode) {\n04188|           details.push({\n04189|             service: '–†–µ–∂–∏–º –¥–æ—Å—Ç–∞–≤–∫–∏',\n04190|             description: calc.details.delivery_mode,\n04191|             price: 0\n04192|           });\n04193|         }\n04194|       }\n04195|       \n04196|       if (calc.details.period_min && calc.details.period_max) {\n04197|         details.push({\n04198|           service: '–°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏',\n04199|           description: `${calc.details.period_min}-${calc.details.period_max} –¥–Ω–µ–π`,\n04200|           price: 0\n04201|         });\n04202|       }\n04203|       \n04204|       if (calc.details.weight_calc) {\n04205|         details.push({\n04206|           service: '–†–∞—Å—á–µ—Ç–Ω—ã–π –≤–µ—Å',\n04207|           description: `${calc.details.weight_calc} –∫–≥`,\n04208|           price: 0\n04209|         });\n04210|       }\n04211|     } else if (calc.company === '–í–æ–∑–æ–≤–æ–∑' && calc.details?.service) {\n04212|       // ‚úÖ –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –í–æ–∑–æ–≤–æ–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ API –æ—Ç–≤–µ—Ç–∞\n04213|       const basePrice = calc.details.basePrice || 0;\n04214|       const finalPrice = calc.details.price || calc.price || 0;\n04215|       const totalDiscount = basePrice - finalPrice;\n04216|       \n04217|       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é —É—Å–ª—É–≥—É —Å –±–∞–∑–æ–≤–æ–π —Ü–µ–Ω–æ–π –∏ —Å–∫–∏–¥–∫–æ–π\n04218|       calc.details.service.forEach((service: any) => {\n04219|         const serviceDiscount = (service.basePrice || 0) - (service.price || 0);\n04220|         \n04221|         // –û—Å–Ω–æ–≤–Ω–∞—è —É—Å–ª—É–≥–∞\n04222|         details.push({\n04223|           service: service.name || '–£—Å–ª—É–≥–∞ –í–æ–∑–æ–≤–æ–∑',\n04224|           description: '',\n04225|           price: service.price || 0\n04226|         });\n04227|         \n04228|         // –°–∫–∏–¥–∫–∞ –Ω–∞ —É—Å–ª—É–≥—É (–µ—Å–ª–∏ –µ—Å—Ç—å)\n04229|         if (serviceDiscount > 0) {\n04230|           details.push({\n04231|             service: `–°–∫–∏–¥–∫–∞ –Ω–∞ ${service.name?.toLowerCase() || '—É—Å–ª—É–≥—É'}`,\n04232|             description: `${(service.basePrice || 0).toLocaleString()} - ${(service.price || 0).toLocaleString()}`,\n04233|             price: -serviceDiscount\n04234|           });\n04235|         }\n04236|       });\n04237|       \n04238|       // –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Å –æ–±—â–∏–º–∏ —Å–∫–∏–¥–∫–∞–º–∏\n04239|       if (totalDiscount > 0) {\n04240|         details.push({\n04241|           service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n04242|           description: '',\n04243|           price: 0\n04244|         });\n04245|         details.push({\n04246|           service: '–ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å',\n04247|           description: '–î–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–∫–∏–¥–æ–∫',\n04248|           price: basePrice\n04249|         });\n04250|         details.push({\n04251|           service: '–û–±—â–∏–µ —Å–∫–∏–¥–∫–∏',\n04252|           description: `–≠–∫–æ–Ω–æ–º–∏—è ${totalDiscount.toLocaleString()} ‚ÇΩ`,\n04253|           price: -totalDiscount\n04254|         });\n04255|         details.push({\n04256|           service: '–ò–¢–û–ì–û',\n04257|           description: '–ö –æ–ø–ª–∞—Ç–µ',\n04258|           price: finalPrice\n04259|         });\n04260|       }\n04261|     } else if (calc.company === '–ö–ò–¢' && calc.details?.services) {\n04262|       calc.details.services.forEach((service: any) => {\n04263|         details.push({\n04264|           service: service.name || '–£—Å–ª—É–≥–∞ –ö–ò–¢',\n04265|           description: service.code || '',\n04266|           price: service.price || 0\n04267|         });\n04268|       });\n04269|       \n04270|       if (calc.details.tariff_name) {\n04271|         details.push({\n04272|           service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n04273|           description: '',\n04274|           price: 0\n04275|         });\n04276|         details.push({\n04277|           service: '–¢–∞—Ä–∏—Ñ',\n04278|           description: calc.details.tariff_name,\n04279|           price: 0\n04280|         });\n04281|         details.push({\n04282|           service: '–ò–¢–û–ì–û',\n04283|           description: calc.details.currency || 'RUB',\n04284|           price: calc.price\n04285|         });\n04286|       }\n04287|     } else {\n04288|       // –î–ª—è –¥—Ä—É–≥–∏—Ö –¢–ö - –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n04289|       details.push({\n04290|         service: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n04291|         description: `${form.fromCity} - ${form.toCity}`,\n04292|         price: calc.price\n04293|       });\n04294|       \n04295|       if (form.needInsurance && form.declaredValue > 0) {\n04296|         details.push({\n04297|           service: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ',\n04298|           description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n04299|           price: Math.round(form.declaredValue * 0.02)\n04300|         });\n04301|       }\n04302|       \n04303|       if (form.needPackaging) {\n04304|         const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n04305|         details.push({\n04306|           service: '–£–ø–∞–∫–æ–≤–∫–∞',\n04307|           description: '',\n04308|           price: Math.round(totalWeight * 30)\n04309|         });\n04310|       }\n04311|     }\n04312|     \n04313|     return details;\n04314|   } catch (globalError) {\n04315|     console.error('‚ùå –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –û–®–ò–ë–ö–ê –≤ parseCalculationDetails:', globalError);\n04316|     console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', globalError instanceof Error ? globalError.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n04317|     console.log('‚ùå calc object:', calc);\n04318|     // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ\n04319|     return [{\n04320|       service: '–î–æ—Å—Ç–∞–≤–∫–∞',\n04321|       description: '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞',\n04322|       price: calc?.price || 0\n04323|     }];\n04324|   }\n04325| };\n04326| \n04327|   // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –ø–æ–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏)\n04328|   if (!isLoaded) {\n04329|     return (\n04330|       <div className=\"min-h-screen bg-gray-900 text-white p-4 relative flex items-center justify-center\">\n04331|         <div className=\"text-center\">\n04332|           <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400 mx-auto mb-4\"></div>\n04333|           <p className=\"text-blue-400\">–ó–∞–≥—Ä—É–∑–∫–∞...</p>\n04334|         </div>\n04335|       </div>\n04336|     );\n04337|   }\n04338| \n04339|   return (\n04340|     <div className=\"min-h-screen bg-gray-900 text-white p-4 relative\">\n04341|       <div className=\"max-w-7xl mx-auto\">\n04342|         <div className=\"flex items-center justify-between mb-3\">\n04343|           <h1 className=\"text-xl font-bold text-blue-400\">\n04344|             –ú–µ–∂–¥—É–≥–æ—Ä–æ–¥–Ω—è—è –¥–æ—Å—Ç–∞–≤–∫–∞ –õ–∞–≤—Å–∏—Ç\n04345|           </h1>\n04346|           \n04347|           {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è */}\n04348|           <div className=\"flex items-center gap-4\">\n04349|             {isFormChanged ? (\n04350|               <div className=\"flex items-center gap-2 text-yellow-400 text-sm\">\n04351|                 <div className=\"w-2 h-2 bg-yellow-400 rounded-full animate-pulse\"></div>\n04352|                 –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...\n04353|               </div>\n04354|             ) : lastSaveTime ? (\n04355|               <div className=\"flex items-center gap-2 text-green-400 text-sm\">\n04356|                 <div className=\"w-2 h-2 bg-green-400 rounded-full\"></div>\n04357|                 –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ {lastSaveTime.toLocaleTimeString()}\n04358|               </div>\n04359|             ) : hasStoredFormData() ? (\n04360|               <div className=\"flex items-center gap-2 text-blue-400 text-sm\">\n04361|                 <div className=\"w-2 h-2 bg-blue-400 rounded-full\"></div>\n04362|                 –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã\n04363|               </div>\n04364|             ) : null}\n04365|             \n04366|             {/* –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö */}\n04367|             {hasStoredFormData() && (\n04368|               <Button\n04369|                 onClick={() => {\n04370|                   if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã?')) {\n04371|                     clearFormData();\n04372|                     setForm(initialFormState);\n04373|                     setLastSaveTime(null);\n04374|                     setIsFormChanged(false);\n04375|                   }\n04376|                 }}\n04377|                 variant=\"outline\"\n04378|                 size=\"sm\"\n04379|                 className=\"border-red-500 text-red-400 hover:bg-red-900/20\"\n04380|               >\n04381|                 <Trash2 className=\"h-3 w-3 mr-1\" />\n04382|                 –û—á–∏—Å—Ç–∏—Ç—å\n04383|               </Button>\n04384|             )}\n04385|           </div>\n04386|         </div>\n04387|         \n04388|         {/* –ö–Ω–æ–ø–∫–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ */}\n04389|         <div className=\"flex justify-end gap-2 mb-4\">\n04390|           <Button \n04391|             onClick={() => window.open('/diagnostic?tab=api', '_blank')}\n04392|             variant=\"outline\" \n04393|             className=\"border-green-500 text-green-400 hover:bg-green-900/20\"\n04394|           >\n04395|             <Settings className=\"h-4 w-4 mr-2\" />\n04396|             –í—Å–µ API\n04397|           </Button>\n04398|           <Button \n04399|             onClick={() => window.open('/diagnostic?tab=docs', '_blank')}\n04400|             variant=\"outline\" \n04401|             className=\"border-purple-500 text-purple-400 hover:bg-purple-900/20\"\n04402|           >\n04403|             <Package2 className=\"h-4 w-4 mr-2\" />\n04404|             –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è\n04405|           </Button>\n04406|           <Button \n04407|             onClick={() => window.open('/diagnostic', '_blank')}\n04408|             variant=\"outline\" \n04409|             className=\"border-blue-500 text-blue-400 hover:bg-blue-900/20\"\n04410|           >\n04411|             <Settings className=\"h-4 w-4 mr-2\" />\n04412|             –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞\n04413|           </Button>\n04414|         </div>\n04415|         \n04416|         <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-3 h-[85vh]\">\n04417|           {/* –õ–µ–≤–∞—è —á–∞—Å—Ç—å - —Ñ–æ—Ä–º–∞ */}\n04418|           <div className=\"space-y-2 overflow-y-auto pr-2\">\n04419|             {/* –ö–∞—Ç–∞–ª–æ–≥ –º–µ–±–µ–ª–∏ */}\n04420|             <Card className=\"bg-gray-800 border-gray-700\">\n04421|               <CardHeader className=\"pb-2\">\n04422|                 <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n04423|                   <Package2 className=\"h-3 w-3\" />\n04424|                   –ö–∞—Ç–∞–ª–æ–≥ –º–µ–±–µ–ª–∏\n04425|                 </CardTitle>\n04426|               </CardHeader>\n04427|               <CardContent className=\"space-y-2\">\n04428|                 {/* –ü–æ–∏—Å–∫ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ */}\n04429|                 <ProductSearch \n04430|                   onProductAdd={handleProductAdd}\n04431|                   disabled={calculating}\n04432|                 />\n04433|                 \n04434|                 {/* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏ */}\n04435|                 <ProductManager\n04436|                   products={form.selectedProducts}\n04437|                   onQuantityChange={handleProductQuantityChange}\n04438|                   onProductRemove={handleProductRemove}\n04439|                   disabled={calculating}\n04440|                 />\n04441|               </CardContent>\n04442|             </Card>\n04443| \n04444|             {/* –ì—Ä—É–∑—ã */}\n04445|             <Card className=\"bg-gray-800 border-gray-700\">\n04446|               <CardHeader className=\"pb-2\">\n04447|                 <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n04448|                   <Truck className=\"h-3 w-3\" />\n04449|                   –ì—Ä—É–∑—ã\n04450|                 </CardTitle>\n04451|               </CardHeader>\n04452|               <CardContent className=\"space-y-2\">\n04453|                 {groupCargosForDisplay(form.cargos).map((group, groupIndex) => (\n04454|                    <div key={`group_${groupIndex}`} className=\"border border-gray-600 rounded p-2\">\n04455|                     <div className=\"flex justify-between items-center mb-2\">\n04456|                       <h4 className=\"text-sm font-medium text-white\">\n04457|                         {group.isEmpty ? (\n04458|                           `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1}`\n04459|                         ) : group.quantity === 1 ? (\n04460|                           `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1}`\n04461|                         ) : (\n04462|                           `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1} - ${group.quantity} –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –º–µ—Å—Ç–∞`\n04463|                         )}\n04464|                       </h4>\n04465|                       {form.cargos.length > 1 && group.quantity === 1 && (\n04466|                         <Button\n04467|                           variant=\"destructive\"\n04468|                           size=\"sm\"\n04469|                           onClick={() => removeCargo(form.cargos[group.indices[0]].id)}\n04470|                           className=\"h-6 text-xs\"\n04471|                         >\n04472|                           –£–¥–∞–ª–∏—Ç—å\n04473|                         </Button>\n04474|                       )}\n04475|                       {group.quantity > 1 && (\n04476|                         <Badge variant=\"secondary\" className=\"text-xs\">\n04477|                           {group.quantity} —à—Ç.\n04478|                         </Badge>\n04479|                       )}\n04480|                     </div>\n04481|                     \n04482|                     {group.isEmpty || group.quantity === 1 ? (\n04483|                       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞ –¥–ª—è –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ –∏–ª–∏ –µ–¥–∏–Ω–∏—á–Ω—ã—Ö\n04484|                       <div className=\"grid grid-cols-2 gap-2\">\n04485|                         <div>\n04486|                           <Label className=\"text-white text-xs\">–î–ª–∏–Ω–∞ (—Å–º)</Label>\n04487|                           <Input\n04488|                             type=\"number\"\n04489|                             value={form.cargos[group.indices[0]].length || ''}\n04490|                             onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'length', Number(e.target.value))}\n04491|                             className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n04492|                           />\n04493|                         </div>\n04494|                         <div>\n04495|                           <Label className=\"text-white text-xs\">–®–∏—Ä–∏–Ω–∞ (—Å–º)</Label>\n04496|                           <Input\n04497|                             type=\"number\"\n04498|                             value={form.cargos[group.indices[0]].width || ''}\n04499|                             onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'width', Number(e.target.value))}\n04500|                             className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n04501|                           />\n04502|                         </div>\n04503|                         <div>\n04504|                           <Label className=\"text-white text-xs\">–í—ã—Å–æ—Ç–∞ (—Å–º)</Label>\n04505|                           <Input\n04506|                             type=\"number\"\n04507|                             value={form.cargos[group.indices[0]].height || ''}\n04508|                             onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'height', Number(e.target.value))}\n04509|                             className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n04510|                           />\n04511|                         </div>\n04512|                         <div>\n04513|                           <Label className=\"text-white text-xs\">–í–µ—Å (–∫–≥)</Label>\n04514|                           <Input\n04515|                             type=\"number\"\n04516|                             value={form.cargos[group.indices[0]].weight || ''}\n04517|                             onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'weight', Number(e.target.value))}\n04518|                             className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n04519|                           />\n04520|                         </div>\n04521|                       </div>\n04522|                     ) : (\n04523|                       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –≥—Ä—É–ø–ø\n04524|                       <div className=\"grid grid-cols-2 gap-2 text-sm text-gray-300\">\n04525|                         <div>–î–ª–∏–Ω–∞: {group.length} —Å–º</div>\n04526|                         <div>–®–∏—Ä–∏–Ω–∞: {group.width} —Å–º</div>\n04527|                         <div>–í—ã—Å–æ—Ç–∞: {group.height} —Å–º</div>\n04528|                         <div>–í–µ—Å: {group.weight} –∫–≥</div>\n04529|                         <div className=\"col-span-2 text-xs text-blue-300 mt-1\">\n04530|                           –û–±—â–∏–π –≤–µ—Å: {(group.weight * group.quantity).toFixed(1)} –∫–≥, \n04531|                           –æ–±—ä–µ–º: {((group.length * group.width * group.height * group.quantity) / 1000000).toFixed(3)} –º¬≥\n04532|                         </div>\n04533|                       </div>\n04534|                     )}\n04535|                   </div>\n04536|                 ))}\n04537|                  <Button onClick={addCargo} className=\"w-full h-7 text-xs\" variant=\"outline\">\n04538|                   <Plus className=\"h-3 w-3 mr-1\" />\n04539|                   –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–∑\n04540|                 </Button>\n04541|               </CardContent>\n04542|             </Card>\n04543| \n04544|             {/* –ú–∞—Ä—à—Ä—É—Ç */}\n04545|             <Card className=\"bg-gray-800 border-gray-700\">\n04546|               <CardHeader className=\"pb-2\">\n04547|                 <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n04548|                   <Map className=\"h-3 w-3\" />\n04549|                   –ú–∞—Ä—à—Ä—É—Ç\n04550|                 </CardTitle>\n04551|               </CardHeader>\n04552|               <CardContent className=\"space-y-2\">\n04553|                 {/* –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */}\n04554|                 <div className=\"space-y-2\">\n04555|                   <Label className=\"text-sm font-medium text-white\">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</Label>\n04556|                   <div className=\"flex gap-3 flex-wrap\">\n04557|                     <label className=\"flex items-center space-x-1\">\n04558|                       <input\n04559|                         type=\"radio\"\n04560|                         name=\"fromDelivery\"\n04561|                         checked={form.fromTerminal}\n04562|                         onChange={() => setForm(prev => ({ ...prev, fromTerminal: true, fromAddressDelivery: false, fromLavsiteWarehouse: false }))}\n04563|                       />\n04564|                       <span className=\"text-white text-xs\">–û—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞</span>\n04565|                     </label>\n04566|                     <label className=\"flex items-center space-x-1\">\n04567|                       <input\n04568|                         type=\"radio\"\n04569|                         name=\"fromDelivery\"\n04570|                         checked={form.fromAddressDelivery && !form.fromLavsiteWarehouse}\n04571|                         onChange={() => setForm(prev => ({ ...prev, fromTerminal: false, fromAddressDelivery: true, fromLavsiteWarehouse: false }))}\n04572|                       />\n04573|                       <span className=\"text-white text-xs\">–û—Ç –∞–¥—Ä–µ—Å–∞</span>\n04574|                     </label>\n04575|                     <label className=\"flex items-center space-x-1\">\n04576|                       <Checkbox\n04577|                         id=\"lavsiteWarehouse\"\n04578|                         checked={form.fromLavsiteWarehouse}\n04579|                         onCheckedChange={handleLavsiteWarehouseChange}\n04580|                       />\n04581|                       <span className=\"text-white text-xs cursor-pointer\">–°–æ —Å–∫–ª–∞–¥–∞ –õ–∞–≤—Å–∏—Ç</span>\n04582|                     </label>\n04583|                   </div>\n04584|                   \n04585|                   <div>\n04586|                     <Label className=\"text-white text-xs\">–ì–æ—Ä–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</Label>\n04587|                     <Input\n04588|                       value={form.fromCity}\n04589|                       onChange={(e) => !form.fromLavsiteWarehouse && handleAddressChange('fromCity', e.target.value, e.target)}\n04590|                       placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –≥–æ—Ä–æ–¥\"\n04591|                       disabled={form.fromLavsiteWarehouse}\n04592|                       className={`bg-gray-700 border-gray-600 h-7 text-white text-xs ${form.fromLavsiteWarehouse ? 'opacity-50 cursor-not-allowed' : ''}`}\n04593|                     />\n04594|                   </div>\n04595|                   \n04596|                   {form.fromAddressDelivery && (\n04597|                     <div>\n04598|                       <Label className=\"text-white text-xs\">–ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</Label>\n04599|                       <Input\n04600|                         value={form.fromAddress}\n04601|                         onChange={(e) => !form.fromLavsiteWarehouse && handleAddressChange('fromAddress', e.target.value, e.target)}\n04602|                         placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å\"\n04603|                         disabled={form.fromLavsiteWarehouse}\n04604|                         className={`bg-gray-700 border-gray-600 h-7 text-white text-xs ${form.fromLavsiteWarehouse ? 'opacity-50 cursor-not-allowed' : ''}`}\n04605|                       />\n04606|                     </div>\n04607|                   )}\n04608|                 </div>\n04609| \n04610|                 {/* –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ */}\n04611|                 <div className=\"space-y-2\">\n04612|                   <Label className=\"text-sm font-medium text-white\">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</Label>\n04613|                   <div className=\"flex gap-3 flex-wrap\">\n04614|                     <label className=\"flex items-center space-x-1\">\n04615|                       <input\n04616|                         type=\"radio\"\n04617|                         name=\"toDelivery\"\n04618|                         checked={form.toTerminal}\n04619|                         onChange={() => setForm(prev => ({ ...prev, toTerminal: true, toAddressDelivery: false }))}\n04620|                       />\n04621|                       <span className=\"text-white text-xs\">–î–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞</span>\n04622|                     </label>\n04623|                     <label className=\"flex items-center space-x-1\">\n04624|                       <input\n04625|                         type=\"radio\"\n04626|                         name=\"toDelivery\"\n04627|                         checked={form.toAddressDelivery}\n04628|                         onChange={() => setForm(prev => ({ ...prev, toTerminal: false, toAddressDelivery: true }))}\n04629|                       />\n04630|                       <span className=\"text-white text-xs\">–î–æ –∞–¥—Ä–µ—Å–∞</span>\n04631|                     </label>\n04632|                   </div>\n04633|                   \n04634|                   <div>\n04635|                     <Label className=\"text-white text-xs\">–ì–æ—Ä–æ–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</Label>\n04636|                     <Input\n04637|                       value={form.toCity}\n04638|                       onChange={(e) => handleAddressChange('toCity', e.target.value, e.target)}\n04639|                       placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –≥–æ—Ä–æ–¥\"\n04640|                       className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n04641|                     />\n04642|                   </div>\n04643|                   \n04644|                   {form.toAddressDelivery && (\n04645|                     <div>\n04646|                       <Label className=\"text-white text-xs\">–ê–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</Label>\n04647|                       <Input\n04648|                         value={form.toAddress}\n04649|                         onChange={(e) => handleAddressChange('toAddress', e.target.value, e.target)}\n04650|                         placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å\"\n04651|                         className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n04652|                       />\n04653|                     </div>\n04654|                   )}\n04655|                 </div>\n04656| \n04657|                 <div>\n04658|                   <Label className=\"text-white text-xs\">–û–±—ä—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (—Ä—É–±.)</Label>\n04659|                   <Input\n04660|                     type=\"number\"\n04661|                     value={form.declaredValue || ''}\n04662|                     onChange={(e) => setForm(prev => ({ ...prev, declaredValue: Number(e.target.value) }))}\n04663|                     className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n04664|                   />\n04665|                 </div>\n04666|                 \n04667|                 <div className=\"space-y-2\">\n04668|                   <div className=\"flex items-center space-x-2\">\n04669|                     <Checkbox\n04670|                       id=\"packaging\"\n04671|                       checked={form.needPackaging}\n04672|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needPackaging: checked as boolean }))}\n04673|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n04674|                     />\n04675|                     <Label htmlFor=\"packaging\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è —É–ø–∞–∫–æ–≤–∫–∞</Label>\n04676|                   </div>\n04677|                   \n04678|                   <div className=\"flex items-center space-x-2\">\n04679|                     <Checkbox\n04680|                       id=\"insurance\"\n04681|                       checked={form.needInsurance}\n04682|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needInsurance: checked as boolean }))}\n04683|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n04684|                     />\n04685|                     <Label htmlFor=\"insurance\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞</Label>\n04686|                   </div>\n04687|                   \n04688|                   <div className=\"flex items-center space-x-2\">\n04689|                     <Checkbox\n04690|                       id=\"loading\"\n04691|                       checked={form.needLoading}\n04692|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needLoading: checked as boolean }))}\n04693|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n04694|                     />\n04695|                     <Label htmlFor=\"loading\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≥—Ä—É–∑–∫–∞/—Ä–∞–∑–≥—Ä—É–∑–∫–∞</Label>\n04696|                   </div>\n04697|                   \n04698|                   <div className=\"flex items-center space-x-2\">\n04699|                     <Checkbox\n04700|                       id=\"carry\"\n04701|                       checked={form.needCarry}\n04702|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needCarry: checked as boolean }))}\n04703|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n04704|                     />\n04705|                     <Label htmlFor=\"carry\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—ä–µ–º</Label>\n04706|                   </div>\n04707|                   \n04708|                   {form.needCarry && (\n04709|                     <div className=\"ml-6 space-y-2 border-l-2 border-gray-600 pl-3\">\n04710|                       <div>\n04711|                         <Label className=\"text-white text-xs\">–≠—Ç–∞–∂</Label>\n04712|                         <Input\n04713|                           type=\"number\"\n04714|                           value={form.floor}\n04715|                           onChange={(e) => setForm(prev => ({ ...prev, floor: Number(e.target.value) }))}\n04716|                           className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n04717|                         />\n04718|                       </div>\n04719|                       <div className=\"flex items-center space-x-2\">\n04720|                         <Checkbox\n04721|                           id=\"freightLift\"\n04722|                           checked={form.hasFreightLift}\n04723|                           onCheckedChange={(checked) => setForm(prev => ({ ...prev, hasFreightLift: checked as boolean }))}\n04724|                         />\n04725|                         <Label htmlFor=\"freightLift\" className=\"text-white text-xs\">–ù–∞–ª–∏—á–∏–µ –≥—Ä—É–∑–æ–≤–æ–≥–æ –ª–∏—Ñ—Ç–∞</Label>\n04726|                       </div>\n04727|                     </div>\n04728|                   )}\n04729|                 </div>\n04730|                 \n04731|                 <div className=\"space-y-2\">\n04732|                   <Button \n04733|                     onClick={handleCalculate} \n04734|                     className=\"w-full bg-blue-600 hover:bg-blue-700 h-7 text-xs\" \n04735|                     disabled={calculating}\n04736|                   >\n04737|                     {calculating ? '–†–∞—Å—á–µ—Ç...' : '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å'}\n04738|                   </Button>\n04739|                   \n04740|                   <Button \n04741|                     onClick={handleReset} \n04742|                     variant=\"outline\" \n04743|                     className=\"w-full h-7 text-xs text-black border-gray-600 hover:bg-gray-700 hover:text-white\" \n04744|                     disabled={calculating}\n04745|                   >\n04746|                     –°–±—Ä–æ—Å–∏—Ç—å —Ä–∞—Å—á–µ—Ç\n04747|                   </Button>\n04748|                 </div>\n04749|               </CardContent>\n04750|             </Card>\n04751|           </div>\n04752| \n04753|           {/* –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã */}\n04754|           <div className=\"space-y-2 overflow-y-auto\">\n04755|             {calculations.length > 0 && (\n04756|                  <div className=\"space-y-2\">\n04757|                 <div className=\"flex justify-between items-center\">\n04758|                   <h2 className=\"text-lg font-bold text-blue-400\">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞</h2>\n04759|                   <Button \n04760|                     onClick={exportToPDF} \n04761|                     variant=\"outline\" \n04762|                     size=\"sm\" \n04763|                     className=\"h-7 text-xs border-blue-500 text-blue-400 hover:bg-blue-900/20 print:hidden\"\n04764|                   >\n04765|                     –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ PDF\n04766|                   </Button>\n04767|                 </div>\n04768|                 \n04769|                 {calculations.map((calc, index) => (\n04770|                    <Card key={index} className=\"bg-gray-800 border-gray-700 text-xs\">\n04771|                      <CardHeader className=\"pb-1\">\n04772|                       <div className=\"flex justify-between items-center\">\n04773|                          <CardTitle className=\"text-white flex items-center gap-2 text-xs\">\n04774|                            <Building2 className=\"h-3 w-3\" />\n04775|                           {calc.company}\n04776|                         </CardTitle>\n04777|                         {calc.error ? (\n04778|                           <Badge variant=\"destructive\" className=\"text-xs\">–û—à–∏–±–∫–∞</Badge>\n04779|                         ) : (\n04780|                           <Badge variant=\"default\" className=\"bg-green-600 text-xs\">\n04781|                             {calc.price.toLocaleString()} ‚ÇΩ\n04782|                           </Badge>\n04783|                         )}\n04784|                       </div>\n04785|                     </CardHeader>\n04786|                     <CardContent className=\"pt-0\">\n04787|                       <div className=\"space-y-2\">\n04788|                         {calc.error ? (\n04789|                           <div className=\"space-y-2\">\n04790|                             <Alert className=\"border-red-600\">\n04791|                               <AlertDescription className=\"text-white text-xs\">{calc.error}</AlertDescription>\n04792|                             </Alert>\n04793|                             {calc.price > 0 && (\n04794|                               <>\n04795|                                 <p className=\"text-white text-xs\"><strong>–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {calc.price.toLocaleString()} ‚ÇΩ</p>\n04796|                                 <p className=\"text-white text-xs\"><strong>–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Å—Ä–æ–∫:</strong> {calc.days} –¥–Ω–µ–π</p>\n04797|                               </>\n04798|                             )}\n04799|                           </div>\n04800|                         ) : (\n04801|                           <>\n04802|                             <p className=\"text-white text-xs\"><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {calc.price.toLocaleString()} ‚ÇΩ</p>\n04803|                             <p className=\"text-white text-xs\"><strong>–°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> {calc.days} –¥–Ω–µ–π</p>\n04804|                           </>\n04805|                         )}\n04806|                         \n04807|                         <div className=\"flex gap-2 mt-2\">\n04808|                           {!calc.error && (\n04809|                             <Button\n04810|                               variant=\"outline\"\n04811|                               size=\"sm\"\n04812|                               onClick={() => toggleDetails(calc.company)}\n04813|                               className=\"h-6 text-xs\"\n04814|                             >\n04815|                               {expandedDetails[calc.company] ? '–°–∫—Ä—ã—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ' : '–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ'}\n04816|                             </Button>\n04817|                           )}\n04818|                           <Button\n04819|                             variant=\"outline\"\n04820|                             size=\"sm\"\n04821|                             onClick={() => toggleDebugInfo(calc.company)}\n04822|                             className=\"h-6 text-xs\"\n04823|                           >\n04824|                             {expandedDebugInfo[calc.company] ? '–°–∫—Ä—ã—Ç—å –æ—Ç–ª–∞–¥–∫—É' : '–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'}\n04825|                           </Button>\n04826|                         </div>\n04827|                         \n04828|                         {/* –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ */}\n04829|                         {!calc.error && (\n04830|                           <Collapsible open={expandedDetails[calc.company]}>\n04831|                             <CollapsibleContent className=\"mt-2\">\n04832|                               <div className=\"bg-gray-900 p-3 rounded text-xs\">\n04833|                                 <h4 className=\"font-bold mb-2 text-white\">–î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞:</h4>\n04834|                                 {(() => {\n04835|                                   const details = parseCalculationDetails(calc);\n04836|                                   const totalPrice = details.reduce((sum, detail) => sum + detail.price, 0);\n04837|                                   \n04838|                                   return (\n04839|                                     <div className=\"space-y-1\">\n04840|                                       {details.map((detail, idx) => (\n04841|                                         <div key={idx} className=\"flex justify-between text-white\">\n04842|                                           <div>\n04843|                                             <div className=\"font-medium\">{detail.service}</div>\n04844|                                             {detail.description && (\n04845|                                               <div className=\"text-gray-400 text-xs\">{detail.description}</div>\n04846|                                             )}\n04847|                                           </div>\n04848|                                           <div className=\"font-medium\">{detail.price.toLocaleString()} ‚ÇΩ</div>\n04849|                                         </div>\n04850|                                       ))}\n04851|                                     </div>\n04852|                                   );\n04853|                                 })()}\n04854|                               </div>\n04855|                             </CollapsibleContent>\n04856|                           </Collapsible>\n04857|                         )}\n04858|                         \n04859|                         {/* –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è - –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ */}\n04860|                         <Collapsible open={expandedDebugInfo[calc.company]}>\n04861|                           <CollapsibleContent className=\"mt-2\">\n04862|                             <div className=\"bg-gray-900 p-3 rounded text-xs\">\n04863|                               <h4 className=\"font-bold mb-2 text-white\">–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h4>\n04864|                               \n04865|                               {calc.apiUrl && (\n04866|                                 <div className=\"mb-3\">\n04867|                                   <h5 className=\"font-bold mb-1 text-white\">–ó–∞–ø—Ä–æ—Å –∫ API:</h5>\n04868|                                   <p className=\"text-gray-300 break-all text-xs\">URL: {calc.apiUrl}</p>\n04869|                                 </div>\n04870|                               )}\n04871|                               \n04872|                               {calc.sessionId && (\n04873|                                 <div className=\"mb-3\">\n04874|                                   <h5 className=\"font-bold mb-1 text-white\">Session ID:</h5>\n04875|                                   <p className=\"text-gray-300 text-xs\">{calc.sessionId}</p>\n04876|                                 </div>\n04877|                               )}\n04878|                               \n04879|                               {calc.requestData && (\n04880|                                 <div className=\"mb-3\">\n04881|                                   <h5 className=\"font-bold mb-1 text-white\">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å:</h5>\n04882|                                   <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n04883|                                     {JSON.stringify(calc.requestData, null, 2)}\n04884|                                   </pre>\n04885|                                 </div>\n04886|                               )}\n04887|                               \n04888|                               {calc.responseData && (\n04889|                                 <div className=\"mb-3\">\n04890|                                   <h5 className=\"font-bold mb-1 text-white\">–ü–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç:</h5>\n04891|                                   <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n04892|                                     {JSON.stringify(calc.responseData, null, 2)}\n04893|                                   </pre>\n04894|                                 </div>\n04895|                               )}\n04896|                               \n04897|                               {calc.details && (\n04898|                                 <div className=\"mb-3\">\n04899|                                   <h5 className=\"font-bold mb-1 text-white\">–î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ (JSON):</h5>\n04900|                                   <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n04901|                                     {JSON.stringify(calc.details, null, 2)}\n04902|                                   </pre>\n04903|                                 </div>\n04904|                               )}\n04905|                               \n04906|                               {calc.error && (\n04907|                                 <div className=\"mb-3\">\n04908|                                   <h5 className=\"font-bold mb-1 text-red-400\">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ:</h5>\n04909|                                   <p className=\"text-red-300 text-xs\">{calc.error}</p>\n04910|                                 </div>\n04911|                               )}\n04912|                             </div>\n04913|                           </CollapsibleContent>\n04914|                         </Collapsible>\n04915|                       </div>\n04916|                     </CardContent>\n04917|                   </Card>\n04918|                 ))}\n04919|               </div>\n04920|             )}\n04921| \n04922|             {/* –°–ø–∏—Å–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –¢–ö - –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º—ã–π */}\n04923|             <Card className=\"bg-gray-800 border-gray-700\">\n04924|               <CardHeader className=\"pb-2\">\n04925|                 <CardTitle className=\"text-white text-sm\">\n04926|                   –ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ ({COMPANIES_BASE.length})\n04927|                 </CardTitle>\n04928|               </CardHeader>\n04929|               <CardContent>\n04930|                 <div className=\"grid grid-cols-2 gap-2\">\n04931|                   {COMPANIES_BASE.map((company, index) => {\n04932|                     const isConnected = apiStatus[company.apiKey as keyof typeof apiStatus] === '–ø–æ–¥–∫–ª—é—á–µ–Ω–æ';\n04933|                     const statusText = apiStatus[company.apiKey as keyof typeof apiStatus];\n04934|                     const isEnabled = enabledCompanies[company.apiKey];\n04935|                     \n04936|                     // –û—Ç–ª–∞–¥–∫–∞ –¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–æ–º–ø–∞–Ω–∏–π\n04937|                     if (index < 3) {\n04938|                       console.log(`üîç –ö–æ–º–ø–∞–Ω–∏—è ${index}: ${company.name}, apiKey: ${company.apiKey}, isEnabled: ${isEnabled}, statusText: ${statusText}`);\n04939|                     }\n04940|                     \n04941|                     return (\n04942|                       <div key={index} className=\"flex items-center justify-between p-1.5 bg-gray-700 rounded\">\n04943|                         <div className=\"flex items-center gap-2\">\n04944|                           <span className=\"text-lg\">{company.logo}</span>\n04945|                           <div>\n04946|                             <p className=\"font-medium text-white text-[10px] leading-tight\">{company.name}</p>\n04947|                             <Badge \n04948|                               variant={isConnected ? \"default\" : \"destructive\"} \n04949|                               className=\"text-[9px] py-0 px-1\"\n04950|                             >\n04951|                               {isConnected ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–∞' : statusText === '–ø—Ä–æ–≤–µ—Ä–∫–∞...' ? '–ü—Ä–æ–≤–µ—Ä–∫–∞...' : '–û—à–∏–±–∫–∞'}\n04952|                             </Badge>\n04953|                           </div>\n04954|                         </div>\n04955|                         <div className=\"flex items-center gap-2\">\n04956|                           <span className=\"text-[9px] text-gray-300\">\n04957|                             {isEnabled ? '–í–∫–ª' : '–í—ã–∫–ª'}\n04958|                           </span>\n04959|                           <Switch\n04960|                             checked={isEnabled}\n04961|                             onCheckedChange={(checked) => {\n04962|                               setEnabledCompanies(prev => ({\n04963|                                 ...prev,\n04964|                                 [company.apiKey]: checked\n04965|                               }));\n04966|                             }}\n04967|                             disabled={!isConnected}\n04968|                           />\n04969|                         </div>\n04970|                       </div>\n04971|                     );\n04972|                   })}\n04973|                 </div>\n04974|               </CardContent>\n04975|             </Card>\n04976| \n04977|             {/* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫—É–∑–æ–≤–∞ */}\n04978|             {calculations.length > 0 && (\n04979|               <TruckVisualization \n04980|                 cargos={form.cargos.map(cargo => ({\n04981|                   id: cargo.id,\n04982|                   length: cargo.length * 10, // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n04983|                   width: cargo.width * 10,   // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n04984|                   height: cargo.height * 10, // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n04985|                   weight: cargo.weight,\n04986|                   productName: form.selectedProducts?.find(p => \n04987|                     p.cargoIndexes.includes(form.cargos.indexOf(cargo))\n04988|                   )?.product.name\n04989|                 }))}\n04990|                 isVisible={true}\n04991|               />\n04992|             )}\n04993|           </div>\n04994|         </div>\n04995|       </div>\n04996| \n04997|       {/* –ê–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–∫–∏ */}\n04998|       {showSuggestions && suggestions.length > 0 && (\n04999|         <div \n05000|           className=\"fixed z-50 bg-gray-800 border border-gray-700 rounded-md shadow-lg max-w-sm w-full max-h-60 overflow-y-auto\"\n05001|           style={{\n05002|             top: suggestionPosition.top,\n05003|             left: suggestionPosition.left\n05004|           }}\n05005|         >\n05006|           <div className=\"p-1\">\n05007|             {suggestions.map((suggestion, index) => (\n05008|               <div\n05009|                 key={index}\n05010|                 className=\"p-2 hover:bg-gray-700 cursor-pointer text-xs text-white rounded transition-colors\"\n05011|                 onClick={() => selectSuggestion(suggestion)}\n05012|               >\n05013|                 {suggestion.value}\n05014|               </div>\n05015|             ))}\n05016|           </div>\n05017|         </div>\n05018|       )}\n05019|     </div>\n05020|   );\n05021| }\n</file>",
    "title": "app/page.tsx",
    "metadata": {
      "preview": "      // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è –Ω–æ–≤–æ–≥–æ API NordWheel\n      const requestData = {\n        dispatch: {\n          location: {\n            type: 'terminal',\n            terminal_id: '0c7a2795-1220-486d-a7ce-8bcf130a1224', // –ú–æ—Å–∫–≤–∞ terminal GUID\n            city_fias: '0c5b2444-70a0-4932-980c-b4dc0d3f02b5' // –ú–æ—Å–∫–≤–∞ FIAS\n          }\n        },\n        destination: {\n          location: {\n            type: 'terminal',\n            terminal_id: '3ca02b62-3632-4da0-8fde-de9d9c77c553', // –°–ü–± terminal GUID\n            city_fias: 'c2deb16a-0330-4f05-821f-1d09c93331e6' // –°–ü–± FIAS\n          }\n        },\n        cargo: {\n          total_weight: totalWeight,\n          total_volume: totalVolume,\n          total_quantity: form.cargos.length"
    },
    "time": {
      "start": 1763469764145,
      "end": 1763469764150
    }
  }
}