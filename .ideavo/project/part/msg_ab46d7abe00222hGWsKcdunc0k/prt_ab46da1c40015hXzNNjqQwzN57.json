{
  "id": "prt_ab46da1c40015hXzNNjqQwzN57",
  "sessionID": "ses_54b97e247ffenCZZa4jZiIWD0l",
  "messageID": "msg_ab46d7abe00222hGWsKcdunc0k",
  "type": "tool",
  "callID": "call_da9c8510ba09478fae04c30f",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx",
      "limit": 100,
      "offset": 4000
    },
    "output": "<file>\n04001|     }\n04002|   };\n04003| \n04004|   const handleCalculate = async () => {\n04005|     setCalculating(true);\n04006|     setCalculations([]);\n04007|     \n04008|     // Сохраняем данные формы после расчета (принудительно, без дебаунса)\n04009|     saveFormData({\n04010|       cargos: form.cargos,\n04011|       fromCity: form.fromCity,\n04012|       toCity: form.toCity,\n04013|       fromAddress: form.fromAddress,\n04014|       toAddress: form.toAddress,\n04015|       declaredValue: form.declaredValue,\n04016|       needPackaging: form.needPackaging,\n04017|       needLoading: form.needLoading,\n04018|       needCarry: form.needCarry,\n04019|       floor: form.floor,\n04020|       hasFreightLift: form.hasFreightLift,\n04021|       needInsurance: form.needInsurance,\n04022|       fromTerminal: form.fromTerminal,\n04023|       toTerminal: form.toTerminal,\n04024|       fromAddressDelivery: form.fromAddressDelivery,\n04025|       toAddressDelivery: form.toAddressDelivery,\n04026|       selectedProducts: form.selectedProducts,\n04027|     });\n04028|     \n04029|     try {\n04030|       // Создаем массив функций расчета только для включенных компаний\n04031|       const calculationFunctions: Promise<CalculationResult>[] = [];\n04032|       \n04033|       if (enabledCompanies.dellin) {\n04034|         calculationFunctions.push(calculateDellin());\n04035|       }\n04036|       if (enabledCompanies.pek) {\n04037|         calculationFunctions.push(calculatePEK());\n04038|       }\n04039|       if (enabledCompanies.nordwheel) {\n04040|         calculationFunctions.push(calculateNordWheel());\n04041|       }\n04042|       if (enabledCompanies.railcontinent) {\n04043|         calculationFunctions.push(calculateRailContinent());\n04044|       }\n04045|       if (enabledCompanies.vozovoz) {\n04046|         calculationFunctions.push(calculateVozovoz());\n04047|       }\n04048|       if (enabledCompanies.cdek) {\n04049|         calculationFunctions.push(calculateCdek());\n04050|       }\n04051|       if (enabledCompanies.kit) {\n04052|         calculationFunctions.push(calculateKit());\n04053|       }\n04054|       \n04055|       // Если ни одна компания не включена\n04056|       if (calculationFunctions.length === 0) {\n04057|         setCalculations([]);\n04058|         return;\n04059|       }\n04060|       \n04061|       const results = await Promise.all(calculationFunctions);\n04062|       \n04063|       // Сортировка по цене\n04064|       const sortedResults = results\n04065|         .filter(result => !result.error)\n04066|         .sort((a, b) => a.price - b.price)\n04067|         .concat(results.filter(result => result.error));\n04068|       \n04069|       setCalculations(sortedResults);\n04070|     } catch (error) {\n04071|       console.error('Ошибка при расчете:', error);\n04072|     } finally {\n04073|       setCalculating(false);\n04074|     }\n04075|   };\n04076| \n04077|   const exportToPDF = () => {\n04078|     if (typeof window !== 'undefined') {\n04079|       // Разворачиваем все детали перед печатью\n04080|       const allExpanded = calculations.reduce((acc, calc) => {\n04081|         acc[calc.company] = true;\n04082|         return acc;\n04083|       }, {} as { [key: string]: boolean });\n04084|       \n04085|       setExpandedDetails(allExpanded);\n04086|       \n04087|       // Даем время для обновления DOM\n04088|       setTimeout(() => {\n04089|         window.print();\n04090|       }, 100);\n04091|     }\n04092|   };\n04093| \n04094|   const toggleDetails = (company: string) => {\n04095|     setExpandedDetails(prev => ({\n04096|       ...prev,\n04097|       [company]: !prev[company]\n04098|     }));\n04099|   };\n04100| \n\n(File has more lines. Use 'offset' parameter to read beyond line 4100)\n</file>",
    "title": "app/page.tsx",
    "metadata": {
      "preview": "    }\n  };\n\n  const handleCalculate = async () => {\n    setCalculating(true);\n    setCalculations([]);\n    \n    // Сохраняем данные формы после расчета (принудительно, без дебаунса)\n    saveFormData({\n      cargos: form.cargos,\n      fromCity: form.fromCity,\n      toCity: form.toCity,\n      fromAddress: form.fromAddress,\n      toAddress: form.toAddress,\n      declaredValue: form.declaredValue,\n      needPackaging: form.needPackaging,\n      needLoading: form.needLoading,\n      needCarry: form.needCarry,\n      floor: form.floor,\n      hasFreightLift: form.hasFreightLift,"
    },
    "time": {
      "start": 1763963675080,
      "end": 1763963675085
    }
  }
}