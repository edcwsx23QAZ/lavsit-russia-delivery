{
  "id": "prt_9ba30a10d001t5zupr9ShxEhXN",
  "messageID": "msg_9ba2f7999001QlhlTMX0E7V729",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "read",
  "callID": "toolu_01TvZ7ZLHp5Hi1k49WEj9u2h",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/middleware.ts"
    },
    "output": "<file>\n00001| import { NextResponse } from 'next/server'\n00002| import type { NextRequest } from 'next/server'\n00003| import { checkMissingEnvVars } from '@/lib/env-config'\n00004| \n00005| export function middleware(request: NextRequest) {\n00006|   // EMERGENCY: SUPER AGGRESSIVE DEV DETECTION\n00007|   const isDev = process.env.NODE_ENV === 'development' || \n00008|                 process.env.NODE_ENV === undefined ||\n00009|                 request.nextUrl.hostname.includes('localhost') ||\n00010|                 request.nextUrl.hostname.includes('127.0.0.1') ||\n00011|                 request.nextUrl.hostname.includes('.e2b.app') ||\n00012|                 request.nextUrl.hostname.includes('ideavo') ||\n00013|                 request.nextUrl.port !== '';\n00014| \n00015|   // Skip middleware for the env-check page itself to avoid infinite redirects\n00016|   if (request.nextUrl.pathname === '/env-check') {\n00017|     const response = NextResponse.next()\n00018|     \n00019|     // Добавляем заголовки против кэширования в dev режиме\n00020|     if (isDev) {\n00021|       response.headers.set('Cache-Control', 'no-cache, no-store, must-revalidate')\n00022|       response.headers.set('Pragma', 'no-cache')\n00023|       response.headers.set('Expires', '0')\n00024|     }\n00025|     \n00026|     return response\n00027|   }\n00028| \n00029|   // Skip middleware for API routes, static files, and Next.js internals\n00030|   if (\n00031|     request.nextUrl.pathname.startsWith('/api/') ||\n00032|     request.nextUrl.pathname.startsWith('/_next/') ||\n00033|     request.nextUrl.pathname.includes('.')\n00034|   ) {\n00035|     const response = NextResponse.next()\n00036|     \n00037|     // Добавляем заголовки против кэширования в dev режиме\n00038|     if (isDev) {\n00039|       response.headers.set('Cache-Control', 'no-cache, no-store, must-revalidate')\n00040|       response.headers.set('Pragma', 'no-cache')\n00041|       response.headers.set('Expires', '0')\n00042|     }\n00043|     \n00044|     return response\n00045|   }\n00046| \n00047|   // Check if any required environment variables are missing\n00048|   const missingEnvVars = checkMissingEnvVars()\n00049| \n00050|   // If any env variables are missing, redirect to env-check page\n00051|   if (missingEnvVars.length > 0) {\n00052|     return NextResponse.redirect(new URL('/env-check', request.url))\n00053|   }\n00054| \n00055|   const response = NextResponse.next()\n00056|   \n00057|   // EMERGENCY: NUCLEAR CACHE HEADERS FOR DEV\n00058|   if (isDev) {\n00059|     response.headers.set('Cache-Control', 'no-cache, no-store, must-revalidate, proxy-revalidate, s-maxage=0, max-age=0')\n00060|     response.headers.set('Pragma', 'no-cache')\n00061|     response.headers.set('Expires', '0')\n00062|     response.headers.set('Last-Modified', new Date().toUTCString())\n00063|     response.headers.set('ETag', `dev-${Date.now()}`)\n00064|     response.headers.set('X-Dev-Mode', 'true')\n00065|     response.headers.set('X-Emergency-No-Cache', 'true')\n00066|     response.headers.set('Clear-Site-Data', '\"cache\", \"storage\"')\n00067|   }\n00068|   \n00069|   return response\n00070| }\n00071| \n00072| export const config = {\n00073|   matcher: [\n00074|     /*\n00075|      * Match all request paths except for the ones starting with:\n00076|      * - api (API routes)\n00077|      * - _next/static (static files)\n00078|      * - _next/image (image optimization files)\n00079|      * - favicon.ico (favicon file)\n00080|      */\n00081|     '/((?!api|_next/static|_next/image|favicon.ico).*)',\n00082|   ],\n00083| }\n</file>",
    "metadata": {
      "preview": "import { NextResponse } from 'next/server'\nimport type { NextRequest } from 'next/server'\nimport { checkMissingEnvVars } from '@/lib/env-config'\n\nexport function middleware(request: NextRequest) {\n  // EMERGENCY: SUPER AGGRESSIVE DEV DETECTION\n  const isDev = process.env.NODE_ENV === 'development' || \n                process.env.NODE_ENV === undefined ||\n                request.nextUrl.hostname.includes('localhost') ||\n                request.nextUrl.hostname.includes('127.0.0.1') ||\n                request.nextUrl.hostname.includes('.e2b.app') ||\n                request.nextUrl.hostname.includes('ideavo') ||\n                request.nextUrl.port !== '';\n\n  // Skip middleware for the env-check page itself to avoid infinite redirects\n  if (request.nextUrl.pathname === '/env-check') {\n    const response = NextResponse.next()\n    \n    // Добавляем заголовки против кэширования в dev режиме\n    if (isDev) {"
    },
    "title": "middleware.ts",
    "time": {
      "start": 1759765373960,
      "end": 1759765373962
    }
  }
}