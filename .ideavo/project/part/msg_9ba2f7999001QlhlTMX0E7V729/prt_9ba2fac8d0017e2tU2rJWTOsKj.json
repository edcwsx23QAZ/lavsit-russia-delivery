{
  "id": "prt_9ba2fac8d0017e2tU2rJWTOsKj",
  "messageID": "msg_9ba2f7999001QlhlTMX0E7V729",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "read",
  "callID": "toolu_01BUrf7yB8Tbt7YzXUKh6GVA",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/lib/form-storage.ts"
    },
    "output": "<file>\n00001| 'use client';\n00002| \n00003| // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –∫–ª—é—á–µ–π localStorage\n00004| const FORM_DATA_KEY = 'deliveryFormData';\n00005| const FORM_VERSION = '1.2'; // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ñ–æ—Ä–º—ã + enabledCompanies\n00006| \n00007| export interface StoredFormData {\n00008|   version: string;\n00009|   timestamp: number;\n00010|   cargos: Array<{\n00011|     id: string;\n00012|     length: number;\n00013|     width: number;\n00014|     height: number;\n00015|     weight: number;\n00016|     productId?: string;\n00017|     placeNumber?: number;\n00018|     isFromProduct?: boolean;\n00019|     addedAt?: number;\n00020|   }>;\n00021|   fromCity: string;\n00022|   toCity: string;\n00023|   fromAddress: string;\n00024|   toAddress: string;\n00025|   declaredValue: number;\n00026|   needPackaging: boolean;\n00027|   needLoading: boolean;\n00028|   needCarry: boolean;\n00029|   floor: number;\n00030|   hasFreightLift: boolean;\n00031|   needInsurance: boolean;\n00032|   fromTerminal: boolean;\n00033|   toTerminal: boolean;\n00034|   fromAddressDelivery: boolean;\n00035|   toAddressDelivery: boolean;\n00036|   fromLavsiteWarehouse: boolean;\n00037|   selectedProducts: Array<{\n00038|     product: {\n00039|       id: string;\n00040|       externalCode: string;\n00041|       name: string;\n00042|       retailPrice: number;\n00043|       isActive: boolean;\n00044|       cargoPlaces: Array<{\n00045|         placeNumber: number;\n00046|         weight: number;\n00047|         height: number;\n00048|         depth: number;\n00049|         length: number;\n00050|       }>;\n00051|     };\n00052|     quantity: number;\n00053|     totalPrice: number;\n00054|     cargoIndexes: number[];\n00055|     addedAt: number;\n00056|   }>;\n00057|   enabledCompanies?: Record<string, boolean>;\n00058| }\n00059| \n00060| /**\n00061|  * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –≤ localStorage\n00062|  * –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤ - —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥\n00063|  */\n00064| export const saveFormData = (formData: Partial<StoredFormData>): boolean => {\n00065|   try {\n00066|     if (typeof window === 'undefined') {\n00067|       return false; // SSR safe\n00068|     }\n00069| \n00070|     const dataToSave: StoredFormData = {\n00071|       version: FORM_VERSION,\n00072|       timestamp: Date.now(),\n00073|       cargos: formData.cargos || [],\n00074|       fromCity: formData.fromCity || '',\n00075|       toCity: formData.toCity || '',\n00076|       fromAddress: formData.fromAddress || '',\n00077|       toAddress: formData.toAddress || '',\n00078|       declaredValue: formData.declaredValue || 0,\n00079|       needPackaging: formData.needPackaging || false,\n00080|       needLoading: formData.needLoading || false,\n00081|       needCarry: formData.needCarry || false,\n00082|       floor: formData.floor || 1,\n00083|       hasFreightLift: formData.hasFreightLift || false,\n00084|       needInsurance: formData.needInsurance || false,\n00085|       fromTerminal: formData.fromTerminal ?? true,\n00086|       toTerminal: formData.toTerminal ?? true,\n00087|       fromAddressDelivery: formData.fromAddressDelivery || false,\n00088|       toAddressDelivery: formData.toAddressDelivery || false,\n00089|       fromLavsiteWarehouse: formData.fromLavsiteWarehouse || false,\n00090|       selectedProducts: formData.selectedProducts || [],\n00091|       enabledCompanies: formData.enabledCompanies || {},\n00092|     };\n00093| \n00094|     localStorage.setItem(FORM_DATA_KEY, JSON.stringify(dataToSave));\n00095|     console.log('üíæ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage:', dataToSave);\n00096|     return true;\n00097|   } catch (error) {\n00098|     console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã:', error);\n00099|     return false;\n00100|   }\n00101| };\n00102| \n00103| /**\n00104|  * –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –∏–∑ localStorage\n00105|  */\n00106| export const loadFormData = (): StoredFormData | null => {\n00107|   try {\n00108|     if (typeof window === 'undefined') {\n00109|       return null; // SSR safe\n00110|     }\n00111| \n00112|     const savedData = localStorage.getItem(FORM_DATA_KEY);\n00113|     if (!savedData) {\n00114|       console.log('üìù –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');\n00115|       return null;\n00116|     }\n00117| \n00118|     const parsedData = JSON.parse(savedData) as StoredFormData;\n00119|     \n00120|     // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –¥–∞–Ω–Ω—ã—Ö\n00121|     if (parsedData.version !== FORM_VERSION) {\n00122|       console.warn('‚ö†Ô∏è –í–µ—Ä—Å–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è...');\n00123|       // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã\n00124|       return migrateFormData(parsedData);\n00125|     }\n00126| \n00127|     // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–∞–≤–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ - —É–¥–∞–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π)\n00128|     const thirtyDaysInMs = 30 * 24 * 60 * 60 * 1000;\n00129|     if (Date.now() - parsedData.timestamp > thirtyDaysInMs) {\n00130|       console.log('üóëÔ∏è –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä—ã–µ, —É–¥–∞–ª—è–µ–º...');\n00131|       clearFormData();\n00132|       return null;\n00133|     }\n00134| \n00135|     console.log('üìÇ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ localStorage:', parsedData);\n00136|     return parsedData;\n00137|   } catch (error) {\n00138|     console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã:', error);\n00139|     return null;\n00140|   }\n00141| };\n00142| \n00143| /**\n00144|  * –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã\n00145|  */\n00146| const migrateFormData = (oldData: any): StoredFormData | null => {\n00147|   try {\n00148|     // –ë–∞–∑–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è - –ø—Ä–∏–≤–æ–¥–∏–º –∫ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ\n00149|     const migratedData: StoredFormData = {\n00150|       version: FORM_VERSION,\n00151|       timestamp: Date.now(),\n00152|       cargos: oldData.cargos || [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00153|       fromCity: oldData.fromCity || '',\n00154|       toCity: oldData.toCity || '',\n00155|       fromAddress: oldData.fromAddress || '',\n00156|       toAddress: oldData.toAddress || '',\n00157|       declaredValue: oldData.declaredValue || 0,\n00158|       needPackaging: oldData.needPackaging || false,\n00159|       needLoading: oldData.needLoading || false,\n00160|       needCarry: oldData.needCarry || false,\n00161|       floor: oldData.floor || 1,\n00162|       hasFreightLift: oldData.hasFreightLift || false,\n00163|       needInsurance: oldData.needInsurance || false,\n00164|       fromTerminal: oldData.fromTerminal ?? true,\n00165|       toTerminal: oldData.toTerminal ?? true,\n00166|       fromAddressDelivery: oldData.fromAddressDelivery || false,\n00167|       toAddressDelivery: oldData.toAddressDelivery || false,\n00168|       fromLavsiteWarehouse: oldData.fromLavsiteWarehouse || false,\n00169|       selectedProducts: oldData.selectedProducts || [],\n00170|       enabledCompanies: oldData.enabledCompanies || {},\n00171|     };\n00172| \n00173|     // –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n00174|     localStorage.setItem(FORM_DATA_KEY, JSON.stringify(migratedData));\n00175|     console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã');\n00176|     return migratedData;\n00177|   } catch (error) {\n00178|     console.error('‚ùå –û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);\n00179|     return null;\n00180|   }\n00181| };\n00182| \n00183| /**\n00184|  * –û—á–∏—â–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã\n00185|  */\n00186| export const clearFormData = (): boolean => {\n00187|   try {\n00188|     if (typeof window === 'undefined') {\n00189|       return false;\n00190|     }\n00191| \n00192|     localStorage.removeItem(FORM_DATA_KEY);\n00193|     console.log('üóëÔ∏è –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —É–¥–∞–ª–µ–Ω—ã –∏–∑ localStorage');\n00194|     return true;\n00195|   } catch (error) {\n00196|     console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã:', error);\n00197|     return false;\n00198|   }\n00199| };\n00200| \n00201| /**\n00202|  * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n00203|  */\n00204| export const hasStoredFormData = (): boolean => {\n00205|   try {\n00206|     if (typeof window === 'undefined') {\n00207|       return false;\n00208|     }\n00209| \n00210|     return localStorage.getItem(FORM_DATA_KEY) !== null;\n00211|   } catch (error) {\n00212|     return false;\n00213|   }\n00214| };\n00215| \n00216| /**\n00217|  * –î–µ–±–∞—É–Ω—Å —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è\n00218|  */\n00219| export const createDebouncedSaver = (delay: number = 1000) => {\n00220|   let timeoutId: NodeJS.Timeout;\n00221|   \n00222|   return (formData: Partial<StoredFormData>) => {\n00223|     clearTimeout(timeoutId);\n00224|     timeoutId = setTimeout(() => {\n00225|       saveFormData(formData);\n00226|     }, delay);\n00227|   };\n00228| };\n</file>",
    "metadata": {
      "preview": "'use client';\n\n// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –∫–ª—é—á–µ–π localStorage\nconst FORM_DATA_KEY = 'deliveryFormData';\nconst FORM_VERSION = '1.2'; // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ñ–æ—Ä–º—ã + enabledCompanies\n\nexport interface StoredFormData {\n  version: string;\n  timestamp: number;\n  cargos: Array<{\n    id: string;\n    length: number;\n    width: number;\n    height: number;\n    weight: number;\n    productId?: string;\n    placeNumber?: number;\n    isFromProduct?: boolean;\n    addedAt?: number;\n  }>;"
    },
    "title": "lib/form-storage.ts",
    "time": {
      "start": 1759765311190,
      "end": 1759765311193
    }
  }
}