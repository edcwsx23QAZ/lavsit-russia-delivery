{
  "id": "prt_9ba31009e001hvmHkE49H9Bquy",
  "messageID": "msg_9ba2f7999001QlhlTMX0E7V729",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "multiedit",
  "callID": "toolu_016EUmBWjhrtFtqGidtWNMwT",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/lib/form-storage.ts",
      "edits": [
        {
          "oldString": "'use client';\n\n// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –∫–ª—é—á–µ–π localStorage",
          "newString": "'use client';\n\nimport { \n  saveFormDataToIndexedDB, \n  loadFormDataFromIndexedDB, \n  clearFormDataFromIndexedDB,\n  isIndexedDBAvailable \n} from './indexeddb-storage';\nimport { \n  saveFormDataToCookies, \n  loadFormDataFromCookies, \n  clearFormDataFromCookies,\n  isCookieStorageAvailable \n} from './cookie-storage';\n\n// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –∫–ª—é—á–µ–π localStorage"
        },
        {
          "oldString": "/**\n * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –≤ localStorage\n * –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤ - —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥\n */\nexport const saveFormData = (formData: Partial<StoredFormData>): boolean => {",
          "newString": "/**\n * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –≤ localStorage, IndexedDB –∏ cookies (—Ç—Ä–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞)\n * –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤ - —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥\n */\nexport const saveFormData = (formData: Partial<StoredFormData>): boolean => {"
        },
        {
          "oldString": "    localStorage.setItem(FORM_DATA_KEY, JSON.stringify(dataToSave));\n    console.log('üíæ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage:', dataToSave);\n    return true;",
          "newString": "    const serializedData = JSON.stringify(dataToSave);\n    \n    // –¢—Ä–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage, IndexedDB –∏ cookies\n    let localStorageSuccess = false;\n    let indexedDBSuccess = false;\n    let cookieSuccess = false;\n    \n    // 1. localStorage (–æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥)\n    try {\n      localStorage.setItem(FORM_DATA_KEY, serializedData);\n      localStorageSuccess = true;\n      console.log('üíæ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage');\n    } catch (error) {\n      console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage:', error);\n    }\n    \n    // 2. IndexedDB (–∑–∞—â–∏—Ç–∞ –æ—Ç Clear-Site-Data –¥–ª—è storage)\n    if (isIndexedDBAvailable()) {\n      saveFormDataToIndexedDB(serializedData).then(success => {\n        if (success) {\n          console.log('üíæ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ IndexedDB');\n        }\n      }).catch(error => {\n        console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ IndexedDB:', error);\n      });\n    }\n    \n    // 3. Cookies (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞)\n    if (isCookieStorageAvailable()) {\n      try {\n        cookieSuccess = saveFormDataToCookies(serializedData);\n        if (cookieSuccess) {\n          console.log('üíæ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ cookies');\n        }\n      } catch (error) {\n        console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ cookies:', error);\n      }\n    }\n    \n    console.log(`üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ: localStorage=${localStorageSuccess}, IndexedDB=async, cookies=${cookieSuccess}`);\n    return localStorageSuccess; // localStorage –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏–µ–º —É—Å–ø–µ—Ö–∞"
        },
        {
          "oldString": "/**\n * –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –∏–∑ localStorage\n */\nexport const loadFormData = (): StoredFormData | null => {",
          "newString": "/**\n * –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å —Ç—Ä–æ–π–Ω–æ–π –∑–∞—â–∏—Ç–æ–π (localStorage -> IndexedDB -> cookies)\n */\nexport const loadFormData = (): StoredFormData | null => {"
        },
        {
          "oldString": "    const savedData = localStorage.getItem(FORM_DATA_KEY);\n    if (!savedData) {\n      console.log('üìù –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');\n      return null;\n    }",
          "newString": "    let savedData = localStorage.getItem(FORM_DATA_KEY);\n    let dataSource = 'localStorage';\n    \n    // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –≤ localStorage, –ø—Ä–æ–±—É–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –¥—Ä—É–≥–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤\n    if (!savedData) {\n      console.log('üìù –î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ localStorage, –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥—Ä—É–≥–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏...');\n      \n      // –ü—Ä–æ–±—É–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ IndexedDB (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)\n      loadFormDataFromIndexedDB().then(indexedData => {\n        if (indexedData) {\n          console.log('üìÇ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ IndexedDB');\n          try {\n            localStorage.setItem(FORM_DATA_KEY, indexedData);\n            console.log('üíæ –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ localStorage –∏–∑ IndexedDB');\n          } catch (error) {\n            console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å localStorage –∏–∑ IndexedDB:', error);\n          }\n        }\n      }).catch(error => {\n        console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ IndexedDB:', error);\n      });\n      \n      // –ü—Ä–æ–±—É–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ cookies (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)\n      const cookieData = loadFormDataFromCookies();\n      if (cookieData) {\n        savedData = cookieData;\n        dataSource = 'cookies';\n        console.log('üìÇ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ cookies');\n        try {\n          localStorage.setItem(FORM_DATA_KEY, cookieData);\n          console.log('üíæ –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ localStorage –∏–∑ cookies');\n        } catch (error) {\n          console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å localStorage –∏–∑ cookies:', error);\n        }\n      }\n    }\n    \n    if (!savedData) {\n      console.log('üìù –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∏ –≤ –æ–¥–Ω–æ–º –∏—Å—Ç–æ—á–Ω–∏–∫–µ');\n      return null;\n    }"
        },
        {
          "oldString": "    console.log('üìÇ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ localStorage:', parsedData);\n    return parsedData;",
          "newString": "    console.log(`üìÇ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ ${dataSource}:`, parsedData);\n    return parsedData;"
        },
        {
          "oldString": "/**\n * –û—á–∏—â–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã\n */\nexport const clearFormData = (): boolean => {",
          "newString": "/**\n * –û—á–∏—â–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –∏–∑ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (localStorage, IndexedDB, cookies)\n */\nexport const clearFormData = (): boolean => {"
        },
        {
          "oldString": "    localStorage.removeItem(FORM_DATA_KEY);\n    console.log('üóëÔ∏è –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —É–¥–∞–ª–µ–Ω—ã –∏–∑ localStorage');\n    return true;",
          "newString": "    let localStorageSuccess = false;\n    let indexedDBSuccess = false;\n    let cookieSuccess = false;\n    \n    // –û—á–∏—â–∞–µ–º localStorage\n    try {\n      localStorage.removeItem(FORM_DATA_KEY);\n      localStorageSuccess = true;\n      console.log('üóëÔ∏è –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —É–¥–∞–ª–µ–Ω—ã –∏–∑ localStorage');\n    } catch (error) {\n      console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ localStorage:', error);\n    }\n    \n    // –û—á–∏—â–∞–µ–º IndexedDB\n    if (isIndexedDBAvailable()) {\n      clearFormDataFromIndexedDB().then(success => {\n        if (success) {\n          console.log('üóëÔ∏è –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —É–¥–∞–ª–µ–Ω—ã –∏–∑ IndexedDB');\n        }\n      }).catch(error => {\n        console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ IndexedDB:', error);\n      });\n    }\n    \n    // –û—á–∏—â–∞–µ–º cookies\n    if (isCookieStorageAvailable()) {\n      try {\n        cookieSuccess = clearFormDataFromCookies();\n        if (cookieSuccess) {\n          console.log('üóëÔ∏è –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —É–¥–∞–ª–µ–Ω—ã –∏–∑ cookies');\n        }\n      } catch (error) {\n        console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ cookies:', error);\n      }\n    }\n    \n    console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ: localStorage=${localStorageSuccess}, IndexedDB=async, cookies=${cookieSuccess}`);\n    return localStorageSuccess;"
        },
        {
          "oldString": "/**\n * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n */\nexport const hasStoredFormData = (): boolean => {",
          "newString": "/**\n * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ª—é–±–æ–º –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤\n */\nexport const hasStoredFormData = (): boolean => {"
        },
        {
          "oldString": "    return localStorage.getItem(FORM_DATA_KEY) !== null;",
          "newString": "    // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage\n    const hasLocalStorage = localStorage.getItem(FORM_DATA_KEY) !== null;\n    if (hasLocalStorage) {\n      return true;\n    }\n    \n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º cookies\n    if (isCookieStorageAvailable()) {\n      const hasCookies = loadFormDataFromCookies() !== null;\n      if (hasCookies) {\n        return true;\n      }\n    }\n    \n    // IndexedDB –ø—Ä–æ–≤–µ—Ä—è–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç)\n    if (isIndexedDBAvailable()) {\n      loadFormDataFromIndexedDB().then(data => {\n        if (data) {\n          console.log('üìÇ –ù–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –≤ IndexedDB –¥–ª—è –±—É–¥—É—â–µ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è');\n        }\n      }).catch(() => {});\n    }\n    \n    return false;"
        }
      ]
    },
    "output": "",
    "metadata": {
      "results": [
        {
          "diagnostics": {},
          "diff": "Index: /home/user/project/lib/form-storage.ts\n===================================================================\n--- /home/user/project/lib/form-storage.ts\n+++ /home/user/project/lib/form-storage.ts\n@@ -1,6 +1,19 @@\n 'use client';\n \n+import { \n+  saveFormDataToIndexedDB, \n+  loadFormDataFromIndexedDB, \n+  clearFormDataFromIndexedDB,\n+  isIndexedDBAvailable \n+} from './indexeddb-storage';\n+import { \n+  saveFormDataToCookies, \n+  loadFormDataFromCookies, \n+  clearFormDataFromCookies,\n+  isCookieStorageAvailable \n+} from './cookie-storage';\n+\n // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –∫–ª—é—á–µ–π localStorage\n const FORM_DATA_KEY = 'deliveryFormData';\n const FORM_VERSION = '1.2'; // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ñ–æ—Ä–º—ã + enabledCompanies\n \n"
        },
        {
          "diagnostics": {},
          "diff": "Index: /home/user/project/lib/form-storage.ts\n===================================================================\n--- /home/user/project/lib/form-storage.ts\n+++ /home/user/project/lib/form-storage.ts\n@@ -70,9 +70,9 @@\n   enabledCompanies?: Record<string, boolean>;\n }\n \n /**\n- * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –≤ localStorage\n+ * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –≤ localStorage, IndexedDB –∏ cookies (—Ç—Ä–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞)\n  * –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤ - —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥\n  */\n export const saveFormData = (formData: Partial<StoredFormData>): boolean => {\n   try {\n"
        },
        {
          "diagnostics": {},
          "diff": "Index: /home/user/project/lib/form-storage.ts\n===================================================================\n--- /home/user/project/lib/form-storage.ts\n+++ /home/user/project/lib/form-storage.ts\n@@ -103,11 +103,49 @@\n     selectedProducts: formData.selectedProducts || [],\n     enabledCompanies: formData.enabledCompanies || {},\n   };\n \n-  localStorage.setItem(FORM_DATA_KEY, JSON.stringify(dataToSave));\n-  console.log('üíæ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage:', dataToSave);\n-  return true;\n+  const serializedData = JSON.stringify(dataToSave);\n+  \n+  // –¢—Ä–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage, IndexedDB –∏ cookies\n+  let localStorageSuccess = false;\n+  let indexedDBSuccess = false;\n+  let cookieSuccess = false;\n+  \n+  // 1. localStorage (–æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥)\n+  try {\n+    localStorage.setItem(FORM_DATA_KEY, serializedData);\n+    localStorageSuccess = true;\n+    console.log('üíæ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage');\n+  } catch (error) {\n+    console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage:', error);\n+  }\n+  \n+  // 2. IndexedDB (–∑–∞—â–∏—Ç–∞ –æ—Ç Clear-Site-Data –¥–ª—è storage)\n+  if (isIndexedDBAvailable()) {\n+    saveFormDataToIndexedDB(serializedData).then(success => {\n+      if (success) {\n+        console.log('üíæ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ IndexedDB');\n+      }\n+    }).catch(error => {\n+      console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ IndexedDB:', error);\n+    });\n+  }\n+  \n+  // 3. Cookies (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞)\n+  if (isCookieStorageAvailable()) {\n+    try {\n+      cookieSuccess = saveFormDataToCookies(serializedData);\n+      if (cookieSuccess) {\n+        console.log('üíæ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ cookies');\n+      }\n+    } catch (error) {\n+      console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ cookies:', error);\n+    }\n+  }\n+  \n+  console.log(`üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ: localStorage=${localStorageSuccess}, IndexedDB=async, cookies=${cookieSuccess}`);\n+  return localStorageSuccess; // localStorage –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏–µ–º —É—Å–ø–µ—Ö–∞\n } catch (error) {\n   console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã:', error);\n   return false;\n }\n"
        },
        {
          "diagnostics": {},
          "diff": "Index: /home/user/project/lib/form-storage.ts\n===================================================================\n--- /home/user/project/lib/form-storage.ts\n+++ /home/user/project/lib/form-storage.ts\n@@ -151,9 +151,9 @@\n   }\n };\n \n /**\n- * –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –∏–∑ localStorage\n+ * –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å —Ç—Ä–æ–π–Ω–æ–π –∑–∞—â–∏—Ç–æ–π (localStorage -> IndexedDB -> cookies)\n  */\n export const loadFormData = (): StoredFormData | null => {\n   try {\n     if (typeof window === 'undefined') {\n"
        },
        {
          "diagnostics": {},
          "diff": "Index: /home/user/project/lib/form-storage.ts\n===================================================================\n--- /home/user/project/lib/form-storage.ts\n+++ /home/user/project/lib/form-storage.ts\n@@ -159,11 +159,47 @@\n if (typeof window === 'undefined') {\n   return null; // SSR safe\n }\n \n-const savedData = localStorage.getItem(FORM_DATA_KEY);\n+let savedData = localStorage.getItem(FORM_DATA_KEY);\n+let dataSource = 'localStorage';\n+\n+// –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –≤ localStorage, –ø—Ä–æ–±—É–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –¥—Ä—É–≥–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤\n if (!savedData) {\n-  console.log('üìù –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');\n+  console.log('üìù –î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ localStorage, –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥—Ä—É–≥–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏...');\n+  \n+  // –ü—Ä–æ–±—É–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ IndexedDB (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)\n+  loadFormDataFromIndexedDB().then(indexedData => {\n+    if (indexedData) {\n+      console.log('üìÇ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ IndexedDB');\n+      try {\n+        localStorage.setItem(FORM_DATA_KEY, indexedData);\n+        console.log('üíæ –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ localStorage –∏–∑ IndexedDB');\n+      } catch (error) {\n+        console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å localStorage –∏–∑ IndexedDB:', error);\n+      }\n+    }\n+  }).catch(error => {\n+    console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ IndexedDB:', error);\n+  });\n+  \n+  // –ü—Ä–æ–±—É–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ cookies (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)\n+  const cookieData = loadFormDataFromCookies();\n+  if (cookieData) {\n+    savedData = cookieData;\n+    dataSource = 'cookies';\n+    console.log('üìÇ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ cookies');\n+    try {\n+      localStorage.setItem(FORM_DATA_KEY, cookieData);\n+      console.log('üíæ –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ localStorage –∏–∑ cookies');\n+    } catch (error) {\n+      console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å localStorage –∏–∑ cookies:', error);\n+    }\n+  }\n+}\n+\n+if (!savedData) {\n+  console.log('üìù –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∏ –≤ –æ–¥–Ω–æ–º –∏—Å—Ç–æ—á–Ω–∏–∫–µ');\n   return null;\n }\n \n const parsedData = JSON.parse(savedData) as StoredFormData;\n"
        },
        {
          "diagnostics": {},
          "diff": "Index: /home/user/project/lib/form-storage.ts\n===================================================================\n--- /home/user/project/lib/form-storage.ts\n+++ /home/user/project/lib/form-storage.ts\n@@ -218,9 +218,9 @@\n     clearFormData();\n     return null;\n   }\n \n-  console.log('üìÇ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ localStorage:', parsedData);\n+  console.log(`üìÇ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ ${dataSource}:`, parsedData);\n   return parsedData;\n } catch (error) {\n   console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã:', error);\n   return null;\n"
        },
        {
          "diagnostics": {},
          "diff": "Index: /home/user/project/lib/form-storage.ts\n===================================================================\n--- /home/user/project/lib/form-storage.ts\n+++ /home/user/project/lib/form-storage.ts\n@@ -267,9 +267,9 @@\n   }\n };\n \n /**\n- * –û—á–∏—â–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã\n+ * –û—á–∏—â–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –∏–∑ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (localStorage, IndexedDB, cookies)\n  */\n export const clearFormData = (): boolean => {\n   try {\n     if (typeof window === 'undefined') {\n"
        },
        {
          "diagnostics": {},
          "diff": "Index: /home/user/project/lib/form-storage.ts\n===================================================================\n--- /home/user/project/lib/form-storage.ts\n+++ /home/user/project/lib/form-storage.ts\n@@ -275,11 +275,46 @@\n   if (typeof window === 'undefined') {\n     return false;\n   }\n \n-  localStorage.removeItem(FORM_DATA_KEY);\n-  console.log('üóëÔ∏è –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —É–¥–∞–ª–µ–Ω—ã –∏–∑ localStorage');\n-  return true;\n+  let localStorageSuccess = false;\n+  let indexedDBSuccess = false;\n+  let cookieSuccess = false;\n+  \n+  // –û—á–∏—â–∞–µ–º localStorage\n+  try {\n+    localStorage.removeItem(FORM_DATA_KEY);\n+    localStorageSuccess = true;\n+    console.log('üóëÔ∏è –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —É–¥–∞–ª–µ–Ω—ã –∏–∑ localStorage');\n+  } catch (error) {\n+    console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ localStorage:', error);\n+  }\n+  \n+  // –û—á–∏—â–∞–µ–º IndexedDB\n+  if (isIndexedDBAvailable()) {\n+    clearFormDataFromIndexedDB().then(success => {\n+      if (success) {\n+        console.log('üóëÔ∏è –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —É–¥–∞–ª–µ–Ω—ã –∏–∑ IndexedDB');\n+      }\n+    }).catch(error => {\n+      console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ IndexedDB:', error);\n+    });\n+  }\n+  \n+  // –û—á–∏—â–∞–µ–º cookies\n+  if (isCookieStorageAvailable()) {\n+    try {\n+      cookieSuccess = clearFormDataFromCookies();\n+      if (cookieSuccess) {\n+        console.log('üóëÔ∏è –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —É–¥–∞–ª–µ–Ω—ã –∏–∑ cookies');\n+      }\n+    } catch (error) {\n+      console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ cookies:', error);\n+    }\n+  }\n+  \n+  console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ: localStorage=${localStorageSuccess}, IndexedDB=async, cookies=${cookieSuccess}`);\n+  return localStorageSuccess;\n } catch (error) {\n   console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã:', error);\n   return false;\n }\n"
        },
        {
          "diagnostics": {},
          "diff": "Index: /home/user/project/lib/form-storage.ts\n===================================================================\n--- /home/user/project/lib/form-storage.ts\n+++ /home/user/project/lib/form-storage.ts\n@@ -320,9 +320,9 @@\n   }\n };\n \n /**\n- * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n+ * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ª—é–±–æ–º –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤\n  */\n export const hasStoredFormData = (): boolean => {\n   try {\n     if (typeof window === 'undefined') {\n"
        },
        {
          "diagnostics": {},
          "diff": "Index: /home/user/project/lib/form-storage.ts\n===================================================================\n--- /home/user/project/lib/form-storage.ts\n+++ /home/user/project/lib/form-storage.ts\n@@ -328,9 +328,32 @@\n     if (typeof window === 'undefined') {\n       return false;\n     }\n \n-    return localStorage.getItem(FORM_DATA_KEY) !== null;\n+    // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage\n+    const hasLocalStorage = localStorage.getItem(FORM_DATA_KEY) !== null;\n+    if (hasLocalStorage) {\n+      return true;\n+    }\n+    \n+    // –ü—Ä–æ–≤–µ—Ä—è–µ–º cookies\n+    if (isCookieStorageAvailable()) {\n+      const hasCookies = loadFormDataFromCookies() !== null;\n+      if (hasCookies) {\n+        return true;\n+      }\n+    }\n+    \n+    // IndexedDB –ø—Ä–æ–≤–µ—Ä—è–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç)\n+    if (isIndexedDBAvailable()) {\n+      loadFormDataFromIndexedDB().then(data => {\n+        if (data) {\n+          console.log('üìÇ –ù–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –≤ IndexedDB –¥–ª—è –±—É–¥—É—â–µ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è');\n+        }\n+      }).catch(() => {});\n+    }\n+    \n+    return false;\n   } catch (error) {\n     return false;\n   }\n };\n"
        }
      ]
    },
    "title": "lib/form-storage.ts",
    "time": {
      "start": 1759765427058,
      "end": 1759765427096
    }
  }
}