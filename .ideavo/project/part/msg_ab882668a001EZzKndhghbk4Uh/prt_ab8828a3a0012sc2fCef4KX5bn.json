{
  "id": "prt_ab8828a3a0012sc2fCef4KX5bn",
  "sessionID": "ses_54b97e247ffenCZZa4jZiIWD0l",
  "messageID": "msg_ab882668a001EZzKndhghbk4Uh",
  "type": "tool",
  "callID": "call_2bb699ca8aff4f0383456b70",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx",
      "limit": 1000,
      "offset": 2000
    },
    "output": "<file>\n02001|           console.log('üí∞ –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞—Ö–æ–≤–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ');\n02002|         } else {\n02003|           console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–≤–µ—Ç–µ');\n02004|         }\n02005|         \n02006|         // –£–ü–ê–ö–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n02007|         console.log('üí∞ –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–ë –£–ü–ê–ö–û–í–ö–ï (–£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –í –û–°–ù–û–í–ù–£–Æ –°–¢–û–ò–ú–û–°–¢–¨):');\n02008|         console.log('üí∞ data.data.packages =', data.data.packages);\n02009|         console.log('üí∞ form.needPackaging =', form.needPackaging);\n02010|         \n02011|         if (data.data.packages && form.needPackaging) {\n02012|           console.log('üí∞ ‚úÖ –£–ü–ê–ö–û–í–ö–ê –ü–†–ò–°–£–¢–°–¢–í–£–ï–¢ –í –û–¢–í–ï–¢–ï (—Ü–µ–Ω–∞ —É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ data.data.price)');\n02013|           console.log('üí∞ –¢–∏–ø packages:', Array.isArray(data.data.packages) ? 'Array' : 'Object');\n02014|           \n02015|           if (Array.isArray(data.data.packages)) {\n02016|             data.data.packages.forEach((pkg: any, index: number) => {\n02017|               console.log(`üí∞ Package [${index}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n02018|             });\n02019|           } else {\n02020|             Object.entries(data.data.packages).forEach(([key, pkg]: [string, any]) => {\n02021|               console.log(`üí∞ Package [${key}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n02022|             });\n02023|           }\n02024|         } else {\n02025|           console.log('üí∞ ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∞—Å—å');\n02026|         }\n02027| \n02028|         // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–∞–∫ —Ä–∞–∑–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –¥–∞—Ç–∞–º–∏ pickup –∏ arrivalToOspReceiver\n02029|         let deliveryDays = 0;\n02030|         try {\n02031|           console.log('=== –ü–û–ò–°–ö –î–ê–¢ –í –û–¢–í–ï–¢–ï ===');\n02032|           \n02033|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–µ—Å—Ç–∞ –≥–¥–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–∞—Ç—ã\n02034|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.pickup:', data.data?.pickup);\n02035|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.pickup:', data.pickup);\n02036|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.pickup:', data?.pickup);\n02037|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.arrivalToOspReceiver:', data.data?.arrivalToOspReceiver);\n02038|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.arrivalToOspReceiver:', data.arrivalToOspReceiver);\n02039|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.arrivalToOspReceiver:', data?.arrivalToOspReceiver);\n02040|           \n02041|           // –ë–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–π –ø–æ–∏—Å–∫ –≤–æ –≤—Å–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ data\n02042|           const findDateInObject = (obj: any, fieldName: string): string | null => {\n02043|             if (!obj || typeof obj !== 'object') return null;\n02044|             \n02045|             for (const [key, value] of Object.entries(obj)) {\n02046|               if (key === fieldName && typeof value === 'string') {\n02047|                 return value;\n02048|               }\n02049|               if (typeof value === 'object' && value !== null) {\n02050|                 const found = findDateInObject(value, fieldName);\n02051|                 if (found) return found;\n02052|               }\n02053|             }\n02054|             return null;\n02055|           };\n02056|           \n02057|           const pickup = findDateInObject(data, 'pickup');\n02058|           const arrivalToOspReceiver = findDateInObject(data, 'arrivalToOspReceiver');\n02059|           \n02060|           console.log('–ù–ê–ô–î–ï–ù–ù–´–ï –î–ê–¢–´:');\n02061|           console.log('pickup:', pickup);\n02062|           console.log('arrivalToOspReceiver:', arrivalToOspReceiver);\n02063|           \n02064|           if (pickup && arrivalToOspReceiver) {\n02065|             // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—ã (—Ñ–æ—Ä–º–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å \"2025-09-27\" –∏–ª–∏ \"2025-09-27 10:00:00\")\n02066|             const pickupDate = new Date(pickup);\n02067|             const arrivalDate = new Date(arrivalToOspReceiver);\n02068|             \n02069|             console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ pickup:', pickupDate);\n02070|             console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ arrival:', arrivalDate);\n02071|             \n02072|             // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã\n02073|             if (!isNaN(pickupDate.getTime()) && !isNaN(arrivalDate.getTime())) {\n02074|               // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–æ—Å—Ç—å –≤ –¥–Ω—è—Ö\n02075|               const timeDiff = arrivalDate.getTime() - pickupDate.getTime();\n02076|               deliveryDays = Math.max(1, Math.ceil(timeDiff / (1000 * 3600 * 24))); // –ú–∏–Ω–∏–º—É–º 1 –¥–µ–Ω—å\n02077|               \n02078|               console.log('–†–∞–∑–Ω–æ—Å—Ç—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö:', timeDiff);\n02079|               console.log('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –í–´–ß–ò–°–õ–ï–ù —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:', deliveryDays, '–¥–Ω–µ–π');\n02080|             } else {\n02081|               console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞—Ç—ã –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞');\n02082|               console.error('pickup Date object:', pickupDate);\n02083|               console.error('arrival Date object:', arrivalDate);\n02084|             }\n02085|           } else {\n02086|             console.warn('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ –Ω–∞–π–¥–µ–Ω—ã –¥–∞—Ç—ã pickup –∏–ª–∏ arrivalToOspReceiver');\n02087|             console.log('pickup –Ω–∞–π–¥–µ–Ω:', !!pickup, pickup);\n02088|             console.log('arrivalToOspReceiver –Ω–∞–π–¥–µ–Ω:', !!arrivalToOspReceiver, arrivalToOspReceiver);\n02089|           }\n02090|         } catch (error) {\n02091|           console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –û—à–∏–±–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:', error);\n02092|         }\n02093| \n02094|         console.log('üí∞ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ò–¢–û–ì–û–í–ê–Ø –°–¢–û–ò–ú–û–°–¢–¨:', Math.round(totalPrice));\n02095|         \n02096|         return {\n02097|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n02098|           price: Math.round(totalPrice),\n02099|           days: deliveryDays || 0,\n02100|           details: data.data || {},\n02101|           requestData,\n02102|           responseData: data,\n02103|           apiUrl,\n02104|           sessionId: sessionID\n02105|         };\n02106|       } else {\n02107|         const errorMessage = data.metadata?.detail || \n02108|                            data.metadata?.message || \n02109|                            data.errors?.[0]?.detail || \n02110|                            (data.metadata?.status !== 200 ? `HTTP ${data.metadata?.status}` : '') ||\n02111|                            '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏';\n02112|         return {\n02113|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n02114|           price: 0,\n02115|           days: 0,\n02116|           error: errorMessage,\n02117|           requestData,\n02118|           responseData: data,\n02119|           apiUrl,\n02120|           sessionId: sessionID\n02121|         };\n02122|       }\n02123|     } catch (error: any) {\n02124|       return {\n02125|         company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n02126|         price: 0,\n02127|         days: 0,\n02128|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n02129|         requestData: null,\n02130|         responseData: null,\n02131|         apiUrl\n02132|       };\n02133|     }\n02134|   };\n02135| \n02136| \n02137| \n02138|   // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–Ω–æ–π –∑–æ–Ω—ã –∏ —Å–∫–ª–∞–¥–∞ –ü–≠–ö –ø–æ –∞–¥—Ä–µ—Å—É —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏\n02139|   const getPekZoneByAddress = async (address: string) => {\n02140|     try {\n02141|       console.log(`üîç –ü–≠–ö: –ø–æ–∏—Å–∫ –∑–æ–Ω—ã –¥–ª—è –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n02142| \n02143|       const result = await enhancedApiRequest(\n02144|         '/api/pek',\n02145|         {\n02146|           method: 'POST',\n02147|           headers: {\n02148|             'Content-Type': 'application/json',\n02149|           },\n02150|           body: JSON.stringify({\n02151|             method: 'findzonebyaddress',\n02152|             address: address\n02153|           })\n02154|         },\n02155|         { operation: 'findzonebyaddress', company: '–ü–≠–ö' }\n02156|       );\n02157| \n02158|       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n02159|         console.error(`‚ùå –ü–≠–ö API –æ—à–∏–±–∫–∞:`, result.error);\n02160|         console.log(`üîÑ –ü–≠–ö: –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥—É –¥–ª—è \"${address}\"`);\n02161|         return getPekZoneFallback(address);\n02162|       }\n02163| \n02164|       const response = result as Response;\n02165|       console.log(`üì° –ü–≠–ö API —Å—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`);\n02166| \n02167|       if (!response.ok) {\n02168|         let errorData;\n02169|         try {\n02170|           errorData = await response.json();\n02171|         } catch {\n02172|           errorData = { error: '–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç' };\n02173|         }\n02174| \n02175|         console.error(`‚ùå –ü–≠–ö API –æ—à–∏–±–∫–∞ ${response.status}:`, errorData);\n02176| \n02177|         // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫\n02178|         if (response.status === 401) {\n02179|           console.error('‚ùå –ü–≠–ö: –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω');\n02180|         } else if (response.status === 404) {\n02181|           console.error('‚ùå –ü–≠–ö: –ú–µ—Ç–æ–¥ API –Ω–µ –Ω–∞–π–¥–µ–Ω');\n02182|         } else if (response.status === 400) {\n02183|           console.error('‚ùå –ü–≠–ö: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞');\n02184|         } else if (response.status >= 500) {\n02185|           console.error('‚ùå –ü–≠–ö: –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ü–≠–ö');\n02186|         }\n02187| \n02188|         console.log(`üîÑ –ü–≠–ö: –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥—É –¥–ª—è \"${address}\"`);\n02189|         return getPekZoneFallback(address);\n02190|       }\n02191| \n02192|       const data = await response.json();\n02193|       console.log(`‚úÖ –ü–≠–ö –∑–æ–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞:`, data);\n02194| \n02195|       if (data.zoneId && data.mainWarehouseId) {\n02196|         return {\n02197|           zoneId: data.zoneId,\n02198|           zoneName: data.zoneName,\n02199|           branchUID: data.branchUID,\n02200|           branchCode: data.branchCode,\n02201|           branchTitle: data.branchTitle,\n02202|           mainWarehouseId: data.mainWarehouseId,\n02203|           warehousePoint: data.warehousePoint,\n02204|           geoData: data.GeoData,\n02205|           precision: data.GeoData?.precision\n02206|         };\n02207|       }\n02208| \n02209|       console.warn(`‚ö†Ô∏è –ü–≠–ö: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç:`, data);\n02210|       return getPekZoneFallback(address);\n02211| \n02212|     } catch (error) {\n02213|       console.error('‚ùå –ü–≠–ö: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∑–æ–Ω—ã:', error);\n02214|       return getPekZoneFallback(address);\n02215|     }\n02216|   };\n02217| \n02218|   // –§–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–æ–Ω—ã –ü–≠–ö\n02219|   const getPekZoneFallback = (address: string) => {\n02220|     console.log(`üîÑ –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –∞–Ω–∞–ª–∏–∑ –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n02221|     \n02222|     const addressLower = address.toLowerCase();\n02223|     \n02224|     // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –∏ –∏—Ö –¥–∞–Ω–Ω—ã–µ\n02225|     const cityMappings: { [key: string]: any } = {\n02226|       '–º–æ—Å–∫–≤–∞': {\n02227|         zoneId: 'moscow-zone-001',\n02228|         zoneName: '–ú–æ—Å–∫–≤–∞',\n02229|         branchUID: 'moscow-branch-001',\n02230|         branchCode: '–ú–°–ö',\n02231|         branchTitle: '–ú–æ—Å–∫–≤–∞',\n02232|         mainWarehouseId: 'dc6c746d-812d-11e4-bbfc-001999d8b3c5',\n02233|         warehousePoint: {\n02234|           latitude: 55.755826,\n02235|           longitude: 37.6173\n02236|         }\n02237|       },\n02238|       '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': {\n02239|         zoneId: 'spb-zone-001',\n02240|         zoneName: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n02241|         branchUID: 'spb-branch-001',\n02242|         branchCode: '–°–ü–ë',\n02243|         branchTitle: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n02244|         mainWarehouseId: 'b436c978-086d-11e6-b6ca-00155d668909',\n02245|         warehousePoint: {\n02246|           latitude: 59.9311,\n02247|           longitude: 30.3609\n02248|         }\n02249|       },\n02250|       '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': {\n02251|         zoneId: 'ekb-zone-001',\n02252|         zoneName: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',\n02253|         branchUID: 'ekb-branch-001',\n02254|         branchCode: '–ï–ö–ë',\n02255|         branchTitle: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',\n02256|         mainWarehouseId: 'f8d9c8e3-8e2d-11e4-bbfc-001999d8b3c5',\n02257|         warehousePoint: {\n02258|           latitude: 56.8431,\n02259|           longitude: 60.6454\n02260|         }\n02261|       }\n02262|     };\n02263|     \n02264|     for (const [city, data] of Object.entries(cityMappings)) {\n02265|       if (addressLower.includes(city) || addressLower.includes(city.replace('-', ' '))) {\n02266|         console.log(`‚úÖ –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –Ω–∞–π–¥–µ–Ω –≥–æ—Ä–æ–¥ ${city}`);\n02267|         return {\n02268|           ...data,\n02269|           geoData: {\n02270|             precision: 'fallback',\n02271|             kind: 'locality'\n02272|           },\n02273|           precision: 'fallback'\n02274|         };\n02275|       }\n02276|     }\n02277|     \n02278|     console.warn(`‚ùå –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –≥–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ \"${address}\"`);\n02279|     return null;\n02280|   };\n02281| \n02282|   // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –ü–≠–ö\n02283|   const getPekNearestDepartments = async (address: string, coordinates?: { latitude: string, longitude: string }) => {\n02284|     try {\n02285|       console.log(`üè¢ –ü–≠–ö: –ø–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –¥–ª—è \"${address}\"`);\n02286| \n02287|       const requestBody: any = {\n02288|         departmentOperation: 3, // –≤—ã–¥–∞—á–∞ –≥—Ä—É–∑–æ–≤\n02289|         type: 3, // –∞–≤—Ç–æ-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç\n02290|         searchRadius: 50, // –∫–º\n02291|         limit: 5\n02292|       };\n02293| \n02294|       // –ü–≠–ö API —Ç—Ä–µ–±—É–µ—Ç –∏ –∞–¥—Ä–µ—Å, –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ\n02295|       requestBody.address = address;\n02296| \n02297|       if (coordinates) {\n02298|         requestBody.coordinates = coordinates;\n02299|         console.log(`üìç –ü–≠–ö: –ø–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\" –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º`, coordinates);\n02300|       } else {\n02301|         console.log(`üìç –ü–≠–ö: –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\"`);\n02302|       }\n02303| \n02304|       const result = await enhancedApiRequest(\n02305|         '/api/pek',\n02306|         {\n02307|           method: 'POST',\n02308|           headers: {\n02309|             'Content-Type': 'application/json',\n02310|           },\n02311|           body: JSON.stringify({\n02312|             method: 'nearestdepartments',\n02313|             ...requestBody\n02314|           })\n02315|         },\n02316|         { operation: 'nearestdepartments', company: '–ü–≠–ö' }\n02317|       );\n02318| \n02319|       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n02320|         console.error(`‚ùå –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API –æ—à–∏–±–∫–∞:`, result.error);\n02321|         return null;\n02322|       }\n02323| \n02324|       const response = result as Response;\n02325|       console.log(`üì° –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API —Å—Ç–∞—Ç—É—Å: ${response.status}`);\n02326| \n02327|       if (!response.ok) {\n02328|         const errorText = await response.text();\n02329|         console.error(`‚ùå –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API –æ—à–∏–±–∫–∞: ${response.status} ${response.statusText}`);\n02330|         console.error(`‚ùå –û—Ç–≤–µ—Ç:`, errorText.substring(0, 500));\n02331|         return null;\n02332|       }\n02333| \n02334|       const data = await response.json();\n02335|       console.log(`‚úÖ –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–∞–π–¥–µ–Ω—ã:`, data);\n02336| \n02337|       // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤–æ–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ —Å –Ω–∞–∏–≤—ã—Å—à–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º\n02338|       if (data.freeDepartments && data.freeDepartments.length > 0) {\n02339|         const bestDepartment = data.freeDepartments.sort((a: any, b: any) => b.priority - a.priority)[0];\n02340|         console.log(`‚úÖ –ü–≠–ö: –≤—ã–±—Ä–∞–Ω–æ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ`, bestDepartment.divisionName);\n02341|         return {\n02342|           warehouseId: bestDepartment.warehouseId,\n02343|           branchId: bestDepartment.branchId,\n02344|           branchName: bestDepartment.branchName,\n02345|           divisionName: bestDepartment.divisionName,\n02346|           address: bestDepartment.address,\n02347|           coordinates: bestDepartment.coordinates,\n02348|           phone: bestDepartment.phone,\n02349|           email: bestDepartment.email\n02350|         };\n02351|       }\n02352| \n02353|       console.warn(`‚ùå –ü–≠–ö: –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è \"${address}\"`);\n02354|       return null;\n02355|     } catch (error) {\n02356|       console.error('‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –æ—Ç–¥–µ–ª–µ–Ω–∏–π:', error);\n02357|       return null;\n02358|     }\n02359|   };\n02360| \n02361|   // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ü–≠–ö)\n02362|   const getYandexCoordinates = async (address: string): Promise<{ latitude: string, longitude: string } | null> => {\n02363|     try {\n02364|       const encodedAddress = encodeURIComponent(address);\n02365|       const response = await fetch(`https://geocode-maps.yandex.ru/1.x/?apikey=YOUR_API_KEY&geocode=${encodedAddress}&format=json`);\n02366|       \n02367|       if (!response.ok) return null;\n02368|       \n02369|       const data = await response.json();\n02370|       const coords = data?.response?.GeoObjectCollection?.featureMember?.[0]?.GeoObject?.Point?.pos?.split(' ');\n02371|       \n02372|       if (coords && coords.length === 2) {\n02373|         return {\n02374|           longitude: coords[0],\n02375|           latitude: coords[1]\n02376|         };\n02377|       }\n02378|       \n02379|       return null;\n02380|     } catch (error) {\n02381|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ø–Ω–¥–µ–∫—Å:', error);\n02382|       return null;\n02383|     }\n02384|   };\n02385| \n02386|   // –†–∞—Å—á–µ—Ç –¥–ª—è –ü–≠–ö —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API v1/calculateprice/\n02387|   const calculatePEK = async (): Promise<CalculationResult> => {\n02388|     const apiUrl = 'https://kabinet.pecom.ru/api/v1/calculateprice/';\n02389|     \n02390|     // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç\n02391|     const validateCoordinates = (coords: any) => {\n02392|       console.log('üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:', coords);\n02393|       \n02394|       if (!coords) {\n02395|         console.log('‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç');\n02396|         return null;\n02397|       }\n02398|       \n02399|       if (typeof coords.latitude !== 'number' || typeof coords.longitude !== 'number') {\n02400|         console.warn(`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ —è–≤–ª—è—é—Ç—Å—è —á–∏—Å–ª–∞–º–∏:`, { \n02401|           lat: coords.latitude, \n02402|           lng: coords.longitude,\n02403|           latType: typeof coords.latitude,\n02404|           lngType: typeof coords.longitude\n02405|         });\n02406|         return null;\n02407|       }\n02408|       \n02409|       const lat = Number(coords.latitude);\n02410|       const lng = Number(coords.longitude);\n02411|       \n02412|       console.log(`üìç –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: lat=${lat}, lng=${lng}`);\n02413|       \n02414|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω—ã\n02415|       if (lat < -90 || lat > 90 || lng < -180 || lng > 180 || isNaN(lat) || isNaN(lng)) {\n02416|         console.warn(`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–Ω–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞:`, { \n02417|           lat, lng, \n02418|           latValid: lat >= -90 && lat <= 90,\n02419|           lngValid: lng >= -180 && lng <= 180,\n02420|           latIsNaN: isNaN(lat),\n02421|           lngIsNaN: isNaN(lng)\n02422|         });\n02423|         return null;\n02424|       }\n02425|       \n02426|       console.log('‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã:', { latitude: lat, longitude: lng });\n02427|       return { latitude: lat, longitude: lng };\n02428|     };\n02429|     \n02430|     try {\n02431|       // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–æ–Ω–∞—Ö –∏ —Å–∫–ª–∞–¥–∞—Ö –ø–æ –∞–¥—Ä–µ—Å–∞–º\n02432|       console.log(`üöÄ –ü–≠–ö: –Ω–∞—á–∏–Ω–∞–µ–º —Ä–∞—Å—á–µ—Ç`);\n02433|       console.log(`üìç –û—Ç: ${form.fromAddress || form.fromCity}`);\n02434|       console.log(`üìç –î–æ: ${form.toAddress || form.toCity}`);\n02435|       \n02436|       const senderZone = await getPekZoneByAddress(form.fromAddress || `–≥ ${form.fromCity}`);\n02437|       const receiverZone = await getPekZoneByAddress(form.toAddress || `–≥ ${form.toCity}`);\n02438|       \n02439|       console.log(`üîç –ü–≠–ö –∑–æ–Ω—ã:`);\n02440|       console.log(`üìç –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å:`, senderZone ? `${senderZone.branchTitle} (${senderZone.mainWarehouseId})` : '–ù–ï –ù–ê–ô–î–ï–ù–ê');\n02441|       console.log(`üìç –ü–æ–ª—É—á–∞—Ç–µ–ª—å:`, receiverZone ? `${receiverZone.branchTitle} (${receiverZone.mainWarehouseId})` : '–ù–ï –ù–ê–ô–î–ï–ù–ê');\n02442|       \n02443|       if (!senderZone || !receiverZone) {\n02444|         // –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞\n02445|         const debugInfo = {\n02446|           senderAddress: form.fromAddress || form.fromCity,\n02447|           receiverAddress: form.toAddress || form.toCity,\n02448|           senderZoneFound: !!senderZone,\n02449|           receiverZoneFound: !!receiverZone,\n02450|           apiTested: true\n02451|         };\n02452|         \n02453|         console.error(`‚ùå –ü–≠–ö: –∑–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã`, debugInfo);\n02454|         \n02455|         return {\n02456|           company: '–ü–≠–ö',\n02457|           price: 0,\n02458|           days: 0,\n02459|           error: `–ó–æ–Ω–∞ –ü–≠–ö –Ω–µ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥—Ä–µ—Å–∞: ${!senderZone ? (form.fromAddress || form.fromCity) : ''} ${!receiverZone ? (form.toAddress || form.toCity) : ''}`.trim(),\n02460|           apiUrl,\n02461|           requestData: debugInfo,\n02462|           responseData: { senderZone, receiverZone }\n02463|         };\n02464|       }\n02465| \n02466|       // –ü–æ–ª—É—á–∞–µ–º –±–ª–∏–∂–∞–π—à–∏–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –∞–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞\n02467|       let senderWarehouseId = senderZone.mainWarehouseId;\n02468|       let receiverWarehouseId = receiverZone.mainWarehouseId;\n02469|       \n02470|       if (form.fromAddressDelivery && senderZone.warehousePoint) {\n02471|         const validSenderCoords = validateCoordinates(senderZone.warehousePoint);\n02472|         if (validSenderCoords) {\n02473|           try {\n02474|             const senderDepartment = await getPekNearestDepartments(\n02475|               form.fromAddress || form.fromCity,\n02476|               {\n02477|                 latitude: validSenderCoords.latitude.toString(),\n02478|                 longitude: validSenderCoords.longitude.toString()\n02479|               }\n02480|             );\n02481|             if (senderDepartment) {\n02482|               senderWarehouseId = senderDepartment.warehouseId;\n02483|               console.log('‚úÖ –ù–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π —Å–∫–ª–∞–¥ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è:', senderDepartment.warehouseId);\n02484|             }\n02485|           } catch (error) {\n02486|             console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥:', error);\n02487|           }\n02488|         } else {\n02489|           console.warn('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥');\n02490|         }\n02491|       }\n02492|       \n02493|       if (form.toAddressDelivery && receiverZone.warehousePoint) {\n02494|         const validReceiverCoords = validateCoordinates(receiverZone.warehousePoint);\n02495|         if (validReceiverCoords) {\n02496|           try {\n02497|             const receiverDepartment = await getPekNearestDepartments(\n02498|               form.toAddress || form.toCity,\n02499|               {\n02500|                 latitude: validReceiverCoords.latitude.toString(),\n02501|                 longitude: validReceiverCoords.longitude.toString()\n02502|               }\n02503|             );\n02504|             if (receiverDepartment) {\n02505|               receiverWarehouseId = receiverDepartment.warehouseId;\n02506|               console.log('‚úÖ –ù–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π —Å–∫–ª–∞–¥ –ø–æ–ª—É—á–∞—Ç–µ–ª—è:', receiverDepartment.warehouseId);\n02507|             }\n02508|           } catch (error) {\n02509|             console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥:', error);\n02510|           }\n02511|         } else {\n02512|           console.warn('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥');\n02513|         }\n02514|       }\n02515| \n02516|       // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞—Ç—ã N –¥–Ω–µ–π –æ—Ç —Å–µ–≥–æ–¥–Ω—è\n02517|       const getDateForCalculation = (daysFromToday: number): string => {\n02518|         const date = new Date();\n02519|         date.setDate(date.getDate() + daysFromToday);\n02520|         return date.toISOString().slice(0, 19); // 2025-09-28T14:00:00\n02521|       };\n02522| \n02523|       // –ù–∞—á–∏–Ω–∞–µ–º —Å –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–≥–æ –¥–Ω—è\n02524|       let currentDayOffset = 1;\n02525|       let plannedDateTime = getDateForCalculation(currentDayOffset);\n02526| \n02527|       // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤ (–±–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç)\n02528|       const cargos = form.cargos.map(cargo => {\n02529|         const cargoData = {\n02530|           length: cargo.length / 100, // –ø–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–µ—Ç—Ä—ã\n02531|           width: cargo.width / 100,\n02532|           height: cargo.height / 100,\n02533|           volume: (cargo.length * cargo.width * cargo.height) / 1000000, // –º3\n02534|           weight: cargo.weight,\n02535|           isHP: form.needPackaging, // –∑–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n02536|           sealingPositionsCount: 0\n02537|         };\n02538|         \n02539|         console.log('üì¶ –ì—Ä—É–∑ –¥–ª—è –ü–≠–ö:', cargoData);\n02540|         return cargoData;\n02541|       });\n02542| \n02543|       // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (–Ω—É–∂–Ω–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ)\n02544|       let finalRequestData: any = null;\n02545|       \n02546|       // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ —Ä–∞—Å—á–µ—Ç–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç–æ–π\n02547|       const tryCalculateWithDate = async (plannedDateTime: string): Promise<any> => {\n02548|         // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –∫ API –ü–≠–ö —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n02549|         const requestData: any = {\n02550|           currencyCode: \"643\", // —Ä—É–±–ª–∏\n02551|           types: [3], // —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ –ø–µ—Ä–µ–≤–æ–∑–∫–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –º–∞—Å—Å–∏–≤)\n02552|           senderWarehouseId,\n02553|           receiverWarehouseId,\n02554|           isOpenCarSender: false,\n02555|           isOpenCarReceiver: false,\n02556|           isHyperMarket: false,\n02557|           plannedDateTime,\n02558|           isInsurance: form.needInsurance && form.declaredValue > 0,\n02559|           isInsurancePrice: form.needInsurance ? form.declaredValue : 0,\n02560|           isPickUp: form.fromAddressDelivery,\n02561|           isDelivery: form.toAddressDelivery,\n02562|           needReturnDocuments: false,\n02563|           needArrangeTransportationDocuments: false,\n02564|           senderDistanceType: 0,\n02565|           receiverDistanceType: 0,\n02566|           cargos // –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤\n02567|         };\n02568|         \n02569|         console.log('üìã –ü–≠–ö: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ requestData:', JSON.stringify(requestData, null, 2));\n02570| \n02571|         // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏ –ü–†–† –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\n02572|         if (form.needCarry) {\n02573|           requestData.pickupServices = {\n02574|             isLoading: true,\n02575|             floor: Math.max(0, form.floor - 1), // –ü–≠–ö —Å—á–∏—Ç–∞–µ—Ç —Å 0\n02576|             carryingDistance: 0,\n02577|             isElevator: form.hasFreightLift\n02578|           };\n02579|           requestData.deliveryServices = {\n02580|             isLoading: true,\n02581|             floor: Math.max(0, form.floor - 1),\n02582|             carryingDistance: 0,\n02583|             isElevator: form.hasFreightLift\n02584|           };\n02585|         }\n02586| \n02587|         // –î–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫–∏ pickup/delivery —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ü–≠–ö\n02588|         if (form.fromAddressDelivery) {\n02589|           console.log('üìç –ü–≠–ö: –¥–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ pickup –¥–ª—è –∑–∞–±–æ—Ä–∞');\n02590|           requestData.pickup = {\n02591|             address: form.fromAddress || `–†–æ—Å—Å–∏—è, ${form.fromCity}`\n02592|             // coordinates –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏\n02593|           };\n02594|         }\n02595|         \n02596|         if (form.toAddressDelivery) {\n02597|           console.log('üìç –ü–≠–ö: –¥–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ delivery –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏');\n02598|           requestData.delivery = {\n02599|             address: form.toAddress || `–†–æ—Å—Å–∏—è, ${form.toCity}`\n02600|             // coordinates –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏\n02601|           };\n02602|         }\n02603| \n02604|         // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n02605|         const requiredFields = ['types', 'senderWarehouseId', 'receiverWarehouseId', 'plannedDateTime', 'cargos'];\n02606|         const missingFields = requiredFields.filter(field => !requestData[field]);\n02607|         \n02608|         if (missingFields.length > 0) {\n02609|           throw new Error(`–ü–≠–ö: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: ${missingFields.join(', ')}`);\n02610|         }\n02611|         \n02612|         if (!Array.isArray(requestData.types) || requestData.types.length === 0) {\n02613|           throw new Error('–ü–≠–ö: –ø–æ–ª–µ types –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º');\n02614|         }\n02615|         \n02616|         if (!Array.isArray(requestData.cargos) || requestData.cargos.length === 0) {\n02617|           throw new Error('–ü–≠–ö: –ø–æ–ª–µ cargos –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º');\n02618|         }\n02619|         \n02620|         console.log('‚úÖ –ü–≠–ö: –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –ø—Ä–æ–π–¥–µ–Ω–∞');\n02621| \n02622|         // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏\n02623|         finalRequestData = {\n02624|           method: 'calculateprice',\n02625|           ...requestData\n02626|         };\n02627|         \n02628|         console.log('üöÄ –ü–≠–ö API –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å:', JSON.stringify(finalRequestData, null, 2));\n02629|         console.log('üåê –ü–≠–ö API URL:', apiUrl);\n02630|         console.log('üìã –ü–≠–ö: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–ø–æ–≤ —Ç–∞—Ä–∏—Ñ–æ–≤:', requestData.types.length);\n02631|         console.log('üìã –ü–≠–ö: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤:', requestData.cargos.length);\n02632|       \n02633|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π\n02634|       if (finalRequestData.pickup?.coordinates) {\n02635|         console.log('üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã pickup:', finalRequestData.pickup.coordinates);\n02636|       }\n02637|       if (finalRequestData.delivery?.coordinates) {\n02638|         console.log('üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã delivery:', finalRequestData.delivery.coordinates);\n02639|       }\n02640| \n02641|        const result = await enhancedApiRequest(\n02642|          '/api/pek',\n02643|          {\n02644|            method: 'POST',\n02645|            headers: {\n02646|              'Content-Type': 'application/json',\n02647|            },\n02648|            body: JSON.stringify(finalRequestData)\n02649|          },\n02650|          { operation: 'calculateprice', company: '–ü–≠–ö' }\n02651|        );\n02652| \n02653|        if (result && typeof result === 'object' && 'success' in result && !result.success) {\n02654|          console.error('‚ùå –ü–≠–ö API —Ä–∞—Å—á–µ—Ç –æ—à–∏–±–∫–∞:', result.error);\n02655|          throw new Error(result.error.userMessage || result.error.message);\n02656|        }\n02657| \n02658|        const response = result as Response;\n02659|        console.log(`üì° –ü–≠–ö API —Ä–∞—Å—á–µ—Ç —Å—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`);\n02660|        console.log(`üì° –ü–≠–ö API URL: ${response.url}`);\n02661| \n02662|        const responseText = await response.text();\n02663|        console.log(`üì° –ü–≠–ö API —Å—ã—Ä–æ–π –æ—Ç–≤–µ—Ç:`, responseText.substring(0, 1000));\n02664| \n02665|        let data;\n02666|        try {\n02667|          data = JSON.parse(responseText);\n02668|          console.log('üöÄ –ü–≠–ö API –æ—Ç–≤–µ—Ç:', JSON.stringify(data, null, 2));\n02669|        } catch (parseError) {\n02670|          console.error('‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', parseError);\n02671|          throw new Error(`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç API: ${responseText.substring(0, 200)}`);\n02672|        }\n02673| \n02674|         return { response, data };\n02675|       };\n02676| \n02677|       // –î–æ–±–∞–≤–ª—è–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞—Å—á–µ—Ç–∞\n02678|       console.log('üîß –ü–≠–ö: –≥–æ—Ç–æ–≤–∏–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞...');\n02679|       console.log('üìç senderWarehouseId:', senderWarehouseId);\n02680|       console.log('üìç receiverWarehouseId:', receiverWarehouseId);\n02681|       console.log('üìÖ –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞:', plannedDateTime);\n02682|       console.log('üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤:', cargos.length);\n02683|       console.log('üîß form.fromAddressDelivery:', form.fromAddressDelivery);\n02684|       console.log('üîß form.toAddressDelivery:', form.toAddressDelivery);\n02685|       \n02686|       // –¶–∏–∫–ª –ø–æ–ø—ã—Ç–æ–∫ —Å —Ä–∞–∑–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏ (–º–∞–∫—Å–∏–º—É–º 7 –¥–Ω–µ–π)\n02687|       const maxRetries = 7;\n02688|       let lastError: Error | null = null;\n02689|       \n02690|       console.log('üöÄ –ü–≠–ö: –∑–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª —Ä–∞—Å—á–µ—Ç–∞...');\n02691|       \n02692|       for (let attempt = 0; attempt < maxRetries; attempt++) {\n02693|         try {\n02694|           console.log(`üìÖ –ü–≠–ö: –ø–æ–ø—ã—Ç–∫–∞ ${attempt + 1}/${maxRetries}, –¥–∞—Ç–∞: ${plannedDateTime}`);\n02695|           \n02696|           const { response, data } = await tryCalculateWithDate(plannedDateTime);\n02697|           \n02698|           if (response.ok && !data.hasError && data.transfers && data.transfers.length > 0) {\n02699|             const transfer = data.transfers[0]; // –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Ç–∞—Ä–∏—Ñ (–∞–≤—Ç–æ)\n02700|             \n02701|             if (!transfer.hasError) {\n02702|           // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —É—Å–ª—É–≥\n02703|           const services: { name: string; description: string; price: number }[] = [];\n02704|           let totalCalculated = 0;\n02705| \n02706|           const processServices = (servicesList: any[], parentName = '') => {\n02707|             servicesList.forEach(service => {\n02708|               const serviceName = parentName ? `${parentName} - ${service.info}` : service.info;\n02709|               const serviceCost = parseFloat(service.cost) || 0;\n02710|               \n02711|               if (serviceCost > 0) {\n02712|                 services.push({\n02713|                   name: serviceName,\n02714|                   description: service.serviceType || '',\n02715|                   price: serviceCost\n02716|                 });\n02717|                 totalCalculated += serviceCost;\n02718|               }\n02719| \n02720|               // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏\n02721|               if (service.services && Array.isArray(service.services)) {\n02722|                 processServices(service.services, serviceName);\n02723|               }\n02724|             });\n02725|           };\n02726| \n02727|           if (transfer.services) {\n02728|             processServices(transfer.services);\n02729|           }\n02730| \n02731|           // –ï—Å–ª–∏ –Ω–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —É—Å–ª—É–≥, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n02732|           if (services.length === 0) {\n02733|             services.push({\n02734|               name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n02735|               description: `${senderZone.branchTitle} - ${receiverZone.branchTitle}`,\n02736|               price: Math.round(transfer.costTotal)\n02737|             });\n02738|           }\n02739| \n02740|           return {\n02741|             company: '–ü–≠–ö',\n02742|             price: Math.round(transfer.costTotal),\n02743|             days: transfer.estDeliveryTime || 3,\n02744|             details: {\n02745|               note: `–î–æ—Å—Ç–∞–≤–∫–∞ ${senderZone.branchTitle} - ${receiverZone.branchTitle} (–∞–≤—Ç–æ)`,\n02746|               services,\n02747|               senderZone: {\n02748|                 title: senderZone.branchTitle,\n02749|                 zone: senderZone.zoneName,\n02750|                 warehouseId: senderWarehouseId\n02751|               },\n02752|               receiverZone: {\n02753|                 title: receiverZone.branchTitle,\n02754|                 zone: receiverZone.zoneName,\n02755|                 warehouseId: receiverWarehouseId\n02756|               }\n02757|             },\n02758|             requestData: finalRequestData,\n02759|             responseData: data,\n02760|             apiUrl\n02761|               };\n02762|             } else {\n02763|               // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ–±–ª–µ–º–æ–π —Å –¥–∞—Ç–æ–π\n02764|               const errorMessage = transfer.errorMessage || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞ –ü–≠–ö';\n02765|               if (errorMessage.includes('–∑–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω') || errorMessage.includes('–≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã')) {\n02766|                 console.log(`üìÖ –ü–≠–ö: ${errorMessage}. –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...`);\n02767|                 lastError = new Error(errorMessage);\n02768|                 // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é\n02769|                 currentDayOffset++;\n02770|                 plannedDateTime = getDateForCalculation(currentDayOffset);\n02771|                 continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –¥–∞—Ç—É\n02772|               } else {\n02773|                 throw new Error(errorMessage);\n02774|               }\n02775|             }\n02776|           } else {\n02777|             // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—à–∏–±–∫—É –Ω–∞ —É—Ä–æ–≤–Ω–µ –¥–∞–Ω–Ω—ã—Ö\n02778|             const errorMessage = data.errorMessage || data.message || '–û—à–∏–±–∫–∞ API –ü–≠–ö';\n02779|             if (errorMessage.includes('–∑–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω') || errorMessage.includes('–≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã')) {\n02780|               console.log(`üìÖ –ü–≠–ö: ${errorMessage}. –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...`);\n02781|               lastError = new Error(errorMessage);\n02782|               // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é\n02783|               currentDayOffset++;\n02784|               plannedDateTime = getDateForCalculation(currentDayOffset);\n02785|               continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –¥–∞—Ç—É\n02786|             } else {\n02787|               throw new Error(errorMessage);\n02788|             }\n02789|           }\n02790|         } catch (error: any) {\n02791|           console.error(`‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –Ω–∞ –ø–æ–ø—ã—Ç–∫–µ ${attempt + 1}:`, error.message);\n02792|           \n02793|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ–±–ª–µ–º–æ–π —Å –¥–∞—Ç–æ–π\n02794|           if (error.message?.includes('–∑–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω') || error.message?.includes('–≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã')) {\n02795|             console.log(`üìÖ –ü–≠–ö: –ø—Ä–æ–±–ª–µ–º–∞ —Å –¥–∞—Ç–æ–π. –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...`);\n02796|             lastError = error;\n02797|             // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é\n02798|             currentDayOffset++;\n02799|             plannedDateTime = getDateForCalculation(currentDayOffset);\n02800|             continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –¥–∞—Ç—É\n02801|           } else {\n02802|             // –î—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞ - –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ä–∞–∑—É\n02803|             throw error;\n02804|           }\n02805|         }\n02806|       }\n02807|       \n02808|       // –ï—Å–ª–∏ –¥–æ—à–ª–∏ –¥–æ —Å—é–¥–∞ - –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã\n02809|       console.error(`‚ùå –ü–≠–ö: –≤—Å–µ ${maxRetries} –ø–æ–ø—ã—Ç–æ–∫ –∏—Å—á–µ—Ä–ø–∞–Ω—ã. –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞:`, lastError?.message);\n02810|       throw lastError || new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—É—é –¥–∞—Ç—É –¥–ª—è –∑–∞–±–æ—Ä–∞ –≥—Ä—É–∑–∞');\n02811|       \n02812|     } catch (error: any) {\n02813|       console.error('üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ü–≠–ö API:', error);\n02814|       \n02815|       // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –æ—à–∏–±–∫–∏\n02816|       let errorDescription = '–û—à–∏–±–∫–∞ API –ü–≠–ö';\n02817|       \n02818|       if (error.message?.includes('Failed to fetch')) {\n02819|         errorDescription = 'API –ü–≠–ö –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';\n02820|       } else if (error.message?.includes('401')) {\n02821|         errorDescription = '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ü–≠–ö';\n02822|       } else if (error.message?.includes('400')) {\n02823|         errorDescription = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞';\n02824|       } else if (error.message?.includes('timeout')) {\n02825|         errorDescription = '–¢–∞–π–º-–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ API';\n02826|       }\n02827|       \n02828|       console.error(`üö® –ü–≠–ö: ${errorDescription}. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ñ–æ–ª–ª–±—ç–∫ —Ä–∞—Å—á–µ—Ç—É`);\n02829|       \n02830|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n02831|       const totalVolume = form.cargos.reduce((sum, cargo) => \n02832|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n02833|       );\n02834|       \n02835|       // –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π —Ñ–æ–ª–ª–±—ç–∫ —Ä–∞—Å—á–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Å–∞ –∏ –æ–±—ä–µ–º–∞\n02836|       let basePrice = Math.max(\n02837|         totalWeight * 18, // 18 —Ä—É–± –∑–∞ –∫–≥\n02838|         totalVolume * 4500 // 4500 —Ä—É–± –∑–∞ –º3\n02839|       );\n02840|       \n02841|       // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏\n02842|       const services: { name: string; description: string; price: number }[] = [];\n02843|       \n02844|       services.push({\n02845|         name: '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞',\n02846|         description: `${form.fromCity} - ${form.toCity} (${totalWeight} –∫–≥, ${totalVolume.toFixed(3)} –º¬≥)`,\n02847|         price: Math.round(basePrice)\n02848|       });\n02849|       \n02850|       if (form.fromAddressDelivery) {\n02851|         const pickupCost = 600;\n02852|         basePrice += pickupCost;\n02853|         services.push({\n02854|           name: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n02855|           description: '–û—Ç –∞–¥—Ä–µ—Å–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è',\n02856|           price: pickupCost\n02857|         });\n02858|       }\n02859|       \n02860|       if (form.toAddressDelivery) {\n02861|         const deliveryCost = 600;\n02862|         basePrice += deliveryCost;\n02863|         services.push({\n02864|           name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n02865|           description: '–î–æ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è',\n02866|           price: deliveryCost\n02867|         });\n02868|       }\n02869|       \n02870|       if (form.needInsurance && form.declaredValue > 0) {\n02871|         const insuranceCost = form.declaredValue * 0.012;\n02872|         basePrice += insuranceCost;\n02873|         services.push({\n02874|           name: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ',\n02875|           description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n02876|           price: Math.round(insuranceCost)\n02877|         });\n02878|       }\n02879|       \n02880|       if (form.needPackaging) {\n02881|         const packagingCost = totalWeight * 25;\n02882|         basePrice += packagingCost;\n02883|         services.push({\n02884|           name: '–ó–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞',\n02885|           description: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n02886|           price: Math.round(packagingCost)\n02887|         });\n02888|       }\n02889|       \n02890|       if (form.needCarry) {\n02891|         const carryCost = 500;\n02892|         basePrice += carryCost;\n02893|         services.push({\n02894|           name: '–ü–æ–¥—ä–µ–º –Ω–∞ —ç—Ç–∞–∂',\n02895|           description: `–ù–∞ ${form.floor} —ç—Ç–∞–∂ ${form.hasFreightLift ? '(—Å –ª–∏—Ñ—Ç–æ–º)' : '(–±–µ–∑ –ª–∏—Ñ—Ç–∞)'}`,\n02896|           price: carryCost\n02897|         });\n02898|       }\n02899|       \n02900|       return {\n02901|         company: '–ü–≠–ö',\n02902|         price: Math.round(basePrice),\n02903|         days: 3,\n02904|         details: {\n02905|           note: '–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º –ü–≠–ö (API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)',\n02906|           services,\n02907|           totalWeight,\n02908|           totalVolume,\n02909|           errorInfo: error.message\n02910|         },\n02911|         requestData: null,\n02912|         responseData: null,\n02913|         apiUrl,\n02914|         error: `${errorDescription}. –ü–æ–∫–∞–∑–∞–Ω –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º.`\n02915|       };\n02916|     }\n02917|   };\n02918| \n02919| \n02920| \n02921|   // üîß –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö\n02922|   const calculateOptimalLength = (cargos: typeof form.cargos) => {\n02923|     if (cargos.length === 1) {\n02924|       return cargos[0].length / 100; // –û–¥–Ω–æ –º–µ—Å—Ç–æ - —Ç–æ—á–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã\n02925|     }\n02926|     \n02927|     // –î–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç:\n02928|     const maxLength = Math.max(...cargos.map(c => c.length)) / 100;\n02929|     const totalLength = cargos.reduce((sum, c) => sum + c.length, 0) / 100;\n02930|     \n02931|     // –ï—Å–ª–∏ –º–µ—Å—Ç –º–Ω–æ–≥–æ (>3), –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É–º–º–∞—Ä–Ω—É—é –¥–ª–∏–Ω—É (–º–µ—Å—Ç–∞ –≤ —Ä—è–¥)\n02932|     // –ò–Ω–∞—á–µ - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é (–º–µ—Å—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ)\n02933|     return cargos.length > 3 ? totalLength : maxLength;\n02934|   };\n02935| \n02936|   const calculateOptimalWidth = (cargos: typeof form.cargos) => {\n02937|     // –î–ª—è —à–∏—Ä–∏–Ω—ã –ª–æ–≥–∏—á–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é\n02938|     return Math.max(...cargos.map(c => c.width)) / 100;\n02939|   };\n02940| \n02941|   const calculateOptimalHeight = (cargos: typeof form.cargos) => {\n02942|     if (cargos.length === 1) {\n02943|       return cargos[0].height / 100;\n02944|     }\n02945|     \n02946|     const maxHeight = Math.max(...cargos.map(c => c.height)) / 100;\n02947|     const totalHeight = cargos.reduce((sum, c) => sum + c.height, 0) / 100;\n02948|     \n02949|     // –ï—Å–ª–∏ –º–Ω–æ–≥–æ –º–µ–ª–∫–∏—Ö –º–µ—Å—Ç - –º–æ–∂–µ–º —Å—Ç–∞–∫–∏—Ä–æ–≤–∞—Ç—å\n02950|     const avgHeight = totalHeight / cargos.length;\n02951|     return avgHeight < 0.5 ? totalHeight : maxHeight; // 50—Å–º –ø–æ—Ä–æ–≥ –¥–ª—è —Å—Ç–∞–∫–∏—Ä–æ–≤–∞–Ω–∏—è\n02952|   };\n02953| \n02954|   // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç\n02955|   const validateMultipleCargos = (cargos: typeof form.cargos) => {\n02956|     if (!cargos || cargos.length === 0) {\n02957|       throw new Error('–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≥—Ä—É–∑–æ–≤—ã–µ –º–µ—Å—Ç–∞');\n02958|     }\n02959|     \n02960|     if (cargos.length > 50) {\n02961|       throw new Error(`–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç (${cargos.length}). –ú–∞–∫—Å–∏–º—É–º: 50`);\n02962|     }\n02963|     \n02964|     const totalVolume = cargos.reduce((sum, cargo) => \n02965|       sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n02966|     );\n02967|     \n02968|     if (totalVolume > 100) {\n02969|       console.warn('‚ö†Ô∏è –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π –æ–±—ä–µ–º –≥—Ä—É–∑–∞ (>100 –º¬≥). –í–æ–∑–º–æ–∂–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.');\n02970|     }\n02971|     \n02972|     return true;\n02973|   };\n02974| \n02975|   const calculateRailContinent = async (): Promise<CalculationResult> => {\n02976|     const apiUrl = '/api/rail-continent';\n02977|     \n02978|     try {\n02979|       // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n02980|       validateMultipleCargos(form.cargos);\n02981|       \n02982|       // –í—ã—á–∏—Å–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥—Ä—É–∑–∞\n02983|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n02984|       const totalVolume = form.cargos.reduce((sum, cargo) => \n02985|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n02986|       );\n02987|       \n02988|       // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–º–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n02989|       const optimalLength = calculateOptimalLength(form.cargos);\n02990|       const optimalWidth = calculateOptimalWidth(form.cargos);\n02991|       const optimalHeight = calculateOptimalHeight(form.cargos);\n02992|       \n02993|       // üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n02994|       console.log('üöÇ Rail Continent: –ê–Ω–∞–ª–∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç:');\n02995|       console.log(`   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç: ${form.cargos.length}`);\n02996|       console.log(`   - –û–±—â–∏–π –≤–µ—Å: ${totalWeight} –∫–≥`);\n02997|       console.log(`   - –û–±—â–∏–π –æ–±—ä–µ–º: ${totalVolume.toFixed(3)} –º¬≥`);\n02998|       \n02999|       form.cargos.forEach((cargo, index) => {\n03000|         console.log(`   üì¶ –ú–µ—Å—Ç–æ ${index + 1}:`);\n\n(File has more lines. Use 'offset' parameter to read beyond line 3000)\n</file>",
    "title": "app/page.tsx",
    "metadata": {
      "preview": "          console.log('üí∞ –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞—Ö–æ–≤–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ');\n        } else {\n          console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–≤–µ—Ç–µ');\n        }\n        \n        // –£–ü–ê–ö–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n        console.log('üí∞ –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–ë –£–ü–ê–ö–û–í–ö–ï (–£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –í –û–°–ù–û–í–ù–£–Æ –°–¢–û–ò–ú–û–°–¢–¨):');\n        console.log('üí∞ data.data.packages =', data.data.packages);\n        console.log('üí∞ form.needPackaging =', form.needPackaging);\n        \n        if (data.data.packages && form.needPackaging) {\n          console.log('üí∞ ‚úÖ –£–ü–ê–ö–û–í–ö–ê –ü–†–ò–°–£–¢–°–¢–í–£–ï–¢ –í –û–¢–í–ï–¢–ï (—Ü–µ–Ω–∞ —É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ data.data.price)');\n          console.log('üí∞ –¢–∏–ø packages:', Array.isArray(data.data.packages) ? 'Array' : 'Object');\n          \n          if (Array.isArray(data.data.packages)) {\n            data.data.packages.forEach((pkg: any, index: number) => {\n              console.log(`üí∞ Package [${index}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n            });\n          } else {\n            Object.entries(data.data.packages).forEach(([key, pkg]: [string, any]) => {"
    },
    "time": {
      "start": 1764032154172,
      "end": 1764032154179
    }
  }
}