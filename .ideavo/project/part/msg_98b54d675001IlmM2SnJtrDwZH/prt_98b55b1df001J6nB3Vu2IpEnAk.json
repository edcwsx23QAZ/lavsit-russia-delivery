{
  "id": "prt_98b55b1df001J6nB3Vu2IpEnAk",
  "messageID": "msg_98b54d675001IlmM2SnJtrDwZH",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "multiedit",
  "callID": "toolu_01PDaPa7cCkQdecbhr319V6U",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx",
      "edits": [
        {
          "oldString": "      if (form.fromAddressDelivery && senderZone.warehousePoint) {\n        const validSenderCoords = validateCoordinates(senderZone.warehousePoint);\n        if (validSenderCoords) {\n          const senderDepartment = await getPekNearestDepartments(\n            form.fromAddress || form.fromCity,\n            {\n              latitude: validSenderCoords.latitude.toString(),\n              longitude: validSenderCoords.longitude.toString()\n            }\n          );\n          if (senderDepartment) {\n            senderWarehouseId = senderDepartment.warehouseId;\n          }\n        } else {\n          console.warn('⚠️ Некорректные координаты отправителя, используем основной склад');\n        }\n      }",
          "newString": "      if (form.fromAddressDelivery && senderZone.warehousePoint) {\n        const validSenderCoords = validateCoordinates(senderZone.warehousePoint);\n        if (validSenderCoords) {\n          try {\n            const senderDepartment = await getPekNearestDepartments(\n              form.fromAddress || form.fromCity,\n              {\n                latitude: validSenderCoords.latitude.toString(),\n                longitude: validSenderCoords.longitude.toString()\n              }\n            );\n            if (senderDepartment) {\n              senderWarehouseId = senderDepartment.warehouseId;\n              console.log('✅ Найден ближайший склад отправителя:', senderDepartment.warehouseId);\n            }\n          } catch (error) {\n            console.warn('⚠️ Ошибка поиска ближайших отделений отправителя, используем основной склад:', error);\n          }\n        } else {\n          console.warn('⚠️ Некорректные координаты отправителя, используем основной склад');\n        }\n      }"
        }
      ]
    },
    "output": "",
    "metadata": {
      "results": [
        {
          "diagnostics": {},
          "diff": "Index: /home/user/project/app/page.tsx\n===================================================================\n--- /home/user/project/app/page.tsx\n+++ /home/user/project/app/page.tsx\n@@ -1146,17 +1146,22 @@\n \n if (form.fromAddressDelivery && senderZone.warehousePoint) {\n   const validSenderCoords = validateCoordinates(senderZone.warehousePoint);\n   if (validSenderCoords) {\n-    const senderDepartment = await getPekNearestDepartments(\n-      form.fromAddress || form.fromCity,\n-      {\n-        latitude: validSenderCoords.latitude.toString(),\n-        longitude: validSenderCoords.longitude.toString()\n+    try {\n+      const senderDepartment = await getPekNearestDepartments(\n+        form.fromAddress || form.fromCity,\n+        {\n+          latitude: validSenderCoords.latitude.toString(),\n+          longitude: validSenderCoords.longitude.toString()\n+        }\n+      );\n+      if (senderDepartment) {\n+        senderWarehouseId = senderDepartment.warehouseId;\n+        console.log('✅ Найден ближайший склад отправителя:', senderDepartment.warehouseId);\n       }\n-    );\n-    if (senderDepartment) {\n-      senderWarehouseId = senderDepartment.warehouseId;\n+    } catch (error) {\n+      console.warn('⚠️ Ошибка поиска ближайших отделений отправителя, используем основной склад:', error);\n     }\n   } else {\n     console.warn('⚠️ Некорректные координаты отправителя, используем основной склад');\n   }\n"
        }
      ]
    },
    "title": "app/page.tsx",
    "time": {
      "start": 1758979288524,
      "end": 1758979288540
    }
  }
}