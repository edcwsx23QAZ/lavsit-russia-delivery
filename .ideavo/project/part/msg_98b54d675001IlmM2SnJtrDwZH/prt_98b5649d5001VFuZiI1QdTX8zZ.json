{
  "id": "prt_98b5649d5001VFuZiI1QdTX8zZ",
  "messageID": "msg_98b54d675001IlmM2SnJtrDwZH",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "multiedit",
  "callID": "toolu_012P2rqcuMcFkKvEieGFp6wZ",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx",
      "edits": [
        {
          "oldString": "      if (form.toAddressDelivery && receiverZone.warehousePoint) {\n        const validReceiverCoords = validateCoordinates(receiverZone.warehousePoint);\n        if (validReceiverCoords) {\n          const receiverDepartment = await getPekNearestDepartments(\n            form.toAddress || form.toCity,\n            {\n              latitude: validReceiverCoords.latitude.toString(),\n              longitude: validReceiverCoords.longitude.toString()\n            }\n          );\n          if (receiverDepartment) {\n            receiverWarehouseId = receiverDepartment.warehouseId;\n          }\n        } else {\n          console.warn('⚠️ Некорректные координаты получателя, используем основной склад');\n        }\n      }",
          "newString": "      if (form.toAddressDelivery && receiverZone.warehousePoint) {\n        const validReceiverCoords = validateCoordinates(receiverZone.warehousePoint);\n        if (validReceiverCoords) {\n          try {\n            const receiverDepartment = await getPekNearestDepartments(\n              form.toAddress || form.toCity,\n              {\n                latitude: validReceiverCoords.latitude.toString(),\n                longitude: validReceiverCoords.longitude.toString()\n              }\n            );\n            if (receiverDepartment) {\n              receiverWarehouseId = receiverDepartment.warehouseId;\n              console.log('✅ Найден ближайший склад получателя:', receiverDepartment.warehouseId);\n            }\n          } catch (error) {\n            console.warn('⚠️ Ошибка поиска ближайших отделений получателя, используем основной склад:', error);\n          }\n        } else {\n          console.warn('⚠️ Некорректные координаты получателя, используем основной склад');\n        }\n      }"
        }
      ]
    },
    "output": "",
    "metadata": {
      "results": [
        {
          "diagnostics": {},
          "diff": "Index: /home/user/project/app/page.tsx\n===================================================================\n--- /home/user/project/app/page.tsx\n+++ /home/user/project/app/page.tsx\n@@ -1169,17 +1169,22 @@\n \n if (form.toAddressDelivery && receiverZone.warehousePoint) {\n   const validReceiverCoords = validateCoordinates(receiverZone.warehousePoint);\n   if (validReceiverCoords) {\n-    const receiverDepartment = await getPekNearestDepartments(\n-      form.toAddress || form.toCity,\n-      {\n-        latitude: validReceiverCoords.latitude.toString(),\n-        longitude: validReceiverCoords.longitude.toString()\n+    try {\n+      const receiverDepartment = await getPekNearestDepartments(\n+        form.toAddress || form.toCity,\n+        {\n+          latitude: validReceiverCoords.latitude.toString(),\n+          longitude: validReceiverCoords.longitude.toString()\n+        }\n+      );\n+      if (receiverDepartment) {\n+        receiverWarehouseId = receiverDepartment.warehouseId;\n+        console.log('✅ Найден ближайший склад получателя:', receiverDepartment.warehouseId);\n       }\n-    );\n-    if (receiverDepartment) {\n-      receiverWarehouseId = receiverDepartment.warehouseId;\n+    } catch (error) {\n+      console.warn('⚠️ Ошибка поиска ближайших отделений получателя, используем основной склад:', error);\n     }\n   } else {\n     console.warn('⚠️ Некорректные координаты получателя, используем основной склад');\n   }\n"
        }
      ]
    },
    "title": "app/page.tsx",
    "time": {
      "start": 1758979323176,
      "end": 1758979323197
    }
  }
}