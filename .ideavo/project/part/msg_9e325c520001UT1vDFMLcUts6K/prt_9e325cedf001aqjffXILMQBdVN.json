{
  "id": "prt_9e325cedf001aqjffXILMQBdVN",
  "messageID": "msg_9e325c520001UT1vDFMLcUts6K",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "read",
  "callID": "call_51418563",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "components/ServiceWorkerRegistration.tsx"
    },
    "output": "<file>\n00001| 'use client';\n00002| \n00003| import { useEffect } from 'react';\n00004| \n00005| export default function ServiceWorkerRegistration() {\n00006|   useEffect(() => {\n00007|     if ('serviceWorker' in navigator) {\n00008|       // NUCLEAR APPROACH: Агрессивное детектирование dev режима\n00009|       const isDevelopment = process.env.NODE_ENV === 'development' || \n00010|                            process.env.NODE_ENV === undefined ||\n00011|                            typeof window !== 'undefined' && (\n00012|                              window.location.hostname.includes('localhost') || \n00013|                              window.location.hostname.includes('127.0.0.1') || \n00014|                              window.location.hostname.includes('.e2b.app') ||\n00015|                              window.location.hostname.includes('ideavo') ||\n00016|                              window.location.port !== ''\n00017|                            );\n00018|       \n00019|       const isProduction = !isDevelopment;\n00020|       \n00021|       if (isProduction) {\n00022|         navigator.serviceWorker\n00023|           .register('/sw.js')\n00024|           .then((registration) => {\n00025|             console.log('[SW] Service Worker registered successfully:', registration);\n00026|             \n00027|             // Check for updates\n00028|             registration.addEventListener('updatefound', () => {\n00029|               const newWorker = registration.installing;\n00030|               if (newWorker) {\n00031|                 newWorker.addEventListener('statechange', () => {\n00032|                   if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {\n00033|                     console.log('[SW] New version available');\n00034|                     // Could show a notification to user about update\n00035|                   }\n00036|                 });\n00037|               }\n00038|             });\n00039|           })\n00040|           .catch((error) => {\n00041|             console.warn('[SW] Service Worker registration failed:', error);\n00042|           });\n00043| \n00044|         // Listen for messages from service worker\n00045|         navigator.serviceWorker.addEventListener('message', (event) => {\n00046|           console.log('[SW] Message from service worker:', event.data);\n00047|         });\n00048|       } else {\n00049|         // DEVELOPMENT MODE: NUCLEAR SW DESTRUCTION\n00050|         console.log('[SW] DEV: NUCLEAR SERVICE WORKER DESTRUCTION INITIATED');\n00051|         \n00052|         // Step 1: Brute force cache clearing\n00053|         if ('caches' in window) {\n00054|           const clearAllCaches = async () => {\n00055|             try {\n00056|               const cacheNames = await caches.keys();\n00057|               console.log('[SW] DEV: Found caches to delete:', cacheNames);\n00058|               \n00059|               const deletePromises = cacheNames.map(async (cacheName) => {\n00060|                 const deleted = await caches.delete(cacheName);\n00061|                 console.log(`[SW] DEV: Cache ${cacheName} deleted:`, deleted);\n00062|                 return deleted;\n00063|               });\n00064|               \n00065|               await Promise.all(deletePromises);\n00066|               console.log('[SW] DEV: All caches cleared');\n00067|             } catch (error) {\n00068|               console.error('[SW] DEV: Error clearing caches:', error);\n00069|             }\n00070|           };\n00071|           \n00072|           clearAllCaches();\n00073|           \n00074|           // Repeat cache clearing every 2 seconds for 10 seconds\n00075|           const clearIntervalId = setInterval(clearAllCaches, 2000);\n00076|           setTimeout(() => clearInterval(clearIntervalId), 10000);\n00077|         }\n00078|         \n00079|         // Step 2: Unregister ALL existing SWs aggressively\n00080|         const unregisterAll = async () => {\n00081|           try {\n00082|             const registrations = await navigator.serviceWorker.getRegistrations();\n00083|             console.log('[SW] DEV: Found SW registrations:', registrations.length);\n00084|             \n00085|             const unregisterPromises = registrations.map(async (registration) => {\n00086|               const unregistered = await registration.unregister();\n00087|               console.log('[SW] DEV: SW unregistered:', unregistered, registration.scope);\n00088|               return unregistered;\n00089|             });\n00090|             \n00091|             await Promise.all(unregisterPromises);\n00092|             console.log('[SW] DEV: All SWs unregistered');\n00093|           } catch (error) {\n00094|             console.error('[SW] DEV: Error unregistering SWs:', error);\n00095|           }\n00096|         };\n00097|         \n00098|         unregisterAll();\n00099|         \n00100|         // Repeat unregistration every 3 seconds for 15 seconds\n00101|         const unregisterIntervalId = setInterval(unregisterAll, 3000);\n00102|         setTimeout(() => clearInterval(unregisterIntervalId), 15000);\n00103|         \n00104|         // Step 3: Check for active SW and force reload if found\n00105|         const checkActiveSW = () => {\n00106|           if (navigator.serviceWorker.controller) {\n00107|             console.log('[SW] DEV: Active SW detected, force reloading in 3 seconds...');\n00108|             setTimeout(() => {\n00109|               console.log('[SW] DEV: Force reloading page to clear SW state');\n00110|               window.location.reload();\n00111|             }, 3000);\n00112|           }\n00113|         };\n00114|         \n00115|         // Check immediately and periodically\n00116|         setTimeout(checkActiveSW, 5000);\n00117|         const checkIntervalId = setInterval(checkActiveSW, 5000);\n00118|         setTimeout(() => clearInterval(checkIntervalId), 30000);\n00119|       }\n00120|     }\n00121|   }, []);\n00122| \n00123|   return null; // This component renders nothing\n00124| }\n</file>",
    "metadata": {
      "preview": "'use client';\n\nimport { useEffect } from 'react';\n\nexport default function ServiceWorkerRegistration() {\n  useEffect(() => {\n    if ('serviceWorker' in navigator) {\n      // NUCLEAR APPROACH: Агрессивное детектирование dev режима\n      const isDevelopment = process.env.NODE_ENV === 'development' || \n                           process.env.NODE_ENV === undefined ||\n                           typeof window !== 'undefined' && (\n                             window.location.hostname.includes('localhost') || \n                             window.location.hostname.includes('127.0.0.1') || \n                             window.location.hostname.includes('.e2b.app') ||\n                             window.location.hostname.includes('ideavo') ||\n                             window.location.port !== ''\n                           );\n      \n      const isProduction = !isDevelopment;\n      "
    },
    "title": "components/ServiceWorkerRegistration.tsx",
    "time": {
      "start": 1760452529889,
      "end": 1760452529891
    }
  }
}