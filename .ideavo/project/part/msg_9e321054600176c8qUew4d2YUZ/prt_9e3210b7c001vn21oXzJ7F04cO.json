{
  "id": "prt_9e3210b7c001vn21oXzJ7F04cO",
  "messageID": "msg_9e321054600176c8qUew4d2YUZ",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "read",
  "callID": "call_87852826",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "app/page.tsx",
      "offset": 3000,
      "limit": 1000
    },
    "output": "<file>\n03001|           }\n03002|           \n03003|           // –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ\n03004|           if (form.needInsurance && autoTariff.priceInsurance) {\n03005|             const insuranceCost = Math.round(form.declaredValue * parseFloat(autoTariff.priceInsurance) / 100);\n03006|             console.log('üöÇ –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞:', insuranceCost, '(', form.declaredValue, '*', autoTariff.priceInsurance, '%)');\n03007|             services.push({\n03008|               name: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n03009|               description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n03010|               price: insuranceCost\n03011|             });\n03012|             totalPrice += insuranceCost;\n03013|           }\n03014| \n03015|           console.log('üöÇ Rail Continent –∏—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:', totalPrice);\n03016|           console.log('üöÇ Rail Continent —É—Å–ª—É–≥–∏:', services);\n03017| \n03018|           // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º, –Ω–æ –Ω–µ –≤–∫–ª—é—á–∞–µ–º –≤ –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å)\n03019|           const additionalServices: { name: string; description: string; price: number }[] = [];\n03020|           \n03021|           // –¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–µ —Å–±–æ—Ä—ã\n03022|           if (autoTariff.terminalEnter1) {\n03023|             additionalServices.push({\n03024|               name: '–¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–π —Å–±–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è',\n03025|               description: '–û–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä—É–∑–∞ –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ',\n03026|               price: parseInt(autoTariff.terminalEnter1)\n03027|             });\n03028|           }\n03029|           \n03030|           // –ó–∞–±–æ—Ä/–¥–æ—Å—Ç–∞–≤–∫–∞\n03031|           if (form.fromAddressDelivery && autoTariff.pricePickup && parseInt(autoTariff.pricePickup) > 0) {\n03032|             additionalServices.push({\n03033|               name: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n03034|               description: '–û—Ç –∞–¥—Ä–µ—Å–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è',\n03035|               price: parseInt(autoTariff.pricePickup)\n03036|             });\n03037|           }\n03038|           \n03039|           if (form.toAddressDelivery && autoTariff.priceDelivery && parseInt(autoTariff.priceDelivery) > 0) {\n03040|             additionalServices.push({\n03041|               name: '–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –∞–¥—Ä–µ—Å—É',\n03042|               description: '–î–æ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è',\n03043|               price: parseInt(autoTariff.priceDelivery)\n03044|             });\n03045|           }\n03046| \n03047|           return {\n03048|             company: 'Rail Continent',\n03049|             price: Math.round(totalPrice),\n03050|             days: parseInt(autoTariff.duration) || 5,\n03051|             details: {\n03052|               tariff: `${autoTariff.type} - ${autoTariff.service}`,\n03053|               transportType: autoTariff.rsType,\n03054|               weight: totalWeight,\n03055|               volume: totalVolume,\n03056|               route: `${form.fromCity} - ${form.toCity}`,\n03057|               services,\n03058|               additionalServices,\n03059|               allTariffs: data.data\n03060|             },\n03061|             requestData,\n03062|             responseData: data,\n03063|             apiUrl\n03064|           };\n03065|         } else {\n03066|           return {\n03067|             company: 'Rail Continent',\n03068|             price: 0,\n03069|             days: 0,\n03070|             error: '–ê–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã–π —Ç–∞—Ä–∏—Ñ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞',\n03071|             requestData,\n03072|             responseData: data,\n03073|             apiUrl\n03074|           };\n03075|         }\n03076|       } else {\n03077|         return {\n03078|           company: 'Rail Continent',\n03079|           price: 0,\n03080|           days: 0,\n03081|           error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ Rail Continent',\n03082|           requestData,\n03083|           responseData: data,\n03084|           apiUrl\n03085|         };\n03086|       }\n03087|     } catch (error: any) {\n03088|       console.error('üöÇ Rail Continent –æ—à–∏–±–∫–∞:', error);\n03089|       return {\n03090|         company: 'Rail Continent',\n03091|         price: 0,\n03092|         days: 0,\n03093|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03094|         apiUrl\n03095|       };\n03096|     }\n03097|   };\n03098| \n03099|   const calculateVozovoz = async (): Promise<CalculationResult> => {\n03100|     const apiUrl = '/api/vozovoz';\n03101|     \n03102|     try {\n03103|       // –í—ã—á–∏—Å–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥—Ä—É–∑–∞\n03104|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n03105|       const totalVolume = form.cargos.reduce((sum, cargo) => \n03106|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n03107|       );\n03108|       \n03109|       // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –í–æ–∑–æ–≤–æ–∑\n03110|       const maxDimensions = form.cargos.reduce((max, cargo) => {\n03111|         const length = cargo.length / 1000; // –ø–µ—Ä–µ–≤–æ–¥–∏–º –º–º –≤ –º\n03112|         const width = cargo.width / 1000;\n03113|         const height = cargo.height / 1000;\n03114|         const weight = cargo.weight;\n03115|         \n03116|         return {\n03117|           length: Math.max(max.length, length),\n03118|           width: Math.max(max.width, width),\n03119|           height: Math.max(max.height, height),\n03120|           weight: Math.max(max.weight, weight)\n03121|         };\n03122|       }, { length: 0, width: 0, height: 0, weight: 0 });\n03123|       \n03124|       console.log('üöö –í–æ–∑–æ–≤–æ–∑: –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');\n03125|       console.log('   - –û–±—â–∏–π –≤–µ—Å:', totalWeight, '–∫–≥');\n03126|       console.log('   - –û–±—â–∏–π –æ–±—ä–µ–º:', totalVolume, '–º¬≥');\n03127|       console.log('   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã:', maxDimensions);\n03128|       console.log('   - –û—Ç–∫—É–¥–∞:', form.fromCity);\n03129|       console.log('   - –ö—É–¥–∞:', form.toCity);\n03130|       \n03131|        // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è API Vozovoz —Å–æ–≥–ª–∞—Å–Ω–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n03132|        const requestData = {\n03133|          object: \"price\",\n03134|          action: \"get\",\n03135|          params: {\n03136|            cargo: {\n03137|              dimension: {\n03138|                max: {                              // ‚úÖ –î–æ–±–∞–≤–ª—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É max\n03139|                  length: maxDimensions.length,     // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –≤ –º–µ—Ç—Ä–∞—Ö\n03140|                  width: maxDimensions.width,       // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –≤ –º–µ—Ç—Ä–∞—Ö\n03141|                  height: maxDimensions.height,     // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –≤ –º–µ—Ç—Ä–∞—Ö\n03142|                  weight: maxDimensions.weight      // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –≤ –∫–≥\n03143|                },\n03144|                quantity: form.cargos.length,       // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç\n03145|                volume: totalVolume,                // –û–±—â–∏–π –æ–±—ä–µ–º –≤ –º¬≥\n03146|                weight: totalWeight                 // –û–±—â–∏–π –≤–µ—Å –≤ –∫–≥\n03147|              },\n03148|              ...(form.needInsurance && form.declaredValue > 0 ? {\n03149|                insurance: form.declaredValue,      // ‚úÖ –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n03150|                insuranceNdv: false                 // –û—Ç–∫–ª—é—á–∞–µ–º —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –±–µ–∑ –æ–±—ä—è–≤–ª–µ–Ω–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n03151|              } : {\n03152|                insuranceNdv: true                  // –í–∫–ª—é—á–∞–µ–º —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –±–µ–∑ –æ–±—ä—è–≤–ª–µ–Ω–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n03153|              }),\n03154|               ...(form.needPackaging ? {\n03155|                 wrapping: {\n03156|                   \"hardPackageVolume\": totalVolume  // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥ \"–ñ—ë—Å—Ç–∫–∞—è —É–ø–∞–∫–æ–≤–∫–∞\" –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n03157|                 }\n03158|               } : {})\n03159|            },\n03160|            gateway: {\n03161|              dispatch: {\n03162|                point: {\n03163|                  location: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n03164|                  // ‚úÖ –ü–æ–ª—è address –∏ terminal –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n03165|                  ...(form.fromAddressDelivery ? {\n03166|                    address: form.fromAddress || \"–∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\"\n03167|                  } : {\n03168|                    terminal: \"default\"\n03169|                  })\n03170|                }\n03171|              },\n03172|              destination: {\n03173|                point: {\n03174|                  location: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n03175|                  // ‚úÖ –ü–æ–ª—è address –∏ terminal –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n03176|                  ...(form.toAddressDelivery ? {\n03177|                    address: form.toAddress || \"–∞–¥—Ä–µ—Å –ø–æ–ª—É—á–µ–Ω–∏—è\"\n03178|                  } : {\n03179|                    terminal: \"default\"\n03180|                  })\n03181|                }\n03182|              }\n03183|            }\n03184|          }\n03185|        };\n03186| \n03187|       console.log('üöö –í–æ–∑–æ–≤–æ–∑ –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03188| \n03189|       const response = await fetch(apiUrl, {\n03190|         method: 'POST',\n03191|         headers: {\n03192|           'Content-Type': 'application/json',\n03193|         },\n03194|         body: JSON.stringify(requestData)\n03195|       });\n03196| \n03197|       const data = await response.json();\n03198|       console.log('üöö –í–æ–∑–æ–≤–æ–∑ –æ—Ç–≤–µ—Ç:', JSON.stringify(data, null, 2));\n03199| \n03200|       if (response.ok && data.response) {\n03201|         const responseData = data.response;\n03202|         \n03203|         console.log('üöö –í–æ–∑–æ–≤–æ–∑ –∞–Ω–∞–ª–∏–∑ –æ—Ç–≤–µ—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:', responseData);\n03204|         \n03205|         // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n03206|         const services: { name: string; description: string; price: number }[] = [];\n03207|         let totalPrice = responseData.price || responseData.basePrice || 0;\n03208|         \n03209|         // ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –º–∞—Å—Å–∏–≤ —É—Å–ª—É–≥ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API\n03210|         if (responseData.service && Array.isArray(responseData.service)) {\n03211|           console.log('üöö –í–æ–∑–æ–≤–æ–∑ –Ω–∞–π–¥–µ–Ω –º–∞—Å—Å–∏–≤ —É—Å–ª—É–≥:', responseData.service.length);\n03212|           \n03213|           responseData.service.forEach((service: any, index: number) => {\n03214|             console.log(`üöö –£—Å–ª—É–≥–∞ [${index}]:`, service);\n03215|             if (service.price > 0) {\n03216|               services.push({\n03217|                 name: service.name || '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —É—Å–ª—É–≥–∞',\n03218|                 description: service.description || '',\n03219|                 price: service.price\n03220|               });\n03221|             }\n03222|           });\n03223|         } else {\n03224|           console.log('üöö –í–æ–∑–æ–≤–æ–∑: –º–∞—Å—Å–∏–≤ —É—Å–ª—É–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –ø—É—Å—Ç');\n03225|           \n03226|           // –ï—Å–ª–∏ –º–∞—Å—Å–∏–≤–∞ —É—Å–ª—É–≥ –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n03227|           if (responseData.basePrice && responseData.basePrice > 0) {\n03228|             services.push({\n03229|               name: '–ë–∞–∑–æ–≤–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞',\n03230|               description: `${form.fromCity} - ${form.toCity}`,\n03231|               price: responseData.basePrice\n03232|             });\n03233|           }\n03234|           \n03235|           // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–∫–∏–¥–∫–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—ë –æ—Ç–¥–µ–ª—å–Ω–æ\n03236|           if (responseData.price !== responseData.basePrice && responseData.price > 0) {\n03237|             const discount = (responseData.basePrice || 0) - responseData.price;\n03238|             if (discount > 0) {\n03239|               services.push({\n03240|                 name: '–°–∫–∏–¥–∫–∞',\n03241|                 description: '–ü—Ä–∏–º–µ–Ω–µ–Ω–∞ —Å–∫–∏–¥–∫–∞',\n03242|                 price: -discount\n03243|               });\n03244|             }\n03245|           }\n03246|         }\n03247|         \n03248|         // –ï—Å–ª–∏ –Ω–∏–∫–∞–∫–∏—Ö —É—Å–ª—É–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n03249|         if (services.length === 0 && totalPrice > 0) {\n03250|           services.push({\n03251|             name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n03252|             description: `${form.fromCity} - ${form.toCity}`,\n03253|             price: totalPrice\n03254|           });\n03255|         }\n03256| \n03257|         console.log('üöö –í–æ–∑–æ–≤–æ–∑ –∏—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:', totalPrice);\n03258|         console.log('üöö –í–æ–∑–æ–≤–æ–∑ —É—Å–ª—É–≥–∏:', services);\n03259| \n03260|         return {\n03261|           company: '–í–æ–∑–æ–≤–æ–∑',\n03262|           price: Math.round(totalPrice),\n03263|           days: responseData.deliveryTime?.to || responseData.deliveryTime?.from || 3,\n03264|           details: {\n03265|             note: `–î–æ—Å—Ç–∞–≤–∫–∞ ${form.fromCity} - ${form.toCity}`,\n03266|             services,\n03267|             basePrice: responseData.basePrice,\n03268|             finalPrice: responseData.price,\n03269|             deliveryTime: responseData.deliveryTime,\n03270|             weight: totalWeight,\n03271|             volume: totalVolume\n03272|           },\n03273|           requestData,\n03274|           responseData: data,\n03275|           apiUrl\n03276|         };\n03277|       } else {\n03278|         return {\n03279|           company: '–í–æ–∑–æ–≤–æ–∑',\n03280|           price: 0,\n03281|           days: 0,\n03282|           error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –í–æ–∑–æ–≤–æ–∑',\n03283|           requestData,\n03284|           responseData: data,\n03285|           apiUrl\n03286|         };\n03287|       }\n03288|     } catch (error: any) {\n03289|       console.error('üöö –í–æ–∑–æ–≤–æ–∑ –æ—à–∏–±–∫–∞:', error);\n03290|       return {\n03291|         company: '–í–æ–∑–æ–≤–æ–∑',\n03292|         price: 0,\n03293|         days: 0,\n03294|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03295|         apiUrl\n03296|       };\n03297|     }\n03298|   };\n03299| \n03300|   // –†–∞—Å—á–µ—Ç –¥–ª—è Nord Wheel\n03301|   const calculateNordWheel = async (): Promise<CalculationResult> => {\n03302|     const apiUrl = 'https://nordw.ru/tools/api/calc/calculate/';\n03303|     \n03304|     try {\n03305|       // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03306|       validateMultipleCargos(form.cargos);\n03307|       \n03308|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n03309|       const totalVolume = form.cargos.reduce((sum, cargo) => \n03310|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n03311|       );\n03312| \n03313|       // üîß –î–û–ë–ê–í–õ–ï–ù–û: –†–∞—Å—á–µ—Ç –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03314|       const maxLength = Math.max(...form.cargos.map(c => c.length));\n03315|       const maxWidth = Math.max(...form.cargos.map(c => c.width));\n03316|       const maxHeight = Math.max(...form.cargos.map(c => c.height));\n03317|       \n03318|       // üîß –î–û–ë–ê–í–õ–ï–ù–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–µ–≥–∞–±–∞—Ä–∏—Ç (>2–º –ø–æ –ª—é–±–æ–º—É –∏–∑–º–µ—Ä–µ–Ω–∏—é)\n03319|       const isOversized = maxLength > 200 || maxWidth > 200 || maxHeight > 200 || totalWeight > 1000;\n03320|       \n03321|       // üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03322|       console.log('üåê Nord Wheel: –ê–Ω–∞–ª–∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç:');\n03323|       console.log(`   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç: ${form.cargos.length}`);\n03324|       console.log(`   - –û–±—â–∏–π –≤–µ—Å: ${totalWeight} –∫–≥`);\n03325|       console.log(`   - –û–±—â–∏–π –æ–±—ä–µ–º: ${totalVolume.toFixed(3)} –º¬≥`);\n03326|       \n03327|       form.cargos.forEach((cargo, index) => {\n03328|         console.log(`   üì¶ –ú–µ—Å—Ç–æ ${index + 1}:`);\n03329|         console.log(`     - –ì–∞–±–∞—Ä–∏—Ç—ã: ${cargo.length}√ó${cargo.width}√ó${cargo.height} —Å–º`);\n03330|         console.log(`     - –í–µ—Å: ${cargo.weight} –∫–≥`);\n03331|         console.log(`     - –û–±—ä–µ–º: ${((cargo.length * cargo.width * cargo.height) / 1000000).toFixed(3)} –º¬≥`);\n03332|       });\n03333|       \n03334|       if (form.cargos.length > 1) {\n03335|         console.log(`   üìê –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã: ${maxLength}√ó${maxWidth}√ó${maxHeight} —Å–º`);\n03336|         console.log(`   üöõ –ù–µ–≥–∞–±–∞—Ä–∏—Ç: ${isOversized ? '–î–ê' : '–ù–ï–¢'}`);\n03337|       }\n03338| \n03339|       // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω—ã –≥–∞–±–∞—Ä–∏—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ —É–ª—É—á—à–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –Ω–µ–≥–∞–±–∞—Ä–∏—Ç–∞\n03340|       const params = new URLSearchParams({\n03341|         from: '91', // –ú–æ—Å–∫–≤–∞ (–Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å ID –≥–æ—Ä–æ–¥–∞)\n03342|         to: '92', // –°–ü–± (–Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å ID –≥–æ—Ä–æ–¥–∞)\n03343|         pickup: form.fromAddressDelivery ? '1' : '0',\n03344|         deliver: form.toAddressDelivery ? '1' : '0',\n03345|         weight: totalWeight.toString(),\n03346|         volume: totalVolume.toString(),\n03347|         oversized: isOversized ? '1' : '0', // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ–≥–∞–±–∞—Ä–∏—Ç–∞\n03348|         package: form.needPackaging ? '1' : '0',\n03349|         packageCount: form.cargos.length.toString(),\n03350|         insurance: form.needInsurance ? '1' : '0',\n03351|         sum: form.declaredValue.toString(),\n03352|         documentsReturn: '0',\n03353|         fragile: '1',\n03354|         // üîß –î–û–ë–ê–í–õ–ï–ù–û: –ì–∞–±–∞—Ä–∏—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã\n03355|         length: (maxLength / 100).toString(),      // –≤ –º–µ—Ç—Ä–∞—Ö\n03356|         width: (maxWidth / 100).toString(),        // –≤ –º–µ—Ç—Ä–∞—Ö\n03357|         height: (maxHeight / 100).toString(),      // –≤ –º–µ—Ç—Ä–∞—Ö\n03358|         // üîß –î–û–ë–ê–í–õ–ï–ù–û: –§–ª–∞–≥ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03359|         multiplePackages: form.cargos.length > 1 ? '1' : '0'\n03360|       });\n03361| \n03362|       const requestData = Object.fromEntries(params);\n03363|       const fullUrl = `${apiUrl}?${params.toString()}`;\n03364| \n03365|       const response = await fetch(fullUrl);\n03366|       const data = await response.json();\n03367| \n03368|       if (response.ok && data.status === 'success' && data.data) {\n03369|         return {\n03370|           company: 'Nord Wheel',\n03371|           price: data.data.total || 0,\n03372|           days: data.data.days || 0,\n03373|           details: {\n03374|             ...data.data,\n03375|             totalCost: data.data.total,\n03376|             deliveryCost: data.data.door,\n03377|             terminalCost: data.data.terminal,\n03378|             pickupCost: data.data.pick,\n03379|             deliveryToDoorCost: data.data.deliver,\n03380|             additionalServices: (data.data.total || 0) - (data.data.door || 0)\n03381|           },\n03382|           requestData,\n03383|           responseData: data,\n03384|           apiUrl: fullUrl\n03385|         };\n03386|       } else {\n03387|         return {\n03388|           company: 'Nord Wheel',\n03389|           price: 0,\n03390|           days: 0,\n03391|           error: '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ Nord Wheel',\n03392|           requestData,\n03393|           responseData: data,\n03394|           apiUrl: fullUrl\n03395|         };\n03396|       }\n03397|     } catch (error: any) {\n03398|       return {\n03399|         company: 'Nord Wheel',\n03400|         price: 0,\n03401|         days: 0,\n03402|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03403|         apiUrl\n03404|       };\n03405|     }\n03406|   };\n03407| \n03408|   const calculateCdek = async (): Promise<CalculationResult> => {\n03409|     const apiUrl = '/api/cdek';\n03410|     \n03411|     try {\n03412|       validateMultipleCargos(form.cargos);\n03413|       \n03414|       const packages = form.cargos.map(cargo => ({\n03415|         height: cargo.height,\n03416|         length: cargo.length,\n03417|         width: cargo.width,\n03418|         weight: cargo.weight * 1000\n03419|       }));\n03420| \n03421|       const requestData: any = {\n03422|         from_city: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n03423|         to_city: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n03424|         packages: packages\n03425|       };\n03426| \n03427|       if (form.needInsurance && form.declaredValue > 0) {\n03428|         requestData.services = [{\n03429|           code: 'INSURANCE',\n03430|           parameter: form.declaredValue\n03431|         }];\n03432|         console.log('üì¶ CDEK: –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ', form.declaredValue);\n03433|       }\n03434| \n03435|       console.log('üì¶ CDEK –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03436|       console.log('üì¶ CDEK –º–∞—Ä—à—Ä—É—Ç:', {\n03437|         fromAddressDelivery: form.fromAddressDelivery,\n03438|         fromLavsiteWarehouse: form.fromLavsiteWarehouse,\n03439|         toAddressDelivery: form.toAddressDelivery\n03440|       });\n03441| \n03442|       const response = await fetch(apiUrl, {\n03443|         method: 'POST',\n03444|         headers: {\n03445|           'Content-Type': 'application/json',\n03446|         },\n03447|         body: JSON.stringify(requestData)\n03448|       });\n03449| \n03450|       const data = await response.json();\n03451|       console.log('üì¶ CDEK –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω, —Ç–∞—Ä–∏—Ñ–æ–≤:', data.tariff_codes?.length || 0);\n03452| \n03453|       if (response.ok && data.tariff_codes && data.tariff_codes.length > 0) {\n03454|         const isFromDoor = form.fromAddressDelivery || form.fromLavsiteWarehouse;\n03455|         const isToDoor = form.toAddressDelivery;\n03456|         \n03457|         let deliveryMode: number;\n03458|         let deliveryModeText: string;\n03459|         \n03460|         if (isFromDoor && isToDoor) {\n03461|           deliveryMode = 1;\n03462|           deliveryModeText = '–¥–≤–µ—Ä—å-–¥–≤–µ—Ä—å';\n03463|         } else if (isFromDoor && !isToDoor) {\n03464|           deliveryMode = 2;\n03465|           deliveryModeText = '–¥–≤–µ—Ä—å-—Å–∫–ª–∞–¥';\n03466|         } else if (!isFromDoor && isToDoor) {\n03467|           deliveryMode = 3;\n03468|           deliveryModeText = '—Å–∫–ª–∞–¥-–¥–≤–µ—Ä—å';\n03469|         } else {\n03470|           deliveryMode = 4;\n03471|           deliveryModeText = '—Å–∫–ª–∞–¥-—Å–∫–ª–∞–¥';\n03472|         }\n03473| \n03474|         console.log(`üì¶ CDEK –≤—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º –¥–æ—Å—Ç–∞–≤–∫–∏: ${deliveryMode} (${deliveryModeText})`);\n03475| \n03476|         const filteredTariffs = data.tariff_codes.filter((t: any) => t.delivery_mode === deliveryMode);\n03477|         \n03478|         console.log(`üì¶ CDEK –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è —Ä–µ–∂–∏–º–∞ ${deliveryModeText}:`, filteredTariffs.length);\n03479| \n03480|         if (filteredTariffs.length === 0) {\n03481|           return {\n03482|             company: '–°–î–≠–ö',\n03483|             price: 0,\n03484|             days: 0,\n03485|             error: `–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∞ ${deliveryModeText}`,\n03486|             requestData,\n03487|             responseData: data,\n03488|             apiUrl\n03489|           };\n03490|         }\n03491| \n03492|         const bestTariff = filteredTariffs.reduce((min: any, tariff: any) => \n03493|           (tariff.delivery_sum < min.delivery_sum) ? tariff : min\n03494|         );\n03495| \n03496|         console.log(`üì¶ CDEK –ª—É—á—à–∏–π —Ç–∞—Ä–∏—Ñ: ${bestTariff.tariff_name} - ${bestTariff.delivery_sum}‚ÇΩ`);\n03497| \n03498|         const detailsRequest: any = {\n03499|           ...requestData,\n03500|           tariff_code: bestTariff.tariff_code,\n03501|           get_details: true\n03502|         };\n03503| \n03504|         console.log('üì¶ CDEK: –∑–∞–ø—Ä–æ—Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏...');\n03505| \n03506|         const detailsResponse = await fetch(apiUrl, {\n03507|           method: 'POST',\n03508|           headers: {\n03509|             'Content-Type': 'application/json',\n03510|           },\n03511|           body: JSON.stringify(detailsRequest)\n03512|         });\n03513| \n03514|         let tariffDetails: any = null;\n03515|         if (detailsResponse.ok) {\n03516|           const detailsData = await detailsResponse.json();\n03517|           tariffDetails = detailsData.tariff_details;\n03518|           console.log('üì¶ CDEK –¥–µ—Ç–∞–ª–∏ —Ç–∞—Ä–∏—Ñ–∞:', tariffDetails);\n03519|         }\n03520| \n03521|         const finalPrice = tariffDetails?.total_sum || bestTariff.delivery_sum;\n03522|         \n03523|         return {\n03524|           company: '–°–î–≠–ö',\n03525|           price: Math.round(finalPrice),\n03526|           days: bestTariff.period_max || 0,\n03527|           details: {\n03528|             tariff_name: bestTariff.tariff_name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n03529|             tariff_code: bestTariff.tariff_code,\n03530|             delivery_mode: deliveryModeText,\n03531|             period_min: bestTariff.period_min,\n03532|             period_max: bestTariff.period_max,\n03533|             calendar_min: bestTariff.calendar_min,\n03534|             calendar_max: bestTariff.calendar_max,\n03535|             all_tariffs: filteredTariffs,\n03536|             services: tariffDetails?.services || [],\n03537|             delivery_sum: tariffDetails?.delivery_sum || bestTariff.delivery_sum,\n03538|             total_sum: finalPrice,\n03539|             weight_calc: tariffDetails?.weight_calc\n03540|           },\n03541|           requestData,\n03542|           responseData: data,\n03543|           apiUrl\n03544|         };\n03545|       } else {\n03546|         return {\n03547|           company: '–°–î–≠–ö',\n03548|           price: 0,\n03549|           days: 0,\n03550|           error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –°–î–≠–ö',\n03551|           requestData,\n03552|           responseData: data,\n03553|           apiUrl\n03554|         };\n03555|       }\n03556|     } catch (error: any) {\n03557|       console.error('üì¶ –°–î–≠–ö –æ—à–∏–±–∫–∞:', error);\n03558|       return {\n03559|         company: '–°–î–≠–ö',\n03560|         price: 0,\n03561|         days: 0,\n03562|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03563|         apiUrl\n03564|       };\n03565|     }\n03566|   };\n03567| \n03568|   const calculateKit = async (): Promise<CalculationResult> => {\n03569|     const apiUrl = '/api/kit';\n03570|     \n03571|     try {\n03572|       validateMultipleCargos(form.cargos);\n03573|       \n03574|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n03575| \n03576|       const requestData = {\n03577|         from_city: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n03578|         to_city: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n03579|         declared_price: form.declaredValue || 10000,\n03580|         service: ['S089']\n03581|       };\n03582| \n03583|       console.log('üöõ –ö–ò–¢ –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03584| \n03585|       const response = await fetch(apiUrl, {\n03586|         method: 'POST',\n03587|         headers: {\n03588|           'Content-Type': 'application/json',\n03589|         },\n03590|         body: JSON.stringify(requestData)\n03591|       });\n03592| \n03593|       const data = await response.json();\n03594|       console.log('üöõ –ö–ò–¢ –æ—Ç–≤–µ—Ç:', data);\n03595| \n03596|       if (response.ok && Array.isArray(data) && data.length > 0) {\n03597|         const rubData = data.find((item: any) => {\n03598|           const tariffData: any = Object.values(item)[0];\n03599|           return tariffData?.currency_code === 'RUB';\n03600|         });\n03601|         \n03602|         if (rubData) {\n03603|           const tariffKey = Object.keys(rubData)[0];\n03604|           const tariffData: any = rubData[tariffKey];\n03605|           \n03606|           console.log('üöõ –ö–ò–¢ –≤—ã–±—Ä–∞–Ω —Ç–∞—Ä–∏—Ñ:', tariffKey, tariffData);\n03607| \n03608|           return {\n03609|             company: '–ö–ò–¢',\n03610|             price: Math.round(tariffData.cost || 0),\n03611|             days: tariffData.time || 0,\n03612|             details: {\n03613|               tariff_name: tariffData.name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n03614|               tariff_type: tariffKey,\n03615|               services: tariffData.detail || [],\n03616|               currency: tariffData.currency_code\n03617|             },\n03618|             requestData,\n03619|             responseData: data,\n03620|             apiUrl\n03621|           };\n03622|         }\n03623|       }\n03624| \n03625|       return {\n03626|         company: '–ö–ò–¢',\n03627|         price: 0,\n03628|         days: 0,\n03629|         error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –ö–ò–¢',\n03630|         requestData,\n03631|         responseData: data,\n03632|         apiUrl\n03633|       };\n03634|     } catch (error: any) {\n03635|       console.error('üöõ –ö–ò–¢ –æ—à–∏–±–∫–∞:', error);\n03636|       return {\n03637|         company: '–ö–ò–¢',\n03638|         price: 0,\n03639|         days: 0,\n03640|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03641|         apiUrl\n03642|       };\n03643|     }\n03644|   };\n03645| \n03646|   const handleCalculate = async () => {\n03647|     setCalculating(true);\n03648|     setCalculations([]);\n03649|     \n03650|     // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø–æ—Å–ª–µ —Ä–∞—Å—á–µ—Ç–∞ (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ, –±–µ–∑ –¥–µ–±–∞—É–Ω—Å–∞)\n03651|     saveFormData({\n03652|       cargos: form.cargos,\n03653|       fromCity: form.fromCity,\n03654|       toCity: form.toCity,\n03655|       fromAddress: form.fromAddress,\n03656|       toAddress: form.toAddress,\n03657|       declaredValue: form.declaredValue,\n03658|       needPackaging: form.needPackaging,\n03659|       needLoading: form.needLoading,\n03660|       needCarry: form.needCarry,\n03661|       floor: form.floor,\n03662|       hasFreightLift: form.hasFreightLift,\n03663|       needInsurance: form.needInsurance,\n03664|       fromTerminal: form.fromTerminal,\n03665|       toTerminal: form.toTerminal,\n03666|       fromAddressDelivery: form.fromAddressDelivery,\n03667|       toAddressDelivery: form.toAddressDelivery,\n03668|       selectedProducts: form.selectedProducts,\n03669|     });\n03670|     \n03671|     try {\n03672|       // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ —Ñ—É–Ω–∫—Ü–∏–π —Ä–∞—Å—á–µ—Ç–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n03673|       const calculationFunctions: Promise<CalculationResult>[] = [];\n03674|       \n03675|       if (enabledCompanies.dellin) {\n03676|         calculationFunctions.push(calculateDellin());\n03677|       }\n03678|       if (enabledCompanies.pek) {\n03679|         calculationFunctions.push(calculatePEK());\n03680|       }\n03681|       if (enabledCompanies.nordwheel) {\n03682|         calculationFunctions.push(calculateNordWheel());\n03683|       }\n03684|       if (enabledCompanies.railcontinent) {\n03685|         calculationFunctions.push(calculateRailContinent());\n03686|       }\n03687|       if (enabledCompanies.vozovoz) {\n03688|         calculationFunctions.push(calculateVozovoz());\n03689|       }\n03690|       if (enabledCompanies.cdek) {\n03691|         calculationFunctions.push(calculateCdek());\n03692|       }\n03693|       if (enabledCompanies.kit) {\n03694|         calculationFunctions.push(calculateKit());\n03695|       }\n03696|       \n03697|       // –ï—Å–ª–∏ –Ω–∏ –æ–¥–Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞\n03698|       if (calculationFunctions.length === 0) {\n03699|         setCalculations([]);\n03700|         return;\n03701|       }\n03702|       \n03703|       const results = await Promise.all(calculationFunctions);\n03704|       \n03705|       // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ü–µ–Ω–µ\n03706|       const sortedResults = results\n03707|         .filter(result => !result.error)\n03708|         .sort((a, b) => a.price - b.price)\n03709|         .concat(results.filter(result => result.error));\n03710|       \n03711|       setCalculations(sortedResults);\n03712|     } catch (error) {\n03713|       console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ:', error);\n03714|     } finally {\n03715|       setCalculating(false);\n03716|     }\n03717|   };\n03718| \n03719|   const exportToPDF = () => {\n03720|     if (typeof window !== 'undefined') {\n03721|       // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Å–µ –¥–µ—Ç–∞–ª–∏ –ø–µ—Ä–µ–¥ –ø–µ—á–∞—Ç—å—é\n03722|       const allExpanded = calculations.reduce((acc, calc) => {\n03723|         acc[calc.company] = true;\n03724|         return acc;\n03725|       }, {} as { [key: string]: boolean });\n03726|       \n03727|       setExpandedDetails(allExpanded);\n03728|       \n03729|       // –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DOM\n03730|       setTimeout(() => {\n03731|         window.print();\n03732|       }, 100);\n03733|     }\n03734|   };\n03735| \n03736|   const toggleDetails = (company: string) => {\n03737|     setExpandedDetails(prev => ({\n03738|       ...prev,\n03739|       [company]: !prev[company]\n03740|     }));\n03741|   };\n03742| \n03743|   const toggleDebugInfo = (company: string) => {\n03744|     setExpandedDebugInfo(prev => ({\n03745|       ...prev,\n03746|       [company]: !prev[company]\n03747|     }));\n03748|   };\n03749| \n03750|   // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞—Å—á–µ—Ç–∞\n03751|   const handleReset = () => {\n03752|     if (typeof window !== 'undefined') {\n03753|       // –û—á–∏—â–∞–µ–º localStorage\n03754|       localStorage.removeItem('deliveryForm');\n03755|       \n03756|       // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É\n03757|       setForm(initialFormState);\n03758|       \n03759|       // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è\n03760|       setCalculations([]);\n03761|       setExpandedDetails({});\n03762|       setExpandedDebugInfo({});\n03763|       setSuggestions([]);\n03764|       setShowSuggestions(false);\n03765|       setActiveField('');\n03766|       \n03767|       console.log('–§–æ—Ä–º–∞ —Å–±—Ä–æ—à–µ–Ω–∞ –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é');\n03768|     }\n03769|   };\n03770| \n03771|   // –ü–∞—Ä—Å–µ—Ä –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è —á–∏—Ç–∞–µ–º–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞\n03772|   const parseCalculationDetails = (calc: CalculationResult) => {\n03773|     console.log('üîç parseCalculationDetails –ø–æ–ª—É—á–∏–ª calc:', calc?.company || 'undefined');\n03774|     console.log('üîç calc.details:', calc?.details ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n03775|     console.log('üîç typeof calc.details:', typeof calc?.details);\n03776|     \n03777|     const details: { service: string; description: string; price: number }[] = [];\n03778|     \n03779|     try {\n03780|       if (calc.company === '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏' && calc.details) {\n03781|         console.log('üîç –ù–∞—á–∏–Ω–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–µ—Ç–∞–ª–µ–π –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π...');\n03782|       // –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ (—É–∂–µ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –±–∞–∑–æ–≤—ã–µ —É—Å–ª—É–≥–∏ –∏ —É–ø–∞–∫–æ–≤–∫—É)\n03783|       let basePrice = calc.details?.price || calc.price || 0;\n03784|       \n03785|       // –†–∞–∑–±–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ\n03786|       let intercityPrice = 0;\n03787|       let derivalPrice = 0;\n03788|       let arrivalPrice = 0;\n03789|       let packagingPrice = 0;\n03790|       // packagingPremiums –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è - –Ω–∞–¥–±–∞–≤–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ pkg.price\n03791|       let insurancePrice = 0;\n03792|       \n03793|       // –ú–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞\n03794|       if (calc.details?.intercity?.price) {\n03795|         intercityPrice = calc.details.intercity.price;\n03796|         details.push({\n03797|           service: '–ú–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞',\n03798|           description: `${form.fromCity} - ${form.toCity}`,\n03799|           price: intercityPrice\n03800|         });\n03801|       }\n03802|       \n03803|       // –ó–∞–±–æ—Ä –≥—Ä—É–∑–∞\n03804|       if (calc.details?.derival?.price) {\n03805|         derivalPrice = calc.details.derival.price;\n03806|         details.push({\n03807|           service: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n03808|           description: '–û—Ç –∞–¥—Ä–µ—Å–∞',\n03809|           price: derivalPrice\n03810|         });\n03811|       }\n03812|       \n03813|       // –î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞\n03814|       if (calc.details?.arrival?.price) {\n03815|         arrivalPrice = calc.details.arrival.price;\n03816|         details.push({\n03817|           service: '–û—Ç–≤–æ–∑ –≥—Ä—É–∑–∞',\n03818|           description: '–î–æ –∞–¥—Ä–µ—Å–∞',\n03819|           price: arrivalPrice\n03820|         });\n03821|       }\n03822|       \n03823|       // –£–ø–∞–∫–æ–≤–∫–∞ (–Ω–∞–¥–±–∞–≤–∫–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ pkg.price, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏)\n03824|       if (form.needPackaging && calc.details?.packages) {\n03825|         Object.entries(calc.details?.packages || {}).forEach(([key, pkg]: [string, any]) => {\n03826|           if (pkg.price && pkg.price > 0) {\n03827|             // –í—ã—á–∏—Å–ª—è–µ–º –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É —É–ø–∞–∫–æ–≤–∫–∏ (–±–µ–∑ –Ω–∞–¥–±–∞–≤–æ–∫) –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n03828|             let basePkgPrice = pkg.price;\n03829|             let totalPremiums = 0;\n03830|             \n03831|             if (pkg.premiumDetails && Array.isArray(pkg.premiumDetails)) {\n03832|               totalPremiums = pkg.premiumDetails.reduce((sum: number, premium: any) => \n03833|                 sum + (premium.value || 0), 0);\n03834|               basePkgPrice = pkg.price - totalPremiums;\n03835|             }\n03836|             \n03837|             packagingPrice += pkg.price; // –í –æ–±—â—É—é —Å—É–º–º—É –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–Ω—É—é —Ü–µ–Ω—É\n03838|             \n03839|             // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—É—é —É–ø–∞–∫–æ–≤–∫—É\n03840|             details.push({\n03841|               service: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n03842|               description: '–£–ø–∞–∫–æ–≤–∞—Ç—å –≤ –∫–æ–º–ø–ª–µ–∫—Å ¬´–æ–±—Ä–µ—à—ë—Ç–∫–∞ + –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è¬ª',\n03843|               price: basePkgPrice\n03844|             });\n03845|             \n03846|             // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–¥–±–∞–≤–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ (–¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏, –Ω–æ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –∫ –æ–±—â–µ–π —Å—É–º–º–µ)\n03847|             if (pkg.premiumDetails && Array.isArray(pkg.premiumDetails)) {\n03848|               pkg.premiumDetails.forEach((premium: any) => {\n03849|                 if (premium.value && premium.value > 0) {\n03850|                   details.push({\n03851|                     service: '–ù–∞–¥–±–∞–≤–∫–∞ –∫ —É–ø–∞–∫–æ–≤–∫–µ',\n03852|                     description: premium.name || '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–¥–±–∞–≤–∫–∞',\n03853|                     price: premium.value\n03854|                   });\n03855|                 }\n03856|               });\n03857|             }\n03858|           }\n03859|         });\n03860|       }\n03861|       \n03862|       // –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ\n03863|       if (form.needInsurance && calc.details?.insurance) {\n03864|         insurancePrice = calc.details.insurance;\n03865|         details.push({\n03866|           service: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n03867|           description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n03868|           price: insurancePrice\n03869|         });\n03870|       }\n03871|       \n03872|       // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏\n03873|       details.push({\n03874|         service: '–î–æ–ø.—É—Å–ª—É–≥–∏',\n03875|         description: '–ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ –≥—Ä—É–∑–∞',\n03876|         price: 15\n03877|       });\n03878|       \n03879|       // –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –º–µ–∂–¥—É —Å—É–º–º–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é, –¥–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞—Ç–æ–∫\n03880|       const calculatedSum = intercityPrice + derivalPrice + arrivalPrice + packagingPrice + insurancePrice + 15;\n03881|       const remainder = basePrice - calculatedSum;\n03882|       \n03883|       if (Math.abs(remainder) > 1) { // –ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –±–æ–ª—å—à–µ 1 —Ä—É–±–ª—è\n03884|         details.push({\n03885|           service: remainder > 0 ? '–ü—Ä–æ—á–∏–µ —É—Å–ª—É–≥–∏' : '–°–∫–∏–¥–∫–∞',\n03886|           description: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–±–æ—Ä—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏',\n03887|           price: remainder\n03888|         });\n03889|       }\n03890|     } else if (calc.company === 'Nord Wheel' && calc.details) {\n03891|       // –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –¥–ª—è Nord Wheel —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º\n03892|       if (calc.details.totalCost) {\n03893|         details.push({\n03894|           service: '–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',\n03895|           description: '',\n03896|           price: calc.details.totalCost\n03897|         });\n03898|       }\n03899|       if (calc.details.deliveryCost) {\n03900|         details.push({\n03901|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–∑–∫–∏',\n03902|           description: '',\n03903|           price: calc.details.deliveryCost\n03904|         });\n03905|       }\n03906|       if (calc.details.terminalCost) {\n03907|         details.push({\n03908|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –º–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–≤–æ–∑–∫–∏',\n03909|           description: '',\n03910|           price: calc.details.terminalCost\n03911|         });\n03912|       }\n03913|       if (calc.details.pickupCost) {\n03914|         details.push({\n03915|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–±–æ—Ä–∞',\n03916|           description: '',\n03917|           price: calc.details.pickupCost\n03918|         });\n03919|       }\n03920|       if (calc.details.deliveryToDoorCost) {\n03921|         details.push({\n03922|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–æ –¥–≤–µ—Ä–∏',\n03923|           description: '',\n03924|           price: calc.details.deliveryToDoorCost\n03925|         });\n03926|       }\n03927|       if (calc.details.additionalServices && calc.details.additionalServices > 0) {\n03928|         details.push({\n03929|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ–ø.—É—Å–ª—É–≥',\n03930|           description: '',\n03931|           price: calc.details.additionalServices\n03932|         });\n03933|       }\n03934| \n03935|     } else if (calc.company === '–ü–≠–ö' && calc.details?.services) {\n03936|       // –î–ª—è –ü–≠–ö –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ API\n03937|       calc.details.services.forEach((service: any) => {\n03938|         if (service.price > 0) {\n03939|           details.push({\n03940|             service: service.name || '–£—Å–ª—É–≥–∞ –ü–≠–ö',\n03941|             description: service.description || '',\n03942|             price: service.price\n03943|           });\n03944|         }\n03945|       });\n03946|     } else if (calc.company === '–°–î–≠–ö' && calc.details) {\n03947|       const cdekServiceNames: Record<string, string> = {\n03948|         'INSURANCE': '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n03949|         'HEAVY_CARGO': '–¢—è–∂–µ–ª–æ–≤–µ—Å–Ω—ã–π –≥—Ä—É–∑',\n03950|         'DELIVERY_TO_DOOR': '–î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –¥–≤–µ—Ä–∏',\n03951|         'PICKUP_FROM_SENDER': '–ó–∞–±–æ—Ä –æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è',\n03952|         'PACKAGE': '–£–ø–∞–∫–æ–≤–∫–∞',\n03953|         'TRYING_ON': '–ü—Ä–∏–º–µ—Ä–∫–∞ –Ω–∞ –¥–æ–º—É',\n03954|         'PART_DELIVERY': '–ß–∞—Å—Ç–∏—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞'\n03955|       };\n03956| \n03957|       if (calc.details.services && calc.details.services.length > 0) {\n03958|         calc.details.services.forEach((service: any) => {\n03959|           const serviceName = cdekServiceNames[service.code] || service.code || '–£—Å–ª—É–≥–∞ –°–î–≠–ö';\n03960|           const servicePrice = service.total_sum || service.sum || 0;\n03961|           \n03962|           if (servicePrice > 0) {\n03963|             details.push({\n03964|               service: serviceName,\n03965|               description: service.code === 'HEAVY_CARGO' \n03966|                 ? `–°–±–æ—Ä –∑–∞ –≥–∞–±–∞—Ä–∏—Ç–Ω—ã–π –≥—Ä—É–∑ (—Ä–∞—Å—á–µ—Ç–Ω—ã–π –≤–µ—Å: ${(calc.details.weight_calc / 1000).toFixed(0)} –∫–≥)`\n03967|                 : service.code === 'INSURANCE'\n03968|                 ? `–û–±—ä—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${form.declaredValue?.toLocaleString() || 0} ‚ÇΩ`\n03969|                 : '',\n03970|               price: servicePrice\n03971|             });\n03972|           }\n03973|         });\n03974|         \n03975|         if (calc.details.delivery_sum && calc.details.total_sum) {\n03976|           details.push({\n03977|             service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n03978|             description: '',\n03979|             price: 0\n03980|           });\n03981|           details.push({\n03982|             service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',\n03983|             description: calc.details.tariff_name || '–ü–µ—Ä–µ–≤–æ–∑–∫–∞',\n03984|             price: Math.round(calc.details.delivery_sum)\n03985|           });\n03986|           \n03987|           const additionalSum = calc.details.services.reduce((sum: number, s: any) => \n03988|             sum + (s.total_sum || s.sum || 0), 0\n03989|           );\n03990|           \n03991|           if (additionalSum > 0) {\n03992|             details.push({\n03993|               service: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏',\n03994|               description: '–î–æ–ø. —Å–±–æ—Ä—ã',\n03995|               price: Math.round(additionalSum)\n03996|             });\n03997|           }\n03998|           \n03999|           details.push({\n04000|             service: '–ò–¢–û–ì–û',\n\n(File has more lines. Use 'offset' parameter to read beyond line 4000)\n</file>",
    "metadata": {
      "preview": "          }\n          \n          // –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ\n          if (form.needInsurance && autoTariff.priceInsurance) {\n            const insuranceCost = Math.round(form.declaredValue * parseFloat(autoTariff.priceInsurance) / 100);\n            console.log('üöÇ –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞:', insuranceCost, '(', form.declaredValue, '*', autoTariff.priceInsurance, '%)');\n            services.push({\n              name: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n              description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n              price: insuranceCost\n            });\n            totalPrice += insuranceCost;\n          }\n\n          console.log('üöÇ Rail Continent –∏—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:', totalPrice);\n          console.log('üöÇ Rail Continent —É—Å–ª—É–≥–∏:', services);\n\n          // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º, –Ω–æ –Ω–µ –≤–∫–ª—é—á–∞–µ–º –≤ –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å)\n          const additionalServices: { name: string; description: string; price: number }[] = [];\n          "
    },
    "title": "app/page.tsx",
    "time": {
      "start": 1760452217726,
      "end": 1760452217729
    }
  }
}