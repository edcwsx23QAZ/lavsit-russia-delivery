{
  "id": "prt_98cb86001001he5D47cTFeUd7A",
  "messageID": "msg_98cb81612001x2ZcbKa2EKGPcf",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "read",
  "callID": "toolu_01BdDhfc4KzVCvZ8ev7QGWDr",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx"
    },
    "output": "<file>\n00001| 'use client';\n00002| \n00003| import React, { useState, useEffect, useCallback } from 'react';\n00004| import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\n00005| import { Button } from '@/components/ui/button';\n00006| import { Input } from '@/components/ui/input';\n00007| import { Label } from '@/components/ui/label';\n00008| import { Checkbox } from '@/components/ui/checkbox';\n00009| import { Plus, Truck, Building2, Map } from 'lucide-react';\n00010| import { Alert, AlertDescription } from '@/components/ui/alert';\n00011| import { Badge } from '@/components/ui/badge';\n00012| import { Separator } from '@/components/ui/separator';\n00013| import { Collapsible, CollapsibleContent } from '@/components/ui/collapsible';\n00014| \n00015| interface Cargo {\n00016|   id: string;\n00017|   length: number;\n00018|   width: number;\n00019|   height: number;\n00020|   weight: number;\n00021| }\n00022| \n00023| interface DeliveryForm {\n00024|   cargos: Cargo[];\n00025|   fromCity: string;\n00026|   toCity: string;\n00027|   fromAddress: string;\n00028|   toAddress: string;\n00029|   declaredValue: number;\n00030|   needPackaging: boolean;\n00031|   needLoading: boolean;\n00032|   needCarry: boolean;\n00033|   floor: number;\n00034|   hasFreightLift: boolean;\n00035|   needInsurance: boolean;\n00036|   fromTerminal: boolean;\n00037|   toTerminal: boolean;\n00038|   fromAddressDelivery: boolean;\n00039|   toAddressDelivery: boolean;\n00040| }\n00041| \n00042| interface CalculationResult {\n00043|   company: string;\n00044|   price: number;\n00045|   days: number;\n00046|   details?: any;\n00047|   error?: string;\n00048|   requestData?: any;\n00049|   responseData?: any;\n00050|   apiUrl?: string;\n00051|   sessionId?: string;\n00052| }\n00053| \n00054| interface AddressSuggestion {\n00055|   value: string;\n00056|   unrestricted_value: string;\n00057|   data: {\n00058|     city?: string;\n00059|     street?: string;\n00060|     house?: string;\n00061|   };\n00062| }\n00063| \n00064| const COMPANIES = [\n00065|   { name: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏', logo: 'üì¶', connected: true },\n00066|   { name: '–ü–≠–ö', logo: 'üöõ', connected: true },\n00067|   { name: 'Nord Wheel', logo: 'üåê', connected: true },\n00068|   { name: 'Rail Continent', logo: 'üöÇ', connected: true }\n00069| ];\n00070| \n00071| export default function Home() {\n00072|   // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n00073|   const initialFormState: DeliveryForm = {\n00074|     cargos: [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00075|     fromCity: '',\n00076|     toCity: '',\n00077|     fromAddress: '',\n00078|     toAddress: '',\n00079|     declaredValue: 0,\n00080|     needPackaging: false,\n00081|     needLoading: false,\n00082|     needCarry: false,\n00083|     floor: 1,\n00084|     hasFreightLift: false,\n00085|     needInsurance: false,\n00086|     fromTerminal: true,\n00087|     toTerminal: true,\n00088|     fromAddressDelivery: false,\n00089|     toAddressDelivery: false\n00090|   };\n00091| \n00092|   const [form, setForm] = useState<DeliveryForm>(initialFormState);\n00093|   const [isLoaded, setIsLoaded] = useState(false);\n00094| \n00095|   const [suggestions, setSuggestions] = useState<AddressSuggestion[]>([]);\n00096|   const [showSuggestions, setShowSuggestions] = useState(false);\n00097|   const [activeField, setActiveField] = useState('');\n00098|   const [calculations, setCalculations] = useState<CalculationResult[]>([]);\n00099|   const [calculating, setCalculating] = useState(false);\n00100|   const [expandedDetails, setExpandedDetails] = useState<{ [key: string]: boolean }>({});\n00101|   const [expandedDebugInfo, setExpandedDebugInfo] = useState<{ [key: string]: boolean }>({});\n00102|   const [suggestionPosition, setSuggestionPosition] = useState({ top: 0, left: 0 });\n00103| \n00104|   // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)\n00105|   useEffect(() => {\n00106|     // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ\n00107|     if (typeof window !== 'undefined' && !isLoaded) {\n00108|       try {\n00109|         const saved = localStorage.getItem('deliveryForm');\n00110|         if (saved) {\n00111|           const savedForm = JSON.parse(saved);\n00112|           // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≥—Ä—É–∑\n00113|           if (!savedForm.cargos || savedForm.cargos.length === 0) {\n00114|             savedForm.cargos = [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }];\n00115|           }\n00116|           setForm(savedForm);\n00117|           console.log('–ó–∞–≥—Ä—É–∂–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã:', savedForm);\n00118|           \n00119|           // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è Supabase\n00120|           const currentTime = Math.floor(Date.now() / 1000);\n00121|           console.log('üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (timestamp):', currentTime);\n00122|           console.log('üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (ISO):', new Date().toISOString());\n00123|         }\n00124|       } catch (error) {\n00125|         console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);\n00126|         // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ\n00127|       } finally {\n00128|         setIsLoaded(true);\n00129|       }\n00130|     }\n00131|   }, [isLoaded]);\n00132| \n00133|   // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ (—Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)\n00134|   useEffect(() => {\n00135|     if (typeof window !== 'undefined' && isLoaded) {\n00136|       try {\n00137|         localStorage.setItem('deliveryForm', JSON.stringify(form));\n00138|         console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –≤ localStorage');\n00139|       } catch (error) {\n00140|         console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);\n00141|       }\n00142|     }\n00143|   }, [form, isLoaded]);\n00144| \n00145|   // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –ø—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n00146|   useEffect(() => {\n00147|     if (form.declaredValue > 0) {\n00148|       setForm(prev => ({ ...prev, needInsurance: true }));\n00149|     }\n00150|   }, [form.declaredValue]);\n00151| \n00152|   const searchAddresses = useCallback(async (query: string, field: string, element?: HTMLInputElement) => {\n00153|     if (query.length < 3) {\n00154|       setSuggestions([]);\n00155|       setShowSuggestions(false);\n00156|       return;\n00157|     }\n00158| \n00159|     setActiveField(field);\n00160|     \n00161|     // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ –∞–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–æ–∫\n00162|     if (element) {\n00163|       const rect = element.getBoundingClientRect();\n00164|       setSuggestionPosition({\n00165|         top: rect.bottom + window.scrollY,\n00166|         left: rect.left + window.scrollX\n00167|       });\n00168|     }\n00169|     \n00170|     try {\n00171|       const response = await fetch('https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address', {\n00172|         method: 'POST',\n00173|         headers: {\n00174|           'Content-Type': 'application/json',\n00175|           'Accept': 'application/json',\n00176|           'Authorization': 'Token eb87bbb3789bb43ed465f796892ea951f9e91008'\n00177|         },\n00178|         body: JSON.stringify({\n00179|           query: query,\n00180|           count: 10,\n00181|           // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª–µ–π –≥–æ—Ä–æ–¥–æ–≤ - —Ç–æ–ª—å–∫–æ –≥–æ—Ä–æ–¥–∞\n00182|           ...(field === 'fromCity' || field === 'toCity' ? {\n00183|             restrict_value: true,\n00184|             locations: [{\n00185|               country: '–†–æ—Å—Å–∏—è'\n00186|             }],\n00187|             from_bound: { value: 'city' },\n00188|             to_bound: { value: 'city' }\n00189|           } : {})\n00190|         })\n00191|       });\n00192| \n00193|       if (response.ok) {\n00194|         const data = await response.json();\n00195|         setSuggestions(data.suggestions || []);\n00196|         setShowSuggestions(true);\n00197|       }\n00198|     } catch (error) {\n00199|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫:', error);\n00200|     }\n00201|   }, []);\n00202| \n00203|   const debounceTimer = React.useRef<NodeJS.Timeout>();\n00204|   const handleAddressChange = (field: string, value: string, element?: HTMLInputElement) => {\n00205|     setForm(prev => ({ ...prev, [field]: value }));\n00206|     \n00207|     clearTimeout(debounceTimer.current);\n00208|     debounceTimer.current = setTimeout(() => {\n00209|       searchAddresses(value, field, element);\n00210|     }, 50);\n00211|   };\n00212| \n00213|   const selectSuggestion = (suggestion: AddressSuggestion) => {\n00214|     setForm(prev => ({ ...prev, [activeField]: suggestion.value }));\n00215|     setShowSuggestions(false);\n00216|     setSuggestions([]);\n00217|   };\n00218| \n00219|   const addCargo = () => {\n00220|     const newId = (form.cargos.length + 1).toString();\n00221|     setForm(prev => ({\n00222|       ...prev,\n00223|       cargos: [...prev.cargos, { id: newId, length: 0, width: 0, height: 0, weight: 0 }]\n00224|     }));\n00225|   };\n00226| \n00227|   const updateCargo = (id: string, field: string, value: number) => {\n00228|     setForm(prev => ({\n00229|       ...prev,\n00230|       cargos: prev.cargos.map(cargo => \n00231|         cargo.id === id ? { ...cargo, [field]: value } : cargo\n00232|       )\n00233|     }));\n00234|   };\n00235| \n00236|   const removeCargo = (id: string) => {\n00237|     if (form.cargos.length > 1) {\n00238|       setForm(prev => ({\n00239|         ...prev,\n00240|         cargos: prev.cargos.filter(cargo => cargo.id !== id)\n00241|       }));\n00242|     }\n00243|   };\n00244| \n00245|   // –ü–æ–ª—É—á–µ–Ω–∏–µ sessionID –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n00246|   const getDellinSessionId = async (): Promise<string | null> => {\n00247|     try {\n00248|       const authResponse = await fetch('https://api.dellin.ru/v3/auth/login.json', {\n00249|         method: 'POST',\n00250|         headers: {\n00251|           'Content-Type': 'application/json'\n00252|         },\n00253|         body: JSON.stringify({\n00254|           appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n00255|           login: 'service@lavsit.ru',\n00256|           password: 'edcwsx123QAZ'\n00257|         })\n00258|       });\n00259| \n00260|       const authData = await authResponse.json();\n00261|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ response.ok:', authResponse.ok);\n00262|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData:', authData);\n00263|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData.data:', authData.data);\n00264|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData.data?.sessionID:', authData.data?.sessionID);\n00265|       \n00266|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ –∫ sessionID\n00267|       let sessionID = null;\n00268|       \n00269|       if (authData.data?.sessionID) {\n00270|         sessionID = authData.data.sessionID;\n00271|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ data.sessionID:', sessionID);\n00272|       } else if (authData.sessionID) {\n00273|         sessionID = authData.sessionID;\n00274|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ sessionID:', sessionID);\n00275|       } else if (authData.data?.session) {\n00276|         sessionID = authData.data.session;\n00277|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ data.session:', sessionID);\n00278|       }\n00279|       \n00280|       if (authResponse.ok && sessionID) {\n00281|         return sessionID;\n00282|       } else {\n00283|         console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', authData);\n00284|         console.error('‚ùå –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', authResponse.status);\n00285|         console.error('‚ùå –¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞:', authResponse.statusText);\n00286|         return null;\n00287|       }\n00288|     } catch (error) {\n00289|       console.error('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', error);\n00290|     }\n00291|     return null;\n00292|   };\n00293| \n00294|   // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ –¥–ª—è –≥–æ—Ä–æ–¥–∞\n00295|   const getDellinTerminal = async (citySearch: string): Promise<string | null> => {\n00296|     try {\n00297|       const response = await fetch('https://api.dellin.ru/v3/public/terminals.json', {\n00298|         method: 'POST',\n00299|         headers: {\n00300|           'Content-Type': 'application/json'\n00301|         },\n00302|         body: JSON.stringify({\n00303|           appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B'\n00304|         })\n00305|       });\n00306| \n00307|       const data = await response.json();\n00308|       console.log('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã:', data);\n00309|       \n00310|       if (response.ok && data.terminals) {\n00311|         // –ò—â–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –≥–æ—Ä–æ–¥–µ\n00312|         const normalizedCity = citySearch.toLowerCase().trim();\n00313|         const terminal = data.terminals.find((t: any) => \n00314|           t.city?.toLowerCase().includes(normalizedCity) ||\n00315|           normalizedCity.includes(t.city?.toLowerCase())\n00316|         );\n00317|         \n00318|         return terminal?.id || data.terminals[0]?.id || null;\n00319|       }\n00320|       \n00321|       return null;\n00322|     } catch (error) {\n00323|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', error);\n00324|       return null;\n00325|     }\n00326|   };\n00327| \n00328|   // –ü–æ–ª—É—á–µ–Ω–∏–µ UID —É–ø–∞–∫–æ–≤–∫–∏ \"crate_with_bubble\" –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ —É–ø–∞–∫–æ–≤–æ–∫ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n00329|   const getDellinCrateWithBubbleUid = async (): Promise<string | null> => {\n00330|     const maxRetries = 2;\n00331|     \n00332|     for (let attempt = 1; attempt <= maxRetries; attempt++) {\n00333|       try {\n00334|         console.log(`üì¶ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –ø–æ–ø—ã—Ç–∫–∞ ${attempt}/${maxRetries}`);\n00335|         \n00336|         const response = await fetch('/api/dellin-packages', {\n00337|           method: 'GET',\n00338|           headers: {\n00339|             'Content-Type': 'application/json'\n00340|           }\n00341|         });\n00342| \n00343|         const data = await response.json();\n00344|         console.log('üì¶ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö response.ok:', response.ok);\n00345|         console.log('üì¶ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö status:', response.status);\n00346|         console.log('üì¶ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö data:', data);\n00347|         \n00348|         // –ï—Å–ª–∏ 401 Unauthorized - –ø—Ä–æ–±—É–µ–º –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è\n00349|         if (response.status === 401 && attempt < maxRetries) {\n00350|           console.log('üîÑ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –ø–æ–ª—É—á–∏–ª–∏ 401, –≤—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...');\n00351|           const newSessionId = await getDellinSessionId();\n00352|           if (newSessionId) {\n00353|             console.log('‚úÖ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –ø–æ–ª—É—á–µ–Ω –Ω–æ–≤—ã–π SessionID, –ø–æ–≤—Ç–æ—Ä—è–µ–º –∑–∞–ø—Ä–æ—Å...');\n00354|             continue; // –ü—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —Å –Ω–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n00355|           } else {\n00356|             console.error('‚ùå –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π SessionID');\n00357|             return null;\n00358|           }\n00359|         }\n00360|         \n00361|         if (response.ok && data.data && Array.isArray(data.data)) {\n00362|           console.log('üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–ø–∞–∫–æ–≤–æ–∫ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ:', data.data.length);\n00363|           console.log('üì¶ –ü–µ—Ä–≤—ã–µ 3 —É–ø–∞–∫–æ–≤–∫–∏:', data.data.slice(0, 3).map(p => ({name: p.name, uid: p.uid})));\n00364|           \n00365|           // –ù–∞—Ö–æ–¥–∏–º —É–ø–∞–∫–æ–≤–∫—É —Å name \"crate_with_bubble\"\n00366|           const crateWithBubble = data.data.find((pkg: any) => \n00367|             pkg.name === 'crate_with_bubble'\n00368|           );\n00369|           \n00370|           console.log('üì¶ –ü–æ–∏—Å–∫ crate_with_bubble —Ä–µ–∑—É–ª—å—Ç–∞—Ç:', crateWithBubble);\n00371|           \n00372|           if (crateWithBubble && crateWithBubble.uid) {\n00373|             console.log('‚úÖ –ù–∞–π–¥–µ–Ω UID –¥–ª—è crate_with_bubble:', crateWithBubble.uid);\n00374|             return crateWithBubble.uid;\n00375|           } else {\n00376|             console.log('‚ùå crate_with_bubble –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ—Ç UID');\n00377|           }\n00378|         } else {\n00379|           console.log('‚ùå –û—à–∏–±–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–∞ API —É–ø–∞–∫–æ–≤–æ–∫');\n00380|         }\n00381|         \n00382|         // –ï—Å–ª–∏ –¥–æ—à–ª–∏ —Å—é–¥–∞, –∑–Ω–∞—á–∏—Ç –Ω–µ –Ω–∞—à–ª–∏ —É–ø–∞–∫–æ–≤–∫—É –∏–ª–∏ –±—ã–ª–∞ –¥—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞\n00383|         break;\n00384|         \n00385|       } catch (error) {\n00386|         console.error(`‚ùå –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –æ—à–∏–±–∫–∞ –Ω–∞ –ø–æ–ø—ã—Ç–∫–µ ${attempt}:`, error);\n00387|         if (attempt === maxRetries) {\n00388|           console.error('‚ùå –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –∏—Å—á–µ—Ä–ø–∞–Ω—ã –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏');\n00389|           return null;\n00390|         }\n00391|       }\n00392|     }\n00393|     \n00394|     console.warn('–£–ø–∞–∫–æ–≤–∫–∞ —Å name=crate_with_bubble –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ');\n00395|     return null;\n00396|   };\n00397| \n00398|   // –†–∞—Å—á–µ—Ç –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π —á–µ—Ä–µ–∑ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π API v2/calculator.json —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n00399|   const calculateDellin = async (): Promise<CalculationResult> => {\n00400|     const apiUrl = 'https://api.dellin.ru/v2/calculator.json';\n00401|     const maxRetries = 2;\n00402|     \n00403|     try {\n00404|       let sessionID = await getDellinSessionId();\n00405|       \n00406|       if (!sessionID) {\n00407|         return {\n00408|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n00409|           price: 0,\n00410|           days: 0,\n00411|           error: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å sessionID',\n00412|           apiUrl,\n00413|           requestData: null,\n00414|           responseData: null\n00415|         };\n00416|       }\n00417| \n00418|       // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏ –æ–±—ä–µ–º—ã\n00419|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n00420|       const totalVolume = form.cargos.reduce((sum, cargo) => \n00421|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n00422|       );\n00423|       const maxLength = Math.max(...form.cargos.map(c => c.length)) / 100; // –≤ –º–µ—Ç—Ä–∞—Ö\n00424|       const maxWidth = Math.max(...form.cargos.map(c => c.width)) / 100;\n00425|       const maxHeight = Math.max(...form.cargos.map(c => c.height)) / 100;\n00426| \n00427|       // –ü–æ–ª—É—á–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª—ã –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)\n00428|       const fromTerminalId = !form.fromAddressDelivery ? await getDellinTerminal(form.fromCity) : null;\n00429|       const toTerminalId = !form.toAddressDelivery ? await getDellinTerminal(form.toCity) : null;\n00430| \n00431|       // –ü–æ–ª—É—á–∞–µ–º UID —É–ø–∞–∫–æ–≤–∫–∏ crate_with_bubble (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∞)\n00432|       let packageUid: string | null = null;\n00433|       console.log('=== –ù–ê–ß–ê–õ–û –û–¢–õ–ê–î–ö–ò –£–ü–ê–ö–û–í–ö–ò ===');\n00434|       console.log('üîç –û–¢–õ–ê–î–ö–ê –£–ü–ê–ö–û–í–ö–ò: form.needPackaging =', form.needPackaging);\n00435|       console.log('üîç –û–¢–õ–ê–î–ö–ê –£–ü–ê–ö–û–í–ö–ò: typeof form.needPackaging =', typeof form.needPackaging);\n00436|       \n00437|       if (form.needPackaging) {\n00438|         console.log('üîç ‚úÖ –£–ü–ê–ö–û–í–ö–ê –¢–†–ï–ë–£–ï–¢–°–Ø - –ó–ê–ü–†–ê–®–ò–í–ê–ï–ú UID...');\n00439|         try {\n00440|           packageUid = await getDellinCrateWithBubbleUid();\n00441|           console.log('üîç ‚úÖ –ü–û–õ–£–ß–ï–ù packageUid –∏–∑ API:', packageUid);\n00442|           \n00443|           // –í–†–ï–ú–ï–ù–ù–û: –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ UID –∏–∑ API, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π\n00444|           if (!packageUid) {\n00445|             packageUid = '0xa6a7bd2bf950e67f4b2cf7cc3a97c111';\n00446|             console.log('üîç üß™ –ò–°–ü–û–õ–¨–ó–£–ï–ú –¢–ï–°–¢–û–í–´–ô UID:', packageUid);\n00447|           }\n00448|           \n00449|           console.log('üîç ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô packageUid:', packageUid);\n00450|           console.log('üîç ‚úÖ typeof packageUid:', typeof packageUid);\n00451|           console.log('üîç ‚úÖ packageUid truthy:', !!packageUid);\n00452|         } catch (error) {\n00453|           console.log('üîç ‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ packageUid:', error);\n00454|           // –í–†–ï–ú–ï–ù–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π UID –ø—Ä–∏ –æ—à–∏–±–∫–µ\n00455|           packageUid = '0xa6a7bd2bf950e67f4b2cf7cc3a97c111';\n00456|           console.log('üîç üß™ –ò–°–ü–û–õ–¨–ó–£–ï–ú –¢–ï–°–¢–û–í–´–ô UID –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏:', packageUid);\n00457|         }\n00458|       } else {\n00459|         console.log('üîç ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ UID');\n00460|       }\n00461|       console.log('=== –ö–û–ù–ï–¶ –û–¢–õ–ê–î–ö–ò –£–ü–ê–ö–û–í–ö–ò ===');\n00462| \n00463|       // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞—Ç—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞\n00464|       const tomorrow = new Date();\n00465|       tomorrow.setDate(tomorrow.getDate() + 1);\n00466|       const produceDate = tomorrow.toISOString().split('T')[0];\n00467| \n00468|       // –û—Ç–ª–∞–¥–∫–∞ –ø–µ—Ä–µ–¥ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–∞\n00469|       console.log('=== –û–¢–õ–ê–î–ö–ê –§–û–†–ú–ò–†–û–í–ê–ù–ò–Ø –ó–ê–ü–†–û–°–ê ===');\n00470|       console.log('üîç form.needPackaging =', form.needPackaging, '(—Ç–∏–ø:', typeof form.needPackaging, ')');\n00471|       console.log('üîç packageUid =', packageUid, '(—Ç–∏–ø:', typeof packageUid, ')');\n00472|       console.log('üîç packageUid truthy =', !!packageUid);\n00473|       console.log('üîç –£—Å–ª–æ–≤–∏–µ (form.needPackaging && packageUid) =', form.needPackaging && packageUid);\n00474|       \n00475|       if (form.needPackaging && packageUid) {\n00476|         console.log('‚úÖ PACKAGES –ë–£–î–ï–¢ –î–û–ë–ê–í–õ–ï–ù –í –ó–ê–ü–†–û–°!');\n00477|       } else {\n00478|         console.log('‚ùå PACKAGES –ù–ï –ë–£–î–ï–¢ –î–û–ë–ê–í–õ–ï–ù:');\n00479|         if (!form.needPackaging) console.log('  - form.needPackaging = false');\n00480|         if (!packageUid) console.log('  - packageUid –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç/null');\n00481|       }\n00482| \n00483|       // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n00484|       const requestData = {\n00485|         appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n00486|         sessionID: sessionID,\n00487|         delivery: {\n00488|           deliveryType: {\n00489|             type: 'auto'  // –í—Å–µ–≥–¥–∞ \"auto\" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n00490|           },\n00491|           derival: {\n00492|             produceDate: produceDate,  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –¥–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n00493|             variant: form.fromAddressDelivery ? 'address' : 'terminal',\n00494|             ...(form.fromAddressDelivery ? {\n00495|               address: {\n00496|                 search: form.fromAddress || form.fromCity\n00497|               }\n00498|             } : {\n00499|               terminalID: fromTerminalId\n00500|             }),\n00501|             time: {\n00502|               worktimeStart: '10:00',\n00503|               worktimeEnd: '18:00',\n00504|               breakStart: '13:00',\n00505|               breakEnd: '14:00',\n00506|               exactTime: false\n00507|             }\n00508|             // handling –≤ derival –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n00509|           },\n00510|           arrival: {\n00511|             variant: form.toAddressDelivery ? 'address' : 'terminal',\n00512|             ...(form.toAddressDelivery ? {\n00513|               address: {\n00514|                 search: form.toAddress || form.toCity\n00515|               }\n00516|             } : {\n00517|               terminalID: toTerminalId\n00518|             }),\n00519|             time: {\n00520|               worktimeStart: '10:00',\n00521|               worktimeEnd: '18:00',\n00522|               breakStart: '13:00',\n00523|               breakEnd: '14:00',\n00524|               exactTime: false\n00525|             },\n00526|             // handling –≤ arrival –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—ä–µ–º\n00527|             ...(form.needCarry ? {\n00528|               handling: {\n00529|                 freightLift: form.hasFreightLift, // true —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –≥–∞–ª–æ—á–∫–∞ \"–Ω–∞–ª–∏—á–∏–µ –≥—Ä—É–∑–æ–≤–æ–≥–æ –ª–∏—Ñ—Ç–∞\"\n00530|                 toFloor: form.floor, // —ç—Ç–∞–∂ –∏–∑ —Ñ–æ—Ä–º—ã\n00531|                 carry: 0\n00532|               }\n00533|             } : {})\n00534|           },\n00535|           ...(form.needPackaging && packageUid ? {\n00536|             packages: [{\n00537|               uid: packageUid,  // UID —É–ø–∞–∫–æ–≤–∫–∏ crate_with_bubble –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞\n00538|               count: 1  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1\n00539|             }]\n00540|           } : {})\n00541|         },\n00542|         cargo: {\n00543|           quantity: form.cargos.length,\n00544|           length: maxLength,\n00545|           width: maxWidth,\n00546|           height: maxHeight,\n00547|           weight: totalWeight,\n00548|           totalVolume: totalVolume,\n00549|           totalWeight: totalWeight,\n00550|           oversizedWeight: 0,\n00551|           oversizedVolume: 0,\n00552|           hazardClass: 0,  // –í—Å–µ–≥–¥–∞ 0 –µ—Å–ª–∏ –Ω–µ—Ç –æ–ø–∞—Å–Ω—ã—Ö –≥—Ä—É–∑–æ–≤\n00553|           ...(form.needInsurance && form.declaredValue > 0 ? {\n00554|             insurance: {\n00555|               statedValue: form.declaredValue,\n00556|               term: true  // –í—Å–µ–≥–¥–∞ true –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è\n00557|             }\n00558|           } : {})\n00559|         },\n00560|         payment: {\n00561|           type: 'noncash',  // –í—Å–µ–≥–¥–∞ \"noncash\"\n00562|           paymentCitySearch: {\n00563|             search: form.fromCity  // –ì–æ—Ä–æ–¥ –æ–ø–ª–∞—Ç—ã\n00564|           }\n00565|         }\n00566|       };\n00567| \n00568|       console.log('üöÄ –ò–¢–û–ì–û–í–´–ô –ó–ê–ü–†–û–° –ö –î–õ:', JSON.stringify(requestData, null, 2));\n00569|       \n00570|       // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∞ packages\n00571|       if (requestData.delivery.packages) {\n00572|         console.log('‚úÖ PACKAGES –ù–ê–ô–î–ï–ù –í –ó–ê–ü–†–û–°–ï:', requestData.delivery.packages);\n00573|       } else {\n00574|         console.log('‚ùå PACKAGES –ù–ï –ù–ê–ô–î–ï–ù –í –ó–ê–ü–†–û–°–ï');\n00575|         console.log('   form.needPackaging =', form.needPackaging);\n00576|         console.log('   packageUid =', packageUid);\n00577|         console.log('   –£—Å–ª–æ–≤–∏–µ:', form.needPackaging && packageUid);\n00578|       }\n00579| \n00580|       // –ü–æ–ø—ã—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö\n00581|       let response: any = null;\n00582|       let data: any = null;\n00583|       \n00584|       for (let attempt = 1; attempt <= maxRetries; attempt++) {\n00585|         console.log(`üîÑ –î–õ: –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ ${attempt}/${maxRetries}`);\n00586|         \n00587|         response = await fetch(apiUrl, {\n00588|           method: 'POST',\n00589|           headers: {\n00590|             'Content-Type': 'application/json',\n00591|             'Accept': 'application/json'\n00592|           },\n00593|           body: JSON.stringify(requestData)\n00594|         });\n00595| \n00596|         data = await response.json();\n00597|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ response.ok:', response.ok);\n00598|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ status:', response.status);\n00599|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ data:', data);\n00600|         \n00601|         // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\n00602|         const isAuthError = response.status === 401 || \n00603|                            response.status === 403 ||\n00604|                            (response.status === 400 && data?.errors?.some((err: any) => \n00605|                              err.detail?.toLowerCase()?.includes('session') ||\n00606|                              err.detail?.toLowerCase()?.includes('auth') ||\n00607|                              err.detail?.toLowerCase()?.includes('invalid')\n00608|                            ));\n00609| \n00610|         if (isAuthError && attempt < maxRetries) {\n00611|           console.log('üîÑ –î–õ: –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –≤—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...');\n00612|           const newSessionId = await getDellinSessionId();\n00613|           if (newSessionId) {\n00614|             console.log('‚úÖ –î–õ: –ø–æ–ª—É—á–µ–Ω –Ω–æ–≤—ã–π SessionID, –æ–±–Ω–æ–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å...');\n00615|             // –û–±–Ω–æ–≤–ª—è–µ–º sessionID –≤ –∑–∞–ø—Ä–æ—Å–µ\n00616|             requestData.sessionID = newSessionId;\n00617|             sessionID = newSessionId;\n00618|             continue; // –ü—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —Å –Ω–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n00619|           } else {\n00620|             console.error('‚ùå –î–õ: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π SessionID');\n00621|             break;\n00622|           }\n00623|         }\n00624|         \n00625|         if (response.status === 400 && data?.errors) {\n00626|           console.log('=== –ê–ù–ê–õ–ò–ó –û–®–ò–ë–ö–ò 400 ===');\n00627|           console.log('üîç –û—à–∏–±–∫–∏:', data.errors);\n00628|           data.errors.forEach((error: any, index: number) => {\n00629|             console.log(`üîç –û—à–∏–±–∫–∞ ${index + 1}:`, error);\n00630|             console.log(`   - –ü–æ–ª–µ: ${error.field || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`);\n00631|             console.log(`   - –°–æ–æ–±—â–µ–Ω–∏–µ: ${error.detail || error.message || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`);\n00632|           });\n00633|           console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –û–®–ò–ë–ö–ò 400 ===');\n00634|         }\n00635| \n00636|         // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–Ω—ã–π –∏–ª–∏ –Ω–µ —Å–≤—è–∑–∞–Ω —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É\n00637|         break;\n00638|       }\n00639| \n00640|       \n00641|       // –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –°–¢–†–ê–•–û–í–ö–ò\n00642|       console.log('=== –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –°–¢–†–ê–•–û–í–ö–ò ===');\n00643|       console.log('üîç –ü–û–õ–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê data.data:', JSON.stringify(data.data, null, 2));\n00644|       \n00645|       // –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç—Ä–∞—Ö–æ–≤–∫–æ–π\n00646|       console.log('üí≥ –ü–û–ò–°–ö –ö–û–ú–ü–û–ù–ï–ù–¢–û–í –°–¢–†–ê–•–û–í–ö–ò:');\n00647|       console.log('üí≥ data.data.insurance:', data.data?.insurance);\n00648|       console.log('üí≥ data.data.cargoInsurance:', data.data?.cargoInsurance);\n00649|       console.log('üí≥ data.data.termInsurance:', data.data?.termInsurance);\n00650|       console.log('üí≥ data.data.insuranceDetails:', data.data?.insuranceDetails);\n00651|       console.log('üí≥ data.data.services:', data.data?.services);\n00652|       console.log('üí≥ data.data.additionalServices:', data.data?.additionalServices);\n00653|       \n00654|       // –ü–æ–∏—Å–∫ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏ –≤ –¥—Ä—É–≥–∏—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö\n00655|       if (data.data.derival) {\n00656|         console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –ó–ê–ë–û–ï data.data.derival.insurance:', data.data.derival.insurance);\n00657|       }\n00658|       if (data.data.arrival) {\n00659|         console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –î–û–°–¢–ê–í–ö–ï data.data.arrival.insurance:', data.data.arrival.insurance);\n00660|       }\n00661|       if (data.data.intercity) {\n00662|         console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –ü–ï–†–ï–í–û–ó–ö–ï data.data.intercity.insurance:', data.data.intercity.insurance);\n00663|       }\n00664|       \n00665|       // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö \"insurance\"\n00666|       const findInsuranceFields = (obj: any, path = '') => {\n00667|         if (typeof obj !== 'object' || obj === null) return;\n00668|         \n00669|         Object.keys(obj).forEach(key => {\n00670|           const fullPath = path ? `${path}.${key}` : key;\n00671|           if (key.toLowerCase().includes('insurance') || key.toLowerCase().includes('insur')) {\n00672|             console.log(`üí≥ –ù–ê–ô–î–ï–ù–û –ü–û–õ–ï –°–¢–†–ê–•–û–í–ö–ò [${fullPath}]:`, obj[key]);\n00673|           }\n00674|           if (typeof obj[key] === 'object') {\n00675|             findInsuranceFields(obj[key], fullPath);\n00676|           }\n00677|         });\n00678|       };\n00679|       \n00680|       console.log('üí≥ –†–ï–ö–£–†–°–ò–í–ù–´–ô –ü–û–ò–°–ö –ü–û–õ–ï–ô –°–¢–†–ê–•–û–í–ö–ò:');\n00681|       findInsuranceFields(data.data, 'data.data');\n00682|       console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –°–¢–†–ê–•–û–í–ö–ò ===');\n00683|       \n00684|       // –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ packages –≤ –æ—Ç–≤–µ—Ç–µ\n00685|       console.log('=== –ü–û–ò–°–ö PACKAGES –í –û–¢–í–ï–¢–ï ===');\n00686|       console.log('üì¶ data.data =', data.data);\n00687|       console.log('üì¶ data.data.packages =', data.data?.packages);\n00688|       console.log('üì¶ –¢–∏–ø data.data.packages:', typeof data.data?.packages);\n00689|       if (data.data?.packages) {\n00690|         console.log('‚úÖ PACKAGES –ù–ê–ô–î–ï–ù –í –û–¢–í–ï–¢–ï!');\n00691|         console.log('üì¶ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ packages:', JSON.stringify(data.data.packages, null, 2));\n00692|       } else {\n00693|         console.log('‚ùå PACKAGES –ù–ï –ù–ê–ô–î–ï–ù –í –û–¢–í–ï–¢–ï');\n00694|       }\n00695|       console.log('=== –ö–û–ù–ï–¶ –ü–û–ò–°–ö–ê PACKAGES ===');\n00696| \n00697|       if (response.ok && data.data && data.metadata?.status === 200) {\n00698|         let totalPrice = data.data.price || 0;\n00699|         console.log('üí∞ –†–ê–°–ß–ï–¢ –ò–¢–û–ì–û–í–û–ô –°–¢–û–ò–ú–û–°–¢–ò:');\n00700|         console.log('üí∞ –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å data.data.price (–£–ñ–ï –í–ö–õ–Æ–ß–ê–ï–¢ –í–°–ï):', totalPrice);\n00701|         \n00702|         // –°–¢–†–ê–•–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n00703|         if (data.data.insurance) {\n00704|           console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ data.data.insurance (–£–ñ–ï –≤–∫–ª—é—á–µ–Ω–∞ –≤ –±–∞–∑–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):', data.data.insurance);\n00705|           console.log('üí∞ –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞—Ö–æ–≤–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ');\n00706|         } else {\n00707|           console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–≤–µ—Ç–µ');\n00708|         }\n00709|         \n00710|         // –£–ü–ê–ö–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n00711|         console.log('üí∞ –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–ë –£–ü–ê–ö–û–í–ö–ï (–£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –í –û–°–ù–û–í–ù–£–Æ –°–¢–û–ò–ú–û–°–¢–¨):');\n00712|         console.log('üí∞ data.data.packages =', data.data.packages);\n00713|         console.log('üí∞ form.needPackaging =', form.needPackaging);\n00714|         \n00715|         if (data.data.packages && form.needPackaging) {\n00716|           console.log('üí∞ ‚úÖ –£–ü–ê–ö–û–í–ö–ê –ü–†–ò–°–£–¢–°–¢–í–£–ï–¢ –í –û–¢–í–ï–¢–ï (—Ü–µ–Ω–∞ —É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ data.data.price)');\n00717|           console.log('üí∞ –¢–∏–ø packages:', Array.isArray(data.data.packages) ? 'Array' : 'Object');\n00718|           \n00719|           if (Array.isArray(data.data.packages)) {\n00720|             data.data.packages.forEach((pkg: any, index: number) => {\n00721|               console.log(`üí∞ Package [${index}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n00722|             });\n00723|           } else {\n00724|             Object.entries(data.data.packages).forEach(([key, pkg]: [string, any]) => {\n00725|               console.log(`üí∞ Package [${key}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n00726|             });\n00727|           }\n00728|         } else {\n00729|           console.log('üí∞ ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∞—Å—å');\n00730|         }\n00731| \n00732|         // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–∞–∫ —Ä–∞–∑–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –¥–∞—Ç–∞–º–∏ pickup –∏ arrivalToOspReceiver\n00733|         let deliveryDays = 0;\n00734|         try {\n00735|           console.log('=== –ü–û–ò–°–ö –î–ê–¢ –í –û–¢–í–ï–¢–ï ===');\n00736|           \n00737|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–µ—Å—Ç–∞ –≥–¥–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–∞—Ç—ã\n00738|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.pickup:', data.data?.pickup);\n00739|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.pickup:', data.pickup);\n00740|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.pickup:', data?.pickup);\n00741|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.arrivalToOspReceiver:', data.data?.arrivalToOspReceiver);\n00742|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.arrivalToOspReceiver:', data.arrivalToOspReceiver);\n00743|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.arrivalToOspReceiver:', data?.arrivalToOspReceiver);\n00744|           \n00745|           // –ë–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–π –ø–æ–∏—Å–∫ –≤–æ –≤—Å–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ data\n00746|           const findDateInObject = (obj: any, fieldName: string): string | null => {\n00747|             if (!obj || typeof obj !== 'object') return null;\n00748|             \n00749|             for (const [key, value] of Object.entries(obj)) {\n00750|               if (key === fieldName && typeof value === 'string') {\n00751|                 return value;\n00752|               }\n00753|               if (typeof value === 'object' && value !== null) {\n00754|                 const found = findDateInObject(value, fieldName);\n00755|                 if (found) return found;\n00756|               }\n00757|             }\n00758|             return null;\n00759|           };\n00760|           \n00761|           const pickup = findDateInObject(data, 'pickup');\n00762|           const arrivalToOspReceiver = findDateInObject(data, 'arrivalToOspReceiver');\n00763|           \n00764|           console.log('–ù–ê–ô–î–ï–ù–ù–´–ï –î–ê–¢–´:');\n00765|           console.log('pickup:', pickup);\n00766|           console.log('arrivalToOspReceiver:', arrivalToOspReceiver);\n00767|           \n00768|           if (pickup && arrivalToOspReceiver) {\n00769|             // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—ã (—Ñ–æ—Ä–º–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å \"2025-09-27\" –∏–ª–∏ \"2025-09-27 10:00:00\")\n00770|             const pickupDate = new Date(pickup);\n00771|             const arrivalDate = new Date(arrivalToOspReceiver);\n00772|             \n00773|             console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ pickup:', pickupDate);\n00774|             console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ arrival:', arrivalDate);\n00775|             \n00776|             // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã\n00777|             if (!isNaN(pickupDate.getTime()) && !isNaN(arrivalDate.getTime())) {\n00778|               // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–æ—Å—Ç—å –≤ –¥–Ω—è—Ö\n00779|               const timeDiff = arrivalDate.getTime() - pickupDate.getTime();\n00780|               deliveryDays = Math.max(1, Math.ceil(timeDiff / (1000 * 3600 * 24))); // –ú–∏–Ω–∏–º—É–º 1 –¥–µ–Ω—å\n00781|               \n00782|               console.log('–†–∞–∑–Ω–æ—Å—Ç—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö:', timeDiff);\n00783|               console.log('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –í–´–ß–ò–°–õ–ï–ù —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:', deliveryDays, '–¥–Ω–µ–π');\n00784|             } else {\n00785|               console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞—Ç—ã –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞');\n00786|               console.error('pickup Date object:', pickupDate);\n00787|               console.error('arrival Date object:', arrivalDate);\n00788|             }\n00789|           } else {\n00790|             console.warn('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ –Ω–∞–π–¥–µ–Ω—ã –¥–∞—Ç—ã pickup –∏–ª–∏ arrivalToOspReceiver');\n00791|             console.log('pickup –Ω–∞–π–¥–µ–Ω:', !!pickup, pickup);\n00792|             console.log('arrivalToOspReceiver –Ω–∞–π–¥–µ–Ω:', !!arrivalToOspReceiver, arrivalToOspReceiver);\n00793|           }\n00794|         } catch (error) {\n00795|           console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –û—à–∏–±–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:', error);\n00796|         }\n00797| \n00798|         console.log('üí∞ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ò–¢–û–ì–û–í–ê–Ø –°–¢–û–ò–ú–û–°–¢–¨:', Math.round(totalPrice));\n00799|         \n00800|         return {\n00801|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n00802|           price: Math.round(totalPrice),\n00803|           days: deliveryDays || 0,\n00804|           details: data.data,\n00805|           requestData,\n00806|           responseData: data,\n00807|           apiUrl,\n00808|           sessionId: sessionID\n00809|         };\n00810|       } else {\n00811|         const errorMessage = data.metadata?.detail || \n00812|                            data.metadata?.message || \n00813|                            data.errors?.[0]?.detail || \n00814|                            (data.metadata?.status !== 200 ? `HTTP ${data.metadata?.status}` : '') ||\n00815|                            '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏';\n00816|         return {\n00817|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n00818|           price: 0,\n00819|           days: 0,\n00820|           error: errorMessage,\n00821|           requestData,\n00822|           responseData: data,\n00823|           apiUrl,\n00824|           sessionId: sessionID\n00825|         };\n00826|       }\n00827|     } catch (error: any) {\n00828|       return {\n00829|         company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n00830|         price: 0,\n00831|         days: 0,\n00832|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n00833|         requestData: null,\n00834|         responseData: null,\n00835|         apiUrl\n00836|       };\n00837|     }\n00838|   };\n00839| \n00840|   // –†–∞—Å—á–µ—Ç –¥–ª—è Nord Wheel\n00841|   const calculateNordWheel = async (): Promise<CalculationResult> => {\n00842|     const apiUrl = 'https://nordw.ru/tools/api/calc/calculate/';\n00843|     \n00844|     try {\n00845|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n00846|       const totalVolume = form.cargos.reduce((sum, cargo) => \n00847|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n00848|       );\n00849| \n00850|       const params = new URLSearchParams({\n00851|         from: '91', // –ú–æ—Å–∫–≤–∞ (–Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å ID –≥–æ—Ä–æ–¥–∞)\n00852|         to: '92', // –°–ü–± (–Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å ID –≥–æ—Ä–æ–¥–∞)\n00853|         pickup: form.fromAddressDelivery ? '1' : '0',\n00854|         deliver: form.toAddressDelivery ? '1' : '0',\n00855|         weight: totalWeight.toString(),\n00856|         volume: totalVolume.toString(),\n00857|         oversized: '0',\n00858|         package: form.needPackaging ? '1' : '0',\n00859|         packageCount: form.cargos.length.toString(),\n00860|         insurance: form.needInsurance ? '1' : '0',\n00861|         sum: form.declaredValue.toString(),\n00862|         documentsReturn: '0',\n00863|         fragile: '1'\n00864|       });\n00865| \n00866|       const requestData = Object.fromEntries(params);\n00867|       const fullUrl = `${apiUrl}?${params.toString()}`;\n00868| \n00869|       const response = await fetch(fullUrl);\n00870|       const data = await response.json();\n00871| \n00872|       if (response.ok && data.status === 'success' && data.data) {\n00873|         return {\n00874|           company: 'Nord Wheel',\n00875|           price: data.data.total || 0,\n00876|           days: data.data.days || 0,\n00877|           details: {\n00878|             ...data.data,\n00879|             totalCost: data.data.total,\n00880|             deliveryCost: data.data.door,\n00881|             terminalCost: data.data.terminal,\n00882|             pickupCost: data.data.pick,\n00883|             deliveryToDoorCost: data.data.deliver,\n00884|             additionalServices: (data.data.total || 0) - (data.data.door || 0)\n00885|           },\n00886|           requestData,\n00887|           responseData: data,\n00888|           apiUrl: fullUrl\n00889|         };\n00890|       } else {\n00891|         return {\n00892|           company: 'Nord Wheel',\n00893|           price: 0,\n00894|           days: 0,\n00895|           error: '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ Nord Wheel',\n00896|           requestData,\n00897|           responseData: data,\n00898|           apiUrl: fullUrl\n00899|         };\n00900|       }\n00901|     } catch (error: any) {\n00902|       return {\n00903|         company: 'Nord Wheel',\n00904|         price: 0,\n00905|         days: 0,\n00906|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n00907|         apiUrl\n00908|       };\n00909|     }\n00910|   };\n00911| \n00912|   // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–Ω–æ–π –∑–æ–Ω—ã –∏ —Å–∫–ª–∞–¥–∞ –ü–≠–ö –ø–æ –∞–¥—Ä–µ—Å—É —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏\n00913|   const getPekZoneByAddress = async (address: string) => {\n00914|     try {\n00915|       console.log(`üîç –ü–≠–ö: –ø–æ–∏—Å–∫ –∑–æ–Ω—ã –¥–ª—è –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n00916|       \n00917|       const response = await fetch('/api/pek', {\n00918|         method: 'POST',\n00919|         headers: {\n00920|           'Content-Type': 'application/json',\n00921|         },\n00922|         body: JSON.stringify({\n00923|           method: 'findzonebyaddress',\n00924|           address: address\n00925|         })\n00926|       });\n00927| \n00928|       console.log(`üì° –ü–≠–ö API —Å—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`);\n00929|       \n00930|       if (!response.ok) {\n00931|         let errorData;\n00932|         try {\n00933|           errorData = await response.json();\n00934|         } catch {\n00935|           errorData = { error: '–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç' };\n00936|         }\n00937|         \n00938|         console.error(`‚ùå –ü–≠–ö API –æ—à–∏–±–∫–∞ ${response.status}:`, errorData);\n00939|         \n00940|         // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫\n00941|         if (response.status === 401) {\n00942|           console.error('‚ùå –ü–≠–ö: –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω');\n00943|         } else if (response.status === 404) {\n00944|           console.error('‚ùå –ü–≠–ö: –ú–µ—Ç–æ–¥ API –Ω–µ –Ω–∞–π–¥–µ–Ω');\n00945|         } else if (response.status === 400) {\n00946|           console.error('‚ùå –ü–≠–ö: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞');\n00947|         } else if (response.status >= 500) {\n00948|           console.error('‚ùå –ü–≠–ö: –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ü–≠–ö');\n00949|         }\n00950|         \n00951|         console.log(`üîÑ –ü–≠–ö: –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥—É –¥–ª—è \"${address}\"`);\n00952|         return getPekZoneFallback(address);\n00953|       }\n00954| \n00955|       const data = await response.json();\n00956|       console.log(`‚úÖ –ü–≠–ö –∑–æ–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞:`, data);\n00957|       \n00958|       if (data.zoneId && data.mainWarehouseId) {\n00959|         return {\n00960|           zoneId: data.zoneId,\n00961|           zoneName: data.zoneName,\n00962|           branchUID: data.branchUID,\n00963|           branchCode: data.branchCode,\n00964|           branchTitle: data.branchTitle,\n00965|           mainWarehouseId: data.mainWarehouseId,\n00966|           warehousePoint: data.warehousePoint,\n00967|           geoData: data.GeoData,\n00968|           precision: data.GeoData?.precision\n00969|         };\n00970|       }\n00971|       \n00972|       console.warn(`‚ö†Ô∏è –ü–≠–ö: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç:`, data);\n00973|       return getPekZoneFallback(address);\n00974|       \n00975|     } catch (error) {\n00976|       console.error('‚ùå –ü–≠–ö: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∑–æ–Ω—ã:', error);\n00977|       return getPekZoneFallback(address);\n00978|     }\n00979|   };\n00980| \n00981|   // –§–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–æ–Ω—ã –ü–≠–ö\n00982|   const getPekZoneFallback = (address: string) => {\n00983|     console.log(`üîÑ –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –∞–Ω–∞–ª–∏–∑ –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n00984|     \n00985|     const addressLower = address.toLowerCase();\n00986|     \n00987|     // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –∏ –∏—Ö –¥–∞–Ω–Ω—ã–µ\n00988|     const cityMappings: { [key: string]: any } = {\n00989|       '–º–æ—Å–∫–≤–∞': {\n00990|         zoneId: 'moscow-zone-001',\n00991|         zoneName: '–ú–æ—Å–∫–≤–∞',\n00992|         branchUID: 'moscow-branch-001',\n00993|         branchCode: '–ú–°–ö',\n00994|         branchTitle: '–ú–æ—Å–∫–≤–∞',\n00995|         mainWarehouseId: 'dc6c746d-812d-11e4-bbfc-001999d8b3c5',\n00996|         warehousePoint: {\n00997|           latitude: 55.755826,\n00998|           longitude: 37.6173\n00999|         }\n01000|       },\n01001|       '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': {\n01002|         zoneId: 'spb-zone-001',\n01003|         zoneName: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n01004|         branchUID: 'spb-branch-001',\n01005|         branchCode: '–°–ü–ë',\n01006|         branchTitle: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n01007|         mainWarehouseId: 'b436c978-086d-11e6-b6ca-00155d668909',\n01008|         warehousePoint: {\n01009|           latitude: 59.9311,\n01010|           longitude: 30.3609\n01011|         }\n01012|       },\n01013|       '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': {\n01014|         zoneId: 'ekb-zone-001',\n01015|         zoneName: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',\n01016|         branchUID: 'ekb-branch-001',\n01017|         branchCode: '–ï–ö–ë',\n01018|         branchTitle: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',\n01019|         mainWarehouseId: 'f8d9c8e3-8e2d-11e4-bbfc-001999d8b3c5',\n01020|         warehousePoint: {\n01021|           latitude: 56.8431,\n01022|           longitude: 60.6454\n01023|         }\n01024|       }\n01025|     };\n01026|     \n01027|     for (const [city, data] of Object.entries(cityMappings)) {\n01028|       if (addressLower.includes(city) || addressLower.includes(city.replace('-', ' '))) {\n01029|         console.log(`‚úÖ –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –Ω–∞–π–¥–µ–Ω –≥–æ—Ä–æ–¥ ${city}`);\n01030|         return {\n01031|           ...data,\n01032|           geoData: {\n01033|             precision: 'fallback',\n01034|             kind: 'locality'\n01035|           },\n01036|           precision: 'fallback'\n01037|         };\n01038|       }\n01039|     }\n01040|     \n01041|     console.warn(`‚ùå –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –≥–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ \"${address}\"`);\n01042|     return null;\n01043|   };\n01044| \n01045|   // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –ü–≠–ö\n01046|   const getPekNearestDepartments = async (address: string, coordinates?: { latitude: string, longitude: string }) => {\n01047|     try {\n01048|       console.log(`üè¢ –ü–≠–ö: –ø–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –¥–ª—è \"${address}\"`);\n01049|       \n01050|       const requestBody: any = {\n01051|         departmentOperation: 3, // –≤—ã–¥–∞—á–∞ –≥—Ä—É–∑–æ–≤\n01052|         type: 3, // –∞–≤—Ç–æ-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç\n01053|         searchRadius: 50, // –∫–º\n01054|         limit: 5\n01055|       };\n01056|       \n01057|       // –ü–≠–ö API —Ç—Ä–µ–±—É–µ—Ç –∏ –∞–¥—Ä–µ—Å, –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ\n01058|       requestBody.address = address;\n01059|       \n01060|       if (coordinates) {\n01061|         requestBody.coordinates = coordinates;\n01062|         console.log(`üìç –ü–≠–ö: –ø–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\" –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º`, coordinates);\n01063|       } else {\n01064|         console.log(`üìç –ü–≠–ö: –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\"`);\n01065|       }\n01066|       \n01067|       const response = await fetch('/api/pek', {\n01068|         method: 'POST',\n01069|         headers: {\n01070|           'Content-Type': 'application/json',\n01071|         },\n01072|         body: JSON.stringify({\n01073|           method: 'nearestdepartments',\n01074|           ...requestBody\n01075|         })\n01076|       });\n01077| \n01078|       console.log(`üì° –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API —Å—Ç–∞—Ç—É—Å: ${response.status}`);\n01079|       \n01080|       if (!response.ok) {\n01081|         const errorText = await response.text();\n01082|         console.error(`‚ùå –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API –æ—à–∏–±–∫–∞: ${response.status} ${response.statusText}`);\n01083|         console.error(`‚ùå –û—Ç–≤–µ—Ç:`, errorText.substring(0, 500));\n01084|         return null;\n01085|       }\n01086| \n01087|       const data = await response.json();\n01088|       console.log(`‚úÖ –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–∞–π–¥–µ–Ω—ã:`, data);\n01089|       \n01090|       // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤–æ–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ —Å –Ω–∞–∏–≤—ã—Å—à–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º\n01091|       if (data.freeDepartments && data.freeDepartments.length > 0) {\n01092|         const bestDepartment = data.freeDepartments.sort((a: any, b: any) => b.priority - a.priority)[0];\n01093|         console.log(`‚úÖ –ü–≠–ö: –≤—ã–±—Ä–∞–Ω–æ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ`, bestDepartment.divisionName);\n01094|         return {\n01095|           warehouseId: bestDepartment.warehouseId,\n01096|           branchId: bestDepartment.branchId,\n01097|           branchName: bestDepartment.branchName,\n01098|           divisionName: bestDepartment.divisionName,\n01099|           address: bestDepartment.address,\n01100|           coordinates: bestDepartment.coordinates,\n01101|           phone: bestDepartment.phone,\n01102|           email: bestDepartment.email\n01103|         };\n01104|       }\n01105|       \n01106|       console.warn(`‚ùå –ü–≠–ö: –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è \"${address}\"`);\n01107|       return null;\n01108|     } catch (error) {\n01109|       console.error('‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –æ—Ç–¥–µ–ª–µ–Ω–∏–π:', error);\n01110|       return null;\n01111|     }\n01112|   };\n01113| \n01114|   // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ü–≠–ö)\n01115|   const getYandexCoordinates = async (address: string): Promise<{ latitude: string, longitude: string } | null> => {\n01116|     try {\n01117|       const encodedAddress = encodeURIComponent(address);\n01118|       const response = await fetch(`https://geocode-maps.yandex.ru/1.x/?apikey=YOUR_API_KEY&geocode=${encodedAddress}&format=json`);\n01119|       \n01120|       if (!response.ok) return null;\n01121|       \n01122|       const data = await response.json();\n01123|       const coords = data?.response?.GeoObjectCollection?.featureMember?.[0]?.GeoObject?.Point?.pos?.split(' ');\n01124|       \n01125|       if (coords && coords.length === 2) {\n01126|         return {\n01127|           longitude: coords[0],\n01128|           latitude: coords[1]\n01129|         };\n01130|       }\n01131|       \n01132|       return null;\n01133|     } catch (error) {\n01134|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ø–Ω–¥–µ–∫—Å:', error);\n01135|       return null;\n01136|     }\n01137|   };\n01138| \n01139|   // –†–∞—Å—á–µ—Ç –¥–ª—è –ü–≠–ö —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API v1/calculateprice/\n01140|   const calculatePEK = async (): Promise<CalculationResult> => {\n01141|     const apiUrl = 'https://kabinet.pecom.ru/api/v1/calculateprice/';\n01142|     \n01143|     // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç\n01144|     const validateCoordinates = (coords: any) => {\n01145|       console.log('üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:', coords);\n01146|       \n01147|       if (!coords) {\n01148|         console.log('‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç');\n01149|         return null;\n01150|       }\n01151|       \n01152|       if (typeof coords.latitude !== 'number' || typeof coords.longitude !== 'number') {\n01153|         console.warn(`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ —è–≤–ª—è—é—Ç—Å—è —á–∏—Å–ª–∞–º–∏:`, { \n01154|           lat: coords.latitude, \n01155|           lng: coords.longitude,\n01156|           latType: typeof coords.latitude,\n01157|           lngType: typeof coords.longitude\n01158|         });\n01159|         return null;\n01160|       }\n01161|       \n01162|       const lat = Number(coords.latitude);\n01163|       const lng = Number(coords.longitude);\n01164|       \n01165|       console.log(`üìç –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: lat=${lat}, lng=${lng}`);\n01166|       \n01167|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω—ã\n01168|       if (lat < -90 || lat > 90 || lng < -180 || lng > 180 || isNaN(lat) || isNaN(lng)) {\n01169|         console.warn(`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–Ω–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞:`, { \n01170|           lat, lng, \n01171|           latValid: lat >= -90 && lat <= 90,\n01172|           lngValid: lng >= -180 && lng <= 180,\n01173|           latIsNaN: isNaN(lat),\n01174|           lngIsNaN: isNaN(lng)\n01175|         });\n01176|         return null;\n01177|       }\n01178|       \n01179|       console.log('‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã:', { latitude: lat, longitude: lng });\n01180|       return { latitude: lat, longitude: lng };\n01181|     };\n01182|     \n01183|     try {\n01184|       // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–æ–Ω–∞—Ö –∏ —Å–∫–ª–∞–¥–∞—Ö –ø–æ –∞–¥—Ä–µ—Å–∞–º\n01185|       console.log(`üöÄ –ü–≠–ö: –Ω–∞—á–∏–Ω–∞–µ–º —Ä–∞—Å—á–µ—Ç`);\n01186|       console.log(`üìç –û—Ç: ${form.fromAddress || form.fromCity}`);\n01187|       console.log(`üìç –î–æ: ${form.toAddress || form.toCity}`);\n01188|       \n01189|       const senderZone = await getPekZoneByAddress(form.fromAddress || `–≥ ${form.fromCity}`);\n01190|       const receiverZone = await getPekZoneByAddress(form.toAddress || `–≥ ${form.toCity}`);\n01191|       \n01192|       console.log(`üîç –ü–≠–ö –∑–æ–Ω—ã:`);\n01193|       console.log(`üìç –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å:`, senderZone ? `${senderZone.branchTitle} (${senderZone.mainWarehouseId})` : '–ù–ï –ù–ê–ô–î–ï–ù–ê');\n01194|       console.log(`üìç –ü–æ–ª—É—á–∞—Ç–µ–ª—å:`, receiverZone ? `${receiverZone.branchTitle} (${receiverZone.mainWarehouseId})` : '–ù–ï –ù–ê–ô–î–ï–ù–ê');\n01195|       \n01196|       if (!senderZone || !receiverZone) {\n01197|         // –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞\n01198|         const debugInfo = {\n01199|           senderAddress: form.fromAddress || form.fromCity,\n01200|           receiverAddress: form.toAddress || form.toCity,\n01201|           senderZoneFound: !!senderZone,\n01202|           receiverZoneFound: !!receiverZone,\n01203|           apiTested: true\n01204|         };\n01205|         \n01206|         console.error(`‚ùå –ü–≠–ö: –∑–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã`, debugInfo);\n01207|         \n01208|         return {\n01209|           company: '–ü–≠–ö',\n01210|           price: 0,\n01211|           days: 0,\n01212|           error: `–ó–æ–Ω–∞ –ü–≠–ö –Ω–µ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥—Ä–µ—Å–∞: ${!senderZone ? (form.fromAddress || form.fromCity) : ''} ${!receiverZone ? (form.toAddress || form.toCity) : ''}`.trim(),\n01213|           apiUrl,\n01214|           requestData: debugInfo,\n01215|           responseData: { senderZone, receiverZone }\n01216|         };\n01217|       }\n01218| \n01219|       // –ü–æ–ª—É—á–∞–µ–º –±–ª–∏–∂–∞–π—à–∏–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –∞–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞\n01220|       let senderWarehouseId = senderZone.mainWarehouseId;\n01221|       let receiverWarehouseId = receiverZone.mainWarehouseId;\n01222|       \n01223|       if (form.fromAddressDelivery && senderZone.warehousePoint) {\n01224|         const validSenderCoords = validateCoordinates(senderZone.warehousePoint);\n01225|         if (validSenderCoords) {\n01226|           try {\n01227|             const senderDepartment = await getPekNearestDepartments(\n01228|               form.fromAddress || form.fromCity,\n01229|               {\n01230|                 latitude: validSenderCoords.latitude.toString(),\n01231|                 longitude: validSenderCoords.longitude.toString()\n01232|               }\n01233|             );\n01234|             if (senderDepartment) {\n01235|               senderWarehouseId = senderDepartment.warehouseId;\n01236|               console.log('‚úÖ –ù–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π —Å–∫–ª–∞–¥ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è:', senderDepartment.warehouseId);\n01237|             }\n01238|           } catch (error) {\n01239|             console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥:', error);\n01240|           }\n01241|         } else {\n01242|           console.warn('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥');\n01243|         }\n01244|       }\n01245|       \n01246|       if (form.toAddressDelivery && receiverZone.warehousePoint) {\n01247|         const validReceiverCoords = validateCoordinates(receiverZone.warehousePoint);\n01248|         if (validReceiverCoords) {\n01249|           try {\n01250|             const receiverDepartment = await getPekNearestDepartments(\n01251|               form.toAddress || form.toCity,\n01252|               {\n01253|                 latitude: validReceiverCoords.latitude.toString(),\n01254|                 longitude: validReceiverCoords.longitude.toString()\n01255|               }\n01256|             );\n01257|             if (receiverDepartment) {\n01258|               receiverWarehouseId = receiverDepartment.warehouseId;\n01259|               console.log('‚úÖ –ù–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π —Å–∫–ª–∞–¥ –ø–æ–ª—É—á–∞—Ç–µ–ª—è:', receiverDepartment.warehouseId);\n01260|             }\n01261|           } catch (error) {\n01262|             console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥:', error);\n01263|           }\n01264|         } else {\n01265|           console.warn('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥');\n01266|         }\n01267|       }\n01268| \n01269|       // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞—Ç—ã N –¥–Ω–µ–π –æ—Ç —Å–µ–≥–æ–¥–Ω—è\n01270|       const getDateForCalculation = (daysFromToday: number): string => {\n01271|         const date = new Date();\n01272|         date.setDate(date.getDate() + daysFromToday);\n01273|         return date.toISOString().slice(0, 19); // 2025-09-28T14:00:00\n01274|       };\n01275| \n01276|       // –ù–∞—á–∏–Ω–∞–µ–º —Å –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–≥–æ –¥–Ω—è\n01277|       let currentDayOffset = 1;\n01278|       let plannedDateTime = getDateForCalculation(currentDayOffset);\n01279| \n01280|       // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤ (–±–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç)\n01281|       const cargos = form.cargos.map(cargo => {\n01282|         const cargoData = {\n01283|           length: cargo.length / 100, // –ø–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–µ—Ç—Ä—ã\n01284|           width: cargo.width / 100,\n01285|           height: cargo.height / 100,\n01286|           volume: (cargo.length * cargo.width * cargo.height) / 1000000, // –º3\n01287|           weight: cargo.weight,\n01288|           isHP: form.needPackaging, // –∑–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n01289|           sealingPositionsCount: 0\n01290|         };\n01291|         \n01292|         console.log('üì¶ –ì—Ä—É–∑ –¥–ª—è –ü–≠–ö:', cargoData);\n01293|         return cargoData;\n01294|       });\n01295| \n01296|       // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (–Ω—É–∂–Ω–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ)\n01297|       let finalRequestData: any = null;\n01298|       \n01299|       // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ —Ä–∞—Å—á–µ—Ç–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç–æ–π\n01300|       const tryCalculateWithDate = async (plannedDateTime: string): Promise<any> => {\n01301|         // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –∫ API –ü–≠–ö —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n01302|         const requestData: any = {\n01303|           currencyCode: \"643\", // —Ä—É–±–ª–∏\n01304|           types: [3], // —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ –ø–µ—Ä–µ–≤–æ–∑–∫–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –º–∞—Å—Å–∏–≤)\n01305|           senderWarehouseId,\n01306|           receiverWarehouseId,\n01307|           isOpenCarSender: false,\n01308|           isOpenCarReceiver: false,\n01309|           isHyperMarket: false,\n01310|           plannedDateTime,\n01311|           isInsurance: form.needInsurance && form.declaredValue > 0,\n01312|           isInsurancePrice: form.needInsurance ? form.declaredValue : 0,\n01313|           isPickUp: form.fromAddressDelivery,\n01314|           isDelivery: form.toAddressDelivery,\n01315|           needReturnDocuments: false,\n01316|           needArrangeTransportationDocuments: false,\n01317|           senderDistanceType: 0,\n01318|           receiverDistanceType: 0,\n01319|           cargos // –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤\n01320|         };\n01321|         \n01322|         console.log('üìã –ü–≠–ö: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ requestData:', JSON.stringify(requestData, null, 2));\n01323| \n01324|         // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏ –ü–†–† –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\n01325|         if (form.needCarry) {\n01326|           requestData.pickupServices = {\n01327|             isLoading: true,\n01328|             floor: Math.max(0, form.floor - 1), // –ü–≠–ö —Å—á–∏—Ç–∞–µ—Ç —Å 0\n01329|             carryingDistance: 0,\n01330|             isElevator: form.hasFreightLift\n01331|           };\n01332|           requestData.deliveryServices = {\n01333|             isLoading: true,\n01334|             floor: Math.max(0, form.floor - 1),\n01335|             carryingDistance: 0,\n01336|             isElevator: form.hasFreightLift\n01337|           };\n01338|         }\n01339| \n01340|         // –î–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫–∏ pickup/delivery —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ü–≠–ö\n01341|         if (form.fromAddressDelivery) {\n01342|           console.log('üìç –ü–≠–ö: –¥–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ pickup –¥–ª—è –∑–∞–±–æ—Ä–∞');\n01343|           requestData.pickup = {\n01344|             address: form.fromAddress || `–†–æ—Å—Å–∏—è, ${form.fromCity}`\n01345|             // coordinates –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏\n01346|           };\n01347|         }\n01348|         \n01349|         if (form.toAddressDelivery) {\n01350|           console.log('üìç –ü–≠–ö: –¥–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ delivery –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏');\n01351|           requestData.delivery = {\n01352|             address: form.toAddress || `–†–æ—Å—Å–∏—è, ${form.toCity}`\n01353|             // coordinates –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏\n01354|           };\n01355|         }\n01356| \n01357|         // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n01358|         const requiredFields = ['types', 'senderWarehouseId', 'receiverWarehouseId', 'plannedDateTime', 'cargos'];\n01359|         const missingFields = requiredFields.filter(field => !requestData[field]);\n01360|         \n01361|         if (missingFields.length > 0) {\n01362|           throw new Error(`–ü–≠–ö: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: ${missingFields.join(', ')}`);\n01363|         }\n01364|         \n01365|         if (!Array.isArray(requestData.types) || requestData.types.length === 0) {\n01366|           throw new Error('–ü–≠–ö: –ø–æ–ª–µ types –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º');\n01367|         }\n01368|         \n01369|         if (!Array.isArray(requestData.cargos) || requestData.cargos.length === 0) {\n01370|           throw new Error('–ü–≠–ö: –ø–æ–ª–µ cargos –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º');\n01371|         }\n01372|         \n01373|         console.log('‚úÖ –ü–≠–ö: –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –ø—Ä–æ–π–¥–µ–Ω–∞');\n01374| \n01375|         // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏\n01376|         finalRequestData = {\n01377|           method: 'calculateprice',\n01378|           ...requestData\n01379|         };\n01380|         \n01381|         console.log('üöÄ –ü–≠–ö API –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å:', JSON.stringify(finalRequestData, null, 2));\n01382|         console.log('üåê –ü–≠–ö API URL:', apiUrl);\n01383|         console.log('üìã –ü–≠–ö: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–ø–æ–≤ —Ç–∞—Ä–∏—Ñ–æ–≤:', requestData.types.length);\n01384|         console.log('üìã –ü–≠–ö: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤:', requestData.cargos.length);\n01385|       \n01386|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π\n01387|       if (finalRequestData.pickup?.coordinates) {\n01388|         console.log('üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã pickup:', finalRequestData.pickup.coordinates);\n01389|       }\n01390|       if (finalRequestData.delivery?.coordinates) {\n01391|         console.log('üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã delivery:', finalRequestData.delivery.coordinates);\n01392|       }\n01393| \n01394|       const response = await fetch('/api/pek', {\n01395|         method: 'POST',\n01396|         headers: {\n01397|           'Content-Type': 'application/json',\n01398|         },\n01399|         body: JSON.stringify(finalRequestData)\n01400|       });\n01401| \n01402|       console.log(`üì° –ü–≠–ö API —Ä–∞—Å—á–µ—Ç —Å—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`);\n01403|       console.log(`üì° –ü–≠–ö API URL: ${response.url}`);\n01404|       \n01405|       const responseText = await response.text();\n01406|       console.log(`üì° –ü–≠–ö API —Å—ã—Ä–æ–π –æ—Ç–≤–µ—Ç:`, responseText.substring(0, 1000));\n01407|       \n01408|       let data;\n01409|       try {\n01410|         data = JSON.parse(responseText);\n01411|         console.log('üöÄ –ü–≠–ö API –æ—Ç–≤–µ—Ç:', JSON.stringify(data, null, 2));\n01412|       } catch (parseError) {\n01413|         console.error('‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', parseError);\n01414|         throw new Error(`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç API: ${responseText.substring(0, 200)}`);\n01415|       }\n01416| \n01417|         return { response, data };\n01418|       };\n01419| \n01420|       // –î–æ–±–∞–≤–ª—è–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞—Å—á–µ—Ç–∞\n01421|       console.log('üîß –ü–≠–ö: –≥–æ—Ç–æ–≤–∏–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞...');\n01422|       console.log('üìç senderWarehouseId:', senderWarehouseId);\n01423|       console.log('üìç receiverWarehouseId:', receiverWarehouseId);\n01424|       console.log('üìÖ –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞:', plannedDateTime);\n01425|       console.log('üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤:', cargos.length);\n01426|       console.log('üîß form.fromAddressDelivery:', form.fromAddressDelivery);\n01427|       console.log('üîß form.toAddressDelivery:', form.toAddressDelivery);\n01428|       \n01429|       // –¶–∏–∫–ª –ø–æ–ø—ã—Ç–æ–∫ —Å —Ä–∞–∑–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏ (–º–∞–∫—Å–∏–º—É–º 7 –¥–Ω–µ–π)\n01430|       const maxRetries = 7;\n01431|       let lastError: Error | null = null;\n01432|       \n01433|       console.log('üöÄ –ü–≠–ö: –∑–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª —Ä–∞—Å—á–µ—Ç–∞...');\n01434|       \n01435|       for (let attempt = 0; attempt < maxRetries; attempt++) {\n01436|         try {\n01437|           console.log(`üìÖ –ü–≠–ö: –ø–æ–ø—ã—Ç–∫–∞ ${attempt + 1}/${maxRetries}, –¥–∞—Ç–∞: ${plannedDateTime}`);\n01438|           \n01439|           const { response, data } = await tryCalculateWithDate(plannedDateTime);\n01440|           \n01441|           if (response.ok && !data.hasError && data.transfers && data.transfers.length > 0) {\n01442|             const transfer = data.transfers[0]; // –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Ç–∞—Ä–∏—Ñ (–∞–≤—Ç–æ)\n01443|             \n01444|             if (!transfer.hasError) {\n01445|           // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —É—Å–ª—É–≥\n01446|           const services: { name: string; description: string; price: number }[] = [];\n01447|           let totalCalculated = 0;\n01448| \n01449|           const processServices = (servicesList: any[], parentName = '') => {\n01450|             servicesList.forEach(service => {\n01451|               const serviceName = parentName ? `${parentName} - ${service.info}` : service.info;\n01452|               const serviceCost = parseFloat(service.cost) || 0;\n01453|               \n01454|               if (serviceCost > 0) {\n01455|                 services.push({\n01456|                   name: serviceName,\n01457|                   description: service.serviceType || '',\n01458|                   price: serviceCost\n01459|                 });\n01460|                 totalCalculated += serviceCost;\n01461|               }\n01462| \n01463|               // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏\n01464|               if (service.services && Array.isArray(service.services)) {\n01465|                 processServices(service.services, serviceName);\n01466|               }\n01467|             });\n01468|           };\n01469| \n01470|           if (transfer.services) {\n01471|             processServices(transfer.services);\n01472|           }\n01473| \n01474|           // –ï—Å–ª–∏ –Ω–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —É—Å–ª—É–≥, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n01475|           if (services.length === 0) {\n01476|             services.push({\n01477|               name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n01478|               description: `${senderZone.branchTitle} - ${receiverZone.branchTitle}`,\n01479|               price: Math.round(transfer.costTotal)\n01480|             });\n01481|           }\n01482| \n01483|           return {\n01484|             company: '–ü–≠–ö',\n01485|             price: Math.round(transfer.costTotal),\n01486|             days: transfer.estDeliveryTime || 3,\n01487|             details: {\n01488|               note: `–î–æ—Å—Ç–∞–≤–∫–∞ ${senderZone.branchTitle} - ${receiverZone.branchTitle} (–∞–≤—Ç–æ)`,\n01489|               services,\n01490|               senderZone: {\n01491|                 title: senderZone.branchTitle,\n01492|                 zone: senderZone.zoneName,\n01493|                 warehouseId: senderWarehouseId\n01494|               },\n01495|               receiverZone: {\n01496|                 title: receiverZone.branchTitle,\n01497|                 zone: receiverZone.zoneName,\n01498|                 warehouseId: receiverWarehouseId\n01499|               }\n01500|             },\n01501|             requestData: finalRequestData,\n01502|             responseData: data,\n01503|             apiUrl\n01504|               };\n01505|             } else {\n01506|               // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ–±–ª–µ–º–æ–π —Å –¥–∞—Ç–æ–π\n01507|               const errorMessage = transfer.errorMessage || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞ –ü–≠–ö';\n01508|               if (errorMessage.includes('–∑–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω') || errorMessage.includes('–≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã')) {\n01509|                 console.log(`üìÖ –ü–≠–ö: ${errorMessage}. –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...`);\n01510|                 lastError = new Error(errorMessage);\n01511|                 // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é\n01512|                 currentDayOffset++;\n01513|                 plannedDateTime = getDateForCalculation(currentDayOffset);\n01514|                 continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –¥–∞—Ç—É\n01515|               } else {\n01516|                 throw new Error(errorMessage);\n01517|               }\n01518|             }\n01519|           } else {\n01520|             // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—à–∏–±–∫—É –Ω–∞ —É—Ä–æ–≤–Ω–µ –¥–∞–Ω–Ω—ã—Ö\n01521|             const errorMessage = data.errorMessage || data.message || '–û—à–∏–±–∫–∞ API –ü–≠–ö';\n01522|             if (errorMessage.includes('–∑–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω') || errorMessage.includes('–≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã')) {\n01523|               console.log(`üìÖ –ü–≠–ö: ${errorMessage}. –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...`);\n01524|               lastError = new Error(errorMessage);\n01525|               // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é\n01526|               currentDayOffset++;\n01527|               plannedDateTime = getDateForCalculation(currentDayOffset);\n01528|               continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –¥–∞—Ç—É\n01529|             } else {\n01530|               throw new Error(errorMessage);\n01531|             }\n01532|           }\n01533|         } catch (error: any) {\n01534|           console.error(`‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –Ω–∞ –ø–æ–ø—ã—Ç–∫–µ ${attempt + 1}:`, error.message);\n01535|           \n01536|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ–±–ª–µ–º–æ–π —Å –¥–∞—Ç–æ–π\n01537|           if (error.message?.includes('–∑–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω') || error.message?.includes('–≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã')) {\n01538|             console.log(`üìÖ –ü–≠–ö: –ø—Ä–æ–±–ª–µ–º–∞ —Å –¥–∞—Ç–æ–π. –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...`);\n01539|             lastError = error;\n01540|             // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é\n01541|             currentDayOffset++;\n01542|             plannedDateTime = getDateForCalculation(currentDayOffset);\n01543|             continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –¥–∞—Ç—É\n01544|           } else {\n01545|             // –î—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞ - –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ä–∞–∑—É\n01546|             throw error;\n01547|           }\n01548|         }\n01549|       }\n01550|       \n01551|       // –ï—Å–ª–∏ –¥–æ—à–ª–∏ –¥–æ —Å—é–¥–∞ - –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã\n01552|       console.error(`‚ùå –ü–≠–ö: –≤—Å–µ ${maxRetries} –ø–æ–ø—ã—Ç–æ–∫ –∏—Å—á–µ—Ä–ø–∞–Ω—ã. –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞:`, lastError?.message);\n01553|       throw lastError || new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—É—é –¥–∞—Ç—É –¥–ª—è –∑–∞–±–æ—Ä–∞ –≥—Ä—É–∑–∞');\n01554|       \n01555|     } catch (error: any) {\n01556|       console.error('üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ü–≠–ö API:', error);\n01557|       \n01558|       // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –æ—à–∏–±–∫–∏\n01559|       let errorDescription = '–û—à–∏–±–∫–∞ API –ü–≠–ö';\n01560|       \n01561|       if (error.message?.includes('Failed to fetch')) {\n01562|         errorDescription = 'API –ü–≠–ö –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';\n01563|       } else if (error.message?.includes('401')) {\n01564|         errorDescription = '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ü–≠–ö';\n01565|       } else if (error.message?.includes('400')) {\n01566|         errorDescription = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞';\n01567|       } else if (error.message?.includes('timeout')) {\n01568|         errorDescription = '–¢–∞–π–º-–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ API';\n01569|       }\n01570|       \n01571|       console.error(`üö® –ü–≠–ö: ${errorDescription}. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ñ–æ–ª–ª–±—ç–∫ —Ä–∞—Å—á–µ—Ç—É`);\n01572|       \n01573|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n01574|       const totalVolume = form.cargos.reduce((sum, cargo) => \n01575|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n01576|       );\n01577|       \n01578|       // –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π —Ñ–æ–ª–ª–±—ç–∫ —Ä–∞—Å—á–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Å–∞ –∏ –æ–±—ä–µ–º–∞\n01579|       let basePrice = Math.max(\n01580|         totalWeight * 18, // 18 —Ä—É–± –∑–∞ –∫–≥\n01581|         totalVolume * 4500 // 4500 —Ä—É–± –∑–∞ –º3\n01582|       );\n01583|       \n01584|       // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏\n01585|       const services: { name: string; description: string; price: number }[] = [];\n01586|       \n01587|       services.push({\n01588|         name: '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞',\n01589|         description: `${form.fromCity} - ${form.toCity} (${totalWeight} –∫–≥, ${totalVolume.toFixed(3)} –º¬≥)`,\n01590|         price: Math.round(basePrice)\n01591|       });\n01592|       \n01593|       if (form.fromAddressDelivery) {\n01594|         const pickupCost = 600;\n01595|         basePrice += pickupCost;\n01596|         services.push({\n01597|           name: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n01598|           description: '–û—Ç –∞–¥—Ä–µ—Å–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è',\n01599|           price: pickupCost\n01600|         });\n01601|       }\n01602|       \n01603|       if (form.toAddressDelivery) {\n01604|         const deliveryCost = 600;\n01605|         basePrice += deliveryCost;\n01606|         services.push({\n01607|           name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n01608|           description: '–î–æ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è',\n01609|           price: deliveryCost\n01610|         });\n01611|       }\n01612|       \n01613|       if (form.needInsurance && form.declaredValue > 0) {\n01614|         const insuranceCost = form.declaredValue * 0.012;\n01615|         basePrice += insuranceCost;\n01616|         services.push({\n01617|           name: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ',\n01618|           description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n01619|           price: Math.round(insuranceCost)\n01620|         });\n01621|       }\n01622|       \n01623|       if (form.needPackaging) {\n01624|         const packagingCost = totalWeight * 25;\n01625|         basePrice += packagingCost;\n01626|         services.push({\n01627|           name: '–ó–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞',\n01628|           description: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n01629|           price: Math.round(packagingCost)\n01630|         });\n01631|       }\n01632|       \n01633|       if (form.needCarry) {\n01634|         const carryCost = 500;\n01635|         basePrice += carryCost;\n01636|         services.push({\n01637|           name: '–ü–æ–¥—ä–µ–º –Ω–∞ —ç—Ç–∞–∂',\n01638|           description: `–ù–∞ ${form.floor} —ç—Ç–∞–∂ ${form.hasFreightLift ? '(—Å –ª–∏—Ñ—Ç–æ–º)' : '(–±–µ–∑ –ª–∏—Ñ—Ç–∞)'}`,\n01639|           price: carryCost\n01640|         });\n01641|       }\n01642|       \n01643|       return {\n01644|         company: '–ü–≠–ö',\n01645|         price: Math.round(basePrice),\n01646|         days: 3,\n01647|         details: {\n01648|           note: '–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º –ü–≠–ö (API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)',\n01649|           services,\n01650|           totalWeight,\n01651|           totalVolume,\n01652|           errorInfo: error.message\n01653|         },\n01654|         requestData: null,\n01655|         responseData: null,\n01656|         apiUrl,\n01657|         error: `${errorDescription}. –ü–æ–∫–∞–∑–∞–Ω –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º.`\n01658|       };\n01659|     }\n01660|   };\n01661| \n01662| \n01663| \n01664|   const calculateRailContinent = async (): Promise<CalculationResult> => {\n01665|     await new Promise(resolve => setTimeout(resolve, 1200));\n01666|     const basePrice = form.cargos.reduce((sum, cargo) => sum + cargo.weight * 12, 0);\n01667|     let totalPrice = basePrice;\n01668|     \n01669|     if (form.needInsurance) totalPrice += form.declaredValue * 0.025;\n01670|     if (form.needPackaging) totalPrice += basePrice * 0.08;\n01671|     \n01672|     return {\n01673|       company: 'Rail Continent',\n01674|       price: totalPrice,\n01675|       days: 5,\n01676|       apiUrl: 'https://www.railcontinent.ru/services/prochie-gruzoperevozki/forshop/api-manual/',\n01677|       details: { note: '–ó–∞–≥–ª—É—à–∫–∞ - API –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω' }\n01678|     };\n01679|   };\n01680| \n01681|   const handleCalculate = async () => {\n01682|     setCalculating(true);\n01683|     setCalculations([]);\n01684|     \n01685|     // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø–æ—Å–ª–µ —Ä–∞—Å—á–µ—Ç–∞\n01686|     localStorage.setItem('deliveryForm', JSON.stringify(form));\n01687|     \n01688|     try {\n01689|       const results = await Promise.all([\n01690|         calculateDellin(),\n01691|         calculatePEK(),\n01692|         calculateNordWheel(),\n01693|         calculateRailContinent()\n01694|       ]);\n01695|       \n01696|       // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ü–µ–Ω–µ\n01697|       const sortedResults = results\n01698|         .filter(result => !result.error)\n01699|         .sort((a, b) => a.price - b.price)\n01700|         .concat(results.filter(result => result.error));\n01701|       \n01702|       setCalculations(sortedResults);\n01703|     } catch (error) {\n01704|       console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ:', error);\n01705|     } finally {\n01706|       setCalculating(false);\n01707|     }\n01708|   };\n01709| \n01710|   const exportToPDF = () => {\n01711|     if (typeof window !== 'undefined') {\n01712|       window.print();\n01713|     }\n01714|   };\n01715| \n01716|   const toggleDetails = (company: string) => {\n01717|     setExpandedDetails(prev => ({\n01718|       ...prev,\n01719|       [company]: !prev[company]\n01720|     }));\n01721|   };\n01722| \n01723|   const toggleDebugInfo = (company: string) => {\n01724|     setExpandedDebugInfo(prev => ({\n01725|       ...prev,\n01726|       [company]: !prev[company]\n01727|     }));\n01728|   };\n01729| \n01730|   // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞—Å—á–µ—Ç–∞\n01731|   const handleReset = () => {\n01732|     if (typeof window !== 'undefined') {\n01733|       // –û—á–∏—â–∞–µ–º localStorage\n01734|       localStorage.removeItem('deliveryForm');\n01735|       \n01736|       // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É\n01737|       setForm(initialFormState);\n01738|       \n01739|       // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è\n01740|       setCalculations([]);\n01741|       setExpandedDetails({});\n01742|       setExpandedDebugInfo({});\n01743|       setSuggestions([]);\n01744|       setShowSuggestions(false);\n01745|       setActiveField('');\n01746|       \n01747|       console.log('–§–æ—Ä–º–∞ —Å–±—Ä–æ—à–µ–Ω–∞ –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é');\n01748|     }\n01749|   };\n01750| \n01751|   // –ü–∞—Ä—Å–µ—Ä –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è —á–∏—Ç–∞–µ–º–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞\n01752|   const parseCalculationDetails = (calc: CalculationResult) => {\n01753|     const details: { service: string; description: string; price: number }[] = [];\n01754|     \n01755|     if (calc.company === '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏' && calc.details) {\n01756|       // –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ (—É–∂–µ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –±–∞–∑–æ–≤—ã–µ —É—Å–ª—É–≥–∏ –∏ —É–ø–∞–∫–æ–≤–∫—É)\n01757|       let basePrice = calc.details.price || calc.price || 0;\n01758|       \n01759|       // –†–∞–∑–±–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ\n01760|       let intercityPrice = 0;\n01761|       let derivalPrice = 0;\n01762|       let arrivalPrice = 0;\n01763|       let packagingPrice = 0;\n01764|       // packagingPremiums –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è - –Ω–∞–¥–±–∞–≤–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ pkg.price\n01765|       let insurancePrice = 0;\n01766|       \n01767|       // –ú–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞\n01768|       if (calc.details.intercity?.price) {\n01769|         intercityPrice = calc.details.intercity.price;\n01770|         details.push({\n01771|           service: '–ú–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞',\n01772|           description: `${form.fromCity} - ${form.toCity}`,\n01773|           price: intercityPrice\n01774|         });\n01775|       }\n01776|       \n01777|       // –ó–∞–±–æ—Ä –≥—Ä—É–∑–∞\n01778|       if (calc.details.derival?.price) {\n01779|         derivalPrice = calc.details.derival.price;\n01780|         details.push({\n01781|           service: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n01782|           description: '–û—Ç –∞–¥—Ä–µ—Å–∞',\n01783|           price: derivalPrice\n01784|         });\n01785|       }\n01786|       \n01787|       // –î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞\n01788|       if (calc.details.arrival?.price) {\n01789|         arrivalPrice = calc.details.arrival.price;\n01790|         details.push({\n01791|           service: '–û—Ç–≤–æ–∑ –≥—Ä—É–∑–∞',\n01792|           description: '–î–æ –∞–¥—Ä–µ—Å–∞',\n01793|           price: arrivalPrice\n01794|         });\n01795|       }\n01796|       \n01797|       // –£–ø–∞–∫–æ–≤–∫–∞ (–Ω–∞–¥–±–∞–≤–∫–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ pkg.price, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏)\n01798|       if (form.needPackaging && calc.details.packages) {\n01799|         Object.entries(calc.details.packages).forEach(([key, pkg]: [string, any]) => {\n01800|           if (pkg.price && pkg.price > 0) {\n01801|             // –í—ã—á–∏—Å–ª—è–µ–º –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É —É–ø–∞–∫–æ–≤–∫–∏ (–±–µ–∑ –Ω–∞–¥–±–∞–≤–æ–∫) –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n01802|             let basePkgPrice = pkg.price;\n01803|             let totalPremiums = 0;\n01804|             \n01805|             if (pkg.premiumDetails && Array.isArray(pkg.premiumDetails)) {\n01806|               totalPremiums = pkg.premiumDetails.reduce((sum: number, premium: any) => \n01807|                 sum + (premium.value || 0), 0);\n01808|               basePkgPrice = pkg.price - totalPremiums;\n01809|             }\n01810|             \n01811|             packagingPrice += pkg.price; // –í –æ–±—â—É—é —Å—É–º–º—É –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–Ω—É—é —Ü–µ–Ω—É\n01812|             \n01813|             // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—É—é —É–ø–∞–∫–æ–≤–∫—É\n01814|             details.push({\n01815|               service: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n01816|               description: '–£–ø–∞–∫–æ–≤–∞—Ç—å –≤ –∫–æ–º–ø–ª–µ–∫—Å ¬´–æ–±—Ä–µ—à—ë—Ç–∫–∞ + –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è¬ª',\n01817|               price: basePkgPrice\n01818|             });\n01819|             \n01820|             // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–¥–±–∞–≤–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ (–¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏, –Ω–æ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –∫ –æ–±—â–µ–π —Å—É–º–º–µ)\n01821|             if (pkg.premiumDetails && Array.isArray(pkg.premiumDetails)) {\n01822|               pkg.premiumDetails.forEach((premium: any) => {\n01823|                 if (premium.value && premium.value > 0) {\n01824|                   details.push({\n01825|                     service: '–ù–∞–¥–±–∞–≤–∫–∞ –∫ —É–ø–∞–∫–æ–≤–∫–µ',\n01826|                     description: premium.name || '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–¥–±–∞–≤–∫–∞',\n01827|                     price: premium.value\n01828|                   });\n01829|                 }\n01830|               });\n01831|             }\n01832|           }\n01833|         });\n01834|       }\n01835|       \n01836|       // –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ\n01837|       if (form.needInsurance && calc.details.insurance) {\n01838|         insurancePrice = calc.details.insurance;\n01839|         details.push({\n01840|           service: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n01841|           description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n01842|           price: insurancePrice\n01843|         });\n01844|       }\n01845|       \n01846|       // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏\n01847|       details.push({\n01848|         service: '–î–æ–ø.—É—Å–ª—É–≥–∏',\n01849|         description: '–ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ –≥—Ä—É–∑–∞',\n01850|         price: 15\n01851|       });\n01852|       \n01853|       // –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –º–µ–∂–¥—É —Å—É–º–º–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é, –¥–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞—Ç–æ–∫\n01854|       const calculatedSum = intercityPrice + derivalPrice + arrivalPrice + packagingPrice + insurancePrice + 15;\n01855|       const remainder = basePrice - calculatedSum;\n01856|       \n01857|       if (Math.abs(remainder) > 1) { // –ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –±–æ–ª—å—à–µ 1 —Ä—É–±–ª—è\n01858|         details.push({\n01859|           service: remainder > 0 ? '–ü—Ä–æ—á–∏–µ —É—Å–ª—É–≥–∏' : '–°–∫–∏–¥–∫–∞',\n01860|           description: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–±–æ—Ä—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏',\n01861|           price: remainder\n01862|         });\n01863|       }\n01864|     } else if (calc.company === 'Nord Wheel' && calc.details) {\n01865|       // –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –¥–ª—è Nord Wheel —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º\n01866|       if (calc.details.totalCost) {\n01867|         details.push({\n01868|           service: '–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',\n01869|           description: '',\n01870|           price: calc.details.totalCost\n01871|         });\n01872|       }\n01873|       if (calc.details.deliveryCost) {\n01874|         details.push({\n01875|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–∑–∫–∏',\n01876|           description: '',\n01877|           price: calc.details.deliveryCost\n01878|         });\n01879|       }\n01880|       if (calc.details.terminalCost) {\n01881|         details.push({\n01882|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –º–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–≤–æ–∑–∫–∏',\n01883|           description: '',\n01884|           price: calc.details.terminalCost\n01885|         });\n01886|       }\n01887|       if (calc.details.pickupCost) {\n01888|         details.push({\n01889|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–±–æ—Ä–∞',\n01890|           description: '',\n01891|           price: calc.details.pickupCost\n01892|         });\n01893|       }\n01894|       if (calc.details.deliveryToDoorCost) {\n01895|         details.push({\n01896|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–æ –¥–≤–µ—Ä–∏',\n01897|           description: '',\n01898|           price: calc.details.deliveryToDoorCost\n01899|         });\n01900|       }\n01901|       if (calc.details.additionalServices && calc.details.additionalServices > 0) {\n01902|         details.push({\n01903|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ–ø.—É—Å–ª—É–≥',\n01904|           description: '',\n01905|           price: calc.details.additionalServices\n01906|         });\n01907|       }\n01908| \n01909|     } else if (calc.company === '–ü–≠–ö' && calc.details?.services) {\n01910|       // –î–ª—è –ü–≠–ö –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ API\n01911|       calc.details.services.forEach((service: any) => {\n01912|         if (service.price > 0) {\n01913|           details.push({\n01914|             service: service.name || '–£—Å–ª—É–≥–∞ –ü–≠–ö',\n01915|             description: service.description || '',\n01916|             price: service.price\n01917|           });\n01918|         }\n01919|       });\n01920|     } else {\n01921|       // –î–ª—è –¥—Ä—É–≥–∏—Ö –¢–ö - –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n01922|       details.push({\n01923|         service: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n01924|         description: `${form.fromCity} - ${form.toCity}`,\n01925|         price: calc.price\n01926|       });\n01927|       \n01928|       if (form.needInsurance && form.declaredValue > 0) {\n01929|         details.push({\n01930|           service: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ',\n01931|           description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n01932|           price: Math.round(form.declaredValue * 0.02)\n01933|         });\n01934|       }\n01935|       \n01936|       if (form.needPackaging) {\n01937|         const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n01938|         details.push({\n01939|           service: '–£–ø–∞–∫–æ–≤–∫–∞',\n01940|           description: '',\n01941|           price: Math.round(totalWeight * 30)\n01942|         });\n01943|       }\n01944|     }\n01945|     \n01946|     return details;\n01947|   };\n01948| \n01949|   return (\n01950|     <div className=\"min-h-screen bg-gray-900 text-white p-4 relative\">\n01951|       <div className=\"max-w-7xl mx-auto\">\n01952|         <h1 className=\"text-2xl font-bold text-center mb-6 text-blue-400\">\n01953|           –ú–µ–∂–¥—É–≥–æ—Ä–æ–¥–Ω—è—è –¥–æ—Å—Ç–∞–≤–∫–∞ –õ–∞–≤—Å–∏—Ç\n01954|         </h1>\n01955|         \n01956|         {/* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ API */}\n01957|         <Alert className=\"border-blue-500 bg-blue-900/20 mb-4\">\n01958|           <Building2 className=\"h-4 w-4 text-blue-400\" />\n01959|           <AlertDescription className=\"text-blue-100\">\n01960|             <strong className=\"text-blue-300\">üöö –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ü–≠–ö –≥–æ—Ç–æ–≤!</strong> –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ API –ü–≠–ö.\n01961|             <br />\n01962|             <a href=\"/env-check\" className=\"text-blue-400 underline font-medium hover:text-blue-300\">\n01963|               –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ü–≠–ö API ‚Üí\n01964|             </a>\n01965|             {' | '}\n01966|             <a href=\"/pek-test\" className=\"text-blue-400 underline font-medium hover:text-blue-300\">\n01967|               –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ API ‚Üí\n01968|             </a>\n01969|           </AlertDescription>\n01970|         </Alert>\n01971|         \n01972|         <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4 h-[90vh]\">\n01973|           {/* –õ–µ–≤–∞—è —á–∞—Å—Ç—å - —Ñ–æ—Ä–º–∞ */}\n01974|           <div className=\"space-y-3 overflow-y-auto pr-2\">\n01975|             {/* –ì—Ä—É–∑—ã */}\n01976|             <Card className=\"bg-gray-800 border-gray-700\">\n01977|               <CardHeader className=\"pb-3\">\n01978|                 <CardTitle className=\"text-white flex items-center gap-2 text-lg\">\n01979|                   <Truck className=\"h-4 w-4\" />\n01980|                   –ì—Ä—É–∑—ã\n01981|                 </CardTitle>\n01982|               </CardHeader>\n01983|               <CardContent className=\"space-y-3\">\n01984|                 {form.cargos.map((cargo, index) => (\n01985|                   <div key={cargo.id} className=\"border border-gray-600 rounded p-3\">\n01986|                     <div className=\"flex justify-between items-center mb-2\">\n01987|                       <h4 className=\"text-sm font-medium text-white\">–ì—Ä—É–∑ ‚Ññ{index + 1}</h4>\n01988|                       {form.cargos.length > 1 && (\n01989|                         <Button\n01990|                           variant=\"destructive\"\n01991|                           size=\"sm\"\n01992|                           onClick={() => removeCargo(cargo.id)}\n01993|                           className=\"h-6 text-xs\"\n01994|                         >\n01995|                           –£–¥–∞–ª–∏—Ç—å\n01996|                         </Button>\n01997|                       )}\n01998|                     </div>\n01999|                     <div className=\"grid grid-cols-2 gap-2\">\n02000|                       <div>\n\n(File has more lines. Use 'offset' parameter to read beyond line 2000)\n</file>",
    "metadata": {
      "preview": "'use client';\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Plus, Truck, Building2, Map } from 'lucide-react';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { Collapsible, CollapsibleContent } from '@/components/ui/collapsible';\n\ninterface Cargo {\n  id: string;\n  length: number;\n  width: number;\n  height: number;\n  weight: number;"
    },
    "title": "app/page.tsx",
    "time": {
      "start": 1759002518061,
      "end": 1759002518067
    }
  }
}