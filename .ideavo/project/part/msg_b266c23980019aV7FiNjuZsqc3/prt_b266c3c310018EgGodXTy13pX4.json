{
  "id": "prt_b266c3c310018EgGodXTy13pX4",
  "sessionID": "ses_4dcf54091ffe1XHg1W7jdm1ovr",
  "messageID": "msg_b266c23980019aV7FiNjuZsqc3",
  "type": "tool",
  "callID": "toolu_01KLFxuEZk81yKMKXvqwcC3n",
  "tool": "edit",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx",
      "newString": "import { Plus, Truck, Building2, Map, Settings, Package2, Trash2, Loader2, Eye, EyeOff } from 'lucide-react';",
      "oldString": "import { Plus, Truck, Building2, Map, Settings, Package2, Trash2, Loader2 } from 'lucide-react';"
    },
    "output": "",
    "title": "app/page.tsx",
    "metadata": {
      "diagnostics": {},
      "diff": "Index: /home/user/project/app/page.tsx\n===================================================================\n--- /home/user/project/app/page.tsx\n+++ /home/user/project/app/page.tsx\n@@ -6,9 +6,9 @@\n import { Input } from '@/components/ui/input';\n import { Label } from '@/components/ui/label';\n import { Checkbox } from '@/components/ui/checkbox';\n import { Switch } from '@/components/ui/switch';\n-import { Plus, Truck, Building2, Map, Settings, Package2, Trash2, Loader2 } from 'lucide-react';\n+import { Plus, Truck, Building2, Map, Settings, Package2, Trash2, Loader2, Eye, EyeOff } from 'lucide-react';\n import { Alert, AlertDescription } from '@/components/ui/alert';\n import { Badge } from '@/components/ui/badge';\n import { Separator } from '@/components/ui/separator';\n import { Collapsible, CollapsibleContent } from '@/components/ui/collapsible';\n",
      "filediff": {
        "file": "/home/user/project/app/page.tsx",
        "before": "'use client';\n\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Switch } from '@/components/ui/switch';\nimport { Plus, Truck, Building2, Map, Settings, Package2, Trash2, Loader2 } from 'lucide-react';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { Collapsible, CollapsibleContent } from '@/components/ui/collapsible';\nimport { LazyProductSearch, LazyTruckVisualization } from '@/components/LazyLoadedComponents';\nimport ProductManager from '@/components/ProductManager';\nimport CalculationProgress from '@/components/CalculationProgress';\nimport { FurnitureProduct, ProductInForm, CargoWithMetadata } from '@/lib/furniture-types';\nimport { saveFormData, loadFormData, hasStoredFormData, createDebouncedSaver, clearFormData } from '@/lib/form-storage';\nimport {\n  createCargosForProduct,\n  removeCargosForProduct,\n  calculateTotalValue,\n  findCargoIndexesForProduct\n} from '@/lib/furniture-utils';\nimport { enhancedApiRequest } from '@/lib/api-utils';\nimport { cacheManager } from '@/lib/cache-manager';\nimport { optimizedApiClient } from '@/lib/optimized-api-client';\nimport SaveCalculation from '@/components/SaveCalculation';\nimport CalculationHistory from '@/components/CalculationHistory';\n\ninterface Cargo {\n  id: string;\n  length: number;\n  width: number;\n  height: number;\n  weight: number;\n  // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–≤—è–∑–∏ —Å —Ç–æ–≤–∞—Ä–∞–º–∏\n  productId?: string;\n  placeNumber?: number;\n  isFromProduct?: boolean;\n  addedAt?: number;\n}\n\ninterface DeliveryForm {\n  cargos: Cargo[];\n  fromCity: string;\n  toCity: string;\n  fromAddress: string;\n  toAddress: string;\n  declaredValue: number;\n  needPackaging: boolean;\n  needLoading: boolean;\n  needCarry: boolean;\n  floor: number;\n  hasFreightLift: boolean;\n  needInsurance: boolean;\n  fromTerminal: boolean;\n  toTerminal: boolean;\n  fromAddressDelivery: boolean;\n  toAddressDelivery: boolean;\n  fromLavsiteWarehouse: boolean;\n  // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ç–æ–≤–∞—Ä–æ–≤\n  selectedProducts: ProductInForm[];\n}\n\ninterface CalculationResult {\n  company: string;\n  price: number;\n  days: number;\n  details?: any;\n  error?: string;\n  requestData?: any;\n  responseData?: any;\n  apiUrl?: string;\n  sessionId?: string;\n}\n\ninterface AddressSuggestion {\n  value: string;\n  unrestricted_value: string;\n  data: {\n    city?: string;\n    street?: string;\n    house?: string;\n  };\n}\n\n// –û–ø—Ä–µ–¥–µ–ª–∏–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–º–ø–∞–Ω–∏–π\nconst COMPANIES_BASE = [\n  { name: '–ü–≠–ö', logo: 'üöõ', apiKey: 'pek' },\n  { name: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏', logo: 'üì¶', apiKey: 'dellin' },\n  { name: 'Rail Continent', logo: 'üöÇ', apiKey: 'railcontinent' },\n  { name: '–í–æ–∑–æ–≤–æ–∑', logo: 'üöö', apiKey: 'vozovoz' },\n  { name: 'Nord Wheel', logo: 'üåê', apiKey: 'nordwheel' },\n  { name: '–°–¥—ç–∫', logo: 'üìÆ', apiKey: 'cdek' },\n  { name: '–ù–æ–≤–∞—è –ª–∏–Ω–∏—è', logo: 'üõ£Ô∏è', apiKey: 'newline' },\n  { name: '–ò—Ä-–¢—Ä–∞—Å—Ç', logo: 'üè≠', apiKey: 'irtrust' },\n  { name: '–ú–∞–π–æ—Ä —Ç—Ä–∞–Ω—Å', logo: '‚≠ê', apiKey: 'majortrans' },\n  { name: '–ë–ê–ô–ö–ê–õ –°–ï–†–í–ò–°', logo: 'üåä', apiKey: 'baikalservice' },\n  { name: '–ê–¥–∞–º–∞–Ω—Ç', logo: 'üíé', apiKey: 'adamant' },\n  { name: '–≠–ù–ï–†–ì–ò–Ø', logo: '‚ö°', apiKey: 'energiya' },\n  { name: '–¶–ê–ü', logo: 'üéØ', apiKey: 'cap' },\n  { name: '–£—Ä–∞–ª–¢—Ä–∞–Ω—Å–ö–æ–º–ø–∞–Ω–∏', logo: '‚õ∞Ô∏è', apiKey: 'uraltrans' },\n  { name: '–ù–û–í–û–¢–≠–ö', logo: 'üîß', apiKey: 'novotek' },\n  { name: '–ö–∏—Ç', logo: 'üêã', apiKey: 'kit' },\n  { name: '–ö–∞—Ä–∞–≤–∞–Ω', logo: 'üê™', apiKey: 'karavan' },\n  { name: '–ñ–µ–ª–î–æ—Ä–≠–∫—Å–ø–µ–¥–∏—Ü–∏—è', logo: 'üöÑ', apiKey: 'zeldor' },\n  { name: '–î–ö –¢—Ä–∞–Ω–∑–∏—Ç', logo: 'üöê', apiKey: 'dktransit' },\n  { name: '–ì–ª–∞–≤—Ç—Ä–∞—Å—Å–∞', logo: 'üõ§Ô∏è', apiKey: 'glavtrassa' },\n  { name: '–ë–∞–ª—Ç–∏–π—Å–∫–∞—è –°–ª—É–∂–±–∞ –î–æ—Å—Ç–∞–≤–∫–∏', logo: '‚öì', apiKey: 'baltservice' },\n  { name: '–ê–ù–ö–û–†', logo: 'üîó', apiKey: 'ankor' }\n];\n\nexport default function Home() {\n  // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n  const initialFormState: DeliveryForm = {\n    cargos: [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n    fromCity: '',\n    toCity: '',\n    fromAddress: '',\n    toAddress: '',\n    declaredValue: 0,\n    needPackaging: false,\n    needLoading: false,\n    needCarry: false,\n    floor: 1,\n    hasFreightLift: false,\n    needInsurance: false,\n    fromTerminal: true,\n    toTerminal: true,\n    fromAddressDelivery: false,\n    toAddressDelivery: false,\n    fromLavsiteWarehouse: false,\n    selectedProducts: []\n  };\n\n  const [form, setForm] = useState<DeliveryForm>(initialFormState);\n  const [isLoaded, setIsLoaded] = useState(false);\n  const [isRestoring, setIsRestoring] = useState(false);\n  const [lastSaveTime, setLastSaveTime] = useState<Date | null>(null);\n  const [isFormChanged, setIsFormChanged] = useState(false);\n  \n  // –°–æ–∑–¥–∞–µ–º –¥–µ–±–∞—É–Ω—Å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (—Å–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è)\n  const debouncedSave = useMemo(() => {\n    const saver = createDebouncedSaver(1000);\n    // –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã\n    return (formData: any) => {\n      setIsFormChanged(true);\n      saver(formData);\n      // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É\n      setTimeout(() => {\n        setLastSaveTime(new Date());\n        setIsFormChanged(false);\n      }, 1100);\n    };\n  }, []);\n\n  const [suggestions, setSuggestions] = useState<AddressSuggestion[]>([]);\n  const [showSuggestions, setShowSuggestions] = useState(false);\n  const [activeField, setActiveField] = useState('');\n  \n  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω–∏–µ–º/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n  const [enabledCompanies, setEnabledCompanies] = useState<Record<string, boolean>>({\n    pek: true,\n    dellin: true,\n    railcontinent: true,\n    vozovoz: true,\n    nordwheel: true,\n    cdek: true,\n    newline: false,\n    irtrust: false,\n    majortrans: false,\n    baikalservice: false,\n    adamant: false,\n    energiya: false,\n    cap: false,\n    uraltrans: false,\n    novotek: false,\n    kit: true,\n    karavan: false,\n    zeldor: false,\n    dktransit: false,\n    glavtrassa: false,\n    baltservice: false,\n    ankor: false\n  });\n  const [calculations, setCalculations] = useState<CalculationResult[]>([]);\n  const [calculating, setCalculating] = useState(false);\n  const [calculationProgress, setCalculationProgress] = useState<{\n    companies: Array<{\n      name: string;\n      status: 'pending' | 'loading' | 'completed' | 'error';\n      progress?: number;\n      error?: string;\n      duration?: number;\n    }>;\n    totalDuration: number;\n  }>({\n    companies: [],\n    totalDuration: 0\n  });\n  const [expandedDetails, setExpandedDetails] = useState<{ [key: string]: boolean }>({});\n  const [expandedDebugInfo, setExpandedDebugInfo] = useState<{ [key: string]: boolean }>({});\n  const [suggestionPosition, setSuggestionPosition] = useState({ top: 0, left: 0 });\n  const [apiStatus, setApiStatus] = useState({\n    pek: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n    dellin: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n    railcontinent: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n    vozovoz: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n    nordwheel: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n    cdek: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n    kit: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n    newline: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    irtrust: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    majortrans: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    baikalservice: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    adamant: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    energiya: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    cap: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    uraltrans: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    novotek: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    karavan: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    zeldor: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    dktransit: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    glavtrassa: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    baltservice: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    ankor: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ'\n  });\n\n  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–∫—Ä—ã—Ç—ã—Ö —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n  const [hiddenCompanies, setHiddenCompanies] = useState<Record<string, boolean>>({});\n  const [showHiddenCompanies, setShowHiddenCompanies] = useState(false);\n\n  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –º–µ–Ω—é (—Å–∫—Ä—ã—Ç–æ/–ø–æ–∫–∞–∑–∞–Ω–æ)\n  const [isServiceMenuVisible, setIsServiceMenuVisible] = useState<boolean>(() => {\n    if (typeof window !== 'undefined') {\n      const saved = localStorage.getItem('serviceMenuVisible');\n      return saved !== null ? JSON.parse(saved) : true; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑–∞–Ω–æ\n    }\n    return true;\n  });\n\n  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –º–µ–Ω—é –≤ localStorage\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      localStorage.setItem('serviceMenuVisible', JSON.stringify(isServiceMenuVisible));\n    }\n  }, [isServiceMenuVisible]);\n\n  // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö - –ù–ï –æ—á–∏—â–∞–µ–º localStorage –≤ dev —Ä–µ–∂–∏–º–µ\n  // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞–º–∏\n\n  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏\n  useEffect(() => {\n    if (typeof window !== 'undefined' && isLoaded) {\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ (–ø–æ—Å–ª–µ Clear-Site-Data)\n      const delayedCheck = setTimeout(() => {\n        const currentFormData = loadFormData();\n        if (!currentFormData) {\n          console.log('üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –∏—â–µ–º backup...');\n          \n          // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ backup –¥–∞–Ω–Ω—ã–µ\n          const backupKeys = ['formBackup1', 'formBackup2', 'formBackup3'];\n          for (const key of backupKeys) {\n            const backup = localStorage.getItem(key);\n            if (backup) {\n              try {\n                localStorage.setItem('deliveryFormData', backup);\n                console.log('üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ backup:', key);\n                \n                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ\n                const restoredData = loadFormData();\n                if (restoredData) {\n                  setIsRestoring(true);\n                  const restoredForm: DeliveryForm = {\n                    cargos: restoredData.cargos.length > 0 ? restoredData.cargos : [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n                    fromCity: restoredData.fromCity,\n                    toCity: restoredData.toCity,\n                    fromAddress: restoredData.fromAddress,\n                    toAddress: restoredData.toAddress,\n                    declaredValue: restoredData.declaredValue,\n                    needPackaging: restoredData.needPackaging,\n                    needLoading: restoredData.needLoading,\n                    needCarry: restoredData.needCarry,\n                    floor: restoredData.floor,\n                    hasFreightLift: restoredData.hasFreightLift,\n                    needInsurance: restoredData.needInsurance,\n                    fromTerminal: restoredData.fromTerminal,\n                    toTerminal: restoredData.toTerminal,\n                    fromAddressDelivery: restoredData.fromAddressDelivery,\n                    toAddressDelivery: restoredData.toAddressDelivery,\n                    fromLavsiteWarehouse: restoredData.fromLavsiteWarehouse || false,\n                    selectedProducts: restoredData.selectedProducts,\n                  };\n                  setForm(restoredForm);\n                  if (restoredData.enabledCompanies && Object.keys(restoredData.enabledCompanies).length > 0) {\n                    setEnabledCompanies(restoredData.enabledCompanies);\n                  }\n                  if (restoredData.hiddenCompanies && Object.keys(restoredData.hiddenCompanies).length > 0) {\n                    setHiddenCompanies(restoredData.hiddenCompanies);\n                  }\n                  setTimeout(() => setIsRestoring(false), 100);\n                  console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!');\n                }\n                break;\n              } catch (e) {\n                console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ backup:', key, e);\n              }\n            }\n          }\n        }\n      }, 2000);\n      \n      return () => clearTimeout(delayedCheck);\n    }\n  }, [isLoaded]);\n\n  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)\n  useEffect(() => {\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ\n    if (typeof window !== 'undefined' && !isLoaded) {\n      let dataRestored = false;\n      try {\n        setIsRestoring(true); // –ë–ª–æ–∫–∏—Ä—É–µ–º –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è\n        \n        // –ú—è–≥–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –±–µ–∑ –æ—á–∏—Å—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö\n        const currentVersion = 'v2.4.0-persistent-storage'; // –í–µ—Ä—Å–∏—è —Å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º\n        const savedVersion = localStorage.getItem('appVersion');\n        \n        if (savedVersion !== currentVersion) {\n          console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ', currentVersion);\n          // –ù–ï –æ—á–∏—â–∞–µ–º localStorage - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ\n          localStorage.setItem('appVersion', currentVersion);\n        }\n        \n        // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É\n        const savedFormData = loadFormData();\n        if (savedFormData) {\n          // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞\n          const restoredForm: DeliveryForm = {\n            cargos: savedFormData.cargos.length > 0 ? savedFormData.cargos : [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n            fromCity: savedFormData.fromCity,\n            toCity: savedFormData.toCity,\n            fromAddress: savedFormData.fromAddress,\n            toAddress: savedFormData.toAddress,\n            declaredValue: savedFormData.declaredValue,\n            needPackaging: savedFormData.needPackaging,\n            needLoading: savedFormData.needLoading,\n            needCarry: savedFormData.needCarry,\n            floor: savedFormData.floor,\n            hasFreightLift: savedFormData.hasFreightLift,\n            needInsurance: savedFormData.needInsurance,\n            fromTerminal: savedFormData.fromTerminal,\n            toTerminal: savedFormData.toTerminal,\n            fromAddressDelivery: savedFormData.fromAddressDelivery,\n            toAddressDelivery: savedFormData.toAddressDelivery,\n            fromLavsiteWarehouse: savedFormData.fromLavsiteWarehouse || false,\n            selectedProducts: savedFormData.selectedProducts,\n          };\n          \n          setForm(restoredForm);\n          \n          // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n            if (savedFormData.enabledCompanies && Object.keys(savedFormData.enabledCompanies).length > 0) {\n              setEnabledCompanies(savedFormData.enabledCompanies);\n            }\n            if (savedFormData.hiddenCompanies && Object.keys(savedFormData.hiddenCompanies).length > 0) {\n              setHiddenCompanies(savedFormData.hiddenCompanies);\n            }\n          console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ localStorage');\n          \n          // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è Supabase\n          const currentTime = Math.floor(Date.now() / 1000);\n          console.log('üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (timestamp):', currentTime);\n          console.log('üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (ISO):', new Date().toISOString());\n          \n          dataRestored = true;\n          // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—Å–ø–µ–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è\n          setTimeout(() => {\n            setIsRestoring(false);\n          }, 100);\n        } else {\n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏\n          const oldSaved = localStorage.getItem('deliveryForm');\n          if (oldSaved) {\n            console.log('üîÑ –ù–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç–∞—Ä–æ–º —Ñ–æ—Ä–º–∞—Ç–µ, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è...');\n            const oldForm = JSON.parse(oldSaved);\n            if (!oldForm.cargos || oldForm.cargos.length === 0) {\n              oldForm.cargos = [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }];\n            }\n            setForm(oldForm);\n            \n            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –∏ —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ\n            saveFormData(oldForm);\n            localStorage.removeItem('deliveryForm');\n            console.log('‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');\n            \n            dataRestored = true;\n            // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—Å–ø–µ–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è\n            setTimeout(() => {\n              setIsRestoring(false);\n            }, 100);\n          }\n        }\n        \n        // –í—ã–≤–æ–¥–∏–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¢–ö –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n        console.log('üìã –í—Å–µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ –¢–ö:', COMPANIES_BASE.length);\n        console.log('üìã –°–ø–∏—Å–æ–∫ –¢–ö:', COMPANIES_BASE.map(c => c.name));\n        \n      } catch (error) {\n        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);\n        // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ\n      } finally {\n        // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, —Å—Ä–∞–∑—É —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ\n        if (!dataRestored) {\n          setIsRestoring(false);\n        }\n        setIsLoaded(true);\n      }\n    }\n  }, [isLoaded]);\n\n  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–æ—Ä–º—ã (—Å –¥–µ–±–∞—É–Ω—Å–æ–º)\n  useEffect(() => {\n    if (typeof window !== 'undefined' && isLoaded && !isRestoring) {\n      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–±–∞—É–Ω—Å –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è\n      debouncedSave({\n        cargos: form.cargos,\n        fromCity: form.fromCity,\n        toCity: form.toCity,\n        fromAddress: form.fromAddress,\n        toAddress: form.toAddress,\n        declaredValue: form.declaredValue,\n        needPackaging: form.needPackaging,\n        needLoading: form.needLoading,\n        needCarry: form.needCarry,\n        floor: form.floor,\n        hasFreightLift: form.hasFreightLift,\n        needInsurance: form.needInsurance,\n        fromTerminal: form.fromTerminal,\n        toTerminal: form.toTerminal,\n        fromAddressDelivery: form.fromAddressDelivery,\n        toAddressDelivery: form.toAddressDelivery,\n        fromLavsiteWarehouse: form.fromLavsiteWarehouse,\n        selectedProducts: form.selectedProducts,\n        enabledCompanies: enabledCompanies,\n        hiddenCompanies: hiddenCompanies,\n      });\n    }\n  }, [form, enabledCompanies, isLoaded, isRestoring, debouncedSave]);\n\n  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –ø—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n  useEffect(() => {\n    if (form.declaredValue > 0) {\n      setForm(prev => ({ ...prev, needInsurance: true }));\n    }\n  }, [form.declaredValue]);\n\n  // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤\n  useEffect(() => {\n    const handleMessage = (event: MessageEvent) => {\n      if (event.data && event.data.type === 'PRODUCTS_UPDATED') {\n        console.log('üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤:', event.data.data);\n        \n        // –û—á–∏—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫—ç—à–∏ —Ç–æ–≤–∞—Ä–æ–≤\n        const keysToRemove: string[] = [];\n        for (let i = 0; i < localStorage.length; i++) {\n          const key = localStorage.key(i);\n          if (key && (key.startsWith('furniture_') || key.startsWith('product_') || key.includes('ProductSearch'))) {\n            keysToRemove.push(key);\n          }\n        }\n        keysToRemove.forEach(key => localStorage.removeItem(key));\n        console.log(`üßΩ –û—á–∏—â–µ–Ω–æ ${keysToRemove.length} –∫–ª—é—á–µ–π –∫—ç—à–∞ —Ç–æ–≤–∞—Ä–æ–≤`);\n        \n        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É ProductSearch –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è\n        window.dispatchEvent(new CustomEvent('forceProductsReload', {\n          detail: event.data.data\n        }));\n      }\n    };\n    \n    window.addEventListener('message', handleMessage);\n    \n    return () => {\n      window.removeEventListener('message', handleMessage);\n    };\n  }, []);\n\n  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã\n  useEffect(() => {\n    if (typeof window !== 'undefined' && isLoaded) {\n      checkAllAPIStatus();\n    }\n  }, [isLoaded]);\n\n  const checkAPIStatus = async (apiName: string, testFunction: () => Promise<any>) => {\n    try {\n      const result = await testFunction();\n      if (result && !result.error) {\n        setApiStatus(prev => ({ ...prev, [apiName]: '–ø–æ–¥–∫–ª—é—á–µ–Ω–æ' }));\n      } else {\n        setApiStatus(prev => ({ ...prev, [apiName]: '–æ—à–∏–±–∫–∞' }));\n      }\n    } catch (error) {\n      setApiStatus(prev => ({ ...prev, [apiName]: '–æ—à–∏–±–∫–∞' }));\n    }\n  };\n\n  const checkAllAPIStatus = async () => {\n    // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\n    const testData = {\n      fromCity: '–ú–æ—Å–∫–≤–∞',\n      toCity: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', \n      cargos: [{ id: '1', length: 100, width: 100, height: 100, weight: 10 }],\n      declaredValue: 50000,\n      fromAddressDelivery: false,\n      toAddressDelivery: false,\n      needPackaging: false,\n      needInsurance: false\n    };\n\n    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n    const currentForm = form;\n    \n    // –í—Ä–µ–º–µ–Ω–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ\n    setForm({\n      ...form,\n      fromCity: testData.fromCity,\n      toCity: testData.toCity,\n      cargos: testData.cargos,\n      declaredValue: testData.declaredValue,\n      fromAddressDelivery: testData.fromAddressDelivery,\n      toAddressDelivery: testData.toAddressDelivery,\n      needPackaging: testData.needPackaging,\n      needInsurance: testData.needInsurance\n    });\n\n    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ\n    Promise.all([\n      checkAPIStatus('pek', async () => {\n        try {\n          const response = await fetch('/api/pek', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ method: 'test' })\n          });\n          const data = await response.json();\n          if (data.status === 'OK') {\n            return { success: true };\n          } else {\n            return { error: true };\n          }\n        } catch (error) {\n          return { error: true };\n        }\n      }),\n      \n      checkAPIStatus('dellin', async () => {\n        try {\n          // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ sessionID –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π (—Ç–æ—Ç –∂–µ –º–µ—Ç–æ–¥ —á—Ç–æ –≤ calculateDellin)\n          const authResponse = await fetch('https://api.dellin.ru/v3/auth/login.json', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n              login: 'service@lavsit.ru',\n              password: 'edcwsx123QAZ'\n            })\n          });\n          const authData = await authResponse.json();\n          \n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ –∫ sessionID –∫–∞–∫ –≤ calculateDellin\n          if (authData.data?.sessionID || authData.sessionID || authData.data?.session) {\n            return { success: true };\n          } else {\n            return { error: true };\n          }\n        } catch (error) {\n          return { error: true };\n        }\n      }),\n      \n      checkAPIStatus('railcontinent', async () => {\n        try {\n          const response = await fetch('/api/rail-continent', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              city_sender: testData.fromCity,\n              city_receiver: testData.toCity,\n              weight: 10,\n              volume: 0.1,\n              length: 1,\n              width: 1,\n              height: 1,\n              declared_cost: testData.declaredValue,\n              pickup: '0',\n              delivery: '0',\n              packaging: '0',\n              insurance: '0',\n              tariff: 'auto'\n            })\n          });\n          return await response.json();\n        } catch (error) {\n          return { error: true };\n        }\n      }),\n      \n      checkAPIStatus('vozovoz', async () => {\n        try {\n          const response = await fetch('/api/vozovoz', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              object: \"price\",\n              action: \"get\",\n              params: {\n                cargo: {\n                  dimension: {\n                    quantity: 1,\n                    volume: 0.1,\n                    weight: 10\n                  }\n                },\n                gateway: {\n                  dispatch: {\n                    point: {\n                      location: testData.fromCity,\n                      terminal: \"default\"\n                    }\n                  },\n                  destination: {\n                    point: {\n                      location: testData.toCity,\n                      terminal: \"default\"\n                    }\n                  }\n                }\n              }\n            })\n          });\n          return await response.json();\n        } catch (error) {\n          return { error: true };\n        }\n      }),\n      \n      checkAPIStatus('nordwheel', async () => {\n        try {\n          // Use the same API endpoint and format as the main calculation function\n          const requestData = {\n            dispatch: {\n              location: {\n                type: 'terminal',\n                city_fias: '0c5b2444-70a0-4932-980c-b4dc0d3f02b5' // Moscow\n              }\n            },\n            destination: {\n              location: {\n                type: 'terminal',\n                city_fias: 'c2deb16a-0330-4f05-821f-1d09c93331e6' // St. Petersburg\n              }\n            },\n            cargo: {\n              total_weight: 10,\n              total_volume: 0.1,\n              total_quantity: 1\n            },\n            insurance: 50000,\n            insurance_refuse: false,\n            services: {\n              is_package: true,\n              is_documents_return: false,\n              is_fragile: false\n            },\n            promocode: null\n          };\n\n          const result = await enhancedApiRequest(\n            '/api/nordwheel',\n            {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json'\n              },\n              body: JSON.stringify(requestData)\n            },\n            { operation: 'calculate', company: 'Nord Wheel' }\n          );\n\n          if (result && typeof result === 'object' && 'success' in result && !result.success) {\n            console.error('‚ùå Nord Wheel API –æ—à–∏–±–∫–∞:', result.error);\n            return { error: true };\n          }\n\n          const response = result as Response;\n          const data = await response.json();\n          \n          if (response.ok && (data.auto || data.avia || data.success)) {\n            return { success: true };\n          } else {\n            console.error('‚ùå Nord Wheel API status check –æ—à–∏–±–∫–∞:', data);\n            return { error: true };\n          }\n        } catch (error) {\n          return { error: true };\n        }\n      }),\n      \n      checkAPIStatus('cdek', async () => {\n        try {\n          const response = await fetch('/api/cdek', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              from_city: testData.fromCity,\n              to_city: testData.toCity,\n              packages: [{\n                height: 10,\n                length: 20,\n                width: 10,\n                weight: 1000\n              }]\n            })\n          });\n          const data = await response.json();\n          \n          if (response.ok && data.tariff_codes && data.tariff_codes.length > 0) {\n            return { success: true };\n          } else {\n            return { error: true };\n          }\n        } catch (error) {\n          return { error: true };\n        }\n      })\n    ]).finally(() => {\n      // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n      setForm(currentForm);\n    });\n  };\n\n  const searchAddresses = useCallback(async (query: string, field: string, element?: HTMLInputElement) => {\n    if (query.length < 3) {\n      setSuggestions([]);\n      setShowSuggestions(false);\n      return;\n    }\n\n    setActiveField(field);\n    \n    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ –∞–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–æ–∫\n    if (element) {\n      const rect = element.getBoundingClientRect();\n      setSuggestionPosition({\n        top: rect.bottom + window.scrollY,\n        left: rect.left + window.scrollX\n      });\n    }\n    \n    try {\n      const response = await fetch('https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json',\n          'Authorization': 'Token eb87bbb3789bb43ed465f796892ea951f9e91008'\n        },\n        body: JSON.stringify({\n          query: query,\n          count: 10,\n          // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª–µ–π –≥–æ—Ä–æ–¥–æ–≤ - —Ç–æ–ª—å–∫–æ –≥–æ—Ä–æ–¥–∞\n          ...(field === 'fromCity' || field === 'toCity' ? {\n            restrict_value: true,\n            locations: [{\n              country: '–†–æ—Å—Å–∏—è'\n            }],\n            from_bound: { value: 'city' },\n            to_bound: { value: 'city' }\n          } : {})\n        })\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        setSuggestions(data.suggestions || []);\n        setShowSuggestions(true);\n      }\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫:', error);\n    }\n  }, []);\n\n  const debounceTimer = React.useRef<NodeJS.Timeout>();\n  const handleAddressChange = (field: string, value: string, element?: HTMLInputElement) => {\n    setForm(prev => ({ ...prev, [field]: value }));\n    \n    clearTimeout(debounceTimer.current);\n    debounceTimer.current = setTimeout(() => {\n      searchAddresses(value, field, element);\n    }, 50);\n  };\n\n  const selectSuggestion = (suggestion: AddressSuggestion) => {\n    setForm(prev => ({ ...prev, [activeField]: suggestion.value }));\n    setShowSuggestions(false);\n    setActiveField('');\n  };\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞ \"–°–æ —Å–∫–ª–∞–¥–∞ –õ–∞–≤—Å–∏—Ç\"\n  const handleLavsiteWarehouseChange = (checked: boolean) => {\n    if (checked) {\n      setForm(prev => ({\n        ...prev,\n        fromLavsiteWarehouse: true,\n        fromAddressDelivery: true,\n        fromTerminal: false,\n        fromCity: '–õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π',\n        fromAddress: '–¥–µ—Ä–µ–≤–Ω—è –û—Å–µ–µ–≤–æ, 202, –≥–æ—Ä–æ–¥—Å–∫–æ–π –æ–∫—Ä—É–≥ –õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π, –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å'\n      }));\n    } else {\n      setForm(prev => ({\n        ...prev,\n        fromLavsiteWarehouse: false,\n        fromCity: '',\n        fromAddress: ''\n      }));\n    }\n  };\n\n  const addCargo = () => {\n    const newId = (form.cargos.length + 1).toString();\n    setForm(prev => ({\n      ...prev,\n      cargos: [...prev.cargos, { id: newId, length: 0, width: 0, height: 0, weight: 0 }]\n    }));\n  };\n\n  const updateCargo = (id: string, field: string, value: number) => {\n    setForm(prev => {\n      const updatedCargos = prev.cargos.map(cargo => \n        cargo.id === id ? { ...cargo, [field]: value } : cargo\n      );\n      \n      // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n      const cleanResult = cleanEmptyCargos(updatedCargos, prev.selectedProducts || []);\n      \n      return {\n        ...prev,\n        cargos: cleanResult.cargos,\n        selectedProducts: cleanResult.products\n      };\n    });\n  };\n\n  const removeCargo = (id: string) => {\n    if (form.cargos.length > 1) {\n      setForm(prev => ({\n        ...prev,\n        cargos: prev.cargos.filter(cargo => cargo.id !== id)\n      }));\n    }\n  };\n\n  // üîß –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ (–≤—Å–µ –ø–æ–ª—è —Ä–∞–≤–Ω—ã 0)\n  const isEmptyCargo = (cargo: Cargo) => {\n    return cargo.length === 0 && cargo.width === 0 && cargo.height === 0 && cargo.weight === 0;\n  };\n\n  // üîß –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤\n  const cleanEmptyCargos = (cargos: Cargo[], selectedProducts: ProductInForm[]) => {\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –≥—Ä—É–∑\n    const hasFilledCargos = cargos.some(cargo => !isEmptyCargo(cargo));\n    \n    if (!hasFilledCargos) {\n      // –ï—Å–ª–∏ –Ω–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –ø—É—Å—Ç–æ–π\n      return {\n        cargos: cargos.length > 0 ? [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }] : [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n        products: selectedProducts\n      };\n    }\n\n    // –°–æ–∑–¥–∞–µ–º –º–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ä—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –∫ –Ω–æ–≤—ã–º\n    const oldToNewIndexMap = new globalThis.Map<number, number>();\n    let newIndex = 0;\n    \n    cargos.forEach((cargo, oldIndex) => {\n      if (!isEmptyCargo(cargo)) {\n        oldToNewIndexMap.set(oldIndex, newIndex);\n        newIndex++;\n      }\n    });\n    \n    // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –≥—Ä—É–∑—ã\n    const filledCargos = cargos.filter(cargo => !isEmptyCargo(cargo));\n    \n    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã —É —Ç–æ–≤–∞—Ä–æ–≤\n    const updatedProducts = selectedProducts.map(productItem => ({\n      ...productItem,\n      cargoIndexes: productItem.cargoIndexes\n        .map(oldIndex => oldToNewIndexMap.get(oldIndex))\n        .filter(newIdx => newIdx !== undefined) as number[]\n    }));\n    \n    return {\n      cargos: filledCargos,\n      products: updatedProducts\n    };\n  };\n\n  // üîß –§—É–Ω–∫—Ü–∏—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≥—Ä—É–∑–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n  interface GroupedCargoDisplay {\n    length: number;\n    width: number;\n    height: number;\n    weight: number;\n    quantity: number;\n    indices: number[];\n    isEmpty: boolean;\n  }\n\n  const groupCargosForDisplay = (cargos: Cargo[]): GroupedCargoDisplay[] => {\n    const groups = new globalThis.Map<string, GroupedCargoDisplay>();\n    \n    cargos.forEach((cargo, index) => {\n      const isEmpty = isEmptyCargo(cargo);\n      \n      // –î–ª—è –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ –Ω–µ –≥—Ä—É–ø–ø–∏—Ä—É–µ–º\n      if (isEmpty) {\n        groups.set(`empty_${index}`, {\n          length: 0,\n          width: 0,\n          height: 0,\n          weight: 0,\n          quantity: 1,\n          indices: [index],\n          isEmpty: true\n        });\n        return;\n      }\n      \n      // –°–æ–∑–¥–∞–µ–º –∫–ª—é—á –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –∏ –≤–µ—Å–∞\n      const key = `${cargo.length}_${cargo.width}_${cargo.height}_${cargo.weight}`;\n      \n      if (groups.has(key)) {\n        const existing = groups.get(key)!;\n        existing.quantity += 1;\n        existing.indices.push(index);\n      } else {\n        groups.set(key, {\n          length: cargo.length,\n          width: cargo.width,\n          height: cargo.height,\n          weight: cargo.weight,\n          quantity: 1,\n          indices: [index],\n          isEmpty: false\n        });\n      }\n    });\n    \n    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤: —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ (–ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É–±—ã–≤–∞–Ω–∏—è), –ø–æ—Ç–æ–º –ø—É—Å—Ç—ã–µ\n    return Array.from(groups.values()).sort((a, b) => {\n      if (a.isEmpty && !b.isEmpty) return 1;\n      if (!a.isEmpty && b.isEmpty) return -1;\n      if (!a.isEmpty && !b.isEmpty) {\n        return b.quantity - a.quantity; // –ü–æ —É–±—ã–≤–∞–Ω–∏—é –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞\n      }\n      return a.indices[0] - b.indices[0]; // –ü—É—Å—Ç—ã–µ –ø–æ –ø–æ—Ä—è–¥–∫—É –∏–Ω–¥–µ–∫—Å–æ–≤\n    });\n  };\n\n  // üîß –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏\n  const handleProductAdd = (product: FurnitureProduct) => {\n    const timestamp = Date.now();\n    \n    console.log(`‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞: ${product.name} (${product.cargoPlaces.length} –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç)`);\n    \n    // –°–æ–∑–¥–∞–µ–º –≥—Ä—É–∑–æ–≤—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è —Ç–æ–≤–∞—Ä–∞\n    const newCargos = createCargosForProduct(product, 1, timestamp);\n    \n    console.log('–°–æ–∑–¥–∞–Ω–æ –Ω–æ–≤—ã—Ö –≥—Ä—É–∑–æ–≤:', newCargos.length);\n    console.log('–ù–æ–≤—ã–µ –≥—Ä—É–∑—ã:', newCargos.map(c => ({ id: c.id, productId: c.productId, addedAt: c.addedAt })));\n    \n    // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç —Ç–æ–≤–∞—Ä–∞ –≤ —Ñ–æ—Ä–º–µ\n    const productInForm: ProductInForm = {\n      product,\n      quantity: 1,\n      totalPrice: product.retailPrice,\n      cargoIndexes: [], // –ó–∞–ø–æ–ª–Ω–∏–º –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–∑–æ–≤\n      addedAt: timestamp\n    };\n    \n    setForm(prev => {\n      let updatedCargos = [...prev.cargos];\n      let cargoIndexes: number[] = [];\n      \n      // –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è\n      const emptyCargos = updatedCargos\n        .map((cargo, index) => ({ cargo, index }))\n        .filter(item => isEmptyCargo(item.cargo));\n      \n      console.log('–ù–∞–π–¥–µ–Ω–æ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤:', emptyCargos.length);\n      console.log('–ù—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –≥—Ä—É–∑–æ–≤:', newCargos.length);\n      \n      // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞\n      let filledCount = 0;\n      for (let i = 0; i < Math.min(emptyCargos.length, newCargos.length); i++) {\n        const emptyCargoIndex = emptyCargos[i].index;\n        const newCargoData = newCargos[i];\n        \n        updatedCargos[emptyCargoIndex] = {\n          ...updatedCargos[emptyCargoIndex],\n          length: newCargoData.length,\n          width: newCargoData.width,\n          height: newCargoData.height,\n          weight: newCargoData.weight,\n          productId: newCargoData.productId,\n          placeNumber: newCargoData.placeNumber,\n          isFromProduct: newCargoData.isFromProduct,\n          addedAt: newCargoData.addedAt\n        };\n        \n        cargoIndexes.push(emptyCargoIndex);\n        filledCount++;\n      }\n      \n      // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –≥—Ä—É–∑–æ–≤, —á–µ–º –µ—Å—Ç—å –ø—É—Å—Ç—ã—Ö - –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ\n      if (filledCount < newCargos.length) {\n        const remainingCargos = newCargos.slice(filledCount);\n        const startIndex = updatedCargos.length;\n        \n        for (let i = 0; i < remainingCargos.length; i++) {\n          updatedCargos.push(remainingCargos[i]);\n          cargoIndexes.push(startIndex + i);\n        }\n      }\n      \n      productInForm.cargoIndexes = cargoIndexes;\n      \n      console.log('–ò–Ω–¥–µ–∫—Å—ã –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤:', cargoIndexes);\n      console.log('–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:', updatedCargos.length);\n      \n      // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n      const prevSelectedProducts = prev.selectedProducts || [];\n      const newSelectedProducts = [...prevSelectedProducts, productInForm];\n      const newDeclaredValue = calculateTotalValue(newSelectedProducts);\n      \n      // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n      const cleanResult = cleanEmptyCargos(updatedCargos, newSelectedProducts);\n      \n      return {\n        ...prev,\n        cargos: cleanResult.cargos,\n        selectedProducts: cleanResult.products,\n        declaredValue: newDeclaredValue\n      };\n    });\n    \n    console.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä: ${product.name} (${newCargos.length} –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç)`);\n    console.log('–§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥—Ä—É–∑–æ–≤:', newCargos.length);\n  };\n\n  const handleProductQuantityChange = (productId: string, addedAt: number, newQuantity: number) => {\n    setForm(prev => {\n      console.log(`üî¢ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞ ${productId} —Å ${prev.selectedProducts?.find(p => p.product.id === productId && p.addedAt === addedAt)?.quantity || 0} –Ω–∞ ${newQuantity}`);\n      \n      // –ù–∞—Ö–æ–¥–∏–º —Ç–æ–≤–∞—Ä\n      const selectedProducts = prev.selectedProducts || [];\n      const productIndex = selectedProducts.findIndex(p => \n        p.product.id === productId && p.addedAt === addedAt\n      );\n      \n      if (productIndex === -1) {\n        console.warn('‚ùå –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞');\n        return prev;\n      }\n      \n      const product = selectedProducts[productIndex];\n      console.log('–ì—Ä—É–∑—ã –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞:', prev.cargos.length);\n      \n      // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –≥—Ä—É–∑—ã —ç—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞\n      const cargosWithoutProduct = removeCargosForProduct(\n        prev.cargos as CargoWithMetadata[], \n        productId, \n        addedAt\n      );\n      \n      console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö:', cargosWithoutProduct.length);\n      \n      // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –≥—Ä—É–∑—ã —Å –Ω–æ–≤—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º\n      const newCargos = createCargosForProduct(product.product, newQuantity, addedAt);\n      const updatedCargos = [...cargosWithoutProduct, ...newCargos];\n      \n      console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö:', updatedCargos.length);\n      \n      // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä\n      const updatedProduct = {\n        ...product,\n        quantity: newQuantity,\n        totalPrice: product.product.retailPrice * newQuantity,\n        cargoIndexes: findCargoIndexesForProduct(updatedCargos, productId, addedAt)\n      };\n      \n      const updatedProducts = selectedProducts.map((p, index) => \n        index === productIndex ? updatedProduct : p\n      );\n      \n      // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n      const newDeclaredValue = calculateTotalValue(updatedProducts);\n      \n      // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n      const cleanResult = cleanEmptyCargos(updatedCargos, updatedProducts);\n      \n      return {\n        ...prev,\n        cargos: cleanResult.cargos,\n        selectedProducts: cleanResult.products,\n        declaredValue: newDeclaredValue\n      };\n    });\n    \n    console.log(`üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ ${productId}: ${newQuantity} —à—Ç.`);\n  };\n\n  const handleProductRemove = (productId: string, addedAt: number) => {\n    setForm(prev => {\n      console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ ${productId} (addedAt: ${addedAt})`);\n      \n      // –ù–∞—Ö–æ–¥–∏–º —Ç–æ–≤–∞—Ä –∏ –µ–≥–æ –∏–Ω–¥–µ–∫—Å—ã –≥—Ä—É–∑–æ–≤\n      const selectedProducts = prev.selectedProducts || [];\n      const product = selectedProducts.find(p => \n        p.product.id === productId && p.addedAt === addedAt\n      );\n      \n      if (!product) {\n        console.log('–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω');\n        return prev;\n      }\n      \n      // –û—á–∏—â–∞–µ–º –≥—Ä—É–∑—ã —Ç–æ–≤–∞—Ä–∞ (–¥–µ–ª–∞–µ–º –∏—Ö –ø—É—Å—Ç—ã–º–∏ –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è)\n      const updatedCargos = prev.cargos.map((cargo, index) => {\n        if (product.cargoIndexes.includes(index)) {\n          return {\n            ...cargo,\n            length: 0,\n            width: 0,\n            height: 0,\n            weight: 0,\n            productId: undefined,\n            placeNumber: undefined,\n            isFromProduct: undefined,\n            addedAt: undefined\n          };\n        }\n        return cargo;\n      });\n      \n      // –£–¥–∞–ª—è–µ–º —Ç–æ–≤–∞—Ä –∏–∑ —Å–ø–∏—Å–∫–∞\n      const updatedProducts = selectedProducts.filter(p => \n        !(p.product.id === productId && p.addedAt === addedAt)\n      );\n      \n      // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n      const newDeclaredValue = calculateTotalValue(updatedProducts);\n      \n      // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n      const cleanResult = cleanEmptyCargos(updatedCargos, updatedProducts);\n      \n      console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:', cleanResult.cargos.length);\n      console.log('–£–¥–∞–ª–µ–Ω–æ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤:', updatedCargos.length - cleanResult.cargos.length);\n      \n      return {\n        ...prev,\n        cargos: cleanResult.cargos,\n        selectedProducts: cleanResult.products,\n        declaredValue: newDeclaredValue\n      };\n    });\n    \n    console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω —Ç–æ–≤–∞—Ä ${productId}`);\n  };\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ sessionID –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n  const getDellinSessionId = async (): Promise<string | null> => {\n    try {\n      const authResponse = await fetch('https://api.dellin.ru/v3/auth/login.json', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n          login: 'service@lavsit.ru',\n          password: 'edcwsx123QAZ'\n        })\n      });\n\n      const authData = await authResponse.json();\n      console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ response.ok:', authResponse.ok);\n      console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData:', authData);\n      console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData.data:', authData.data);\n      console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData.data?.sessionID:', authData.data?.sessionID);\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ –∫ sessionID\n      let sessionID = null;\n      \n      if (authData.data?.sessionID) {\n        sessionID = authData.data.sessionID;\n        console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ data.sessionID:', sessionID);\n      } else if (authData.sessionID) {\n        sessionID = authData.sessionID;\n        console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ sessionID:', sessionID);\n      } else if (authData.data?.session) {\n        sessionID = authData.data.session;\n        console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ data.session:', sessionID);\n      }\n      \n      if (authResponse.ok && sessionID) {\n        return sessionID;\n      } else {\n        console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', authData);\n        console.error('‚ùå –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', authResponse.status);\n        console.error('‚ùå –¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞:', authResponse.statusText);\n        return null;\n      }\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', error);\n    }\n    return null;\n  };\n\n  // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –≥–æ—Ä–æ–¥–æ–≤ –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n  const loadDellinCities = async () => {\n    try {\n      const response = await fetch('/data/dellin-cities.json');\n      if (!response.ok) {\n        console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –≥–æ—Ä–æ–¥–æ–≤');\n        return null;\n      }\n      const data = await response.json();\n      return data.cities;\n    } catch (error) {\n      console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –≥–æ—Ä–æ–¥–æ–≤:', error);\n      return null;\n    }\n  };\n\n  // –ü–æ–∏—Å–∫ cityID –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ\n  const getCityIDFromLocal = async (cityName: string): Promise<string | null> => {\n    const cities = await loadDellinCities();\n    if (!cities) return null;\n\n    const normalizedSearch = cityName.toLowerCase().trim()\n      .replace(/^–≥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥ \"\n      .replace(/^–≥–æ—Ä–æ–¥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥–æ—Ä–æ–¥ \"\n      .replace(/\\s+/g, ' '); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—Ä–æ–±–µ–ª—ã\n\n    console.log(`üîç –ü–æ–∏—Å–∫ cityID –¥–ª—è –≥–æ—Ä–æ–¥–∞: \"${normalizedSearch}\"`);\n\n    // –ü–æ–∏—Å–∫ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ\n    for (const city of cities) {\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –∏–º–µ–Ω–µ–º –≥–æ—Ä–æ–¥–∞\n      if (city.name.toLowerCase() === normalizedSearch) {\n        console.log(`‚úÖ –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: \"${city.name}\" -> cityID: ${city.cityID}`);\n        return city.cityID;\n      }\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –ø–æ–∏—Å–∫–æ–≤—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏\n      for (const searchString of city.searchStrings) {\n        if (searchString === normalizedSearch) {\n          console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ –≤ –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫–∞—Ö: \"${searchString}\" –¥–ª—è –≥–æ—Ä–æ–¥–∞ \"${city.name}\" -> cityID: ${city.cityID}`);\n          return city.cityID;\n        }\n      }\n    }\n\n    console.warn(`‚ö†Ô∏è cityID –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –¥–ª—è –≥–æ—Ä–æ–¥–∞: \"${normalizedSearch}\"`);\n    return null;\n  };\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ cityID —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n  const findCityInDellinDirectory = async (cityName: string): Promise<{cityID: number, code: string} | null> => {\n    try {\n      console.log(`üîç –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –î–õ: ${cityName}`);\n      \n      // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞\n      const normalizedCity = cityName.toLowerCase().trim()\n        .replace(/^–≥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥ \"\n        .replace(/^–≥–æ—Ä–æ–¥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥–æ—Ä–æ–¥ \"\n        .replace(/\\s+/g, ' '); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—Ä–æ–±–µ–ª—ã\n      \n      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞—Å–µ–ª–µ–Ω–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤\n      const response = await fetch('https://api.dellin.ru/v2/public/kladr.json', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n          q: normalizedCity,\n          limit: 10\n        })\n      });\n      \n      const data = await response.json();\n      console.log(`üèôÔ∏è –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞ \"${normalizedCity}\" response:`, data);\n      \n      if (response.ok && data.cities && Array.isArray(data.cities) && data.cities.length > 0) {\n        // –ò—â–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–ª–∏ –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –≥–æ—Ä–æ–¥\n        let bestMatch = data.cities.find((city: any) => \n          city.searchString?.toLowerCase() === normalizedCity ||\n          city.aString?.toLowerCase().includes(normalizedCity)\n        );\n        \n        // –ï—Å–ª–∏ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –Ω–µ—Ç, –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞–º–∏\n        if (!bestMatch) {\n          bestMatch = data.cities.find((city: any) => city.isTerminal === 1);\n        }\n        \n        // –ï—Å–ª–∏ –∏ —ç—Ç–æ–≥–æ –Ω–µ—Ç, –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π\n        if (!bestMatch) {\n          bestMatch = data.cities[0];\n        }\n        \n        if (bestMatch) {\n          console.log(`‚úÖ –ù–∞–π–¥–µ–Ω –≥–æ—Ä–æ–¥:`, {\n            cityID: bestMatch.cityID,\n            name: bestMatch.aString,\n            code: bestMatch.code,\n            hasTerminals: bestMatch.isTerminal === 1\n          });\n          \n          return {\n            cityID: bestMatch.cityID,\n            code: bestMatch.code\n          };\n        }\n      }\n      \n      console.warn(`‚ö†Ô∏è –ì–æ—Ä–æ–¥ \"${normalizedCity}\" –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –î–õ`);\n      return null;\n      \n    } catch (error) {\n      console.error(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –≥–æ—Ä–æ–¥–∞ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –î–õ:`, error);\n      return null;\n    }\n  };\n  \n\n  \n  // –ü–æ–∏—Å–∫ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ —Ä–∞–±–æ—á–∏–π v1 API (–∏–∑ test-dellin-terminals-simple.js)\n  const getDellinTerminalByDirection = async (citySearch: string, direction: 'arrival' | 'derival'): Promise<string | null> => {\n    try {\n      console.log(`üîç –†–ê–ë–û–ß–ò–ô v1 API: –ü–æ–∏—Å–∫ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ ${direction} –¥–ª—è –≥–æ—Ä–æ–¥–∞: ${citySearch}`);\n      \n      // –ü–æ–ª—É—á–∞–µ–º sessionID –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞\n      const sessionID = await getDellinSessionId();\n      if (!sessionID) {\n        console.error('‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç sessionID –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤');\n        return null;\n      }\n      \n      // –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ —Ä–∞–±–æ—á–µ–º—É API\n      const requestData = {\n        appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n        sessionID: sessionID,\n        search: citySearch,\n        direction: direction\n      };\n      \n      console.log(`üì§ –ó–∞–ø—Ä–æ—Å —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤:`, requestData);\n      \n      const response = await fetch('https://api.dellin.ru/v1/public/request_terminals.json', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(requestData)\n      });\n      \n      const data = await response.json();\n      console.log(`üì• –û—Ç–≤–µ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ (${response.status}):`, data);\n      \n      if (!response.ok) {\n        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤:', data);\n        return null;\n      }\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –≤ –æ—Ç–≤–µ—Ç–µ\n      const terminals = data.terminals || [];\n      if (terminals.length === 0) {\n        console.warn(`‚ö†Ô∏è –¢–µ—Ä–º–∏–Ω–∞–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è –≥–æ—Ä–æ–¥–∞ \"${citySearch}\"`);\n        return null;\n      }\n      \n      // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª\n      const selectedTerminal = terminals[0];\n      \n      console.log(`‚úÖ –ù–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª ${direction}:`, {\n        id: selectedTerminal.id,\n        name: selectedTerminal.name,\n        address: selectedTerminal.address\n      });\n      \n      return selectedTerminal.id.toString();\n      \n    } catch (error) {\n      console.error(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ ${direction} (v1 API):`, error);\n      return null;\n    }\n  };\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ –¥–ª—è –≥–æ—Ä–æ–¥–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º)\n  const getDellinTerminal = async (citySearch: string): Promise<string | null> => {\n    return getDellinTerminalByDirection(citySearch, 'arrival');\n  };\n  \n  // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ DaData –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n  const normalizeAddressForDellin = async (address: string): Promise<string> => {\n    try {\n      console.log(`üåê –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ DaData: ${address}`);\n      \n      const response = await fetch('/api/dadata', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          address: address,\n          type: 'clean'\n        })\n      });\n      \n      const data = await response.json();\n      console.log(`üåê DaData response:`, data);\n      \n      if (data.success && data.data?.dellinFormat) {\n        console.log(`‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å: ${data.data.dellinFormat}`);\n        return data.data.dellinFormat;\n      }\n      \n      // –ï—Å–ª–∏ DaData –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∞–¥—Ä–µ—Å\n      console.warn(`‚ö†Ô∏è DaData –Ω–µ —Å–º–æ–≥ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π`);\n      return address;\n      \n    } catch (error) {\n      console.error(`‚ùå –û—à–∏–±–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ DaData:`, error);\n      return address; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∞–¥—Ä–µ—Å –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏\n    }\n  };\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ UID —É–ø–∞–∫–æ–≤–∫–∏ —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π workflow —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –î–õ\n  const getDellinPackageUid = async (packageName: string = 'crate_with_bubble'): Promise<string | null> => {\n    try {\n      console.log(`üì¶ CSV WORKFLOW: –ü–æ–ª—É—á–µ–Ω–∏–µ UID —É–ø–∞–∫–æ–≤–∫–∏ \"${packageName}\" —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π workflow...`);\n      console.log('üì¶ CSV WORKFLOW: API –î–õ ‚Üí CSV —Å—Å—ã–ª–∫–∞ ‚Üí —Å–∫–∞—á–∞—Ç—å CSV ‚Üí –ø–∞—Ä—Å–∏—Ç—å ‚Üí –ø–æ–ª—É—á–∏—Ç—å UID');\n      \n      const response = await fetch('/api/dellin-packages', {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n\n      const data = await response.json();\n      console.log('üì¶ CSV WORKFLOW response.ok:', response.ok);\n      console.log('üì¶ CSV WORKFLOW status:', response.status);\n      console.log('üì¶ CSV WORKFLOW workflow info:', data.workflow || 'not specified');\n      \n      if (response.ok && data.success && data.data && Array.isArray(data.data)) {\n        console.log('üì¶ CSV WORKFLOW: —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫');\n        console.log('üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–ø–∞–∫–æ–≤–æ–∫ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ:', data.data.length);\n        console.log('üì¶ –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:', data.cached ? '–∫—ç—à (24—á)' : '—Å–≤–µ–∂–∏–π CSV —Ñ–∞–π–ª');\n        if (data.csvUrl) {\n          console.log('üì¶ CSV URL:', data.csvUrl);\n        }\n        \n        // –ü–æ–∏—Å–∫ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –≤–∞—Ä–∏–∞–Ω—Ç–∞–º –Ω–∞–∑–≤–∞–Ω–∏—è\n        const searchTerms = [\n          packageName,\n          '–æ–±—Ä–µ—à–µ—Ç–∫–∞',\n          '–æ–±—Ä–µ—à—ë—Ç–∫–∞',\n          '–∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è',\n          'bubble',\n          '–∑–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞'\n        ];\n        \n        let foundPackage: any = null;\n        \n        for (const term of searchTerms) {\n          foundPackage = data.data.find((pkg: any) => \n            pkg.name && pkg.name.toLowerCase().includes(term.toLowerCase())\n          );\n          \n          if (foundPackage) {\n            console.log(`‚úÖ CSV WORKFLOW: –ù–∞–π–¥–µ–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∞ –ø–æ —Ç–µ—Ä–º–∏–Ω—É \"${term}\": ${foundPackage.name} ‚Üí ${foundPackage.uid}`);\n            break;\n          }\n        }\n        \n        if (foundPackage && foundPackage.uid) {\n          return foundPackage.uid;\n        } else {\n          console.log('‚ùå CSV WORKFLOW: –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –ø–æ –ø–æ–∏—Å–∫–æ–≤—ã–º —Ç–µ—Ä–º–∏–Ω–∞–º');\n          \n          // –í—ã–≤–æ–¥–∏–º –ø–µ—Ä–≤—ã–µ 10 —É–ø–∞–∫–æ–≤–æ–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n          console.log('üì¶ –î–æ—Å—Ç—É–ø–Ω—ã–µ —É–ø–∞–∫–æ–≤–∫–∏ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ (–ø–µ—Ä–≤—ã–µ 10):');\n          data.data.slice(0, 10).forEach((pkg: any, index: number) => {\n            console.log(`  ${index + 1}. ${pkg.name} (${pkg.uid})`);\n          });\n        }\n      } else {\n        console.error('‚ùå CSV WORKFLOW: –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞:', data);\n      }\n      \n      return null;\n        \n    } catch (error) {\n      console.error('‚ùå CSV WORKFLOW: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', error);\n      return null;\n    }\n  };\n\n  // –†–∞—Å—á–µ—Ç –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π —á–µ—Ä–µ–∑ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π API v2/calculator.json —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n  const calculateDellin = async (): Promise<CalculationResult> => {\n    const { enhancedApiRequest } = await import('@/lib/api-utils');\n    const apiUrl = 'https://api.dellin.ru/v2/calculator.json';\n    const maxRetries = 2;\n    \n    console.log('üöÄ === –ù–ê–ß–ê–õ–û –†–ê–°–ß–ï–¢–ê –î–ï–õ–û–í–´–• –õ–ò–ù–ò–ô ===');\n    console.log('üöÄ API URL:', apiUrl);\n    \n    try {\n      let sessionID = await getDellinSessionId();\n      \n      if (!sessionID) {\n        return {\n          company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n          price: 0,\n          days: 0,\n          error: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å sessionID',\n          apiUrl,\n          requestData: null,\n          responseData: null\n        };\n      }\n\n      // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏ –æ–±—ä–µ–º—ã\n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n      const totalVolume = form.cargos.reduce((sum, cargo) => \n        sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n      );\n      const maxLength = Math.max(...form.cargos.map(c => c.length)) / 100; // –≤ –º–µ—Ç—Ä–∞—Ö\n      const maxWidth = Math.max(...form.cargos.map(c => c.width)) / 100;\n      const maxHeight = Math.max(...form.cargos.map(c => c.height)) / 100;\n\n      // –ü–æ–ª—É—á–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª—ã –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∞–¥—Ä–µ—Å–∞\n      let fromTerminalId: string | null = null;\n      let toTerminalId: string | null = null;\n      let normalizedFromAddress: string | null = null;\n      let normalizedToAddress: string | null = null;\n      \n      // –î–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ–ª—É—á–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª—ã\n      if (!form.fromAddressDelivery) {\n        fromTerminalId = await getDellinTerminalByDirection(form.fromCity, 'derival');\n      } else {\n        // –î–ª—è –∞–¥—Ä–µ—Å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∞–¥—Ä–µ—Å\n        const addressToNormalize = form.fromAddress || form.fromCity;\n        normalizedFromAddress = await normalizeAddressForDellin(addressToNormalize);\n      }\n      \n      if (!form.toAddressDelivery) {\n        toTerminalId = await getDellinTerminalByDirection(form.toCity, 'arrival');\n      } else {\n        // –î–ª—è –∞–¥—Ä–µ—Å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∞–¥—Ä–µ—Å\n        const addressToNormalize = form.toAddress || form.toCity;\n        normalizedToAddress = await normalizeAddressForDellin(addressToNormalize);\n      }\n      \n      console.log('üè¢ –î–ê–ù–ù–´–ï –î–õ:');\n      console.log('üè¢ form.fromAddressDelivery:', form.fromAddressDelivery);\n      console.log('üè¢ form.toAddressDelivery:', form.toAddressDelivery);\n      console.log('üè¢ fromTerminalId:', fromTerminalId);\n      console.log('üè¢ toTerminalId:', toTerminalId);\n      console.log('üè¢ normalizedFromAddress:', normalizedFromAddress);\n      console.log('üè¢ normalizedToAddress:', normalizedToAddress);\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã –Ω–∞–π–¥–µ–Ω—ã –¢–û–õ–¨–ö–û –¥–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏\n      if (!form.fromAddressDelivery && !fromTerminalId) {\n        console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –≥–æ—Ä–æ–¥–∞:', form.fromCity);\n        return {\n          company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n          price: 0,\n          days: 0,\n          error: `–ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π –≤ –≥–æ—Ä–æ–¥–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è: ${form.fromCity}`,\n          apiUrl,\n          requestData: null,\n          responseData: null\n        };\n      }\n      \n      if (!form.toAddressDelivery && !toTerminalId) {\n        console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≥–æ—Ä–æ–¥–∞:', form.toCity);\n        return {\n          company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n          price: 0,\n          days: 0,\n          error: `–ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π –≤ –≥–æ—Ä–æ–¥–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: ${form.toCity}`,\n          apiUrl,\n          requestData: null,\n          responseData: null\n        };\n      }\n      \n      // –î–ª—è –∞–¥—Ä–µ—Å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∞–¥—Ä–µ—Å–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã\n      if (form.fromAddressDelivery && !normalizedFromAddress) {\n        console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è:', form.fromAddress || form.fromCity);\n        return {\n          company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n          price: 0,\n          days: 0,\n          error: `–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è: ${form.fromAddress || form.fromCity}`,\n          apiUrl,\n          requestData: null,\n          responseData: null\n        };\n      }\n      \n      if (form.toAddressDelivery && !normalizedToAddress) {\n        console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:', form.toAddress || form.toCity);\n        return {\n          company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n          price: 0,\n          days: 0,\n          error: `–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: ${form.toAddress || form.toCity}`,\n          apiUrl,\n          requestData: null,\n          responseData: null\n        };\n      }\n\n      // –ü–æ–ª—É—á–∞–µ–º UID —É–ø–∞–∫–æ–≤–∫–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∞)\n      // –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π UID –¥–ª—è —É–ø–∞–∫–æ–≤–∫–∏ —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º\n      let packageUid: string | null = null;\n      console.log('=== –ù–ê–ß–ê–õ–û –û–¢–õ–ê–î–ö–ò –£–ü–ê–ö–û–í–ö–ò ===');\n      console.log('üîç –û–¢–õ–ê–î–ö–ê –£–ü–ê–ö–û–í–ö–ò: form.needPackaging =', form.needPackaging);\n      console.log('üîç –û–¢–õ–ê–î–ö–ê –£–ü–ê–ö–û–í–ö–ò: typeof form.needPackaging =', typeof form.needPackaging);\n      \n      if (form.needPackaging) {\n        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π UID –¥–ª—è —É–ø–∞–∫–æ–≤–∫–∏\n        packageUid = '0xad97901b0ecef0f211e889fcf4624fec';\n        console.log('üîç ‚úÖ –£–ü–ê–ö–û–í–ö–ê –¢–†–ï–ë–£–ï–¢–°–Ø - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π UID:', packageUid);\n        console.log('üîç ‚úÖ typeof packageUid:', typeof packageUid);\n        console.log('üîç ‚úÖ packageUid truthy:', !!packageUid);\n      } else {\n        console.log('üîç ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ UID');\n      }\n      console.log('=== –ö–û–ù–ï–¶ –û–¢–õ–ê–î–ö–ò –£–ü–ê–ö–û–í–ö–ò ===');\n\n      // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞—Ç—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞\n      const tomorrow = new Date();\n      tomorrow.setDate(tomorrow.getDate() + 1);\n      const produceDate = tomorrow.toISOString().split('T')[0];\n\n      // –û—Ç–ª–∞–¥–∫–∞ –ø–µ—Ä–µ–¥ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–∞\n      console.log('=== –û–¢–õ–ê–î–ö–ê –§–û–†–ú–ò–†–û–í–ê–ù–ò–Ø –ó–ê–ü–†–û–°–ê ===');\n      console.log('üîç form.needPackaging =', form.needPackaging, '(—Ç–∏–ø:', typeof form.needPackaging, ')');\n      console.log('üîç packageUid =', packageUid, '(—Ç–∏–ø:', typeof packageUid, ')');\n      console.log('üîç packageUid truthy =', !!packageUid);\n      console.log('üîç –£—Å–ª–æ–≤–∏–µ (form.needPackaging && packageUid) =', form.needPackaging && packageUid);\n      \n      if (form.needPackaging && packageUid) {\n        console.log('‚úÖ PACKAGES –ë–£–î–ï–¢ –î–û–ë–ê–í–õ–ï–ù –í –ó–ê–ü–†–û–°!');\n      } else {\n        console.log('‚ùå PACKAGES –ù–ï –ë–£–î–ï–¢ –î–û–ë–ê–í–õ–ï–ù:');\n        if (!form.needPackaging) console.log('  - form.needPackaging = false');\n        if (!packageUid) console.log('  - packageUid –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç/null');\n      }\n\n      // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n      const requestData = {\n        appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n        sessionID: sessionID,\n        delivery: {\n          deliveryType: {\n            type: 'auto'  // –í—Å–µ–≥–¥–∞ \"auto\" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n          },\n          derival: {\n            produceDate: produceDate,  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –¥–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n            variant: form.fromAddressDelivery ? 'address' : 'terminal',\n            ...(form.fromAddressDelivery ? {\n              address: {\n                search: normalizedFromAddress || form.fromAddress || form.fromCity\n              }\n            } : {\n              terminalID: fromTerminalId\n            }),\n            time: {\n              worktimeStart: '10:00',\n              worktimeEnd: '18:00',\n              breakStart: '13:00',\n              breakEnd: '14:00',\n              exactTime: false\n            }\n            // handling –≤ derival –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n          },\n          arrival: {\n            variant: form.toAddressDelivery ? 'address' : 'terminal',\n            ...(form.toAddressDelivery ? {\n              address: {\n                search: normalizedToAddress || form.toAddress || form.toCity\n              }\n            } : {\n              terminalID: toTerminalId\n            }),\n            time: {\n              worktimeStart: '10:00',\n              worktimeEnd: '18:00',\n              breakStart: '13:00',\n              breakEnd: '14:00',\n              exactTime: false\n            },\n            // handling –≤ arrival –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—ä–µ–º\n            ...(form.needCarry ? {\n              handling: {\n                freightLift: form.hasFreightLift, // true —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –≥–∞–ª–æ—á–∫–∞ \"–Ω–∞–ª–∏—á–∏–µ –≥—Ä—É–∑–æ–≤–æ–≥–æ –ª–∏—Ñ—Ç–∞\"\n                toFloor: form.floor, // —ç—Ç–∞–∂ –∏–∑ —Ñ–æ—Ä–º—ã\n                carry: 0\n              }\n            } : {})\n          },\n          ...(form.needPackaging && packageUid ? {\n            packages: [{\n              uid: packageUid,  // UID —É–ø–∞–∫–æ–≤–∫–∏ crate_with_bubble –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞\n              count: 1  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1\n            }]\n          } : {})\n        },\n        cargo: {\n          quantity: form.cargos.length,\n          length: maxLength,\n          width: maxWidth,\n          height: maxHeight,\n          weight: totalWeight,\n          totalVolume: totalVolume,\n          totalWeight: totalWeight,\n          oversizedWeight: 0,\n          oversizedVolume: 0,\n          hazardClass: 0,  // –í—Å–µ–≥–¥–∞ 0 –µ—Å–ª–∏ –Ω–µ—Ç –æ–ø–∞—Å–Ω—ã—Ö –≥—Ä—É–∑–æ–≤\n          freightName: '–ú–µ–±–µ–ª—å',  // –ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ, –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–µ–µ —Å freightUID)\n          insurance: {\n            statedValue: form.declaredValue || 0,\n            term: true  // –í—Å–µ–≥–¥–∞ true –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n          }\n        },\n        payment: {\n          type: 'noncash',  // –í—Å–µ–≥–¥–∞ \"noncash\"\n          paymentCitySearch: {\n            search: form.fromCity  // –ì–æ—Ä–æ–¥ –æ–ø–ª–∞—Ç—ã\n          }\n        }\n      };\n\n      console.log('üöÄ –ò–¢–û–ì–û–í–´–ô –ó–ê–ü–†–û–° –ö –î–õ:', JSON.stringify(requestData, null, 2));\n      \n      // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∞ packages\n      if (requestData.delivery.packages) {\n        console.log('‚úÖ PACKAGES –ù–ê–ô–î–ï–ù –í –ó–ê–ü–†–û–°–ï:', requestData.delivery.packages);\n      } else {\n        console.log('‚ùå PACKAGES –ù–ï –ù–ê–ô–î–ï–ù –í –ó–ê–ü–†–û–°–ï');\n        console.log('   form.needPackaging =', form.needPackaging);\n        console.log('   packageUid =', packageUid);\n        console.log('   –£—Å–ª–æ–≤–∏–µ:', form.needPackaging && packageUid);\n      }\n\n      // –ü–æ–ø—ã—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö\n      let response: any = null;\n      let data: any = null;\n      \n      for (let attempt = 1; attempt <= maxRetries; attempt++) {\n        console.log(`üîÑ –î–õ: –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ ${attempt}/${maxRetries}`);\n        \n        const result = await enhancedApiRequest(\n          apiUrl,\n          {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n              'Accept': 'application/json'\n            },\n            body: JSON.stringify(requestData)\n          },\n          { operation: 'calculate', company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏' }\n        );\n\n        if (result && typeof result === 'object' && 'success' in result && !result.success) {\n          console.error('‚ùå –î–õ API –æ—à–∏–±–∫–∞:', result.error);\n          // For Dellin, we still want to handle retries manually for session renewal\n          // So we'll create a mock response that indicates failure\n          response = {\n            ok: false,\n            status: 500,\n            json: async () => ({ error: result.error.message })\n          } as any;\n          data = { error: result.error.message };\n        } else {\n          response = result as Response;\n          try {\n            data = await response.json();\n          } catch (parseError) {\n            console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –æ—Ç–≤–µ—Ç–∞ –î–õ:', parseError);\n            throw new Error(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ API: ${parseError instanceof Error ? parseError.message : '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);\n          }\n        }\n        \n        console.log('üöÄ –û–¢–í–ï–¢ –î–õ response.ok:', response.ok);\n        console.log('üöÄ –û–¢–í–ï–¢ –î–õ status:', response.status);\n        console.log('üöÄ –û–¢–í–ï–¢ –î–õ data:', data);\n        \n        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\n        const isAuthError = response.status === 401 || \n                           response.status === 403 ||\n                           (response.status === 400 && data?.errors?.some((err: any) => \n                             err.detail?.toLowerCase()?.includes('session') ||\n                             err.detail?.toLowerCase()?.includes('auth') ||\n                             err.detail?.toLowerCase()?.includes('invalid')\n                           ));\n\n        if (isAuthError && attempt < maxRetries) {\n          console.log('üîÑ –î–õ: –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –≤—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...');\n          const newSessionId = await getDellinSessionId();\n          if (newSessionId) {\n            console.log('‚úÖ –î–õ: –ø–æ–ª—É—á–µ–Ω –Ω–æ–≤—ã–π SessionID, –æ–±–Ω–æ–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å...');\n            // –û–±–Ω–æ–≤–ª—è–µ–º sessionID –≤ –∑–∞–ø—Ä–æ—Å–µ\n            requestData.sessionID = newSessionId;\n            sessionID = newSessionId;\n            continue; // –ü—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —Å –Ω–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n          } else {\n            console.error('‚ùå –î–õ: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π SessionID');\n            break;\n          }\n        }\n        \n        if (response.status === 400 && data?.errors) {\n          console.log('=== –ê–ù–ê–õ–ò–ó –û–®–ò–ë–ö–ò 400 ===');\n          console.log('üîç –û—à–∏–±–∫–∏:', data.errors);\n          data.errors.forEach((error: any, index: number) => {\n            console.log(`üîç –û—à–∏–±–∫–∞ ${index + 1}:`, error);\n            console.log(`   - –ü–æ–ª–µ: ${error.field || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`);\n            console.log(`   - –°–æ–æ–±—â–µ–Ω–∏–µ: ${error.detail || error.message || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`);\n          });\n          console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –û–®–ò–ë–ö–ò 400 ===');\n        }\n\n        // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–Ω—ã–π –∏–ª–∏ –Ω–µ —Å–≤—è–∑–∞–Ω —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É\n        break;\n      }\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –æ—à–∏–±–∫–∏ –ü–ï–†–ï–î –∞–Ω–∞–ª–∏–∑–æ–º –¥–∞–Ω–Ω—ã—Ö\n      if (!response.ok || !data.data) {\n        console.log('‚ùå –û—à–∏–±–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç API - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö');\n        const errorMessage = data.metadata?.detail || \n                           data.metadata?.message || \n                           data.errors?.[0]?.detail || \n                           (data.metadata?.status !== 200 ? `HTTP ${data.metadata?.status}` : '') ||\n                           `HTTP ${response.status} - ${response.statusText}` ||\n                           '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏';\n        return {\n          company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n          price: 0,\n          days: 0,\n          error: errorMessage,\n          requestData,\n          responseData: data,\n          apiUrl,\n          sessionId: sessionID\n        };\n      }\n      \n      // –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –°–¢–†–ê–•–û–í–ö–ò (—Ç–æ–ª—å–∫–æ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞)\n      console.log('=== –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –°–¢–†–ê–•–û–í–ö–ò ===');\n      console.log('üîç –ü–†–û–í–ï–†–ö–ê –°–¢–†–£–ö–¢–£–†–´ –î–ê–ù–ù–´–•:');\n      console.log('üîç data:', data ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n      console.log('üîç typeof data:', typeof data);\n      console.log('üîç data.data:', data?.data ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n      console.log('üîç typeof data.data:', typeof data?.data);\n      \n      // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–π—Å—Ç–≤ data.data\n      if (data?.data) {\n        console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤–æ–π—Å—Ç–≤–∞ data.data:');\n        console.log('üîç data.data.derival:', typeof data.data.derival, data.data.derival);\n        console.log('üîç data.data.arrival:', typeof data.data.arrival, data.data.arrival);\n        console.log('üîç data.data.intercity:', typeof data.data.intercity, data.data.intercity);\n      }\n      \n      if (!data) {\n        console.error('‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: data undefined/null');\n        return {\n          company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n          price: 0,\n          days: 0,\n          error: '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ API: –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã',\n          apiUrl,\n          requestData,\n          responseData: null\n        };\n      }\n      \n      try {\n        console.log('üîç –ü–û–õ–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê data.data:', JSON.stringify(data.data, null, 2));\n      } catch (jsonError) {\n        console.error('‚ùå –û—à–∏–±–∫–∞ JSON.stringify –¥–ª—è data.data:', jsonError);\n        console.log('üîç data.data (toString):', data.data?.toString?.() || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å');\n      }\n      \n      // –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç—Ä–∞—Ö–æ–≤–∫–æ–π\n      console.log('üí≥ –ü–û–ò–°–ö –ö–û–ú–ü–û–ù–ï–ù–¢–û–í –°–¢–†–ê–•–û–í–ö–ò:');\n      console.log('üí≥ data.data.insurance:', data.data?.insurance);\n      console.log('üí≥ data.data.cargoInsurance:', data.data?.cargoInsurance);\n      console.log('üí≥ data.data.termInsurance:', data.data?.termInsurance);\n      console.log('üí≥ data.data.insuranceDetails:', data.data?.insuranceDetails);\n      console.log('üí≥ data.data.services:', data.data?.services);\n      console.log('üí≥ data.data.additionalServices:', data.data?.additionalServices);\n      \n      // –ü–æ–∏—Å–∫ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏ –≤ –¥—Ä—É–≥–∏—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö\n      try {\n        console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º derival...');\n        if (data.data?.derival) {\n          console.log('üí≥ derival –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n          console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –ó–ê–ë–û–ï data.data.derival.insurance:', data.data.derival?.insurance);\n        } else {\n          console.log('üí≥ derival –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n        }\n        \n        console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º arrival...');\n        if (data.data?.arrival) {\n          console.log('üí≥ arrival –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n          console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –î–û–°–¢–ê–í–ö–ï data.data.arrival.insurance:', data.data.arrival?.insurance);\n        } else {\n          console.log('üí≥ arrival –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n        }\n        \n        console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º intercity...');\n        if (data.data?.intercity) {\n          console.log('üí≥ intercity –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n          console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –ü–ï–†–ï–í–û–ó–ö–ï data.data.intercity.insurance:', data.data.intercity?.insurance);\n        } else {\n          console.log('üí≥ intercity –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n        }\n      } catch (error) {\n        console.error('‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–µ–∫—Ü–∏–π —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏:', error);\n        console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', error instanceof Error ? error.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n      }\n      \n      // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö \"insurance\"\n      const findInsuranceFields = (obj: any, path = '') => {\n        if (typeof obj !== 'object' || obj === null || obj === undefined) return;\n        \n        try {\n          Object.keys(obj).forEach(key => {\n            const fullPath = path ? `${path}.${key}` : key;\n            if (key.toLowerCase().includes('insurance') || key.toLowerCase().includes('insur')) {\n              console.log(`üí≥ –ù–ê–ô–î–ï–ù–û –ü–û–õ–ï –°–¢–†–ê–•–û–í–ö–ò [${fullPath}]:`, obj[key]);\n            }\n            if (typeof obj[key] === 'object' && obj[key] !== null && obj[key] !== undefined) {\n              findInsuranceFields(obj[key], fullPath);\n            }\n          });\n        } catch (error) {\n          console.error(`üí≥ –û—à–∏–±–∫–∞ –≤ findInsuranceFields –¥–ª—è –ø—É—Ç–∏ ${path}:`, error);\n        }\n      };\n      \n      console.log('üí≥ –†–ï–ö–£–†–°–ò–í–ù–´–ô –ü–û–ò–°–ö –ü–û–õ–ï–ô –°–¢–†–ê–•–û–í–ö–ò:');\n      try {\n        if (data && data.data) {\n          findInsuranceFields(data.data, 'data.data');\n        } else {\n          console.log('üí≥ –ü—Ä–æ–ø—É—Å–∫ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞: data.data –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');\n        }\n      } catch (error) {\n        console.error('‚ùå –û–®–ò–ë–ö–ê –≤ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–º –ø–æ–∏—Å–∫–µ:', error);\n        console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', error instanceof Error ? error.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n      }\n      console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –°–¢–†–ê–•–û–í–ö–ò ===');\n      \n      // –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ packages –≤ –æ—Ç–≤–µ—Ç–µ\n      console.log('=== –ü–û–ò–°–ö PACKAGES –í –û–¢–í–ï–¢–ï ===');\n      console.log('üì¶ data.data =', data.data);\n      console.log('üì¶ data.data.packages =', data.data?.packages);\n      console.log('üì¶ –¢–∏–ø data.data.packages:', typeof data.data?.packages);\n      if (data.data?.packages) {\n        console.log('‚úÖ PACKAGES –ù–ê–ô–î–ï–ù –í –û–¢–í–ï–¢–ï!');\n        try {\n          console.log('üì¶ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ packages:', JSON.stringify(data.data.packages, null, 2));\n        } catch (jsonError) {\n          console.error('‚ùå –û—à–∏–±–∫–∞ JSON.stringify –¥–ª—è packages:', jsonError);\n          console.log('üì¶ packages (toString):', data.data.packages?.toString?.() || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å');\n        }\n      } else {\n        console.log('‚ùå PACKAGES –ù–ï –ù–ê–ô–î–ï–ù –í –û–¢–í–ï–¢–ï');\n      }\n      console.log('=== –ö–û–ù–ï–¶ –ü–û–ò–°–ö–ê PACKAGES ===');\n\n      if (response.ok && data.data && data.metadata?.status === 200) {\n        let totalPrice = data.data.price || 0;\n        console.log('üí∞ –†–ê–°–ß–ï–¢ –ò–¢–û–ì–û–í–û–ô –°–¢–û–ò–ú–û–°–¢–ò:');\n        console.log('üí∞ –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å data.data.price (–£–ñ–ï –í–ö–õ–Æ–ß–ê–ï–¢ –í–°–ï):', totalPrice);\n        \n        // –°–¢–†–ê–•–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n        if (data.data.insurance) {\n          console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ data.data.insurance (–£–ñ–ï –≤–∫–ª—é—á–µ–Ω–∞ –≤ –±–∞–∑–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):', data.data.insurance);\n          console.log('üí∞ –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞—Ö–æ–≤–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ');\n        } else {\n          console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–≤–µ—Ç–µ');\n        }\n        \n        // –£–ü–ê–ö–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n        console.log('üí∞ –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–ë –£–ü–ê–ö–û–í–ö–ï (–£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –í –û–°–ù–û–í–ù–£–Æ –°–¢–û–ò–ú–û–°–¢–¨):');\n        console.log('üí∞ data.data.packages =', data.data.packages);\n        console.log('üí∞ form.needPackaging =', form.needPackaging);\n        \n        if (data.data.packages && form.needPackaging) {\n          console.log('üí∞ ‚úÖ –£–ü–ê–ö–û–í–ö–ê –ü–†–ò–°–£–¢–°–¢–í–£–ï–¢ –í –û–¢–í–ï–¢–ï (—Ü–µ–Ω–∞ —É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ data.data.price)');\n          console.log('üí∞ –¢–∏–ø packages:', Array.isArray(data.data.packages) ? 'Array' : 'Object');\n          \n          if (Array.isArray(data.data.packages)) {\n            data.data.packages.forEach((pkg: any, index: number) => {\n              console.log(`üí∞ Package [${index}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n            });\n          } else {\n            Object.entries(data.data.packages).forEach(([key, pkg]: [string, any]) => {\n              console.log(`üí∞ Package [${key}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n            });\n          }\n        } else {\n          console.log('üí∞ ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∞—Å—å');\n        }\n\n        // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–∞–∫ —Ä–∞–∑–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –¥–∞—Ç–∞–º–∏ pickup –∏ arrivalToOspReceiver\n        let deliveryDays = 0;\n        try {\n          console.log('=== –ü–û–ò–°–ö –î–ê–¢ –í –û–¢–í–ï–¢–ï ===');\n          \n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–µ—Å—Ç–∞ –≥–¥–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–∞—Ç—ã\n          console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.pickup:', data.data?.pickup);\n          console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.pickup:', data.pickup);\n          console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.pickup:', data?.pickup);\n          console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.arrivalToOspReceiver:', data.data?.arrivalToOspReceiver);\n          console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.arrivalToOspReceiver:', data.arrivalToOspReceiver);\n          console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.arrivalToOspReceiver:', data?.arrivalToOspReceiver);\n          \n          // –ë–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–π –ø–æ–∏—Å–∫ –≤–æ –≤—Å–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ data\n          const findDateInObject = (obj: any, fieldName: string): string | null => {\n            if (!obj || typeof obj !== 'object') return null;\n            \n            for (const [key, value] of Object.entries(obj)) {\n              if (key === fieldName && typeof value === 'string') {\n                return value;\n              }\n              if (typeof value === 'object' && value !== null) {\n                const found = findDateInObject(value, fieldName);\n                if (found) return found;\n              }\n            }\n            return null;\n          };\n          \n          const pickup = findDateInObject(data, 'pickup');\n          const arrivalToOspReceiver = findDateInObject(data, 'arrivalToOspReceiver');\n          \n          console.log('–ù–ê–ô–î–ï–ù–ù–´–ï –î–ê–¢–´:');\n          console.log('pickup:', pickup);\n          console.log('arrivalToOspReceiver:', arrivalToOspReceiver);\n          \n          if (pickup && arrivalToOspReceiver) {\n            // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—ã (—Ñ–æ—Ä–º–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å \"2025-09-27\" –∏–ª–∏ \"2025-09-27 10:00:00\")\n            const pickupDate = new Date(pickup);\n            const arrivalDate = new Date(arrivalToOspReceiver);\n            \n            console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ pickup:', pickupDate);\n            console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ arrival:', arrivalDate);\n            \n            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã\n            if (!isNaN(pickupDate.getTime()) && !isNaN(arrivalDate.getTime())) {\n              // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–æ—Å—Ç—å –≤ –¥–Ω—è—Ö\n              const timeDiff = arrivalDate.getTime() - pickupDate.getTime();\n              deliveryDays = Math.max(1, Math.ceil(timeDiff / (1000 * 3600 * 24))); // –ú–∏–Ω–∏–º—É–º 1 –¥–µ–Ω—å\n              \n              console.log('–†–∞–∑–Ω–æ—Å—Ç—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö:', timeDiff);\n              console.log('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –í–´–ß–ò–°–õ–ï–ù —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:', deliveryDays, '–¥–Ω–µ–π');\n            } else {\n              console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞—Ç—ã –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞');\n              console.error('pickup Date object:', pickupDate);\n              console.error('arrival Date object:', arrivalDate);\n            }\n          } else {\n            console.warn('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ –Ω–∞–π–¥–µ–Ω—ã –¥–∞—Ç—ã pickup –∏–ª–∏ arrivalToOspReceiver');\n            console.log('pickup –Ω–∞–π–¥–µ–Ω:', !!pickup, pickup);\n            console.log('arrivalToOspReceiver –Ω–∞–π–¥–µ–Ω:', !!arrivalToOspReceiver, arrivalToOspReceiver);\n          }\n        } catch (error) {\n          console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –û—à–∏–±–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:', error);\n        }\n\n        console.log('üí∞ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ò–¢–û–ì–û–í–ê–Ø –°–¢–û–ò–ú–û–°–¢–¨:', Math.round(totalPrice));\n        \n        return {\n          company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n          price: Math.round(totalPrice),\n          days: deliveryDays || 0,\n          details: data.data || {},\n          requestData,\n          responseData: data,\n          apiUrl,\n          sessionId: sessionID\n        };\n      } else {\n        const errorMessage = data.metadata?.detail || \n                           data.metadata?.message || \n                           data.errors?.[0]?.detail || \n                           (data.metadata?.status !== 200 ? `HTTP ${data.metadata?.status}` : '') ||\n                           '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏';\n        return {\n          company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n          price: 0,\n          days: 0,\n          error: errorMessage,\n          requestData,\n          responseData: data,\n          apiUrl,\n          sessionId: sessionID\n        };\n      }\n    } catch (error: any) {\n      return {\n        company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n        price: 0,\n        days: 0,\n        error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n        requestData: null,\n        responseData: null,\n        apiUrl\n      };\n    }\n  };\n\n\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–Ω–æ–π –∑–æ–Ω—ã –∏ —Å–∫–ª–∞–¥–∞ –ü–≠–ö –ø–æ –∞–¥—Ä–µ—Å—É —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏\n  const getPekZoneByAddress = async (address: string) => {\n    try {\n      console.log(`üîç –ü–≠–ö: –ø–æ–∏—Å–∫ –∑–æ–Ω—ã –¥–ª—è –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n\n      const result = await enhancedApiRequest(\n        '/api/pek',\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            method: 'findzonebyaddress',\n            address: address\n          })\n        },\n        { operation: 'findzonebyaddress', company: '–ü–≠–ö' }\n      );\n\n      if (result && typeof result === 'object' && 'success' in result && !result.success) {\n        console.error(`‚ùå –ü–≠–ö API –æ—à–∏–±–∫–∞:`, result.error);\n        console.log(`üîÑ –ü–≠–ö: –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥—É –¥–ª—è \"${address}\"`);\n        return getPekZoneFallback(address);\n      }\n\n      const response = result as Response;\n      console.log(`üì° –ü–≠–ö API —Å—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`);\n\n      if (!response.ok) {\n        let errorData;\n        try {\n          errorData = await response.json();\n        } catch {\n          errorData = { error: '–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç' };\n        }\n\n        console.error(`‚ùå –ü–≠–ö API –æ—à–∏–±–∫–∞ ${response.status}:`, errorData);\n\n        // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫\n        if (response.status === 401) {\n          console.error('‚ùå –ü–≠–ö: –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω');\n        } else if (response.status === 404) {\n          console.error('‚ùå –ü–≠–ö: –ú–µ—Ç–æ–¥ API –Ω–µ –Ω–∞–π–¥–µ–Ω');\n        } else if (response.status === 400) {\n          console.error('‚ùå –ü–≠–ö: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞');\n        } else if (response.status >= 500) {\n          console.error('‚ùå –ü–≠–ö: –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ü–≠–ö');\n        }\n\n        console.log(`üîÑ –ü–≠–ö: –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥—É –¥–ª—è \"${address}\"`);\n        return getPekZoneFallback(address);\n      }\n\n      const data = await response.json();\n      console.log(`‚úÖ –ü–≠–ö –∑–æ–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞:`, data);\n\n      if (data.zoneId && data.mainWarehouseId) {\n        return {\n          zoneId: data.zoneId,\n          zoneName: data.zoneName,\n          branchUID: data.branchUID,\n          branchCode: data.branchCode,\n          branchTitle: data.branchTitle,\n          mainWarehouseId: data.mainWarehouseId,\n          warehousePoint: data.warehousePoint,\n          geoData: data.GeoData,\n          precision: data.GeoData?.precision\n        };\n      }\n\n      console.warn(`‚ö†Ô∏è –ü–≠–ö: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç:`, data);\n      return getPekZoneFallback(address);\n\n    } catch (error) {\n      console.error('‚ùå –ü–≠–ö: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∑–æ–Ω—ã:', error);\n      return getPekZoneFallback(address);\n    }\n  };\n\n  // –§–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–æ–Ω—ã –ü–≠–ö\n  const getPekZoneFallback = (address: string) => {\n    console.log(`üîÑ –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –∞–Ω–∞–ª–∏–∑ –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n    \n    const addressLower = address.toLowerCase();\n    \n    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –∏ –∏—Ö –¥–∞–Ω–Ω—ã–µ\n    const cityMappings: { [key: string]: any } = {\n      '–º–æ—Å–∫–≤–∞': {\n        zoneId: 'moscow-zone-001',\n        zoneName: '–ú–æ—Å–∫–≤–∞',\n        branchUID: 'moscow-branch-001',\n        branchCode: '–ú–°–ö',\n        branchTitle: '–ú–æ—Å–∫–≤–∞',\n        mainWarehouseId: 'dc6c746d-812d-11e4-bbfc-001999d8b3c5',\n        warehousePoint: {\n          latitude: 55.755826,\n          longitude: 37.6173\n        }\n      },\n      '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': {\n        zoneId: 'spb-zone-001',\n        zoneName: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n        branchUID: 'spb-branch-001',\n        branchCode: '–°–ü–ë',\n        branchTitle: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n        mainWarehouseId: 'b436c978-086d-11e6-b6ca-00155d668909',\n        warehousePoint: {\n          latitude: 59.9311,\n          longitude: 30.3609\n        }\n      },\n      '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': {\n        zoneId: 'ekb-zone-001',\n        zoneName: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',\n        branchUID: 'ekb-branch-001',\n        branchCode: '–ï–ö–ë',\n        branchTitle: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',\n        mainWarehouseId: 'f8d9c8e3-8e2d-11e4-bbfc-001999d8b3c5',\n        warehousePoint: {\n          latitude: 56.8431,\n          longitude: 60.6454\n        }\n      }\n    };\n    \n    for (const [city, data] of Object.entries(cityMappings)) {\n      if (addressLower.includes(city) || addressLower.includes(city.replace('-', ' '))) {\n        console.log(`‚úÖ –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –Ω–∞–π–¥–µ–Ω –≥–æ—Ä–æ–¥ ${city}`);\n        return {\n          ...data,\n          geoData: {\n            precision: 'fallback',\n            kind: 'locality'\n          },\n          precision: 'fallback'\n        };\n      }\n    }\n    \n    console.warn(`‚ùå –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –≥–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ \"${address}\"`);\n    return null;\n  };\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –ü–≠–ö\n  const getPekNearestDepartments = async (address: string, coordinates?: { latitude: string, longitude: string }) => {\n    try {\n      console.log(`üè¢ –ü–≠–ö: –ø–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –¥–ª—è \"${address}\"`);\n\n      const requestBody: any = {\n        departmentOperation: 3, // –≤—ã–¥–∞—á–∞ –≥—Ä—É–∑–æ–≤\n        type: 3, // –∞–≤—Ç–æ-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç\n        searchRadius: 50, // –∫–º\n        limit: 5\n      };\n\n      // –ü–≠–ö API —Ç—Ä–µ–±—É–µ—Ç –∏ –∞–¥—Ä–µ—Å, –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ\n      requestBody.address = address;\n\n      if (coordinates) {\n        requestBody.coordinates = coordinates;\n        console.log(`üìç –ü–≠–ö: –ø–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\" –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º`, coordinates);\n      } else {\n        console.log(`üìç –ü–≠–ö: –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\"`);\n      }\n\n      const result = await enhancedApiRequest(\n        '/api/pek',\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            method: 'nearestdepartments',\n            ...requestBody\n          })\n        },\n        { operation: 'nearestdepartments', company: '–ü–≠–ö' }\n      );\n\n      if (result && typeof result === 'object' && 'success' in result && !result.success) {\n        console.error(`‚ùå –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API –æ—à–∏–±–∫–∞:`, result.error);\n        return null;\n      }\n\n      const response = result as Response;\n      console.log(`üì° –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API —Å—Ç–∞—Ç—É—Å: ${response.status}`);\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error(`‚ùå –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API –æ—à–∏–±–∫–∞: ${response.status} ${response.statusText}`);\n        console.error(`‚ùå –û—Ç–≤–µ—Ç:`, errorText.substring(0, 500));\n        return null;\n      }\n\n      const data = await response.json();\n      console.log(`‚úÖ –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–∞–π–¥–µ–Ω—ã:`, data);\n\n      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤–æ–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ —Å –Ω–∞–∏–≤—ã—Å—à–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º\n      if (data.freeDepartments && data.freeDepartments.length > 0) {\n        const bestDepartment = data.freeDepartments.sort((a: any, b: any) => b.priority - a.priority)[0];\n        console.log(`‚úÖ –ü–≠–ö: –≤—ã–±—Ä–∞–Ω–æ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ`, bestDepartment.divisionName);\n        return {\n          warehouseId: bestDepartment.warehouseId,\n          branchId: bestDepartment.branchId,\n          branchName: bestDepartment.branchName,\n          divisionName: bestDepartment.divisionName,\n          address: bestDepartment.address,\n          coordinates: bestDepartment.coordinates,\n          phone: bestDepartment.phone,\n          email: bestDepartment.email\n        };\n      }\n\n      console.warn(`‚ùå –ü–≠–ö: –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è \"${address}\"`);\n      return null;\n    } catch (error) {\n      console.error('‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –æ—Ç–¥–µ–ª–µ–Ω–∏–π:', error);\n      return null;\n    }\n  };\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ü–≠–ö)\n  const getYandexCoordinates = async (address: string): Promise<{ latitude: string, longitude: string } | null> => {\n    try {\n      const encodedAddress = encodeURIComponent(address);\n      const response = await fetch(`https://geocode-maps.yandex.ru/1.x/?apikey=YOUR_API_KEY&geocode=${encodedAddress}&format=json`);\n      \n      if (!response.ok) return null;\n      \n      const data = await response.json();\n      const coords = data?.response?.GeoObjectCollection?.featureMember?.[0]?.GeoObject?.Point?.pos?.split(' ');\n      \n      if (coords && coords.length === 2) {\n        return {\n          longitude: coords[0],\n          latitude: coords[1]\n        };\n      }\n      \n      return null;\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ø–Ω–¥–µ–∫—Å:', error);\n      return null;\n    }\n  };\n\n  // –†–∞—Å—á–µ—Ç –¥–ª—è –ü–≠–ö —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API v1/calculateprice/\n  const calculatePEK = async (): Promise<CalculationResult> => {\n    const apiUrl = 'https://kabinet.pecom.ru/api/v1/calculateprice/';\n    \n    // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç\n    const validateCoordinates = (coords: any) => {\n      console.log('üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:', coords);\n      \n      if (!coords) {\n        console.log('‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç');\n        return null;\n      }\n      \n      if (typeof coords.latitude !== 'number' || typeof coords.longitude !== 'number') {\n        console.warn(`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ —è–≤–ª—è—é—Ç—Å—è —á–∏—Å–ª–∞–º–∏:`, { \n          lat: coords.latitude, \n          lng: coords.longitude,\n          latType: typeof coords.latitude,\n          lngType: typeof coords.longitude\n        });\n        return null;\n      }\n      \n      const lat = Number(coords.latitude);\n      const lng = Number(coords.longitude);\n      \n      console.log(`üìç –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: lat=${lat}, lng=${lng}`);\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω—ã\n      if (lat < -90 || lat > 90 || lng < -180 || lng > 180 || isNaN(lat) || isNaN(lng)) {\n        console.warn(`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–Ω–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞:`, { \n          lat, lng, \n          latValid: lat >= -90 && lat <= 90,\n          lngValid: lng >= -180 && lng <= 180,\n          latIsNaN: isNaN(lat),\n          lngIsNaN: isNaN(lng)\n        });\n        return null;\n      }\n      \n      console.log('‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã:', { latitude: lat, longitude: lng });\n      return { latitude: lat, longitude: lng };\n    };\n    \n    try {\n      // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–æ–Ω–∞—Ö –∏ —Å–∫–ª–∞–¥–∞—Ö –ø–æ –∞–¥—Ä–µ—Å–∞–º\n      console.log(`üöÄ –ü–≠–ö: –Ω–∞—á–∏–Ω–∞–µ–º —Ä–∞—Å—á–µ—Ç`);\n      console.log(`üìç –û—Ç: ${form.fromAddress || form.fromCity}`);\n      console.log(`üìç –î–æ: ${form.toAddress || form.toCity}`);\n      \n      const senderZone = await getPekZoneByAddress(form.fromAddress || `–≥ ${form.fromCity}`);\n      const receiverZone = await getPekZoneByAddress(form.toAddress || `–≥ ${form.toCity}`);\n      \n      console.log(`üîç –ü–≠–ö –∑–æ–Ω—ã:`);\n      console.log(`üìç –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å:`, senderZone ? `${senderZone.branchTitle} (${senderZone.mainWarehouseId})` : '–ù–ï –ù–ê–ô–î–ï–ù–ê');\n      console.log(`üìç –ü–æ–ª—É—á–∞—Ç–µ–ª—å:`, receiverZone ? `${receiverZone.branchTitle} (${receiverZone.mainWarehouseId})` : '–ù–ï –ù–ê–ô–î–ï–ù–ê');\n      \n      if (!senderZone || !receiverZone) {\n        // –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞\n        const debugInfo = {\n          senderAddress: form.fromAddress || form.fromCity,\n          receiverAddress: form.toAddress || form.toCity,\n          senderZoneFound: !!senderZone,\n          receiverZoneFound: !!receiverZone,\n          apiTested: true\n        };\n        \n        console.error(`‚ùå –ü–≠–ö: –∑–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã`, debugInfo);\n        \n        return {\n          company: '–ü–≠–ö',\n          price: 0,\n          days: 0,\n          error: `–ó–æ–Ω–∞ –ü–≠–ö –Ω–µ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥—Ä–µ—Å–∞: ${!senderZone ? (form.fromAddress || form.fromCity) : ''} ${!receiverZone ? (form.toAddress || form.toCity) : ''}`.trim(),\n          apiUrl,\n          requestData: debugInfo,\n          responseData: { senderZone, receiverZone }\n        };\n      }\n\n      // –ü–æ–ª—É—á–∞–µ–º –±–ª–∏–∂–∞–π—à–∏–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –∞–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞\n      let senderWarehouseId = senderZone.mainWarehouseId;\n      let receiverWarehouseId = receiverZone.mainWarehouseId;\n      \n      if (form.fromAddressDelivery && senderZone.warehousePoint) {\n        const validSenderCoords = validateCoordinates(senderZone.warehousePoint);\n        if (validSenderCoords) {\n          try {\n            const senderDepartment = await getPekNearestDepartments(\n              form.fromAddress || form.fromCity,\n              {\n                latitude: validSenderCoords.latitude.toString(),\n                longitude: validSenderCoords.longitude.toString()\n              }\n            );\n            if (senderDepartment) {\n              senderWarehouseId = senderDepartment.warehouseId;\n              console.log('‚úÖ –ù–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π —Å–∫–ª–∞–¥ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è:', senderDepartment.warehouseId);\n            }\n          } catch (error) {\n            console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥:', error);\n          }\n        } else {\n          console.warn('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥');\n        }\n      }\n      \n      if (form.toAddressDelivery && receiverZone.warehousePoint) {\n        const validReceiverCoords = validateCoordinates(receiverZone.warehousePoint);\n        if (validReceiverCoords) {\n          try {\n            const receiverDepartment = await getPekNearestDepartments(\n              form.toAddress || form.toCity,\n              {\n                latitude: validReceiverCoords.latitude.toString(),\n                longitude: validReceiverCoords.longitude.toString()\n              }\n            );\n            if (receiverDepartment) {\n              receiverWarehouseId = receiverDepartment.warehouseId;\n              console.log('‚úÖ –ù–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π —Å–∫–ª–∞–¥ –ø–æ–ª—É—á–∞—Ç–µ–ª—è:', receiverDepartment.warehouseId);\n            }\n          } catch (error) {\n            console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥:', error);\n          }\n        } else {\n          console.warn('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥');\n        }\n      }\n\n      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞—Ç—ã N –¥–Ω–µ–π –æ—Ç —Å–µ–≥–æ–¥–Ω—è\n      const getDateForCalculation = (daysFromToday: number): string => {\n        const date = new Date();\n        date.setDate(date.getDate() + daysFromToday);\n        return date.toISOString().slice(0, 19); // 2025-09-28T14:00:00\n      };\n\n      // –ù–∞—á–∏–Ω–∞–µ–º —Å –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–≥–æ –¥–Ω—è\n      let currentDayOffset = 1;\n      let plannedDateTime = getDateForCalculation(currentDayOffset);\n\n      // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤ (–±–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç)\n      const cargos = form.cargos.map(cargo => {\n        const cargoData = {\n          length: cargo.length / 100, // –ø–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–µ—Ç—Ä—ã\n          width: cargo.width / 100,\n          height: cargo.height / 100,\n          volume: (cargo.length * cargo.width * cargo.height) / 1000000, // –º3\n          weight: cargo.weight,\n          isHP: form.needPackaging, // –∑–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n          sealingPositionsCount: 0\n        };\n        \n        console.log('üì¶ –ì—Ä—É–∑ –¥–ª—è –ü–≠–ö:', cargoData);\n        return cargoData;\n      });\n\n      // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (–Ω—É–∂–Ω–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ)\n      let finalRequestData: any = null;\n      \n      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ —Ä–∞—Å—á–µ—Ç–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç–æ–π\n      const tryCalculateWithDate = async (plannedDateTime: string): Promise<any> => {\n        // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –∫ API –ü–≠–ö —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n        const requestData: any = {\n          currencyCode: \"643\", // —Ä—É–±–ª–∏\n          types: [3], // —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ –ø–µ—Ä–µ–≤–æ–∑–∫–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –º–∞—Å—Å–∏–≤)\n          senderWarehouseId,\n          receiverWarehouseId,\n          isOpenCarSender: false,\n          isOpenCarReceiver: false,\n          isHyperMarket: false,\n          plannedDateTime,\n          isInsurance: form.needInsurance && form.declaredValue > 0,\n          isInsurancePrice: form.needInsurance ? form.declaredValue : 0,\n          isPickUp: form.fromAddressDelivery,\n          isDelivery: form.toAddressDelivery,\n          needReturnDocuments: false,\n          needArrangeTransportationDocuments: false,\n          senderDistanceType: 0,\n          receiverDistanceType: 0,\n          cargos // –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤\n        };\n        \n        console.log('üìã –ü–≠–ö: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ requestData:', JSON.stringify(requestData, null, 2));\n\n        // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏ –ü–†–† –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\n        if (form.needCarry) {\n          requestData.pickupServices = {\n            isLoading: true,\n            floor: Math.max(0, form.floor - 1), // –ü–≠–ö —Å—á–∏—Ç–∞–µ—Ç —Å 0\n            carryingDistance: 0,\n            isElevator: form.hasFreightLift\n          };\n          requestData.deliveryServices = {\n            isLoading: true,\n            floor: Math.max(0, form.floor - 1),\n            carryingDistance: 0,\n            isElevator: form.hasFreightLift\n          };\n        }\n\n        // –î–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫–∏ pickup/delivery —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ü–≠–ö\n        if (form.fromAddressDelivery) {\n          console.log('üìç –ü–≠–ö: –¥–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ pickup –¥–ª—è –∑–∞–±–æ—Ä–∞');\n          requestData.pickup = {\n            address: form.fromAddress || `–†–æ—Å—Å–∏—è, ${form.fromCity}`\n            // coordinates –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏\n          };\n        }\n        \n        if (form.toAddressDelivery) {\n          console.log('üìç –ü–≠–ö: –¥–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ delivery –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏');\n          requestData.delivery = {\n            address: form.toAddress || `–†–æ—Å—Å–∏—è, ${form.toCity}`\n            // coordinates –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏\n          };\n        }\n\n        // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n        const requiredFields = ['types', 'senderWarehouseId', 'receiverWarehouseId', 'plannedDateTime', 'cargos'];\n        const missingFields = requiredFields.filter(field => !requestData[field]);\n        \n        if (missingFields.length > 0) {\n          throw new Error(`–ü–≠–ö: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: ${missingFields.join(', ')}`);\n        }\n        \n        if (!Array.isArray(requestData.types) || requestData.types.length === 0) {\n          throw new Error('–ü–≠–ö: –ø–æ–ª–µ types –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º');\n        }\n        \n        if (!Array.isArray(requestData.cargos) || requestData.cargos.length === 0) {\n          throw new Error('–ü–≠–ö: –ø–æ–ª–µ cargos –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º');\n        }\n        \n        console.log('‚úÖ –ü–≠–ö: –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –ø—Ä–æ–π–¥–µ–Ω–∞');\n\n        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏\n        finalRequestData = {\n          method: 'calculateprice',\n          ...requestData\n        };\n        \n        console.log('üöÄ –ü–≠–ö API –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å:', JSON.stringify(finalRequestData, null, 2));\n        console.log('üåê –ü–≠–ö API URL:', apiUrl);\n        console.log('üìã –ü–≠–ö: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–ø–æ–≤ —Ç–∞—Ä–∏—Ñ–æ–≤:', requestData.types.length);\n        console.log('üìã –ü–≠–ö: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤:', requestData.cargos.length);\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π\n      if (finalRequestData.pickup?.coordinates) {\n        console.log('üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã pickup:', finalRequestData.pickup.coordinates);\n      }\n      if (finalRequestData.delivery?.coordinates) {\n        console.log('üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã delivery:', finalRequestData.delivery.coordinates);\n      }\n\n       const result = await enhancedApiRequest(\n         '/api/pek',\n         {\n           method: 'POST',\n           headers: {\n             'Content-Type': 'application/json',\n           },\n           body: JSON.stringify(finalRequestData)\n         },\n         { operation: 'calculateprice', company: '–ü–≠–ö' }\n       );\n\n       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n         console.error('‚ùå –ü–≠–ö API —Ä–∞—Å—á–µ—Ç –æ—à–∏–±–∫–∞:', result.error);\n         throw new Error(result.error.userMessage || result.error.message);\n       }\n\n       const response = result as Response;\n       console.log(`üì° –ü–≠–ö API —Ä–∞—Å—á–µ—Ç —Å—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`);\n       console.log(`üì° –ü–≠–ö API URL: ${response.url}`);\n\n       const responseText = await response.text();\n       console.log(`üì° –ü–≠–ö API —Å—ã—Ä–æ–π –æ—Ç–≤–µ—Ç:`, responseText.substring(0, 1000));\n\n       let data;\n       try {\n         data = JSON.parse(responseText);\n         console.log('üöÄ –ü–≠–ö API –æ—Ç–≤–µ—Ç:', JSON.stringify(data, null, 2));\n       } catch (parseError) {\n         console.error('‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', parseError);\n         throw new Error(`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç API: ${responseText.substring(0, 200)}`);\n       }\n\n        return { response, data };\n      };\n\n      // –î–æ–±–∞–≤–ª—è–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞—Å—á–µ—Ç–∞\n      console.log('üîß –ü–≠–ö: –≥–æ—Ç–æ–≤–∏–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞...');\n      console.log('üìç senderWarehouseId:', senderWarehouseId);\n      console.log('üìç receiverWarehouseId:', receiverWarehouseId);\n      console.log('üìÖ –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞:', plannedDateTime);\n      console.log('üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤:', cargos.length);\n      console.log('üîß form.fromAddressDelivery:', form.fromAddressDelivery);\n      console.log('üîß form.toAddressDelivery:', form.toAddressDelivery);\n      \n      // –¶–∏–∫–ª –ø–æ–ø—ã—Ç–æ–∫ —Å —Ä–∞–∑–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏ (–º–∞–∫—Å–∏–º—É–º 7 –¥–Ω–µ–π)\n      const maxRetries = 7;\n      let lastError: Error | null = null;\n      \n      console.log('üöÄ –ü–≠–ö: –∑–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª —Ä–∞—Å—á–µ—Ç–∞...');\n      \n      for (let attempt = 0; attempt < maxRetries; attempt++) {\n        try {\n          console.log(`üìÖ –ü–≠–ö: –ø–æ–ø—ã—Ç–∫–∞ ${attempt + 1}/${maxRetries}, –¥–∞—Ç–∞: ${plannedDateTime}`);\n          \n          const { response, data } = await tryCalculateWithDate(plannedDateTime);\n          \n          if (response.ok && !data.hasError && data.transfers && data.transfers.length > 0) {\n            const transfer = data.transfers[0]; // –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Ç–∞—Ä–∏—Ñ (–∞–≤—Ç–æ)\n            \n            if (!transfer.hasError) {\n          // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —É—Å–ª—É–≥\n          const services: { name: string; description: string; price: number }[] = [];\n          let totalCalculated = 0;\n\n          const processServices = (servicesList: any[], parentName = '') => {\n            servicesList.forEach(service => {\n              const serviceName = parentName ? `${parentName} - ${service.info}` : service.info;\n              const serviceCost = parseFloat(service.cost) || 0;\n              \n              if (serviceCost > 0) {\n                services.push({\n                  name: serviceName,\n                  description: service.serviceType || '',\n                  price: serviceCost\n                });\n                totalCalculated += serviceCost;\n              }\n\n              // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏\n              if (service.services && Array.isArray(service.services)) {\n                processServices(service.services, serviceName);\n              }\n            });\n          };\n\n          if (transfer.services) {\n            processServices(transfer.services);\n          }\n\n          // –ï—Å–ª–∏ –Ω–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —É—Å–ª—É–≥, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n          if (services.length === 0) {\n            services.push({\n              name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n              description: `${senderZone.branchTitle} - ${receiverZone.branchTitle}`,\n              price: Math.round(transfer.costTotal)\n            });\n          }\n\n          return {\n            company: '–ü–≠–ö',\n            price: Math.round(transfer.costTotal),\n            days: transfer.estDeliveryTime || 3,\n            details: {\n              note: `–î–æ—Å—Ç–∞–≤–∫–∞ ${senderZone.branchTitle} - ${receiverZone.branchTitle} (–∞–≤—Ç–æ)`,\n              services,\n              senderZone: {\n                title: senderZone.branchTitle,\n                zone: senderZone.zoneName,\n                warehouseId: senderWarehouseId\n              },\n              receiverZone: {\n                title: receiverZone.branchTitle,\n                zone: receiverZone.zoneName,\n                warehouseId: receiverWarehouseId\n              }\n            },\n            requestData: finalRequestData,\n            responseData: data,\n            apiUrl\n              };\n            } else {\n              // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ–±–ª–µ–º–æ–π —Å –¥–∞—Ç–æ–π\n              const errorMessage = transfer.errorMessage || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞ –ü–≠–ö';\n              if (errorMessage.includes('–∑–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω') || errorMessage.includes('–≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã')) {\n                console.log(`üìÖ –ü–≠–ö: ${errorMessage}. –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...`);\n                lastError = new Error(errorMessage);\n                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é\n                currentDayOffset++;\n                plannedDateTime = getDateForCalculation(currentDayOffset);\n                continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –¥–∞—Ç—É\n              } else {\n                throw new Error(errorMessage);\n              }\n            }\n          } else {\n            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—à–∏–±–∫—É –Ω–∞ —É—Ä–æ–≤–Ω–µ –¥–∞–Ω–Ω—ã—Ö\n            const errorMessage = data.errorMessage || data.message || '–û—à–∏–±–∫–∞ API –ü–≠–ö';\n            if (errorMessage.includes('–∑–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω') || errorMessage.includes('–≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã')) {\n              console.log(`üìÖ –ü–≠–ö: ${errorMessage}. –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...`);\n              lastError = new Error(errorMessage);\n              // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é\n              currentDayOffset++;\n              plannedDateTime = getDateForCalculation(currentDayOffset);\n              continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –¥–∞—Ç—É\n            } else {\n              throw new Error(errorMessage);\n            }\n          }\n        } catch (error: any) {\n          console.error(`‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –Ω–∞ –ø–æ–ø—ã—Ç–∫–µ ${attempt + 1}:`, error.message);\n          \n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ–±–ª–µ–º–æ–π —Å –¥–∞—Ç–æ–π\n          if (error.message?.includes('–∑–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω') || error.message?.includes('–≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã')) {\n            console.log(`üìÖ –ü–≠–ö: –ø—Ä–æ–±–ª–µ–º–∞ —Å –¥–∞—Ç–æ–π. –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...`);\n            lastError = error;\n            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é\n            currentDayOffset++;\n            plannedDateTime = getDateForCalculation(currentDayOffset);\n            continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –¥–∞—Ç—É\n          } else {\n            // –î—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞ - –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ä–∞–∑—É\n            throw error;\n          }\n        }\n      }\n      \n      // –ï—Å–ª–∏ –¥–æ—à–ª–∏ –¥–æ —Å—é–¥–∞ - –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã\n      console.error(`‚ùå –ü–≠–ö: –≤—Å–µ ${maxRetries} –ø–æ–ø—ã—Ç–æ–∫ –∏—Å—á–µ—Ä–ø–∞–Ω—ã. –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞:`, lastError?.message);\n      throw lastError || new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—É—é –¥–∞—Ç—É –¥–ª—è –∑–∞–±–æ—Ä–∞ –≥—Ä—É–∑–∞');\n      \n    } catch (error: any) {\n      console.error('üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ü–≠–ö API:', error);\n      \n      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –æ—à–∏–±–∫–∏\n      let errorDescription = '–û—à–∏–±–∫–∞ API –ü–≠–ö';\n      \n      if (error.message?.includes('Failed to fetch')) {\n        errorDescription = 'API –ü–≠–ö –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';\n      } else if (error.message?.includes('401')) {\n        errorDescription = '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ü–≠–ö';\n      } else if (error.message?.includes('400')) {\n        errorDescription = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞';\n      } else if (error.message?.includes('timeout')) {\n        errorDescription = '–¢–∞–π–º-–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ API';\n      }\n      \n      console.error(`üö® –ü–≠–ö: ${errorDescription}. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ñ–æ–ª–ª–±—ç–∫ —Ä–∞—Å—á–µ—Ç—É`);\n      \n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n      const totalVolume = form.cargos.reduce((sum, cargo) => \n        sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n      );\n      \n      // –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π —Ñ–æ–ª–ª–±—ç–∫ —Ä–∞—Å—á–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Å–∞ –∏ –æ–±—ä–µ–º–∞\n      let basePrice = Math.max(\n        totalWeight * 18, // 18 —Ä—É–± –∑–∞ –∫–≥\n        totalVolume * 4500 // 4500 —Ä—É–± –∑–∞ –º3\n      );\n      \n      // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏\n      const services: { name: string; description: string; price: number }[] = [];\n      \n      services.push({\n        name: '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞',\n        description: `${form.fromCity} - ${form.toCity} (${totalWeight} –∫–≥, ${totalVolume.toFixed(3)} –º¬≥)`,\n        price: Math.round(basePrice)\n      });\n      \n      if (form.fromAddressDelivery) {\n        const pickupCost = 600;\n        basePrice += pickupCost;\n        services.push({\n          name: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n          description: '–û—Ç –∞–¥—Ä–µ—Å–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è',\n          price: pickupCost\n        });\n      }\n      \n      if (form.toAddressDelivery) {\n        const deliveryCost = 600;\n        basePrice += deliveryCost;\n        services.push({\n          name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n          description: '–î–æ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è',\n          price: deliveryCost\n        });\n      }\n      \n      if (form.needInsurance && form.declaredValue > 0) {\n        const insuranceCost = form.declaredValue * 0.012;\n        basePrice += insuranceCost;\n        services.push({\n          name: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ',\n          description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n          price: Math.round(insuranceCost)\n        });\n      }\n      \n      if (form.needPackaging) {\n        const packagingCost = totalWeight * 25;\n        basePrice += packagingCost;\n        services.push({\n          name: '–ó–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞',\n          description: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n          price: Math.round(packagingCost)\n        });\n      }\n      \n      if (form.needCarry) {\n        const carryCost = 500;\n        basePrice += carryCost;\n        services.push({\n          name: '–ü–æ–¥—ä–µ–º –Ω–∞ —ç—Ç–∞–∂',\n          description: `–ù–∞ ${form.floor} —ç—Ç–∞–∂ ${form.hasFreightLift ? '(—Å –ª–∏—Ñ—Ç–æ–º)' : '(–±–µ–∑ –ª–∏—Ñ—Ç–∞)'}`,\n          price: carryCost\n        });\n      }\n      \n      return {\n        company: '–ü–≠–ö',\n        price: Math.round(basePrice),\n        days: 3,\n        details: {\n          note: '–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º –ü–≠–ö (API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)',\n          services,\n          totalWeight,\n          totalVolume,\n          errorInfo: error.message\n        },\n        requestData: null,\n        responseData: null,\n        apiUrl,\n        error: `${errorDescription}. –ü–æ–∫–∞–∑–∞–Ω –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º.`\n      };\n    }\n  };\n\n\n\n  // üîß –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö\n  const calculateOptimalLength = (cargos: typeof form.cargos) => {\n    if (cargos.length === 1) {\n      return cargos[0].length / 100; // –û–¥–Ω–æ –º–µ—Å—Ç–æ - —Ç–æ—á–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã\n    }\n    \n    // –î–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç:\n    const maxLength = Math.max(...cargos.map(c => c.length)) / 100;\n    const totalLength = cargos.reduce((sum, c) => sum + c.length, 0) / 100;\n    \n    // –ï—Å–ª–∏ –º–µ—Å—Ç –º–Ω–æ–≥–æ (>3), –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É–º–º–∞—Ä–Ω—É—é –¥–ª–∏–Ω—É (–º–µ—Å—Ç–∞ –≤ —Ä—è–¥)\n    // –ò–Ω–∞—á–µ - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é (–º–µ—Å—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ)\n    return cargos.length > 3 ? totalLength : maxLength;\n  };\n\n  const calculateOptimalWidth = (cargos: typeof form.cargos) => {\n    // –î–ª—è —à–∏—Ä–∏–Ω—ã –ª–æ–≥–∏—á–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é\n    return Math.max(...cargos.map(c => c.width)) / 100;\n  };\n\n  const calculateOptimalHeight = (cargos: typeof form.cargos) => {\n    if (cargos.length === 1) {\n      return cargos[0].height / 100;\n    }\n    \n    const maxHeight = Math.max(...cargos.map(c => c.height)) / 100;\n    const totalHeight = cargos.reduce((sum, c) => sum + c.height, 0) / 100;\n    \n    // –ï—Å–ª–∏ –º–Ω–æ–≥–æ –º–µ–ª–∫–∏—Ö –º–µ—Å—Ç - –º–æ–∂–µ–º —Å—Ç–∞–∫–∏—Ä–æ–≤–∞—Ç—å\n    const avgHeight = totalHeight / cargos.length;\n    return avgHeight < 0.5 ? totalHeight : maxHeight; // 50—Å–º –ø–æ—Ä–æ–≥ –¥–ª—è —Å—Ç–∞–∫–∏—Ä–æ–≤–∞–Ω–∏—è\n  };\n\n  // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç\n  const validateMultipleCargos = (cargos: typeof form.cargos) => {\n    if (!cargos || cargos.length === 0) {\n      throw new Error('–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≥—Ä—É–∑–æ–≤—ã–µ –º–µ—Å—Ç–∞');\n    }\n    \n    if (cargos.length > 50) {\n      throw new Error(`–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç (${cargos.length}). –ú–∞–∫—Å–∏–º—É–º: 50`);\n    }\n    \n    const totalVolume = cargos.reduce((sum, cargo) => \n      sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n    );\n    \n    if (totalVolume > 100) {\n      console.warn('‚ö†Ô∏è –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π –æ–±—ä–µ–º –≥—Ä—É–∑–∞ (>100 –º¬≥). –í–æ–∑–º–æ–∂–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.');\n    }\n    \n    return true;\n  };\n\n  const calculateRailContinent = async (): Promise<CalculationResult> => {\n    const apiUrl = '/api/rail-continent';\n    \n    try {\n      // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      validateMultipleCargos(form.cargos);\n      \n      // –í—ã—á–∏—Å–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥—Ä—É–∑–∞\n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n      const totalVolume = form.cargos.reduce((sum, cargo) => \n        sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n      );\n      \n      // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–º–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      const optimalLength = calculateOptimalLength(form.cargos);\n      const optimalWidth = calculateOptimalWidth(form.cargos);\n      const optimalHeight = calculateOptimalHeight(form.cargos);\n      \n      // üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      console.log('üöÇ Rail Continent: –ê–Ω–∞–ª–∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç:');\n      console.log(`   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç: ${form.cargos.length}`);\n      console.log(`   - –û–±—â–∏–π –≤–µ—Å: ${totalWeight} –∫–≥`);\n      console.log(`   - –û–±—â–∏–π –æ–±—ä–µ–º: ${totalVolume.toFixed(3)} –º¬≥`);\n      \n      form.cargos.forEach((cargo, index) => {\n        console.log(`   üì¶ –ú–µ—Å—Ç–æ ${index + 1}:`);\n        console.log(`     - –ì–∞–±–∞—Ä–∏—Ç—ã: ${cargo.length}√ó${cargo.width}√ó${cargo.height} —Å–º`);\n        console.log(`     - –í–µ—Å: ${cargo.weight} –∫–≥`);\n        console.log(`     - –û–±—ä–µ–º: ${((cargo.length * cargo.width * cargo.height) / 1000000).toFixed(3)} –º¬≥`);\n      });\n      \n      if (form.cargos.length > 1) {\n        const maxLength = Math.max(...form.cargos.map(c => c.length));\n        const maxWidth = Math.max(...form.cargos.map(c => c.width));\n        const maxHeight = Math.max(...form.cargos.map(c => c.height));\n        console.log(`   üìê –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã: ${maxLength}√ó${maxWidth}√ó${maxHeight} —Å–º`);\n        console.log(`   üîß –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã: ${(optimalLength*100).toFixed(0)}√ó${(optimalWidth*100).toFixed(0)}√ó${(optimalHeight*100).toFixed(0)} —Å–º`);\n      }\n      \n      // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä quantity –∏ —É–ª—É—á—à–µ–Ω–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã\n      const requestData = {\n        city_sender: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n        city_receiver: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n        weight: totalWeight,\n        volume: totalVolume,\n        quantity: form.cargos.length, // üîß –î–û–ë–ê–í–õ–ï–ù–û: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç\n        length: optimalLength,        // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞\n        width: optimalWidth,          // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞  \n        height: optimalHeight,        // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞\n        declared_cost: form.declaredValue,\n        pickup: form.fromAddressDelivery ? '1' : '0',\n        delivery: form.toAddressDelivery ? '1' : '0',\n        packaging: form.needPackaging ? '1' : '0',\n        insurance: form.needInsurance ? '1' : '0',\n        tariff: 'auto' // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞\n      };\n\n      console.log('üöÇ Rail Continent –∑–∞–ø—Ä–æ—Å:', requestData);\n\n       const result = await enhancedApiRequest(\n         apiUrl,\n         {\n           method: 'POST',\n           headers: {\n             'Content-Type': 'application/json',\n           },\n           body: JSON.stringify(requestData)\n         },\n         { operation: 'calculate', company: 'Rail Continent' }\n       );\n\n       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n         console.error('‚ùå Rail Continent API –æ—à–∏–±–∫–∞:', result.error);\n         return {\n           company: 'Rail Continent',\n           price: 0,\n           days: 0,\n           error: result.error.userMessage || result.error.message,\n           requestData,\n           responseData: null,\n           apiUrl\n         };\n       }\n\n       const response = result as Response;\n       const data = await response.json();\n       console.log('üöÇ Rail Continent –æ—Ç–≤–µ—Ç:', data);\n\n      if (response.ok && data.result === 'success' && data.data) {\n        // –í—ã–±–∏—Ä–∞–µ–º –∂–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π —Ç–∞—Ä–∏—Ñ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π (–±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π –¥–ª—è —Å–∞–π—Ç–∞)\n        const trainTariff = data.data.train;\n        \n        if (trainTariff) {\n          // –°–æ–±–∏—Ä–∞–µ–º –¥–µ—Ç–∞–ª–∏ –ø–æ —É—Å–ª—É–≥–∞–º –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n          const services: { name: string; description: string; price: number }[] = [];\n          let totalPrice = 0;\n          \n          console.log('üöÇ Rail Continent –¥–µ—Ç–∞–ª–∏ —Ç–∞—Ä–∏—Ñ–∞:', {\n            priceTotal: trainTariff.priceTotal,\n            price_with_out_sale: trainTariff.price_with_out_sale,\n            pricePackage: trainTariff.pricePackage,\n            priceInsurance: trainTariff.priceInsurance,\n            needPackaging: form.needPackaging,\n            needInsurance: form.needInsurance,\n            declaredValue: form.declaredValue\n          });\n          \n          console.log('üöÇ Rail Continent —á–µ–∫–±–æ–∫—Å—ã —Å–æ—Å—Ç–æ—è–Ω–∏–µ:');\n          console.log('   - –£–ø–∞–∫–æ–≤–∫–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è:', form.needPackaging);\n          console.log('   - –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è:', form.needInsurance);\n          console.log('   - –ó–∞—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:', form.declaredValue);\n          \n          // –ò—Å–ø–æ–ª—å–∑—É–µ–º priceTotal –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å (–≤–∫–ª—é—á–∞–µ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–µ —Å–±–æ—Ä—ã)\n          if (trainTariff.priceTotal) {\n            const deliveryPrice = parseFloat(trainTariff.priceTotal);\n            console.log('üöÇ –î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞ (priceTotal):', deliveryPrice);\n            services.push({\n              name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n              description: `${trainTariff.type} (${trainTariff.rsType})`,\n              price: deliveryPrice\n            });\n            totalPrice = deliveryPrice; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–∫ –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É\n            \n            // –ï—Å–ª–∏ –µ—Å—Ç—å –¥–æ–ø. —É—Å–ª—É–≥–∏, –¥–æ–±–∞–≤–ª—è–µ–º –∏—Ö –æ—Ç–¥–µ–ª—å–Ω–æ\n            if (form.needPackaging && trainTariff.pricePackage) {\n              const packagingPrice = parseFloat(trainTariff.pricePackage);\n              console.log('üöÇ –£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞:', packagingPrice);\n              services.push({\n                name: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n                description: '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞',\n                price: packagingPrice\n              });\n              totalPrice += packagingPrice;\n            }\n            \n            // –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ (—Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç priceTotal)\n            if (form.needInsurance && trainTariff.priceInsurance) {\n              const insuranceCost = Math.round(form.declaredValue * parseFloat(trainTariff.priceInsurance) / 100);\n              console.log('üöÇ –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞:', insuranceCost, '(', form.declaredValue, '*', trainTariff.priceInsurance, '%)');\n              services.push({\n                name: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n                description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n                price: insuranceCost\n              });\n              totalPrice += insuranceCost;\n            }\n          } else if (trainTariff.price_with_out_sale) {\n            // Fallback –Ω–∞ —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É –µ—Å–ª–∏ priceTotal –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç\n            const deliveryPrice = parseFloat(trainTariff.price_with_out_sale);\n            console.log('üöÇ –î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞ (fallback):', deliveryPrice);\n            services.push({\n              name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n              description: `${trainTariff.type} (${trainTariff.rsType})`,\n              price: deliveryPrice\n            });\n            totalPrice += deliveryPrice;\n            \n            // –£–ø–∞–∫–æ–≤–∫–∞\n            if (form.needPackaging && trainTariff.pricePackage) {\n              const packagingPrice = parseFloat(trainTariff.pricePackage);\n              console.log('üöÇ –£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞:', packagingPrice);\n              services.push({\n                name: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n                description: '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞',\n                price: packagingPrice\n              });\n              totalPrice += packagingPrice;\n            }\n            \n            // –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ\n            if (form.needInsurance && trainTariff.priceInsurance) {\n              const insuranceCost = Math.round(form.declaredValue * parseFloat(trainTariff.priceInsurance) / 100);\n              console.log('üöÇ –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞:', insuranceCost, '(', form.declaredValue, '*', trainTariff.priceInsurance, '%)');\n              services.push({\n                name: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n                description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n                price: insuranceCost\n              });\n              totalPrice += insuranceCost;\n            }\n          }\n\n          console.log('üöÇ Rail Continent –∏—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:', totalPrice);\n          console.log('üöÇ Rail Continent —É—Å–ª—É–≥–∏:', services);\n\n          // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º, –Ω–æ –Ω–µ –≤–∫–ª—é—á–∞–µ–º –≤ –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å)\n          const additionalServices: { name: string; description: string; price: number }[] = [];\n          \n          // –¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–µ —Å–±–æ—Ä—ã\n          if (trainTariff.terminalEnter1) {\n            additionalServices.push({\n              name: '–¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–π —Å–±–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è',\n              description: '–û–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä—É–∑–∞ –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ',\n              price: parseInt(trainTariff.terminalEnter1)\n            });\n          }\n          \n          // –ó–∞–±–æ—Ä/–¥–æ—Å—Ç–∞–≤–∫–∞\n          if (form.fromAddressDelivery && trainTariff.pricePickup && parseInt(trainTariff.pricePickup) > 0) {\n            additionalServices.push({\n              name: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n              description: '–û—Ç –∞–¥—Ä–µ—Å–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è',\n              price: parseInt(trainTariff.pricePickup)\n            });\n          }\n          \n          if (form.toAddressDelivery && trainTariff.priceDelivery && parseInt(trainTariff.priceDelivery) > 0) {\n            additionalServices.push({\n              name: '–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –∞–¥—Ä–µ—Å—É',\n              description: '–î–æ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è',\n              price: parseInt(trainTariff.priceDelivery)\n            });\n          }\n\n          return {\n            company: 'Rail Continent',\n            price: Math.round(totalPrice),\n            days: parseInt(trainTariff.duration) || 5,\n            details: {\n              tariff: `${trainTariff.type} - ${trainTariff.service}`,\n              transportType: trainTariff.rsType,\n              weight: totalWeight,\n              volume: totalVolume,\n              route: `${form.fromCity} - ${form.toCity}`,\n              services,\n              additionalServices,\n              allTariffs: data.data\n            },\n            requestData,\n            responseData: data,\n            apiUrl\n          };\n        } else {\n          return {\n            company: 'Rail Continent',\n            price: 0,\n            days: 0,\n            error: '–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π —Ç–∞—Ä–∏—Ñ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞',\n            requestData,\n            responseData: data,\n            apiUrl\n          };\n        }\n      } else {\n        return {\n          company: 'Rail Continent',\n          price: 0,\n          days: 0,\n          error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ Rail Continent',\n          requestData,\n          responseData: data,\n          apiUrl\n        };\n      }\n    } catch (error: any) {\n      console.error('üöÇ Rail Continent –æ—à–∏–±–∫–∞:', error);\n      return {\n        company: 'Rail Continent',\n        price: 0,\n        days: 0,\n        error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n        apiUrl\n      };\n    }\n  };\n\n  const calculateVozovoz = async (): Promise<CalculationResult> => {\n    const apiUrl = '/api/vozovoz';\n    \n    try {\n      // –í—ã—á–∏—Å–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥—Ä—É–∑–∞\n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n      const totalVolume = form.cargos.reduce((sum, cargo) => \n        sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n      );\n      \n      console.log('üöö –í–æ–∑–æ–≤–æ–∑: –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');\n      console.log('   - –û–±—â–∏–π –≤–µ—Å:', totalWeight, '–∫–≥');\n      console.log('   - –û–±—â–∏–π –æ–±—ä–µ–º:', totalVolume, '–º¬≥');\n      console.log('   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç:', form.cargos.length);\n      \n      // –û—Ç–ª–∞–¥–∫–∞ –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—Ç–∞\n      form.cargos.forEach((cargo, index) => {\n        console.log(`   - –ú–µ—Å—Ç–æ ${index + 1}:`);\n        console.log(`     - –ì–∞–±–∞—Ä–∏—Ç—ã: ${cargo.length}√ó${cargo.width}√ó${cargo.height} —Å–º`);\n        console.log(`     - –í –º–µ—Ç—Ä–∞—Ö: ${cargo.length/100}√ó${cargo.width/100}√ó${cargo.height/100} –º`);\n        console.log(`     - –í–µ—Å: ${cargo.weight} –∫–≥`);\n        console.log(`     - –û–±—ä–µ–º: ${((cargo.length * cargo.width * cargo.height) / 1000000).toFixed(3)} –º¬≥`);\n      });\n      \n      console.log('   - –û—Ç–∫—É–¥–∞:', form.fromCity);\n      console.log('   - –ö—É–¥–∞:', form.toCity);\n      \n      // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É wizard –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—Ç–∞\n      const createRequestData = () => ({\n        object: \"price\",\n        action: \"get\",\n        params: {\n          cargo: {\n            // ‚ö†Ô∏è –í–ê–ñ–ù–û: category –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω—ã (price.get)\n            // –ü–∞—Ä–∞–º–µ—Ç—Ä category –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¢–û–õ–¨–ö–û –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ (order.set)\n            // –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: vozovoz-docs/ru/docs/structure/cargo.md —Å—Ç—Ä–æ–∫–∞ 28\n            // –û—à–∏–±–∫–∞: \"–í —É–∑–ª–µ guid –Ω–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Å—Å—ã–ª–∫—É –Ω–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–ì—Ä—É–∑–æ–≤\"\n            \n            // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º wizard –≤–º–µ—Å—Ç–æ dimension –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏\n            wizard: form.cargos.map(cargo => ({\n              length: cargo.length / 100,   // —Å–º ‚Üí –º\n              width: cargo.width / 100,     // —Å–º ‚Üí –º\n              height: cargo.height / 100,   // —Å–º ‚Üí –º\n              quantity: 1,\n              weight: cargo.weight\n              // ‚ö†Ô∏è wrapping –ù–ï —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ wizard –¥–ª—è price.get!\n              // –£–ø–∞–∫–æ–≤–∫–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ cargo.wrapping (–Ω–∏–∂–µ)\n            })),\n            \n            // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–ø–∞–∫–æ–≤–∫–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ cargo.wrapping\n            // –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: vozovoz-docs/ru/docs/object/order.md —Å—Ç—Ä–æ–∫–∞ 533-537\n            // –¢–µ—Å—Ç –ø–æ–∫–∞–∑–∞–ª: wizard[].wrapping –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç, cargo.wrapping –†–ê–ë–û–¢–ê–ï–¢!\n            ...(form.needPackaging ? {\n              wrapping: {\n                // \"–ó–∞—â–∏—Ç–Ω–∞—è –∂—ë—Å—Ç–∫–∞—è —É–ø–∞–∫–æ–≤–∫–∞ —Å —Ñ–æ—Ç–æ —Å —Ä–∞–∑–±–æ—Ä–æ–º\"\n                // hardPackageVolumeUOD_WP - –° –†–ê–ó–ë–û–†–û–ú + –° –§–û–¢–û\n                // UOD = Unboxing On Delivery (—Ä–∞–∑–±–æ—Ä –ø—Ä–∏ –¥–æ—Å—Ç–∞–≤–∫–µ)\n                // WP = With Photos (—Å —Ñ–æ—Ç–æ)\n                // –¶–µ–Ω–∞: ~1020 —Ä—É–±. –∑–∞ 0.15 –º¬≥ + 10 —Ä—É–±. —Ä–∞–∑–±–æ—Ä + 50 —Ä—É–±. —Ñ–æ—Ç–æ\n                hardPackageVolumeUOD_WP: form.cargos.reduce((sum, cargo) => \n                  sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n                )  // –û–±—â–∏–π –æ–±—ä–µ–º –≤—Å–µ—Ö –º–µ—Å—Ç –≤ –º¬≥\n              }\n            } : {}),\n            \n            // –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ\n            ...(form.needInsurance && form.declaredValue > 0 ? {\n              insurance: form.declaredValue,\n              insuranceNdv: false\n            } : {\n              insuranceNdv: true\n            })\n          },\n          gateway: {\n            dispatch: {\n              point: {\n                location: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n                ...(form.fromAddressDelivery && form.fromAddress?.trim() ? {\n                  address: form.fromAddress.trim()\n                } : {\n                  terminal: \"default\"\n                })\n              },\n              // ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–∏\n              ...(form.needLoading ? {\n                service: {\n                  // –ü–æ–≥—Ä—É–∑–∫–∞ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞)\n                  needLoading: {\n                    floor: form.floor || 1,\n                    lift: form.hasFreightLift || false\n                  }\n                  // ‚ö†Ô∏è unboxingOnDelivery –ù–ï –Ω—É–∂–µ–Ω - —É–∂–µ –≤–∫–ª—é—á–µ–Ω –≤ hardPackageVolumeUOD_WP\n                  // (UOD = Unboxing On Delivery - —Ä–∞–∑–±–æ—Ä –≥—Ä—É–∑–∞ –ø—Ä–∏ –¥–æ—Å—Ç–∞–≤–∫–µ)\n                }\n              } : {})\n            },\n            destination: {\n              point: {\n                location: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n                ...(form.toAddressDelivery && form.toAddress?.trim() ? {\n                  address: form.toAddress.trim()\n                } : {\n                  terminal: \"default\"\n                })\n              },\n              // ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–∏\n              ...(form.needCarry ? {\n                service: {\n                  // –†–∞–∑–≥—Ä—É–∑–∫–∞ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–∏ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω –ø–æ–¥—ä–µ–º –Ω–∞ —ç—Ç–∞–∂)\n                  needLoading: {\n                    floor: form.floor || 1,\n                    lift: form.hasFreightLift || false\n                  }\n                }\n              } : {})\n            }\n          }\n        }\n      });\n\n      // –°–æ–∑–¥–∞–µ–º –∑–∞–ø—Ä–æ—Å —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –∞–¥—Ä–µ—Å–æ–≤\n      let requestData = createRequestData();\n      \n      console.log('üöö –í–æ–∑–æ–≤–æ–∑ –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n\n      let result = await enhancedApiRequest(\n        apiUrl,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(requestData)\n        },\n        { operation: 'calculate', company: '–í–æ–∑–æ–≤–æ–∑' }\n      );\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –æ—à–∏–±–∫—É API —É—Ä–æ–≤–Ω—è\n      if (result && typeof result === 'object' && 'success' in result && !result.success) {\n        console.error('‚ùå –í–æ–∑–æ–≤–æ–∑ API –æ—à–∏–±–∫–∞:', result.error);\n        return {\n          company: '–í–æ–∑–æ–≤–æ–∑',\n          price: 0,\n          days: 0,\n          error: result.error.userMessage || result.error.message,\n          requestData,\n          responseData: null,\n          apiUrl\n        };\n      }\n\n      const response = result as Response;\n      const data = await response.json();\n      console.log('üöö –í–æ–∑–æ–≤–æ–∑ –æ—Ç–≤–µ—Ç:', JSON.stringify(data, null, 2));\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ –ò–õ–ò –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–∫–∏ –≤ –æ—Ç–≤–µ—Ç–µ\n      if (response.ok && data.response) {\n        // –£—Å–ø–µ—à–Ω—ã–π —Ä–∞—Å—á–µ—Ç\n        const responseData = data.response;\n        \n        console.log('üöö –í–æ–∑–æ–≤–æ–∑ –∞–Ω–∞–ª–∏–∑ –æ—Ç–≤–µ—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:', responseData);\n        \n        // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n        const services: { name: string; description: string; price: number }[] = [];\n        let totalPrice = responseData.price || responseData.basePrice || 0;\n        \n        // ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –º–∞—Å—Å–∏–≤ —É—Å–ª—É–≥ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API\n        if (responseData.service && Array.isArray(responseData.service)) {\n          console.log('üöö –í–æ–∑–æ–≤–æ–∑ –Ω–∞–π–¥–µ–Ω –º–∞—Å—Å–∏–≤ —É—Å–ª—É–≥:', responseData.service.length);\n          \n          responseData.service.forEach((service: any, index: number) => {\n            console.log(`üöö –£—Å–ª—É–≥–∞ [${index}]:`, service);\n            if (service.price > 0) {\n              services.push({\n                name: service.name || '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —É—Å–ª—É–≥–∞',\n                description: service.description || '',\n                price: service.price\n              });\n            }\n          });\n        } else {\n          console.log('üöö –í–æ–∑–æ–≤–æ–∑: –º–∞—Å—Å–∏–≤ —É—Å–ª—É–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –ø—É—Å—Ç');\n          \n          // –ï—Å–ª–∏ –º–∞—Å—Å–∏–≤–∞ —É—Å–ª—É–≥ –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n          if (responseData.basePrice && responseData.basePrice > 0) {\n            services.push({\n              name: '–ë–∞–∑–æ–≤–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞',\n              description: `${form.fromCity} - ${form.toCity}`,\n              price: responseData.basePrice\n            });\n          }\n          \n          // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–∫–∏–¥–∫–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—ë –æ—Ç–¥–µ–ª—å–Ω–æ\n          if (responseData.price !== responseData.basePrice && responseData.price > 0) {\n            const discount = (responseData.basePrice || 0) - responseData.price;\n            if (discount > 0) {\n              services.push({\n                name: '–°–∫–∏–¥–∫–∞',\n                description: '–ü—Ä–∏–º–µ–Ω–µ–Ω–∞ —Å–∫–∏–¥–∫–∞',\n                price: -discount\n              });\n            }\n          }\n        }\n        \n        // –ï—Å–ª–∏ –Ω–∏–∫–∞–∫–∏—Ö —É—Å–ª—É–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n        if (services.length === 0 && totalPrice > 0) {\n          services.push({\n            name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n            description: `${form.fromCity} - ${form.toCity}`,\n            price: totalPrice\n          });\n        }\n\n        console.log('üöö –í–æ–∑–æ–≤–æ–∑ –∏—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:', totalPrice);\n        console.log('üöö –í–æ–∑–æ–≤–æ–∑ —É—Å–ª—É–≥–∏:', services);\n\n        return {\n          company: '–í–æ–∑–æ–≤–æ–∑',\n          price: Math.round(totalPrice),\n          days: responseData.deliveryTime?.to || responseData.deliveryTime?.from || 3,\n          details: {\n            note: `–î–æ—Å—Ç–∞–≤–∫–∞ ${form.fromCity} - ${form.toCity}`,\n            services,\n            basePrice: responseData.basePrice,\n            finalPrice: responseData.price,\n            deliveryTime: responseData.deliveryTime,\n            weight: totalWeight,\n            volume: totalVolume\n          },\n          requestData,\n          responseData: data,\n          apiUrl\n        };\n      } else {\n        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –∏–∑ API –æ—Ç–≤–µ—Ç–∞\n        const errorMessage = data.error || data.message || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –í–æ–∑–æ–≤–æ–∑';\n        console.log('üöö –í–æ–∑–æ–≤–æ–∑: –ø–æ–ª—É—á–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≤ –æ—Ç–≤–µ—Ç–µ API:', errorMessage);\n        \n        return {\n          company: '–í–æ–∑–æ–≤–æ–∑',\n          price: 0,\n          days: 0,\n          error: errorMessage,\n          requestData,\n          responseData: data,\n          apiUrl\n        };\n      }\n    } catch (error: any) {\n      console.error('üöö –í–æ–∑–æ–≤–æ–∑ –æ—à–∏–±–∫–∞:', error);\n      return {\n        company: '–í–æ–∑–æ–≤–æ–∑',\n        price: 0,\n        days: 0,\n        error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n        apiUrl\n      };\n    }\n  };\n\n  // –†–∞—Å—á–µ—Ç –¥–ª—è Nord Wheel\n  const calculateNordWheel = async (): Promise<CalculationResult> => {\n    const apiUrl = '/api/nordwheel';\n\n    try {\n      // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      validateMultipleCargos(form.cargos);\n      \n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n      const totalVolume = form.cargos.reduce((sum, cargo) => \n        sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n      );\n\n      // üîß –î–û–ë–ê–í–õ–ï–ù–û: –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π API NordWheel\n      if (totalWeight > 1000) {\n        console.warn('‚ö†Ô∏è Nord Wheel: –í–µ—Å –ø—Ä–µ–≤—ã—à–∞–µ—Ç 1000 –∫–≥, –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∞ API');\n      }\n      if (totalVolume > 5) {\n        console.warn('‚ö†Ô∏è Nord Wheel: –û–±—ä–µ–º –ø—Ä–µ–≤—ã—à–∞–µ—Ç 5 –º¬≥, –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∞ API');\n      }\n\n      // üîß –î–û–ë–ê–í–õ–ï–ù–û: –†–∞—Å—á–µ—Ç –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      const maxLength = Math.max(...form.cargos.map(c => c.length));\n      const maxWidth = Math.max(...form.cargos.map(c => c.width));\n      const maxHeight = Math.max(...form.cargos.map(c => c.height));\n      \n      // üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      console.log('üåê Nord Wheel: –ê–Ω–∞–ª–∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç:');\n      console.log(`   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç: ${form.cargos.length}`);\n      console.log(`   - –û–±—â–∏–π –≤–µ—Å: ${totalWeight} –∫–≥`);\n      console.log(`   - –û–±—â–∏–π –æ–±—ä–µ–º: ${totalVolume.toFixed(3)} –º¬≥`);\n      \n      // –î–µ—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏—Å—Ç–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n      let dispatchType = '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';\n      if (form.fromLavsiteWarehouse) {\n        dispatchType = '—Å–∫–ª–∞–¥ –õ–∞–≤—Å–∏—Ç';\n      } else if (form.fromTerminal) {\n        dispatchType = '—Ç–µ—Ä–º–∏–Ω–∞–ª';\n      } else if (form.fromAddressDelivery) {\n        dispatchType = '–∞–¥—Ä–µ—Å';\n      } else {\n        dispatchType = '—Ç–µ—Ä–º–∏–Ω–∞–ª (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)';\n      }\n      \n      console.log(`   - –û—Ç–∫—É–¥–∞: ${form.fromCity} (${dispatchType})`);\n      console.log(`   - –ö—É–¥–∞: ${form.toCity} (${form.toTerminal ? '—Ç–µ—Ä–º–∏–Ω–∞–ª' : '–∞–¥—Ä–µ—Å'})`);\n      \n      if (form.fromLavsiteWarehouse) {\n        console.log(`   - –ê–¥—Ä–µ—Å —Å–∫–ª–∞–¥–∞: ${form.fromAddress}`);\n      }\n      \n      form.cargos.forEach((cargo, index) => {\n        console.log(`   üì¶ –ú–µ—Å—Ç–æ ${index + 1}:`);\n        console.log(`     - –ì–∞–±–∞—Ä–∏—Ç—ã: ${cargo.length}√ó${cargo.width}√ó${cargo.height} —Å–º`);\n        console.log(`     - –í–µ—Å: ${cargo.weight} –∫–≥`);\n        console.log(`     - –û–±—ä–µ–º: ${((cargo.length * cargo.width * cargo.height) / 1000000).toFixed(3)} –º¬≥`);\n      });\n\n      if (form.cargos.length > 1) {\n        console.log(`   üìê –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã: ${maxLength}√ó${maxWidth}√ó${maxHeight} —Å–º`);\n      }\n\n      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è city_fias_id –∏–∑ –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ Dadata clean API\n      const getCityFiasFromAddress = async (address: string): Promise<string> => {\n        try {\n          console.log(`üöõ Nordwheel: –ó–∞–ø—Ä–æ—Å city_fias_id –¥–ª—è –∞–¥—Ä–µ—Å–∞: ${address}`);\n          \n          const response = await fetch('/api/dadata', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n              address: address,\n              type: 'suggest'\n            })\n          });\n          \n          const data = await response.json();\n          console.log('üöõ Nordwheel: Dadata suggest –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç:', JSON.stringify(data, null, 2));\n          \n          if (data.success && data.data && Array.isArray(data.data) && data.data.length > 0) {\n            const firstSuggestion = data.data[0];\n            const suggestionData = firstSuggestion.data;\n            \n            console.log('üîç Nordwheel: Dadata suggestion –¥–∞–Ω–Ω—ã–µ:', {\n              value: firstSuggestion.value,\n              city: suggestionData.city,\n              city_fias_id: suggestionData.city_fias_id,\n              settlement: suggestionData.settlement,\n              settlement_fias_id: suggestionData.settlement_fias_id\n            });\n            \n            // –ò—Å–ø–æ–ª—å–∑—É–µ–º city_fias_id (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)\n            if (suggestionData.city_fias_id) {\n              console.log(`‚úÖ Nordwheel: –ü–æ–ª—É—á–µ–Ω city_fias_id: ${suggestionData.city_fias_id} (–≥–æ—Ä–æ–¥: ${suggestionData.city})`);\n              return suggestionData.city_fias_id;\n            }\n            // Fallback –Ω–∞ settlement_fias_id –µ—Å–ª–∏ city_fias_id –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç\n            else if (suggestionData.settlement_fias_id) {\n              console.log(`‚úÖ Nordwheel: –ò—Å–ø–æ–ª—å–∑—É–µ–º settlement_fias_id: ${suggestionData.settlement_fias_id} (–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç: ${suggestionData.settlement})`);\n              return suggestionData.settlement_fias_id;\n            }\n            else {\n              console.error(`‚ùå Nordwheel: –ù–∏ city_fias_id, –Ω–∏ settlement_fias_id –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è –∞–¥—Ä–µ—Å–∞ ${address}`);\n              throw new Error(`FIAS –∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –∞–¥—Ä–µ—Å–∞ ${address}`);\n            }\n          } else {\n            console.error(`‚ùå Nordwheel: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç Dadata –¥–ª—è –∞–¥—Ä–µ—Å–∞ ${address}`);\n            console.error('–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', JSON.stringify(data, null, 2));\n            throw new Error(`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç Dadata –¥–ª—è –∞–¥—Ä–µ—Å–∞ ${address}`);\n          }\n        } catch (error) {\n          console.error(`‚ùå Nordwheel: –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è city_fias_id:`, error);\n          throw error;\n        }\n      };\n\n      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è FIAS –∫–æ–¥–∞ –≥–æ—Ä–æ–¥–∞ —á–µ—Ä–µ–∑ Dadata (–¥–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏)\n      const getNordwheelCityFias = async (cityName: string): Promise<string> => {\n        try {\n          console.log(`üöõ Nordwheel: –ó–∞–ø—Ä–æ—Å FIAS –¥–ª—è –≥–æ—Ä–æ–¥–∞: ${cityName}`);\n          \n          // –ò—Å–ø–æ–ª—å–∑—É–µ–º clean API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è FIAS –∫–æ–¥–∞ –≥–æ—Ä–æ–¥–∞\n          const response = await fetch('/api/dadata', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n              address: cityName,\n              type: 'suggest'\n            })\n          });\n          \n          const data = await response.json();\n          console.log('üöõ Nordwheel: Dadata suggest –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è –≥–æ—Ä–æ–¥–∞:', JSON.stringify(data, null, 2));\n\n          if (data.success && data.data && Array.isArray(data.data) && data.data.length > 0) {\n            const firstSuggestion = data.data[0];\n            const suggestionData = firstSuggestion.data;\n            \n            console.log('üîç Nordwheel: Dadata suggestion –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥–æ—Ä–æ–¥–∞:', {\n              value: firstSuggestion.value,\n              city: suggestionData.city,\n              city_fias_id: suggestionData.city_fias_id,\n              settlement: suggestionData.settlement,\n              settlement_fias_id: suggestionData.settlement_fias_id\n            });\n            \n            if (suggestionData.city_fias_id) {\n              console.log(`‚úÖ Nordwheel: –ü–æ–ª—É—á–µ–Ω FIAS –¥–ª—è ${cityName}: ${suggestionData.city_fias_id}`);\n              return suggestionData.city_fias_id;\n            } else if (suggestionData.settlement_fias_id) {\n              console.log(`‚úÖ Nordwheel: –ò—Å–ø–æ–ª—å–∑—É–µ–º settlement_fias_id –¥–ª—è ${cityName}: ${suggestionData.settlement_fias_id}`);\n              return suggestionData.settlement_fias_id;\n            } else {\n              console.error(`‚ùå Nordwheel: FIAS –∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –≥–æ—Ä–æ–¥–∞ ${cityName}`);\n              throw new Error(`FIAS –∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –≥–æ—Ä–æ–¥–∞ ${cityName}`);\n            }\n          } else {\n            console.error(`‚ùå Nordwheel: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç Dadata –¥–ª—è –≥–æ—Ä–æ–¥–∞ ${cityName}`);\n            console.error('–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', JSON.stringify(data, null, 2));\n            throw new Error(`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç Dadata –¥–ª—è –≥–æ—Ä–æ–¥–∞ ${cityName}`);\n          }\n        } catch (error) {\n          console.warn(`‚ö†Ô∏è Nordwheel: Dadata –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è ${cityName}, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–æ—Ä–æ–¥ –∫–∞–∫ —Å—Ç—Ä–æ–∫—É:`, error);\n          // Fallback: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≥–æ—Ä–æ–¥ –∫–∞–∫ —Å—Ç—Ä–æ–∫—É –≤–º–µ—Å—Ç–æ FIAS –∫–æ–¥–∞\n          return cityName;\n        }\n      };\n      // üèôÔ∏è –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ª–æ–∫–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–æ—Ä–º—ã\n      const getDispatchLocation = async () => {\n        try {\n          if (form.fromTerminal) {\n            // –¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞: type=terminal + city_fias\n            return {\n              type: 'terminal' as const,\n              city_fias: await getNordwheelCityFias(form.fromCity)\n            };\n          } else if (form.fromLavsiteWarehouse) {\n            // üè≠ –°–∫–ª–∞–¥ –õ–∞–≤—Å–∏—Ç: type=address + city_fias_id (–∏—Å–ø–æ–ª—å–∑—É–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å)\n            const warehouseAddressSimplified = '–õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π, –¥.–û—Å–µ–µ–≤–æ';\n            console.log(`üè≠ Nordwheel: –°–∫–ª–∞–¥ –õ–∞–≤—Å–∏—Ç - –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å: ${warehouseAddressSimplified}`);\n            const cityFiasId = await getCityFiasFromAddress(warehouseAddressSimplified);\n            \n            return {\n              type: 'address' as const,\n              city_fias: cityFiasId\n            };\n          } else {\n            // –ê–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞: type=address + city_fias_id\n            const address = form.fromAddress || form.fromCity;\n            const cityFiasId = await getCityFiasFromAddress(address);\n            \n            return {\n              type: 'address' as const,\n              city_fias: cityFiasId\n            };\n          }\n        } catch (error) {\n          console.error(`üöõ Nordwheel: –û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è:`, error);\n          throw error;\n        }\n      };\n\n      const getDestinationLocation = async () => {\n        try {\n          if (form.toTerminal) {\n            // –¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞: type=terminal + city_fias\n            return {\n              type: 'terminal' as const,\n              city_fias: await getNordwheelCityFias(form.toCity)\n            };\n          } else {\n            // –ê–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞: type=address + city_fias_id\n            const address = form.toAddress || form.toCity;\n            const cityFiasId = await getCityFiasFromAddress(address);\n            \n            return {\n              type: 'address' as const,\n              city_fias: cityFiasId\n            };\n          }\n        } catch (error) {\n          console.error(`üöõ Nordwheel: –û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:`, error);\n          throw error;\n        }\n      };\n\n      // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è –Ω–æ–≤–æ–≥–æ API NordWheel —Å —É—á–µ—Ç–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–æ—Ä–º—ã\n      let requestData;\n      try {\n        requestData = {\n          dispatch: {\n            location: await getDispatchLocation()\n          },\n          destination: {\n            location: await getDestinationLocation()\n          },\n          cargo: {\n            total_weight: totalWeight,\n            total_volume: totalVolume,\n            total_quantity: 1 // –í—Å–µ–≥–¥–∞ 1, —á—Ç–æ–±—ã NordWheel –Ω–µ —É–º–Ω–æ–∂–∞–ª —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –∫–æ–ª-–≤–æ –º–µ—Å—Ç\n          },\n          insurance: form.needInsurance && form.declaredValue ? form.declaredValue : null,\n          insurance_refuse: !form.needInsurance,\n          services: {\n            is_package: form.needPackaging,\n            is_documents_return: false,\n            is_fragile: false\n          },\n          promocode: null\n        };\n      } catch (locationError) {\n        console.error('üöõ Nordwheel: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–π:', locationError);\n        return {\n          company: 'Nord Wheel',\n          price: 0,\n          days: 0,\n          error: `–û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞–¥—Ä–µ—Å–æ–≤: ${locationError instanceof Error ? locationError.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`,\n          apiUrl\n        };\n      }\n\n      console.log('üöõ Nord Wheel –Ω–æ–≤—ã–π API –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n\n      const result = await enhancedApiRequest(\n        apiUrl,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(requestData)\n        },\n        { operation: 'calculate', company: 'Nord Wheel' }\n      );\n\n      if (result && typeof result === 'object' && 'success' in result && !result.success) {\n        console.error('‚ùå Nord Wheel API –æ—à–∏–±–∫–∞:', result.error);\n        \n        // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ 400 –∏ –±–æ–ª—å—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø—Ä–æ–±—É–µ–º —Å —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏\n        if (result.error.status === 400 && (totalWeight > 1000 || totalVolume > 5)) {\n          console.log('üîÑ Nord Wheel: –ü—Ä–æ–±—É–µ–º fallback —Ä–∞—Å—á–µ—Ç —Å —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏...');\n          \n          const fallbackRequestData = {\n            ...requestData,\n            cargo: {\n              total_weight: Math.min(totalWeight, 999),\n              total_volume: Math.min(totalVolume, 4.9),\n              total_quantity: 1 // –¢–∞–∫–∂–µ –≤—Å–µ–≥–¥–∞ 1 –¥–ª—è fallback\n            }\n          };\n          \n          console.log('üîÑ Fallback –∑–∞–ø—Ä–æ—Å:', JSON.stringify(fallbackRequestData, null, 2));\n          \n          const fallbackResult = await enhancedApiRequest(\n            apiUrl,\n            {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json'\n              },\n              body: JSON.stringify(fallbackRequestData)\n            },\n            { operation: 'calculate', company: 'Nord Wheel (fallback)' }\n          );\n          \n          if (fallbackResult && typeof fallbackResult === 'object' && 'success' in fallbackResult && !fallbackResult.success) {\n            console.error('‚ùå Nord Wheel fallback —Ç–æ–∂–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:', fallbackResult.error);\n          } else {\n            console.log('‚úÖ Nord Wheel fallback —Å—Ä–∞–±–æ—Ç–∞–ª! –ò—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.');\n            // –ò—Å–ø–æ–ª—å–∑—É–µ–º fallback —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞\n            const fallbackResponse = fallbackResult as Response;\n            const fallbackData = await fallbackResponse.json();\n            \n            // –ü–∞—Ä—Å–∏–º fallback —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º —Ü–µ–Ω—É\n            const scaleFactor = Math.max(totalWeight / 999, totalVolume / 4.9);\n            \n            if (fallbackData.auto || fallbackData.avia) {\n              const options: Array<{\n                type: string;\n                price: number;\n                days: any;\n                services: any;\n              }> = [];\n              \n              if (fallbackData.auto) {\n                const scaledPrice = Math.round((fallbackData.auto.total_amount || 0) * scaleFactor);\n                options.push({\n                  type: 'auto',\n                  price: scaledPrice,\n                  days: fallbackData.auto.delivery_date || '',\n                  services: fallbackData.auto.services || []\n                });\n              }\n              \n              if (fallbackData.avia) {\n                const scaledPrice = Math.round((fallbackData.avia.total_amount || 0) * scaleFactor);\n                options.push({\n                  type: 'avia',\n                  price: scaledPrice,\n                  days: fallbackData.avia.delivery_date || '',\n                  services: fallbackData.avia.services || []\n                });\n              }\n              \n              if (options.length > 0) {\n                const bestOption = options.reduce((best, current) => \n                  current.price < best.price ? current : best\n                );\n                \n                // –í—ã—á–∏—Å–ª—è–µ–º –¥–Ω–∏\n                let calculatedDays = 3;\n                try {\n                  if (bestOption.days) {\n                    const deliveryDate = new Date(bestOption.days);\n                    const today = new Date();\n                    if (!isNaN(deliveryDate.getTime())) {\n                      const diffTime = deliveryDate.getTime() - today.getTime();\n                      calculatedDays = Math.max(1, Math.ceil(diffTime / (1000 * 60 * 60 * 24)));\n                    }\n                  }\n                } catch (e) {\n                  // –û—Å—Ç–∞–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n                }\n                \n                return {\n                  company: 'Nord Wheel',\n                  price: bestOption.price,\n                  days: calculatedDays,\n                  details: {\n                    totalCost: bestOption.price,\n                    deliveryCost: bestOption.price,\n                    transportType: bestOption.type,\n                    services: bestOption.services,\n                    allOptions: options,\n                    currency: 'RUB',\n                    deliveryDate: bestOption.days,\n                    note: `–†–∞—Å—á–µ—Ç –ø–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º (–∫–æ—ç—Ñ. ${scaleFactor.toFixed(2)})`\n                  },\n                  requestData: {\n                    original: requestData,\n                    fallback: fallbackRequestData,\n                    scaleFactor\n                  },\n                  responseData: fallbackData,\n                  apiUrl\n                };\n              }\n            }\n          }\n        }\n        \n        // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫ 400\n        let errorMessage = result.error.userMessage || result.error.message || '–û—à–∏–±–∫–∞ API NordWheel';\n        \n        if (result.error.status === 400) {\n          errorMessage += `. –ü—Ä–µ–≤—ã—à–µ–Ω—ã –ª–∏–º–∏—Ç—ã API: –≤–µ—Å >1000–∫–≥ –∏–ª–∏ –æ–±—ä–µ–º >5–º¬≥. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –≥—Ä—É–∑ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–π.`;\n        }\n        \n        return {\n          company: 'Nord Wheel',\n          price: 0,\n          days: 0,\n          error: errorMessage,\n          apiUrl,\n          requestData\n        };\n      }\n\n      const response = result as Response;\n      const data = await response.json();\n      console.log('üöõ Nord Wheel API –æ—Ç–≤–µ—Ç:', data);\n\n       // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ API - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã\n       let price = 0;\n       let days = 0;\n       let details: any = {};\n\n       // –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç API —Å auto/avia –æ–±—ä–µ–∫—Ç–∞–º–∏ (–ø—Ä–æ–≤–µ—Ä—è–µ–º –±–µ–∑ data.success)\n       if (data.auto || data.avia) {\n         const options: Array<{type: string, price: number, days: number, services: any[]}> = [];\n         \n         if (data.auto) {\n           const autoPrice = data.auto.total_amount || 0;\n           const autoDeliveryDate = data.auto.delivery_date || '';\n           \n           options.push({\n             type: 'auto',\n             price: autoPrice,\n             days: autoDeliveryDate, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ —Å—Ç—Ä–æ–∫—É –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n             services: data.auto.services || []\n           });\n         }\n         \n         if (data.avia) {\n           const aviaPrice = data.avia.total_amount || 0;\n           const aviaDeliveryDate = data.avia.delivery_date || '';\n           \n           options.push({\n             type: 'avia',\n             price: aviaPrice,\n             days: aviaDeliveryDate, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ —Å—Ç—Ä–æ–∫—É –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n             services: data.avia.services || []\n           });\n         }\n         \n         if (options.length === 0) {\n           console.error('‚ùå Nord Wheel: –ù–µ—Ç –æ–ø—Ü–∏–π –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ –æ—Ç–≤–µ—Ç–µ:', data);\n           return {\n             company: 'Nord Wheel',\n             price: 0,\n             days: 0,\n             error: '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–ø—Ü–∏–π –¥–æ—Å—Ç–∞–≤–∫–∏',\n             apiUrl,\n             requestData,\n             responseData: data\n           };\n         }\n         \n         // –í—ã–±–∏—Ä–∞–µ–º —Å–∞–º—ã–π –¥–µ—à–µ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç\n         const bestOption = options.reduce((best, current) => \n           current.price < best.price ? current : best\n         );\n         \n         price = bestOption.price;\n         \n         // –í—ã—á–∏—Å–ª—è–µ–º –¥–Ω–∏ –∏–∑ –¥–∞—Ç—ã –¥–æ—Å—Ç–∞–≤–∫–∏\n         try {\n           if (bestOption.days && typeof bestOption.days === 'string') {\n             const deliveryDate = new Date(bestOption.days);\n             const today = new Date();\n             if (!isNaN(deliveryDate.getTime())) {\n               const diffTime = deliveryDate.getTime() - today.getTime();\n               days = Math.max(1, Math.ceil(diffTime / (1000 * 60 * 60 * 24)));\n             } else {\n               days = 3; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é\n             }\n           } else {\n             days = 3; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é\n           }\n         } catch (dateError) {\n           console.warn('‚ö†Ô∏è Nord Wheel: –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –¥–Ω–µ–π –∏–∑ –¥–∞—Ç—ã:', dateError);\n           days = 3;\n         }\n         \n         details = {\n           totalCost: price,\n           deliveryCost: price, // –í –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ\n           transportType: bestOption.type,\n           services: bestOption.services,\n           allOptions: options, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n           currency: 'RUB',\n           deliveryDate: bestOption.days // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—É—é –¥–∞—Ç—É\n         };\n       } else if (data.price !== undefined) {\n         // –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞\n         price = data.price;\n         days = data.days || data.delivery_time || 0;\n         details = {\n           totalCost: price,\n           currency: data.currency || 'RUB'\n         };\n       } else {\n         // –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ü–µ–Ω—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É\n         console.error('‚ùå Nord Wheel: –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API:', data);\n         return {\n           company: 'Nord Wheel',\n           price: 0,\n           days: 0,\n           error: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API',\n           apiUrl,\n           requestData,\n           responseData: data\n         };\n       }\n\n      return {\n        company: 'Nord Wheel',\n        price: Math.round(price),\n        days: days,\n        details,\n        requestData,\n        responseData: data,\n        apiUrl\n      };\n    } catch (error: any) {\n      console.error('üöõ Nord Wheel –æ—à–∏–±–∫–∞:', error);\n      return {\n        company: 'Nord Wheel',\n        price: 0,\n        days: 0,\n        error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n        apiUrl\n      };\n    }\n  };\n    const calculateCdek = async (): Promise<CalculationResult> => {\n    const apiUrl = '/api/cdek';\n    \n    try {\n      validateMultipleCargos(form.cargos);\n      \n      const packages = form.cargos.map(cargo => ({\n        height: cargo.height,\n        length: cargo.length,\n        width: cargo.width,\n        weight: cargo.weight * 1000\n      }));\n\n      const requestData: any = {\n        from_city: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n        to_city: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n        packages: packages\n      };\n\n      if (form.needInsurance && form.declaredValue > 0) {\n        requestData.services = [{\n          code: 'INSURANCE',\n          parameter: form.declaredValue\n        }];\n        console.log('üì¶ CDEK: –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ', form.declaredValue);\n      }\n\n      console.log('üì¶ CDEK –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n      console.log('üì¶ CDEK –º–∞—Ä—à—Ä—É—Ç:', {\n        fromAddressDelivery: form.fromAddressDelivery,\n        fromLavsiteWarehouse: form.fromLavsiteWarehouse,\n        toAddressDelivery: form.toAddressDelivery\n      });\n\n       const result = await enhancedApiRequest(\n         apiUrl,\n         {\n           method: 'POST',\n           headers: {\n             'Content-Type': 'application/json',\n           },\n           body: JSON.stringify(requestData)\n         },\n         { operation: 'calculate', company: '–°–î–≠–ö' }\n       );\n\n       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n         console.error('‚ùå –°–î–≠–ö API –æ—à–∏–±–∫–∞:', result.error);\n         return {\n           company: '–°–î–≠–ö',\n           price: 0,\n           days: 0,\n           error: result.error.userMessage || result.error.message,\n           requestData,\n           responseData: null,\n           apiUrl\n         };\n       }\n\n       const response = result as Response;\n       const data = await response.json();\n       console.log('üì¶ CDEK –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω, —Ç–∞—Ä–∏—Ñ–æ–≤:', data.tariff_codes?.length || 0);\n\n      if (response.ok && data.tariff_codes && data.tariff_codes.length > 0) {\n        const isFromDoor = form.fromAddressDelivery || form.fromLavsiteWarehouse;\n        const isToDoor = form.toAddressDelivery;\n        \n        let deliveryMode: number;\n        let deliveryModeText: string;\n        \n        if (isFromDoor && isToDoor) {\n          deliveryMode = 1;\n          deliveryModeText = '–¥–≤–µ—Ä—å-–¥–≤–µ—Ä—å';\n        } else if (isFromDoor && !isToDoor) {\n          deliveryMode = 2;\n          deliveryModeText = '–¥–≤–µ—Ä—å-—Å–∫–ª–∞–¥';\n        } else if (!isFromDoor && isToDoor) {\n          deliveryMode = 3;\n          deliveryModeText = '—Å–∫–ª–∞–¥-–¥–≤–µ—Ä—å';\n        } else {\n          deliveryMode = 4;\n          deliveryModeText = '—Å–∫–ª–∞–¥-—Å–∫–ª–∞–¥';\n        }\n\n        console.log(`üì¶ CDEK –≤—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º –¥–æ—Å—Ç–∞–≤–∫–∏: ${deliveryMode} (${deliveryModeText})`);\n\n        const filteredTariffs = data.tariff_codes.filter((t: any) => t.delivery_mode === deliveryMode);\n        \n        console.log(`üì¶ CDEK –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è —Ä–µ–∂–∏–º–∞ ${deliveryModeText}:`, filteredTariffs.length);\n\n        if (filteredTariffs.length === 0) {\n          return {\n            company: '–°–î–≠–ö',\n            price: 0,\n            days: 0,\n            error: `–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∞ ${deliveryModeText}`,\n            requestData,\n            responseData: data,\n            apiUrl\n          };\n        }\n\n        const bestTariff = filteredTariffs.reduce((min: any, tariff: any) => \n          (tariff.delivery_sum < min.delivery_sum) ? tariff : min\n        );\n\n        console.log(`üì¶ CDEK –ª—É—á—à–∏–π —Ç–∞—Ä–∏—Ñ: ${bestTariff.tariff_name} - ${bestTariff.delivery_sum}‚ÇΩ`);\n\n        const detailsRequest: any = {\n          ...requestData,\n          tariff_code: bestTariff.tariff_code,\n          get_details: true\n        };\n\n        console.log('üì¶ CDEK: –∑–∞–ø—Ä–æ—Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏...');\n\n          const detailsResult = await enhancedApiRequest(\n            apiUrl,\n            {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n              },\n              body: JSON.stringify(detailsRequest)\n            },\n            { operation: 'tariff_details', company: '–°–î–≠–ö' }\n          );\n\n          let tariffDetails: any = null;\n          if (detailsResult && typeof detailsResult === 'object' && 'success' in detailsResult && detailsResult.success) {\n            const detailsResponse = detailsResult as Response;\n            if (detailsResponse.ok) {\n              const detailsData = await detailsResponse.json();\n              tariffDetails = detailsData.tariff_details;\n              console.log('üì¶ –°–î–≠–ö –¥–µ—Ç–∞–ª–∏ —Ç–∞—Ä–∏—Ñ–∞:', tariffDetails);\n            }\n          }\n\n        const finalPrice = tariffDetails?.total_sum || bestTariff.delivery_sum;\n        \n        return {\n          company: '–°–î–≠–ö',\n          price: Math.round(finalPrice),\n          days: bestTariff.period_max || 0,\n          details: {\n            tariff_name: bestTariff.tariff_name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n            tariff_code: bestTariff.tariff_code,\n            delivery_mode: deliveryModeText,\n            period_min: bestTariff.period_min,\n            period_max: bestTariff.period_max,\n            calendar_min: bestTariff.calendar_min,\n            calendar_max: bestTariff.calendar_max,\n            all_tariffs: filteredTariffs,\n            services: tariffDetails?.services || [],\n            delivery_sum: tariffDetails?.delivery_sum || bestTariff.delivery_sum,\n            total_sum: finalPrice,\n            weight_calc: tariffDetails?.weight_calc\n          },\n          requestData,\n          responseData: data,\n          apiUrl\n        };\n      } else {\n        return {\n          company: '–°–î–≠–ö',\n          price: 0,\n          days: 0,\n          error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –°–î–≠–ö',\n          requestData,\n          responseData: data,\n          apiUrl\n        };\n      }\n    } catch (error: any) {\n      console.error('üì¶ –°–î–≠–ö –æ—à–∏–±–∫–∞:', error);\n      return {\n        company: '–°–î–≠–ö',\n        price: 0,\n        days: 0,\n        error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n        apiUrl\n      };\n    }\n  };\n\n  const calculateKit = async (): Promise<CalculationResult> => {\n    const apiUrl = '/api/kit';\n    \n    try {\n      validateMultipleCargos(form.cargos);\n      \n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n\n      const requestData = {\n        from_city: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n        to_city: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n        declared_price: form.declaredValue || 10000,\n        service: ['S089']\n      };\n\n      console.log('üöõ –ö–ò–¢ –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n\n       const result = await enhancedApiRequest(\n         apiUrl,\n         {\n           method: 'POST',\n           headers: {\n             'Content-Type': 'application/json',\n           },\n           body: JSON.stringify(requestData)\n         },\n         { operation: 'calculate', company: '–ö–ò–¢' }\n       );\n\n       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n         console.error('‚ùå –ö–ò–¢ API –æ—à–∏–±–∫–∞:', result.error);\n         return {\n           company: '–ö–ò–¢',\n           price: 0,\n           days: 0,\n           error: result.error.userMessage || result.error.message,\n           requestData,\n           responseData: null,\n           apiUrl\n         };\n       }\n\n       const response = result as Response;\n       const data = await response.json();\n       console.log('üöõ –ö–ò–¢ –æ—Ç–≤–µ—Ç:', data);\n\n      if (response.ok && Array.isArray(data) && data.length > 0) {\n        const rubData = data.find((item: any) => {\n          const tariffData: any = Object.values(item)[0];\n          return tariffData?.currency_code === 'RUB';\n        });\n        \n        if (rubData) {\n          const tariffKey = Object.keys(rubData)[0];\n          const tariffData: any = rubData[tariffKey];\n          \n          console.log('üöõ –ö–ò–¢ –≤—ã–±—Ä–∞–Ω —Ç–∞—Ä–∏—Ñ:', tariffKey, tariffData);\n\n          return {\n            company: '–ö–ò–¢',\n            price: Math.round(tariffData.cost || 0),\n            days: tariffData.time || 0,\n            details: {\n              tariff_name: tariffData.name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n              tariff_type: tariffKey,\n              services: tariffData.detail || [],\n              currency: tariffData.currency_code\n            },\n            requestData,\n            responseData: data,\n            apiUrl\n          };\n        }\n      }\n\n      return {\n        company: '–ö–ò–¢',\n        price: 0,\n        days: 0,\n        error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –ö–ò–¢',\n        requestData,\n        responseData: data,\n        apiUrl\n      };\n    } catch (error: any) {\n      console.error('üöõ –ö–ò–¢ –æ—à–∏–±–∫–∞:', error);\n      return {\n        company: '–ö–ò–¢',\n        price: 0,\n        days: 0,\n        error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n        apiUrl\n      };\n    }\n  };\n\n  const handleCalculate = async () => {\n    const totalStartTime = performance.now();\n    setCalculating(true);\n    setCalculations([]);\n    \n    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø–æ—Å–ª–µ —Ä–∞—Å—á–µ—Ç–∞ (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ, –±–µ–∑ –¥–µ–±–∞—É–Ω—Å–∞)\n    saveFormData({\n      cargos: form.cargos,\n      fromCity: form.fromCity,\n      toCity: form.toCity,\n      fromAddress: form.fromAddress,\n      toAddress: form.toAddress,\n      declaredValue: form.declaredValue,\n      needPackaging: form.needPackaging,\n      needLoading: form.needLoading,\n      needCarry: form.needCarry,\n      floor: form.floor,\n      hasFreightLift: form.hasFreightLift,\n      needInsurance: form.needInsurance,\n      fromTerminal: form.fromTerminal,\n      toTerminal: form.toTerminal,\n      fromAddressDelivery: form.fromAddressDelivery,\n      toAddressDelivery: form.toAddressDelivery,\n      selectedProducts: form.selectedProducts,\n    });\n    \n    try {\n      console.log('üöÄ === –ù–ê–ß–ê–õ–û –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–û–ì–û –†–ê–°–ß–ï–¢–ê ===');\n      \n      // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞\n      const { optimizedApiClient } = await import('@/lib/optimized-api-client');\n      const { cacheManager } = await import('@/lib/cache-manager');\n      \n      // 1. –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–µ—Å—Å–∏–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ\n      const preloadStartTime = performance.now();\n      await optimizedApiClient.preloadCalculationData(form);\n      const preloadDuration = performance.now() - preloadStartTime;\n      console.log(`‚ö° –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∑–∞ ${preloadDuration.toFixed(0)}–º—Å`);\n      \n      // 2. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∫–ª—é—á–µ–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏\n      const enabledCompaniesList: Array<{ name: string; key: string; func: () => Promise<CalculationResult> }> = [];\n      \n      if (enabledCompanies.pek) enabledCompaniesList.push({ name: '–ü–≠–ö', key: 'pek', func: calculatePEK });\n      if (enabledCompanies.dellin) enabledCompaniesList.push({ name: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏', key: 'dellin', func: calculateDellin });\n      if (enabledCompanies.railcontinent) enabledCompaniesList.push({ name: 'Rail Continent', key: 'railcontinent', func: calculateRailContinent });\n      if (enabledCompanies.vozovoz) enabledCompaniesList.push({ name: '–í–æ–∑–æ–≤–æ–∑', key: 'vozovoz', func: calculateVozovoz });\n      if (enabledCompanies.nordwheel) enabledCompaniesList.push({ name: 'Nord Wheel', key: 'nordwheel', func: calculateNordWheel });\n      if (enabledCompanies.cdek) enabledCompaniesList.push({ name: '–°–¥—ç–∫', key: 'cdek', func: calculateCdek });\n      if (enabledCompanies.kit) enabledCompaniesList.push({ name: '–ö–∏—Ç', key: 'kit', func: calculateKit });\n      \n      // –ï—Å–ª–∏ –Ω–∏ –æ–¥–Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞\n      if (enabledCompaniesList.length === 0) {\n        setCalculations([]);\n        return;\n      }\n      \n      console.log(`üìã –ó–∞–ø—É—Å–∫ —Ä–∞—Å—á–µ—Ç–æ–≤ –¥–ª—è ${enabledCompaniesList.length} –∫–æ–º–ø–∞–Ω–∏–π:`, enabledCompaniesList.map(c => c.name));\n      \n      // 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞\n      setCalculationProgress({\n        companies: enabledCompaniesList.map(company => ({\n          name: company.name,\n          status: 'pending'\n        })),\n        totalDuration: 0\n      });\n      \n      // 4. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ä–∞—Å—á–µ—Ç–æ–≤ —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞\n      const calculationStartTime = performance.now();\n      const calculationPromises = enabledCompaniesList.map(async (company, index) => {\n        const companyStartTime = performance.now();\n        \n        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ \"loading\"\n        setCalculationProgress(prev => ({\n          ...prev,\n          companies: prev.companies.map((c, i) => \n            i === index ? { ...c, status: 'loading', progress: 0 } : c\n          )\n        }));\n        \n        try {\n          const result = await optimizedApiClient.calculateWithCache(\n            company.key,\n            company.func,\n            form\n          );\n          \n          const duration = performance.now() - companyStartTime;\n          \n          // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ \"completed\"\n          setCalculationProgress(prev => ({\n            ...prev,\n            companies: prev.companies.map((c, i) => \n              i === index ? { \n                ...c, \n                status: 'completed', \n                progress: 100, \n                duration \n              } : c\n            )\n          }));\n          \n          return result;\n        } catch (error) {\n          const duration = performance.now() - companyStartTime;\n          const errorMessage = error instanceof Error ? error.message : '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞';\n          \n          // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ \"error\"\n          setCalculationProgress(prev => ({\n            ...prev,\n            companies: prev.companies.map((c, i) => \n              i === index ? { \n                ...c, \n                status: 'error', \n                error: errorMessage,\n                duration \n              } : c\n            )\n          }));\n          \n          console.error(`‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ ${company.name}:`, error);\n          return {\n            company: company.name,\n            price: 0,\n            days: 0,\n            error: errorMessage,\n            duration\n          };\n        }\n      });\n      \n      const results = await Promise.allSettled(calculationPromises);\n      const calculationDuration = performance.now() - calculationStartTime;\n      \n      // 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤\n      const validResults: CalculationResult[] = [];\n      const errors: string[] = [];\n      \n      results.forEach((result, index) => {\n        if (result.status === 'fulfilled') {\n          validResults.push(result.value);\n        } else {\n          const companyName = enabledCompaniesList[index].name;\n          errors.push(`${companyName}: ${result.reason}`);\n          console.error(`‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ ${companyName}:`, result.reason);\n        }\n      });\n      \n      // 5. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤\n      const sortedResults = validResults\n        .filter(result => !result.error)\n        .sort((a, b) => a.price - b.price)\n        .concat(validResults.filter(result => result.error));\n      \n      // 6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n      const totalDuration = performance.now() - totalStartTime;\n      const successCount = sortedResults.filter(r => !r.error).length;\n      const cacheStats = cacheManager.getCacheStats();\n      \n      console.log(`‚úÖ === –†–ê–°–ß–ï–¢ –ó–ê–í–ï–†–®–ï–ù ===`);\n      console.log(`‚è±Ô∏è –û–±—â–µ–µ –≤—Ä–µ–º—è: ${totalDuration.toFixed(0)}–º—Å`);\n      console.log(`‚ö° –†–∞—Å—á–µ—Ç—ã: ${calculationDuration.toFixed(0)}–º—Å`);\n      console.log(`üìä –£—Å–ø–µ—à–Ω–æ: ${successCount}/${enabledCompaniesList.length}`);\n      console.log(`üíæ –ö—ç—à: —Å–µ—Å—Å–∏–π=${cacheStats.sessions}, —Ä–∞—Å—á–µ—Ç–æ–≤=${cacheStats.calculations}`);\n      \n      if (errors.length > 0) {\n        console.warn(`‚ö†Ô∏è –û—à–∏–±–∫–∏: ${errors.join('; ')}`);\n      }\n      \n      // –§–∏–Ω–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞\n      setCalculationProgress(prev => ({\n        ...prev,\n        totalDuration: totalDuration\n      }));\n      \n      setCalculations(sortedResults);\n      \n    } catch (error) {\n      console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ:', error);\n      setCalculations([{\n        company: '–°–∏—Å—Ç–µ–º–∞',\n        price: 0,\n        days: 0,\n        error: error instanceof Error ? error.message : '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞'\n      }]);\n    } finally {\n      setCalculating(false);\n    }\n  };\n\n  const exportToPDF = () => {\n    if (typeof window !== 'undefined') {\n      // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Å–µ –¥–µ—Ç–∞–ª–∏ –ø–µ—Ä–µ–¥ –ø–µ—á–∞—Ç—å—é\n      const allExpanded = calculations.reduce((acc, calc) => {\n        acc[calc.company] = true;\n        return acc;\n      }, {} as { [key: string]: boolean });\n      \n      setExpandedDetails(allExpanded);\n      \n      // –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DOM\n      setTimeout(() => {\n        window.print();\n      }, 100);\n    }\n  };\n\n  const toggleDetails = (company: string) => {\n    setExpandedDetails(prev => ({\n      ...prev,\n      [company]: !prev[company]\n    }));\n  };\n\n  const toggleDebugInfo = (company: string) => {\n    setExpandedDebugInfo(prev => ({\n      ...prev,\n      [company]: !prev[company]\n    }));\n  };\n\n  // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞—Å—á–µ—Ç–∞\n  const handleReset = () => {\n    if (typeof window !== 'undefined') {\n      // –û—á–∏—â–∞–µ–º localStorage\n      localStorage.removeItem('deliveryForm');\n      \n      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É\n      setForm(initialFormState);\n      \n      // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è\n      setCalculations([]);\n      setExpandedDetails({});\n      setExpandedDebugInfo({});\n      setSuggestions([]);\n      setShowSuggestions(false);\n      setActiveField('');\n      \n      console.log('–§–æ—Ä–º–∞ —Å–±—Ä–æ—à–µ–Ω–∞ –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é');\n    }\n  };\n\n  // –ü–∞—Ä—Å–µ—Ä –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è —á–∏—Ç–∞–µ–º–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞\n  const parseCalculationDetails = (calc: CalculationResult) => {\n    console.log('üîç parseCalculationDetails –ø–æ–ª—É—á–∏–ª calc:', calc?.company || 'undefined');\n    console.log('üîç calc.details:', calc?.details ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n    console.log('üîç typeof calc.details:', typeof calc?.details);\n    \n    const details: { service: string; description: string; price: number }[] = [];\n    \n    try {\n      if (calc.company === '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏' && calc.details) {\n        console.log('üîç –ù–∞—á–∏–Ω–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–µ—Ç–∞–ª–µ–π –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π...');\n      // –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ (—É–∂–µ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –±–∞–∑–æ–≤—ã–µ —É—Å–ª—É–≥–∏ –∏ —É–ø–∞–∫–æ–≤–∫—É)\n      let basePrice = calc.details?.price || calc.price || 0;\n      \n      // –†–∞–∑–±–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ\n      let intercityPrice = 0;\n      let derivalPrice = 0;\n      let arrivalPrice = 0;\n      let packagingPrice = 0;\n      // packagingPremiums –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è - –Ω–∞–¥–±–∞–≤–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ pkg.price\n      let insurancePrice = 0;\n      \n      // –ú–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞\n      if (calc.details?.intercity?.price) {\n        intercityPrice = calc.details.intercity.price;\n        details.push({\n          service: '–ú–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞',\n          description: `${form.fromCity} - ${form.toCity}`,\n          price: intercityPrice\n        });\n      }\n      \n      // –ó–∞–±–æ—Ä –≥—Ä—É–∑–∞\n      if (calc.details?.derival?.price) {\n        derivalPrice = calc.details.derival.price;\n        details.push({\n          service: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n          description: '–û—Ç –∞–¥—Ä–µ—Å–∞',\n          price: derivalPrice\n        });\n      }\n      \n      // –î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞\n      if (calc.details?.arrival?.price) {\n        arrivalPrice = calc.details.arrival.price;\n        details.push({\n          service: '–û—Ç–≤–æ–∑ –≥—Ä—É–∑–∞',\n          description: '–î–æ –∞–¥—Ä–µ—Å–∞',\n          price: arrivalPrice\n        });\n      }\n      \n      // –£–ø–∞–∫–æ–≤–∫–∞ (–Ω–∞–¥–±–∞–≤–∫–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ pkg.price, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏)\n      if (form.needPackaging && calc.details?.packages) {\n        Object.entries(calc.details?.packages || {}).forEach(([key, pkg]: [string, any]) => {\n          if (pkg.price && pkg.price > 0) {\n            // –í—ã—á–∏—Å–ª—è–µ–º –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É —É–ø–∞–∫–æ–≤–∫–∏ (–±–µ–∑ –Ω–∞–¥–±–∞–≤–æ–∫) –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n            let basePkgPrice = pkg.price;\n            let totalPremiums = 0;\n            \n            if (pkg.premiumDetails && Array.isArray(pkg.premiumDetails)) {\n              totalPremiums = pkg.premiumDetails.reduce((sum: number, premium: any) => \n                sum + (premium.value || 0), 0);\n              basePkgPrice = pkg.price - totalPremiums;\n            }\n            \n            packagingPrice += pkg.price; // –í –æ–±—â—É—é —Å—É–º–º—É –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–Ω—É—é —Ü–µ–Ω—É\n            \n            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—É—é —É–ø–∞–∫–æ–≤–∫—É\n            details.push({\n              service: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n              description: '–£–ø–∞–∫–æ–≤–∞—Ç—å –≤ –∫–æ–º–ø–ª–µ–∫—Å ¬´–æ–±—Ä–µ—à—ë—Ç–∫–∞ + –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è¬ª',\n              price: basePkgPrice\n            });\n            \n            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–¥–±–∞–≤–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ (–¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏, –Ω–æ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –∫ –æ–±—â–µ–π —Å—É–º–º–µ)\n            if (pkg.premiumDetails && Array.isArray(pkg.premiumDetails)) {\n              pkg.premiumDetails.forEach((premium: any) => {\n                if (premium.value && premium.value > 0) {\n                  details.push({\n                    service: '–ù–∞–¥–±–∞–≤–∫–∞ –∫ —É–ø–∞–∫–æ–≤–∫–µ',\n                    description: premium.name || '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–¥–±–∞–≤–∫–∞',\n                    price: premium.value\n                  });\n                }\n              });\n            }\n          }\n        });\n      }\n      \n      // –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ\n      if (form.needInsurance && calc.details?.insurance) {\n        insurancePrice = calc.details.insurance;\n        details.push({\n          service: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n          description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n          price: insurancePrice\n        });\n      }\n      \n      // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏\n      details.push({\n        service: '–î–æ–ø.—É—Å–ª—É–≥–∏',\n        description: '–ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ –≥—Ä—É–∑–∞',\n        price: 15\n      });\n      \n      // –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –º–µ–∂–¥—É —Å—É–º–º–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é, –¥–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞—Ç–æ–∫\n      const calculatedSum = intercityPrice + derivalPrice + arrivalPrice + packagingPrice + insurancePrice + 15;\n      const remainder = basePrice - calculatedSum;\n      \n      if (Math.abs(remainder) > 1) { // –ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –±–æ–ª—å—à–µ 1 —Ä—É–±–ª—è\n        details.push({\n          service: remainder > 0 ? '–ü—Ä–æ—á–∏–µ —É—Å–ª—É–≥–∏' : '–°–∫–∏–¥–∫–∞',\n          description: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–±–æ—Ä—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏',\n          price: remainder\n        });\n      }\n     } else if (calc.company === 'Nord Wheel' && calc.details) {\n       // –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –¥–ª—è Nord Wheel —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º\n       if (calc.details.totalCost) {\n         details.push({\n           service: '–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',\n           description: calc.details.transportType ? `–¢–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞: ${calc.details.transportType}` : '',\n           price: calc.details.totalCost\n         });\n       }\n       \n       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ª—É–≥–∏ –∏–∑ –æ—Ç–≤–µ—Ç–∞ API\n       if (calc.details.services && Array.isArray(calc.details.services)) {\n         calc.details.services.forEach((service: any) => {\n           if (service.name && service.price) {\n             details.push({\n               service: service.name,\n               description: service.description || '',\n               price: service.price\n             });\n           }\n         });\n       }\n       \n       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n       if (calc.details.allOptions && Array.isArray(calc.details.allOptions)) {\n         details.push({\n           service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n           description: '',\n           price: 0\n         });\n         details.push({\n           service: '–î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã',\n           description: `–í—ã–±—Ä–∞–Ω: ${calc.details.transportType}`,\n           price: 0\n         });\n         \n         calc.details.allOptions.forEach((option: any) => {\n           details.push({\n             service: `–í–∞—Ä–∏–∞–Ω—Ç ${option.type}`,\n             description: `${option.days} –¥–Ω–µ–π`,\n             price: option.price\n           });\n         });\n       }\n\n    } else if (calc.company === '–ü–≠–ö' && calc.details?.services) {\n      // –î–ª—è –ü–≠–ö –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ API\n      calc.details.services.forEach((service: any) => {\n        if (service.price > 0) {\n          details.push({\n            service: service.name || '–£—Å–ª—É–≥–∞ –ü–≠–ö',\n            description: service.description || '',\n            price: service.price\n          });\n        }\n      });\n    } else if (calc.company === '–°–î–≠–ö' && calc.details) {\n      const cdekServiceNames: Record<string, string> = {\n        'INSURANCE': '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n        'HEAVY_CARGO': '–¢—è–∂–µ–ª–æ–≤–µ—Å–Ω—ã–π –≥—Ä—É–∑',\n        'DELIVERY_TO_DOOR': '–î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –¥–≤–µ—Ä–∏',\n        'PICKUP_FROM_SENDER': '–ó–∞–±–æ—Ä –æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è',\n        'PACKAGE': '–£–ø–∞–∫–æ–≤–∫–∞',\n        'TRYING_ON': '–ü—Ä–∏–º–µ—Ä–∫–∞ –Ω–∞ –¥–æ–º—É',\n        'PART_DELIVERY': '–ß–∞—Å—Ç–∏—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞'\n      };\n\n      if (calc.details.services && calc.details.services.length > 0) {\n        calc.details.services.forEach((service: any) => {\n          const serviceName = cdekServiceNames[service.code] || service.code || '–£—Å–ª—É–≥–∞ –°–î–≠–ö';\n          const servicePrice = service.total_sum || service.sum || 0;\n          \n          if (servicePrice > 0) {\n            details.push({\n              service: serviceName,\n              description: service.code === 'HEAVY_CARGO' \n                ? `–°–±–æ—Ä –∑–∞ –≥–∞–±–∞—Ä–∏—Ç–Ω—ã–π –≥—Ä—É–∑ (—Ä–∞—Å—á–µ—Ç–Ω—ã–π –≤–µ—Å: ${(calc.details.weight_calc / 1000).toFixed(0)} –∫–≥)`\n                : service.code === 'INSURANCE'\n                ? `–û–±—ä—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${form.declaredValue?.toLocaleString() || 0} ‚ÇΩ`\n                : '',\n              price: servicePrice\n            });\n          }\n        });\n        \n        if (calc.details.delivery_sum && calc.details.total_sum) {\n          details.push({\n            service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n            description: '',\n            price: 0\n          });\n          details.push({\n            service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',\n            description: calc.details.tariff_name || '–ü–µ—Ä–µ–≤–æ–∑–∫–∞',\n            price: Math.round(calc.details.delivery_sum)\n          });\n          \n          const additionalSum = calc.details.services.reduce((sum: number, s: any) => \n            sum + (s.total_sum || s.sum || 0), 0\n          );\n          \n          if (additionalSum > 0) {\n            details.push({\n              service: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏',\n              description: '–î–æ–ø. —Å–±–æ—Ä—ã',\n              price: Math.round(additionalSum)\n            });\n          }\n          \n          details.push({\n            service: '–ò–¢–û–ì–û',\n            description: '–ö –æ–ø–ª–∞—Ç–µ',\n            price: Math.round(calc.details.total_sum)\n          });\n        }\n      } else {\n        details.push({\n          service: '–¢–∞—Ä–∏—Ñ',\n          description: calc.details.tariff_name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n          price: calc.price\n        });\n        \n        if (calc.details.delivery_mode) {\n          details.push({\n            service: '–†–µ–∂–∏–º –¥–æ—Å—Ç–∞–≤–∫–∏',\n            description: calc.details.delivery_mode,\n            price: 0\n          });\n        }\n      }\n      \n      if (calc.details.period_min && calc.details.period_max) {\n        details.push({\n          service: '–°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏',\n          description: `${calc.details.period_min}-${calc.details.period_max} –¥–Ω–µ–π`,\n          price: 0\n        });\n      }\n      \n      if (calc.details.weight_calc) {\n        details.push({\n          service: '–†–∞—Å—á–µ—Ç–Ω—ã–π –≤–µ—Å',\n          description: `${calc.details.weight_calc} –∫–≥`,\n          price: 0\n        });\n      }\n    } else if (calc.company === '–í–æ–∑–æ–≤–æ–∑' && calc.details?.service) {\n      // ‚úÖ –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –í–æ–∑–æ–≤–æ–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ API –æ—Ç–≤–µ—Ç–∞\n      const basePrice = calc.details.basePrice || 0;\n      const finalPrice = calc.details.price || calc.price || 0;\n      const totalDiscount = basePrice - finalPrice;\n      \n      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é —É—Å–ª—É–≥—É —Å –±–∞–∑–æ–≤–æ–π —Ü–µ–Ω–æ–π –∏ —Å–∫–∏–¥–∫–æ–π\n      calc.details.service.forEach((service: any) => {\n        const serviceDiscount = (service.basePrice || 0) - (service.price || 0);\n        \n        // –û—Å–Ω–æ–≤–Ω–∞—è —É—Å–ª—É–≥–∞\n        details.push({\n          service: service.name || '–£—Å–ª—É–≥–∞ –í–æ–∑–æ–≤–æ–∑',\n          description: '',\n          price: service.price || 0\n        });\n        \n        // –°–∫–∏–¥–∫–∞ –Ω–∞ —É—Å–ª—É–≥—É (–µ—Å–ª–∏ –µ—Å—Ç—å)\n        if (serviceDiscount > 0) {\n          details.push({\n            service: `–°–∫–∏–¥–∫–∞ –Ω–∞ ${service.name?.toLowerCase() || '—É—Å–ª—É–≥—É'}`,\n            description: `${(service.basePrice || 0).toLocaleString()} - ${(service.price || 0).toLocaleString()}`,\n            price: -serviceDiscount\n          });\n        }\n      });\n      \n      // –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Å –æ–±—â–∏–º–∏ —Å–∫–∏–¥–∫–∞–º–∏\n      if (totalDiscount > 0) {\n        details.push({\n          service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n          description: '',\n          price: 0\n        });\n        details.push({\n          service: '–ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å',\n          description: '–î–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–∫–∏–¥–æ–∫',\n          price: basePrice\n        });\n        details.push({\n          service: '–û–±—â–∏–µ —Å–∫–∏–¥–∫–∏',\n          description: `–≠–∫–æ–Ω–æ–º–∏—è ${totalDiscount.toLocaleString()} ‚ÇΩ`,\n          price: -totalDiscount\n        });\n        details.push({\n          service: '–ò–¢–û–ì–û',\n          description: '–ö –æ–ø–ª–∞—Ç–µ',\n          price: finalPrice\n        });\n      }\n    } else if (calc.company === '–ö–ò–¢' && calc.details?.services) {\n      calc.details.services.forEach((service: any) => {\n        details.push({\n          service: service.name || '–£—Å–ª—É–≥–∞ –ö–ò–¢',\n          description: service.code || '',\n          price: service.price || 0\n        });\n      });\n      \n      if (calc.details.tariff_name) {\n        details.push({\n          service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n          description: '',\n          price: 0\n        });\n        details.push({\n          service: '–¢–∞—Ä–∏—Ñ',\n          description: calc.details.tariff_name,\n          price: 0\n        });\n        details.push({\n          service: '–ò–¢–û–ì–û',\n          description: calc.details.currency || 'RUB',\n          price: calc.price\n        });\n      }\n    } else {\n      // –î–ª—è –¥—Ä—É–≥–∏—Ö –¢–ö - –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n      details.push({\n        service: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n        description: `${form.fromCity} - ${form.toCity}`,\n        price: calc.price\n      });\n      \n      if (form.needInsurance && form.declaredValue > 0) {\n        details.push({\n          service: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ',\n          description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n          price: Math.round(form.declaredValue * 0.02)\n        });\n      }\n      \n      if (form.needPackaging) {\n        const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n        details.push({\n          service: '–£–ø–∞–∫–æ–≤–∫–∞',\n          description: '',\n          price: Math.round(totalWeight * 30)\n        });\n      }\n    }\n    \n    return details;\n  } catch (globalError) {\n    console.error('‚ùå –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –û–®–ò–ë–ö–ê –≤ parseCalculationDetails:', globalError);\n    console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', globalError instanceof Error ? globalError.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n    console.log('‚ùå calc object:', calc);\n    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ\n    return [{\n      service: '–î–æ—Å—Ç–∞–≤–∫–∞',\n      description: '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞',\n      price: calc?.price || 0\n    }];\n  }\n};\n\n  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –ø–æ–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏)\n  if (!isLoaded) {\n    return (\n      <div className=\"min-h-screen bg-gray-900 text-white p-4 relative flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400 mx-auto mb-4\"></div>\n          <p className=\"text-blue-400\">–ó–∞–≥—Ä—É–∑–∫–∞...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-900 text-white p-4 relative\">\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <h1 className=\"text-xl font-bold text-blue-400\">\n            –ú–µ–∂–¥—É–≥–æ—Ä–æ–¥–Ω—è—è –¥–æ—Å—Ç–∞–≤–∫–∞ –õ–∞–≤—Å–∏—Ç\n          </h1>\n          \n          {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è */}\n          <div className=\"flex items-center gap-4\">\n            {isFormChanged ? (\n              <div className=\"flex items-center gap-2 text-yellow-400 text-sm\">\n                <div className=\"w-2 h-2 bg-yellow-400 rounded-full animate-pulse\"></div>\n                –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...\n              </div>\n            ) : lastSaveTime ? (\n              <div className=\"flex items-center gap-2 text-green-400 text-sm\">\n                <div className=\"w-2 h-2 bg-green-400 rounded-full\"></div>\n                –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ {lastSaveTime.toLocaleTimeString()}\n              </div>\n            ) : hasStoredFormData() ? (\n              <div className=\"flex items-center gap-2 text-blue-400 text-sm\">\n                <div className=\"w-2 h-2 bg-blue-400 rounded-full\"></div>\n                –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã\n              </div>\n            ) : null}\n            \n            {/* –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–µ—Ä–≤–∏—Å–Ω–æ–µ –º–µ–Ω—é –≤–∏–¥–∏–º–æ */}\n            {hasStoredFormData() && isServiceMenuVisible && (\n              <Button\n                onClick={() => {\n                  if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã?')) {\n                    clearFormData();\n                    setForm(initialFormState);\n                    setLastSaveTime(null);\n                    setIsFormChanged(false);\n                  }\n                }}\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"border-red-500 text-red-400 hover:bg-red-900/20\"\n              >\n                <Trash2 className=\"h-3 w-3 mr-1\" />\n                –û—á–∏—Å—Ç–∏—Ç—å\n              </Button>\n            )}\n          </div>\n        </div>\n        \n        {/* –ö–Ω–æ–ø–∫–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ */}\n        <div className=\"flex justify-end gap-2 mb-4\">\n          {/* –ö–Ω–æ–ø–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–Ω—ã–º –º–µ–Ω—é */}\n          <Button \n            onClick={() => setIsServiceMenuVisible(!isServiceMenuVisible)}\n            variant=\"outline\" \n            className=\"border-yellow-500 text-yellow-400 hover:bg-yellow-900/20\"\n          >\n            {isServiceMenuVisible ? (\n              <>\n                <EyeOff className=\"h-4 w-4 mr-2\" />\n                –°–∫—Ä—ã—Ç—å —Å–µ—Ä–≤–∏—Å–Ω–æ–µ –º–µ–Ω—é\n              </>\n            ) : (\n              <>\n                <Eye className=\"h-4 w-4 mr-2\" />\n                –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ—Ä–≤–∏—Å–Ω–æ–µ –º–µ–Ω—é\n              </>\n            )}\n          </Button>\n\n          {/* –°–µ—Ä–≤–∏—Å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ - –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –º–µ–Ω—é –≤–∏–¥–∏–º–æ */}\n          {isServiceMenuVisible && (\n            <>\n              <Button \n                onClick={() => window.open('/diagnostic?tab=api', '_blank')}\n                variant=\"outline\" \n                className=\"border-green-500 text-green-400 hover:bg-green-900/20\"\n              >\n                <Settings className=\"h-4 w-4 mr-2\" />\n                –í—Å–µ API\n              </Button>\n              <Button \n                onClick={() => window.open('/diagnostic?tab=docs', '_blank')}\n                variant=\"outline\" \n                className=\"border-purple-500 text-purple-400 hover:bg-purple-900/20\"\n              >\n                <Package2 className=\"h-4 w-4 mr-2\" />\n                –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è\n              </Button>\n              <Button \n                onClick={() => window.open('/diagnostic', '_blank')}\n                variant=\"outline\" \n                className=\"border-blue-500 text-blue-400 hover:bg-blue-900/20\"\n              >\n                <Settings className=\"h-4 w-4 mr-2\" />\n                –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞\n              </Button>\n            </>\n          )}\n        </div>\n        \n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-3 h-[85vh]\">\n          {/* –õ–µ–≤–∞—è —á–∞—Å—Ç—å - —Ñ–æ—Ä–º–∞ */}\n          <div className=\"space-y-2 overflow-y-auto pr-2\">\n            {/* –ö–∞—Ç–∞–ª–æ–≥ –º–µ–±–µ–ª–∏ */}\n            <Card className=\"bg-gray-800 border-gray-700\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n                  <Package2 className=\"h-3 w-3\" />\n                  –ö–∞—Ç–∞–ª–æ–≥ –º–µ–±–µ–ª–∏\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-2\">\n                {/* –ü–æ–∏—Å–∫ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ */}\n                <LazyProductSearch \n                  onProductAdd={handleProductAdd}\n                  disabled={calculating}\n                />\n                \n                {/* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏ */}\n                <ProductManager\n                  products={form.selectedProducts}\n                  onQuantityChange={handleProductQuantityChange}\n                  onProductRemove={handleProductRemove}\n                  disabled={calculating}\n                />\n              </CardContent>\n            </Card>\n\n            {/* –ì—Ä—É–∑—ã */}\n            <Card className=\"bg-gray-800 border-gray-700\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n                  <Truck className=\"h-3 w-3\" />\n                  –ì—Ä—É–∑—ã\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-2\">\n                {groupCargosForDisplay(form.cargos).map((group, groupIndex) => (\n                   <div key={`group_${groupIndex}`} className=\"border border-gray-600 rounded p-2\">\n                    <div className=\"flex justify-between items-center mb-2\">\n                      <h4 className=\"text-sm font-medium text-white\">\n                        {group.isEmpty ? (\n                          `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1}`\n                        ) : group.quantity === 1 ? (\n                          `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1}`\n                        ) : (\n                          `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1} - ${group.quantity} –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –º–µ—Å—Ç–∞`\n                        )}\n                      </h4>\n                      {form.cargos.length > 1 && group.quantity === 1 && (\n                        <Button\n                          variant=\"destructive\"\n                          size=\"sm\"\n                          onClick={() => removeCargo(form.cargos[group.indices[0]].id)}\n                          className=\"h-6 text-xs\"\n                        >\n                          –£–¥–∞–ª–∏—Ç—å\n                        </Button>\n                      )}\n                      {group.quantity > 1 && (\n                        <Badge variant=\"secondary\" className=\"text-xs\">\n                          {group.quantity} —à—Ç.\n                        </Badge>\n                      )}\n                    </div>\n                    \n                    {group.isEmpty || group.quantity === 1 ? (\n                      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞ –¥–ª—è –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ –∏–ª–∏ –µ–¥–∏–Ω–∏—á–Ω—ã—Ö\n                      <div className=\"grid grid-cols-2 gap-2\">\n                        <div>\n                          <Label className=\"text-white text-xs\">–î–ª–∏–Ω–∞ (—Å–º)</Label>\n                          <Input\n                            type=\"number\"\n                            value={form.cargos[group.indices[0]].length || ''}\n                            onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'length', Number(e.target.value))}\n                            className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n                          />\n                        </div>\n                        <div>\n                          <Label className=\"text-white text-xs\">–®–∏—Ä–∏–Ω–∞ (—Å–º)</Label>\n                          <Input\n                            type=\"number\"\n                            value={form.cargos[group.indices[0]].width || ''}\n                            onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'width', Number(e.target.value))}\n                            className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n                          />\n                        </div>\n                        <div>\n                          <Label className=\"text-white text-xs\">–í—ã—Å–æ—Ç–∞ (—Å–º)</Label>\n                          <Input\n                            type=\"number\"\n                            value={form.cargos[group.indices[0]].height || ''}\n                            onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'height', Number(e.target.value))}\n                            className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n                          />\n                        </div>\n                        <div>\n                          <Label className=\"text-white text-xs\">–í–µ—Å (–∫–≥)</Label>\n                          <Input\n                            type=\"number\"\n                            value={form.cargos[group.indices[0]].weight || ''}\n                            onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'weight', Number(e.target.value))}\n                            className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n                          />\n                        </div>\n                      </div>\n                    ) : (\n                      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –≥—Ä—É–ø–ø\n                      <div className=\"grid grid-cols-2 gap-2 text-sm text-gray-300\">\n                        <div>–î–ª–∏–Ω–∞: {group.length} —Å–º</div>\n                        <div>–®–∏—Ä–∏–Ω–∞: {group.width} —Å–º</div>\n                        <div>–í—ã—Å–æ—Ç–∞: {group.height} —Å–º</div>\n                        <div>–í–µ—Å: {group.weight} –∫–≥</div>\n                        <div className=\"col-span-2 text-xs text-blue-300 mt-1\">\n                          –û–±—â–∏–π –≤–µ—Å: {(group.weight * group.quantity).toFixed(1)} –∫–≥, \n                          –æ–±—ä–µ–º: {((group.length * group.width * group.height * group.quantity) / 1000000).toFixed(3)} –º¬≥\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                ))}\n                 <Button onClick={addCargo} className=\"w-full h-7 text-xs\" variant=\"outline\">\n                  <Plus className=\"h-3 w-3 mr-1\" />\n                  –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–∑\n                </Button>\n              </CardContent>\n            </Card>\n\n            {/* –ú–∞—Ä—à—Ä—É—Ç */}\n            <Card className=\"bg-gray-800 border-gray-700\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n                  <Map className=\"h-3 w-3\" />\n                  –ú–∞—Ä—à—Ä—É—Ç\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-2\">\n                {/* –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */}\n                <div className=\"space-y-2\">\n                  <Label className=\"text-sm font-medium text-white\">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</Label>\n                  <div className=\"flex gap-3 flex-wrap\">\n                    <label className=\"flex items-center space-x-1\">\n                      <input\n                        type=\"radio\"\n                        name=\"fromDelivery\"\n                        checked={form.fromTerminal}\n                        onChange={() => setForm(prev => ({ ...prev, fromTerminal: true, fromAddressDelivery: false, fromLavsiteWarehouse: false }))}\n                      />\n                      <span className=\"text-white text-xs\">–û—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞</span>\n                    </label>\n                    <label className=\"flex items-center space-x-1\">\n                      <input\n                        type=\"radio\"\n                        name=\"fromDelivery\"\n                        checked={form.fromAddressDelivery && !form.fromLavsiteWarehouse}\n                        onChange={() => setForm(prev => ({ ...prev, fromTerminal: false, fromAddressDelivery: true, fromLavsiteWarehouse: false }))}\n                      />\n                      <span className=\"text-white text-xs\">–û—Ç –∞–¥—Ä–µ—Å–∞</span>\n                    </label>\n                    <label className=\"flex items-center space-x-1\">\n                      <Checkbox\n                        id=\"lavsiteWarehouse\"\n                        checked={form.fromLavsiteWarehouse}\n                        onCheckedChange={handleLavsiteWarehouseChange}\n                      />\n                      <span className=\"text-white text-xs cursor-pointer\">–°–æ —Å–∫–ª–∞–¥–∞ –õ–∞–≤—Å–∏—Ç</span>\n                    </label>\n                  </div>\n                  \n                  <div>\n                    <Label className=\"text-white text-xs\">–ì–æ—Ä–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</Label>\n                    <Input\n                      value={form.fromCity}\n                      onChange={(e) => !form.fromLavsiteWarehouse && handleAddressChange('fromCity', e.target.value, e.target)}\n                      placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –≥–æ—Ä–æ–¥\"\n                      disabled={form.fromLavsiteWarehouse}\n                      className={`bg-gray-700 border-gray-600 h-7 text-white text-xs ${form.fromLavsiteWarehouse ? 'opacity-50 cursor-not-allowed' : ''}`}\n                    />\n                  </div>\n                  \n                  {form.fromAddressDelivery && (\n                    <div>\n                      <Label className=\"text-white text-xs\">–ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</Label>\n                      <Input\n                        value={form.fromAddress}\n                        onChange={(e) => !form.fromLavsiteWarehouse && handleAddressChange('fromAddress', e.target.value, e.target)}\n                        placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å\"\n                        disabled={form.fromLavsiteWarehouse}\n                        className={`bg-gray-700 border-gray-600 h-7 text-white text-xs ${form.fromLavsiteWarehouse ? 'opacity-50 cursor-not-allowed' : ''}`}\n                      />\n                    </div>\n                  )}\n                </div>\n\n                {/* –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ */}\n                <div className=\"space-y-2\">\n                  <Label className=\"text-sm font-medium text-white\">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</Label>\n                  <div className=\"flex gap-3 flex-wrap\">\n                    <label className=\"flex items-center space-x-1\">\n                      <input\n                        type=\"radio\"\n                        name=\"toDelivery\"\n                        checked={form.toTerminal}\n                        onChange={() => setForm(prev => ({ ...prev, toTerminal: true, toAddressDelivery: false }))}\n                      />\n                      <span className=\"text-white text-xs\">–î–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞</span>\n                    </label>\n                    <label className=\"flex items-center space-x-1\">\n                      <input\n                        type=\"radio\"\n                        name=\"toDelivery\"\n                        checked={form.toAddressDelivery}\n                        onChange={() => setForm(prev => ({ ...prev, toTerminal: false, toAddressDelivery: true }))}\n                      />\n                      <span className=\"text-white text-xs\">–î–æ –∞–¥—Ä–µ—Å–∞</span>\n                    </label>\n                  </div>\n                  \n                  <div>\n                    <Label className=\"text-white text-xs\">–ì–æ—Ä–æ–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</Label>\n                    <Input\n                      value={form.toCity}\n                      onChange={(e) => handleAddressChange('toCity', e.target.value, e.target)}\n                      placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –≥–æ—Ä–æ–¥\"\n                      className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n                    />\n                  </div>\n                  \n                  {form.toAddressDelivery && (\n                    <div>\n                      <Label className=\"text-white text-xs\">–ê–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</Label>\n                      <Input\n                        value={form.toAddress}\n                        onChange={(e) => handleAddressChange('toAddress', e.target.value, e.target)}\n                        placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å\"\n                        className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n                      />\n                    </div>\n                  )}\n                </div>\n\n                <div>\n                  <Label className=\"text-white text-xs\">–û–±—ä—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (—Ä—É–±.)</Label>\n                  <Input\n                    type=\"number\"\n                    value={form.declaredValue || ''}\n                    onChange={(e) => setForm(prev => ({ ...prev, declaredValue: Number(e.target.value) }))}\n                    className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n                  />\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center space-x-2\">\n                    <Checkbox\n                      id=\"packaging\"\n                      checked={form.needPackaging}\n                      onCheckedChange={(checked) => setForm(prev => ({ ...prev, needPackaging: checked as boolean }))}\n                      className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n                    />\n                    <Label htmlFor=\"packaging\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è —É–ø–∞–∫–æ–≤–∫–∞</Label>\n                  </div>\n                  \n                  <div className=\"flex items-center space-x-2\">\n                    <Checkbox\n                      id=\"insurance\"\n                      checked={form.needInsurance}\n                      onCheckedChange={(checked) => setForm(prev => ({ ...prev, needInsurance: checked as boolean }))}\n                      className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n                    />\n                    <Label htmlFor=\"insurance\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞</Label>\n                  </div>\n                  \n                  <div className=\"flex items-center space-x-2\">\n                    <Checkbox\n                      id=\"loading\"\n                      checked={form.needLoading}\n                      onCheckedChange={(checked) => setForm(prev => ({ ...prev, needLoading: checked as boolean }))}\n                      className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n                    />\n                    <Label htmlFor=\"loading\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≥—Ä—É–∑–∫–∞/—Ä–∞–∑–≥—Ä—É–∑–∫–∞</Label>\n                  </div>\n                  \n                  <div className=\"flex items-center space-x-2\">\n                    <Checkbox\n                      id=\"carry\"\n                      checked={form.needCarry}\n                      onCheckedChange={(checked) => setForm(prev => ({ ...prev, needCarry: checked as boolean }))}\n                      className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n                    />\n                    <Label htmlFor=\"carry\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—ä–µ–º</Label>\n                  </div>\n                  \n                  {form.needCarry && (\n                    <div className=\"ml-6 space-y-2 border-l-2 border-gray-600 pl-3\">\n                      <div>\n                        <Label className=\"text-white text-xs\">–≠—Ç–∞–∂</Label>\n                        <Input\n                          type=\"number\"\n                          value={form.floor}\n                          onChange={(e) => setForm(prev => ({ ...prev, floor: Number(e.target.value) }))}\n                          className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n                        />\n                      </div>\n                      <div className=\"flex items-center space-x-2\">\n                        <Checkbox\n                          id=\"freightLift\"\n                          checked={form.hasFreightLift}\n                          onCheckedChange={(checked) => setForm(prev => ({ ...prev, hasFreightLift: checked as boolean }))}\n                        />\n                        <Label htmlFor=\"freightLift\" className=\"text-white text-xs\">–ù–∞–ª–∏—á–∏–µ –≥—Ä—É–∑–æ–≤–æ–≥–æ –ª–∏—Ñ—Ç–∞</Label>\n                      </div>\n                    </div>\n                  )}\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Button \n                    onClick={handleCalculate} \n                    className=\"w-full bg-blue-600 hover:bg-blue-700 h-7 text-xs\" \n                    disabled={calculating}\n                  >\n                    {calculating ? '–†–∞—Å—á–µ—Ç...' : '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å'}\n                  </Button>\n                  \n                  <Button \n                    onClick={handleReset} \n                    variant=\"outline\" \n                    className=\"w-full h-7 text-xs text-black border-gray-600 hover:bg-gray-700 hover:text-white\" \n                    disabled={calculating}\n                  >\n                    –°–±—Ä–æ—Å–∏—Ç—å —Ä–∞—Å—á–µ—Ç\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã */}\n          <div className=\"space-y-2 overflow-y-auto\">\n            {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Ä–∞—Å—á–µ—Ç–æ–≤ */}\n            <CalculationProgress \n              companies={calculationProgress.companies}\n              totalDuration={calculationProgress.totalDuration}\n              isVisible={calculating}\n            />\n            \n            {calculations.length > 0 && (\n                 <div className=\"space-y-2\">\n                <div className=\"flex justify-between items-center\">\n                  <h2 className=\"text-lg font-bold text-blue-400\">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞</h2>\n                  <div className=\"flex gap-2 flex-wrap\">\n                    <SaveCalculation \n                      formData={form}\n                      calculations={calculations}\n                      enabledCompanies={hiddenCompanies}\n                      onSave={(result) => {\n                        console.log('–†–∞—Å—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω:', result);\n                      }}\n                    />\n                    <CalculationHistory \n                      onLoadCalculation={(calculation) => {\n                        console.log('–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å—á–µ—Ç–∞:', calculation.orderNumber);\n                        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞\n                      }}\n                    />\n                  </div>\n                </div>\n                \n                {calculations\n                  .filter(calc => !hiddenCompanies[calc.company])\n                  .map((calc, index) => (\n                   <Card key={index} className=\"bg-gray-800 border-gray-700 text-xs\">\n                     <CardHeader className=\"pb-1\">\n                      <div className=\"flex justify-between items-center\">\n                         <CardTitle className=\"text-white flex items-center gap-2 text-xs\">\n                           <Building2 className=\"h-3 w-3\" />\n                          {calc.company}\n                        </CardTitle>\n                        {calc.error ? (\n                          <Badge variant=\"destructive\" className=\"text-xs\">–û—à–∏–±–∫–∞</Badge>\n                        ) : (\n                          <Badge variant=\"default\" className=\"bg-green-600 text-xs\">\n                            {calc.price.toLocaleString()} ‚ÇΩ\n                          </Badge>\n                        )}\n                      </div>\n                    </CardHeader>\n                    <CardContent className=\"pt-0\">\n                      <div className=\"space-y-2\">\n                        {calc.error ? (\n                          <div className=\"space-y-2\">\n                            <Alert className=\"border-red-600\">\n                              <AlertDescription className=\"text-white text-xs\">{calc.error}</AlertDescription>\n                            </Alert>\n                            {calc.price > 0 && (\n                              <>\n                                <p className=\"text-white text-xs\"><strong>–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {calc.price.toLocaleString()} ‚ÇΩ</p>\n                                <p className=\"text-white text-xs\"><strong>–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Å—Ä–æ–∫:</strong> {calc.days} –¥–Ω–µ–π</p>\n                              </>\n                            )}\n                          </div>\n                        ) : (\n                          <>\n                            <p className=\"text-white text-xs\"><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {calc.price.toLocaleString()} ‚ÇΩ</p>\n                            <p className=\"text-white text-xs\"><strong>–°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> {calc.days} –¥–Ω–µ–π</p>\n                          </>\n                        )}\n                        \n                        <div className=\"flex gap-2 mt-2 flex-wrap\">\n                          {!calc.error && (\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => toggleDetails(calc.company)}\n                              className=\"h-6 text-xs\"\n                            >\n                              {expandedDetails[calc.company] ? '–°–∫—Ä—ã—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ' : '–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ'}\n                            </Button>\n                          )}\n                          {/* –ö–Ω–æ–ø–∫–∞ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–µ—Ä–≤–∏—Å–Ω–æ–µ –º–µ–Ω—é –≤–∏–¥–∏–º–æ */}\n                          {isServiceMenuVisible && (\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => toggleDebugInfo(calc.company)}\n                              className=\"h-6 text-xs\"\n                            >\n                              {expandedDebugInfo[calc.company] ? '–°–∫—Ä—ã—Ç—å –æ—Ç–ª–∞–¥–∫—É' : '–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'}\n                            </Button>\n                          )}\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => {\n                              setHiddenCompanies(prev => ({\n                                ...prev,\n                                [calc.company]: true\n                              }));\n                            }}\n                            className=\"h-6 text-xs border-red-500 text-red-400 hover:bg-red-900/20\"\n                          >\n                            –°–∫—Ä—ã—Ç—å\n                          </Button>\n                        </div>\n                        \n                        {/* –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ */}\n                        {!calc.error && (\n                          <Collapsible open={expandedDetails[calc.company]}>\n                            <CollapsibleContent className=\"mt-2\">\n                              <div className=\"bg-gray-900 p-3 rounded text-xs\">\n                                <h4 className=\"font-bold mb-2 text-white\">–î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞:</h4>\n                                {(() => {\n                                  const details = parseCalculationDetails(calc);\n                                  const totalPrice = details.reduce((sum, detail) => sum + detail.price, 0);\n                                  \n                                  return (\n                                    <div className=\"space-y-1\">\n                                      {details.map((detail, idx) => (\n                                        <div key={idx} className=\"flex justify-between text-white\">\n                                          <div>\n                                            <div className=\"font-medium\">{detail.service}</div>\n                                            {detail.description && (\n                                              <div className=\"text-gray-400 text-xs\">{detail.description}</div>\n                                            )}\n                                          </div>\n                                          <div className=\"font-medium\">{detail.price.toLocaleString()} ‚ÇΩ</div>\n                                        </div>\n                                      ))}\n                                    </div>\n                                  );\n                                })()}\n                              </div>\n                            </CollapsibleContent>\n                          </Collapsible>\n                        )}\n                        \n                        {/* –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è - –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ */}\n                        <Collapsible open={expandedDebugInfo[calc.company]}>\n                          <CollapsibleContent className=\"mt-2\">\n                            <div className=\"bg-gray-900 p-3 rounded text-xs\">\n                              <h4 className=\"font-bold mb-2 text-white\">–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h4>\n                              \n                              {calc.apiUrl && (\n                                <div className=\"mb-3\">\n                                  <h5 className=\"font-bold mb-1 text-white\">–ó–∞–ø—Ä–æ—Å –∫ API:</h5>\n                                  <p className=\"text-gray-300 break-all text-xs\">URL: {calc.apiUrl}</p>\n                                </div>\n                              )}\n                              \n                              {calc.sessionId && (\n                                <div className=\"mb-3\">\n                                  <h5 className=\"font-bold mb-1 text-white\">Session ID:</h5>\n                                  <p className=\"text-gray-300 text-xs\">{calc.sessionId}</p>\n                                </div>\n                              )}\n                              \n                              {calc.requestData && (\n                                <div className=\"mb-3\">\n                                  <h5 className=\"font-bold mb-1 text-white\">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å:</h5>\n                                  <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n                                    {JSON.stringify(calc.requestData, null, 2)}\n                                  </pre>\n                                </div>\n                              )}\n                              \n                              {calc.responseData && (\n                                <div className=\"mb-3\">\n                                  <h5 className=\"font-bold mb-1 text-white\">–ü–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç:</h5>\n                                  <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n                                    {JSON.stringify(calc.responseData, null, 2)}\n                                  </pre>\n                                </div>\n                              )}\n                              \n                              {calc.details && (\n                                <div className=\"mb-3\">\n                                  <h5 className=\"font-bold mb-1 text-white\">–î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ (JSON):</h5>\n                                  <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n                                    {JSON.stringify(calc.details, null, 2)}\n                                  </pre>\n                                </div>\n                              )}\n                              \n                              {calc.error && (\n                                <div className=\"mb-3\">\n                                  <h5 className=\"font-bold mb-1 text-red-400\">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ:</h5>\n                                  <p className=\"text-red-300 text-xs\">{calc.error}</p>\n                                </div>\n                              )}\n                            </div>\n                          </CollapsibleContent>\n                        </Collapsible>\n                      </div>\n                    </CardContent>\n                  </Card>\n                 ))}\n                 \n                 {/* –ë–ª–æ–∫ –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–∫—Ä—ã—Ç—ã—Ö –¢–ö */}\n                 {Object.values(hiddenCompanies).some(hidden => hidden) && (\n                   <div className=\"mt-4 p-3 bg-gray-700 rounded border-gray-600\">\n                     <div className=\"flex items-center justify-between\">\n                       <div className=\"text-sm text-gray-300\">\n                         –°–∫—Ä—ã—Ç–æ –¢–ö: {Object.values(hiddenCompanies).filter(hidden => hidden).length}\n                       </div>\n                       <Button\n                         variant=\"outline\"\n                         size=\"sm\"\n                         onClick={() => setHiddenCompanies({})}\n                         className=\"h-6 text-xs border-green-500 text-green-400 hover:bg-green-900/20\"\n                       >\n                         –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–∫—Ä—ã—Ç—ã–µ\n                       </Button>\n                     </div>\n                   </div>\n                 )}\n               </div>\n            )}\n\n            {/* –°–ø–∏—Å–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –¢–ö - –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º—ã–π */}\n            <Card className=\"bg-gray-800 border-gray-700\">\n              <CardHeader className=\"pb-2\">\n                <div className=\"flex justify-between items-center\">\n                  <CardTitle className=\"text-white text-sm\">\n                    –ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ ({COMPANIES_BASE.filter(company => showHiddenCompanies || enabledCompanies[company.apiKey]).length}{showHiddenCompanies ? ` –∏–∑ ${COMPANIES_BASE.length}` : ''})\n                  </CardTitle>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setShowHiddenCompanies(prev => !prev)}\n                    className=\"h-6 text-xs border-blue-500 text-blue-400 hover:bg-blue-900/20\"\n                  >\n                    {showHiddenCompanies ? '–°–∫—Ä—ã—Ç—å –≤—Å–µ' : '–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ'}\n                  </Button>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  {COMPANIES_BASE\n                    .filter(company => showHiddenCompanies || enabledCompanies[company.apiKey])\n                    .map((company, index) => {\n                    const isConnected = apiStatus[company.apiKey as keyof typeof apiStatus] === '–ø–æ–¥–∫–ª—é—á–µ–Ω–æ';\n                    const statusText = apiStatus[company.apiKey as keyof typeof apiStatus];\n                    const isEnabled = enabledCompanies[company.apiKey];\n                    \n                    // –û—Ç–ª–∞–¥–∫–∞ –¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–æ–º–ø–∞–Ω–∏–π\n                    if (index < 3) {\n                      console.log(`üîç –ö–æ–º–ø–∞–Ω–∏—è ${index}: ${company.name}, apiKey: ${company.apiKey}, isEnabled: ${isEnabled}, statusText: ${statusText}`);\n                    }\n                    \n                    return (\n                      <div key={index} className=\"flex items-center justify-between p-1.5 bg-gray-700 rounded\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-lg\">{company.logo}</span>\n                          <div>\n                            <p className=\"font-medium text-white text-[10px] leading-tight\">{company.name}</p>\n                            <Badge \n                              variant={isConnected ? \"default\" : \"destructive\"} \n                              className=\"text-[9px] py-0 px-1\"\n                            >\n                              {isConnected ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–∞' : statusText === '–ø—Ä–æ–≤–µ—Ä–∫–∞...' ? '–ü—Ä–æ–≤–µ—Ä–∫–∞...' : '–û—à–∏–±–∫–∞'}\n                            </Badge>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-[9px] text-gray-300\">\n                            {isEnabled ? '–í–∫–ª' : '–í—ã–∫–ª'}\n                          </span>\n                          <Switch\n                            checked={isEnabled}\n                            onCheckedChange={(checked) => {\n                              setEnabledCompanies(prev => ({\n                                ...prev,\n                                [company.apiKey]: checked\n                              }));\n                            }}\n                          />\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫—É–∑–æ–≤–∞ */}\n            {calculations.length > 0 && (\n              <LazyTruckVisualization \n                cargos={form.cargos.map(cargo => ({\n                  id: cargo.id,\n                  length: cargo.length * 10, // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n                  width: cargo.width * 10,   // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n                  height: cargo.height * 10, // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n                  weight: cargo.weight,\n                  productName: form.selectedProducts?.find(p => \n                    p.cargoIndexes.includes(form.cargos.indexOf(cargo))\n                  )?.product.name\n                }))}\n                isVisible={true}\n              />\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* –ê–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–∫–∏ */}\n      {showSuggestions && suggestions.length > 0 && (\n        <div \n          className=\"fixed z-50 bg-gray-800 border border-gray-700 rounded-md shadow-lg max-w-sm w-full max-h-60 overflow-y-auto\"\n          style={{\n            top: suggestionPosition.top,\n            left: suggestionPosition.left\n          }}\n        >\n          <div className=\"p-1\">\n            {suggestions.map((suggestion, index) => (\n              <div\n                key={index}\n                className=\"p-2 hover:bg-gray-700 cursor-pointer text-xs text-white rounded transition-colors\"\n                onClick={() => selectSuggestion(suggestion)}\n              >\n                {suggestion.value}\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}",
        "after": "'use client';\n\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Switch } from '@/components/ui/switch';\nimport { Plus, Truck, Building2, Map, Settings, Package2, Trash2, Loader2, Eye, EyeOff } from 'lucide-react';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { Collapsible, CollapsibleContent } from '@/components/ui/collapsible';\nimport { LazyProductSearch, LazyTruckVisualization } from '@/components/LazyLoadedComponents';\nimport ProductManager from '@/components/ProductManager';\nimport CalculationProgress from '@/components/CalculationProgress';\nimport { FurnitureProduct, ProductInForm, CargoWithMetadata } from '@/lib/furniture-types';\nimport { saveFormData, loadFormData, hasStoredFormData, createDebouncedSaver, clearFormData } from '@/lib/form-storage';\nimport {\n  createCargosForProduct,\n  removeCargosForProduct,\n  calculateTotalValue,\n  findCargoIndexesForProduct\n} from '@/lib/furniture-utils';\nimport { enhancedApiRequest } from '@/lib/api-utils';\nimport { cacheManager } from '@/lib/cache-manager';\nimport { optimizedApiClient } from '@/lib/optimized-api-client';\nimport SaveCalculation from '@/components/SaveCalculation';\nimport CalculationHistory from '@/components/CalculationHistory';\n\ninterface Cargo {\n  id: string;\n  length: number;\n  width: number;\n  height: number;\n  weight: number;\n  // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–≤—è–∑–∏ —Å —Ç–æ–≤–∞—Ä–∞–º–∏\n  productId?: string;\n  placeNumber?: number;\n  isFromProduct?: boolean;\n  addedAt?: number;\n}\n\ninterface DeliveryForm {\n  cargos: Cargo[];\n  fromCity: string;\n  toCity: string;\n  fromAddress: string;\n  toAddress: string;\n  declaredValue: number;\n  needPackaging: boolean;\n  needLoading: boolean;\n  needCarry: boolean;\n  floor: number;\n  hasFreightLift: boolean;\n  needInsurance: boolean;\n  fromTerminal: boolean;\n  toTerminal: boolean;\n  fromAddressDelivery: boolean;\n  toAddressDelivery: boolean;\n  fromLavsiteWarehouse: boolean;\n  // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ç–æ–≤–∞—Ä–æ–≤\n  selectedProducts: ProductInForm[];\n}\n\ninterface CalculationResult {\n  company: string;\n  price: number;\n  days: number;\n  details?: any;\n  error?: string;\n  requestData?: any;\n  responseData?: any;\n  apiUrl?: string;\n  sessionId?: string;\n}\n\ninterface AddressSuggestion {\n  value: string;\n  unrestricted_value: string;\n  data: {\n    city?: string;\n    street?: string;\n    house?: string;\n  };\n}\n\n// –û–ø—Ä–µ–¥–µ–ª–∏–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–º–ø–∞–Ω–∏–π\nconst COMPANIES_BASE = [\n  { name: '–ü–≠–ö', logo: 'üöõ', apiKey: 'pek' },\n  { name: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏', logo: 'üì¶', apiKey: 'dellin' },\n  { name: 'Rail Continent', logo: 'üöÇ', apiKey: 'railcontinent' },\n  { name: '–í–æ–∑–æ–≤–æ–∑', logo: 'üöö', apiKey: 'vozovoz' },\n  { name: 'Nord Wheel', logo: 'üåê', apiKey: 'nordwheel' },\n  { name: '–°–¥—ç–∫', logo: 'üìÆ', apiKey: 'cdek' },\n  { name: '–ù–æ–≤–∞—è –ª–∏–Ω–∏—è', logo: 'üõ£Ô∏è', apiKey: 'newline' },\n  { name: '–ò—Ä-–¢—Ä–∞—Å—Ç', logo: 'üè≠', apiKey: 'irtrust' },\n  { name: '–ú–∞–π–æ—Ä —Ç—Ä–∞–Ω—Å', logo: '‚≠ê', apiKey: 'majortrans' },\n  { name: '–ë–ê–ô–ö–ê–õ –°–ï–†–í–ò–°', logo: 'üåä', apiKey: 'baikalservice' },\n  { name: '–ê–¥–∞–º–∞–Ω—Ç', logo: 'üíé', apiKey: 'adamant' },\n  { name: '–≠–ù–ï–†–ì–ò–Ø', logo: '‚ö°', apiKey: 'energiya' },\n  { name: '–¶–ê–ü', logo: 'üéØ', apiKey: 'cap' },\n  { name: '–£—Ä–∞–ª–¢—Ä–∞–Ω—Å–ö–æ–º–ø–∞–Ω–∏', logo: '‚õ∞Ô∏è', apiKey: 'uraltrans' },\n  { name: '–ù–û–í–û–¢–≠–ö', logo: 'üîß', apiKey: 'novotek' },\n  { name: '–ö–∏—Ç', logo: 'üêã', apiKey: 'kit' },\n  { name: '–ö–∞—Ä–∞–≤–∞–Ω', logo: 'üê™', apiKey: 'karavan' },\n  { name: '–ñ–µ–ª–î–æ—Ä–≠–∫—Å–ø–µ–¥–∏—Ü–∏—è', logo: 'üöÑ', apiKey: 'zeldor' },\n  { name: '–î–ö –¢—Ä–∞–Ω–∑–∏—Ç', logo: 'üöê', apiKey: 'dktransit' },\n  { name: '–ì–ª–∞–≤—Ç—Ä–∞—Å—Å–∞', logo: 'üõ§Ô∏è', apiKey: 'glavtrassa' },\n  { name: '–ë–∞–ª—Ç–∏–π—Å–∫–∞—è –°–ª—É–∂–±–∞ –î–æ—Å—Ç–∞–≤–∫–∏', logo: '‚öì', apiKey: 'baltservice' },\n  { name: '–ê–ù–ö–û–†', logo: 'üîó', apiKey: 'ankor' }\n];\n\nexport default function Home() {\n  // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n  const initialFormState: DeliveryForm = {\n    cargos: [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n    fromCity: '',\n    toCity: '',\n    fromAddress: '',\n    toAddress: '',\n    declaredValue: 0,\n    needPackaging: false,\n    needLoading: false,\n    needCarry: false,\n    floor: 1,\n    hasFreightLift: false,\n    needInsurance: false,\n    fromTerminal: true,\n    toTerminal: true,\n    fromAddressDelivery: false,\n    toAddressDelivery: false,\n    fromLavsiteWarehouse: false,\n    selectedProducts: []\n  };\n\n  const [form, setForm] = useState<DeliveryForm>(initialFormState);\n  const [isLoaded, setIsLoaded] = useState(false);\n  const [isRestoring, setIsRestoring] = useState(false);\n  const [lastSaveTime, setLastSaveTime] = useState<Date | null>(null);\n  const [isFormChanged, setIsFormChanged] = useState(false);\n  \n  // –°–æ–∑–¥–∞–µ–º –¥–µ–±–∞—É–Ω—Å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (—Å–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è)\n  const debouncedSave = useMemo(() => {\n    const saver = createDebouncedSaver(1000);\n    // –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã\n    return (formData: any) => {\n      setIsFormChanged(true);\n      saver(formData);\n      // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É\n      setTimeout(() => {\n        setLastSaveTime(new Date());\n        setIsFormChanged(false);\n      }, 1100);\n    };\n  }, []);\n\n  const [suggestions, setSuggestions] = useState<AddressSuggestion[]>([]);\n  const [showSuggestions, setShowSuggestions] = useState(false);\n  const [activeField, setActiveField] = useState('');\n  \n  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω–∏–µ–º/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n  const [enabledCompanies, setEnabledCompanies] = useState<Record<string, boolean>>({\n    pek: true,\n    dellin: true,\n    railcontinent: true,\n    vozovoz: true,\n    nordwheel: true,\n    cdek: true,\n    newline: false,\n    irtrust: false,\n    majortrans: false,\n    baikalservice: false,\n    adamant: false,\n    energiya: false,\n    cap: false,\n    uraltrans: false,\n    novotek: false,\n    kit: true,\n    karavan: false,\n    zeldor: false,\n    dktransit: false,\n    glavtrassa: false,\n    baltservice: false,\n    ankor: false\n  });\n  const [calculations, setCalculations] = useState<CalculationResult[]>([]);\n  const [calculating, setCalculating] = useState(false);\n  const [calculationProgress, setCalculationProgress] = useState<{\n    companies: Array<{\n      name: string;\n      status: 'pending' | 'loading' | 'completed' | 'error';\n      progress?: number;\n      error?: string;\n      duration?: number;\n    }>;\n    totalDuration: number;\n  }>({\n    companies: [],\n    totalDuration: 0\n  });\n  const [expandedDetails, setExpandedDetails] = useState<{ [key: string]: boolean }>({});\n  const [expandedDebugInfo, setExpandedDebugInfo] = useState<{ [key: string]: boolean }>({});\n  const [suggestionPosition, setSuggestionPosition] = useState({ top: 0, left: 0 });\n  const [apiStatus, setApiStatus] = useState({\n    pek: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n    dellin: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n    railcontinent: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n    vozovoz: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n    nordwheel: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n    cdek: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n    kit: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n    newline: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    irtrust: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    majortrans: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    baikalservice: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    adamant: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    energiya: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    cap: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    uraltrans: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    novotek: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    karavan: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    zeldor: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    dktransit: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    glavtrassa: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    baltservice: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n    ankor: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ'\n  });\n\n  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–∫—Ä—ã—Ç—ã—Ö —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n  const [hiddenCompanies, setHiddenCompanies] = useState<Record<string, boolean>>({});\n  const [showHiddenCompanies, setShowHiddenCompanies] = useState(false);\n\n  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –º–µ–Ω—é (—Å–∫—Ä—ã—Ç–æ/–ø–æ–∫–∞–∑–∞–Ω–æ)\n  const [isServiceMenuVisible, setIsServiceMenuVisible] = useState<boolean>(() => {\n    if (typeof window !== 'undefined') {\n      const saved = localStorage.getItem('serviceMenuVisible');\n      return saved !== null ? JSON.parse(saved) : true; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑–∞–Ω–æ\n    }\n    return true;\n  });\n\n  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –º–µ–Ω—é –≤ localStorage\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      localStorage.setItem('serviceMenuVisible', JSON.stringify(isServiceMenuVisible));\n    }\n  }, [isServiceMenuVisible]);\n\n  // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö - –ù–ï –æ—á–∏—â–∞–µ–º localStorage –≤ dev —Ä–µ–∂–∏–º–µ\n  // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞–º–∏\n\n  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏\n  useEffect(() => {\n    if (typeof window !== 'undefined' && isLoaded) {\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ (–ø–æ—Å–ª–µ Clear-Site-Data)\n      const delayedCheck = setTimeout(() => {\n        const currentFormData = loadFormData();\n        if (!currentFormData) {\n          console.log('üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –∏—â–µ–º backup...');\n          \n          // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ backup –¥–∞–Ω–Ω—ã–µ\n          const backupKeys = ['formBackup1', 'formBackup2', 'formBackup3'];\n          for (const key of backupKeys) {\n            const backup = localStorage.getItem(key);\n            if (backup) {\n              try {\n                localStorage.setItem('deliveryFormData', backup);\n                console.log('üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ backup:', key);\n                \n                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ\n                const restoredData = loadFormData();\n                if (restoredData) {\n                  setIsRestoring(true);\n                  const restoredForm: DeliveryForm = {\n                    cargos: restoredData.cargos.length > 0 ? restoredData.cargos : [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n                    fromCity: restoredData.fromCity,\n                    toCity: restoredData.toCity,\n                    fromAddress: restoredData.fromAddress,\n                    toAddress: restoredData.toAddress,\n                    declaredValue: restoredData.declaredValue,\n                    needPackaging: restoredData.needPackaging,\n                    needLoading: restoredData.needLoading,\n                    needCarry: restoredData.needCarry,\n                    floor: restoredData.floor,\n                    hasFreightLift: restoredData.hasFreightLift,\n                    needInsurance: restoredData.needInsurance,\n                    fromTerminal: restoredData.fromTerminal,\n                    toTerminal: restoredData.toTerminal,\n                    fromAddressDelivery: restoredData.fromAddressDelivery,\n                    toAddressDelivery: restoredData.toAddressDelivery,\n                    fromLavsiteWarehouse: restoredData.fromLavsiteWarehouse || false,\n                    selectedProducts: restoredData.selectedProducts,\n                  };\n                  setForm(restoredForm);\n                  if (restoredData.enabledCompanies && Object.keys(restoredData.enabledCompanies).length > 0) {\n                    setEnabledCompanies(restoredData.enabledCompanies);\n                  }\n                  if (restoredData.hiddenCompanies && Object.keys(restoredData.hiddenCompanies).length > 0) {\n                    setHiddenCompanies(restoredData.hiddenCompanies);\n                  }\n                  setTimeout(() => setIsRestoring(false), 100);\n                  console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!');\n                }\n                break;\n              } catch (e) {\n                console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ backup:', key, e);\n              }\n            }\n          }\n        }\n      }, 2000);\n      \n      return () => clearTimeout(delayedCheck);\n    }\n  }, [isLoaded]);\n\n  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)\n  useEffect(() => {\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ\n    if (typeof window !== 'undefined' && !isLoaded) {\n      let dataRestored = false;\n      try {\n        setIsRestoring(true); // –ë–ª–æ–∫–∏—Ä—É–µ–º –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è\n        \n        // –ú—è–≥–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –±–µ–∑ –æ—á–∏—Å—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö\n        const currentVersion = 'v2.4.0-persistent-storage'; // –í–µ—Ä—Å–∏—è —Å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º\n        const savedVersion = localStorage.getItem('appVersion');\n        \n        if (savedVersion !== currentVersion) {\n          console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ', currentVersion);\n          // –ù–ï –æ—á–∏—â–∞–µ–º localStorage - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ\n          localStorage.setItem('appVersion', currentVersion);\n        }\n        \n        // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É\n        const savedFormData = loadFormData();\n        if (savedFormData) {\n          // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞\n          const restoredForm: DeliveryForm = {\n            cargos: savedFormData.cargos.length > 0 ? savedFormData.cargos : [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n            fromCity: savedFormData.fromCity,\n            toCity: savedFormData.toCity,\n            fromAddress: savedFormData.fromAddress,\n            toAddress: savedFormData.toAddress,\n            declaredValue: savedFormData.declaredValue,\n            needPackaging: savedFormData.needPackaging,\n            needLoading: savedFormData.needLoading,\n            needCarry: savedFormData.needCarry,\n            floor: savedFormData.floor,\n            hasFreightLift: savedFormData.hasFreightLift,\n            needInsurance: savedFormData.needInsurance,\n            fromTerminal: savedFormData.fromTerminal,\n            toTerminal: savedFormData.toTerminal,\n            fromAddressDelivery: savedFormData.fromAddressDelivery,\n            toAddressDelivery: savedFormData.toAddressDelivery,\n            fromLavsiteWarehouse: savedFormData.fromLavsiteWarehouse || false,\n            selectedProducts: savedFormData.selectedProducts,\n          };\n          \n          setForm(restoredForm);\n          \n          // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n            if (savedFormData.enabledCompanies && Object.keys(savedFormData.enabledCompanies).length > 0) {\n              setEnabledCompanies(savedFormData.enabledCompanies);\n            }\n            if (savedFormData.hiddenCompanies && Object.keys(savedFormData.hiddenCompanies).length > 0) {\n              setHiddenCompanies(savedFormData.hiddenCompanies);\n            }\n          console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ localStorage');\n          \n          // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è Supabase\n          const currentTime = Math.floor(Date.now() / 1000);\n          console.log('üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (timestamp):', currentTime);\n          console.log('üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (ISO):', new Date().toISOString());\n          \n          dataRestored = true;\n          // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—Å–ø–µ–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è\n          setTimeout(() => {\n            setIsRestoring(false);\n          }, 100);\n        } else {\n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏\n          const oldSaved = localStorage.getItem('deliveryForm');\n          if (oldSaved) {\n            console.log('üîÑ –ù–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç–∞—Ä–æ–º —Ñ–æ—Ä–º–∞—Ç–µ, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è...');\n            const oldForm = JSON.parse(oldSaved);\n            if (!oldForm.cargos || oldForm.cargos.length === 0) {\n              oldForm.cargos = [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }];\n            }\n            setForm(oldForm);\n            \n            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –∏ —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ\n            saveFormData(oldForm);\n            localStorage.removeItem('deliveryForm');\n            console.log('‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');\n            \n            dataRestored = true;\n            // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—Å–ø–µ–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è\n            setTimeout(() => {\n              setIsRestoring(false);\n            }, 100);\n          }\n        }\n        \n        // –í—ã–≤–æ–¥–∏–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¢–ö –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n        console.log('üìã –í—Å–µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ –¢–ö:', COMPANIES_BASE.length);\n        console.log('üìã –°–ø–∏—Å–æ–∫ –¢–ö:', COMPANIES_BASE.map(c => c.name));\n        \n      } catch (error) {\n        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);\n        // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ\n      } finally {\n        // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, —Å—Ä–∞–∑—É —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ\n        if (!dataRestored) {\n          setIsRestoring(false);\n        }\n        setIsLoaded(true);\n      }\n    }\n  }, [isLoaded]);\n\n  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–æ—Ä–º—ã (—Å –¥–µ–±–∞—É–Ω—Å–æ–º)\n  useEffect(() => {\n    if (typeof window !== 'undefined' && isLoaded && !isRestoring) {\n      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–±–∞—É–Ω—Å –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è\n      debouncedSave({\n        cargos: form.cargos,\n        fromCity: form.fromCity,\n        toCity: form.toCity,\n        fromAddress: form.fromAddress,\n        toAddress: form.toAddress,\n        declaredValue: form.declaredValue,\n        needPackaging: form.needPackaging,\n        needLoading: form.needLoading,\n        needCarry: form.needCarry,\n        floor: form.floor,\n        hasFreightLift: form.hasFreightLift,\n        needInsurance: form.needInsurance,\n        fromTerminal: form.fromTerminal,\n        toTerminal: form.toTerminal,\n        fromAddressDelivery: form.fromAddressDelivery,\n        toAddressDelivery: form.toAddressDelivery,\n        fromLavsiteWarehouse: form.fromLavsiteWarehouse,\n        selectedProducts: form.selectedProducts,\n        enabledCompanies: enabledCompanies,\n        hiddenCompanies: hiddenCompanies,\n      });\n    }\n  }, [form, enabledCompanies, isLoaded, isRestoring, debouncedSave]);\n\n  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –ø—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n  useEffect(() => {\n    if (form.declaredValue > 0) {\n      setForm(prev => ({ ...prev, needInsurance: true }));\n    }\n  }, [form.declaredValue]);\n\n  // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤\n  useEffect(() => {\n    const handleMessage = (event: MessageEvent) => {\n      if (event.data && event.data.type === 'PRODUCTS_UPDATED') {\n        console.log('üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤:', event.data.data);\n        \n        // –û—á–∏—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫—ç—à–∏ —Ç–æ–≤–∞—Ä–æ–≤\n        const keysToRemove: string[] = [];\n        for (let i = 0; i < localStorage.length; i++) {\n          const key = localStorage.key(i);\n          if (key && (key.startsWith('furniture_') || key.startsWith('product_') || key.includes('ProductSearch'))) {\n            keysToRemove.push(key);\n          }\n        }\n        keysToRemove.forEach(key => localStorage.removeItem(key));\n        console.log(`üßΩ –û—á–∏—â–µ–Ω–æ ${keysToRemove.length} –∫–ª—é—á–µ–π –∫—ç—à–∞ —Ç–æ–≤–∞—Ä–æ–≤`);\n        \n        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É ProductSearch –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è\n        window.dispatchEvent(new CustomEvent('forceProductsReload', {\n          detail: event.data.data\n        }));\n      }\n    };\n    \n    window.addEventListener('message', handleMessage);\n    \n    return () => {\n      window.removeEventListener('message', handleMessage);\n    };\n  }, []);\n\n  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã\n  useEffect(() => {\n    if (typeof window !== 'undefined' && isLoaded) {\n      checkAllAPIStatus();\n    }\n  }, [isLoaded]);\n\n  const checkAPIStatus = async (apiName: string, testFunction: () => Promise<any>) => {\n    try {\n      const result = await testFunction();\n      if (result && !result.error) {\n        setApiStatus(prev => ({ ...prev, [apiName]: '–ø–æ–¥–∫–ª—é—á–µ–Ω–æ' }));\n      } else {\n        setApiStatus(prev => ({ ...prev, [apiName]: '–æ—à–∏–±–∫–∞' }));\n      }\n    } catch (error) {\n      setApiStatus(prev => ({ ...prev, [apiName]: '–æ—à–∏–±–∫–∞' }));\n    }\n  };\n\n  const checkAllAPIStatus = async () => {\n    // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\n    const testData = {\n      fromCity: '–ú–æ—Å–∫–≤–∞',\n      toCity: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', \n      cargos: [{ id: '1', length: 100, width: 100, height: 100, weight: 10 }],\n      declaredValue: 50000,\n      fromAddressDelivery: false,\n      toAddressDelivery: false,\n      needPackaging: false,\n      needInsurance: false\n    };\n\n    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n    const currentForm = form;\n    \n    // –í—Ä–µ–º–µ–Ω–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ\n    setForm({\n      ...form,\n      fromCity: testData.fromCity,\n      toCity: testData.toCity,\n      cargos: testData.cargos,\n      declaredValue: testData.declaredValue,\n      fromAddressDelivery: testData.fromAddressDelivery,\n      toAddressDelivery: testData.toAddressDelivery,\n      needPackaging: testData.needPackaging,\n      needInsurance: testData.needInsurance\n    });\n\n    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ\n    Promise.all([\n      checkAPIStatus('pek', async () => {\n        try {\n          const response = await fetch('/api/pek', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ method: 'test' })\n          });\n          const data = await response.json();\n          if (data.status === 'OK') {\n            return { success: true };\n          } else {\n            return { error: true };\n          }\n        } catch (error) {\n          return { error: true };\n        }\n      }),\n      \n      checkAPIStatus('dellin', async () => {\n        try {\n          // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ sessionID –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π (—Ç–æ—Ç –∂–µ –º–µ—Ç–æ–¥ —á—Ç–æ –≤ calculateDellin)\n          const authResponse = await fetch('https://api.dellin.ru/v3/auth/login.json', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n              login: 'service@lavsit.ru',\n              password: 'edcwsx123QAZ'\n            })\n          });\n          const authData = await authResponse.json();\n          \n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ –∫ sessionID –∫–∞–∫ –≤ calculateDellin\n          if (authData.data?.sessionID || authData.sessionID || authData.data?.session) {\n            return { success: true };\n          } else {\n            return { error: true };\n          }\n        } catch (error) {\n          return { error: true };\n        }\n      }),\n      \n      checkAPIStatus('railcontinent', async () => {\n        try {\n          const response = await fetch('/api/rail-continent', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              city_sender: testData.fromCity,\n              city_receiver: testData.toCity,\n              weight: 10,\n              volume: 0.1,\n              length: 1,\n              width: 1,\n              height: 1,\n              declared_cost: testData.declaredValue,\n              pickup: '0',\n              delivery: '0',\n              packaging: '0',\n              insurance: '0',\n              tariff: 'auto'\n            })\n          });\n          return await response.json();\n        } catch (error) {\n          return { error: true };\n        }\n      }),\n      \n      checkAPIStatus('vozovoz', async () => {\n        try {\n          const response = await fetch('/api/vozovoz', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              object: \"price\",\n              action: \"get\",\n              params: {\n                cargo: {\n                  dimension: {\n                    quantity: 1,\n                    volume: 0.1,\n                    weight: 10\n                  }\n                },\n                gateway: {\n                  dispatch: {\n                    point: {\n                      location: testData.fromCity,\n                      terminal: \"default\"\n                    }\n                  },\n                  destination: {\n                    point: {\n                      location: testData.toCity,\n                      terminal: \"default\"\n                    }\n                  }\n                }\n              }\n            })\n          });\n          return await response.json();\n        } catch (error) {\n          return { error: true };\n        }\n      }),\n      \n      checkAPIStatus('nordwheel', async () => {\n        try {\n          // Use the same API endpoint and format as the main calculation function\n          const requestData = {\n            dispatch: {\n              location: {\n                type: 'terminal',\n                city_fias: '0c5b2444-70a0-4932-980c-b4dc0d3f02b5' // Moscow\n              }\n            },\n            destination: {\n              location: {\n                type: 'terminal',\n                city_fias: 'c2deb16a-0330-4f05-821f-1d09c93331e6' // St. Petersburg\n              }\n            },\n            cargo: {\n              total_weight: 10,\n              total_volume: 0.1,\n              total_quantity: 1\n            },\n            insurance: 50000,\n            insurance_refuse: false,\n            services: {\n              is_package: true,\n              is_documents_return: false,\n              is_fragile: false\n            },\n            promocode: null\n          };\n\n          const result = await enhancedApiRequest(\n            '/api/nordwheel',\n            {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json'\n              },\n              body: JSON.stringify(requestData)\n            },\n            { operation: 'calculate', company: 'Nord Wheel' }\n          );\n\n          if (result && typeof result === 'object' && 'success' in result && !result.success) {\n            console.error('‚ùå Nord Wheel API –æ—à–∏–±–∫–∞:', result.error);\n            return { error: true };\n          }\n\n          const response = result as Response;\n          const data = await response.json();\n          \n          if (response.ok && (data.auto || data.avia || data.success)) {\n            return { success: true };\n          } else {\n            console.error('‚ùå Nord Wheel API status check –æ—à–∏–±–∫–∞:', data);\n            return { error: true };\n          }\n        } catch (error) {\n          return { error: true };\n        }\n      }),\n      \n      checkAPIStatus('cdek', async () => {\n        try {\n          const response = await fetch('/api/cdek', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              from_city: testData.fromCity,\n              to_city: testData.toCity,\n              packages: [{\n                height: 10,\n                length: 20,\n                width: 10,\n                weight: 1000\n              }]\n            })\n          });\n          const data = await response.json();\n          \n          if (response.ok && data.tariff_codes && data.tariff_codes.length > 0) {\n            return { success: true };\n          } else {\n            return { error: true };\n          }\n        } catch (error) {\n          return { error: true };\n        }\n      })\n    ]).finally(() => {\n      // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n      setForm(currentForm);\n    });\n  };\n\n  const searchAddresses = useCallback(async (query: string, field: string, element?: HTMLInputElement) => {\n    if (query.length < 3) {\n      setSuggestions([]);\n      setShowSuggestions(false);\n      return;\n    }\n\n    setActiveField(field);\n    \n    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ –∞–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–æ–∫\n    if (element) {\n      const rect = element.getBoundingClientRect();\n      setSuggestionPosition({\n        top: rect.bottom + window.scrollY,\n        left: rect.left + window.scrollX\n      });\n    }\n    \n    try {\n      const response = await fetch('https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json',\n          'Authorization': 'Token eb87bbb3789bb43ed465f796892ea951f9e91008'\n        },\n        body: JSON.stringify({\n          query: query,\n          count: 10,\n          // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª–µ–π –≥–æ—Ä–æ–¥–æ–≤ - —Ç–æ–ª—å–∫–æ –≥–æ—Ä–æ–¥–∞\n          ...(field === 'fromCity' || field === 'toCity' ? {\n            restrict_value: true,\n            locations: [{\n              country: '–†–æ—Å—Å–∏—è'\n            }],\n            from_bound: { value: 'city' },\n            to_bound: { value: 'city' }\n          } : {})\n        })\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        setSuggestions(data.suggestions || []);\n        setShowSuggestions(true);\n      }\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫:', error);\n    }\n  }, []);\n\n  const debounceTimer = React.useRef<NodeJS.Timeout>();\n  const handleAddressChange = (field: string, value: string, element?: HTMLInputElement) => {\n    setForm(prev => ({ ...prev, [field]: value }));\n    \n    clearTimeout(debounceTimer.current);\n    debounceTimer.current = setTimeout(() => {\n      searchAddresses(value, field, element);\n    }, 50);\n  };\n\n  const selectSuggestion = (suggestion: AddressSuggestion) => {\n    setForm(prev => ({ ...prev, [activeField]: suggestion.value }));\n    setShowSuggestions(false);\n    setActiveField('');\n  };\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞ \"–°–æ —Å–∫–ª–∞–¥–∞ –õ–∞–≤—Å–∏—Ç\"\n  const handleLavsiteWarehouseChange = (checked: boolean) => {\n    if (checked) {\n      setForm(prev => ({\n        ...prev,\n        fromLavsiteWarehouse: true,\n        fromAddressDelivery: true,\n        fromTerminal: false,\n        fromCity: '–õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π',\n        fromAddress: '–¥–µ—Ä–µ–≤–Ω—è –û—Å–µ–µ–≤–æ, 202, –≥–æ—Ä–æ–¥—Å–∫–æ–π –æ–∫—Ä—É–≥ –õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π, –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å'\n      }));\n    } else {\n      setForm(prev => ({\n        ...prev,\n        fromLavsiteWarehouse: false,\n        fromCity: '',\n        fromAddress: ''\n      }));\n    }\n  };\n\n  const addCargo = () => {\n    const newId = (form.cargos.length + 1).toString();\n    setForm(prev => ({\n      ...prev,\n      cargos: [...prev.cargos, { id: newId, length: 0, width: 0, height: 0, weight: 0 }]\n    }));\n  };\n\n  const updateCargo = (id: string, field: string, value: number) => {\n    setForm(prev => {\n      const updatedCargos = prev.cargos.map(cargo => \n        cargo.id === id ? { ...cargo, [field]: value } : cargo\n      );\n      \n      // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n      const cleanResult = cleanEmptyCargos(updatedCargos, prev.selectedProducts || []);\n      \n      return {\n        ...prev,\n        cargos: cleanResult.cargos,\n        selectedProducts: cleanResult.products\n      };\n    });\n  };\n\n  const removeCargo = (id: string) => {\n    if (form.cargos.length > 1) {\n      setForm(prev => ({\n        ...prev,\n        cargos: prev.cargos.filter(cargo => cargo.id !== id)\n      }));\n    }\n  };\n\n  // üîß –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ (–≤—Å–µ –ø–æ–ª—è —Ä–∞–≤–Ω—ã 0)\n  const isEmptyCargo = (cargo: Cargo) => {\n    return cargo.length === 0 && cargo.width === 0 && cargo.height === 0 && cargo.weight === 0;\n  };\n\n  // üîß –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤\n  const cleanEmptyCargos = (cargos: Cargo[], selectedProducts: ProductInForm[]) => {\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –≥—Ä—É–∑\n    const hasFilledCargos = cargos.some(cargo => !isEmptyCargo(cargo));\n    \n    if (!hasFilledCargos) {\n      // –ï—Å–ª–∏ –Ω–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –ø—É—Å—Ç–æ–π\n      return {\n        cargos: cargos.length > 0 ? [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }] : [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n        products: selectedProducts\n      };\n    }\n\n    // –°–æ–∑–¥–∞–µ–º –º–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ä—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –∫ –Ω–æ–≤—ã–º\n    const oldToNewIndexMap = new globalThis.Map<number, number>();\n    let newIndex = 0;\n    \n    cargos.forEach((cargo, oldIndex) => {\n      if (!isEmptyCargo(cargo)) {\n        oldToNewIndexMap.set(oldIndex, newIndex);\n        newIndex++;\n      }\n    });\n    \n    // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –≥—Ä—É–∑—ã\n    const filledCargos = cargos.filter(cargo => !isEmptyCargo(cargo));\n    \n    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã —É —Ç–æ–≤–∞—Ä–æ–≤\n    const updatedProducts = selectedProducts.map(productItem => ({\n      ...productItem,\n      cargoIndexes: productItem.cargoIndexes\n        .map(oldIndex => oldToNewIndexMap.get(oldIndex))\n        .filter(newIdx => newIdx !== undefined) as number[]\n    }));\n    \n    return {\n      cargos: filledCargos,\n      products: updatedProducts\n    };\n  };\n\n  // üîß –§—É–Ω–∫—Ü–∏—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≥—Ä—É–∑–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n  interface GroupedCargoDisplay {\n    length: number;\n    width: number;\n    height: number;\n    weight: number;\n    quantity: number;\n    indices: number[];\n    isEmpty: boolean;\n  }\n\n  const groupCargosForDisplay = (cargos: Cargo[]): GroupedCargoDisplay[] => {\n    const groups = new globalThis.Map<string, GroupedCargoDisplay>();\n    \n    cargos.forEach((cargo, index) => {\n      const isEmpty = isEmptyCargo(cargo);\n      \n      // –î–ª—è –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ –Ω–µ –≥—Ä—É–ø–ø–∏—Ä—É–µ–º\n      if (isEmpty) {\n        groups.set(`empty_${index}`, {\n          length: 0,\n          width: 0,\n          height: 0,\n          weight: 0,\n          quantity: 1,\n          indices: [index],\n          isEmpty: true\n        });\n        return;\n      }\n      \n      // –°–æ–∑–¥–∞–µ–º –∫–ª—é—á –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –∏ –≤–µ—Å–∞\n      const key = `${cargo.length}_${cargo.width}_${cargo.height}_${cargo.weight}`;\n      \n      if (groups.has(key)) {\n        const existing = groups.get(key)!;\n        existing.quantity += 1;\n        existing.indices.push(index);\n      } else {\n        groups.set(key, {\n          length: cargo.length,\n          width: cargo.width,\n          height: cargo.height,\n          weight: cargo.weight,\n          quantity: 1,\n          indices: [index],\n          isEmpty: false\n        });\n      }\n    });\n    \n    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤: —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ (–ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É–±—ã–≤–∞–Ω–∏—è), –ø–æ—Ç–æ–º –ø—É—Å—Ç—ã–µ\n    return Array.from(groups.values()).sort((a, b) => {\n      if (a.isEmpty && !b.isEmpty) return 1;\n      if (!a.isEmpty && b.isEmpty) return -1;\n      if (!a.isEmpty && !b.isEmpty) {\n        return b.quantity - a.quantity; // –ü–æ —É–±—ã–≤–∞–Ω–∏—é –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞\n      }\n      return a.indices[0] - b.indices[0]; // –ü—É—Å—Ç—ã–µ –ø–æ –ø–æ—Ä—è–¥–∫—É –∏–Ω–¥–µ–∫—Å–æ–≤\n    });\n  };\n\n  // üîß –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏\n  const handleProductAdd = (product: FurnitureProduct) => {\n    const timestamp = Date.now();\n    \n    console.log(`‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞: ${product.name} (${product.cargoPlaces.length} –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç)`);\n    \n    // –°–æ–∑–¥–∞–µ–º –≥—Ä—É–∑–æ–≤—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è —Ç–æ–≤–∞—Ä–∞\n    const newCargos = createCargosForProduct(product, 1, timestamp);\n    \n    console.log('–°–æ–∑–¥–∞–Ω–æ –Ω–æ–≤—ã—Ö –≥—Ä—É–∑–æ–≤:', newCargos.length);\n    console.log('–ù–æ–≤—ã–µ –≥—Ä—É–∑—ã:', newCargos.map(c => ({ id: c.id, productId: c.productId, addedAt: c.addedAt })));\n    \n    // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç —Ç–æ–≤–∞—Ä–∞ –≤ —Ñ–æ—Ä–º–µ\n    const productInForm: ProductInForm = {\n      product,\n      quantity: 1,\n      totalPrice: product.retailPrice,\n      cargoIndexes: [], // –ó–∞–ø–æ–ª–Ω–∏–º –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–∑–æ–≤\n      addedAt: timestamp\n    };\n    \n    setForm(prev => {\n      let updatedCargos = [...prev.cargos];\n      let cargoIndexes: number[] = [];\n      \n      // –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è\n      const emptyCargos = updatedCargos\n        .map((cargo, index) => ({ cargo, index }))\n        .filter(item => isEmptyCargo(item.cargo));\n      \n      console.log('–ù–∞–π–¥–µ–Ω–æ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤:', emptyCargos.length);\n      console.log('–ù—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –≥—Ä—É–∑–æ–≤:', newCargos.length);\n      \n      // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞\n      let filledCount = 0;\n      for (let i = 0; i < Math.min(emptyCargos.length, newCargos.length); i++) {\n        const emptyCargoIndex = emptyCargos[i].index;\n        const newCargoData = newCargos[i];\n        \n        updatedCargos[emptyCargoIndex] = {\n          ...updatedCargos[emptyCargoIndex],\n          length: newCargoData.length,\n          width: newCargoData.width,\n          height: newCargoData.height,\n          weight: newCargoData.weight,\n          productId: newCargoData.productId,\n          placeNumber: newCargoData.placeNumber,\n          isFromProduct: newCargoData.isFromProduct,\n          addedAt: newCargoData.addedAt\n        };\n        \n        cargoIndexes.push(emptyCargoIndex);\n        filledCount++;\n      }\n      \n      // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –≥—Ä—É–∑–æ–≤, —á–µ–º –µ—Å—Ç—å –ø—É—Å—Ç—ã—Ö - –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ\n      if (filledCount < newCargos.length) {\n        const remainingCargos = newCargos.slice(filledCount);\n        const startIndex = updatedCargos.length;\n        \n        for (let i = 0; i < remainingCargos.length; i++) {\n          updatedCargos.push(remainingCargos[i]);\n          cargoIndexes.push(startIndex + i);\n        }\n      }\n      \n      productInForm.cargoIndexes = cargoIndexes;\n      \n      console.log('–ò–Ω–¥–µ–∫—Å—ã –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤:', cargoIndexes);\n      console.log('–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:', updatedCargos.length);\n      \n      // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n      const prevSelectedProducts = prev.selectedProducts || [];\n      const newSelectedProducts = [...prevSelectedProducts, productInForm];\n      const newDeclaredValue = calculateTotalValue(newSelectedProducts);\n      \n      // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n      const cleanResult = cleanEmptyCargos(updatedCargos, newSelectedProducts);\n      \n      return {\n        ...prev,\n        cargos: cleanResult.cargos,\n        selectedProducts: cleanResult.products,\n        declaredValue: newDeclaredValue\n      };\n    });\n    \n    console.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä: ${product.name} (${newCargos.length} –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç)`);\n    console.log('–§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥—Ä—É–∑–æ–≤:', newCargos.length);\n  };\n\n  const handleProductQuantityChange = (productId: string, addedAt: number, newQuantity: number) => {\n    setForm(prev => {\n      console.log(`üî¢ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞ ${productId} —Å ${prev.selectedProducts?.find(p => p.product.id === productId && p.addedAt === addedAt)?.quantity || 0} –Ω–∞ ${newQuantity}`);\n      \n      // –ù–∞—Ö–æ–¥–∏–º —Ç–æ–≤–∞—Ä\n      const selectedProducts = prev.selectedProducts || [];\n      const productIndex = selectedProducts.findIndex(p => \n        p.product.id === productId && p.addedAt === addedAt\n      );\n      \n      if (productIndex === -1) {\n        console.warn('‚ùå –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞');\n        return prev;\n      }\n      \n      const product = selectedProducts[productIndex];\n      console.log('–ì—Ä—É–∑—ã –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞:', prev.cargos.length);\n      \n      // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –≥—Ä—É–∑—ã —ç—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞\n      const cargosWithoutProduct = removeCargosForProduct(\n        prev.cargos as CargoWithMetadata[], \n        productId, \n        addedAt\n      );\n      \n      console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö:', cargosWithoutProduct.length);\n      \n      // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –≥—Ä—É–∑—ã —Å –Ω–æ–≤—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º\n      const newCargos = createCargosForProduct(product.product, newQuantity, addedAt);\n      const updatedCargos = [...cargosWithoutProduct, ...newCargos];\n      \n      console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö:', updatedCargos.length);\n      \n      // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä\n      const updatedProduct = {\n        ...product,\n        quantity: newQuantity,\n        totalPrice: product.product.retailPrice * newQuantity,\n        cargoIndexes: findCargoIndexesForProduct(updatedCargos, productId, addedAt)\n      };\n      \n      const updatedProducts = selectedProducts.map((p, index) => \n        index === productIndex ? updatedProduct : p\n      );\n      \n      // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n      const newDeclaredValue = calculateTotalValue(updatedProducts);\n      \n      // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n      const cleanResult = cleanEmptyCargos(updatedCargos, updatedProducts);\n      \n      return {\n        ...prev,\n        cargos: cleanResult.cargos,\n        selectedProducts: cleanResult.products,\n        declaredValue: newDeclaredValue\n      };\n    });\n    \n    console.log(`üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ ${productId}: ${newQuantity} —à—Ç.`);\n  };\n\n  const handleProductRemove = (productId: string, addedAt: number) => {\n    setForm(prev => {\n      console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ ${productId} (addedAt: ${addedAt})`);\n      \n      // –ù–∞—Ö–æ–¥–∏–º —Ç–æ–≤–∞—Ä –∏ –µ–≥–æ –∏–Ω–¥–µ–∫—Å—ã –≥—Ä—É–∑–æ–≤\n      const selectedProducts = prev.selectedProducts || [];\n      const product = selectedProducts.find(p => \n        p.product.id === productId && p.addedAt === addedAt\n      );\n      \n      if (!product) {\n        console.log('–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω');\n        return prev;\n      }\n      \n      // –û—á–∏—â–∞–µ–º –≥—Ä—É–∑—ã —Ç–æ–≤–∞—Ä–∞ (–¥–µ–ª–∞–µ–º –∏—Ö –ø—É—Å—Ç—ã–º–∏ –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è)\n      const updatedCargos = prev.cargos.map((cargo, index) => {\n        if (product.cargoIndexes.includes(index)) {\n          return {\n            ...cargo,\n            length: 0,\n            width: 0,\n            height: 0,\n            weight: 0,\n            productId: undefined,\n            placeNumber: undefined,\n            isFromProduct: undefined,\n            addedAt: undefined\n          };\n        }\n        return cargo;\n      });\n      \n      // –£–¥–∞–ª—è–µ–º —Ç–æ–≤–∞—Ä –∏–∑ —Å–ø–∏—Å–∫–∞\n      const updatedProducts = selectedProducts.filter(p => \n        !(p.product.id === productId && p.addedAt === addedAt)\n      );\n      \n      // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n      const newDeclaredValue = calculateTotalValue(updatedProducts);\n      \n      // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n      const cleanResult = cleanEmptyCargos(updatedCargos, updatedProducts);\n      \n      console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:', cleanResult.cargos.length);\n      console.log('–£–¥–∞–ª–µ–Ω–æ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤:', updatedCargos.length - cleanResult.cargos.length);\n      \n      return {\n        ...prev,\n        cargos: cleanResult.cargos,\n        selectedProducts: cleanResult.products,\n        declaredValue: newDeclaredValue\n      };\n    });\n    \n    console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω —Ç–æ–≤–∞—Ä ${productId}`);\n  };\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ sessionID –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n  const getDellinSessionId = async (): Promise<string | null> => {\n    try {\n      const authResponse = await fetch('https://api.dellin.ru/v3/auth/login.json', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n          login: 'service@lavsit.ru',\n          password: 'edcwsx123QAZ'\n        })\n      });\n\n      const authData = await authResponse.json();\n      console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ response.ok:', authResponse.ok);\n      console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData:', authData);\n      console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData.data:', authData.data);\n      console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData.data?.sessionID:', authData.data?.sessionID);\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ –∫ sessionID\n      let sessionID = null;\n      \n      if (authData.data?.sessionID) {\n        sessionID = authData.data.sessionID;\n        console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ data.sessionID:', sessionID);\n      } else if (authData.sessionID) {\n        sessionID = authData.sessionID;\n        console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ sessionID:', sessionID);\n      } else if (authData.data?.session) {\n        sessionID = authData.data.session;\n        console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ data.session:', sessionID);\n      }\n      \n      if (authResponse.ok && sessionID) {\n        return sessionID;\n      } else {\n        console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', authData);\n        console.error('‚ùå –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', authResponse.status);\n        console.error('‚ùå –¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞:', authResponse.statusText);\n        return null;\n      }\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', error);\n    }\n    return null;\n  };\n\n  // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –≥–æ—Ä–æ–¥–æ–≤ –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n  const loadDellinCities = async () => {\n    try {\n      const response = await fetch('/data/dellin-cities.json');\n      if (!response.ok) {\n        console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –≥–æ—Ä–æ–¥–æ–≤');\n        return null;\n      }\n      const data = await response.json();\n      return data.cities;\n    } catch (error) {\n      console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –≥–æ—Ä–æ–¥–æ–≤:', error);\n      return null;\n    }\n  };\n\n  // –ü–æ–∏—Å–∫ cityID –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ\n  const getCityIDFromLocal = async (cityName: string): Promise<string | null> => {\n    const cities = await loadDellinCities();\n    if (!cities) return null;\n\n    const normalizedSearch = cityName.toLowerCase().trim()\n      .replace(/^–≥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥ \"\n      .replace(/^–≥–æ—Ä–æ–¥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥–æ—Ä–æ–¥ \"\n      .replace(/\\s+/g, ' '); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—Ä–æ–±–µ–ª—ã\n\n    console.log(`üîç –ü–æ–∏—Å–∫ cityID –¥–ª—è –≥–æ—Ä–æ–¥–∞: \"${normalizedSearch}\"`);\n\n    // –ü–æ–∏—Å–∫ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ\n    for (const city of cities) {\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –∏–º–µ–Ω–µ–º –≥–æ—Ä–æ–¥–∞\n      if (city.name.toLowerCase() === normalizedSearch) {\n        console.log(`‚úÖ –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: \"${city.name}\" -> cityID: ${city.cityID}`);\n        return city.cityID;\n      }\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –ø–æ–∏—Å–∫–æ–≤—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏\n      for (const searchString of city.searchStrings) {\n        if (searchString === normalizedSearch) {\n          console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ –≤ –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫–∞—Ö: \"${searchString}\" –¥–ª—è –≥–æ—Ä–æ–¥–∞ \"${city.name}\" -> cityID: ${city.cityID}`);\n          return city.cityID;\n        }\n      }\n    }\n\n    console.warn(`‚ö†Ô∏è cityID –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –¥–ª—è –≥–æ—Ä–æ–¥–∞: \"${normalizedSearch}\"`);\n    return null;\n  };\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ cityID —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n  const findCityInDellinDirectory = async (cityName: string): Promise<{cityID: number, code: string} | null> => {\n    try {\n      console.log(`üîç –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –î–õ: ${cityName}`);\n      \n      // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞\n      const normalizedCity = cityName.toLowerCase().trim()\n        .replace(/^–≥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥ \"\n        .replace(/^–≥–æ—Ä–æ–¥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥–æ—Ä–æ–¥ \"\n        .replace(/\\s+/g, ' '); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—Ä–æ–±–µ–ª—ã\n      \n      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞—Å–µ–ª–µ–Ω–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤\n      const response = await fetch('https://api.dellin.ru/v2/public/kladr.json', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n          q: normalizedCity,\n          limit: 10\n        })\n      });\n      \n      const data = await response.json();\n      console.log(`üèôÔ∏è –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞ \"${normalizedCity}\" response:`, data);\n      \n      if (response.ok && data.cities && Array.isArray(data.cities) && data.cities.length > 0) {\n        // –ò—â–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–ª–∏ –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –≥–æ—Ä–æ–¥\n        let bestMatch = data.cities.find((city: any) => \n          city.searchString?.toLowerCase() === normalizedCity ||\n          city.aString?.toLowerCase().includes(normalizedCity)\n        );\n        \n        // –ï—Å–ª–∏ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –Ω–µ—Ç, –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞–º–∏\n        if (!bestMatch) {\n          bestMatch = data.cities.find((city: any) => city.isTerminal === 1);\n        }\n        \n        // –ï—Å–ª–∏ –∏ —ç—Ç–æ–≥–æ –Ω–µ—Ç, –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π\n        if (!bestMatch) {\n          bestMatch = data.cities[0];\n        }\n        \n        if (bestMatch) {\n          console.log(`‚úÖ –ù–∞–π–¥–µ–Ω –≥–æ—Ä–æ–¥:`, {\n            cityID: bestMatch.cityID,\n            name: bestMatch.aString,\n            code: bestMatch.code,\n            hasTerminals: bestMatch.isTerminal === 1\n          });\n          \n          return {\n            cityID: bestMatch.cityID,\n            code: bestMatch.code\n          };\n        }\n      }\n      \n      console.warn(`‚ö†Ô∏è –ì–æ—Ä–æ–¥ \"${normalizedCity}\" –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –î–õ`);\n      return null;\n      \n    } catch (error) {\n      console.error(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –≥–æ—Ä–æ–¥–∞ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –î–õ:`, error);\n      return null;\n    }\n  };\n  \n\n  \n  // –ü–æ–∏—Å–∫ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ —Ä–∞–±–æ—á–∏–π v1 API (–∏–∑ test-dellin-terminals-simple.js)\n  const getDellinTerminalByDirection = async (citySearch: string, direction: 'arrival' | 'derival'): Promise<string | null> => {\n    try {\n      console.log(`üîç –†–ê–ë–û–ß–ò–ô v1 API: –ü–æ–∏—Å–∫ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ ${direction} –¥–ª—è –≥–æ—Ä–æ–¥–∞: ${citySearch}`);\n      \n      // –ü–æ–ª—É—á–∞–µ–º sessionID –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞\n      const sessionID = await getDellinSessionId();\n      if (!sessionID) {\n        console.error('‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç sessionID –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤');\n        return null;\n      }\n      \n      // –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ —Ä–∞–±–æ—á–µ–º—É API\n      const requestData = {\n        appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n        sessionID: sessionID,\n        search: citySearch,\n        direction: direction\n      };\n      \n      console.log(`üì§ –ó–∞–ø—Ä–æ—Å —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤:`, requestData);\n      \n      const response = await fetch('https://api.dellin.ru/v1/public/request_terminals.json', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(requestData)\n      });\n      \n      const data = await response.json();\n      console.log(`üì• –û—Ç–≤–µ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ (${response.status}):`, data);\n      \n      if (!response.ok) {\n        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤:', data);\n        return null;\n      }\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –≤ –æ—Ç–≤–µ—Ç–µ\n      const terminals = data.terminals || [];\n      if (terminals.length === 0) {\n        console.warn(`‚ö†Ô∏è –¢–µ—Ä–º–∏–Ω–∞–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è –≥–æ—Ä–æ–¥–∞ \"${citySearch}\"`);\n        return null;\n      }\n      \n      // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª\n      const selectedTerminal = terminals[0];\n      \n      console.log(`‚úÖ –ù–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª ${direction}:`, {\n        id: selectedTerminal.id,\n        name: selectedTerminal.name,\n        address: selectedTerminal.address\n      });\n      \n      return selectedTerminal.id.toString();\n      \n    } catch (error) {\n      console.error(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ ${direction} (v1 API):`, error);\n      return null;\n    }\n  };\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ –¥–ª—è –≥–æ—Ä–æ–¥–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º)\n  const getDellinTerminal = async (citySearch: string): Promise<string | null> => {\n    return getDellinTerminalByDirection(citySearch, 'arrival');\n  };\n  \n  // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ DaData –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n  const normalizeAddressForDellin = async (address: string): Promise<string> => {\n    try {\n      console.log(`üåê –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ DaData: ${address}`);\n      \n      const response = await fetch('/api/dadata', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          address: address,\n          type: 'clean'\n        })\n      });\n      \n      const data = await response.json();\n      console.log(`üåê DaData response:`, data);\n      \n      if (data.success && data.data?.dellinFormat) {\n        console.log(`‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å: ${data.data.dellinFormat}`);\n        return data.data.dellinFormat;\n      }\n      \n      // –ï—Å–ª–∏ DaData –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∞–¥—Ä–µ—Å\n      console.warn(`‚ö†Ô∏è DaData –Ω–µ —Å–º–æ–≥ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π`);\n      return address;\n      \n    } catch (error) {\n      console.error(`‚ùå –û—à–∏–±–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ DaData:`, error);\n      return address; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∞–¥—Ä–µ—Å –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏\n    }\n  };\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ UID —É–ø–∞–∫–æ–≤–∫–∏ —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π workflow —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –î–õ\n  const getDellinPackageUid = async (packageName: string = 'crate_with_bubble'): Promise<string | null> => {\n    try {\n      console.log(`üì¶ CSV WORKFLOW: –ü–æ–ª—É—á–µ–Ω–∏–µ UID —É–ø–∞–∫–æ–≤–∫–∏ \"${packageName}\" —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π workflow...`);\n      console.log('üì¶ CSV WORKFLOW: API –î–õ ‚Üí CSV —Å—Å—ã–ª–∫–∞ ‚Üí —Å–∫–∞—á–∞—Ç—å CSV ‚Üí –ø–∞—Ä—Å–∏—Ç—å ‚Üí –ø–æ–ª—É—á–∏—Ç—å UID');\n      \n      const response = await fetch('/api/dellin-packages', {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n\n      const data = await response.json();\n      console.log('üì¶ CSV WORKFLOW response.ok:', response.ok);\n      console.log('üì¶ CSV WORKFLOW status:', response.status);\n      console.log('üì¶ CSV WORKFLOW workflow info:', data.workflow || 'not specified');\n      \n      if (response.ok && data.success && data.data && Array.isArray(data.data)) {\n        console.log('üì¶ CSV WORKFLOW: —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫');\n        console.log('üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–ø–∞–∫–æ–≤–æ–∫ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ:', data.data.length);\n        console.log('üì¶ –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:', data.cached ? '–∫—ç—à (24—á)' : '—Å–≤–µ–∂–∏–π CSV —Ñ–∞–π–ª');\n        if (data.csvUrl) {\n          console.log('üì¶ CSV URL:', data.csvUrl);\n        }\n        \n        // –ü–æ–∏—Å–∫ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –≤–∞—Ä–∏–∞–Ω—Ç–∞–º –Ω–∞–∑–≤–∞–Ω–∏—è\n        const searchTerms = [\n          packageName,\n          '–æ–±—Ä–µ—à–µ—Ç–∫–∞',\n          '–æ–±—Ä–µ—à—ë—Ç–∫–∞',\n          '–∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è',\n          'bubble',\n          '–∑–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞'\n        ];\n        \n        let foundPackage: any = null;\n        \n        for (const term of searchTerms) {\n          foundPackage = data.data.find((pkg: any) => \n            pkg.name && pkg.name.toLowerCase().includes(term.toLowerCase())\n          );\n          \n          if (foundPackage) {\n            console.log(`‚úÖ CSV WORKFLOW: –ù–∞–π–¥–µ–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∞ –ø–æ —Ç–µ—Ä–º–∏–Ω—É \"${term}\": ${foundPackage.name} ‚Üí ${foundPackage.uid}`);\n            break;\n          }\n        }\n        \n        if (foundPackage && foundPackage.uid) {\n          return foundPackage.uid;\n        } else {\n          console.log('‚ùå CSV WORKFLOW: –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –ø–æ –ø–æ–∏—Å–∫–æ–≤—ã–º —Ç–µ—Ä–º–∏–Ω–∞–º');\n          \n          // –í—ã–≤–æ–¥–∏–º –ø–µ—Ä–≤—ã–µ 10 —É–ø–∞–∫–æ–≤–æ–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n          console.log('üì¶ –î–æ—Å—Ç—É–ø–Ω—ã–µ —É–ø–∞–∫–æ–≤–∫–∏ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ (–ø–µ—Ä–≤—ã–µ 10):');\n          data.data.slice(0, 10).forEach((pkg: any, index: number) => {\n            console.log(`  ${index + 1}. ${pkg.name} (${pkg.uid})`);\n          });\n        }\n      } else {\n        console.error('‚ùå CSV WORKFLOW: –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞:', data);\n      }\n      \n      return null;\n        \n    } catch (error) {\n      console.error('‚ùå CSV WORKFLOW: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', error);\n      return null;\n    }\n  };\n\n  // –†–∞—Å—á–µ—Ç –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π —á–µ—Ä–µ–∑ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π API v2/calculator.json —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n  const calculateDellin = async (): Promise<CalculationResult> => {\n    const { enhancedApiRequest } = await import('@/lib/api-utils');\n    const apiUrl = 'https://api.dellin.ru/v2/calculator.json';\n    const maxRetries = 2;\n    \n    console.log('üöÄ === –ù–ê–ß–ê–õ–û –†–ê–°–ß–ï–¢–ê –î–ï–õ–û–í–´–• –õ–ò–ù–ò–ô ===');\n    console.log('üöÄ API URL:', apiUrl);\n    \n    try {\n      let sessionID = await getDellinSessionId();\n      \n      if (!sessionID) {\n        return {\n          company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n          price: 0,\n          days: 0,\n          error: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å sessionID',\n          apiUrl,\n          requestData: null,\n          responseData: null\n        };\n      }\n\n      // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏ –æ–±—ä–µ–º—ã\n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n      const totalVolume = form.cargos.reduce((sum, cargo) => \n        sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n      );\n      const maxLength = Math.max(...form.cargos.map(c => c.length)) / 100; // –≤ –º–µ—Ç—Ä–∞—Ö\n      const maxWidth = Math.max(...form.cargos.map(c => c.width)) / 100;\n      const maxHeight = Math.max(...form.cargos.map(c => c.height)) / 100;\n\n      // –ü–æ–ª—É—á–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª—ã –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∞–¥—Ä–µ—Å–∞\n      let fromTerminalId: string | null = null;\n      let toTerminalId: string | null = null;\n      let normalizedFromAddress: string | null = null;\n      let normalizedToAddress: string | null = null;\n      \n      // –î–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ–ª—É—á–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª—ã\n      if (!form.fromAddressDelivery) {\n        fromTerminalId = await getDellinTerminalByDirection(form.fromCity, 'derival');\n      } else {\n        // –î–ª—è –∞–¥—Ä–µ—Å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∞–¥—Ä–µ—Å\n        const addressToNormalize = form.fromAddress || form.fromCity;\n        normalizedFromAddress = await normalizeAddressForDellin(addressToNormalize);\n      }\n      \n      if (!form.toAddressDelivery) {\n        toTerminalId = await getDellinTerminalByDirection(form.toCity, 'arrival');\n      } else {\n        // –î–ª—è –∞–¥—Ä–µ—Å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∞–¥—Ä–µ—Å\n        const addressToNormalize = form.toAddress || form.toCity;\n        normalizedToAddress = await normalizeAddressForDellin(addressToNormalize);\n      }\n      \n      console.log('üè¢ –î–ê–ù–ù–´–ï –î–õ:');\n      console.log('üè¢ form.fromAddressDelivery:', form.fromAddressDelivery);\n      console.log('üè¢ form.toAddressDelivery:', form.toAddressDelivery);\n      console.log('üè¢ fromTerminalId:', fromTerminalId);\n      console.log('üè¢ toTerminalId:', toTerminalId);\n      console.log('üè¢ normalizedFromAddress:', normalizedFromAddress);\n      console.log('üè¢ normalizedToAddress:', normalizedToAddress);\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã –Ω–∞–π–¥–µ–Ω—ã –¢–û–õ–¨–ö–û –¥–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏\n      if (!form.fromAddressDelivery && !fromTerminalId) {\n        console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –≥–æ—Ä–æ–¥–∞:', form.fromCity);\n        return {\n          company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n          price: 0,\n          days: 0,\n          error: `–ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π –≤ –≥–æ—Ä–æ–¥–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è: ${form.fromCity}`,\n          apiUrl,\n          requestData: null,\n          responseData: null\n        };\n      }\n      \n      if (!form.toAddressDelivery && !toTerminalId) {\n        console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≥–æ—Ä–æ–¥–∞:', form.toCity);\n        return {\n          company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n          price: 0,\n          days: 0,\n          error: `–ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π –≤ –≥–æ—Ä–æ–¥–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: ${form.toCity}`,\n          apiUrl,\n          requestData: null,\n          responseData: null\n        };\n      }\n      \n      // –î–ª—è –∞–¥—Ä–µ—Å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∞–¥—Ä–µ—Å–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã\n      if (form.fromAddressDelivery && !normalizedFromAddress) {\n        console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è:', form.fromAddress || form.fromCity);\n        return {\n          company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n          price: 0,\n          days: 0,\n          error: `–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è: ${form.fromAddress || form.fromCity}`,\n          apiUrl,\n          requestData: null,\n          responseData: null\n        };\n      }\n      \n      if (form.toAddressDelivery && !normalizedToAddress) {\n        console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:', form.toAddress || form.toCity);\n        return {\n          company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n          price: 0,\n          days: 0,\n          error: `–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: ${form.toAddress || form.toCity}`,\n          apiUrl,\n          requestData: null,\n          responseData: null\n        };\n      }\n\n      // –ü–æ–ª—É—á–∞–µ–º UID —É–ø–∞–∫–æ–≤–∫–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∞)\n      // –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π UID –¥–ª—è —É–ø–∞–∫–æ–≤–∫–∏ —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º\n      let packageUid: string | null = null;\n      console.log('=== –ù–ê–ß–ê–õ–û –û–¢–õ–ê–î–ö–ò –£–ü–ê–ö–û–í–ö–ò ===');\n      console.log('üîç –û–¢–õ–ê–î–ö–ê –£–ü–ê–ö–û–í–ö–ò: form.needPackaging =', form.needPackaging);\n      console.log('üîç –û–¢–õ–ê–î–ö–ê –£–ü–ê–ö–û–í–ö–ò: typeof form.needPackaging =', typeof form.needPackaging);\n      \n      if (form.needPackaging) {\n        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π UID –¥–ª—è —É–ø–∞–∫–æ–≤–∫–∏\n        packageUid = '0xad97901b0ecef0f211e889fcf4624fec';\n        console.log('üîç ‚úÖ –£–ü–ê–ö–û–í–ö–ê –¢–†–ï–ë–£–ï–¢–°–Ø - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π UID:', packageUid);\n        console.log('üîç ‚úÖ typeof packageUid:', typeof packageUid);\n        console.log('üîç ‚úÖ packageUid truthy:', !!packageUid);\n      } else {\n        console.log('üîç ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ UID');\n      }\n      console.log('=== –ö–û–ù–ï–¶ –û–¢–õ–ê–î–ö–ò –£–ü–ê–ö–û–í–ö–ò ===');\n\n      // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞—Ç—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞\n      const tomorrow = new Date();\n      tomorrow.setDate(tomorrow.getDate() + 1);\n      const produceDate = tomorrow.toISOString().split('T')[0];\n\n      // –û—Ç–ª–∞–¥–∫–∞ –ø–µ—Ä–µ–¥ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–∞\n      console.log('=== –û–¢–õ–ê–î–ö–ê –§–û–†–ú–ò–†–û–í–ê–ù–ò–Ø –ó–ê–ü–†–û–°–ê ===');\n      console.log('üîç form.needPackaging =', form.needPackaging, '(—Ç–∏–ø:', typeof form.needPackaging, ')');\n      console.log('üîç packageUid =', packageUid, '(—Ç–∏–ø:', typeof packageUid, ')');\n      console.log('üîç packageUid truthy =', !!packageUid);\n      console.log('üîç –£—Å–ª–æ–≤–∏–µ (form.needPackaging && packageUid) =', form.needPackaging && packageUid);\n      \n      if (form.needPackaging && packageUid) {\n        console.log('‚úÖ PACKAGES –ë–£–î–ï–¢ –î–û–ë–ê–í–õ–ï–ù –í –ó–ê–ü–†–û–°!');\n      } else {\n        console.log('‚ùå PACKAGES –ù–ï –ë–£–î–ï–¢ –î–û–ë–ê–í–õ–ï–ù:');\n        if (!form.needPackaging) console.log('  - form.needPackaging = false');\n        if (!packageUid) console.log('  - packageUid –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç/null');\n      }\n\n      // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n      const requestData = {\n        appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n        sessionID: sessionID,\n        delivery: {\n          deliveryType: {\n            type: 'auto'  // –í—Å–µ–≥–¥–∞ \"auto\" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n          },\n          derival: {\n            produceDate: produceDate,  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –¥–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n            variant: form.fromAddressDelivery ? 'address' : 'terminal',\n            ...(form.fromAddressDelivery ? {\n              address: {\n                search: normalizedFromAddress || form.fromAddress || form.fromCity\n              }\n            } : {\n              terminalID: fromTerminalId\n            }),\n            time: {\n              worktimeStart: '10:00',\n              worktimeEnd: '18:00',\n              breakStart: '13:00',\n              breakEnd: '14:00',\n              exactTime: false\n            }\n            // handling –≤ derival –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n          },\n          arrival: {\n            variant: form.toAddressDelivery ? 'address' : 'terminal',\n            ...(form.toAddressDelivery ? {\n              address: {\n                search: normalizedToAddress || form.toAddress || form.toCity\n              }\n            } : {\n              terminalID: toTerminalId\n            }),\n            time: {\n              worktimeStart: '10:00',\n              worktimeEnd: '18:00',\n              breakStart: '13:00',\n              breakEnd: '14:00',\n              exactTime: false\n            },\n            // handling –≤ arrival –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—ä–µ–º\n            ...(form.needCarry ? {\n              handling: {\n                freightLift: form.hasFreightLift, // true —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –≥–∞–ª–æ—á–∫–∞ \"–Ω–∞–ª–∏—á–∏–µ –≥—Ä—É–∑–æ–≤–æ–≥–æ –ª–∏—Ñ—Ç–∞\"\n                toFloor: form.floor, // —ç—Ç–∞–∂ –∏–∑ —Ñ–æ—Ä–º—ã\n                carry: 0\n              }\n            } : {})\n          },\n          ...(form.needPackaging && packageUid ? {\n            packages: [{\n              uid: packageUid,  // UID —É–ø–∞–∫–æ–≤–∫–∏ crate_with_bubble –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞\n              count: 1  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1\n            }]\n          } : {})\n        },\n        cargo: {\n          quantity: form.cargos.length,\n          length: maxLength,\n          width: maxWidth,\n          height: maxHeight,\n          weight: totalWeight,\n          totalVolume: totalVolume,\n          totalWeight: totalWeight,\n          oversizedWeight: 0,\n          oversizedVolume: 0,\n          hazardClass: 0,  // –í—Å–µ–≥–¥–∞ 0 –µ—Å–ª–∏ –Ω–µ—Ç –æ–ø–∞—Å–Ω—ã—Ö –≥—Ä—É–∑–æ–≤\n          freightName: '–ú–µ–±–µ–ª—å',  // –ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ, –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–µ–µ —Å freightUID)\n          insurance: {\n            statedValue: form.declaredValue || 0,\n            term: true  // –í—Å–µ–≥–¥–∞ true –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n          }\n        },\n        payment: {\n          type: 'noncash',  // –í—Å–µ–≥–¥–∞ \"noncash\"\n          paymentCitySearch: {\n            search: form.fromCity  // –ì–æ—Ä–æ–¥ –æ–ø–ª–∞—Ç—ã\n          }\n        }\n      };\n\n      console.log('üöÄ –ò–¢–û–ì–û–í–´–ô –ó–ê–ü–†–û–° –ö –î–õ:', JSON.stringify(requestData, null, 2));\n      \n      // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∞ packages\n      if (requestData.delivery.packages) {\n        console.log('‚úÖ PACKAGES –ù–ê–ô–î–ï–ù –í –ó–ê–ü–†–û–°–ï:', requestData.delivery.packages);\n      } else {\n        console.log('‚ùå PACKAGES –ù–ï –ù–ê–ô–î–ï–ù –í –ó–ê–ü–†–û–°–ï');\n        console.log('   form.needPackaging =', form.needPackaging);\n        console.log('   packageUid =', packageUid);\n        console.log('   –£—Å–ª–æ–≤–∏–µ:', form.needPackaging && packageUid);\n      }\n\n      // –ü–æ–ø—ã—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö\n      let response: any = null;\n      let data: any = null;\n      \n      for (let attempt = 1; attempt <= maxRetries; attempt++) {\n        console.log(`üîÑ –î–õ: –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ ${attempt}/${maxRetries}`);\n        \n        const result = await enhancedApiRequest(\n          apiUrl,\n          {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n              'Accept': 'application/json'\n            },\n            body: JSON.stringify(requestData)\n          },\n          { operation: 'calculate', company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏' }\n        );\n\n        if (result && typeof result === 'object' && 'success' in result && !result.success) {\n          console.error('‚ùå –î–õ API –æ—à–∏–±–∫–∞:', result.error);\n          // For Dellin, we still want to handle retries manually for session renewal\n          // So we'll create a mock response that indicates failure\n          response = {\n            ok: false,\n            status: 500,\n            json: async () => ({ error: result.error.message })\n          } as any;\n          data = { error: result.error.message };\n        } else {\n          response = result as Response;\n          try {\n            data = await response.json();\n          } catch (parseError) {\n            console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –æ—Ç–≤–µ—Ç–∞ –î–õ:', parseError);\n            throw new Error(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ API: ${parseError instanceof Error ? parseError.message : '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);\n          }\n        }\n        \n        console.log('üöÄ –û–¢–í–ï–¢ –î–õ response.ok:', response.ok);\n        console.log('üöÄ –û–¢–í–ï–¢ –î–õ status:', response.status);\n        console.log('üöÄ –û–¢–í–ï–¢ –î–õ data:', data);\n        \n        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\n        const isAuthError = response.status === 401 || \n                           response.status === 403 ||\n                           (response.status === 400 && data?.errors?.some((err: any) => \n                             err.detail?.toLowerCase()?.includes('session') ||\n                             err.detail?.toLowerCase()?.includes('auth') ||\n                             err.detail?.toLowerCase()?.includes('invalid')\n                           ));\n\n        if (isAuthError && attempt < maxRetries) {\n          console.log('üîÑ –î–õ: –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –≤—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...');\n          const newSessionId = await getDellinSessionId();\n          if (newSessionId) {\n            console.log('‚úÖ –î–õ: –ø–æ–ª—É—á–µ–Ω –Ω–æ–≤—ã–π SessionID, –æ–±–Ω–æ–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å...');\n            // –û–±–Ω–æ–≤–ª—è–µ–º sessionID –≤ –∑–∞–ø—Ä–æ—Å–µ\n            requestData.sessionID = newSessionId;\n            sessionID = newSessionId;\n            continue; // –ü—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —Å –Ω–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n          } else {\n            console.error('‚ùå –î–õ: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π SessionID');\n            break;\n          }\n        }\n        \n        if (response.status === 400 && data?.errors) {\n          console.log('=== –ê–ù–ê–õ–ò–ó –û–®–ò–ë–ö–ò 400 ===');\n          console.log('üîç –û—à–∏–±–∫–∏:', data.errors);\n          data.errors.forEach((error: any, index: number) => {\n            console.log(`üîç –û—à–∏–±–∫–∞ ${index + 1}:`, error);\n            console.log(`   - –ü–æ–ª–µ: ${error.field || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`);\n            console.log(`   - –°–æ–æ–±—â–µ–Ω–∏–µ: ${error.detail || error.message || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`);\n          });\n          console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –û–®–ò–ë–ö–ò 400 ===');\n        }\n\n        // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–Ω—ã–π –∏–ª–∏ –Ω–µ —Å–≤—è–∑–∞–Ω —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É\n        break;\n      }\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –æ—à–∏–±–∫–∏ –ü–ï–†–ï–î –∞–Ω–∞–ª–∏–∑–æ–º –¥–∞–Ω–Ω—ã—Ö\n      if (!response.ok || !data.data) {\n        console.log('‚ùå –û—à–∏–±–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç API - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö');\n        const errorMessage = data.metadata?.detail || \n                           data.metadata?.message || \n                           data.errors?.[0]?.detail || \n                           (data.metadata?.status !== 200 ? `HTTP ${data.metadata?.status}` : '') ||\n                           `HTTP ${response.status} - ${response.statusText}` ||\n                           '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏';\n        return {\n          company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n          price: 0,\n          days: 0,\n          error: errorMessage,\n          requestData,\n          responseData: data,\n          apiUrl,\n          sessionId: sessionID\n        };\n      }\n      \n      // –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –°–¢–†–ê–•–û–í–ö–ò (—Ç–æ–ª—å–∫–æ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞)\n      console.log('=== –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –°–¢–†–ê–•–û–í–ö–ò ===');\n      console.log('üîç –ü–†–û–í–ï–†–ö–ê –°–¢–†–£–ö–¢–£–†–´ –î–ê–ù–ù–´–•:');\n      console.log('üîç data:', data ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n      console.log('üîç typeof data:', typeof data);\n      console.log('üîç data.data:', data?.data ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n      console.log('üîç typeof data.data:', typeof data?.data);\n      \n      // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–π—Å—Ç–≤ data.data\n      if (data?.data) {\n        console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤–æ–π—Å—Ç–≤–∞ data.data:');\n        console.log('üîç data.data.derival:', typeof data.data.derival, data.data.derival);\n        console.log('üîç data.data.arrival:', typeof data.data.arrival, data.data.arrival);\n        console.log('üîç data.data.intercity:', typeof data.data.intercity, data.data.intercity);\n      }\n      \n      if (!data) {\n        console.error('‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: data undefined/null');\n        return {\n          company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n          price: 0,\n          days: 0,\n          error: '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ API: –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã',\n          apiUrl,\n          requestData,\n          responseData: null\n        };\n      }\n      \n      try {\n        console.log('üîç –ü–û–õ–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê data.data:', JSON.stringify(data.data, null, 2));\n      } catch (jsonError) {\n        console.error('‚ùå –û—à–∏–±–∫–∞ JSON.stringify –¥–ª—è data.data:', jsonError);\n        console.log('üîç data.data (toString):', data.data?.toString?.() || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å');\n      }\n      \n      // –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç—Ä–∞—Ö–æ–≤–∫–æ–π\n      console.log('üí≥ –ü–û–ò–°–ö –ö–û–ú–ü–û–ù–ï–ù–¢–û–í –°–¢–†–ê–•–û–í–ö–ò:');\n      console.log('üí≥ data.data.insurance:', data.data?.insurance);\n      console.log('üí≥ data.data.cargoInsurance:', data.data?.cargoInsurance);\n      console.log('üí≥ data.data.termInsurance:', data.data?.termInsurance);\n      console.log('üí≥ data.data.insuranceDetails:', data.data?.insuranceDetails);\n      console.log('üí≥ data.data.services:', data.data?.services);\n      console.log('üí≥ data.data.additionalServices:', data.data?.additionalServices);\n      \n      // –ü–æ–∏—Å–∫ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏ –≤ –¥—Ä—É–≥–∏—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö\n      try {\n        console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º derival...');\n        if (data.data?.derival) {\n          console.log('üí≥ derival –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n          console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –ó–ê–ë–û–ï data.data.derival.insurance:', data.data.derival?.insurance);\n        } else {\n          console.log('üí≥ derival –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n        }\n        \n        console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º arrival...');\n        if (data.data?.arrival) {\n          console.log('üí≥ arrival –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n          console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –î–û–°–¢–ê–í–ö–ï data.data.arrival.insurance:', data.data.arrival?.insurance);\n        } else {\n          console.log('üí≥ arrival –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n        }\n        \n        console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º intercity...');\n        if (data.data?.intercity) {\n          console.log('üí≥ intercity –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n          console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –ü–ï–†–ï–í–û–ó–ö–ï data.data.intercity.insurance:', data.data.intercity?.insurance);\n        } else {\n          console.log('üí≥ intercity –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n        }\n      } catch (error) {\n        console.error('‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–µ–∫—Ü–∏–π —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏:', error);\n        console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', error instanceof Error ? error.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n      }\n      \n      // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö \"insurance\"\n      const findInsuranceFields = (obj: any, path = '') => {\n        if (typeof obj !== 'object' || obj === null || obj === undefined) return;\n        \n        try {\n          Object.keys(obj).forEach(key => {\n            const fullPath = path ? `${path}.${key}` : key;\n            if (key.toLowerCase().includes('insurance') || key.toLowerCase().includes('insur')) {\n              console.log(`üí≥ –ù–ê–ô–î–ï–ù–û –ü–û–õ–ï –°–¢–†–ê–•–û–í–ö–ò [${fullPath}]:`, obj[key]);\n            }\n            if (typeof obj[key] === 'object' && obj[key] !== null && obj[key] !== undefined) {\n              findInsuranceFields(obj[key], fullPath);\n            }\n          });\n        } catch (error) {\n          console.error(`üí≥ –û—à–∏–±–∫–∞ –≤ findInsuranceFields –¥–ª—è –ø—É—Ç–∏ ${path}:`, error);\n        }\n      };\n      \n      console.log('üí≥ –†–ï–ö–£–†–°–ò–í–ù–´–ô –ü–û–ò–°–ö –ü–û–õ–ï–ô –°–¢–†–ê–•–û–í–ö–ò:');\n      try {\n        if (data && data.data) {\n          findInsuranceFields(data.data, 'data.data');\n        } else {\n          console.log('üí≥ –ü—Ä–æ–ø—É—Å–∫ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞: data.data –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');\n        }\n      } catch (error) {\n        console.error('‚ùå –û–®–ò–ë–ö–ê –≤ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–º –ø–æ–∏—Å–∫–µ:', error);\n        console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', error instanceof Error ? error.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n      }\n      console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –°–¢–†–ê–•–û–í–ö–ò ===');\n      \n      // –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ packages –≤ –æ—Ç–≤–µ—Ç–µ\n      console.log('=== –ü–û–ò–°–ö PACKAGES –í –û–¢–í–ï–¢–ï ===');\n      console.log('üì¶ data.data =', data.data);\n      console.log('üì¶ data.data.packages =', data.data?.packages);\n      console.log('üì¶ –¢–∏–ø data.data.packages:', typeof data.data?.packages);\n      if (data.data?.packages) {\n        console.log('‚úÖ PACKAGES –ù–ê–ô–î–ï–ù –í –û–¢–í–ï–¢–ï!');\n        try {\n          console.log('üì¶ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ packages:', JSON.stringify(data.data.packages, null, 2));\n        } catch (jsonError) {\n          console.error('‚ùå –û—à–∏–±–∫–∞ JSON.stringify –¥–ª—è packages:', jsonError);\n          console.log('üì¶ packages (toString):', data.data.packages?.toString?.() || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å');\n        }\n      } else {\n        console.log('‚ùå PACKAGES –ù–ï –ù–ê–ô–î–ï–ù –í –û–¢–í–ï–¢–ï');\n      }\n      console.log('=== –ö–û–ù–ï–¶ –ü–û–ò–°–ö–ê PACKAGES ===');\n\n      if (response.ok && data.data && data.metadata?.status === 200) {\n        let totalPrice = data.data.price || 0;\n        console.log('üí∞ –†–ê–°–ß–ï–¢ –ò–¢–û–ì–û–í–û–ô –°–¢–û–ò–ú–û–°–¢–ò:');\n        console.log('üí∞ –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å data.data.price (–£–ñ–ï –í–ö–õ–Æ–ß–ê–ï–¢ –í–°–ï):', totalPrice);\n        \n        // –°–¢–†–ê–•–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n        if (data.data.insurance) {\n          console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ data.data.insurance (–£–ñ–ï –≤–∫–ª—é—á–µ–Ω–∞ –≤ –±–∞–∑–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):', data.data.insurance);\n          console.log('üí∞ –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞—Ö–æ–≤–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ');\n        } else {\n          console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–≤–µ—Ç–µ');\n        }\n        \n        // –£–ü–ê–ö–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n        console.log('üí∞ –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–ë –£–ü–ê–ö–û–í–ö–ï (–£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –í –û–°–ù–û–í–ù–£–Æ –°–¢–û–ò–ú–û–°–¢–¨):');\n        console.log('üí∞ data.data.packages =', data.data.packages);\n        console.log('üí∞ form.needPackaging =', form.needPackaging);\n        \n        if (data.data.packages && form.needPackaging) {\n          console.log('üí∞ ‚úÖ –£–ü–ê–ö–û–í–ö–ê –ü–†–ò–°–£–¢–°–¢–í–£–ï–¢ –í –û–¢–í–ï–¢–ï (—Ü–µ–Ω–∞ —É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ data.data.price)');\n          console.log('üí∞ –¢–∏–ø packages:', Array.isArray(data.data.packages) ? 'Array' : 'Object');\n          \n          if (Array.isArray(data.data.packages)) {\n            data.data.packages.forEach((pkg: any, index: number) => {\n              console.log(`üí∞ Package [${index}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n            });\n          } else {\n            Object.entries(data.data.packages).forEach(([key, pkg]: [string, any]) => {\n              console.log(`üí∞ Package [${key}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n            });\n          }\n        } else {\n          console.log('üí∞ ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∞—Å—å');\n        }\n\n        // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–∞–∫ —Ä–∞–∑–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –¥–∞—Ç–∞–º–∏ pickup –∏ arrivalToOspReceiver\n        let deliveryDays = 0;\n        try {\n          console.log('=== –ü–û–ò–°–ö –î–ê–¢ –í –û–¢–í–ï–¢–ï ===');\n          \n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–µ—Å—Ç–∞ –≥–¥–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–∞—Ç—ã\n          console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.pickup:', data.data?.pickup);\n          console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.pickup:', data.pickup);\n          console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.pickup:', data?.pickup);\n          console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.arrivalToOspReceiver:', data.data?.arrivalToOspReceiver);\n          console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.arrivalToOspReceiver:', data.arrivalToOspReceiver);\n          console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.arrivalToOspReceiver:', data?.arrivalToOspReceiver);\n          \n          // –ë–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–π –ø–æ–∏—Å–∫ –≤–æ –≤—Å–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ data\n          const findDateInObject = (obj: any, fieldName: string): string | null => {\n            if (!obj || typeof obj !== 'object') return null;\n            \n            for (const [key, value] of Object.entries(obj)) {\n              if (key === fieldName && typeof value === 'string') {\n                return value;\n              }\n              if (typeof value === 'object' && value !== null) {\n                const found = findDateInObject(value, fieldName);\n                if (found) return found;\n              }\n            }\n            return null;\n          };\n          \n          const pickup = findDateInObject(data, 'pickup');\n          const arrivalToOspReceiver = findDateInObject(data, 'arrivalToOspReceiver');\n          \n          console.log('–ù–ê–ô–î–ï–ù–ù–´–ï –î–ê–¢–´:');\n          console.log('pickup:', pickup);\n          console.log('arrivalToOspReceiver:', arrivalToOspReceiver);\n          \n          if (pickup && arrivalToOspReceiver) {\n            // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—ã (—Ñ–æ—Ä–º–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å \"2025-09-27\" –∏–ª–∏ \"2025-09-27 10:00:00\")\n            const pickupDate = new Date(pickup);\n            const arrivalDate = new Date(arrivalToOspReceiver);\n            \n            console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ pickup:', pickupDate);\n            console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ arrival:', arrivalDate);\n            \n            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã\n            if (!isNaN(pickupDate.getTime()) && !isNaN(arrivalDate.getTime())) {\n              // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–æ—Å—Ç—å –≤ –¥–Ω—è—Ö\n              const timeDiff = arrivalDate.getTime() - pickupDate.getTime();\n              deliveryDays = Math.max(1, Math.ceil(timeDiff / (1000 * 3600 * 24))); // –ú–∏–Ω–∏–º—É–º 1 –¥–µ–Ω—å\n              \n              console.log('–†–∞–∑–Ω–æ—Å—Ç—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö:', timeDiff);\n              console.log('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –í–´–ß–ò–°–õ–ï–ù —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:', deliveryDays, '–¥–Ω–µ–π');\n            } else {\n              console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞—Ç—ã –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞');\n              console.error('pickup Date object:', pickupDate);\n              console.error('arrival Date object:', arrivalDate);\n            }\n          } else {\n            console.warn('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ –Ω–∞–π–¥–µ–Ω—ã –¥–∞—Ç—ã pickup –∏–ª–∏ arrivalToOspReceiver');\n            console.log('pickup –Ω–∞–π–¥–µ–Ω:', !!pickup, pickup);\n            console.log('arrivalToOspReceiver –Ω–∞–π–¥–µ–Ω:', !!arrivalToOspReceiver, arrivalToOspReceiver);\n          }\n        } catch (error) {\n          console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –û—à–∏–±–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:', error);\n        }\n\n        console.log('üí∞ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ò–¢–û–ì–û–í–ê–Ø –°–¢–û–ò–ú–û–°–¢–¨:', Math.round(totalPrice));\n        \n        return {\n          company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n          price: Math.round(totalPrice),\n          days: deliveryDays || 0,\n          details: data.data || {},\n          requestData,\n          responseData: data,\n          apiUrl,\n          sessionId: sessionID\n        };\n      } else {\n        const errorMessage = data.metadata?.detail || \n                           data.metadata?.message || \n                           data.errors?.[0]?.detail || \n                           (data.metadata?.status !== 200 ? `HTTP ${data.metadata?.status}` : '') ||\n                           '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏';\n        return {\n          company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n          price: 0,\n          days: 0,\n          error: errorMessage,\n          requestData,\n          responseData: data,\n          apiUrl,\n          sessionId: sessionID\n        };\n      }\n    } catch (error: any) {\n      return {\n        company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n        price: 0,\n        days: 0,\n        error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n        requestData: null,\n        responseData: null,\n        apiUrl\n      };\n    }\n  };\n\n\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–Ω–æ–π –∑–æ–Ω—ã –∏ —Å–∫–ª–∞–¥–∞ –ü–≠–ö –ø–æ –∞–¥—Ä–µ—Å—É —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏\n  const getPekZoneByAddress = async (address: string) => {\n    try {\n      console.log(`üîç –ü–≠–ö: –ø–æ–∏—Å–∫ –∑–æ–Ω—ã –¥–ª—è –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n\n      const result = await enhancedApiRequest(\n        '/api/pek',\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            method: 'findzonebyaddress',\n            address: address\n          })\n        },\n        { operation: 'findzonebyaddress', company: '–ü–≠–ö' }\n      );\n\n      if (result && typeof result === 'object' && 'success' in result && !result.success) {\n        console.error(`‚ùå –ü–≠–ö API –æ—à–∏–±–∫–∞:`, result.error);\n        console.log(`üîÑ –ü–≠–ö: –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥—É –¥–ª—è \"${address}\"`);\n        return getPekZoneFallback(address);\n      }\n\n      const response = result as Response;\n      console.log(`üì° –ü–≠–ö API —Å—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`);\n\n      if (!response.ok) {\n        let errorData;\n        try {\n          errorData = await response.json();\n        } catch {\n          errorData = { error: '–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç' };\n        }\n\n        console.error(`‚ùå –ü–≠–ö API –æ—à–∏–±–∫–∞ ${response.status}:`, errorData);\n\n        // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫\n        if (response.status === 401) {\n          console.error('‚ùå –ü–≠–ö: –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω');\n        } else if (response.status === 404) {\n          console.error('‚ùå –ü–≠–ö: –ú–µ—Ç–æ–¥ API –Ω–µ –Ω–∞–π–¥–µ–Ω');\n        } else if (response.status === 400) {\n          console.error('‚ùå –ü–≠–ö: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞');\n        } else if (response.status >= 500) {\n          console.error('‚ùå –ü–≠–ö: –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ü–≠–ö');\n        }\n\n        console.log(`üîÑ –ü–≠–ö: –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥—É –¥–ª—è \"${address}\"`);\n        return getPekZoneFallback(address);\n      }\n\n      const data = await response.json();\n      console.log(`‚úÖ –ü–≠–ö –∑–æ–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞:`, data);\n\n      if (data.zoneId && data.mainWarehouseId) {\n        return {\n          zoneId: data.zoneId,\n          zoneName: data.zoneName,\n          branchUID: data.branchUID,\n          branchCode: data.branchCode,\n          branchTitle: data.branchTitle,\n          mainWarehouseId: data.mainWarehouseId,\n          warehousePoint: data.warehousePoint,\n          geoData: data.GeoData,\n          precision: data.GeoData?.precision\n        };\n      }\n\n      console.warn(`‚ö†Ô∏è –ü–≠–ö: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç:`, data);\n      return getPekZoneFallback(address);\n\n    } catch (error) {\n      console.error('‚ùå –ü–≠–ö: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∑–æ–Ω—ã:', error);\n      return getPekZoneFallback(address);\n    }\n  };\n\n  // –§–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–æ–Ω—ã –ü–≠–ö\n  const getPekZoneFallback = (address: string) => {\n    console.log(`üîÑ –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –∞–Ω–∞–ª–∏–∑ –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n    \n    const addressLower = address.toLowerCase();\n    \n    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –∏ –∏—Ö –¥–∞–Ω–Ω—ã–µ\n    const cityMappings: { [key: string]: any } = {\n      '–º–æ—Å–∫–≤–∞': {\n        zoneId: 'moscow-zone-001',\n        zoneName: '–ú–æ—Å–∫–≤–∞',\n        branchUID: 'moscow-branch-001',\n        branchCode: '–ú–°–ö',\n        branchTitle: '–ú–æ—Å–∫–≤–∞',\n        mainWarehouseId: 'dc6c746d-812d-11e4-bbfc-001999d8b3c5',\n        warehousePoint: {\n          latitude: 55.755826,\n          longitude: 37.6173\n        }\n      },\n      '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': {\n        zoneId: 'spb-zone-001',\n        zoneName: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n        branchUID: 'spb-branch-001',\n        branchCode: '–°–ü–ë',\n        branchTitle: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n        mainWarehouseId: 'b436c978-086d-11e6-b6ca-00155d668909',\n        warehousePoint: {\n          latitude: 59.9311,\n          longitude: 30.3609\n        }\n      },\n      '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': {\n        zoneId: 'ekb-zone-001',\n        zoneName: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',\n        branchUID: 'ekb-branch-001',\n        branchCode: '–ï–ö–ë',\n        branchTitle: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',\n        mainWarehouseId: 'f8d9c8e3-8e2d-11e4-bbfc-001999d8b3c5',\n        warehousePoint: {\n          latitude: 56.8431,\n          longitude: 60.6454\n        }\n      }\n    };\n    \n    for (const [city, data] of Object.entries(cityMappings)) {\n      if (addressLower.includes(city) || addressLower.includes(city.replace('-', ' '))) {\n        console.log(`‚úÖ –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –Ω–∞–π–¥–µ–Ω –≥–æ—Ä–æ–¥ ${city}`);\n        return {\n          ...data,\n          geoData: {\n            precision: 'fallback',\n            kind: 'locality'\n          },\n          precision: 'fallback'\n        };\n      }\n    }\n    \n    console.warn(`‚ùå –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –≥–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ \"${address}\"`);\n    return null;\n  };\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –ü–≠–ö\n  const getPekNearestDepartments = async (address: string, coordinates?: { latitude: string, longitude: string }) => {\n    try {\n      console.log(`üè¢ –ü–≠–ö: –ø–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –¥–ª—è \"${address}\"`);\n\n      const requestBody: any = {\n        departmentOperation: 3, // –≤—ã–¥–∞—á–∞ –≥—Ä—É–∑–æ–≤\n        type: 3, // –∞–≤—Ç–æ-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç\n        searchRadius: 50, // –∫–º\n        limit: 5\n      };\n\n      // –ü–≠–ö API —Ç—Ä–µ–±—É–µ—Ç –∏ –∞–¥—Ä–µ—Å, –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ\n      requestBody.address = address;\n\n      if (coordinates) {\n        requestBody.coordinates = coordinates;\n        console.log(`üìç –ü–≠–ö: –ø–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\" –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º`, coordinates);\n      } else {\n        console.log(`üìç –ü–≠–ö: –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\"`);\n      }\n\n      const result = await enhancedApiRequest(\n        '/api/pek',\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            method: 'nearestdepartments',\n            ...requestBody\n          })\n        },\n        { operation: 'nearestdepartments', company: '–ü–≠–ö' }\n      );\n\n      if (result && typeof result === 'object' && 'success' in result && !result.success) {\n        console.error(`‚ùå –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API –æ—à–∏–±–∫–∞:`, result.error);\n        return null;\n      }\n\n      const response = result as Response;\n      console.log(`üì° –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API —Å—Ç–∞—Ç—É—Å: ${response.status}`);\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error(`‚ùå –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API –æ—à–∏–±–∫–∞: ${response.status} ${response.statusText}`);\n        console.error(`‚ùå –û—Ç–≤–µ—Ç:`, errorText.substring(0, 500));\n        return null;\n      }\n\n      const data = await response.json();\n      console.log(`‚úÖ –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–∞–π–¥–µ–Ω—ã:`, data);\n\n      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤–æ–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ —Å –Ω–∞–∏–≤—ã—Å—à–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º\n      if (data.freeDepartments && data.freeDepartments.length > 0) {\n        const bestDepartment = data.freeDepartments.sort((a: any, b: any) => b.priority - a.priority)[0];\n        console.log(`‚úÖ –ü–≠–ö: –≤—ã–±—Ä–∞–Ω–æ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ`, bestDepartment.divisionName);\n        return {\n          warehouseId: bestDepartment.warehouseId,\n          branchId: bestDepartment.branchId,\n          branchName: bestDepartment.branchName,\n          divisionName: bestDepartment.divisionName,\n          address: bestDepartment.address,\n          coordinates: bestDepartment.coordinates,\n          phone: bestDepartment.phone,\n          email: bestDepartment.email\n        };\n      }\n\n      console.warn(`‚ùå –ü–≠–ö: –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è \"${address}\"`);\n      return null;\n    } catch (error) {\n      console.error('‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –æ—Ç–¥–µ–ª–µ–Ω–∏–π:', error);\n      return null;\n    }\n  };\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ü–≠–ö)\n  const getYandexCoordinates = async (address: string): Promise<{ latitude: string, longitude: string } | null> => {\n    try {\n      const encodedAddress = encodeURIComponent(address);\n      const response = await fetch(`https://geocode-maps.yandex.ru/1.x/?apikey=YOUR_API_KEY&geocode=${encodedAddress}&format=json`);\n      \n      if (!response.ok) return null;\n      \n      const data = await response.json();\n      const coords = data?.response?.GeoObjectCollection?.featureMember?.[0]?.GeoObject?.Point?.pos?.split(' ');\n      \n      if (coords && coords.length === 2) {\n        return {\n          longitude: coords[0],\n          latitude: coords[1]\n        };\n      }\n      \n      return null;\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ø–Ω–¥–µ–∫—Å:', error);\n      return null;\n    }\n  };\n\n  // –†–∞—Å—á–µ—Ç –¥–ª—è –ü–≠–ö —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API v1/calculateprice/\n  const calculatePEK = async (): Promise<CalculationResult> => {\n    const apiUrl = 'https://kabinet.pecom.ru/api/v1/calculateprice/';\n    \n    // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç\n    const validateCoordinates = (coords: any) => {\n      console.log('üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:', coords);\n      \n      if (!coords) {\n        console.log('‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç');\n        return null;\n      }\n      \n      if (typeof coords.latitude !== 'number' || typeof coords.longitude !== 'number') {\n        console.warn(`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ —è–≤–ª—è—é—Ç—Å—è —á–∏—Å–ª–∞–º–∏:`, { \n          lat: coords.latitude, \n          lng: coords.longitude,\n          latType: typeof coords.latitude,\n          lngType: typeof coords.longitude\n        });\n        return null;\n      }\n      \n      const lat = Number(coords.latitude);\n      const lng = Number(coords.longitude);\n      \n      console.log(`üìç –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: lat=${lat}, lng=${lng}`);\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω—ã\n      if (lat < -90 || lat > 90 || lng < -180 || lng > 180 || isNaN(lat) || isNaN(lng)) {\n        console.warn(`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–Ω–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞:`, { \n          lat, lng, \n          latValid: lat >= -90 && lat <= 90,\n          lngValid: lng >= -180 && lng <= 180,\n          latIsNaN: isNaN(lat),\n          lngIsNaN: isNaN(lng)\n        });\n        return null;\n      }\n      \n      console.log('‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã:', { latitude: lat, longitude: lng });\n      return { latitude: lat, longitude: lng };\n    };\n    \n    try {\n      // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–æ–Ω–∞—Ö –∏ —Å–∫–ª–∞–¥–∞—Ö –ø–æ –∞–¥—Ä–µ—Å–∞–º\n      console.log(`üöÄ –ü–≠–ö: –Ω–∞—á–∏–Ω–∞–µ–º —Ä–∞—Å—á–µ—Ç`);\n      console.log(`üìç –û—Ç: ${form.fromAddress || form.fromCity}`);\n      console.log(`üìç –î–æ: ${form.toAddress || form.toCity}`);\n      \n      const senderZone = await getPekZoneByAddress(form.fromAddress || `–≥ ${form.fromCity}`);\n      const receiverZone = await getPekZoneByAddress(form.toAddress || `–≥ ${form.toCity}`);\n      \n      console.log(`üîç –ü–≠–ö –∑–æ–Ω—ã:`);\n      console.log(`üìç –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å:`, senderZone ? `${senderZone.branchTitle} (${senderZone.mainWarehouseId})` : '–ù–ï –ù–ê–ô–î–ï–ù–ê');\n      console.log(`üìç –ü–æ–ª—É—á–∞—Ç–µ–ª—å:`, receiverZone ? `${receiverZone.branchTitle} (${receiverZone.mainWarehouseId})` : '–ù–ï –ù–ê–ô–î–ï–ù–ê');\n      \n      if (!senderZone || !receiverZone) {\n        // –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞\n        const debugInfo = {\n          senderAddress: form.fromAddress || form.fromCity,\n          receiverAddress: form.toAddress || form.toCity,\n          senderZoneFound: !!senderZone,\n          receiverZoneFound: !!receiverZone,\n          apiTested: true\n        };\n        \n        console.error(`‚ùå –ü–≠–ö: –∑–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã`, debugInfo);\n        \n        return {\n          company: '–ü–≠–ö',\n          price: 0,\n          days: 0,\n          error: `–ó–æ–Ω–∞ –ü–≠–ö –Ω–µ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥—Ä–µ—Å–∞: ${!senderZone ? (form.fromAddress || form.fromCity) : ''} ${!receiverZone ? (form.toAddress || form.toCity) : ''}`.trim(),\n          apiUrl,\n          requestData: debugInfo,\n          responseData: { senderZone, receiverZone }\n        };\n      }\n\n      // –ü–æ–ª—É—á–∞–µ–º –±–ª–∏–∂–∞–π—à–∏–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –∞–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞\n      let senderWarehouseId = senderZone.mainWarehouseId;\n      let receiverWarehouseId = receiverZone.mainWarehouseId;\n      \n      if (form.fromAddressDelivery && senderZone.warehousePoint) {\n        const validSenderCoords = validateCoordinates(senderZone.warehousePoint);\n        if (validSenderCoords) {\n          try {\n            const senderDepartment = await getPekNearestDepartments(\n              form.fromAddress || form.fromCity,\n              {\n                latitude: validSenderCoords.latitude.toString(),\n                longitude: validSenderCoords.longitude.toString()\n              }\n            );\n            if (senderDepartment) {\n              senderWarehouseId = senderDepartment.warehouseId;\n              console.log('‚úÖ –ù–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π —Å–∫–ª–∞–¥ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è:', senderDepartment.warehouseId);\n            }\n          } catch (error) {\n            console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥:', error);\n          }\n        } else {\n          console.warn('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥');\n        }\n      }\n      \n      if (form.toAddressDelivery && receiverZone.warehousePoint) {\n        const validReceiverCoords = validateCoordinates(receiverZone.warehousePoint);\n        if (validReceiverCoords) {\n          try {\n            const receiverDepartment = await getPekNearestDepartments(\n              form.toAddress || form.toCity,\n              {\n                latitude: validReceiverCoords.latitude.toString(),\n                longitude: validReceiverCoords.longitude.toString()\n              }\n            );\n            if (receiverDepartment) {\n              receiverWarehouseId = receiverDepartment.warehouseId;\n              console.log('‚úÖ –ù–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π —Å–∫–ª–∞–¥ –ø–æ–ª—É—á–∞—Ç–µ–ª—è:', receiverDepartment.warehouseId);\n            }\n          } catch (error) {\n            console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥:', error);\n          }\n        } else {\n          console.warn('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥');\n        }\n      }\n\n      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞—Ç—ã N –¥–Ω–µ–π –æ—Ç —Å–µ–≥–æ–¥–Ω—è\n      const getDateForCalculation = (daysFromToday: number): string => {\n        const date = new Date();\n        date.setDate(date.getDate() + daysFromToday);\n        return date.toISOString().slice(0, 19); // 2025-09-28T14:00:00\n      };\n\n      // –ù–∞—á–∏–Ω–∞–µ–º —Å –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–≥–æ –¥–Ω—è\n      let currentDayOffset = 1;\n      let plannedDateTime = getDateForCalculation(currentDayOffset);\n\n      // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤ (–±–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç)\n      const cargos = form.cargos.map(cargo => {\n        const cargoData = {\n          length: cargo.length / 100, // –ø–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–µ—Ç—Ä—ã\n          width: cargo.width / 100,\n          height: cargo.height / 100,\n          volume: (cargo.length * cargo.width * cargo.height) / 1000000, // –º3\n          weight: cargo.weight,\n          isHP: form.needPackaging, // –∑–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n          sealingPositionsCount: 0\n        };\n        \n        console.log('üì¶ –ì—Ä—É–∑ –¥–ª—è –ü–≠–ö:', cargoData);\n        return cargoData;\n      });\n\n      // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (–Ω—É–∂–Ω–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ)\n      let finalRequestData: any = null;\n      \n      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ —Ä–∞—Å—á–µ—Ç–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç–æ–π\n      const tryCalculateWithDate = async (plannedDateTime: string): Promise<any> => {\n        // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –∫ API –ü–≠–ö —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n        const requestData: any = {\n          currencyCode: \"643\", // —Ä—É–±–ª–∏\n          types: [3], // —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ –ø–µ—Ä–µ–≤–æ–∑–∫–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –º–∞—Å—Å–∏–≤)\n          senderWarehouseId,\n          receiverWarehouseId,\n          isOpenCarSender: false,\n          isOpenCarReceiver: false,\n          isHyperMarket: false,\n          plannedDateTime,\n          isInsurance: form.needInsurance && form.declaredValue > 0,\n          isInsurancePrice: form.needInsurance ? form.declaredValue : 0,\n          isPickUp: form.fromAddressDelivery,\n          isDelivery: form.toAddressDelivery,\n          needReturnDocuments: false,\n          needArrangeTransportationDocuments: false,\n          senderDistanceType: 0,\n          receiverDistanceType: 0,\n          cargos // –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤\n        };\n        \n        console.log('üìã –ü–≠–ö: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ requestData:', JSON.stringify(requestData, null, 2));\n\n        // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏ –ü–†–† –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\n        if (form.needCarry) {\n          requestData.pickupServices = {\n            isLoading: true,\n            floor: Math.max(0, form.floor - 1), // –ü–≠–ö —Å—á–∏—Ç–∞–µ—Ç —Å 0\n            carryingDistance: 0,\n            isElevator: form.hasFreightLift\n          };\n          requestData.deliveryServices = {\n            isLoading: true,\n            floor: Math.max(0, form.floor - 1),\n            carryingDistance: 0,\n            isElevator: form.hasFreightLift\n          };\n        }\n\n        // –î–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫–∏ pickup/delivery —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ü–≠–ö\n        if (form.fromAddressDelivery) {\n          console.log('üìç –ü–≠–ö: –¥–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ pickup –¥–ª—è –∑–∞–±–æ—Ä–∞');\n          requestData.pickup = {\n            address: form.fromAddress || `–†–æ—Å—Å–∏—è, ${form.fromCity}`\n            // coordinates –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏\n          };\n        }\n        \n        if (form.toAddressDelivery) {\n          console.log('üìç –ü–≠–ö: –¥–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ delivery –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏');\n          requestData.delivery = {\n            address: form.toAddress || `–†–æ—Å—Å–∏—è, ${form.toCity}`\n            // coordinates –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏\n          };\n        }\n\n        // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n        const requiredFields = ['types', 'senderWarehouseId', 'receiverWarehouseId', 'plannedDateTime', 'cargos'];\n        const missingFields = requiredFields.filter(field => !requestData[field]);\n        \n        if (missingFields.length > 0) {\n          throw new Error(`–ü–≠–ö: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: ${missingFields.join(', ')}`);\n        }\n        \n        if (!Array.isArray(requestData.types) || requestData.types.length === 0) {\n          throw new Error('–ü–≠–ö: –ø–æ–ª–µ types –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º');\n        }\n        \n        if (!Array.isArray(requestData.cargos) || requestData.cargos.length === 0) {\n          throw new Error('–ü–≠–ö: –ø–æ–ª–µ cargos –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º');\n        }\n        \n        console.log('‚úÖ –ü–≠–ö: –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –ø—Ä–æ–π–¥–µ–Ω–∞');\n\n        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏\n        finalRequestData = {\n          method: 'calculateprice',\n          ...requestData\n        };\n        \n        console.log('üöÄ –ü–≠–ö API –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å:', JSON.stringify(finalRequestData, null, 2));\n        console.log('üåê –ü–≠–ö API URL:', apiUrl);\n        console.log('üìã –ü–≠–ö: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–ø–æ–≤ —Ç–∞—Ä–∏—Ñ–æ–≤:', requestData.types.length);\n        console.log('üìã –ü–≠–ö: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤:', requestData.cargos.length);\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π\n      if (finalRequestData.pickup?.coordinates) {\n        console.log('üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã pickup:', finalRequestData.pickup.coordinates);\n      }\n      if (finalRequestData.delivery?.coordinates) {\n        console.log('üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã delivery:', finalRequestData.delivery.coordinates);\n      }\n\n       const result = await enhancedApiRequest(\n         '/api/pek',\n         {\n           method: 'POST',\n           headers: {\n             'Content-Type': 'application/json',\n           },\n           body: JSON.stringify(finalRequestData)\n         },\n         { operation: 'calculateprice', company: '–ü–≠–ö' }\n       );\n\n       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n         console.error('‚ùå –ü–≠–ö API —Ä–∞—Å—á–µ—Ç –æ—à–∏–±–∫–∞:', result.error);\n         throw new Error(result.error.userMessage || result.error.message);\n       }\n\n       const response = result as Response;\n       console.log(`üì° –ü–≠–ö API —Ä–∞—Å—á–µ—Ç —Å—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`);\n       console.log(`üì° –ü–≠–ö API URL: ${response.url}`);\n\n       const responseText = await response.text();\n       console.log(`üì° –ü–≠–ö API —Å—ã—Ä–æ–π –æ—Ç–≤–µ—Ç:`, responseText.substring(0, 1000));\n\n       let data;\n       try {\n         data = JSON.parse(responseText);\n         console.log('üöÄ –ü–≠–ö API –æ—Ç–≤–µ—Ç:', JSON.stringify(data, null, 2));\n       } catch (parseError) {\n         console.error('‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', parseError);\n         throw new Error(`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç API: ${responseText.substring(0, 200)}`);\n       }\n\n        return { response, data };\n      };\n\n      // –î–æ–±–∞–≤–ª—è–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞—Å—á–µ—Ç–∞\n      console.log('üîß –ü–≠–ö: –≥–æ—Ç–æ–≤–∏–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞...');\n      console.log('üìç senderWarehouseId:', senderWarehouseId);\n      console.log('üìç receiverWarehouseId:', receiverWarehouseId);\n      console.log('üìÖ –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞:', plannedDateTime);\n      console.log('üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤:', cargos.length);\n      console.log('üîß form.fromAddressDelivery:', form.fromAddressDelivery);\n      console.log('üîß form.toAddressDelivery:', form.toAddressDelivery);\n      \n      // –¶–∏–∫–ª –ø–æ–ø—ã—Ç–æ–∫ —Å —Ä–∞–∑–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏ (–º–∞–∫—Å–∏–º—É–º 7 –¥–Ω–µ–π)\n      const maxRetries = 7;\n      let lastError: Error | null = null;\n      \n      console.log('üöÄ –ü–≠–ö: –∑–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª —Ä–∞—Å—á–µ—Ç–∞...');\n      \n      for (let attempt = 0; attempt < maxRetries; attempt++) {\n        try {\n          console.log(`üìÖ –ü–≠–ö: –ø–æ–ø—ã—Ç–∫–∞ ${attempt + 1}/${maxRetries}, –¥–∞—Ç–∞: ${plannedDateTime}`);\n          \n          const { response, data } = await tryCalculateWithDate(plannedDateTime);\n          \n          if (response.ok && !data.hasError && data.transfers && data.transfers.length > 0) {\n            const transfer = data.transfers[0]; // –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Ç–∞—Ä–∏—Ñ (–∞–≤—Ç–æ)\n            \n            if (!transfer.hasError) {\n          // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —É—Å–ª—É–≥\n          const services: { name: string; description: string; price: number }[] = [];\n          let totalCalculated = 0;\n\n          const processServices = (servicesList: any[], parentName = '') => {\n            servicesList.forEach(service => {\n              const serviceName = parentName ? `${parentName} - ${service.info}` : service.info;\n              const serviceCost = parseFloat(service.cost) || 0;\n              \n              if (serviceCost > 0) {\n                services.push({\n                  name: serviceName,\n                  description: service.serviceType || '',\n                  price: serviceCost\n                });\n                totalCalculated += serviceCost;\n              }\n\n              // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏\n              if (service.services && Array.isArray(service.services)) {\n                processServices(service.services, serviceName);\n              }\n            });\n          };\n\n          if (transfer.services) {\n            processServices(transfer.services);\n          }\n\n          // –ï—Å–ª–∏ –Ω–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —É—Å–ª—É–≥, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n          if (services.length === 0) {\n            services.push({\n              name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n              description: `${senderZone.branchTitle} - ${receiverZone.branchTitle}`,\n              price: Math.round(transfer.costTotal)\n            });\n          }\n\n          return {\n            company: '–ü–≠–ö',\n            price: Math.round(transfer.costTotal),\n            days: transfer.estDeliveryTime || 3,\n            details: {\n              note: `–î–æ—Å—Ç–∞–≤–∫–∞ ${senderZone.branchTitle} - ${receiverZone.branchTitle} (–∞–≤—Ç–æ)`,\n              services,\n              senderZone: {\n                title: senderZone.branchTitle,\n                zone: senderZone.zoneName,\n                warehouseId: senderWarehouseId\n              },\n              receiverZone: {\n                title: receiverZone.branchTitle,\n                zone: receiverZone.zoneName,\n                warehouseId: receiverWarehouseId\n              }\n            },\n            requestData: finalRequestData,\n            responseData: data,\n            apiUrl\n              };\n            } else {\n              // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ–±–ª–µ–º–æ–π —Å –¥–∞—Ç–æ–π\n              const errorMessage = transfer.errorMessage || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞ –ü–≠–ö';\n              if (errorMessage.includes('–∑–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω') || errorMessage.includes('–≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã')) {\n                console.log(`üìÖ –ü–≠–ö: ${errorMessage}. –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...`);\n                lastError = new Error(errorMessage);\n                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é\n                currentDayOffset++;\n                plannedDateTime = getDateForCalculation(currentDayOffset);\n                continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –¥–∞—Ç—É\n              } else {\n                throw new Error(errorMessage);\n              }\n            }\n          } else {\n            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—à–∏–±–∫—É –Ω–∞ —É—Ä–æ–≤–Ω–µ –¥–∞–Ω–Ω—ã—Ö\n            const errorMessage = data.errorMessage || data.message || '–û—à–∏–±–∫–∞ API –ü–≠–ö';\n            if (errorMessage.includes('–∑–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω') || errorMessage.includes('–≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã')) {\n              console.log(`üìÖ –ü–≠–ö: ${errorMessage}. –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...`);\n              lastError = new Error(errorMessage);\n              // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é\n              currentDayOffset++;\n              plannedDateTime = getDateForCalculation(currentDayOffset);\n              continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –¥–∞—Ç—É\n            } else {\n              throw new Error(errorMessage);\n            }\n          }\n        } catch (error: any) {\n          console.error(`‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –Ω–∞ –ø–æ–ø—ã—Ç–∫–µ ${attempt + 1}:`, error.message);\n          \n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ–±–ª–µ–º–æ–π —Å –¥–∞—Ç–æ–π\n          if (error.message?.includes('–∑–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω') || error.message?.includes('–≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã')) {\n            console.log(`üìÖ –ü–≠–ö: –ø—Ä–æ–±–ª–µ–º–∞ —Å –¥–∞—Ç–æ–π. –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...`);\n            lastError = error;\n            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é\n            currentDayOffset++;\n            plannedDateTime = getDateForCalculation(currentDayOffset);\n            continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –¥–∞—Ç—É\n          } else {\n            // –î—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞ - –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ä–∞–∑—É\n            throw error;\n          }\n        }\n      }\n      \n      // –ï—Å–ª–∏ –¥–æ—à–ª–∏ –¥–æ —Å—é–¥–∞ - –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã\n      console.error(`‚ùå –ü–≠–ö: –≤—Å–µ ${maxRetries} –ø–æ–ø—ã—Ç–æ–∫ –∏—Å—á–µ—Ä–ø–∞–Ω—ã. –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞:`, lastError?.message);\n      throw lastError || new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—É—é –¥–∞—Ç—É –¥–ª—è –∑–∞–±–æ—Ä–∞ –≥—Ä—É–∑–∞');\n      \n    } catch (error: any) {\n      console.error('üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ü–≠–ö API:', error);\n      \n      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –æ—à–∏–±–∫–∏\n      let errorDescription = '–û—à–∏–±–∫–∞ API –ü–≠–ö';\n      \n      if (error.message?.includes('Failed to fetch')) {\n        errorDescription = 'API –ü–≠–ö –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';\n      } else if (error.message?.includes('401')) {\n        errorDescription = '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ü–≠–ö';\n      } else if (error.message?.includes('400')) {\n        errorDescription = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞';\n      } else if (error.message?.includes('timeout')) {\n        errorDescription = '–¢–∞–π–º-–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ API';\n      }\n      \n      console.error(`üö® –ü–≠–ö: ${errorDescription}. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ñ–æ–ª–ª–±—ç–∫ —Ä–∞—Å—á–µ—Ç—É`);\n      \n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n      const totalVolume = form.cargos.reduce((sum, cargo) => \n        sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n      );\n      \n      // –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π —Ñ–æ–ª–ª–±—ç–∫ —Ä–∞—Å—á–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Å–∞ –∏ –æ–±—ä–µ–º–∞\n      let basePrice = Math.max(\n        totalWeight * 18, // 18 —Ä—É–± –∑–∞ –∫–≥\n        totalVolume * 4500 // 4500 —Ä—É–± –∑–∞ –º3\n      );\n      \n      // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏\n      const services: { name: string; description: string; price: number }[] = [];\n      \n      services.push({\n        name: '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞',\n        description: `${form.fromCity} - ${form.toCity} (${totalWeight} –∫–≥, ${totalVolume.toFixed(3)} –º¬≥)`,\n        price: Math.round(basePrice)\n      });\n      \n      if (form.fromAddressDelivery) {\n        const pickupCost = 600;\n        basePrice += pickupCost;\n        services.push({\n          name: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n          description: '–û—Ç –∞–¥—Ä–µ—Å–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è',\n          price: pickupCost\n        });\n      }\n      \n      if (form.toAddressDelivery) {\n        const deliveryCost = 600;\n        basePrice += deliveryCost;\n        services.push({\n          name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n          description: '–î–æ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è',\n          price: deliveryCost\n        });\n      }\n      \n      if (form.needInsurance && form.declaredValue > 0) {\n        const insuranceCost = form.declaredValue * 0.012;\n        basePrice += insuranceCost;\n        services.push({\n          name: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ',\n          description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n          price: Math.round(insuranceCost)\n        });\n      }\n      \n      if (form.needPackaging) {\n        const packagingCost = totalWeight * 25;\n        basePrice += packagingCost;\n        services.push({\n          name: '–ó–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞',\n          description: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n          price: Math.round(packagingCost)\n        });\n      }\n      \n      if (form.needCarry) {\n        const carryCost = 500;\n        basePrice += carryCost;\n        services.push({\n          name: '–ü–æ–¥—ä–µ–º –Ω–∞ —ç—Ç–∞–∂',\n          description: `–ù–∞ ${form.floor} —ç—Ç–∞–∂ ${form.hasFreightLift ? '(—Å –ª–∏—Ñ—Ç–æ–º)' : '(–±–µ–∑ –ª–∏—Ñ—Ç–∞)'}`,\n          price: carryCost\n        });\n      }\n      \n      return {\n        company: '–ü–≠–ö',\n        price: Math.round(basePrice),\n        days: 3,\n        details: {\n          note: '–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º –ü–≠–ö (API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)',\n          services,\n          totalWeight,\n          totalVolume,\n          errorInfo: error.message\n        },\n        requestData: null,\n        responseData: null,\n        apiUrl,\n        error: `${errorDescription}. –ü–æ–∫–∞–∑–∞–Ω –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º.`\n      };\n    }\n  };\n\n\n\n  // üîß –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö\n  const calculateOptimalLength = (cargos: typeof form.cargos) => {\n    if (cargos.length === 1) {\n      return cargos[0].length / 100; // –û–¥–Ω–æ –º–µ—Å—Ç–æ - —Ç–æ—á–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã\n    }\n    \n    // –î–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç:\n    const maxLength = Math.max(...cargos.map(c => c.length)) / 100;\n    const totalLength = cargos.reduce((sum, c) => sum + c.length, 0) / 100;\n    \n    // –ï—Å–ª–∏ –º–µ—Å—Ç –º–Ω–æ–≥–æ (>3), –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É–º–º–∞—Ä–Ω—É—é –¥–ª–∏–Ω—É (–º–µ—Å—Ç–∞ –≤ —Ä—è–¥)\n    // –ò–Ω–∞—á–µ - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é (–º–µ—Å—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ)\n    return cargos.length > 3 ? totalLength : maxLength;\n  };\n\n  const calculateOptimalWidth = (cargos: typeof form.cargos) => {\n    // –î–ª—è —à–∏—Ä–∏–Ω—ã –ª–æ–≥–∏—á–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é\n    return Math.max(...cargos.map(c => c.width)) / 100;\n  };\n\n  const calculateOptimalHeight = (cargos: typeof form.cargos) => {\n    if (cargos.length === 1) {\n      return cargos[0].height / 100;\n    }\n    \n    const maxHeight = Math.max(...cargos.map(c => c.height)) / 100;\n    const totalHeight = cargos.reduce((sum, c) => sum + c.height, 0) / 100;\n    \n    // –ï—Å–ª–∏ –º–Ω–æ–≥–æ –º–µ–ª–∫–∏—Ö –º–µ—Å—Ç - –º–æ–∂–µ–º —Å—Ç–∞–∫–∏—Ä–æ–≤–∞—Ç—å\n    const avgHeight = totalHeight / cargos.length;\n    return avgHeight < 0.5 ? totalHeight : maxHeight; // 50—Å–º –ø–æ—Ä–æ–≥ –¥–ª—è —Å—Ç–∞–∫–∏—Ä–æ–≤–∞–Ω–∏—è\n  };\n\n  // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç\n  const validateMultipleCargos = (cargos: typeof form.cargos) => {\n    if (!cargos || cargos.length === 0) {\n      throw new Error('–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≥—Ä—É–∑–æ–≤—ã–µ –º–µ—Å—Ç–∞');\n    }\n    \n    if (cargos.length > 50) {\n      throw new Error(`–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç (${cargos.length}). –ú–∞–∫—Å–∏–º—É–º: 50`);\n    }\n    \n    const totalVolume = cargos.reduce((sum, cargo) => \n      sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n    );\n    \n    if (totalVolume > 100) {\n      console.warn('‚ö†Ô∏è –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π –æ–±—ä–µ–º –≥—Ä—É–∑–∞ (>100 –º¬≥). –í–æ–∑–º–æ–∂–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.');\n    }\n    \n    return true;\n  };\n\n  const calculateRailContinent = async (): Promise<CalculationResult> => {\n    const apiUrl = '/api/rail-continent';\n    \n    try {\n      // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      validateMultipleCargos(form.cargos);\n      \n      // –í—ã—á–∏—Å–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥—Ä—É–∑–∞\n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n      const totalVolume = form.cargos.reduce((sum, cargo) => \n        sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n      );\n      \n      // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–º–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      const optimalLength = calculateOptimalLength(form.cargos);\n      const optimalWidth = calculateOptimalWidth(form.cargos);\n      const optimalHeight = calculateOptimalHeight(form.cargos);\n      \n      // üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      console.log('üöÇ Rail Continent: –ê–Ω–∞–ª–∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç:');\n      console.log(`   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç: ${form.cargos.length}`);\n      console.log(`   - –û–±—â–∏–π –≤–µ—Å: ${totalWeight} –∫–≥`);\n      console.log(`   - –û–±—â–∏–π –æ–±—ä–µ–º: ${totalVolume.toFixed(3)} –º¬≥`);\n      \n      form.cargos.forEach((cargo, index) => {\n        console.log(`   üì¶ –ú–µ—Å—Ç–æ ${index + 1}:`);\n        console.log(`     - –ì–∞–±–∞—Ä–∏—Ç—ã: ${cargo.length}√ó${cargo.width}√ó${cargo.height} —Å–º`);\n        console.log(`     - –í–µ—Å: ${cargo.weight} –∫–≥`);\n        console.log(`     - –û–±—ä–µ–º: ${((cargo.length * cargo.width * cargo.height) / 1000000).toFixed(3)} –º¬≥`);\n      });\n      \n      if (form.cargos.length > 1) {\n        const maxLength = Math.max(...form.cargos.map(c => c.length));\n        const maxWidth = Math.max(...form.cargos.map(c => c.width));\n        const maxHeight = Math.max(...form.cargos.map(c => c.height));\n        console.log(`   üìê –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã: ${maxLength}√ó${maxWidth}√ó${maxHeight} —Å–º`);\n        console.log(`   üîß –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã: ${(optimalLength*100).toFixed(0)}√ó${(optimalWidth*100).toFixed(0)}√ó${(optimalHeight*100).toFixed(0)} —Å–º`);\n      }\n      \n      // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä quantity –∏ —É–ª—É—á—à–µ–Ω–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã\n      const requestData = {\n        city_sender: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n        city_receiver: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n        weight: totalWeight,\n        volume: totalVolume,\n        quantity: form.cargos.length, // üîß –î–û–ë–ê–í–õ–ï–ù–û: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç\n        length: optimalLength,        // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞\n        width: optimalWidth,          // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞  \n        height: optimalHeight,        // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞\n        declared_cost: form.declaredValue,\n        pickup: form.fromAddressDelivery ? '1' : '0',\n        delivery: form.toAddressDelivery ? '1' : '0',\n        packaging: form.needPackaging ? '1' : '0',\n        insurance: form.needInsurance ? '1' : '0',\n        tariff: 'auto' // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞\n      };\n\n      console.log('üöÇ Rail Continent –∑–∞–ø—Ä–æ—Å:', requestData);\n\n       const result = await enhancedApiRequest(\n         apiUrl,\n         {\n           method: 'POST',\n           headers: {\n             'Content-Type': 'application/json',\n           },\n           body: JSON.stringify(requestData)\n         },\n         { operation: 'calculate', company: 'Rail Continent' }\n       );\n\n       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n         console.error('‚ùå Rail Continent API –æ—à–∏–±–∫–∞:', result.error);\n         return {\n           company: 'Rail Continent',\n           price: 0,\n           days: 0,\n           error: result.error.userMessage || result.error.message,\n           requestData,\n           responseData: null,\n           apiUrl\n         };\n       }\n\n       const response = result as Response;\n       const data = await response.json();\n       console.log('üöÇ Rail Continent –æ—Ç–≤–µ—Ç:', data);\n\n      if (response.ok && data.result === 'success' && data.data) {\n        // –í—ã–±–∏—Ä–∞–µ–º –∂–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π —Ç–∞—Ä–∏—Ñ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π (–±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π –¥–ª—è —Å–∞–π—Ç–∞)\n        const trainTariff = data.data.train;\n        \n        if (trainTariff) {\n          // –°–æ–±–∏—Ä–∞–µ–º –¥–µ—Ç–∞–ª–∏ –ø–æ —É—Å–ª—É–≥–∞–º –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n          const services: { name: string; description: string; price: number }[] = [];\n          let totalPrice = 0;\n          \n          console.log('üöÇ Rail Continent –¥–µ—Ç–∞–ª–∏ —Ç–∞—Ä–∏—Ñ–∞:', {\n            priceTotal: trainTariff.priceTotal,\n            price_with_out_sale: trainTariff.price_with_out_sale,\n            pricePackage: trainTariff.pricePackage,\n            priceInsurance: trainTariff.priceInsurance,\n            needPackaging: form.needPackaging,\n            needInsurance: form.needInsurance,\n            declaredValue: form.declaredValue\n          });\n          \n          console.log('üöÇ Rail Continent —á–µ–∫–±–æ–∫—Å—ã —Å–æ—Å—Ç–æ—è–Ω–∏–µ:');\n          console.log('   - –£–ø–∞–∫–æ–≤–∫–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è:', form.needPackaging);\n          console.log('   - –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è:', form.needInsurance);\n          console.log('   - –ó–∞—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:', form.declaredValue);\n          \n          // –ò—Å–ø–æ–ª—å–∑—É–µ–º priceTotal –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å (–≤–∫–ª—é—á–∞–µ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–µ —Å–±–æ—Ä—ã)\n          if (trainTariff.priceTotal) {\n            const deliveryPrice = parseFloat(trainTariff.priceTotal);\n            console.log('üöÇ –î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞ (priceTotal):', deliveryPrice);\n            services.push({\n              name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n              description: `${trainTariff.type} (${trainTariff.rsType})`,\n              price: deliveryPrice\n            });\n            totalPrice = deliveryPrice; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–∫ –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É\n            \n            // –ï—Å–ª–∏ –µ—Å—Ç—å –¥–æ–ø. —É—Å–ª—É–≥–∏, –¥–æ–±–∞–≤–ª—è–µ–º –∏—Ö –æ—Ç–¥–µ–ª—å–Ω–æ\n            if (form.needPackaging && trainTariff.pricePackage) {\n              const packagingPrice = parseFloat(trainTariff.pricePackage);\n              console.log('üöÇ –£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞:', packagingPrice);\n              services.push({\n                name: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n                description: '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞',\n                price: packagingPrice\n              });\n              totalPrice += packagingPrice;\n            }\n            \n            // –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ (—Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç priceTotal)\n            if (form.needInsurance && trainTariff.priceInsurance) {\n              const insuranceCost = Math.round(form.declaredValue * parseFloat(trainTariff.priceInsurance) / 100);\n              console.log('üöÇ –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞:', insuranceCost, '(', form.declaredValue, '*', trainTariff.priceInsurance, '%)');\n              services.push({\n                name: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n                description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n                price: insuranceCost\n              });\n              totalPrice += insuranceCost;\n            }\n          } else if (trainTariff.price_with_out_sale) {\n            // Fallback –Ω–∞ —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É –µ—Å–ª–∏ priceTotal –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç\n            const deliveryPrice = parseFloat(trainTariff.price_with_out_sale);\n            console.log('üöÇ –î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞ (fallback):', deliveryPrice);\n            services.push({\n              name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n              description: `${trainTariff.type} (${trainTariff.rsType})`,\n              price: deliveryPrice\n            });\n            totalPrice += deliveryPrice;\n            \n            // –£–ø–∞–∫–æ–≤–∫–∞\n            if (form.needPackaging && trainTariff.pricePackage) {\n              const packagingPrice = parseFloat(trainTariff.pricePackage);\n              console.log('üöÇ –£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞:', packagingPrice);\n              services.push({\n                name: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n                description: '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞',\n                price: packagingPrice\n              });\n              totalPrice += packagingPrice;\n            }\n            \n            // –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ\n            if (form.needInsurance && trainTariff.priceInsurance) {\n              const insuranceCost = Math.round(form.declaredValue * parseFloat(trainTariff.priceInsurance) / 100);\n              console.log('üöÇ –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞:', insuranceCost, '(', form.declaredValue, '*', trainTariff.priceInsurance, '%)');\n              services.push({\n                name: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n                description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n                price: insuranceCost\n              });\n              totalPrice += insuranceCost;\n            }\n          }\n\n          console.log('üöÇ Rail Continent –∏—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:', totalPrice);\n          console.log('üöÇ Rail Continent —É—Å–ª—É–≥–∏:', services);\n\n          // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º, –Ω–æ –Ω–µ –≤–∫–ª—é—á–∞–µ–º –≤ –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å)\n          const additionalServices: { name: string; description: string; price: number }[] = [];\n          \n          // –¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–µ —Å–±–æ—Ä—ã\n          if (trainTariff.terminalEnter1) {\n            additionalServices.push({\n              name: '–¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–π —Å–±–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è',\n              description: '–û–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä—É–∑–∞ –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ',\n              price: parseInt(trainTariff.terminalEnter1)\n            });\n          }\n          \n          // –ó–∞–±–æ—Ä/–¥–æ—Å—Ç–∞–≤–∫–∞\n          if (form.fromAddressDelivery && trainTariff.pricePickup && parseInt(trainTariff.pricePickup) > 0) {\n            additionalServices.push({\n              name: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n              description: '–û—Ç –∞–¥—Ä–µ—Å–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è',\n              price: parseInt(trainTariff.pricePickup)\n            });\n          }\n          \n          if (form.toAddressDelivery && trainTariff.priceDelivery && parseInt(trainTariff.priceDelivery) > 0) {\n            additionalServices.push({\n              name: '–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –∞–¥—Ä–µ—Å—É',\n              description: '–î–æ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è',\n              price: parseInt(trainTariff.priceDelivery)\n            });\n          }\n\n          return {\n            company: 'Rail Continent',\n            price: Math.round(totalPrice),\n            days: parseInt(trainTariff.duration) || 5,\n            details: {\n              tariff: `${trainTariff.type} - ${trainTariff.service}`,\n              transportType: trainTariff.rsType,\n              weight: totalWeight,\n              volume: totalVolume,\n              route: `${form.fromCity} - ${form.toCity}`,\n              services,\n              additionalServices,\n              allTariffs: data.data\n            },\n            requestData,\n            responseData: data,\n            apiUrl\n          };\n        } else {\n          return {\n            company: 'Rail Continent',\n            price: 0,\n            days: 0,\n            error: '–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π —Ç–∞—Ä–∏—Ñ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞',\n            requestData,\n            responseData: data,\n            apiUrl\n          };\n        }\n      } else {\n        return {\n          company: 'Rail Continent',\n          price: 0,\n          days: 0,\n          error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ Rail Continent',\n          requestData,\n          responseData: data,\n          apiUrl\n        };\n      }\n    } catch (error: any) {\n      console.error('üöÇ Rail Continent –æ—à–∏–±–∫–∞:', error);\n      return {\n        company: 'Rail Continent',\n        price: 0,\n        days: 0,\n        error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n        apiUrl\n      };\n    }\n  };\n\n  const calculateVozovoz = async (): Promise<CalculationResult> => {\n    const apiUrl = '/api/vozovoz';\n    \n    try {\n      // –í—ã—á–∏—Å–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥—Ä—É–∑–∞\n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n      const totalVolume = form.cargos.reduce((sum, cargo) => \n        sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n      );\n      \n      console.log('üöö –í–æ–∑–æ–≤–æ–∑: –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');\n      console.log('   - –û–±—â–∏–π –≤–µ—Å:', totalWeight, '–∫–≥');\n      console.log('   - –û–±—â–∏–π –æ–±—ä–µ–º:', totalVolume, '–º¬≥');\n      console.log('   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç:', form.cargos.length);\n      \n      // –û—Ç–ª–∞–¥–∫–∞ –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—Ç–∞\n      form.cargos.forEach((cargo, index) => {\n        console.log(`   - –ú–µ—Å—Ç–æ ${index + 1}:`);\n        console.log(`     - –ì–∞–±–∞—Ä–∏—Ç—ã: ${cargo.length}√ó${cargo.width}√ó${cargo.height} —Å–º`);\n        console.log(`     - –í –º–µ—Ç—Ä–∞—Ö: ${cargo.length/100}√ó${cargo.width/100}√ó${cargo.height/100} –º`);\n        console.log(`     - –í–µ—Å: ${cargo.weight} –∫–≥`);\n        console.log(`     - –û–±—ä–µ–º: ${((cargo.length * cargo.width * cargo.height) / 1000000).toFixed(3)} –º¬≥`);\n      });\n      \n      console.log('   - –û—Ç–∫—É–¥–∞:', form.fromCity);\n      console.log('   - –ö—É–¥–∞:', form.toCity);\n      \n      // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É wizard –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—Ç–∞\n      const createRequestData = () => ({\n        object: \"price\",\n        action: \"get\",\n        params: {\n          cargo: {\n            // ‚ö†Ô∏è –í–ê–ñ–ù–û: category –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω—ã (price.get)\n            // –ü–∞—Ä–∞–º–µ—Ç—Ä category –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¢–û–õ–¨–ö–û –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ (order.set)\n            // –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: vozovoz-docs/ru/docs/structure/cargo.md —Å—Ç—Ä–æ–∫–∞ 28\n            // –û—à–∏–±–∫–∞: \"–í —É–∑–ª–µ guid –Ω–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Å—Å—ã–ª–∫—É –Ω–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–ì—Ä—É–∑–æ–≤\"\n            \n            // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º wizard –≤–º–µ—Å—Ç–æ dimension –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏\n            wizard: form.cargos.map(cargo => ({\n              length: cargo.length / 100,   // —Å–º ‚Üí –º\n              width: cargo.width / 100,     // —Å–º ‚Üí –º\n              height: cargo.height / 100,   // —Å–º ‚Üí –º\n              quantity: 1,\n              weight: cargo.weight\n              // ‚ö†Ô∏è wrapping –ù–ï —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ wizard –¥–ª—è price.get!\n              // –£–ø–∞–∫–æ–≤–∫–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ cargo.wrapping (–Ω–∏–∂–µ)\n            })),\n            \n            // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–ø–∞–∫–æ–≤–∫–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ cargo.wrapping\n            // –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: vozovoz-docs/ru/docs/object/order.md —Å—Ç—Ä–æ–∫–∞ 533-537\n            // –¢–µ—Å—Ç –ø–æ–∫–∞–∑–∞–ª: wizard[].wrapping –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç, cargo.wrapping –†–ê–ë–û–¢–ê–ï–¢!\n            ...(form.needPackaging ? {\n              wrapping: {\n                // \"–ó–∞—â–∏—Ç–Ω–∞—è –∂—ë—Å—Ç–∫–∞—è —É–ø–∞–∫–æ–≤–∫–∞ —Å —Ñ–æ—Ç–æ —Å —Ä–∞–∑–±–æ—Ä–æ–º\"\n                // hardPackageVolumeUOD_WP - –° –†–ê–ó–ë–û–†–û–ú + –° –§–û–¢–û\n                // UOD = Unboxing On Delivery (—Ä–∞–∑–±–æ—Ä –ø—Ä–∏ –¥–æ—Å—Ç–∞–≤–∫–µ)\n                // WP = With Photos (—Å —Ñ–æ—Ç–æ)\n                // –¶–µ–Ω–∞: ~1020 —Ä—É–±. –∑–∞ 0.15 –º¬≥ + 10 —Ä—É–±. —Ä–∞–∑–±–æ—Ä + 50 —Ä—É–±. —Ñ–æ—Ç–æ\n                hardPackageVolumeUOD_WP: form.cargos.reduce((sum, cargo) => \n                  sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n                )  // –û–±—â–∏–π –æ–±—ä–µ–º –≤—Å–µ—Ö –º–µ—Å—Ç –≤ –º¬≥\n              }\n            } : {}),\n            \n            // –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ\n            ...(form.needInsurance && form.declaredValue > 0 ? {\n              insurance: form.declaredValue,\n              insuranceNdv: false\n            } : {\n              insuranceNdv: true\n            })\n          },\n          gateway: {\n            dispatch: {\n              point: {\n                location: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n                ...(form.fromAddressDelivery && form.fromAddress?.trim() ? {\n                  address: form.fromAddress.trim()\n                } : {\n                  terminal: \"default\"\n                })\n              },\n              // ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–∏\n              ...(form.needLoading ? {\n                service: {\n                  // –ü–æ–≥—Ä—É–∑–∫–∞ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞)\n                  needLoading: {\n                    floor: form.floor || 1,\n                    lift: form.hasFreightLift || false\n                  }\n                  // ‚ö†Ô∏è unboxingOnDelivery –ù–ï –Ω—É–∂–µ–Ω - —É–∂–µ –≤–∫–ª—é—á–µ–Ω –≤ hardPackageVolumeUOD_WP\n                  // (UOD = Unboxing On Delivery - —Ä–∞–∑–±–æ—Ä –≥—Ä—É–∑–∞ –ø—Ä–∏ –¥–æ—Å—Ç–∞–≤–∫–µ)\n                }\n              } : {})\n            },\n            destination: {\n              point: {\n                location: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n                ...(form.toAddressDelivery && form.toAddress?.trim() ? {\n                  address: form.toAddress.trim()\n                } : {\n                  terminal: \"default\"\n                })\n              },\n              // ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–∏\n              ...(form.needCarry ? {\n                service: {\n                  // –†–∞–∑–≥—Ä—É–∑–∫–∞ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–∏ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω –ø–æ–¥—ä–µ–º –Ω–∞ —ç—Ç–∞–∂)\n                  needLoading: {\n                    floor: form.floor || 1,\n                    lift: form.hasFreightLift || false\n                  }\n                }\n              } : {})\n            }\n          }\n        }\n      });\n\n      // –°–æ–∑–¥–∞–µ–º –∑–∞–ø—Ä–æ—Å —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –∞–¥—Ä–µ—Å–æ–≤\n      let requestData = createRequestData();\n      \n      console.log('üöö –í–æ–∑–æ–≤–æ–∑ –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n\n      let result = await enhancedApiRequest(\n        apiUrl,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(requestData)\n        },\n        { operation: 'calculate', company: '–í–æ–∑–æ–≤–æ–∑' }\n      );\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –æ—à–∏–±–∫—É API —É—Ä–æ–≤–Ω—è\n      if (result && typeof result === 'object' && 'success' in result && !result.success) {\n        console.error('‚ùå –í–æ–∑–æ–≤–æ–∑ API –æ—à–∏–±–∫–∞:', result.error);\n        return {\n          company: '–í–æ–∑–æ–≤–æ–∑',\n          price: 0,\n          days: 0,\n          error: result.error.userMessage || result.error.message,\n          requestData,\n          responseData: null,\n          apiUrl\n        };\n      }\n\n      const response = result as Response;\n      const data = await response.json();\n      console.log('üöö –í–æ–∑–æ–≤–æ–∑ –æ—Ç–≤–µ—Ç:', JSON.stringify(data, null, 2));\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ –ò–õ–ò –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–∫–∏ –≤ –æ—Ç–≤–µ—Ç–µ\n      if (response.ok && data.response) {\n        // –£—Å–ø–µ—à–Ω—ã–π —Ä–∞—Å—á–µ—Ç\n        const responseData = data.response;\n        \n        console.log('üöö –í–æ–∑–æ–≤–æ–∑ –∞–Ω–∞–ª–∏–∑ –æ—Ç–≤–µ—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:', responseData);\n        \n        // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n        const services: { name: string; description: string; price: number }[] = [];\n        let totalPrice = responseData.price || responseData.basePrice || 0;\n        \n        // ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –º–∞—Å—Å–∏–≤ —É—Å–ª—É–≥ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API\n        if (responseData.service && Array.isArray(responseData.service)) {\n          console.log('üöö –í–æ–∑–æ–≤–æ–∑ –Ω–∞–π–¥–µ–Ω –º–∞—Å—Å–∏–≤ —É—Å–ª—É–≥:', responseData.service.length);\n          \n          responseData.service.forEach((service: any, index: number) => {\n            console.log(`üöö –£—Å–ª—É–≥–∞ [${index}]:`, service);\n            if (service.price > 0) {\n              services.push({\n                name: service.name || '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —É—Å–ª—É–≥–∞',\n                description: service.description || '',\n                price: service.price\n              });\n            }\n          });\n        } else {\n          console.log('üöö –í–æ–∑–æ–≤–æ–∑: –º–∞—Å—Å–∏–≤ —É—Å–ª—É–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –ø—É—Å—Ç');\n          \n          // –ï—Å–ª–∏ –º–∞—Å—Å–∏–≤–∞ —É—Å–ª—É–≥ –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n          if (responseData.basePrice && responseData.basePrice > 0) {\n            services.push({\n              name: '–ë–∞–∑–æ–≤–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞',\n              description: `${form.fromCity} - ${form.toCity}`,\n              price: responseData.basePrice\n            });\n          }\n          \n          // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–∫–∏–¥–∫–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—ë –æ—Ç–¥–µ–ª—å–Ω–æ\n          if (responseData.price !== responseData.basePrice && responseData.price > 0) {\n            const discount = (responseData.basePrice || 0) - responseData.price;\n            if (discount > 0) {\n              services.push({\n                name: '–°–∫–∏–¥–∫–∞',\n                description: '–ü—Ä–∏–º–µ–Ω–µ–Ω–∞ —Å–∫–∏–¥–∫–∞',\n                price: -discount\n              });\n            }\n          }\n        }\n        \n        // –ï—Å–ª–∏ –Ω–∏–∫–∞–∫–∏—Ö —É—Å–ª—É–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n        if (services.length === 0 && totalPrice > 0) {\n          services.push({\n            name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n            description: `${form.fromCity} - ${form.toCity}`,\n            price: totalPrice\n          });\n        }\n\n        console.log('üöö –í–æ–∑–æ–≤–æ–∑ –∏—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:', totalPrice);\n        console.log('üöö –í–æ–∑–æ–≤–æ–∑ —É—Å–ª—É–≥–∏:', services);\n\n        return {\n          company: '–í–æ–∑–æ–≤–æ–∑',\n          price: Math.round(totalPrice),\n          days: responseData.deliveryTime?.to || responseData.deliveryTime?.from || 3,\n          details: {\n            note: `–î–æ—Å—Ç–∞–≤–∫–∞ ${form.fromCity} - ${form.toCity}`,\n            services,\n            basePrice: responseData.basePrice,\n            finalPrice: responseData.price,\n            deliveryTime: responseData.deliveryTime,\n            weight: totalWeight,\n            volume: totalVolume\n          },\n          requestData,\n          responseData: data,\n          apiUrl\n        };\n      } else {\n        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –∏–∑ API –æ—Ç–≤–µ—Ç–∞\n        const errorMessage = data.error || data.message || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –í–æ–∑–æ–≤–æ–∑';\n        console.log('üöö –í–æ–∑–æ–≤–æ–∑: –ø–æ–ª—É—á–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≤ –æ—Ç–≤–µ—Ç–µ API:', errorMessage);\n        \n        return {\n          company: '–í–æ–∑–æ–≤–æ–∑',\n          price: 0,\n          days: 0,\n          error: errorMessage,\n          requestData,\n          responseData: data,\n          apiUrl\n        };\n      }\n    } catch (error: any) {\n      console.error('üöö –í–æ–∑–æ–≤–æ–∑ –æ—à–∏–±–∫–∞:', error);\n      return {\n        company: '–í–æ–∑–æ–≤–æ–∑',\n        price: 0,\n        days: 0,\n        error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n        apiUrl\n      };\n    }\n  };\n\n  // –†–∞—Å—á–µ—Ç –¥–ª—è Nord Wheel\n  const calculateNordWheel = async (): Promise<CalculationResult> => {\n    const apiUrl = '/api/nordwheel';\n\n    try {\n      // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      validateMultipleCargos(form.cargos);\n      \n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n      const totalVolume = form.cargos.reduce((sum, cargo) => \n        sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n      );\n\n      // üîß –î–û–ë–ê–í–õ–ï–ù–û: –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π API NordWheel\n      if (totalWeight > 1000) {\n        console.warn('‚ö†Ô∏è Nord Wheel: –í–µ—Å –ø—Ä–µ–≤—ã—à–∞–µ—Ç 1000 –∫–≥, –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∞ API');\n      }\n      if (totalVolume > 5) {\n        console.warn('‚ö†Ô∏è Nord Wheel: –û–±—ä–µ–º –ø—Ä–µ–≤—ã—à–∞–µ—Ç 5 –º¬≥, –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∞ API');\n      }\n\n      // üîß –î–û–ë–ê–í–õ–ï–ù–û: –†–∞—Å—á–µ—Ç –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      const maxLength = Math.max(...form.cargos.map(c => c.length));\n      const maxWidth = Math.max(...form.cargos.map(c => c.width));\n      const maxHeight = Math.max(...form.cargos.map(c => c.height));\n      \n      // üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      console.log('üåê Nord Wheel: –ê–Ω–∞–ª–∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç:');\n      console.log(`   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç: ${form.cargos.length}`);\n      console.log(`   - –û–±—â–∏–π –≤–µ—Å: ${totalWeight} –∫–≥`);\n      console.log(`   - –û–±—â–∏–π –æ–±—ä–µ–º: ${totalVolume.toFixed(3)} –º¬≥`);\n      \n      // –î–µ—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏—Å—Ç–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n      let dispatchType = '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';\n      if (form.fromLavsiteWarehouse) {\n        dispatchType = '—Å–∫–ª–∞–¥ –õ–∞–≤—Å–∏—Ç';\n      } else if (form.fromTerminal) {\n        dispatchType = '—Ç–µ—Ä–º–∏–Ω–∞–ª';\n      } else if (form.fromAddressDelivery) {\n        dispatchType = '–∞–¥—Ä–µ—Å';\n      } else {\n        dispatchType = '—Ç–µ—Ä–º–∏–Ω–∞–ª (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)';\n      }\n      \n      console.log(`   - –û—Ç–∫—É–¥–∞: ${form.fromCity} (${dispatchType})`);\n      console.log(`   - –ö—É–¥–∞: ${form.toCity} (${form.toTerminal ? '—Ç–µ—Ä–º–∏–Ω–∞–ª' : '–∞–¥—Ä–µ—Å'})`);\n      \n      if (form.fromLavsiteWarehouse) {\n        console.log(`   - –ê–¥—Ä–µ—Å —Å–∫–ª–∞–¥–∞: ${form.fromAddress}`);\n      }\n      \n      form.cargos.forEach((cargo, index) => {\n        console.log(`   üì¶ –ú–µ—Å—Ç–æ ${index + 1}:`);\n        console.log(`     - –ì–∞–±–∞—Ä–∏—Ç—ã: ${cargo.length}√ó${cargo.width}√ó${cargo.height} —Å–º`);\n        console.log(`     - –í–µ—Å: ${cargo.weight} –∫–≥`);\n        console.log(`     - –û–±—ä–µ–º: ${((cargo.length * cargo.width * cargo.height) / 1000000).toFixed(3)} –º¬≥`);\n      });\n\n      if (form.cargos.length > 1) {\n        console.log(`   üìê –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã: ${maxLength}√ó${maxWidth}√ó${maxHeight} —Å–º`);\n      }\n\n      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è city_fias_id –∏–∑ –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ Dadata clean API\n      const getCityFiasFromAddress = async (address: string): Promise<string> => {\n        try {\n          console.log(`üöõ Nordwheel: –ó–∞–ø—Ä–æ—Å city_fias_id –¥–ª—è –∞–¥—Ä–µ—Å–∞: ${address}`);\n          \n          const response = await fetch('/api/dadata', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n              address: address,\n              type: 'suggest'\n            })\n          });\n          \n          const data = await response.json();\n          console.log('üöõ Nordwheel: Dadata suggest –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç:', JSON.stringify(data, null, 2));\n          \n          if (data.success && data.data && Array.isArray(data.data) && data.data.length > 0) {\n            const firstSuggestion = data.data[0];\n            const suggestionData = firstSuggestion.data;\n            \n            console.log('üîç Nordwheel: Dadata suggestion –¥–∞–Ω–Ω—ã–µ:', {\n              value: firstSuggestion.value,\n              city: suggestionData.city,\n              city_fias_id: suggestionData.city_fias_id,\n              settlement: suggestionData.settlement,\n              settlement_fias_id: suggestionData.settlement_fias_id\n            });\n            \n            // –ò—Å–ø–æ–ª—å–∑—É–µ–º city_fias_id (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)\n            if (suggestionData.city_fias_id) {\n              console.log(`‚úÖ Nordwheel: –ü–æ–ª—É—á–µ–Ω city_fias_id: ${suggestionData.city_fias_id} (–≥–æ—Ä–æ–¥: ${suggestionData.city})`);\n              return suggestionData.city_fias_id;\n            }\n            // Fallback –Ω–∞ settlement_fias_id –µ—Å–ª–∏ city_fias_id –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç\n            else if (suggestionData.settlement_fias_id) {\n              console.log(`‚úÖ Nordwheel: –ò—Å–ø–æ–ª—å–∑—É–µ–º settlement_fias_id: ${suggestionData.settlement_fias_id} (–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç: ${suggestionData.settlement})`);\n              return suggestionData.settlement_fias_id;\n            }\n            else {\n              console.error(`‚ùå Nordwheel: –ù–∏ city_fias_id, –Ω–∏ settlement_fias_id –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è –∞–¥—Ä–µ—Å–∞ ${address}`);\n              throw new Error(`FIAS –∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –∞–¥—Ä–µ—Å–∞ ${address}`);\n            }\n          } else {\n            console.error(`‚ùå Nordwheel: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç Dadata –¥–ª—è –∞–¥—Ä–µ—Å–∞ ${address}`);\n            console.error('–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', JSON.stringify(data, null, 2));\n            throw new Error(`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç Dadata –¥–ª—è –∞–¥—Ä–µ—Å–∞ ${address}`);\n          }\n        } catch (error) {\n          console.error(`‚ùå Nordwheel: –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è city_fias_id:`, error);\n          throw error;\n        }\n      };\n\n      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è FIAS –∫–æ–¥–∞ –≥–æ—Ä–æ–¥–∞ —á–µ—Ä–µ–∑ Dadata (–¥–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏)\n      const getNordwheelCityFias = async (cityName: string): Promise<string> => {\n        try {\n          console.log(`üöõ Nordwheel: –ó–∞–ø—Ä–æ—Å FIAS –¥–ª—è –≥–æ—Ä–æ–¥–∞: ${cityName}`);\n          \n          // –ò—Å–ø–æ–ª—å–∑—É–µ–º clean API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è FIAS –∫–æ–¥–∞ –≥–æ—Ä–æ–¥–∞\n          const response = await fetch('/api/dadata', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n              address: cityName,\n              type: 'suggest'\n            })\n          });\n          \n          const data = await response.json();\n          console.log('üöõ Nordwheel: Dadata suggest –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è –≥–æ—Ä–æ–¥–∞:', JSON.stringify(data, null, 2));\n\n          if (data.success && data.data && Array.isArray(data.data) && data.data.length > 0) {\n            const firstSuggestion = data.data[0];\n            const suggestionData = firstSuggestion.data;\n            \n            console.log('üîç Nordwheel: Dadata suggestion –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥–æ—Ä–æ–¥–∞:', {\n              value: firstSuggestion.value,\n              city: suggestionData.city,\n              city_fias_id: suggestionData.city_fias_id,\n              settlement: suggestionData.settlement,\n              settlement_fias_id: suggestionData.settlement_fias_id\n            });\n            \n            if (suggestionData.city_fias_id) {\n              console.log(`‚úÖ Nordwheel: –ü–æ–ª—É—á–µ–Ω FIAS –¥–ª—è ${cityName}: ${suggestionData.city_fias_id}`);\n              return suggestionData.city_fias_id;\n            } else if (suggestionData.settlement_fias_id) {\n              console.log(`‚úÖ Nordwheel: –ò—Å–ø–æ–ª—å–∑—É–µ–º settlement_fias_id –¥–ª—è ${cityName}: ${suggestionData.settlement_fias_id}`);\n              return suggestionData.settlement_fias_id;\n            } else {\n              console.error(`‚ùå Nordwheel: FIAS –∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –≥–æ—Ä–æ–¥–∞ ${cityName}`);\n              throw new Error(`FIAS –∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –≥–æ—Ä–æ–¥–∞ ${cityName}`);\n            }\n          } else {\n            console.error(`‚ùå Nordwheel: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç Dadata –¥–ª—è –≥–æ—Ä–æ–¥–∞ ${cityName}`);\n            console.error('–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', JSON.stringify(data, null, 2));\n            throw new Error(`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç Dadata –¥–ª—è –≥–æ—Ä–æ–¥–∞ ${cityName}`);\n          }\n        } catch (error) {\n          console.warn(`‚ö†Ô∏è Nordwheel: Dadata –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è ${cityName}, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–æ—Ä–æ–¥ –∫–∞–∫ —Å—Ç—Ä–æ–∫—É:`, error);\n          // Fallback: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≥–æ—Ä–æ–¥ –∫–∞–∫ —Å—Ç—Ä–æ–∫—É –≤–º–µ—Å—Ç–æ FIAS –∫–æ–¥–∞\n          return cityName;\n        }\n      };\n      // üèôÔ∏è –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ª–æ–∫–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–æ—Ä–º—ã\n      const getDispatchLocation = async () => {\n        try {\n          if (form.fromTerminal) {\n            // –¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞: type=terminal + city_fias\n            return {\n              type: 'terminal' as const,\n              city_fias: await getNordwheelCityFias(form.fromCity)\n            };\n          } else if (form.fromLavsiteWarehouse) {\n            // üè≠ –°–∫–ª–∞–¥ –õ–∞–≤—Å–∏—Ç: type=address + city_fias_id (–∏—Å–ø–æ–ª—å–∑—É–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å)\n            const warehouseAddressSimplified = '–õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π, –¥.–û—Å–µ–µ–≤–æ';\n            console.log(`üè≠ Nordwheel: –°–∫–ª–∞–¥ –õ–∞–≤—Å–∏—Ç - –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å: ${warehouseAddressSimplified}`);\n            const cityFiasId = await getCityFiasFromAddress(warehouseAddressSimplified);\n            \n            return {\n              type: 'address' as const,\n              city_fias: cityFiasId\n            };\n          } else {\n            // –ê–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞: type=address + city_fias_id\n            const address = form.fromAddress || form.fromCity;\n            const cityFiasId = await getCityFiasFromAddress(address);\n            \n            return {\n              type: 'address' as const,\n              city_fias: cityFiasId\n            };\n          }\n        } catch (error) {\n          console.error(`üöõ Nordwheel: –û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è:`, error);\n          throw error;\n        }\n      };\n\n      const getDestinationLocation = async () => {\n        try {\n          if (form.toTerminal) {\n            // –¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞: type=terminal + city_fias\n            return {\n              type: 'terminal' as const,\n              city_fias: await getNordwheelCityFias(form.toCity)\n            };\n          } else {\n            // –ê–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞: type=address + city_fias_id\n            const address = form.toAddress || form.toCity;\n            const cityFiasId = await getCityFiasFromAddress(address);\n            \n            return {\n              type: 'address' as const,\n              city_fias: cityFiasId\n            };\n          }\n        } catch (error) {\n          console.error(`üöõ Nordwheel: –û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:`, error);\n          throw error;\n        }\n      };\n\n      // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è –Ω–æ–≤–æ–≥–æ API NordWheel —Å —É—á–µ—Ç–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–æ—Ä–º—ã\n      let requestData;\n      try {\n        requestData = {\n          dispatch: {\n            location: await getDispatchLocation()\n          },\n          destination: {\n            location: await getDestinationLocation()\n          },\n          cargo: {\n            total_weight: totalWeight,\n            total_volume: totalVolume,\n            total_quantity: 1 // –í—Å–µ–≥–¥–∞ 1, —á—Ç–æ–±—ã NordWheel –Ω–µ —É–º–Ω–æ–∂–∞–ª —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –∫–æ–ª-–≤–æ –º–µ—Å—Ç\n          },\n          insurance: form.needInsurance && form.declaredValue ? form.declaredValue : null,\n          insurance_refuse: !form.needInsurance,\n          services: {\n            is_package: form.needPackaging,\n            is_documents_return: false,\n            is_fragile: false\n          },\n          promocode: null\n        };\n      } catch (locationError) {\n        console.error('üöõ Nordwheel: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–π:', locationError);\n        return {\n          company: 'Nord Wheel',\n          price: 0,\n          days: 0,\n          error: `–û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞–¥—Ä–µ—Å–æ–≤: ${locationError instanceof Error ? locationError.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`,\n          apiUrl\n        };\n      }\n\n      console.log('üöõ Nord Wheel –Ω–æ–≤—ã–π API –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n\n      const result = await enhancedApiRequest(\n        apiUrl,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(requestData)\n        },\n        { operation: 'calculate', company: 'Nord Wheel' }\n      );\n\n      if (result && typeof result === 'object' && 'success' in result && !result.success) {\n        console.error('‚ùå Nord Wheel API –æ—à–∏–±–∫–∞:', result.error);\n        \n        // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ 400 –∏ –±–æ–ª—å—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø—Ä–æ–±—É–µ–º —Å —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏\n        if (result.error.status === 400 && (totalWeight > 1000 || totalVolume > 5)) {\n          console.log('üîÑ Nord Wheel: –ü—Ä–æ–±—É–µ–º fallback —Ä–∞—Å—á–µ—Ç —Å —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏...');\n          \n          const fallbackRequestData = {\n            ...requestData,\n            cargo: {\n              total_weight: Math.min(totalWeight, 999),\n              total_volume: Math.min(totalVolume, 4.9),\n              total_quantity: 1 // –¢–∞–∫–∂–µ –≤—Å–µ–≥–¥–∞ 1 –¥–ª—è fallback\n            }\n          };\n          \n          console.log('üîÑ Fallback –∑–∞–ø—Ä–æ—Å:', JSON.stringify(fallbackRequestData, null, 2));\n          \n          const fallbackResult = await enhancedApiRequest(\n            apiUrl,\n            {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json'\n              },\n              body: JSON.stringify(fallbackRequestData)\n            },\n            { operation: 'calculate', company: 'Nord Wheel (fallback)' }\n          );\n          \n          if (fallbackResult && typeof fallbackResult === 'object' && 'success' in fallbackResult && !fallbackResult.success) {\n            console.error('‚ùå Nord Wheel fallback —Ç–æ–∂–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:', fallbackResult.error);\n          } else {\n            console.log('‚úÖ Nord Wheel fallback —Å—Ä–∞–±–æ—Ç–∞–ª! –ò—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.');\n            // –ò—Å–ø–æ–ª—å–∑—É–µ–º fallback —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞\n            const fallbackResponse = fallbackResult as Response;\n            const fallbackData = await fallbackResponse.json();\n            \n            // –ü–∞—Ä—Å–∏–º fallback —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º —Ü–µ–Ω—É\n            const scaleFactor = Math.max(totalWeight / 999, totalVolume / 4.9);\n            \n            if (fallbackData.auto || fallbackData.avia) {\n              const options: Array<{\n                type: string;\n                price: number;\n                days: any;\n                services: any;\n              }> = [];\n              \n              if (fallbackData.auto) {\n                const scaledPrice = Math.round((fallbackData.auto.total_amount || 0) * scaleFactor);\n                options.push({\n                  type: 'auto',\n                  price: scaledPrice,\n                  days: fallbackData.auto.delivery_date || '',\n                  services: fallbackData.auto.services || []\n                });\n              }\n              \n              if (fallbackData.avia) {\n                const scaledPrice = Math.round((fallbackData.avia.total_amount || 0) * scaleFactor);\n                options.push({\n                  type: 'avia',\n                  price: scaledPrice,\n                  days: fallbackData.avia.delivery_date || '',\n                  services: fallbackData.avia.services || []\n                });\n              }\n              \n              if (options.length > 0) {\n                const bestOption = options.reduce((best, current) => \n                  current.price < best.price ? current : best\n                );\n                \n                // –í—ã—á–∏—Å–ª—è–µ–º –¥–Ω–∏\n                let calculatedDays = 3;\n                try {\n                  if (bestOption.days) {\n                    const deliveryDate = new Date(bestOption.days);\n                    const today = new Date();\n                    if (!isNaN(deliveryDate.getTime())) {\n                      const diffTime = deliveryDate.getTime() - today.getTime();\n                      calculatedDays = Math.max(1, Math.ceil(diffTime / (1000 * 60 * 60 * 24)));\n                    }\n                  }\n                } catch (e) {\n                  // –û—Å—Ç–∞–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n                }\n                \n                return {\n                  company: 'Nord Wheel',\n                  price: bestOption.price,\n                  days: calculatedDays,\n                  details: {\n                    totalCost: bestOption.price,\n                    deliveryCost: bestOption.price,\n                    transportType: bestOption.type,\n                    services: bestOption.services,\n                    allOptions: options,\n                    currency: 'RUB',\n                    deliveryDate: bestOption.days,\n                    note: `–†–∞—Å—á–µ—Ç –ø–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º (–∫–æ—ç—Ñ. ${scaleFactor.toFixed(2)})`\n                  },\n                  requestData: {\n                    original: requestData,\n                    fallback: fallbackRequestData,\n                    scaleFactor\n                  },\n                  responseData: fallbackData,\n                  apiUrl\n                };\n              }\n            }\n          }\n        }\n        \n        // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫ 400\n        let errorMessage = result.error.userMessage || result.error.message || '–û—à–∏–±–∫–∞ API NordWheel';\n        \n        if (result.error.status === 400) {\n          errorMessage += `. –ü—Ä–µ–≤—ã—à–µ–Ω—ã –ª–∏–º–∏—Ç—ã API: –≤–µ—Å >1000–∫–≥ –∏–ª–∏ –æ–±—ä–µ–º >5–º¬≥. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –≥—Ä—É–∑ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–π.`;\n        }\n        \n        return {\n          company: 'Nord Wheel',\n          price: 0,\n          days: 0,\n          error: errorMessage,\n          apiUrl,\n          requestData\n        };\n      }\n\n      const response = result as Response;\n      const data = await response.json();\n      console.log('üöõ Nord Wheel API –æ—Ç–≤–µ—Ç:', data);\n\n       // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ API - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã\n       let price = 0;\n       let days = 0;\n       let details: any = {};\n\n       // –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç API —Å auto/avia –æ–±—ä–µ–∫—Ç–∞–º–∏ (–ø—Ä–æ–≤–µ—Ä—è–µ–º –±–µ–∑ data.success)\n       if (data.auto || data.avia) {\n         const options: Array<{type: string, price: number, days: number, services: any[]}> = [];\n         \n         if (data.auto) {\n           const autoPrice = data.auto.total_amount || 0;\n           const autoDeliveryDate = data.auto.delivery_date || '';\n           \n           options.push({\n             type: 'auto',\n             price: autoPrice,\n             days: autoDeliveryDate, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ —Å—Ç—Ä–æ–∫—É –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n             services: data.auto.services || []\n           });\n         }\n         \n         if (data.avia) {\n           const aviaPrice = data.avia.total_amount || 0;\n           const aviaDeliveryDate = data.avia.delivery_date || '';\n           \n           options.push({\n             type: 'avia',\n             price: aviaPrice,\n             days: aviaDeliveryDate, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ —Å—Ç—Ä–æ–∫—É –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n             services: data.avia.services || []\n           });\n         }\n         \n         if (options.length === 0) {\n           console.error('‚ùå Nord Wheel: –ù–µ—Ç –æ–ø—Ü–∏–π –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ –æ—Ç–≤–µ—Ç–µ:', data);\n           return {\n             company: 'Nord Wheel',\n             price: 0,\n             days: 0,\n             error: '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–ø—Ü–∏–π –¥–æ—Å—Ç–∞–≤–∫–∏',\n             apiUrl,\n             requestData,\n             responseData: data\n           };\n         }\n         \n         // –í—ã–±–∏—Ä–∞–µ–º —Å–∞–º—ã–π –¥–µ—à–µ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç\n         const bestOption = options.reduce((best, current) => \n           current.price < best.price ? current : best\n         );\n         \n         price = bestOption.price;\n         \n         // –í—ã—á–∏—Å–ª—è–µ–º –¥–Ω–∏ –∏–∑ –¥–∞—Ç—ã –¥–æ—Å—Ç–∞–≤–∫–∏\n         try {\n           if (bestOption.days && typeof bestOption.days === 'string') {\n             const deliveryDate = new Date(bestOption.days);\n             const today = new Date();\n             if (!isNaN(deliveryDate.getTime())) {\n               const diffTime = deliveryDate.getTime() - today.getTime();\n               days = Math.max(1, Math.ceil(diffTime / (1000 * 60 * 60 * 24)));\n             } else {\n               days = 3; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é\n             }\n           } else {\n             days = 3; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é\n           }\n         } catch (dateError) {\n           console.warn('‚ö†Ô∏è Nord Wheel: –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –¥–Ω–µ–π –∏–∑ –¥–∞—Ç—ã:', dateError);\n           days = 3;\n         }\n         \n         details = {\n           totalCost: price,\n           deliveryCost: price, // –í –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ\n           transportType: bestOption.type,\n           services: bestOption.services,\n           allOptions: options, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n           currency: 'RUB',\n           deliveryDate: bestOption.days // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—É—é –¥–∞—Ç—É\n         };\n       } else if (data.price !== undefined) {\n         // –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞\n         price = data.price;\n         days = data.days || data.delivery_time || 0;\n         details = {\n           totalCost: price,\n           currency: data.currency || 'RUB'\n         };\n       } else {\n         // –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ü–µ–Ω—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É\n         console.error('‚ùå Nord Wheel: –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API:', data);\n         return {\n           company: 'Nord Wheel',\n           price: 0,\n           days: 0,\n           error: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API',\n           apiUrl,\n           requestData,\n           responseData: data\n         };\n       }\n\n      return {\n        company: 'Nord Wheel',\n        price: Math.round(price),\n        days: days,\n        details,\n        requestData,\n        responseData: data,\n        apiUrl\n      };\n    } catch (error: any) {\n      console.error('üöõ Nord Wheel –æ—à–∏–±–∫–∞:', error);\n      return {\n        company: 'Nord Wheel',\n        price: 0,\n        days: 0,\n        error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n        apiUrl\n      };\n    }\n  };\n    const calculateCdek = async (): Promise<CalculationResult> => {\n    const apiUrl = '/api/cdek';\n    \n    try {\n      validateMultipleCargos(form.cargos);\n      \n      const packages = form.cargos.map(cargo => ({\n        height: cargo.height,\n        length: cargo.length,\n        width: cargo.width,\n        weight: cargo.weight * 1000\n      }));\n\n      const requestData: any = {\n        from_city: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n        to_city: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n        packages: packages\n      };\n\n      if (form.needInsurance && form.declaredValue > 0) {\n        requestData.services = [{\n          code: 'INSURANCE',\n          parameter: form.declaredValue\n        }];\n        console.log('üì¶ CDEK: –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ', form.declaredValue);\n      }\n\n      console.log('üì¶ CDEK –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n      console.log('üì¶ CDEK –º–∞—Ä—à—Ä—É—Ç:', {\n        fromAddressDelivery: form.fromAddressDelivery,\n        fromLavsiteWarehouse: form.fromLavsiteWarehouse,\n        toAddressDelivery: form.toAddressDelivery\n      });\n\n       const result = await enhancedApiRequest(\n         apiUrl,\n         {\n           method: 'POST',\n           headers: {\n             'Content-Type': 'application/json',\n           },\n           body: JSON.stringify(requestData)\n         },\n         { operation: 'calculate', company: '–°–î–≠–ö' }\n       );\n\n       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n         console.error('‚ùå –°–î–≠–ö API –æ—à–∏–±–∫–∞:', result.error);\n         return {\n           company: '–°–î–≠–ö',\n           price: 0,\n           days: 0,\n           error: result.error.userMessage || result.error.message,\n           requestData,\n           responseData: null,\n           apiUrl\n         };\n       }\n\n       const response = result as Response;\n       const data = await response.json();\n       console.log('üì¶ CDEK –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω, —Ç–∞—Ä–∏—Ñ–æ–≤:', data.tariff_codes?.length || 0);\n\n      if (response.ok && data.tariff_codes && data.tariff_codes.length > 0) {\n        const isFromDoor = form.fromAddressDelivery || form.fromLavsiteWarehouse;\n        const isToDoor = form.toAddressDelivery;\n        \n        let deliveryMode: number;\n        let deliveryModeText: string;\n        \n        if (isFromDoor && isToDoor) {\n          deliveryMode = 1;\n          deliveryModeText = '–¥–≤–µ—Ä—å-–¥–≤–µ—Ä—å';\n        } else if (isFromDoor && !isToDoor) {\n          deliveryMode = 2;\n          deliveryModeText = '–¥–≤–µ—Ä—å-—Å–∫–ª–∞–¥';\n        } else if (!isFromDoor && isToDoor) {\n          deliveryMode = 3;\n          deliveryModeText = '—Å–∫–ª–∞–¥-–¥–≤–µ—Ä—å';\n        } else {\n          deliveryMode = 4;\n          deliveryModeText = '—Å–∫–ª–∞–¥-—Å–∫–ª–∞–¥';\n        }\n\n        console.log(`üì¶ CDEK –≤—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º –¥–æ—Å—Ç–∞–≤–∫–∏: ${deliveryMode} (${deliveryModeText})`);\n\n        const filteredTariffs = data.tariff_codes.filter((t: any) => t.delivery_mode === deliveryMode);\n        \n        console.log(`üì¶ CDEK –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è —Ä–µ–∂–∏–º–∞ ${deliveryModeText}:`, filteredTariffs.length);\n\n        if (filteredTariffs.length === 0) {\n          return {\n            company: '–°–î–≠–ö',\n            price: 0,\n            days: 0,\n            error: `–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∞ ${deliveryModeText}`,\n            requestData,\n            responseData: data,\n            apiUrl\n          };\n        }\n\n        const bestTariff = filteredTariffs.reduce((min: any, tariff: any) => \n          (tariff.delivery_sum < min.delivery_sum) ? tariff : min\n        );\n\n        console.log(`üì¶ CDEK –ª—É—á—à–∏–π —Ç–∞—Ä–∏—Ñ: ${bestTariff.tariff_name} - ${bestTariff.delivery_sum}‚ÇΩ`);\n\n        const detailsRequest: any = {\n          ...requestData,\n          tariff_code: bestTariff.tariff_code,\n          get_details: true\n        };\n\n        console.log('üì¶ CDEK: –∑–∞–ø—Ä–æ—Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏...');\n\n          const detailsResult = await enhancedApiRequest(\n            apiUrl,\n            {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n              },\n              body: JSON.stringify(detailsRequest)\n            },\n            { operation: 'tariff_details', company: '–°–î–≠–ö' }\n          );\n\n          let tariffDetails: any = null;\n          if (detailsResult && typeof detailsResult === 'object' && 'success' in detailsResult && detailsResult.success) {\n            const detailsResponse = detailsResult as Response;\n            if (detailsResponse.ok) {\n              const detailsData = await detailsResponse.json();\n              tariffDetails = detailsData.tariff_details;\n              console.log('üì¶ –°–î–≠–ö –¥–µ—Ç–∞–ª–∏ —Ç–∞—Ä–∏—Ñ–∞:', tariffDetails);\n            }\n          }\n\n        const finalPrice = tariffDetails?.total_sum || bestTariff.delivery_sum;\n        \n        return {\n          company: '–°–î–≠–ö',\n          price: Math.round(finalPrice),\n          days: bestTariff.period_max || 0,\n          details: {\n            tariff_name: bestTariff.tariff_name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n            tariff_code: bestTariff.tariff_code,\n            delivery_mode: deliveryModeText,\n            period_min: bestTariff.period_min,\n            period_max: bestTariff.period_max,\n            calendar_min: bestTariff.calendar_min,\n            calendar_max: bestTariff.calendar_max,\n            all_tariffs: filteredTariffs,\n            services: tariffDetails?.services || [],\n            delivery_sum: tariffDetails?.delivery_sum || bestTariff.delivery_sum,\n            total_sum: finalPrice,\n            weight_calc: tariffDetails?.weight_calc\n          },\n          requestData,\n          responseData: data,\n          apiUrl\n        };\n      } else {\n        return {\n          company: '–°–î–≠–ö',\n          price: 0,\n          days: 0,\n          error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –°–î–≠–ö',\n          requestData,\n          responseData: data,\n          apiUrl\n        };\n      }\n    } catch (error: any) {\n      console.error('üì¶ –°–î–≠–ö –æ—à–∏–±–∫–∞:', error);\n      return {\n        company: '–°–î–≠–ö',\n        price: 0,\n        days: 0,\n        error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n        apiUrl\n      };\n    }\n  };\n\n  const calculateKit = async (): Promise<CalculationResult> => {\n    const apiUrl = '/api/kit';\n    \n    try {\n      validateMultipleCargos(form.cargos);\n      \n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n\n      const requestData = {\n        from_city: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n        to_city: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n        declared_price: form.declaredValue || 10000,\n        service: ['S089']\n      };\n\n      console.log('üöõ –ö–ò–¢ –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n\n       const result = await enhancedApiRequest(\n         apiUrl,\n         {\n           method: 'POST',\n           headers: {\n             'Content-Type': 'application/json',\n           },\n           body: JSON.stringify(requestData)\n         },\n         { operation: 'calculate', company: '–ö–ò–¢' }\n       );\n\n       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n         console.error('‚ùå –ö–ò–¢ API –æ—à–∏–±–∫–∞:', result.error);\n         return {\n           company: '–ö–ò–¢',\n           price: 0,\n           days: 0,\n           error: result.error.userMessage || result.error.message,\n           requestData,\n           responseData: null,\n           apiUrl\n         };\n       }\n\n       const response = result as Response;\n       const data = await response.json();\n       console.log('üöõ –ö–ò–¢ –æ—Ç–≤–µ—Ç:', data);\n\n      if (response.ok && Array.isArray(data) && data.length > 0) {\n        const rubData = data.find((item: any) => {\n          const tariffData: any = Object.values(item)[0];\n          return tariffData?.currency_code === 'RUB';\n        });\n        \n        if (rubData) {\n          const tariffKey = Object.keys(rubData)[0];\n          const tariffData: any = rubData[tariffKey];\n          \n          console.log('üöõ –ö–ò–¢ –≤—ã–±—Ä–∞–Ω —Ç–∞—Ä–∏—Ñ:', tariffKey, tariffData);\n\n          return {\n            company: '–ö–ò–¢',\n            price: Math.round(tariffData.cost || 0),\n            days: tariffData.time || 0,\n            details: {\n              tariff_name: tariffData.name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n              tariff_type: tariffKey,\n              services: tariffData.detail || [],\n              currency: tariffData.currency_code\n            },\n            requestData,\n            responseData: data,\n            apiUrl\n          };\n        }\n      }\n\n      return {\n        company: '–ö–ò–¢',\n        price: 0,\n        days: 0,\n        error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –ö–ò–¢',\n        requestData,\n        responseData: data,\n        apiUrl\n      };\n    } catch (error: any) {\n      console.error('üöõ –ö–ò–¢ –æ—à–∏–±–∫–∞:', error);\n      return {\n        company: '–ö–ò–¢',\n        price: 0,\n        days: 0,\n        error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n        apiUrl\n      };\n    }\n  };\n\n  const handleCalculate = async () => {\n    const totalStartTime = performance.now();\n    setCalculating(true);\n    setCalculations([]);\n    \n    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø–æ—Å–ª–µ —Ä–∞—Å—á–µ—Ç–∞ (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ, –±–µ–∑ –¥–µ–±–∞—É–Ω—Å–∞)\n    saveFormData({\n      cargos: form.cargos,\n      fromCity: form.fromCity,\n      toCity: form.toCity,\n      fromAddress: form.fromAddress,\n      toAddress: form.toAddress,\n      declaredValue: form.declaredValue,\n      needPackaging: form.needPackaging,\n      needLoading: form.needLoading,\n      needCarry: form.needCarry,\n      floor: form.floor,\n      hasFreightLift: form.hasFreightLift,\n      needInsurance: form.needInsurance,\n      fromTerminal: form.fromTerminal,\n      toTerminal: form.toTerminal,\n      fromAddressDelivery: form.fromAddressDelivery,\n      toAddressDelivery: form.toAddressDelivery,\n      selectedProducts: form.selectedProducts,\n    });\n    \n    try {\n      console.log('üöÄ === –ù–ê–ß–ê–õ–û –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–û–ì–û –†–ê–°–ß–ï–¢–ê ===');\n      \n      // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞\n      const { optimizedApiClient } = await import('@/lib/optimized-api-client');\n      const { cacheManager } = await import('@/lib/cache-manager');\n      \n      // 1. –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–µ—Å—Å–∏–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ\n      const preloadStartTime = performance.now();\n      await optimizedApiClient.preloadCalculationData(form);\n      const preloadDuration = performance.now() - preloadStartTime;\n      console.log(`‚ö° –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∑–∞ ${preloadDuration.toFixed(0)}–º—Å`);\n      \n      // 2. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∫–ª—é—á–µ–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏\n      const enabledCompaniesList: Array<{ name: string; key: string; func: () => Promise<CalculationResult> }> = [];\n      \n      if (enabledCompanies.pek) enabledCompaniesList.push({ name: '–ü–≠–ö', key: 'pek', func: calculatePEK });\n      if (enabledCompanies.dellin) enabledCompaniesList.push({ name: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏', key: 'dellin', func: calculateDellin });\n      if (enabledCompanies.railcontinent) enabledCompaniesList.push({ name: 'Rail Continent', key: 'railcontinent', func: calculateRailContinent });\n      if (enabledCompanies.vozovoz) enabledCompaniesList.push({ name: '–í–æ–∑–æ–≤–æ–∑', key: 'vozovoz', func: calculateVozovoz });\n      if (enabledCompanies.nordwheel) enabledCompaniesList.push({ name: 'Nord Wheel', key: 'nordwheel', func: calculateNordWheel });\n      if (enabledCompanies.cdek) enabledCompaniesList.push({ name: '–°–¥—ç–∫', key: 'cdek', func: calculateCdek });\n      if (enabledCompanies.kit) enabledCompaniesList.push({ name: '–ö–∏—Ç', key: 'kit', func: calculateKit });\n      \n      // –ï—Å–ª–∏ –Ω–∏ –æ–¥–Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞\n      if (enabledCompaniesList.length === 0) {\n        setCalculations([]);\n        return;\n      }\n      \n      console.log(`üìã –ó–∞–ø—É—Å–∫ —Ä–∞—Å—á–µ—Ç–æ–≤ –¥–ª—è ${enabledCompaniesList.length} –∫–æ–º–ø–∞–Ω–∏–π:`, enabledCompaniesList.map(c => c.name));\n      \n      // 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞\n      setCalculationProgress({\n        companies: enabledCompaniesList.map(company => ({\n          name: company.name,\n          status: 'pending'\n        })),\n        totalDuration: 0\n      });\n      \n      // 4. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ä–∞—Å—á–µ—Ç–æ–≤ —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞\n      const calculationStartTime = performance.now();\n      const calculationPromises = enabledCompaniesList.map(async (company, index) => {\n        const companyStartTime = performance.now();\n        \n        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ \"loading\"\n        setCalculationProgress(prev => ({\n          ...prev,\n          companies: prev.companies.map((c, i) => \n            i === index ? { ...c, status: 'loading', progress: 0 } : c\n          )\n        }));\n        \n        try {\n          const result = await optimizedApiClient.calculateWithCache(\n            company.key,\n            company.func,\n            form\n          );\n          \n          const duration = performance.now() - companyStartTime;\n          \n          // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ \"completed\"\n          setCalculationProgress(prev => ({\n            ...prev,\n            companies: prev.companies.map((c, i) => \n              i === index ? { \n                ...c, \n                status: 'completed', \n                progress: 100, \n                duration \n              } : c\n            )\n          }));\n          \n          return result;\n        } catch (error) {\n          const duration = performance.now() - companyStartTime;\n          const errorMessage = error instanceof Error ? error.message : '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞';\n          \n          // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ \"error\"\n          setCalculationProgress(prev => ({\n            ...prev,\n            companies: prev.companies.map((c, i) => \n              i === index ? { \n                ...c, \n                status: 'error', \n                error: errorMessage,\n                duration \n              } : c\n            )\n          }));\n          \n          console.error(`‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ ${company.name}:`, error);\n          return {\n            company: company.name,\n            price: 0,\n            days: 0,\n            error: errorMessage,\n            duration\n          };\n        }\n      });\n      \n      const results = await Promise.allSettled(calculationPromises);\n      const calculationDuration = performance.now() - calculationStartTime;\n      \n      // 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤\n      const validResults: CalculationResult[] = [];\n      const errors: string[] = [];\n      \n      results.forEach((result, index) => {\n        if (result.status === 'fulfilled') {\n          validResults.push(result.value);\n        } else {\n          const companyName = enabledCompaniesList[index].name;\n          errors.push(`${companyName}: ${result.reason}`);\n          console.error(`‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ ${companyName}:`, result.reason);\n        }\n      });\n      \n      // 5. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤\n      const sortedResults = validResults\n        .filter(result => !result.error)\n        .sort((a, b) => a.price - b.price)\n        .concat(validResults.filter(result => result.error));\n      \n      // 6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n      const totalDuration = performance.now() - totalStartTime;\n      const successCount = sortedResults.filter(r => !r.error).length;\n      const cacheStats = cacheManager.getCacheStats();\n      \n      console.log(`‚úÖ === –†–ê–°–ß–ï–¢ –ó–ê–í–ï–†–®–ï–ù ===`);\n      console.log(`‚è±Ô∏è –û–±—â–µ–µ –≤—Ä–µ–º—è: ${totalDuration.toFixed(0)}–º—Å`);\n      console.log(`‚ö° –†–∞—Å—á–µ—Ç—ã: ${calculationDuration.toFixed(0)}–º—Å`);\n      console.log(`üìä –£—Å–ø–µ—à–Ω–æ: ${successCount}/${enabledCompaniesList.length}`);\n      console.log(`üíæ –ö—ç—à: —Å–µ—Å—Å–∏–π=${cacheStats.sessions}, —Ä–∞—Å—á–µ—Ç–æ–≤=${cacheStats.calculations}`);\n      \n      if (errors.length > 0) {\n        console.warn(`‚ö†Ô∏è –û—à–∏–±–∫–∏: ${errors.join('; ')}`);\n      }\n      \n      // –§–∏–Ω–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞\n      setCalculationProgress(prev => ({\n        ...prev,\n        totalDuration: totalDuration\n      }));\n      \n      setCalculations(sortedResults);\n      \n    } catch (error) {\n      console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ:', error);\n      setCalculations([{\n        company: '–°–∏—Å—Ç–µ–º–∞',\n        price: 0,\n        days: 0,\n        error: error instanceof Error ? error.message : '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞'\n      }]);\n    } finally {\n      setCalculating(false);\n    }\n  };\n\n  const exportToPDF = () => {\n    if (typeof window !== 'undefined') {\n      // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Å–µ –¥–µ—Ç–∞–ª–∏ –ø–µ—Ä–µ–¥ –ø–µ—á–∞—Ç—å—é\n      const allExpanded = calculations.reduce((acc, calc) => {\n        acc[calc.company] = true;\n        return acc;\n      }, {} as { [key: string]: boolean });\n      \n      setExpandedDetails(allExpanded);\n      \n      // –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DOM\n      setTimeout(() => {\n        window.print();\n      }, 100);\n    }\n  };\n\n  const toggleDetails = (company: string) => {\n    setExpandedDetails(prev => ({\n      ...prev,\n      [company]: !prev[company]\n    }));\n  };\n\n  const toggleDebugInfo = (company: string) => {\n    setExpandedDebugInfo(prev => ({\n      ...prev,\n      [company]: !prev[company]\n    }));\n  };\n\n  // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞—Å—á–µ—Ç–∞\n  const handleReset = () => {\n    if (typeof window !== 'undefined') {\n      // –û—á–∏—â–∞–µ–º localStorage\n      localStorage.removeItem('deliveryForm');\n      \n      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É\n      setForm(initialFormState);\n      \n      // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è\n      setCalculations([]);\n      setExpandedDetails({});\n      setExpandedDebugInfo({});\n      setSuggestions([]);\n      setShowSuggestions(false);\n      setActiveField('');\n      \n      console.log('–§–æ—Ä–º–∞ —Å–±—Ä–æ—à–µ–Ω–∞ –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é');\n    }\n  };\n\n  // –ü–∞—Ä—Å–µ—Ä –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è —á–∏—Ç–∞–µ–º–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞\n  const parseCalculationDetails = (calc: CalculationResult) => {\n    console.log('üîç parseCalculationDetails –ø–æ–ª—É—á–∏–ª calc:', calc?.company || 'undefined');\n    console.log('üîç calc.details:', calc?.details ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n    console.log('üîç typeof calc.details:', typeof calc?.details);\n    \n    const details: { service: string; description: string; price: number }[] = [];\n    \n    try {\n      if (calc.company === '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏' && calc.details) {\n        console.log('üîç –ù–∞—á–∏–Ω–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–µ—Ç–∞–ª–µ–π –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π...');\n      // –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ (—É–∂–µ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –±–∞–∑–æ–≤—ã–µ —É—Å–ª—É–≥–∏ –∏ —É–ø–∞–∫–æ–≤–∫—É)\n      let basePrice = calc.details?.price || calc.price || 0;\n      \n      // –†–∞–∑–±–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ\n      let intercityPrice = 0;\n      let derivalPrice = 0;\n      let arrivalPrice = 0;\n      let packagingPrice = 0;\n      // packagingPremiums –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è - –Ω–∞–¥–±–∞–≤–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ pkg.price\n      let insurancePrice = 0;\n      \n      // –ú–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞\n      if (calc.details?.intercity?.price) {\n        intercityPrice = calc.details.intercity.price;\n        details.push({\n          service: '–ú–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞',\n          description: `${form.fromCity} - ${form.toCity}`,\n          price: intercityPrice\n        });\n      }\n      \n      // –ó–∞–±–æ—Ä –≥—Ä—É–∑–∞\n      if (calc.details?.derival?.price) {\n        derivalPrice = calc.details.derival.price;\n        details.push({\n          service: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n          description: '–û—Ç –∞–¥—Ä–µ—Å–∞',\n          price: derivalPrice\n        });\n      }\n      \n      // –î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞\n      if (calc.details?.arrival?.price) {\n        arrivalPrice = calc.details.arrival.price;\n        details.push({\n          service: '–û—Ç–≤–æ–∑ –≥—Ä—É–∑–∞',\n          description: '–î–æ –∞–¥—Ä–µ—Å–∞',\n          price: arrivalPrice\n        });\n      }\n      \n      // –£–ø–∞–∫–æ–≤–∫–∞ (–Ω–∞–¥–±–∞–≤–∫–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ pkg.price, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏)\n      if (form.needPackaging && calc.details?.packages) {\n        Object.entries(calc.details?.packages || {}).forEach(([key, pkg]: [string, any]) => {\n          if (pkg.price && pkg.price > 0) {\n            // –í—ã—á–∏—Å–ª—è–µ–º –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É —É–ø–∞–∫–æ–≤–∫–∏ (–±–µ–∑ –Ω–∞–¥–±–∞–≤–æ–∫) –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n            let basePkgPrice = pkg.price;\n            let totalPremiums = 0;\n            \n            if (pkg.premiumDetails && Array.isArray(pkg.premiumDetails)) {\n              totalPremiums = pkg.premiumDetails.reduce((sum: number, premium: any) => \n                sum + (premium.value || 0), 0);\n              basePkgPrice = pkg.price - totalPremiums;\n            }\n            \n            packagingPrice += pkg.price; // –í –æ–±—â—É—é —Å—É–º–º—É –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–Ω—É—é —Ü–µ–Ω—É\n            \n            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—É—é —É–ø–∞–∫–æ–≤–∫—É\n            details.push({\n              service: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n              description: '–£–ø–∞–∫–æ–≤–∞—Ç—å –≤ –∫–æ–º–ø–ª–µ–∫—Å ¬´–æ–±—Ä–µ—à—ë—Ç–∫–∞ + –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è¬ª',\n              price: basePkgPrice\n            });\n            \n            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–¥–±–∞–≤–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ (–¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏, –Ω–æ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –∫ –æ–±—â–µ–π —Å—É–º–º–µ)\n            if (pkg.premiumDetails && Array.isArray(pkg.premiumDetails)) {\n              pkg.premiumDetails.forEach((premium: any) => {\n                if (premium.value && premium.value > 0) {\n                  details.push({\n                    service: '–ù–∞–¥–±–∞–≤–∫–∞ –∫ —É–ø–∞–∫–æ–≤–∫–µ',\n                    description: premium.name || '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–¥–±–∞–≤–∫–∞',\n                    price: premium.value\n                  });\n                }\n              });\n            }\n          }\n        });\n      }\n      \n      // –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ\n      if (form.needInsurance && calc.details?.insurance) {\n        insurancePrice = calc.details.insurance;\n        details.push({\n          service: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n          description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n          price: insurancePrice\n        });\n      }\n      \n      // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏\n      details.push({\n        service: '–î–æ–ø.—É—Å–ª—É–≥–∏',\n        description: '–ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ –≥—Ä—É–∑–∞',\n        price: 15\n      });\n      \n      // –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –º–µ–∂–¥—É —Å—É–º–º–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é, –¥–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞—Ç–æ–∫\n      const calculatedSum = intercityPrice + derivalPrice + arrivalPrice + packagingPrice + insurancePrice + 15;\n      const remainder = basePrice - calculatedSum;\n      \n      if (Math.abs(remainder) > 1) { // –ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –±–æ–ª—å—à–µ 1 —Ä—É–±–ª—è\n        details.push({\n          service: remainder > 0 ? '–ü—Ä–æ—á–∏–µ —É—Å–ª—É–≥–∏' : '–°–∫–∏–¥–∫–∞',\n          description: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–±–æ—Ä—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏',\n          price: remainder\n        });\n      }\n     } else if (calc.company === 'Nord Wheel' && calc.details) {\n       // –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –¥–ª—è Nord Wheel —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º\n       if (calc.details.totalCost) {\n         details.push({\n           service: '–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',\n           description: calc.details.transportType ? `–¢–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞: ${calc.details.transportType}` : '',\n           price: calc.details.totalCost\n         });\n       }\n       \n       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ª—É–≥–∏ –∏–∑ –æ—Ç–≤–µ—Ç–∞ API\n       if (calc.details.services && Array.isArray(calc.details.services)) {\n         calc.details.services.forEach((service: any) => {\n           if (service.name && service.price) {\n             details.push({\n               service: service.name,\n               description: service.description || '',\n               price: service.price\n             });\n           }\n         });\n       }\n       \n       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n       if (calc.details.allOptions && Array.isArray(calc.details.allOptions)) {\n         details.push({\n           service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n           description: '',\n           price: 0\n         });\n         details.push({\n           service: '–î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã',\n           description: `–í—ã–±—Ä–∞–Ω: ${calc.details.transportType}`,\n           price: 0\n         });\n         \n         calc.details.allOptions.forEach((option: any) => {\n           details.push({\n             service: `–í–∞—Ä–∏–∞–Ω—Ç ${option.type}`,\n             description: `${option.days} –¥–Ω–µ–π`,\n             price: option.price\n           });\n         });\n       }\n\n    } else if (calc.company === '–ü–≠–ö' && calc.details?.services) {\n      // –î–ª—è –ü–≠–ö –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ API\n      calc.details.services.forEach((service: any) => {\n        if (service.price > 0) {\n          details.push({\n            service: service.name || '–£—Å–ª—É–≥–∞ –ü–≠–ö',\n            description: service.description || '',\n            price: service.price\n          });\n        }\n      });\n    } else if (calc.company === '–°–î–≠–ö' && calc.details) {\n      const cdekServiceNames: Record<string, string> = {\n        'INSURANCE': '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n        'HEAVY_CARGO': '–¢—è–∂–µ–ª–æ–≤–µ—Å–Ω—ã–π –≥—Ä—É–∑',\n        'DELIVERY_TO_DOOR': '–î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –¥–≤–µ—Ä–∏',\n        'PICKUP_FROM_SENDER': '–ó–∞–±–æ—Ä –æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è',\n        'PACKAGE': '–£–ø–∞–∫–æ–≤–∫–∞',\n        'TRYING_ON': '–ü—Ä–∏–º–µ—Ä–∫–∞ –Ω–∞ –¥–æ–º—É',\n        'PART_DELIVERY': '–ß–∞—Å—Ç–∏—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞'\n      };\n\n      if (calc.details.services && calc.details.services.length > 0) {\n        calc.details.services.forEach((service: any) => {\n          const serviceName = cdekServiceNames[service.code] || service.code || '–£—Å–ª—É–≥–∞ –°–î–≠–ö';\n          const servicePrice = service.total_sum || service.sum || 0;\n          \n          if (servicePrice > 0) {\n            details.push({\n              service: serviceName,\n              description: service.code === 'HEAVY_CARGO' \n                ? `–°–±–æ—Ä –∑–∞ –≥–∞–±–∞—Ä–∏—Ç–Ω—ã–π –≥—Ä—É–∑ (—Ä–∞—Å—á–µ—Ç–Ω—ã–π –≤–µ—Å: ${(calc.details.weight_calc / 1000).toFixed(0)} –∫–≥)`\n                : service.code === 'INSURANCE'\n                ? `–û–±—ä—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${form.declaredValue?.toLocaleString() || 0} ‚ÇΩ`\n                : '',\n              price: servicePrice\n            });\n          }\n        });\n        \n        if (calc.details.delivery_sum && calc.details.total_sum) {\n          details.push({\n            service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n            description: '',\n            price: 0\n          });\n          details.push({\n            service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',\n            description: calc.details.tariff_name || '–ü–µ—Ä–µ–≤–æ–∑–∫–∞',\n            price: Math.round(calc.details.delivery_sum)\n          });\n          \n          const additionalSum = calc.details.services.reduce((sum: number, s: any) => \n            sum + (s.total_sum || s.sum || 0), 0\n          );\n          \n          if (additionalSum > 0) {\n            details.push({\n              service: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏',\n              description: '–î–æ–ø. —Å–±–æ—Ä—ã',\n              price: Math.round(additionalSum)\n            });\n          }\n          \n          details.push({\n            service: '–ò–¢–û–ì–û',\n            description: '–ö –æ–ø–ª–∞—Ç–µ',\n            price: Math.round(calc.details.total_sum)\n          });\n        }\n      } else {\n        details.push({\n          service: '–¢–∞—Ä–∏—Ñ',\n          description: calc.details.tariff_name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n          price: calc.price\n        });\n        \n        if (calc.details.delivery_mode) {\n          details.push({\n            service: '–†–µ–∂–∏–º –¥–æ—Å—Ç–∞–≤–∫–∏',\n            description: calc.details.delivery_mode,\n            price: 0\n          });\n        }\n      }\n      \n      if (calc.details.period_min && calc.details.period_max) {\n        details.push({\n          service: '–°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏',\n          description: `${calc.details.period_min}-${calc.details.period_max} –¥–Ω–µ–π`,\n          price: 0\n        });\n      }\n      \n      if (calc.details.weight_calc) {\n        details.push({\n          service: '–†–∞—Å—á–µ—Ç–Ω—ã–π –≤–µ—Å',\n          description: `${calc.details.weight_calc} –∫–≥`,\n          price: 0\n        });\n      }\n    } else if (calc.company === '–í–æ–∑–æ–≤–æ–∑' && calc.details?.service) {\n      // ‚úÖ –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –í–æ–∑–æ–≤–æ–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ API –æ—Ç–≤–µ—Ç–∞\n      const basePrice = calc.details.basePrice || 0;\n      const finalPrice = calc.details.price || calc.price || 0;\n      const totalDiscount = basePrice - finalPrice;\n      \n      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é —É—Å–ª—É–≥—É —Å –±–∞–∑–æ–≤–æ–π —Ü–µ–Ω–æ–π –∏ —Å–∫–∏–¥–∫–æ–π\n      calc.details.service.forEach((service: any) => {\n        const serviceDiscount = (service.basePrice || 0) - (service.price || 0);\n        \n        // –û—Å–Ω–æ–≤–Ω–∞—è —É—Å–ª—É–≥–∞\n        details.push({\n          service: service.name || '–£—Å–ª—É–≥–∞ –í–æ–∑–æ–≤–æ–∑',\n          description: '',\n          price: service.price || 0\n        });\n        \n        // –°–∫–∏–¥–∫–∞ –Ω–∞ —É—Å–ª—É–≥—É (–µ—Å–ª–∏ –µ—Å—Ç—å)\n        if (serviceDiscount > 0) {\n          details.push({\n            service: `–°–∫–∏–¥–∫–∞ –Ω–∞ ${service.name?.toLowerCase() || '—É—Å–ª—É–≥—É'}`,\n            description: `${(service.basePrice || 0).toLocaleString()} - ${(service.price || 0).toLocaleString()}`,\n            price: -serviceDiscount\n          });\n        }\n      });\n      \n      // –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Å –æ–±—â–∏–º–∏ —Å–∫–∏–¥–∫–∞–º–∏\n      if (totalDiscount > 0) {\n        details.push({\n          service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n          description: '',\n          price: 0\n        });\n        details.push({\n          service: '–ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å',\n          description: '–î–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–∫–∏–¥–æ–∫',\n          price: basePrice\n        });\n        details.push({\n          service: '–û–±—â–∏–µ —Å–∫–∏–¥–∫–∏',\n          description: `–≠–∫–æ–Ω–æ–º–∏—è ${totalDiscount.toLocaleString()} ‚ÇΩ`,\n          price: -totalDiscount\n        });\n        details.push({\n          service: '–ò–¢–û–ì–û',\n          description: '–ö –æ–ø–ª–∞—Ç–µ',\n          price: finalPrice\n        });\n      }\n    } else if (calc.company === '–ö–ò–¢' && calc.details?.services) {\n      calc.details.services.forEach((service: any) => {\n        details.push({\n          service: service.name || '–£—Å–ª—É–≥–∞ –ö–ò–¢',\n          description: service.code || '',\n          price: service.price || 0\n        });\n      });\n      \n      if (calc.details.tariff_name) {\n        details.push({\n          service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n          description: '',\n          price: 0\n        });\n        details.push({\n          service: '–¢–∞—Ä–∏—Ñ',\n          description: calc.details.tariff_name,\n          price: 0\n        });\n        details.push({\n          service: '–ò–¢–û–ì–û',\n          description: calc.details.currency || 'RUB',\n          price: calc.price\n        });\n      }\n    } else {\n      // –î–ª—è –¥—Ä—É–≥–∏—Ö –¢–ö - –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n      details.push({\n        service: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n        description: `${form.fromCity} - ${form.toCity}`,\n        price: calc.price\n      });\n      \n      if (form.needInsurance && form.declaredValue > 0) {\n        details.push({\n          service: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ',\n          description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n          price: Math.round(form.declaredValue * 0.02)\n        });\n      }\n      \n      if (form.needPackaging) {\n        const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n        details.push({\n          service: '–£–ø–∞–∫–æ–≤–∫–∞',\n          description: '',\n          price: Math.round(totalWeight * 30)\n        });\n      }\n    }\n    \n    return details;\n  } catch (globalError) {\n    console.error('‚ùå –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –û–®–ò–ë–ö–ê –≤ parseCalculationDetails:', globalError);\n    console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', globalError instanceof Error ? globalError.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n    console.log('‚ùå calc object:', calc);\n    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ\n    return [{\n      service: '–î–æ—Å—Ç–∞–≤–∫–∞',\n      description: '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞',\n      price: calc?.price || 0\n    }];\n  }\n};\n\n  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –ø–æ–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏)\n  if (!isLoaded) {\n    return (\n      <div className=\"min-h-screen bg-gray-900 text-white p-4 relative flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400 mx-auto mb-4\"></div>\n          <p className=\"text-blue-400\">–ó–∞–≥—Ä—É–∑–∫–∞...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-900 text-white p-4 relative\">\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <h1 className=\"text-xl font-bold text-blue-400\">\n            –ú–µ–∂–¥—É–≥–æ—Ä–æ–¥–Ω—è—è –¥–æ—Å—Ç–∞–≤–∫–∞ –õ–∞–≤—Å–∏—Ç\n          </h1>\n          \n          {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è */}\n          <div className=\"flex items-center gap-4\">\n            {isFormChanged ? (\n              <div className=\"flex items-center gap-2 text-yellow-400 text-sm\">\n                <div className=\"w-2 h-2 bg-yellow-400 rounded-full animate-pulse\"></div>\n                –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...\n              </div>\n            ) : lastSaveTime ? (\n              <div className=\"flex items-center gap-2 text-green-400 text-sm\">\n                <div className=\"w-2 h-2 bg-green-400 rounded-full\"></div>\n                –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ {lastSaveTime.toLocaleTimeString()}\n              </div>\n            ) : hasStoredFormData() ? (\n              <div className=\"flex items-center gap-2 text-blue-400 text-sm\">\n                <div className=\"w-2 h-2 bg-blue-400 rounded-full\"></div>\n                –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã\n              </div>\n            ) : null}\n            \n            {/* –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–µ—Ä–≤–∏—Å–Ω–æ–µ –º–µ–Ω—é –≤–∏–¥–∏–º–æ */}\n            {hasStoredFormData() && isServiceMenuVisible && (\n              <Button\n                onClick={() => {\n                  if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã?')) {\n                    clearFormData();\n                    setForm(initialFormState);\n                    setLastSaveTime(null);\n                    setIsFormChanged(false);\n                  }\n                }}\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"border-red-500 text-red-400 hover:bg-red-900/20\"\n              >\n                <Trash2 className=\"h-3 w-3 mr-1\" />\n                –û—á–∏—Å—Ç–∏—Ç—å\n              </Button>\n            )}\n          </div>\n        </div>\n        \n        {/* –ö–Ω–æ–ø–∫–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ */}\n        <div className=\"flex justify-end gap-2 mb-4\">\n          {/* –ö–Ω–æ–ø–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–Ω—ã–º –º–µ–Ω—é */}\n          <Button \n            onClick={() => setIsServiceMenuVisible(!isServiceMenuVisible)}\n            variant=\"outline\" \n            className=\"border-yellow-500 text-yellow-400 hover:bg-yellow-900/20\"\n          >\n            {isServiceMenuVisible ? (\n              <>\n                <EyeOff className=\"h-4 w-4 mr-2\" />\n                –°–∫—Ä—ã—Ç—å —Å–µ—Ä–≤–∏—Å–Ω–æ–µ –º–µ–Ω—é\n              </>\n            ) : (\n              <>\n                <Eye className=\"h-4 w-4 mr-2\" />\n                –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ—Ä–≤–∏—Å–Ω–æ–µ –º–µ–Ω—é\n              </>\n            )}\n          </Button>\n\n          {/* –°–µ—Ä–≤–∏—Å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ - –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –º–µ–Ω—é –≤–∏–¥–∏–º–æ */}\n          {isServiceMenuVisible && (\n            <>\n              <Button \n                onClick={() => window.open('/diagnostic?tab=api', '_blank')}\n                variant=\"outline\" \n                className=\"border-green-500 text-green-400 hover:bg-green-900/20\"\n              >\n                <Settings className=\"h-4 w-4 mr-2\" />\n                –í—Å–µ API\n              </Button>\n              <Button \n                onClick={() => window.open('/diagnostic?tab=docs', '_blank')}\n                variant=\"outline\" \n                className=\"border-purple-500 text-purple-400 hover:bg-purple-900/20\"\n              >\n                <Package2 className=\"h-4 w-4 mr-2\" />\n                –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è\n              </Button>\n              <Button \n                onClick={() => window.open('/diagnostic', '_blank')}\n                variant=\"outline\" \n                className=\"border-blue-500 text-blue-400 hover:bg-blue-900/20\"\n              >\n                <Settings className=\"h-4 w-4 mr-2\" />\n                –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞\n              </Button>\n            </>\n          )}\n        </div>\n        \n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-3 h-[85vh]\">\n          {/* –õ–µ–≤–∞—è —á–∞—Å—Ç—å - —Ñ–æ—Ä–º–∞ */}\n          <div className=\"space-y-2 overflow-y-auto pr-2\">\n            {/* –ö–∞—Ç–∞–ª–æ–≥ –º–µ–±–µ–ª–∏ */}\n            <Card className=\"bg-gray-800 border-gray-700\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n                  <Package2 className=\"h-3 w-3\" />\n                  –ö–∞—Ç–∞–ª–æ–≥ –º–µ–±–µ–ª–∏\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-2\">\n                {/* –ü–æ–∏—Å–∫ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ */}\n                <LazyProductSearch \n                  onProductAdd={handleProductAdd}\n                  disabled={calculating}\n                />\n                \n                {/* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏ */}\n                <ProductManager\n                  products={form.selectedProducts}\n                  onQuantityChange={handleProductQuantityChange}\n                  onProductRemove={handleProductRemove}\n                  disabled={calculating}\n                />\n              </CardContent>\n            </Card>\n\n            {/* –ì—Ä—É–∑—ã */}\n            <Card className=\"bg-gray-800 border-gray-700\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n                  <Truck className=\"h-3 w-3\" />\n                  –ì—Ä—É–∑—ã\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-2\">\n                {groupCargosForDisplay(form.cargos).map((group, groupIndex) => (\n                   <div key={`group_${groupIndex}`} className=\"border border-gray-600 rounded p-2\">\n                    <div className=\"flex justify-between items-center mb-2\">\n                      <h4 className=\"text-sm font-medium text-white\">\n                        {group.isEmpty ? (\n                          `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1}`\n                        ) : group.quantity === 1 ? (\n                          `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1}`\n                        ) : (\n                          `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1} - ${group.quantity} –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –º–µ—Å—Ç–∞`\n                        )}\n                      </h4>\n                      {form.cargos.length > 1 && group.quantity === 1 && (\n                        <Button\n                          variant=\"destructive\"\n                          size=\"sm\"\n                          onClick={() => removeCargo(form.cargos[group.indices[0]].id)}\n                          className=\"h-6 text-xs\"\n                        >\n                          –£–¥–∞–ª–∏—Ç—å\n                        </Button>\n                      )}\n                      {group.quantity > 1 && (\n                        <Badge variant=\"secondary\" className=\"text-xs\">\n                          {group.quantity} —à—Ç.\n                        </Badge>\n                      )}\n                    </div>\n                    \n                    {group.isEmpty || group.quantity === 1 ? (\n                      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞ –¥–ª—è –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ –∏–ª–∏ –µ–¥–∏–Ω–∏—á–Ω—ã—Ö\n                      <div className=\"grid grid-cols-2 gap-2\">\n                        <div>\n                          <Label className=\"text-white text-xs\">–î–ª–∏–Ω–∞ (—Å–º)</Label>\n                          <Input\n                            type=\"number\"\n                            value={form.cargos[group.indices[0]].length || ''}\n                            onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'length', Number(e.target.value))}\n                            className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n                          />\n                        </div>\n                        <div>\n                          <Label className=\"text-white text-xs\">–®–∏—Ä–∏–Ω–∞ (—Å–º)</Label>\n                          <Input\n                            type=\"number\"\n                            value={form.cargos[group.indices[0]].width || ''}\n                            onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'width', Number(e.target.value))}\n                            className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n                          />\n                        </div>\n                        <div>\n                          <Label className=\"text-white text-xs\">–í—ã—Å–æ—Ç–∞ (—Å–º)</Label>\n                          <Input\n                            type=\"number\"\n                            value={form.cargos[group.indices[0]].height || ''}\n                            onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'height', Number(e.target.value))}\n                            className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n                          />\n                        </div>\n                        <div>\n                          <Label className=\"text-white text-xs\">–í–µ—Å (–∫–≥)</Label>\n                          <Input\n                            type=\"number\"\n                            value={form.cargos[group.indices[0]].weight || ''}\n                            onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'weight', Number(e.target.value))}\n                            className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n                          />\n                        </div>\n                      </div>\n                    ) : (\n                      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –≥—Ä—É–ø–ø\n                      <div className=\"grid grid-cols-2 gap-2 text-sm text-gray-300\">\n                        <div>–î–ª–∏–Ω–∞: {group.length} —Å–º</div>\n                        <div>–®–∏—Ä–∏–Ω–∞: {group.width} —Å–º</div>\n                        <div>–í—ã—Å–æ—Ç–∞: {group.height} —Å–º</div>\n                        <div>–í–µ—Å: {group.weight} –∫–≥</div>\n                        <div className=\"col-span-2 text-xs text-blue-300 mt-1\">\n                          –û–±—â–∏–π –≤–µ—Å: {(group.weight * group.quantity).toFixed(1)} –∫–≥, \n                          –æ–±—ä–µ–º: {((group.length * group.width * group.height * group.quantity) / 1000000).toFixed(3)} –º¬≥\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                ))}\n                 <Button onClick={addCargo} className=\"w-full h-7 text-xs\" variant=\"outline\">\n                  <Plus className=\"h-3 w-3 mr-1\" />\n                  –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–∑\n                </Button>\n              </CardContent>\n            </Card>\n\n            {/* –ú–∞—Ä—à—Ä—É—Ç */}\n            <Card className=\"bg-gray-800 border-gray-700\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n                  <Map className=\"h-3 w-3\" />\n                  –ú–∞—Ä—à—Ä—É—Ç\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-2\">\n                {/* –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */}\n                <div className=\"space-y-2\">\n                  <Label className=\"text-sm font-medium text-white\">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</Label>\n                  <div className=\"flex gap-3 flex-wrap\">\n                    <label className=\"flex items-center space-x-1\">\n                      <input\n                        type=\"radio\"\n                        name=\"fromDelivery\"\n                        checked={form.fromTerminal}\n                        onChange={() => setForm(prev => ({ ...prev, fromTerminal: true, fromAddressDelivery: false, fromLavsiteWarehouse: false }))}\n                      />\n                      <span className=\"text-white text-xs\">–û—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞</span>\n                    </label>\n                    <label className=\"flex items-center space-x-1\">\n                      <input\n                        type=\"radio\"\n                        name=\"fromDelivery\"\n                        checked={form.fromAddressDelivery && !form.fromLavsiteWarehouse}\n                        onChange={() => setForm(prev => ({ ...prev, fromTerminal: false, fromAddressDelivery: true, fromLavsiteWarehouse: false }))}\n                      />\n                      <span className=\"text-white text-xs\">–û—Ç –∞–¥—Ä–µ—Å–∞</span>\n                    </label>\n                    <label className=\"flex items-center space-x-1\">\n                      <Checkbox\n                        id=\"lavsiteWarehouse\"\n                        checked={form.fromLavsiteWarehouse}\n                        onCheckedChange={handleLavsiteWarehouseChange}\n                      />\n                      <span className=\"text-white text-xs cursor-pointer\">–°–æ —Å–∫–ª–∞–¥–∞ –õ–∞–≤—Å–∏—Ç</span>\n                    </label>\n                  </div>\n                  \n                  <div>\n                    <Label className=\"text-white text-xs\">–ì–æ—Ä–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</Label>\n                    <Input\n                      value={form.fromCity}\n                      onChange={(e) => !form.fromLavsiteWarehouse && handleAddressChange('fromCity', e.target.value, e.target)}\n                      placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –≥–æ—Ä–æ–¥\"\n                      disabled={form.fromLavsiteWarehouse}\n                      className={`bg-gray-700 border-gray-600 h-7 text-white text-xs ${form.fromLavsiteWarehouse ? 'opacity-50 cursor-not-allowed' : ''}`}\n                    />\n                  </div>\n                  \n                  {form.fromAddressDelivery && (\n                    <div>\n                      <Label className=\"text-white text-xs\">–ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</Label>\n                      <Input\n                        value={form.fromAddress}\n                        onChange={(e) => !form.fromLavsiteWarehouse && handleAddressChange('fromAddress', e.target.value, e.target)}\n                        placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å\"\n                        disabled={form.fromLavsiteWarehouse}\n                        className={`bg-gray-700 border-gray-600 h-7 text-white text-xs ${form.fromLavsiteWarehouse ? 'opacity-50 cursor-not-allowed' : ''}`}\n                      />\n                    </div>\n                  )}\n                </div>\n\n                {/* –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ */}\n                <div className=\"space-y-2\">\n                  <Label className=\"text-sm font-medium text-white\">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</Label>\n                  <div className=\"flex gap-3 flex-wrap\">\n                    <label className=\"flex items-center space-x-1\">\n                      <input\n                        type=\"radio\"\n                        name=\"toDelivery\"\n                        checked={form.toTerminal}\n                        onChange={() => setForm(prev => ({ ...prev, toTerminal: true, toAddressDelivery: false }))}\n                      />\n                      <span className=\"text-white text-xs\">–î–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞</span>\n                    </label>\n                    <label className=\"flex items-center space-x-1\">\n                      <input\n                        type=\"radio\"\n                        name=\"toDelivery\"\n                        checked={form.toAddressDelivery}\n                        onChange={() => setForm(prev => ({ ...prev, toTerminal: false, toAddressDelivery: true }))}\n                      />\n                      <span className=\"text-white text-xs\">–î–æ –∞–¥—Ä–µ—Å–∞</span>\n                    </label>\n                  </div>\n                  \n                  <div>\n                    <Label className=\"text-white text-xs\">–ì–æ—Ä–æ–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</Label>\n                    <Input\n                      value={form.toCity}\n                      onChange={(e) => handleAddressChange('toCity', e.target.value, e.target)}\n                      placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –≥–æ—Ä–æ–¥\"\n                      className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n                    />\n                  </div>\n                  \n                  {form.toAddressDelivery && (\n                    <div>\n                      <Label className=\"text-white text-xs\">–ê–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</Label>\n                      <Input\n                        value={form.toAddress}\n                        onChange={(e) => handleAddressChange('toAddress', e.target.value, e.target)}\n                        placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å\"\n                        className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n                      />\n                    </div>\n                  )}\n                </div>\n\n                <div>\n                  <Label className=\"text-white text-xs\">–û–±—ä—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (—Ä—É–±.)</Label>\n                  <Input\n                    type=\"number\"\n                    value={form.declaredValue || ''}\n                    onChange={(e) => setForm(prev => ({ ...prev, declaredValue: Number(e.target.value) }))}\n                    className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n                  />\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center space-x-2\">\n                    <Checkbox\n                      id=\"packaging\"\n                      checked={form.needPackaging}\n                      onCheckedChange={(checked) => setForm(prev => ({ ...prev, needPackaging: checked as boolean }))}\n                      className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n                    />\n                    <Label htmlFor=\"packaging\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è —É–ø–∞–∫–æ–≤–∫–∞</Label>\n                  </div>\n                  \n                  <div className=\"flex items-center space-x-2\">\n                    <Checkbox\n                      id=\"insurance\"\n                      checked={form.needInsurance}\n                      onCheckedChange={(checked) => setForm(prev => ({ ...prev, needInsurance: checked as boolean }))}\n                      className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n                    />\n                    <Label htmlFor=\"insurance\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞</Label>\n                  </div>\n                  \n                  <div className=\"flex items-center space-x-2\">\n                    <Checkbox\n                      id=\"loading\"\n                      checked={form.needLoading}\n                      onCheckedChange={(checked) => setForm(prev => ({ ...prev, needLoading: checked as boolean }))}\n                      className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n                    />\n                    <Label htmlFor=\"loading\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≥—Ä—É–∑–∫–∞/—Ä–∞–∑–≥—Ä—É–∑–∫–∞</Label>\n                  </div>\n                  \n                  <div className=\"flex items-center space-x-2\">\n                    <Checkbox\n                      id=\"carry\"\n                      checked={form.needCarry}\n                      onCheckedChange={(checked) => setForm(prev => ({ ...prev, needCarry: checked as boolean }))}\n                      className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n                    />\n                    <Label htmlFor=\"carry\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—ä–µ–º</Label>\n                  </div>\n                  \n                  {form.needCarry && (\n                    <div className=\"ml-6 space-y-2 border-l-2 border-gray-600 pl-3\">\n                      <div>\n                        <Label className=\"text-white text-xs\">–≠—Ç–∞–∂</Label>\n                        <Input\n                          type=\"number\"\n                          value={form.floor}\n                          onChange={(e) => setForm(prev => ({ ...prev, floor: Number(e.target.value) }))}\n                          className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n                        />\n                      </div>\n                      <div className=\"flex items-center space-x-2\">\n                        <Checkbox\n                          id=\"freightLift\"\n                          checked={form.hasFreightLift}\n                          onCheckedChange={(checked) => setForm(prev => ({ ...prev, hasFreightLift: checked as boolean }))}\n                        />\n                        <Label htmlFor=\"freightLift\" className=\"text-white text-xs\">–ù–∞–ª–∏—á–∏–µ –≥—Ä—É–∑–æ–≤–æ–≥–æ –ª–∏—Ñ—Ç–∞</Label>\n                      </div>\n                    </div>\n                  )}\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Button \n                    onClick={handleCalculate} \n                    className=\"w-full bg-blue-600 hover:bg-blue-700 h-7 text-xs\" \n                    disabled={calculating}\n                  >\n                    {calculating ? '–†–∞—Å—á–µ—Ç...' : '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å'}\n                  </Button>\n                  \n                  <Button \n                    onClick={handleReset} \n                    variant=\"outline\" \n                    className=\"w-full h-7 text-xs text-black border-gray-600 hover:bg-gray-700 hover:text-white\" \n                    disabled={calculating}\n                  >\n                    –°–±—Ä–æ—Å–∏—Ç—å —Ä–∞—Å—á–µ—Ç\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã */}\n          <div className=\"space-y-2 overflow-y-auto\">\n            {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Ä–∞—Å—á–µ—Ç–æ–≤ */}\n            <CalculationProgress \n              companies={calculationProgress.companies}\n              totalDuration={calculationProgress.totalDuration}\n              isVisible={calculating}\n            />\n            \n            {calculations.length > 0 && (\n                 <div className=\"space-y-2\">\n                <div className=\"flex justify-between items-center\">\n                  <h2 className=\"text-lg font-bold text-blue-400\">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞</h2>\n                  <div className=\"flex gap-2 flex-wrap\">\n                    <SaveCalculation \n                      formData={form}\n                      calculations={calculations}\n                      enabledCompanies={hiddenCompanies}\n                      onSave={(result) => {\n                        console.log('–†–∞—Å—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω:', result);\n                      }}\n                    />\n                    <CalculationHistory \n                      onLoadCalculation={(calculation) => {\n                        console.log('–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å—á–µ—Ç–∞:', calculation.orderNumber);\n                        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞\n                      }}\n                    />\n                  </div>\n                </div>\n                \n                {calculations\n                  .filter(calc => !hiddenCompanies[calc.company])\n                  .map((calc, index) => (\n                   <Card key={index} className=\"bg-gray-800 border-gray-700 text-xs\">\n                     <CardHeader className=\"pb-1\">\n                      <div className=\"flex justify-between items-center\">\n                         <CardTitle className=\"text-white flex items-center gap-2 text-xs\">\n                           <Building2 className=\"h-3 w-3\" />\n                          {calc.company}\n                        </CardTitle>\n                        {calc.error ? (\n                          <Badge variant=\"destructive\" className=\"text-xs\">–û—à–∏–±–∫–∞</Badge>\n                        ) : (\n                          <Badge variant=\"default\" className=\"bg-green-600 text-xs\">\n                            {calc.price.toLocaleString()} ‚ÇΩ\n                          </Badge>\n                        )}\n                      </div>\n                    </CardHeader>\n                    <CardContent className=\"pt-0\">\n                      <div className=\"space-y-2\">\n                        {calc.error ? (\n                          <div className=\"space-y-2\">\n                            <Alert className=\"border-red-600\">\n                              <AlertDescription className=\"text-white text-xs\">{calc.error}</AlertDescription>\n                            </Alert>\n                            {calc.price > 0 && (\n                              <>\n                                <p className=\"text-white text-xs\"><strong>–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {calc.price.toLocaleString()} ‚ÇΩ</p>\n                                <p className=\"text-white text-xs\"><strong>–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Å—Ä–æ–∫:</strong> {calc.days} –¥–Ω–µ–π</p>\n                              </>\n                            )}\n                          </div>\n                        ) : (\n                          <>\n                            <p className=\"text-white text-xs\"><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {calc.price.toLocaleString()} ‚ÇΩ</p>\n                            <p className=\"text-white text-xs\"><strong>–°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> {calc.days} –¥–Ω–µ–π</p>\n                          </>\n                        )}\n                        \n                        <div className=\"flex gap-2 mt-2 flex-wrap\">\n                          {!calc.error && (\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => toggleDetails(calc.company)}\n                              className=\"h-6 text-xs\"\n                            >\n                              {expandedDetails[calc.company] ? '–°–∫—Ä—ã—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ' : '–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ'}\n                            </Button>\n                          )}\n                          {/* –ö–Ω–æ–ø–∫–∞ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–µ—Ä–≤–∏—Å–Ω–æ–µ –º–µ–Ω—é –≤–∏–¥–∏–º–æ */}\n                          {isServiceMenuVisible && (\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => toggleDebugInfo(calc.company)}\n                              className=\"h-6 text-xs\"\n                            >\n                              {expandedDebugInfo[calc.company] ? '–°–∫—Ä—ã—Ç—å –æ—Ç–ª–∞–¥–∫—É' : '–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'}\n                            </Button>\n                          )}\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => {\n                              setHiddenCompanies(prev => ({\n                                ...prev,\n                                [calc.company]: true\n                              }));\n                            }}\n                            className=\"h-6 text-xs border-red-500 text-red-400 hover:bg-red-900/20\"\n                          >\n                            –°–∫—Ä—ã—Ç—å\n                          </Button>\n                        </div>\n                        \n                        {/* –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ */}\n                        {!calc.error && (\n                          <Collapsible open={expandedDetails[calc.company]}>\n                            <CollapsibleContent className=\"mt-2\">\n                              <div className=\"bg-gray-900 p-3 rounded text-xs\">\n                                <h4 className=\"font-bold mb-2 text-white\">–î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞:</h4>\n                                {(() => {\n                                  const details = parseCalculationDetails(calc);\n                                  const totalPrice = details.reduce((sum, detail) => sum + detail.price, 0);\n                                  \n                                  return (\n                                    <div className=\"space-y-1\">\n                                      {details.map((detail, idx) => (\n                                        <div key={idx} className=\"flex justify-between text-white\">\n                                          <div>\n                                            <div className=\"font-medium\">{detail.service}</div>\n                                            {detail.description && (\n                                              <div className=\"text-gray-400 text-xs\">{detail.description}</div>\n                                            )}\n                                          </div>\n                                          <div className=\"font-medium\">{detail.price.toLocaleString()} ‚ÇΩ</div>\n                                        </div>\n                                      ))}\n                                    </div>\n                                  );\n                                })()}\n                              </div>\n                            </CollapsibleContent>\n                          </Collapsible>\n                        )}\n                        \n                        {/* –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è - –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ */}\n                        <Collapsible open={expandedDebugInfo[calc.company]}>\n                          <CollapsibleContent className=\"mt-2\">\n                            <div className=\"bg-gray-900 p-3 rounded text-xs\">\n                              <h4 className=\"font-bold mb-2 text-white\">–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h4>\n                              \n                              {calc.apiUrl && (\n                                <div className=\"mb-3\">\n                                  <h5 className=\"font-bold mb-1 text-white\">–ó–∞–ø—Ä–æ—Å –∫ API:</h5>\n                                  <p className=\"text-gray-300 break-all text-xs\">URL: {calc.apiUrl}</p>\n                                </div>\n                              )}\n                              \n                              {calc.sessionId && (\n                                <div className=\"mb-3\">\n                                  <h5 className=\"font-bold mb-1 text-white\">Session ID:</h5>\n                                  <p className=\"text-gray-300 text-xs\">{calc.sessionId}</p>\n                                </div>\n                              )}\n                              \n                              {calc.requestData && (\n                                <div className=\"mb-3\">\n                                  <h5 className=\"font-bold mb-1 text-white\">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å:</h5>\n                                  <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n                                    {JSON.stringify(calc.requestData, null, 2)}\n                                  </pre>\n                                </div>\n                              )}\n                              \n                              {calc.responseData && (\n                                <div className=\"mb-3\">\n                                  <h5 className=\"font-bold mb-1 text-white\">–ü–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç:</h5>\n                                  <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n                                    {JSON.stringify(calc.responseData, null, 2)}\n                                  </pre>\n                                </div>\n                              )}\n                              \n                              {calc.details && (\n                                <div className=\"mb-3\">\n                                  <h5 className=\"font-bold mb-1 text-white\">–î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ (JSON):</h5>\n                                  <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n                                    {JSON.stringify(calc.details, null, 2)}\n                                  </pre>\n                                </div>\n                              )}\n                              \n                              {calc.error && (\n                                <div className=\"mb-3\">\n                                  <h5 className=\"font-bold mb-1 text-red-400\">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ:</h5>\n                                  <p className=\"text-red-300 text-xs\">{calc.error}</p>\n                                </div>\n                              )}\n                            </div>\n                          </CollapsibleContent>\n                        </Collapsible>\n                      </div>\n                    </CardContent>\n                  </Card>\n                 ))}\n                 \n                 {/* –ë–ª–æ–∫ –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–∫—Ä—ã—Ç—ã—Ö –¢–ö */}\n                 {Object.values(hiddenCompanies).some(hidden => hidden) && (\n                   <div className=\"mt-4 p-3 bg-gray-700 rounded border-gray-600\">\n                     <div className=\"flex items-center justify-between\">\n                       <div className=\"text-sm text-gray-300\">\n                         –°–∫—Ä—ã—Ç–æ –¢–ö: {Object.values(hiddenCompanies).filter(hidden => hidden).length}\n                       </div>\n                       <Button\n                         variant=\"outline\"\n                         size=\"sm\"\n                         onClick={() => setHiddenCompanies({})}\n                         className=\"h-6 text-xs border-green-500 text-green-400 hover:bg-green-900/20\"\n                       >\n                         –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–∫—Ä—ã—Ç—ã–µ\n                       </Button>\n                     </div>\n                   </div>\n                 )}\n               </div>\n            )}\n\n            {/* –°–ø–∏—Å–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –¢–ö - –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º—ã–π */}\n            <Card className=\"bg-gray-800 border-gray-700\">\n              <CardHeader className=\"pb-2\">\n                <div className=\"flex justify-between items-center\">\n                  <CardTitle className=\"text-white text-sm\">\n                    –ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ ({COMPANIES_BASE.filter(company => showHiddenCompanies || enabledCompanies[company.apiKey]).length}{showHiddenCompanies ? ` –∏–∑ ${COMPANIES_BASE.length}` : ''})\n                  </CardTitle>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setShowHiddenCompanies(prev => !prev)}\n                    className=\"h-6 text-xs border-blue-500 text-blue-400 hover:bg-blue-900/20\"\n                  >\n                    {showHiddenCompanies ? '–°–∫—Ä—ã—Ç—å –≤—Å–µ' : '–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ'}\n                  </Button>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  {COMPANIES_BASE\n                    .filter(company => showHiddenCompanies || enabledCompanies[company.apiKey])\n                    .map((company, index) => {\n                    const isConnected = apiStatus[company.apiKey as keyof typeof apiStatus] === '–ø–æ–¥–∫–ª—é—á–µ–Ω–æ';\n                    const statusText = apiStatus[company.apiKey as keyof typeof apiStatus];\n                    const isEnabled = enabledCompanies[company.apiKey];\n                    \n                    // –û—Ç–ª–∞–¥–∫–∞ –¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–æ–º–ø–∞–Ω–∏–π\n                    if (index < 3) {\n                      console.log(`üîç –ö–æ–º–ø–∞–Ω–∏—è ${index}: ${company.name}, apiKey: ${company.apiKey}, isEnabled: ${isEnabled}, statusText: ${statusText}`);\n                    }\n                    \n                    return (\n                      <div key={index} className=\"flex items-center justify-between p-1.5 bg-gray-700 rounded\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-lg\">{company.logo}</span>\n                          <div>\n                            <p className=\"font-medium text-white text-[10px] leading-tight\">{company.name}</p>\n                            <Badge \n                              variant={isConnected ? \"default\" : \"destructive\"} \n                              className=\"text-[9px] py-0 px-1\"\n                            >\n                              {isConnected ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–∞' : statusText === '–ø—Ä–æ–≤–µ—Ä–∫–∞...' ? '–ü—Ä–æ–≤–µ—Ä–∫–∞...' : '–û—à–∏–±–∫–∞'}\n                            </Badge>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-[9px] text-gray-300\">\n                            {isEnabled ? '–í–∫–ª' : '–í—ã–∫–ª'}\n                          </span>\n                          <Switch\n                            checked={isEnabled}\n                            onCheckedChange={(checked) => {\n                              setEnabledCompanies(prev => ({\n                                ...prev,\n                                [company.apiKey]: checked\n                              }));\n                            }}\n                          />\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫—É–∑–æ–≤–∞ */}\n            {calculations.length > 0 && (\n              <LazyTruckVisualization \n                cargos={form.cargos.map(cargo => ({\n                  id: cargo.id,\n                  length: cargo.length * 10, // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n                  width: cargo.width * 10,   // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n                  height: cargo.height * 10, // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n                  weight: cargo.weight,\n                  productName: form.selectedProducts?.find(p => \n                    p.cargoIndexes.includes(form.cargos.indexOf(cargo))\n                  )?.product.name\n                }))}\n                isVisible={true}\n              />\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* –ê–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–∫–∏ */}\n      {showSuggestions && suggestions.length > 0 && (\n        <div \n          className=\"fixed z-50 bg-gray-800 border border-gray-700 rounded-md shadow-lg max-w-sm w-full max-h-60 overflow-y-auto\"\n          style={{\n            top: suggestionPosition.top,\n            left: suggestionPosition.left\n          }}\n        >\n          <div className=\"p-1\">\n            {suggestions.map((suggestion, index) => (\n              <div\n                key={index}\n                className=\"p-2 hover:bg-gray-700 cursor-pointer text-xs text-white rounded transition-colors\"\n                onClick={() => selectSuggestion(suggestion)}\n              >\n                {suggestion.value}\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}",
        "additions": 1,
        "deletions": 1
      }
    },
    "time": {
      "start": 1765876187951,
      "end": 1765876188005
    }
  }
}