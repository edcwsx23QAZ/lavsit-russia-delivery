{
  "id": "prt_986eea027001rR2Yc8IQazSKCc",
  "type": "text",
  "text": "Проанализируй вводные данные по работе ПЭК и попробуй скорректировать работу API ПЭК\n\nАутентификация\nДля начала работы с API вам необходимо присвоить Ключ доступа. Данное действие вы можете осуществить на странице «Регистрационные данные» в разделе «Ключи API». Полученный ключ будет являться вашим паролем для доступа к API.\nДля разных приложений (например, веб-сайт и 1С:Предприятие) рекомендуется использовать разные ключи (для сбора статистики, простоты отзыва ключа в случае его компроментации)\nАутентификация осуществляется c помощью Basic-аутентификации, в качестве логина необходимо использовать имя пользователя личного кабинета клиента «ПЭК», в качестве пароля — любой из активных ключей доступа.\nАвторизация\nДоступ к API обеспечивается для двух групп пользователей (анонимный доступ не поддерживается):\n«Зарегистрированные пользователи» — все пользователи личного кабинета клиента «ПЭК» (для регистрации посетите соответствующую страницу)\n«Сторонние неперсонифицированные приложения»\nВ документации на каждый метод указано, каким группам пользователей доступен вызов того или иного метода\n\nСтруктура URL\nAPI представляет собой набор методов, объединённых в группы\nОбращение к методам API осуществляется путём отправки запроса методом POST на URL метода, который формируется следующим образом: https://kabinet.pecom.ru/api/v1/<группа>/<метод>/\nURL https://kabinet.pecom.ru/api/v1/ является базовым и далее в документации не указывается\nОбщее ограничение на количество любых запросов по API: 100 запросов в минуту. После превышения числа запросов API будет возвращать ошибку.\nСписок групп и методов\n/auth/ — данные личного кабинета и дополнительная авторизация\n/profiledata/ — отображение информации, хранящейся в профиле пользователя\n/createtokentoaccessprivatedata/ — создание токена для методов получения приватной информации\n/branches/ — информация о странах, филиалах и городах\n/all/ — список всех филиалов и городов\n/findzonebycoordinates/ — поиск тарифных зон и филиалов по координатам\n/findzonebyaddress/ — поиск тарифных зон и филиалов по строке адреса\n/checkpickupdate/ — определение доступности дат забора груза\n/nearestdepartments/ — подбор ближайших к адресу отделений для приема/выдачи грузов\n/suggestaddressofintakeordelivery/ — запрос поисковых подсказок адресов забора/доставки груза\n/country/ —  список стран, в которых присутствуют отделения ПЭК\n/checknocalcservices/ —  проверка возможности предоставления услуг, не проверяемых в методе расчета стоимости\n/countrytypeidentitydocument/ — возвращает допустимые документы, удостоверяющие личность, для страны отправления / получения\n/departmentslimit/ — ограничения весо-габаритных характеристик груза для тарифа/ продукта «Express Автоперевозка».\n/cargos/ — операции с грузами\n/status/ — статус груза\n/statusbypositionbarcodes/ — статус груза по клиентским штрих-кодам\n/basicstatus/ — базовая информация о статусе груза\n/deliverystatus/ — предоставляет данные по доставке груза\n/details/ — детальная информация о грузе, фотографии\n/listallorderbylogin/ — возвращает все грузы контрагентов, к которым есть доступ в личном кабинете\n/statusfullhistory/ — история изменения статусов по заявке/ грузу\n/statustables/ — список доступных статусов по грузам\n/routesanddriverinfo/ — выводит персональные данные водителей, осуществляющих забор/доставку груза\n/getinfoforcedstorage/ —  информация по рассчитанному ВХ.\n/cancelandreturncargo/ — оформление возврата груза отправителю после передачи груза в ПЭК\n/order/ — операции со всеми видами заявок\n/cancellation/ — аннулирование ранее созданных заявок на основании кодов грузов\n/print/ — получения печатных форм заявок и этикеток в формате PDF\n/cargopickup/ — заказ \"на машину\" к заказам \"на перевозку\"\n/submit/ — подача заказа \"На машину и перевозку (разовый забор)\" или \"На перевозку (с отдельным Заказом на машину)\"\n/submit/ — подача заказа \"на машину\" к заказам \"на перевозку\"\n/status/ — получение статуса услуги \"Забор груза\"\n/checkOrderedPickupType3Car/ — получение статуса услуги \"Заказа на машину\", поданного в рамках услуги \"Упрощенный забор\"\n/preregistration/ — заявки на перевозку (авто, авиа) с забором груза от адреса отправителя и предварительное оформление\n/submit/ — единый метод подачи заявок\n/availabletypebarcode/ — справочник типов штрих-кодов\n/accountingdocuments/ — бухгалтерские документы\n/list/ — получение списка\n/cargosdocuments/ —  предоставление экспедиторских документов по грузам\n/order/ — запрос на предоставление документа по грузу\n/getcontent/ — получение документа по грузу\n/cargoinvoicebyperiod/ — получение идентификаторов грузов за период, по которым есть задолженность по запрашиваемому плательщику\n/notification/ — уведомления\n/cargosubscribe/ — подписка на уведомления по грузу\n/counterparts/ — справочники для работы с контрагентами / данные контрагентов\n/legalformtypes/ — общий список форм собственности контрагентов (юридических лиц, индивидуальных предпринимателей и т.п.)\n/confirmedaccesstocounterparties/ — список контрагентов, которые подтвердили свою связь с логином\n/connecteddiscountsservicesagreements/ — список подключенных контрагенту скидок, сервисов и основных доп.соглашений\n/receivers/ — список получателей\n/add/ — добавление получателя в справочник\n/list/ — просмотр списка получателей\n/delete/ — удаление получателя из справочника\n/update/ — изменение получателя в справочнике\n/calculator/ — калькуляторы стоимости услуг\n/calculateprice/ — расчет стоимости и сроков перевозки\n/checkdeliverydate/ — возвращает ближайшие даты и интервалы времени на забор / доставку груза от даты запроса\n/typesOfDelivery/ — продукты и тарифы перевозки\n/all/ — перечень актуальных продуктов/тарифов перевозки, которые поддерживаются в API\n/cargocontent/ — справочник наименований груза\n/all/ — список наименований груза\n/currency/ — валюты\n/all/ — получение списка валют для расчёта перевозок\n/clientpackingkind/ — справочник упаковок клиента\n/all/ — список упаковок клиента\nТехническая поддержка\nПоддержка оказывается с помощью обращений пользователей личного кабинета клиента «ПЭК» (требуется авторизация).\n\nИспользуемый протокол\nОбщее описание\nЗапрос должен осуществляться по протоколу HTTPS с обязательной проверкой сертификата сервера клиентом. Для проверки можно использовать файл сертификатов из комплекта PHP SDK.\nФормат передачи входящих и исходящих данных — JSON, кодировка — UTF-8\nВходящие параметры должны передаваться прямо в теле POST запроса в виде строки в формате JSON\nПри осуществлении запросов необходимо устанавливать следующие HTTP-заголовки:\nContent-Type: application/json;charset=utf-8\nAccept: application/json\nПоддерживается gzip-сжатие ответов API (к сожалению, стандарт для сжатия содержимого HTTP-запросов не утверждён). Использование компрессии уменьшает объем ответов в несколько раз. Для включения сжатия необходимо устанавливать следующий HTTP-заголовок:\nAccept-Encoding: gzip\nВсе поля JSON-объекта в запросе являются обязательными, если не указано обратное\nТипы данных JSON-объектов\nИспользуются стандартные типы данных JSON и следующие типы:\n\nДля передачи двоичных данных используется кодирование в Base64 и помещение результата в строку. Этот тип данных обозначается в документации следующим образом:\n[Binary]\nДля указания филиала или города, относящегося к филиалу используется тип, обозначенный в документации следующим образом:\n[City]\nДля филиала указывается его наименование в виде строки:\n{\n  demoCity: \"Курск\"\n}\nДля городов, относящихся к филиалам, значение указывается в формате: <Наименование города>, <Наименование филиала>, например:\n{\n  demoCity: \"Пристань, Курск\"\n}\nРегистр указания наименований городов может быть любым. Список филиалов и городов доступен в результате вызова метода /branches/all/.\n\nЗначения даты и даты + времени передаются как строки в формате ISO 8601 в следующих определённых стандартом форматах:\n\nДата:\n{\n  demoDateField: \"2011-03-10\"\n}\nПоля этого типа в описании методов помечаются следующим образом:\n[Date]\nДата и время:\n{\n  demoDateField: \"2011-03-10T09:24:24\"\n}\nИспользуется московское время (MSK), если не указано обратное.\n\nПоля этого типа в описании методов помечаются следующим образом:\n[DateTime]\nЗначения времени в пределах суток передаются как строки в формате ISO 8601 в следующих определённых стандартом форматах:\n\nВремя:\n{\n  demoTimeField: \"18:15\"\n}\nВремя с секундами:\n{\n  demoTimeFieldWithSeconds: \"18:15:12\"\n}\nИспользуется московское время (MSK), если не указано обратное.\n\nПоля этого типа в описании методов помечаются следующим образом:\n[Time]\nОбработка ошибок\nВ случае, если указан неверный URL метода, возвращается страница ошибки с кодом состояния 404. Содержимое страницы можно игнорировать, проверяя наличие ошибки только по коду\nВ случае возникновения ошибки нарушения прав доступа к методу, возвращается страница с кодом состояния 403. Содержимое страницы также можно игнорировать.\nЕсли возникает логическая ошибка (не указаны необходимые параметры, неверный формат входных данных и т.п.) возвращается ответ с кодом 200 и описанием ошибки в формате JSON:\n{\n   \"error\": {           \n       \"title\": \"Соообщение об ошибке\",    \n       \"message\": \"Детальное описание ошибки\"\n    }\n}\nВ зависимости от типа ошибки могут быть добавлены дополнительные поля, но поля, указанные в примере выше возвращаются всегда.\nПри возникновении непредусмотренной ошибки, код состояния устанавливается равным 500, а в теле ответа выводится сообщение об ошибке в формате описанном выше.\nПримеры использования API\nНеобходимые компоненты\nИспользование API возможно для большинства платформ и языков программирования и не требуется наличие каких-либо специфических библиотек на клиентской стороне. Необходимые программные компоненты:\n\nКомпонент (библиотека) для приёма и отправки HTTP-запросов с поддержкой протокола HTTPS и Basic-аутентификации (необходимо)\nКомпонент (библиотека) для сериализации\\десериализации данных из\\в формат JSON (опционально)\nКомпонент (библиотека) для кодирования\\декодирования Base64 (опционально, необходимо только для работы с бинарными данными)\nИспользование утилит командной строки\nВ простейшем случае нет необходимости в программировании, достаточно использовать утилиты командной строки. В данном примере используется Windows-версия cURL с поддержкой SSL (HTTPS):\ncurl.exe ^\n--verbose ^\n--cacert cacert-kabinet_pecom_ru.pem ^\n--basic ^\n--user user:FA21831AB83DB72D3261FA80BA309DBF6B2D7ADC ^\n--request POST -d @curl-input.txt ^\n--header \"Content-Type: application/json; charset=utf-8\" ^\n--compressed ^\n--output curl-output.txt ^\nhttps://kabinet.pecom.ru/api/v1/cargos/status/\nСимвол ^ используется для объединения строк. Файл cacert-kabinet_pecom_ru.pem содержит сертификаты и доступен в комплекте PHP SDK.\n\nСодержимое запроса берётся из файла curl-input.txt (кодировка UTF-8), описание формата параметров доступно на соответствующей странице:\n\n{\n   \"cargoCodes\": [ \n       \"780339690775\",\n       \"999932277461\",\n       \"772193116238\" \n   ]\n}\nРезультат будет записан в файл curl-output.txt.\nОбработка для 1С:Предприятия 8.1-8.3 (обычные формы)\nВ архиве, доступном для скачивания представлена внешняя обработка, позволяющая:\n\nполучить статус одного или нескольких грузов\nоформить заявку на забор груза\nоформить заявку на предварительное оформление\nВ форме обработки необходимо указать логин личного кабинета, ключ и параметры для запроса.\n\nСкачать версию для платформы 8.1-8.3 (обычные формы) (.zip, 170Кб)\n\nСкачать инструкцию по работе с внешней обработкой\n\nТакже вы можете воспользоваться готовым модулем для 1С\n\nПолезная информация на случай возникновения ошибки сертификата\n\nМинимальный пример для .NET\nВ результате выполнения кода, приведённого ниже, будет осуществлён запрос статусов грузов и выведен результат в виде строки. Пример представляет собой консольное приложение на C#, целевая версия платформы — .NET Framework 3.5 и выше.\n\nusing System;\nusing System.IO;\nusing System.Net;\nusing System.Text;\nusing System.Web.Script.Serialization;\n\nnamespace PecomApiDemo\n{\n  class Program\n  {\n    static void Main(string[] args)\n    {\n      var login = \"user\";\n      var key = \"11111111111111111122222222222222\";\n\n      /*\n       * Создание объекта запроса\n       */\n      var httpRequest = (HttpWebRequest)WebRequest.Create(\"https://kabinet.pecom.ru/api/v1/cargos/status/\");\n\n      /*\n       * Настройка параметров запроса\n       */\n      // Кодировка и тип содержимого\n      httpRequest.ContentType = \"application/json; charset=utf-8\";\n\n      // Тип запроса\n      httpRequest.Method = WebRequestMethods.Http.Post;\n\n      // Включение поддержки сжатия\n      httpRequest.AutomaticDecompression = DecompressionMethods.GZip | DecompressionMethods.Deflate;\n\n      /* \n       * У реализации BASIC-авторизации в .NET есть особенности:\n       * http://blog.cracca.com/2008/02/welcome.html\n       * http://devproj20.blogspot.com/2008/02/assigning-basic-authorization-http.html               \n       * Из-за этого необходимо указать заголовок вручную\n       */\n      byte[] credentialBuffer = new UTF8Encoding().GetBytes(login + \":\" + key);\n      httpRequest.Headers[\"Authorization\"] = \"Basic \" + Convert.ToBase64String(credentialBuffer);\n\n      try\n      {\n        /*\n         * Подготовка содержимого запроса\n         */\n        using (var sw = new StreamWriter(httpRequest.GetRequestStream()))\n        {\n          /*           \n           * Для сериализации/десериализации из/в JSON удобно использовать Json.NET\n           * http://james.newtonking.com/projects/json-net.aspx (или в виде NuGet-пакета)\n           * Эта библиотека поддерживает преобразование дат в ISO 8601\n           * Стандартные классы JavaScriptSerializer и DataContractSerializer \n           * эту возможность не поддерживают\n           */\n          var serializer = new JavaScriptSerializer();\n          var jsonData = new\n          {\n            cargoCodes = new string[] {\n              \"780339690775\",\n              \"999932277461\",\n              \"772193116238\"\n            }\n          };\n          string json = serializer.Serialize(jsonData);\n          sw.Write(json);\n        }\n\n        /*\n         * Выполнение запроса\n         */\n        var httpResponse = (HttpWebResponse)httpRequest.GetResponse();\n\n        /*\n         * Получение результата запроса\n         */\n        using (var sr = new StreamReader(httpResponse.GetResponseStream()))\n        {\n          var responseText = sr.ReadToEnd();\n          Console.WriteLine(responseText);\n        }\n      }\n      catch (WebException ex)\n      {\n        using (StreamReader sr = new StreamReader(ex.Response.GetResponseStream()))\n        {\n          var responseText = sr.ReadToEnd();\n          Console.WriteLine(responseText);\n        }\n      }\n    }\n  }\n}\nМинимальный пример на PHP\nВ результате выполнения кода, приведённого ниже, будет осуществлён запрос статусов грузов и выведен результат в виде десериализированного PHP-объекта. Важно отметить, что в примере осуществляется проверка сертификата сервера с помощью файла сертификатов из комплекта PHP SDK\n\nВнимание:\n\nПример кода приведён для иллюстрации, в случае использования PHP для доступа к API, рекомендуется использовать PHP SDK\n\n/*\n\nМинимальный пример работы с API Личного кабинета клиента «ПЭК» для PHP\n\t\nТребования:\n  - PHP 5.2 и выше\n  - Необходимые PHP-расширения:\n     - curl (http://php.net/manual/ru/book.curl.php)\n     - json (http://php.net/manual/ru/book.json.php)\n\n*/\n\n// Инициализация HTTP-клиента\n$ch = curl_init();\n\n// Настройки HTTP-клиента\ncurl_setopt_array($ch, array(\n\tCURLOPT_RETURNTRANSFER => TRUE,\n\tCURLOPT_POST => TRUE,\n\tCURLOPT_SSL_VERIFYPEER => TRUE,\n\tCURLOPT_SSL_VERIFYHOST => 2,\n\tCURLOPT_CAINFO => dirname(__FILE__) . '/cacert-kabinet_pecom_ru.pem',\n\tCURLOPT_HTTPAUTH => CURLAUTH_BASIC,\n\tCURLOPT_ENCODING => 'gzip',\n\tCURLOPT_USERPWD => 'user:FA218354B83DB72D3261FA80BA309D5454ADC',\n\tCURLOPT_HTTPHEADER => array(\n\t\t'Content-Type: application/json; charset=utf-8'\t\n\t)\n));\n\n// Данные для запроса\n$request_data = array(\n\t'cargoCodes' => array(\n\t\t'780339690775',\n\t\t'999932277461',\n\t\t'772193116238'\n\t));\n\n// Параметры конкретного запроса к API\t\ncurl_setopt_array($ch, array( \n\tCURLOPT_URL => 'https://kabinet.pecom.ru/api/v1/cargos/status/',\n\tCURLOPT_POSTFIELDS => json_encode($request_data),\n));\n\n// Выполнение запроса\n$result = curl_exec($ch);\n\n// Проверка на наличие ошибки\nif (curl_errno($ch))\n{\n\t// Вывод сообщения об ошибке\n\techo 'Ошибка: ' . curl_error($ch);\n}\nelse\n{\n\t// Вывод результата в виде строки\n\tvar_dump($result);\n\n\t// Вывод результатов в виде объекта\n\t$result_json = json_decode($result);\n\tvar_dump($result_json);\t\t\n}\n\n// Освобождение ресурсов\ncurl_close($ch); \nPHP SDK\nPHP SDK представляет собой класс, созданный чтобы упростить осуществление запросов к API из PHP-приложений и сайтов.\n\nСостав архива:\n\ncacert-kabinet_pecom_ru.pem — файл сертификатов\nexample.php — пример использования\npecom_kabinet.php — файл класса, реализующего SDK\nREADME — описание, история изменений\nСкачать версию 1.2 от 10.07.2012 (.zip, 135Кб)\n\nСкачать файл PEM (цепочка сертификатов) (.zip, 6Кб)\n\nПример использования\n// Подключение файла с классом\nrequire_once('pecom_kabinet.php');\n\n// Создание экземпляра класса\n$sdk = new PecomKabinet('user', 'FA218354B83DB72D3261FA80BA309D5454ADC');\n\n// Вызов метода\n$result = $sdk->call('cargos', 'status', \n\tarray('cargoCodes' => array(\n\t\t'780339690775',\n\t\t'999932277461',\n\t\t'772193116238'\n\t)\n));\n\t\n// Вывод результата\nvar_dump($result);\n\t\n// Освобождение ресурсов\n$sdk->close();\nПодключение через proxy-сервер\n// Подключение файла с классом\nrequire_once('pecom_kabinet.php');\n\n// Создание экземпляра класса\n$sdk = new PecomKabinet('user', 'FA218354B83DB72D3261FA80BA309D5454ADC', array(\n\t\t// Параметры proxy-серерва\n\t\tCURLOPT_PROXY => '127.0.0.1',\n\t\tCURLOPT_PROXYPORT => 8888,\n\t\tCURLOPT_PROXYTYPE => 'HTTP'\n));\n\n// Вызов метода\n$result = $sdk->call('cargos', 'status', \n\tarray('cargoCodes' => array(\n\t\t'780339690775',\n\t\t'999932277461',\n\t\t'772193116238'\n\t)\n));\n\t\n// Вывод результата\nvar_dump($result);\n\t\n// Освобождение ресурсов\n$sdk->close();",
  "messageID": "msg_986eea025001viGVUET4Arn5la",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14"
}