{
  "id": "prt_9e320fbd5001vKWJ59Ulg4URKn",
  "messageID": "msg_9e320efd2001c7QZ44Cd5GAney",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "read",
  "callID": "call_10210015",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "app/page.tsx",
      "offset": 2000,
      "limit": 1000
    },
    "output": "<file>\n02001|           \n02002|           console.log('–ù–ê–ô–î–ï–ù–ù–´–ï –î–ê–¢–´:');\n02003|           console.log('pickup:', pickup);\n02004|           console.log('arrivalToOspReceiver:', arrivalToOspReceiver);\n02005|           \n02006|           if (pickup && arrivalToOspReceiver) {\n02007|             // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—ã (—Ñ–æ—Ä–º–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å \"2025-09-27\" –∏–ª–∏ \"2025-09-27 10:00:00\")\n02008|             const pickupDate = new Date(pickup);\n02009|             const arrivalDate = new Date(arrivalToOspReceiver);\n02010|             \n02011|             console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ pickup:', pickupDate);\n02012|             console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ arrival:', arrivalDate);\n02013|             \n02014|             // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã\n02015|             if (!isNaN(pickupDate.getTime()) && !isNaN(arrivalDate.getTime())) {\n02016|               // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–æ—Å—Ç—å –≤ –¥–Ω—è—Ö\n02017|               const timeDiff = arrivalDate.getTime() - pickupDate.getTime();\n02018|               deliveryDays = Math.max(1, Math.ceil(timeDiff / (1000 * 3600 * 24))); // –ú–∏–Ω–∏–º—É–º 1 –¥–µ–Ω—å\n02019|               \n02020|               console.log('–†–∞–∑–Ω–æ—Å—Ç—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö:', timeDiff);\n02021|               console.log('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –í–´–ß–ò–°–õ–ï–ù —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:', deliveryDays, '–¥–Ω–µ–π');\n02022|             } else {\n02023|               console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞—Ç—ã –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞');\n02024|               console.error('pickup Date object:', pickupDate);\n02025|               console.error('arrival Date object:', arrivalDate);\n02026|             }\n02027|           } else {\n02028|             console.warn('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ –Ω–∞–π–¥–µ–Ω—ã –¥–∞—Ç—ã pickup –∏–ª–∏ arrivalToOspReceiver');\n02029|             console.log('pickup –Ω–∞–π–¥–µ–Ω:', !!pickup, pickup);\n02030|             console.log('arrivalToOspReceiver –Ω–∞–π–¥–µ–Ω:', !!arrivalToOspReceiver, arrivalToOspReceiver);\n02031|           }\n02032|         } catch (error) {\n02033|           console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –û—à–∏–±–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:', error);\n02034|         }\n02035| \n02036|         console.log('üí∞ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ò–¢–û–ì–û–í–ê–Ø –°–¢–û–ò–ú–û–°–¢–¨:', Math.round(totalPrice));\n02037|         \n02038|         return {\n02039|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n02040|           price: Math.round(totalPrice),\n02041|           days: deliveryDays || 0,\n02042|           details: data.data || {},\n02043|           requestData,\n02044|           responseData: data,\n02045|           apiUrl,\n02046|           sessionId: sessionID\n02047|         };\n02048|       } else {\n02049|         const errorMessage = data.metadata?.detail || \n02050|                            data.metadata?.message || \n02051|                            data.errors?.[0]?.detail || \n02052|                            (data.metadata?.status !== 200 ? `HTTP ${data.metadata?.status}` : '') ||\n02053|                            '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏';\n02054|         return {\n02055|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n02056|           price: 0,\n02057|           days: 0,\n02058|           error: errorMessage,\n02059|           requestData,\n02060|           responseData: data,\n02061|           apiUrl,\n02062|           sessionId: sessionID\n02063|         };\n02064|       }\n02065|     } catch (error: any) {\n02066|       return {\n02067|         company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n02068|         price: 0,\n02069|         days: 0,\n02070|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n02071|         requestData: null,\n02072|         responseData: null,\n02073|         apiUrl\n02074|       };\n02075|     }\n02076|   };\n02077| \n02078| \n02079| \n02080|   // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–Ω–æ–π –∑–æ–Ω—ã –∏ —Å–∫–ª–∞–¥–∞ –ü–≠–ö –ø–æ –∞–¥—Ä–µ—Å—É —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏\n02081|   const getPekZoneByAddress = async (address: string) => {\n02082|     try {\n02083|       console.log(`üîç –ü–≠–ö: –ø–æ–∏—Å–∫ –∑–æ–Ω—ã –¥–ª—è –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n02084|       \n02085|       const response = await fetch('/api/pek', {\n02086|         method: 'POST',\n02087|         headers: {\n02088|           'Content-Type': 'application/json',\n02089|         },\n02090|         body: JSON.stringify({\n02091|           method: 'findzonebyaddress',\n02092|           address: address\n02093|         })\n02094|       });\n02095| \n02096|       console.log(`üì° –ü–≠–ö API —Å—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`);\n02097|       \n02098|       if (!response.ok) {\n02099|         let errorData;\n02100|         try {\n02101|           errorData = await response.json();\n02102|         } catch {\n02103|           errorData = { error: '–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç' };\n02104|         }\n02105|         \n02106|         console.error(`‚ùå –ü–≠–ö API –æ—à–∏–±–∫–∞ ${response.status}:`, errorData);\n02107|         \n02108|         // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫\n02109|         if (response.status === 401) {\n02110|           console.error('‚ùå –ü–≠–ö: –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω');\n02111|         } else if (response.status === 404) {\n02112|           console.error('‚ùå –ü–≠–ö: –ú–µ—Ç–æ–¥ API –Ω–µ –Ω–∞–π–¥–µ–Ω');\n02113|         } else if (response.status === 400) {\n02114|           console.error('‚ùå –ü–≠–ö: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞');\n02115|         } else if (response.status >= 500) {\n02116|           console.error('‚ùå –ü–≠–ö: –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ü–≠–ö');\n02117|         }\n02118|         \n02119|         console.log(`üîÑ –ü–≠–ö: –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥—É –¥–ª—è \"${address}\"`);\n02120|         return getPekZoneFallback(address);\n02121|       }\n02122| \n02123|       const data = await response.json();\n02124|       console.log(`‚úÖ –ü–≠–ö –∑–æ–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞:`, data);\n02125|       \n02126|       if (data.zoneId && data.mainWarehouseId) {\n02127|         return {\n02128|           zoneId: data.zoneId,\n02129|           zoneName: data.zoneName,\n02130|           branchUID: data.branchUID,\n02131|           branchCode: data.branchCode,\n02132|           branchTitle: data.branchTitle,\n02133|           mainWarehouseId: data.mainWarehouseId,\n02134|           warehousePoint: data.warehousePoint,\n02135|           geoData: data.GeoData,\n02136|           precision: data.GeoData?.precision\n02137|         };\n02138|       }\n02139|       \n02140|       console.warn(`‚ö†Ô∏è –ü–≠–ö: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç:`, data);\n02141|       return getPekZoneFallback(address);\n02142|       \n02143|     } catch (error) {\n02144|       console.error('‚ùå –ü–≠–ö: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∑–æ–Ω—ã:', error);\n02145|       return getPekZoneFallback(address);\n02146|     }\n02147|   };\n02148| \n02149|   // –§–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–æ–Ω—ã –ü–≠–ö\n02150|   const getPekZoneFallback = (address: string) => {\n02151|     console.log(`üîÑ –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –∞–Ω–∞–ª–∏–∑ –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n02152|     \n02153|     const addressLower = address.toLowerCase();\n02154|     \n02155|     // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –∏ –∏—Ö –¥–∞–Ω–Ω—ã–µ\n02156|     const cityMappings: { [key: string]: any } = {\n02157|       '–º–æ—Å–∫–≤–∞': {\n02158|         zoneId: 'moscow-zone-001',\n02159|         zoneName: '–ú–æ—Å–∫–≤–∞',\n02160|         branchUID: 'moscow-branch-001',\n02161|         branchCode: '–ú–°–ö',\n02162|         branchTitle: '–ú–æ—Å–∫–≤–∞',\n02163|         mainWarehouseId: 'dc6c746d-812d-11e4-bbfc-001999d8b3c5',\n02164|         warehousePoint: {\n02165|           latitude: 55.755826,\n02166|           longitude: 37.6173\n02167|         }\n02168|       },\n02169|       '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': {\n02170|         zoneId: 'spb-zone-001',\n02171|         zoneName: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n02172|         branchUID: 'spb-branch-001',\n02173|         branchCode: '–°–ü–ë',\n02174|         branchTitle: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n02175|         mainWarehouseId: 'b436c978-086d-11e6-b6ca-00155d668909',\n02176|         warehousePoint: {\n02177|           latitude: 59.9311,\n02178|           longitude: 30.3609\n02179|         }\n02180|       },\n02181|       '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': {\n02182|         zoneId: 'ekb-zone-001',\n02183|         zoneName: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',\n02184|         branchUID: 'ekb-branch-001',\n02185|         branchCode: '–ï–ö–ë',\n02186|         branchTitle: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',\n02187|         mainWarehouseId: 'f8d9c8e3-8e2d-11e4-bbfc-001999d8b3c5',\n02188|         warehousePoint: {\n02189|           latitude: 56.8431,\n02190|           longitude: 60.6454\n02191|         }\n02192|       }\n02193|     };\n02194|     \n02195|     for (const [city, data] of Object.entries(cityMappings)) {\n02196|       if (addressLower.includes(city) || addressLower.includes(city.replace('-', ' '))) {\n02197|         console.log(`‚úÖ –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –Ω–∞–π–¥–µ–Ω –≥–æ—Ä–æ–¥ ${city}`);\n02198|         return {\n02199|           ...data,\n02200|           geoData: {\n02201|             precision: 'fallback',\n02202|             kind: 'locality'\n02203|           },\n02204|           precision: 'fallback'\n02205|         };\n02206|       }\n02207|     }\n02208|     \n02209|     console.warn(`‚ùå –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –≥–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ \"${address}\"`);\n02210|     return null;\n02211|   };\n02212| \n02213|   // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –ü–≠–ö\n02214|   const getPekNearestDepartments = async (address: string, coordinates?: { latitude: string, longitude: string }) => {\n02215|     try {\n02216|       console.log(`üè¢ –ü–≠–ö: –ø–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –¥–ª—è \"${address}\"`);\n02217|       \n02218|       const requestBody: any = {\n02219|         departmentOperation: 3, // –≤—ã–¥–∞—á–∞ –≥—Ä—É–∑–æ–≤\n02220|         type: 3, // –∞–≤—Ç–æ-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç\n02221|         searchRadius: 50, // –∫–º\n02222|         limit: 5\n02223|       };\n02224|       \n02225|       // –ü–≠–ö API —Ç—Ä–µ–±—É–µ—Ç –∏ –∞–¥—Ä–µ—Å, –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ\n02226|       requestBody.address = address;\n02227|       \n02228|       if (coordinates) {\n02229|         requestBody.coordinates = coordinates;\n02230|         console.log(`üìç –ü–≠–ö: –ø–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\" –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º`, coordinates);\n02231|       } else {\n02232|         console.log(`üìç –ü–≠–ö: –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\"`);\n02233|       }\n02234|       \n02235|       const response = await fetch('/api/pek', {\n02236|         method: 'POST',\n02237|         headers: {\n02238|           'Content-Type': 'application/json',\n02239|         },\n02240|         body: JSON.stringify({\n02241|           method: 'nearestdepartments',\n02242|           ...requestBody\n02243|         })\n02244|       });\n02245| \n02246|       console.log(`üì° –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API —Å—Ç–∞—Ç—É—Å: ${response.status}`);\n02247|       \n02248|       if (!response.ok) {\n02249|         const errorText = await response.text();\n02250|         console.error(`‚ùå –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API –æ—à–∏–±–∫–∞: ${response.status} ${response.statusText}`);\n02251|         console.error(`‚ùå –û—Ç–≤–µ—Ç:`, errorText.substring(0, 500));\n02252|         return null;\n02253|       }\n02254| \n02255|       const data = await response.json();\n02256|       console.log(`‚úÖ –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–∞–π–¥–µ–Ω—ã:`, data);\n02257|       \n02258|       // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤–æ–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ —Å –Ω–∞–∏–≤—ã—Å—à–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º\n02259|       if (data.freeDepartments && data.freeDepartments.length > 0) {\n02260|         const bestDepartment = data.freeDepartments.sort((a: any, b: any) => b.priority - a.priority)[0];\n02261|         console.log(`‚úÖ –ü–≠–ö: –≤—ã–±—Ä–∞–Ω–æ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ`, bestDepartment.divisionName);\n02262|         return {\n02263|           warehouseId: bestDepartment.warehouseId,\n02264|           branchId: bestDepartment.branchId,\n02265|           branchName: bestDepartment.branchName,\n02266|           divisionName: bestDepartment.divisionName,\n02267|           address: bestDepartment.address,\n02268|           coordinates: bestDepartment.coordinates,\n02269|           phone: bestDepartment.phone,\n02270|           email: bestDepartment.email\n02271|         };\n02272|       }\n02273|       \n02274|       console.warn(`‚ùå –ü–≠–ö: –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è \"${address}\"`);\n02275|       return null;\n02276|     } catch (error) {\n02277|       console.error('‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –æ—Ç–¥–µ–ª–µ–Ω–∏–π:', error);\n02278|       return null;\n02279|     }\n02280|   };\n02281| \n02282|   // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ü–≠–ö)\n02283|   const getYandexCoordinates = async (address: string): Promise<{ latitude: string, longitude: string } | null> => {\n02284|     try {\n02285|       const encodedAddress = encodeURIComponent(address);\n02286|       const response = await fetch(`https://geocode-maps.yandex.ru/1.x/?apikey=YOUR_API_KEY&geocode=${encodedAddress}&format=json`);\n02287|       \n02288|       if (!response.ok) return null;\n02289|       \n02290|       const data = await response.json();\n02291|       const coords = data?.response?.GeoObjectCollection?.featureMember?.[0]?.GeoObject?.Point?.pos?.split(' ');\n02292|       \n02293|       if (coords && coords.length === 2) {\n02294|         return {\n02295|           longitude: coords[0],\n02296|           latitude: coords[1]\n02297|         };\n02298|       }\n02299|       \n02300|       return null;\n02301|     } catch (error) {\n02302|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ø–Ω–¥–µ–∫—Å:', error);\n02303|       return null;\n02304|     }\n02305|   };\n02306| \n02307|   // –†–∞—Å—á–µ—Ç –¥–ª—è –ü–≠–ö —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API v1/calculateprice/\n02308|   const calculatePEK = async (): Promise<CalculationResult> => {\n02309|     const apiUrl = 'https://kabinet.pecom.ru/api/v1/calculateprice/';\n02310|     \n02311|     // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç\n02312|     const validateCoordinates = (coords: any) => {\n02313|       console.log('üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:', coords);\n02314|       \n02315|       if (!coords) {\n02316|         console.log('‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç');\n02317|         return null;\n02318|       }\n02319|       \n02320|       if (typeof coords.latitude !== 'number' || typeof coords.longitude !== 'number') {\n02321|         console.warn(`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ —è–≤–ª—è—é—Ç—Å—è —á–∏—Å–ª–∞–º–∏:`, { \n02322|           lat: coords.latitude, \n02323|           lng: coords.longitude,\n02324|           latType: typeof coords.latitude,\n02325|           lngType: typeof coords.longitude\n02326|         });\n02327|         return null;\n02328|       }\n02329|       \n02330|       const lat = Number(coords.latitude);\n02331|       const lng = Number(coords.longitude);\n02332|       \n02333|       console.log(`üìç –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: lat=${lat}, lng=${lng}`);\n02334|       \n02335|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω—ã\n02336|       if (lat < -90 || lat > 90 || lng < -180 || lng > 180 || isNaN(lat) || isNaN(lng)) {\n02337|         console.warn(`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–Ω–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞:`, { \n02338|           lat, lng, \n02339|           latValid: lat >= -90 && lat <= 90,\n02340|           lngValid: lng >= -180 && lng <= 180,\n02341|           latIsNaN: isNaN(lat),\n02342|           lngIsNaN: isNaN(lng)\n02343|         });\n02344|         return null;\n02345|       }\n02346|       \n02347|       console.log('‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã:', { latitude: lat, longitude: lng });\n02348|       return { latitude: lat, longitude: lng };\n02349|     };\n02350|     \n02351|     try {\n02352|       // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–æ–Ω–∞—Ö –∏ —Å–∫–ª–∞–¥–∞—Ö –ø–æ –∞–¥—Ä–µ—Å–∞–º\n02353|       console.log(`üöÄ –ü–≠–ö: –Ω–∞—á–∏–Ω–∞–µ–º —Ä–∞—Å—á–µ—Ç`);\n02354|       console.log(`üìç –û—Ç: ${form.fromAddress || form.fromCity}`);\n02355|       console.log(`üìç –î–æ: ${form.toAddress || form.toCity}`);\n02356|       \n02357|       const senderZone = await getPekZoneByAddress(form.fromAddress || `–≥ ${form.fromCity}`);\n02358|       const receiverZone = await getPekZoneByAddress(form.toAddress || `–≥ ${form.toCity}`);\n02359|       \n02360|       console.log(`üîç –ü–≠–ö –∑–æ–Ω—ã:`);\n02361|       console.log(`üìç –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å:`, senderZone ? `${senderZone.branchTitle} (${senderZone.mainWarehouseId})` : '–ù–ï –ù–ê–ô–î–ï–ù–ê');\n02362|       console.log(`üìç –ü–æ–ª—É—á–∞—Ç–µ–ª—å:`, receiverZone ? `${receiverZone.branchTitle} (${receiverZone.mainWarehouseId})` : '–ù–ï –ù–ê–ô–î–ï–ù–ê');\n02363|       \n02364|       if (!senderZone || !receiverZone) {\n02365|         // –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞\n02366|         const debugInfo = {\n02367|           senderAddress: form.fromAddress || form.fromCity,\n02368|           receiverAddress: form.toAddress || form.toCity,\n02369|           senderZoneFound: !!senderZone,\n02370|           receiverZoneFound: !!receiverZone,\n02371|           apiTested: true\n02372|         };\n02373|         \n02374|         console.error(`‚ùå –ü–≠–ö: –∑–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã`, debugInfo);\n02375|         \n02376|         return {\n02377|           company: '–ü–≠–ö',\n02378|           price: 0,\n02379|           days: 0,\n02380|           error: `–ó–æ–Ω–∞ –ü–≠–ö –Ω–µ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥—Ä–µ—Å–∞: ${!senderZone ? (form.fromAddress || form.fromCity) : ''} ${!receiverZone ? (form.toAddress || form.toCity) : ''}`.trim(),\n02381|           apiUrl,\n02382|           requestData: debugInfo,\n02383|           responseData: { senderZone, receiverZone }\n02384|         };\n02385|       }\n02386| \n02387|       // –ü–æ–ª—É—á–∞–µ–º –±–ª–∏–∂–∞–π—à–∏–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –∞–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞\n02388|       let senderWarehouseId = senderZone.mainWarehouseId;\n02389|       let receiverWarehouseId = receiverZone.mainWarehouseId;\n02390|       \n02391|       if (form.fromAddressDelivery && senderZone.warehousePoint) {\n02392|         const validSenderCoords = validateCoordinates(senderZone.warehousePoint);\n02393|         if (validSenderCoords) {\n02394|           try {\n02395|             const senderDepartment = await getPekNearestDepartments(\n02396|               form.fromAddress || form.fromCity,\n02397|               {\n02398|                 latitude: validSenderCoords.latitude.toString(),\n02399|                 longitude: validSenderCoords.longitude.toString()\n02400|               }\n02401|             );\n02402|             if (senderDepartment) {\n02403|               senderWarehouseId = senderDepartment.warehouseId;\n02404|               console.log('‚úÖ –ù–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π —Å–∫–ª–∞–¥ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è:', senderDepartment.warehouseId);\n02405|             }\n02406|           } catch (error) {\n02407|             console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥:', error);\n02408|           }\n02409|         } else {\n02410|           console.warn('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥');\n02411|         }\n02412|       }\n02413|       \n02414|       if (form.toAddressDelivery && receiverZone.warehousePoint) {\n02415|         const validReceiverCoords = validateCoordinates(receiverZone.warehousePoint);\n02416|         if (validReceiverCoords) {\n02417|           try {\n02418|             const receiverDepartment = await getPekNearestDepartments(\n02419|               form.toAddress || form.toCity,\n02420|               {\n02421|                 latitude: validReceiverCoords.latitude.toString(),\n02422|                 longitude: validReceiverCoords.longitude.toString()\n02423|               }\n02424|             );\n02425|             if (receiverDepartment) {\n02426|               receiverWarehouseId = receiverDepartment.warehouseId;\n02427|               console.log('‚úÖ –ù–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π —Å–∫–ª–∞–¥ –ø–æ–ª—É—á–∞—Ç–µ–ª—è:', receiverDepartment.warehouseId);\n02428|             }\n02429|           } catch (error) {\n02430|             console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥:', error);\n02431|           }\n02432|         } else {\n02433|           console.warn('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥');\n02434|         }\n02435|       }\n02436| \n02437|       // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞—Ç—ã N –¥–Ω–µ–π –æ—Ç —Å–µ–≥–æ–¥–Ω—è\n02438|       const getDateForCalculation = (daysFromToday: number): string => {\n02439|         const date = new Date();\n02440|         date.setDate(date.getDate() + daysFromToday);\n02441|         return date.toISOString().slice(0, 19); // 2025-09-28T14:00:00\n02442|       };\n02443| \n02444|       // –ù–∞—á–∏–Ω–∞–µ–º —Å –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–≥–æ –¥–Ω—è\n02445|       let currentDayOffset = 1;\n02446|       let plannedDateTime = getDateForCalculation(currentDayOffset);\n02447| \n02448|       // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤ (–±–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç)\n02449|       const cargos = form.cargos.map(cargo => {\n02450|         const cargoData = {\n02451|           length: cargo.length / 100, // –ø–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–µ—Ç—Ä—ã\n02452|           width: cargo.width / 100,\n02453|           height: cargo.height / 100,\n02454|           volume: (cargo.length * cargo.width * cargo.height) / 1000000, // –º3\n02455|           weight: cargo.weight,\n02456|           isHP: form.needPackaging, // –∑–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n02457|           sealingPositionsCount: 0\n02458|         };\n02459|         \n02460|         console.log('üì¶ –ì—Ä—É–∑ –¥–ª—è –ü–≠–ö:', cargoData);\n02461|         return cargoData;\n02462|       });\n02463| \n02464|       // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (–Ω—É–∂–Ω–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ)\n02465|       let finalRequestData: any = null;\n02466|       \n02467|       // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ —Ä–∞—Å—á–µ—Ç–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç–æ–π\n02468|       const tryCalculateWithDate = async (plannedDateTime: string): Promise<any> => {\n02469|         // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –∫ API –ü–≠–ö —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n02470|         const requestData: any = {\n02471|           currencyCode: \"643\", // —Ä—É–±–ª–∏\n02472|           types: [3], // —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ –ø–µ—Ä–µ–≤–æ–∑–∫–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –º–∞—Å—Å–∏–≤)\n02473|           senderWarehouseId,\n02474|           receiverWarehouseId,\n02475|           isOpenCarSender: false,\n02476|           isOpenCarReceiver: false,\n02477|           isHyperMarket: false,\n02478|           plannedDateTime,\n02479|           isInsurance: form.needInsurance && form.declaredValue > 0,\n02480|           isInsurancePrice: form.needInsurance ? form.declaredValue : 0,\n02481|           isPickUp: form.fromAddressDelivery,\n02482|           isDelivery: form.toAddressDelivery,\n02483|           needReturnDocuments: false,\n02484|           needArrangeTransportationDocuments: false,\n02485|           senderDistanceType: 0,\n02486|           receiverDistanceType: 0,\n02487|           cargos // –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤\n02488|         };\n02489|         \n02490|         console.log('üìã –ü–≠–ö: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ requestData:', JSON.stringify(requestData, null, 2));\n02491| \n02492|         // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏ –ü–†–† –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\n02493|         if (form.needCarry) {\n02494|           requestData.pickupServices = {\n02495|             isLoading: true,\n02496|             floor: Math.max(0, form.floor - 1), // –ü–≠–ö —Å—á–∏—Ç–∞–µ—Ç —Å 0\n02497|             carryingDistance: 0,\n02498|             isElevator: form.hasFreightLift\n02499|           };\n02500|           requestData.deliveryServices = {\n02501|             isLoading: true,\n02502|             floor: Math.max(0, form.floor - 1),\n02503|             carryingDistance: 0,\n02504|             isElevator: form.hasFreightLift\n02505|           };\n02506|         }\n02507| \n02508|         // –î–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫–∏ pickup/delivery —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ü–≠–ö\n02509|         if (form.fromAddressDelivery) {\n02510|           console.log('üìç –ü–≠–ö: –¥–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ pickup –¥–ª—è –∑–∞–±–æ—Ä–∞');\n02511|           requestData.pickup = {\n02512|             address: form.fromAddress || `–†–æ—Å—Å–∏—è, ${form.fromCity}`\n02513|             // coordinates –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏\n02514|           };\n02515|         }\n02516|         \n02517|         if (form.toAddressDelivery) {\n02518|           console.log('üìç –ü–≠–ö: –¥–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ delivery –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏');\n02519|           requestData.delivery = {\n02520|             address: form.toAddress || `–†–æ—Å—Å–∏—è, ${form.toCity}`\n02521|             // coordinates –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏\n02522|           };\n02523|         }\n02524| \n02525|         // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n02526|         const requiredFields = ['types', 'senderWarehouseId', 'receiverWarehouseId', 'plannedDateTime', 'cargos'];\n02527|         const missingFields = requiredFields.filter(field => !requestData[field]);\n02528|         \n02529|         if (missingFields.length > 0) {\n02530|           throw new Error(`–ü–≠–ö: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: ${missingFields.join(', ')}`);\n02531|         }\n02532|         \n02533|         if (!Array.isArray(requestData.types) || requestData.types.length === 0) {\n02534|           throw new Error('–ü–≠–ö: –ø–æ–ª–µ types –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º');\n02535|         }\n02536|         \n02537|         if (!Array.isArray(requestData.cargos) || requestData.cargos.length === 0) {\n02538|           throw new Error('–ü–≠–ö: –ø–æ–ª–µ cargos –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º');\n02539|         }\n02540|         \n02541|         console.log('‚úÖ –ü–≠–ö: –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –ø—Ä–æ–π–¥–µ–Ω–∞');\n02542| \n02543|         // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏\n02544|         finalRequestData = {\n02545|           method: 'calculateprice',\n02546|           ...requestData\n02547|         };\n02548|         \n02549|         console.log('üöÄ –ü–≠–ö API –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å:', JSON.stringify(finalRequestData, null, 2));\n02550|         console.log('üåê –ü–≠–ö API URL:', apiUrl);\n02551|         console.log('üìã –ü–≠–ö: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–ø–æ–≤ —Ç–∞—Ä–∏—Ñ–æ–≤:', requestData.types.length);\n02552|         console.log('üìã –ü–≠–ö: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤:', requestData.cargos.length);\n02553|       \n02554|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π\n02555|       if (finalRequestData.pickup?.coordinates) {\n02556|         console.log('üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã pickup:', finalRequestData.pickup.coordinates);\n02557|       }\n02558|       if (finalRequestData.delivery?.coordinates) {\n02559|         console.log('üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã delivery:', finalRequestData.delivery.coordinates);\n02560|       }\n02561| \n02562|       const response = await fetch('/api/pek', {\n02563|         method: 'POST',\n02564|         headers: {\n02565|           'Content-Type': 'application/json',\n02566|         },\n02567|         body: JSON.stringify(finalRequestData)\n02568|       });\n02569| \n02570|       console.log(`üì° –ü–≠–ö API —Ä–∞—Å—á–µ—Ç —Å—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`);\n02571|       console.log(`üì° –ü–≠–ö API URL: ${response.url}`);\n02572|       \n02573|       const responseText = await response.text();\n02574|       console.log(`üì° –ü–≠–ö API —Å—ã—Ä–æ–π –æ—Ç–≤–µ—Ç:`, responseText.substring(0, 1000));\n02575|       \n02576|       let data;\n02577|       try {\n02578|         data = JSON.parse(responseText);\n02579|         console.log('üöÄ –ü–≠–ö API –æ—Ç–≤–µ—Ç:', JSON.stringify(data, null, 2));\n02580|       } catch (parseError) {\n02581|         console.error('‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', parseError);\n02582|         throw new Error(`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç API: ${responseText.substring(0, 200)}`);\n02583|       }\n02584| \n02585|         return { response, data };\n02586|       };\n02587| \n02588|       // –î–æ–±–∞–≤–ª—è–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞—Å—á–µ—Ç–∞\n02589|       console.log('üîß –ü–≠–ö: –≥–æ—Ç–æ–≤–∏–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞...');\n02590|       console.log('üìç senderWarehouseId:', senderWarehouseId);\n02591|       console.log('üìç receiverWarehouseId:', receiverWarehouseId);\n02592|       console.log('üìÖ –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞:', plannedDateTime);\n02593|       console.log('üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤:', cargos.length);\n02594|       console.log('üîß form.fromAddressDelivery:', form.fromAddressDelivery);\n02595|       console.log('üîß form.toAddressDelivery:', form.toAddressDelivery);\n02596|       \n02597|       // –¶–∏–∫–ª –ø–æ–ø—ã—Ç–æ–∫ —Å —Ä–∞–∑–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏ (–º–∞–∫—Å–∏–º—É–º 7 –¥–Ω–µ–π)\n02598|       const maxRetries = 7;\n02599|       let lastError: Error | null = null;\n02600|       \n02601|       console.log('üöÄ –ü–≠–ö: –∑–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª —Ä–∞—Å—á–µ—Ç–∞...');\n02602|       \n02603|       for (let attempt = 0; attempt < maxRetries; attempt++) {\n02604|         try {\n02605|           console.log(`üìÖ –ü–≠–ö: –ø–æ–ø—ã—Ç–∫–∞ ${attempt + 1}/${maxRetries}, –¥–∞—Ç–∞: ${plannedDateTime}`);\n02606|           \n02607|           const { response, data } = await tryCalculateWithDate(plannedDateTime);\n02608|           \n02609|           if (response.ok && !data.hasError && data.transfers && data.transfers.length > 0) {\n02610|             const transfer = data.transfers[0]; // –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Ç–∞—Ä–∏—Ñ (–∞–≤—Ç–æ)\n02611|             \n02612|             if (!transfer.hasError) {\n02613|           // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —É—Å–ª—É–≥\n02614|           const services: { name: string; description: string; price: number }[] = [];\n02615|           let totalCalculated = 0;\n02616| \n02617|           const processServices = (servicesList: any[], parentName = '') => {\n02618|             servicesList.forEach(service => {\n02619|               const serviceName = parentName ? `${parentName} - ${service.info}` : service.info;\n02620|               const serviceCost = parseFloat(service.cost) || 0;\n02621|               \n02622|               if (serviceCost > 0) {\n02623|                 services.push({\n02624|                   name: serviceName,\n02625|                   description: service.serviceType || '',\n02626|                   price: serviceCost\n02627|                 });\n02628|                 totalCalculated += serviceCost;\n02629|               }\n02630| \n02631|               // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏\n02632|               if (service.services && Array.isArray(service.services)) {\n02633|                 processServices(service.services, serviceName);\n02634|               }\n02635|             });\n02636|           };\n02637| \n02638|           if (transfer.services) {\n02639|             processServices(transfer.services);\n02640|           }\n02641| \n02642|           // –ï—Å–ª–∏ –Ω–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —É—Å–ª—É–≥, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n02643|           if (services.length === 0) {\n02644|             services.push({\n02645|               name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n02646|               description: `${senderZone.branchTitle} - ${receiverZone.branchTitle}`,\n02647|               price: Math.round(transfer.costTotal)\n02648|             });\n02649|           }\n02650| \n02651|           return {\n02652|             company: '–ü–≠–ö',\n02653|             price: Math.round(transfer.costTotal),\n02654|             days: transfer.estDeliveryTime || 3,\n02655|             details: {\n02656|               note: `–î–æ—Å—Ç–∞–≤–∫–∞ ${senderZone.branchTitle} - ${receiverZone.branchTitle} (–∞–≤—Ç–æ)`,\n02657|               services,\n02658|               senderZone: {\n02659|                 title: senderZone.branchTitle,\n02660|                 zone: senderZone.zoneName,\n02661|                 warehouseId: senderWarehouseId\n02662|               },\n02663|               receiverZone: {\n02664|                 title: receiverZone.branchTitle,\n02665|                 zone: receiverZone.zoneName,\n02666|                 warehouseId: receiverWarehouseId\n02667|               }\n02668|             },\n02669|             requestData: finalRequestData,\n02670|             responseData: data,\n02671|             apiUrl\n02672|               };\n02673|             } else {\n02674|               // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ–±–ª–µ–º–æ–π —Å –¥–∞—Ç–æ–π\n02675|               const errorMessage = transfer.errorMessage || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞ –ü–≠–ö';\n02676|               if (errorMessage.includes('–∑–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω') || errorMessage.includes('–≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã')) {\n02677|                 console.log(`üìÖ –ü–≠–ö: ${errorMessage}. –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...`);\n02678|                 lastError = new Error(errorMessage);\n02679|                 // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é\n02680|                 currentDayOffset++;\n02681|                 plannedDateTime = getDateForCalculation(currentDayOffset);\n02682|                 continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –¥–∞—Ç—É\n02683|               } else {\n02684|                 throw new Error(errorMessage);\n02685|               }\n02686|             }\n02687|           } else {\n02688|             // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—à–∏–±–∫—É –Ω–∞ —É—Ä–æ–≤–Ω–µ –¥–∞–Ω–Ω—ã—Ö\n02689|             const errorMessage = data.errorMessage || data.message || '–û—à–∏–±–∫–∞ API –ü–≠–ö';\n02690|             if (errorMessage.includes('–∑–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω') || errorMessage.includes('–≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã')) {\n02691|               console.log(`üìÖ –ü–≠–ö: ${errorMessage}. –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...`);\n02692|               lastError = new Error(errorMessage);\n02693|               // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é\n02694|               currentDayOffset++;\n02695|               plannedDateTime = getDateForCalculation(currentDayOffset);\n02696|               continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –¥–∞—Ç—É\n02697|             } else {\n02698|               throw new Error(errorMessage);\n02699|             }\n02700|           }\n02701|         } catch (error: any) {\n02702|           console.error(`‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –Ω–∞ –ø–æ–ø—ã—Ç–∫–µ ${attempt + 1}:`, error.message);\n02703|           \n02704|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ–±–ª–µ–º–æ–π —Å –¥–∞—Ç–æ–π\n02705|           if (error.message?.includes('–∑–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω') || error.message?.includes('–≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã')) {\n02706|             console.log(`üìÖ –ü–≠–ö: –ø—Ä–æ–±–ª–µ–º–∞ —Å –¥–∞—Ç–æ–π. –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...`);\n02707|             lastError = error;\n02708|             // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é\n02709|             currentDayOffset++;\n02710|             plannedDateTime = getDateForCalculation(currentDayOffset);\n02711|             continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –¥–∞—Ç—É\n02712|           } else {\n02713|             // –î—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞ - –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ä–∞–∑—É\n02714|             throw error;\n02715|           }\n02716|         }\n02717|       }\n02718|       \n02719|       // –ï—Å–ª–∏ –¥–æ—à–ª–∏ –¥–æ —Å—é–¥–∞ - –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã\n02720|       console.error(`‚ùå –ü–≠–ö: –≤—Å–µ ${maxRetries} –ø–æ–ø—ã—Ç–æ–∫ –∏—Å—á–µ—Ä–ø–∞–Ω—ã. –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞:`, lastError?.message);\n02721|       throw lastError || new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—É—é –¥–∞—Ç—É –¥–ª—è –∑–∞–±–æ—Ä–∞ –≥—Ä—É–∑–∞');\n02722|       \n02723|     } catch (error: any) {\n02724|       console.error('üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ü–≠–ö API:', error);\n02725|       \n02726|       // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –æ—à–∏–±–∫–∏\n02727|       let errorDescription = '–û—à–∏–±–∫–∞ API –ü–≠–ö';\n02728|       \n02729|       if (error.message?.includes('Failed to fetch')) {\n02730|         errorDescription = 'API –ü–≠–ö –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';\n02731|       } else if (error.message?.includes('401')) {\n02732|         errorDescription = '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ü–≠–ö';\n02733|       } else if (error.message?.includes('400')) {\n02734|         errorDescription = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞';\n02735|       } else if (error.message?.includes('timeout')) {\n02736|         errorDescription = '–¢–∞–π–º-–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ API';\n02737|       }\n02738|       \n02739|       console.error(`üö® –ü–≠–ö: ${errorDescription}. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ñ–æ–ª–ª–±—ç–∫ —Ä–∞—Å—á–µ—Ç—É`);\n02740|       \n02741|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n02742|       const totalVolume = form.cargos.reduce((sum, cargo) => \n02743|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n02744|       );\n02745|       \n02746|       // –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π —Ñ–æ–ª–ª–±—ç–∫ —Ä–∞—Å—á–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Å–∞ –∏ –æ–±—ä–µ–º–∞\n02747|       let basePrice = Math.max(\n02748|         totalWeight * 18, // 18 —Ä—É–± –∑–∞ –∫–≥\n02749|         totalVolume * 4500 // 4500 —Ä—É–± –∑–∞ –º3\n02750|       );\n02751|       \n02752|       // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏\n02753|       const services: { name: string; description: string; price: number }[] = [];\n02754|       \n02755|       services.push({\n02756|         name: '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞',\n02757|         description: `${form.fromCity} - ${form.toCity} (${totalWeight} –∫–≥, ${totalVolume.toFixed(3)} –º¬≥)`,\n02758|         price: Math.round(basePrice)\n02759|       });\n02760|       \n02761|       if (form.fromAddressDelivery) {\n02762|         const pickupCost = 600;\n02763|         basePrice += pickupCost;\n02764|         services.push({\n02765|           name: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n02766|           description: '–û—Ç –∞–¥—Ä–µ—Å–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è',\n02767|           price: pickupCost\n02768|         });\n02769|       }\n02770|       \n02771|       if (form.toAddressDelivery) {\n02772|         const deliveryCost = 600;\n02773|         basePrice += deliveryCost;\n02774|         services.push({\n02775|           name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n02776|           description: '–î–æ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è',\n02777|           price: deliveryCost\n02778|         });\n02779|       }\n02780|       \n02781|       if (form.needInsurance && form.declaredValue > 0) {\n02782|         const insuranceCost = form.declaredValue * 0.012;\n02783|         basePrice += insuranceCost;\n02784|         services.push({\n02785|           name: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ',\n02786|           description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n02787|           price: Math.round(insuranceCost)\n02788|         });\n02789|       }\n02790|       \n02791|       if (form.needPackaging) {\n02792|         const packagingCost = totalWeight * 25;\n02793|         basePrice += packagingCost;\n02794|         services.push({\n02795|           name: '–ó–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞',\n02796|           description: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n02797|           price: Math.round(packagingCost)\n02798|         });\n02799|       }\n02800|       \n02801|       if (form.needCarry) {\n02802|         const carryCost = 500;\n02803|         basePrice += carryCost;\n02804|         services.push({\n02805|           name: '–ü–æ–¥—ä–µ–º –Ω–∞ —ç—Ç–∞–∂',\n02806|           description: `–ù–∞ ${form.floor} —ç—Ç–∞–∂ ${form.hasFreightLift ? '(—Å –ª–∏—Ñ—Ç–æ–º)' : '(–±–µ–∑ –ª–∏—Ñ—Ç–∞)'}`,\n02807|           price: carryCost\n02808|         });\n02809|       }\n02810|       \n02811|       return {\n02812|         company: '–ü–≠–ö',\n02813|         price: Math.round(basePrice),\n02814|         days: 3,\n02815|         details: {\n02816|           note: '–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º –ü–≠–ö (API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)',\n02817|           services,\n02818|           totalWeight,\n02819|           totalVolume,\n02820|           errorInfo: error.message\n02821|         },\n02822|         requestData: null,\n02823|         responseData: null,\n02824|         apiUrl,\n02825|         error: `${errorDescription}. –ü–æ–∫–∞–∑–∞–Ω –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º.`\n02826|       };\n02827|     }\n02828|   };\n02829| \n02830| \n02831| \n02832|   // üîß –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö\n02833|   const calculateOptimalLength = (cargos: typeof form.cargos) => {\n02834|     if (cargos.length === 1) {\n02835|       return cargos[0].length / 100; // –û–¥–Ω–æ –º–µ—Å—Ç–æ - —Ç–æ—á–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã\n02836|     }\n02837|     \n02838|     // –î–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç:\n02839|     const maxLength = Math.max(...cargos.map(c => c.length)) / 100;\n02840|     const totalLength = cargos.reduce((sum, c) => sum + c.length, 0) / 100;\n02841|     \n02842|     // –ï—Å–ª–∏ –º–µ—Å—Ç –º–Ω–æ–≥–æ (>3), –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É–º–º–∞—Ä–Ω—É—é –¥–ª–∏–Ω—É (–º–µ—Å—Ç–∞ –≤ —Ä—è–¥)\n02843|     // –ò–Ω–∞—á–µ - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é (–º–µ—Å—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ)\n02844|     return cargos.length > 3 ? totalLength : maxLength;\n02845|   };\n02846| \n02847|   const calculateOptimalWidth = (cargos: typeof form.cargos) => {\n02848|     // –î–ª—è —à–∏—Ä–∏–Ω—ã –ª–æ–≥–∏—á–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é\n02849|     return Math.max(...cargos.map(c => c.width)) / 100;\n02850|   };\n02851| \n02852|   const calculateOptimalHeight = (cargos: typeof form.cargos) => {\n02853|     if (cargos.length === 1) {\n02854|       return cargos[0].height / 100;\n02855|     }\n02856|     \n02857|     const maxHeight = Math.max(...cargos.map(c => c.height)) / 100;\n02858|     const totalHeight = cargos.reduce((sum, c) => sum + c.height, 0) / 100;\n02859|     \n02860|     // –ï—Å–ª–∏ –º–Ω–æ–≥–æ –º–µ–ª–∫–∏—Ö –º–µ—Å—Ç - –º–æ–∂–µ–º —Å—Ç–∞–∫–∏—Ä–æ–≤–∞—Ç—å\n02861|     const avgHeight = totalHeight / cargos.length;\n02862|     return avgHeight < 0.5 ? totalHeight : maxHeight; // 50—Å–º –ø–æ—Ä–æ–≥ –¥–ª—è —Å—Ç–∞–∫–∏—Ä–æ–≤–∞–Ω–∏—è\n02863|   };\n02864| \n02865|   // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç\n02866|   const validateMultipleCargos = (cargos: typeof form.cargos) => {\n02867|     if (!cargos || cargos.length === 0) {\n02868|       throw new Error('–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≥—Ä—É–∑–æ–≤—ã–µ –º–µ—Å—Ç–∞');\n02869|     }\n02870|     \n02871|     if (cargos.length > 50) {\n02872|       throw new Error(`–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç (${cargos.length}). –ú–∞–∫—Å–∏–º—É–º: 50`);\n02873|     }\n02874|     \n02875|     const totalVolume = cargos.reduce((sum, cargo) => \n02876|       sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n02877|     );\n02878|     \n02879|     if (totalVolume > 100) {\n02880|       console.warn('‚ö†Ô∏è –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π –æ–±—ä–µ–º –≥—Ä—É–∑–∞ (>100 –º¬≥). –í–æ–∑–º–æ–∂–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.');\n02881|     }\n02882|     \n02883|     return true;\n02884|   };\n02885| \n02886|   const calculateRailContinent = async (): Promise<CalculationResult> => {\n02887|     const apiUrl = '/api/rail-continent';\n02888|     \n02889|     try {\n02890|       // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n02891|       validateMultipleCargos(form.cargos);\n02892|       \n02893|       // –í—ã—á–∏—Å–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥—Ä—É–∑–∞\n02894|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n02895|       const totalVolume = form.cargos.reduce((sum, cargo) => \n02896|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n02897|       );\n02898|       \n02899|       // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–º–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n02900|       const optimalLength = calculateOptimalLength(form.cargos);\n02901|       const optimalWidth = calculateOptimalWidth(form.cargos);\n02902|       const optimalHeight = calculateOptimalHeight(form.cargos);\n02903|       \n02904|       // üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n02905|       console.log('üöÇ Rail Continent: –ê–Ω–∞–ª–∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç:');\n02906|       console.log(`   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç: ${form.cargos.length}`);\n02907|       console.log(`   - –û–±—â–∏–π –≤–µ—Å: ${totalWeight} –∫–≥`);\n02908|       console.log(`   - –û–±—â–∏–π –æ–±—ä–µ–º: ${totalVolume.toFixed(3)} –º¬≥`);\n02909|       \n02910|       form.cargos.forEach((cargo, index) => {\n02911|         console.log(`   üì¶ –ú–µ—Å—Ç–æ ${index + 1}:`);\n02912|         console.log(`     - –ì–∞–±–∞—Ä–∏—Ç—ã: ${cargo.length}√ó${cargo.width}√ó${cargo.height} —Å–º`);\n02913|         console.log(`     - –í–µ—Å: ${cargo.weight} –∫–≥`);\n02914|         console.log(`     - –û–±—ä–µ–º: ${((cargo.length * cargo.width * cargo.height) / 1000000).toFixed(3)} –º¬≥`);\n02915|       });\n02916|       \n02917|       if (form.cargos.length > 1) {\n02918|         const maxLength = Math.max(...form.cargos.map(c => c.length));\n02919|         const maxWidth = Math.max(...form.cargos.map(c => c.width));\n02920|         const maxHeight = Math.max(...form.cargos.map(c => c.height));\n02921|         console.log(`   üìê –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã: ${maxLength}√ó${maxWidth}√ó${maxHeight} —Å–º`);\n02922|         console.log(`   üîß –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã: ${(optimalLength*100).toFixed(0)}√ó${(optimalWidth*100).toFixed(0)}√ó${(optimalHeight*100).toFixed(0)} —Å–º`);\n02923|       }\n02924|       \n02925|       // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä quantity –∏ —É–ª—É—á—à–µ–Ω–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã\n02926|       const requestData = {\n02927|         city_sender: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n02928|         city_receiver: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n02929|         weight: totalWeight,\n02930|         volume: totalVolume,\n02931|         quantity: form.cargos.length, // üîß –î–û–ë–ê–í–õ–ï–ù–û: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç\n02932|         length: optimalLength,        // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞\n02933|         width: optimalWidth,          // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞  \n02934|         height: optimalHeight,        // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞\n02935|         declared_cost: form.declaredValue,\n02936|         pickup: form.fromAddressDelivery ? '1' : '0',\n02937|         delivery: form.toAddressDelivery ? '1' : '0',\n02938|         packaging: form.needPackaging ? '1' : '0',\n02939|         insurance: form.needInsurance ? '1' : '0',\n02940|         tariff: 'auto' // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞\n02941|       };\n02942| \n02943|       console.log('üöÇ Rail Continent –∑–∞–ø—Ä–æ—Å:', requestData);\n02944| \n02945|       const response = await fetch(apiUrl, {\n02946|         method: 'POST',\n02947|         headers: {\n02948|           'Content-Type': 'application/json',\n02949|         },\n02950|         body: JSON.stringify(requestData)\n02951|       });\n02952| \n02953|       const data = await response.json();\n02954|       console.log('üöÇ Rail Continent –æ—Ç–≤–µ—Ç:', data);\n02955| \n02956|       if (response.ok && data.result === 'success' && data.data) {\n02957|         // –í—ã–±–∏—Ä–∞–µ–º –∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã–π —Ç–∞—Ä–∏—Ñ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π (—Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π)\n02958|         const autoTariff = data.data.auto;\n02959|         \n02960|         if (autoTariff) {\n02961|           // –°–æ–±–∏—Ä–∞–µ–º –¥–µ—Ç–∞–ª–∏ –ø–æ —É—Å–ª—É–≥–∞–º –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n02962|           const services: { name: string; description: string; price: number }[] = [];\n02963|           let totalPrice = 0;\n02964|           \n02965|           console.log('üöÇ Rail Continent –¥–µ—Ç–∞–ª–∏ —Ç–∞—Ä–∏—Ñ–∞:', {\n02966|             price_with_out_sale: autoTariff.price_with_out_sale,\n02967|             pricePackage: autoTariff.pricePackage,\n02968|             priceInsurance: autoTariff.priceInsurance,\n02969|             needPackaging: form.needPackaging,\n02970|             needInsurance: form.needInsurance,\n02971|             declaredValue: form.declaredValue\n02972|           });\n02973|           \n02974|           console.log('üöÇ Rail Continent —á–µ–∫–±–æ–∫—Å—ã —Å–æ—Å—Ç–æ—è–Ω–∏–µ:');\n02975|           console.log('   - –£–ø–∞–∫–æ–≤–∫–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è:', form.needPackaging);\n02976|           console.log('   - –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è:', form.needInsurance);\n02977|           console.log('   - –ó–∞—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:', form.declaredValue);\n02978|           \n02979|           // –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ –≥—Ä—É–∑–∞\n02980|           if (autoTariff.price_with_out_sale) {\n02981|             const deliveryPrice = parseFloat(autoTariff.price_with_out_sale);\n02982|             console.log('üöÇ –î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞:', deliveryPrice);\n02983|             services.push({\n02984|               name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n02985|               description: `${autoTariff.type} (${autoTariff.rsType})`,\n02986|               price: deliveryPrice\n02987|             });\n02988|             totalPrice += deliveryPrice;\n02989|           }\n02990|           \n02991|           // –£–ø–∞–∫–æ–≤–∫–∞\n02992|           if (form.needPackaging && autoTariff.pricePackage) {\n02993|             const packagingPrice = parseFloat(autoTariff.pricePackage);\n02994|             console.log('üöÇ –£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞:', packagingPrice);\n02995|             services.push({\n02996|               name: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n02997|               description: '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞',\n02998|               price: packagingPrice\n02999|             });\n03000|             totalPrice += packagingPrice;\n\n(File has more lines. Use 'offset' parameter to read beyond line 3000)\n</file>",
    "metadata": {
      "preview": "          \n          console.log('–ù–ê–ô–î–ï–ù–ù–´–ï –î–ê–¢–´:');\n          console.log('pickup:', pickup);\n          console.log('arrivalToOspReceiver:', arrivalToOspReceiver);\n          \n          if (pickup && arrivalToOspReceiver) {\n            // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—ã (—Ñ–æ—Ä–º–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å \"2025-09-27\" –∏–ª–∏ \"2025-09-27 10:00:00\")\n            const pickupDate = new Date(pickup);\n            const arrivalDate = new Date(arrivalToOspReceiver);\n            \n            console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ pickup:', pickupDate);\n            console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ arrival:', arrivalDate);\n            \n            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã\n            if (!isNaN(pickupDate.getTime()) && !isNaN(arrivalDate.getTime())) {\n              // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–æ—Å—Ç—å –≤ –¥–Ω—è—Ö\n              const timeDiff = arrivalDate.getTime() - pickupDate.getTime();\n              deliveryDays = Math.max(1, Math.ceil(timeDiff / (1000 * 3600 * 24))); // –ú–∏–Ω–∏–º—É–º 1 –¥–µ–Ω—å\n              \n              console.log('–†–∞–∑–Ω–æ—Å—Ç—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö:', timeDiff);"
    },
    "title": "app/page.tsx",
    "time": {
      "start": 1760452213718,
      "end": 1760452213722
    }
  }
}