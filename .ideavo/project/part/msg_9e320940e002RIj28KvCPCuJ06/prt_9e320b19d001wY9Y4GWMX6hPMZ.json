{
  "id": "prt_9e320b19d001wY9Y4GWMX6hPMZ",
  "messageID": "msg_9e320940e002RIj28KvCPCuJ06",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "read",
  "callID": "call_65110202",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "app/page.tsx"
    },
    "output": "<file>\n00001| 'use client';\n00002| \n00003| import React, { useState, useEffect, useCallback, useMemo } from 'react';\n00004| import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\n00005| import { Button } from '@/components/ui/button';\n00006| import { Input } from '@/components/ui/input';\n00007| import { Label } from '@/components/ui/label';\n00008| import { Checkbox } from '@/components/ui/checkbox';\n00009| import { Switch } from '@/components/ui/switch';\n00010| import { Plus, Truck, Building2, Map, Settings, Package2, Trash2 } from 'lucide-react';\n00011| import { Alert, AlertDescription } from '@/components/ui/alert';\n00012| import { Badge } from '@/components/ui/badge';\n00013| import { Separator } from '@/components/ui/separator';\n00014| import { Collapsible, CollapsibleContent } from '@/components/ui/collapsible';\n00015| import ProductSearch from '@/components/ProductSearch';\n00016| import ProductManager from '@/components/ProductManager';\n00017| import TruckVisualization from '@/components/TruckVisualization';\n00018| import { FurnitureProduct, ProductInForm, CargoWithMetadata } from '@/lib/furniture-types';\n00019| import { saveFormData, loadFormData, hasStoredFormData, createDebouncedSaver, clearFormData } from '@/lib/form-storage';\n00020| import { \n00021|   createCargosForProduct, \n00022|   removeCargosForProduct, \n00023|   calculateTotalValue,\n00024|   findCargoIndexesForProduct \n00025| } from '@/lib/furniture-utils';\n00026| \n00027| interface Cargo {\n00028|   id: string;\n00029|   length: number;\n00030|   width: number;\n00031|   height: number;\n00032|   weight: number;\n00033|   // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–≤—è–∑–∏ —Å —Ç–æ–≤–∞—Ä–∞–º–∏\n00034|   productId?: string;\n00035|   placeNumber?: number;\n00036|   isFromProduct?: boolean;\n00037|   addedAt?: number;\n00038| }\n00039| \n00040| interface DeliveryForm {\n00041|   cargos: Cargo[];\n00042|   fromCity: string;\n00043|   toCity: string;\n00044|   fromAddress: string;\n00045|   toAddress: string;\n00046|   declaredValue: number;\n00047|   needPackaging: boolean;\n00048|   needLoading: boolean;\n00049|   needCarry: boolean;\n00050|   floor: number;\n00051|   hasFreightLift: boolean;\n00052|   needInsurance: boolean;\n00053|   fromTerminal: boolean;\n00054|   toTerminal: boolean;\n00055|   fromAddressDelivery: boolean;\n00056|   toAddressDelivery: boolean;\n00057|   fromLavsiteWarehouse: boolean;\n00058|   // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ç–æ–≤–∞—Ä–æ–≤\n00059|   selectedProducts: ProductInForm[];\n00060| }\n00061| \n00062| interface CalculationResult {\n00063|   company: string;\n00064|   price: number;\n00065|   days: number;\n00066|   details?: any;\n00067|   error?: string;\n00068|   requestData?: any;\n00069|   responseData?: any;\n00070|   apiUrl?: string;\n00071|   sessionId?: string;\n00072| }\n00073| \n00074| interface AddressSuggestion {\n00075|   value: string;\n00076|   unrestricted_value: string;\n00077|   data: {\n00078|     city?: string;\n00079|     street?: string;\n00080|     house?: string;\n00081|   };\n00082| }\n00083| \n00084| // –û–ø—Ä–µ–¥–µ–ª–∏–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–º–ø–∞–Ω–∏–π\n00085| const COMPANIES_BASE = [\n00086|   { name: '–ü–≠–ö', logo: 'üöõ', apiKey: 'pek' },\n00087|   { name: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏', logo: 'üì¶', apiKey: 'dellin' },\n00088|   { name: 'Rail Continent', logo: 'üöÇ', apiKey: 'railcontinent' },\n00089|   { name: '–í–æ–∑–æ–≤–æ–∑', logo: 'üöö', apiKey: 'vozovoz' },\n00090|   { name: 'Nord Wheel', logo: 'üåê', apiKey: 'nordwheel' },\n00091|   { name: '–°–¥—ç–∫', logo: 'üìÆ', apiKey: 'cdek' },\n00092|   { name: '–ù–æ–≤–∞—è –ª–∏–Ω–∏—è', logo: 'üõ£Ô∏è', apiKey: 'newline' },\n00093|   { name: '–ò—Ä-–¢—Ä–∞—Å—Ç', logo: 'üè≠', apiKey: 'irtrust' },\n00094|   { name: '–ú–∞–π–æ—Ä —Ç—Ä–∞–Ω—Å', logo: '‚≠ê', apiKey: 'majortrans' },\n00095|   { name: '–ë–ê–ô–ö–ê–õ –°–ï–†–í–ò–°', logo: 'üåä', apiKey: 'baikalservice' },\n00096|   { name: '–ê–¥–∞–º–∞–Ω—Ç', logo: 'üíé', apiKey: 'adamant' },\n00097|   { name: '–≠–ù–ï–†–ì–ò–Ø', logo: '‚ö°', apiKey: 'energiya' },\n00098|   { name: '–¶–ê–ü', logo: 'üéØ', apiKey: 'cap' },\n00099|   { name: '–£—Ä–∞–ª–¢—Ä–∞–Ω—Å–ö–æ–º–ø–∞–Ω–∏', logo: '‚õ∞Ô∏è', apiKey: 'uraltrans' },\n00100|   { name: '–ù–û–í–û–¢–≠–ö', logo: 'üîß', apiKey: 'novotek' },\n00101|   { name: '–ö–∏—Ç', logo: 'üêã', apiKey: 'kit' },\n00102|   { name: '–ö–∞—Ä–∞–≤–∞–Ω', logo: 'üê™', apiKey: 'karavan' },\n00103|   { name: '–ñ–µ–ª–î–æ—Ä–≠–∫—Å–ø–µ–¥–∏—Ü–∏—è', logo: 'üöÑ', apiKey: 'zeldor' },\n00104|   { name: '–î–ö –¢—Ä–∞–Ω–∑–∏—Ç', logo: 'üöê', apiKey: 'dktransit' },\n00105|   { name: '–ì–ª–∞–≤—Ç—Ä–∞—Å—Å–∞', logo: 'üõ§Ô∏è', apiKey: 'glavtrassa' },\n00106|   { name: '–ë–∞–ª—Ç–∏–π—Å–∫–∞—è –°–ª—É–∂–±–∞ –î–æ—Å—Ç–∞–≤–∫–∏', logo: '‚öì', apiKey: 'baltservice' },\n00107|   { name: '–ê–ù–ö–û–†', logo: 'üîó', apiKey: 'ankor' }\n00108| ];\n00109| \n00110| export default function Home() {\n00111|   // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n00112|   const initialFormState: DeliveryForm = {\n00113|     cargos: [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00114|     fromCity: '',\n00115|     toCity: '',\n00116|     fromAddress: '',\n00117|     toAddress: '',\n00118|     declaredValue: 0,\n00119|     needPackaging: false,\n00120|     needLoading: false,\n00121|     needCarry: false,\n00122|     floor: 1,\n00123|     hasFreightLift: false,\n00124|     needInsurance: false,\n00125|     fromTerminal: true,\n00126|     toTerminal: true,\n00127|     fromAddressDelivery: false,\n00128|     toAddressDelivery: false,\n00129|     fromLavsiteWarehouse: false,\n00130|     selectedProducts: []\n00131|   };\n00132| \n00133|   const [form, setForm] = useState<DeliveryForm>(initialFormState);\n00134|   const [isLoaded, setIsLoaded] = useState(false);\n00135|   const [isRestoring, setIsRestoring] = useState(false);\n00136|   const [lastSaveTime, setLastSaveTime] = useState<Date | null>(null);\n00137|   const [isFormChanged, setIsFormChanged] = useState(false);\n00138|   \n00139|   // –°–æ–∑–¥–∞–µ–º –¥–µ–±–∞—É–Ω—Å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (—Å–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è)\n00140|   const debouncedSave = useMemo(() => {\n00141|     const saver = createDebouncedSaver(1000);\n00142|     // –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã\n00143|     return (formData: any) => {\n00144|       setIsFormChanged(true);\n00145|       saver(formData);\n00146|       // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É\n00147|       setTimeout(() => {\n00148|         setLastSaveTime(new Date());\n00149|         setIsFormChanged(false);\n00150|       }, 1100);\n00151|     };\n00152|   }, []);\n00153| \n00154|   const [suggestions, setSuggestions] = useState<AddressSuggestion[]>([]);\n00155|   const [showSuggestions, setShowSuggestions] = useState(false);\n00156|   const [activeField, setActiveField] = useState('');\n00157|   \n00158|   // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω–∏–µ–º/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n00159|   const [enabledCompanies, setEnabledCompanies] = useState<Record<string, boolean>>({\n00160|     pek: true,\n00161|     dellin: true,\n00162|     railcontinent: true,\n00163|     vozovoz: true,\n00164|     nordwheel: true,\n00165|     cdek: true,\n00166|     newline: false,\n00167|     irtrust: false,\n00168|     majortrans: false,\n00169|     baikalservice: false,\n00170|     adamant: false,\n00171|     energiya: false,\n00172|     cap: false,\n00173|     uraltrans: false,\n00174|     novotek: false,\n00175|     kit: true,\n00176|     karavan: false,\n00177|     zeldor: false,\n00178|     dktransit: false,\n00179|     glavtrassa: false,\n00180|     baltservice: false,\n00181|     ankor: false\n00182|   });\n00183|   const [calculations, setCalculations] = useState<CalculationResult[]>([]);\n00184|   const [calculating, setCalculating] = useState(false);\n00185|   const [expandedDetails, setExpandedDetails] = useState<{ [key: string]: boolean }>({});\n00186|   const [expandedDebugInfo, setExpandedDebugInfo] = useState<{ [key: string]: boolean }>({});\n00187|   const [suggestionPosition, setSuggestionPosition] = useState({ top: 0, left: 0 });\n00188|   const [apiStatus, setApiStatus] = useState({\n00189|     pek: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00190|     dellin: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00191|     railcontinent: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00192|     vozovoz: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00193|     nordwheel: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00194|     cdek: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00195|     kit: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00196|     newline: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00197|     irtrust: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00198|     majortrans: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00199|     baikalservice: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00200|     adamant: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00201|     energiya: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00202|     cap: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00203|     uraltrans: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00204|     novotek: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00205|     karavan: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00206|     zeldor: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00207|     dktransit: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00208|     glavtrassa: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00209|     baltservice: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00210|     ankor: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ'\n00211|   });\n00212| \n00213|   // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö - –ù–ï –æ—á–∏—â–∞–µ–º localStorage –≤ dev —Ä–µ–∂–∏–º–µ\n00214|   // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞–º–∏\n00215| \n00216|   // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏\n00217|   useEffect(() => {\n00218|     if (typeof window !== 'undefined' && isLoaded) {\n00219|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ (–ø–æ—Å–ª–µ Clear-Site-Data)\n00220|       const delayedCheck = setTimeout(() => {\n00221|         const currentFormData = loadFormData();\n00222|         if (!currentFormData) {\n00223|           console.log('üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –∏—â–µ–º backup...');\n00224|           \n00225|           // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ backup –¥–∞–Ω–Ω—ã–µ\n00226|           const backupKeys = ['formBackup1', 'formBackup2', 'formBackup3'];\n00227|           for (const key of backupKeys) {\n00228|             const backup = localStorage.getItem(key);\n00229|             if (backup) {\n00230|               try {\n00231|                 localStorage.setItem('deliveryFormData', backup);\n00232|                 console.log('üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ backup:', key);\n00233|                 \n00234|                 // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ\n00235|                 const restoredData = loadFormData();\n00236|                 if (restoredData) {\n00237|                   setIsRestoring(true);\n00238|                   const restoredForm: DeliveryForm = {\n00239|                     cargos: restoredData.cargos.length > 0 ? restoredData.cargos : [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00240|                     fromCity: restoredData.fromCity,\n00241|                     toCity: restoredData.toCity,\n00242|                     fromAddress: restoredData.fromAddress,\n00243|                     toAddress: restoredData.toAddress,\n00244|                     declaredValue: restoredData.declaredValue,\n00245|                     needPackaging: restoredData.needPackaging,\n00246|                     needLoading: restoredData.needLoading,\n00247|                     needCarry: restoredData.needCarry,\n00248|                     floor: restoredData.floor,\n00249|                     hasFreightLift: restoredData.hasFreightLift,\n00250|                     needInsurance: restoredData.needInsurance,\n00251|                     fromTerminal: restoredData.fromTerminal,\n00252|                     toTerminal: restoredData.toTerminal,\n00253|                     fromAddressDelivery: restoredData.fromAddressDelivery,\n00254|                     toAddressDelivery: restoredData.toAddressDelivery,\n00255|                     fromLavsiteWarehouse: restoredData.fromLavsiteWarehouse || false,\n00256|                     selectedProducts: restoredData.selectedProducts,\n00257|                   };\n00258|                   setForm(restoredForm);\n00259|                   if (restoredData.enabledCompanies && Object.keys(restoredData.enabledCompanies).length > 0) {\n00260|                     setEnabledCompanies(restoredData.enabledCompanies);\n00261|                   }\n00262|                   setTimeout(() => setIsRestoring(false), 100);\n00263|                   console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!');\n00264|                 }\n00265|                 break;\n00266|               } catch (e) {\n00267|                 console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ backup:', key, e);\n00268|               }\n00269|             }\n00270|           }\n00271|         }\n00272|       }, 2000);\n00273|       \n00274|       return () => clearTimeout(delayedCheck);\n00275|     }\n00276|   }, [isLoaded]);\n00277| \n00278|   // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)\n00279|   useEffect(() => {\n00280|     // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ\n00281|     if (typeof window !== 'undefined' && !isLoaded) {\n00282|       let dataRestored = false;\n00283|       try {\n00284|         setIsRestoring(true); // –ë–ª–æ–∫–∏—Ä—É–µ–º –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è\n00285|         \n00286|         // –ú—è–≥–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –±–µ–∑ –æ—á–∏—Å—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö\n00287|         const currentVersion = 'v2.4.0-persistent-storage'; // –í–µ—Ä—Å–∏—è —Å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º\n00288|         const savedVersion = localStorage.getItem('appVersion');\n00289|         \n00290|         if (savedVersion !== currentVersion) {\n00291|           console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ', currentVersion);\n00292|           // –ù–ï –æ—á–∏—â–∞–µ–º localStorage - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ\n00293|           localStorage.setItem('appVersion', currentVersion);\n00294|         }\n00295|         \n00296|         // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É\n00297|         const savedFormData = loadFormData();\n00298|         if (savedFormData) {\n00299|           // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞\n00300|           const restoredForm: DeliveryForm = {\n00301|             cargos: savedFormData.cargos.length > 0 ? savedFormData.cargos : [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00302|             fromCity: savedFormData.fromCity,\n00303|             toCity: savedFormData.toCity,\n00304|             fromAddress: savedFormData.fromAddress,\n00305|             toAddress: savedFormData.toAddress,\n00306|             declaredValue: savedFormData.declaredValue,\n00307|             needPackaging: savedFormData.needPackaging,\n00308|             needLoading: savedFormData.needLoading,\n00309|             needCarry: savedFormData.needCarry,\n00310|             floor: savedFormData.floor,\n00311|             hasFreightLift: savedFormData.hasFreightLift,\n00312|             needInsurance: savedFormData.needInsurance,\n00313|             fromTerminal: savedFormData.fromTerminal,\n00314|             toTerminal: savedFormData.toTerminal,\n00315|             fromAddressDelivery: savedFormData.fromAddressDelivery,\n00316|             toAddressDelivery: savedFormData.toAddressDelivery,\n00317|             fromLavsiteWarehouse: savedFormData.fromLavsiteWarehouse || false,\n00318|             selectedProducts: savedFormData.selectedProducts,\n00319|           };\n00320|           \n00321|           setForm(restoredForm);\n00322|           \n00323|           // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n00324|           if (savedFormData.enabledCompanies && Object.keys(savedFormData.enabledCompanies).length > 0) {\n00325|             setEnabledCompanies(savedFormData.enabledCompanies);\n00326|           }\n00327|           console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ localStorage');\n00328|           \n00329|           // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è Supabase\n00330|           const currentTime = Math.floor(Date.now() / 1000);\n00331|           console.log('üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (timestamp):', currentTime);\n00332|           console.log('üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (ISO):', new Date().toISOString());\n00333|           \n00334|           dataRestored = true;\n00335|           // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—Å–ø–µ–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è\n00336|           setTimeout(() => {\n00337|             setIsRestoring(false);\n00338|           }, 100);\n00339|         } else {\n00340|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏\n00341|           const oldSaved = localStorage.getItem('deliveryForm');\n00342|           if (oldSaved) {\n00343|             console.log('üîÑ –ù–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç–∞—Ä–æ–º —Ñ–æ—Ä–º–∞—Ç–µ, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è...');\n00344|             const oldForm = JSON.parse(oldSaved);\n00345|             if (!oldForm.cargos || oldForm.cargos.length === 0) {\n00346|               oldForm.cargos = [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }];\n00347|             }\n00348|             setForm(oldForm);\n00349|             \n00350|             // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –∏ —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ\n00351|             saveFormData(oldForm);\n00352|             localStorage.removeItem('deliveryForm');\n00353|             console.log('‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');\n00354|             \n00355|             dataRestored = true;\n00356|             // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—Å–ø–µ–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è\n00357|             setTimeout(() => {\n00358|               setIsRestoring(false);\n00359|             }, 100);\n00360|           }\n00361|         }\n00362|         \n00363|         // –í—ã–≤–æ–¥–∏–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¢–ö –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n00364|         console.log('üìã –í—Å–µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ –¢–ö:', COMPANIES_BASE.length);\n00365|         console.log('üìã –°–ø–∏—Å–æ–∫ –¢–ö:', COMPANIES_BASE.map(c => c.name));\n00366|         \n00367|       } catch (error) {\n00368|         console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);\n00369|         // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ\n00370|       } finally {\n00371|         // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, —Å—Ä–∞–∑—É —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ\n00372|         if (!dataRestored) {\n00373|           setIsRestoring(false);\n00374|         }\n00375|         setIsLoaded(true);\n00376|       }\n00377|     }\n00378|   }, [isLoaded]);\n00379| \n00380|   // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–æ—Ä–º—ã (—Å –¥–µ–±–∞—É–Ω—Å–æ–º)\n00381|   useEffect(() => {\n00382|     if (typeof window !== 'undefined' && isLoaded && !isRestoring) {\n00383|       // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–±–∞—É–Ω—Å –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è\n00384|       debouncedSave({\n00385|         cargos: form.cargos,\n00386|         fromCity: form.fromCity,\n00387|         toCity: form.toCity,\n00388|         fromAddress: form.fromAddress,\n00389|         toAddress: form.toAddress,\n00390|         declaredValue: form.declaredValue,\n00391|         needPackaging: form.needPackaging,\n00392|         needLoading: form.needLoading,\n00393|         needCarry: form.needCarry,\n00394|         floor: form.floor,\n00395|         hasFreightLift: form.hasFreightLift,\n00396|         needInsurance: form.needInsurance,\n00397|         fromTerminal: form.fromTerminal,\n00398|         toTerminal: form.toTerminal,\n00399|         fromAddressDelivery: form.fromAddressDelivery,\n00400|         toAddressDelivery: form.toAddressDelivery,\n00401|         fromLavsiteWarehouse: form.fromLavsiteWarehouse,\n00402|         selectedProducts: form.selectedProducts,\n00403|         enabledCompanies: enabledCompanies,\n00404|       });\n00405|     }\n00406|   }, [form, enabledCompanies, isLoaded, isRestoring, debouncedSave]);\n00407| \n00408|   // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –ø—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n00409|   useEffect(() => {\n00410|     if (form.declaredValue > 0) {\n00411|       setForm(prev => ({ ...prev, needInsurance: true }));\n00412|     }\n00413|   }, [form.declaredValue]);\n00414| \n00415|   // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤\n00416|   useEffect(() => {\n00417|     const handleMessage = (event: MessageEvent) => {\n00418|       if (event.data && event.data.type === 'PRODUCTS_UPDATED') {\n00419|         console.log('üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤:', event.data.data);\n00420|         \n00421|         // –û—á–∏—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫—ç—à–∏ —Ç–æ–≤–∞—Ä–æ–≤\n00422|         const keysToRemove: string[] = [];\n00423|         for (let i = 0; i < localStorage.length; i++) {\n00424|           const key = localStorage.key(i);\n00425|           if (key && (key.startsWith('furniture_') || key.startsWith('product_') || key.includes('ProductSearch'))) {\n00426|             keysToRemove.push(key);\n00427|           }\n00428|         }\n00429|         keysToRemove.forEach(key => localStorage.removeItem(key));\n00430|         console.log(`üßΩ –û—á–∏—â–µ–Ω–æ ${keysToRemove.length} –∫–ª—é—á–µ–π –∫—ç—à–∞ —Ç–æ–≤–∞—Ä–æ–≤`);\n00431|         \n00432|         // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É ProductSearch –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è\n00433|         window.dispatchEvent(new CustomEvent('forceProductsReload', {\n00434|           detail: event.data.data\n00435|         }));\n00436|       }\n00437|     };\n00438|     \n00439|     window.addEventListener('message', handleMessage);\n00440|     \n00441|     return () => {\n00442|       window.removeEventListener('message', handleMessage);\n00443|     };\n00444|   }, []);\n00445| \n00446|   // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã\n00447|   useEffect(() => {\n00448|     if (typeof window !== 'undefined' && isLoaded) {\n00449|       checkAllAPIStatus();\n00450|     }\n00451|   }, [isLoaded]);\n00452| \n00453|   const checkAPIStatus = async (apiName: string, testFunction: () => Promise<any>) => {\n00454|     try {\n00455|       const result = await testFunction();\n00456|       if (result && !result.error) {\n00457|         setApiStatus(prev => ({ ...prev, [apiName]: '–ø–æ–¥–∫–ª—é—á–µ–Ω–æ' }));\n00458|       } else {\n00459|         setApiStatus(prev => ({ ...prev, [apiName]: '–æ—à–∏–±–∫–∞' }));\n00460|       }\n00461|     } catch (error) {\n00462|       setApiStatus(prev => ({ ...prev, [apiName]: '–æ—à–∏–±–∫–∞' }));\n00463|     }\n00464|   };\n00465| \n00466|   const checkAllAPIStatus = async () => {\n00467|     // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\n00468|     const testData = {\n00469|       fromCity: '–ú–æ—Å–∫–≤–∞',\n00470|       toCity: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', \n00471|       cargos: [{ id: '1', length: 100, width: 100, height: 100, weight: 10 }],\n00472|       declaredValue: 50000,\n00473|       fromAddressDelivery: false,\n00474|       toAddressDelivery: false,\n00475|       needPackaging: false,\n00476|       needInsurance: false\n00477|     };\n00478| \n00479|     // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n00480|     const currentForm = form;\n00481|     \n00482|     // –í—Ä–µ–º–µ–Ω–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ\n00483|     setForm({\n00484|       ...form,\n00485|       fromCity: testData.fromCity,\n00486|       toCity: testData.toCity,\n00487|       cargos: testData.cargos,\n00488|       declaredValue: testData.declaredValue,\n00489|       fromAddressDelivery: testData.fromAddressDelivery,\n00490|       toAddressDelivery: testData.toAddressDelivery,\n00491|       needPackaging: testData.needPackaging,\n00492|       needInsurance: testData.needInsurance\n00493|     });\n00494| \n00495|     // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ\n00496|     Promise.all([\n00497|       checkAPIStatus('pek', async () => {\n00498|         try {\n00499|           const response = await fetch('/api/pek', {\n00500|             method: 'POST',\n00501|             headers: { 'Content-Type': 'application/json' },\n00502|             body: JSON.stringify({ method: 'test' })\n00503|           });\n00504|           const data = await response.json();\n00505|           if (data.status === 'OK') {\n00506|             return { success: true };\n00507|           } else {\n00508|             return { error: true };\n00509|           }\n00510|         } catch (error) {\n00511|           return { error: true };\n00512|         }\n00513|       }),\n00514|       \n00515|       checkAPIStatus('dellin', async () => {\n00516|         try {\n00517|           // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ sessionID –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π (—Ç–æ—Ç –∂–µ –º–µ—Ç–æ–¥ —á—Ç–æ –≤ calculateDellin)\n00518|           const authResponse = await fetch('https://api.dellin.ru/v3/auth/login.json', {\n00519|             method: 'POST',\n00520|             headers: { 'Content-Type': 'application/json' },\n00521|             body: JSON.stringify({\n00522|               appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n00523|               login: 'service@lavsit.ru',\n00524|               password: 'edcwsx123QAZ'\n00525|             })\n00526|           });\n00527|           const authData = await authResponse.json();\n00528|           \n00529|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ –∫ sessionID –∫–∞–∫ –≤ calculateDellin\n00530|           if (authData.data?.sessionID || authData.sessionID || authData.data?.session) {\n00531|             return { success: true };\n00532|           } else {\n00533|             return { error: true };\n00534|           }\n00535|         } catch (error) {\n00536|           return { error: true };\n00537|         }\n00538|       }),\n00539|       \n00540|       checkAPIStatus('railcontinent', async () => {\n00541|         try {\n00542|           const response = await fetch('/api/rail-continent', {\n00543|             method: 'POST',\n00544|             headers: { 'Content-Type': 'application/json' },\n00545|             body: JSON.stringify({\n00546|               city_sender: testData.fromCity,\n00547|               city_receiver: testData.toCity,\n00548|               weight: 10,\n00549|               volume: 0.1,\n00550|               length: 1,\n00551|               width: 1,\n00552|               height: 1,\n00553|               declared_cost: testData.declaredValue,\n00554|               pickup: '0',\n00555|               delivery: '0',\n00556|               packaging: '0',\n00557|               insurance: '0',\n00558|               tariff: 'auto'\n00559|             })\n00560|           });\n00561|           return await response.json();\n00562|         } catch (error) {\n00563|           return { error: true };\n00564|         }\n00565|       }),\n00566|       \n00567|       checkAPIStatus('vozovoz', async () => {\n00568|         try {\n00569|           const response = await fetch('/api/vozovoz', {\n00570|             method: 'POST',\n00571|             headers: { 'Content-Type': 'application/json' },\n00572|             body: JSON.stringify({\n00573|               object: \"price\",\n00574|               action: \"get\",\n00575|               params: {\n00576|                 cargo: {\n00577|                   dimension: {\n00578|                     quantity: 1,\n00579|                     volume: 0.1,\n00580|                     weight: 10\n00581|                   }\n00582|                 },\n00583|                 gateway: {\n00584|                   dispatch: {\n00585|                     point: {\n00586|                       location: testData.fromCity,\n00587|                       terminal: \"default\"\n00588|                     }\n00589|                   },\n00590|                   destination: {\n00591|                     point: {\n00592|                       location: testData.toCity,\n00593|                       terminal: \"default\"\n00594|                     }\n00595|                   }\n00596|                 }\n00597|               }\n00598|             })\n00599|           });\n00600|           return await response.json();\n00601|         } catch (error) {\n00602|           return { error: true };\n00603|         }\n00604|       }),\n00605|       \n00606|       checkAPIStatus('nordwheel', async () => {\n00607|         try {\n00608|           const totalWeight = 10;\n00609|           const totalVolume = 0.1;\n00610|           \n00611|           const params = new URLSearchParams({\n00612|             from: '91',\n00613|             to: '92',\n00614|             pickup: '1',\n00615|             deliver: '1',\n00616|             weight: totalWeight.toString(),\n00617|             volume: totalVolume.toString(),\n00618|             oversized: '0',\n00619|             package: '1',\n00620|             packageCount: '1',\n00621|             insurance: '1',\n00622|             sum: '50000',\n00623|             documentsReturn: '0',\n00624|             fragile: '1'\n00625|           });\n00626| \n00627|           const fullUrl = `https://nordw.ru/tools/api/calc/calculate/?${params.toString()}`;\n00628|           const response = await fetch(fullUrl);\n00629|           const data = await response.json();\n00630|           \n00631|           if (response.ok && data.status === 'success') {\n00632|             return { success: true };\n00633|           } else {\n00634|             return { error: true };\n00635|           }\n00636|         } catch (error) {\n00637|           return { error: true };\n00638|         }\n00639|       }),\n00640|       \n00641|       checkAPIStatus('cdek', async () => {\n00642|         try {\n00643|           const response = await fetch('/api/cdek', {\n00644|             method: 'POST',\n00645|             headers: { 'Content-Type': 'application/json' },\n00646|             body: JSON.stringify({\n00647|               from_city: testData.fromCity,\n00648|               to_city: testData.toCity,\n00649|               packages: [{\n00650|                 height: 10,\n00651|                 length: 20,\n00652|                 width: 10,\n00653|                 weight: 1000\n00654|               }]\n00655|             })\n00656|           });\n00657|           const data = await response.json();\n00658|           \n00659|           if (response.ok && data.tariff_codes && data.tariff_codes.length > 0) {\n00660|             return { success: true };\n00661|           } else {\n00662|             return { error: true };\n00663|           }\n00664|         } catch (error) {\n00665|           return { error: true };\n00666|         }\n00667|       })\n00668|     ]).finally(() => {\n00669|       // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n00670|       setForm(currentForm);\n00671|     });\n00672|   };\n00673| \n00674|   const searchAddresses = useCallback(async (query: string, field: string, element?: HTMLInputElement) => {\n00675|     if (query.length < 3) {\n00676|       setSuggestions([]);\n00677|       setShowSuggestions(false);\n00678|       return;\n00679|     }\n00680| \n00681|     setActiveField(field);\n00682|     \n00683|     // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ –∞–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–æ–∫\n00684|     if (element) {\n00685|       const rect = element.getBoundingClientRect();\n00686|       setSuggestionPosition({\n00687|         top: rect.bottom + window.scrollY,\n00688|         left: rect.left + window.scrollX\n00689|       });\n00690|     }\n00691|     \n00692|     try {\n00693|       const response = await fetch('https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address', {\n00694|         method: 'POST',\n00695|         headers: {\n00696|           'Content-Type': 'application/json',\n00697|           'Accept': 'application/json',\n00698|           'Authorization': 'Token eb87bbb3789bb43ed465f796892ea951f9e91008'\n00699|         },\n00700|         body: JSON.stringify({\n00701|           query: query,\n00702|           count: 10,\n00703|           // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª–µ–π –≥–æ—Ä–æ–¥–æ–≤ - —Ç–æ–ª—å–∫–æ –≥–æ—Ä–æ–¥–∞\n00704|           ...(field === 'fromCity' || field === 'toCity' ? {\n00705|             restrict_value: true,\n00706|             locations: [{\n00707|               country: '–†–æ—Å—Å–∏—è'\n00708|             }],\n00709|             from_bound: { value: 'city' },\n00710|             to_bound: { value: 'city' }\n00711|           } : {})\n00712|         })\n00713|       });\n00714| \n00715|       if (response.ok) {\n00716|         const data = await response.json();\n00717|         setSuggestions(data.suggestions || []);\n00718|         setShowSuggestions(true);\n00719|       }\n00720|     } catch (error) {\n00721|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫:', error);\n00722|     }\n00723|   }, []);\n00724| \n00725|   const debounceTimer = React.useRef<NodeJS.Timeout>();\n00726|   const handleAddressChange = (field: string, value: string, element?: HTMLInputElement) => {\n00727|     setForm(prev => ({ ...prev, [field]: value }));\n00728|     \n00729|     clearTimeout(debounceTimer.current);\n00730|     debounceTimer.current = setTimeout(() => {\n00731|       searchAddresses(value, field, element);\n00732|     }, 50);\n00733|   };\n00734| \n00735|   const selectSuggestion = (suggestion: AddressSuggestion) => {\n00736|     setForm(prev => ({ ...prev, [activeField]: suggestion.value }));\n00737|     setShowSuggestions(false);\n00738|     setActiveField('');\n00739|   };\n00740| \n00741|   // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞ \"–°–æ —Å–∫–ª–∞–¥–∞ –õ–∞–≤—Å–∏—Ç\"\n00742|   const handleLavsiteWarehouseChange = (checked: boolean) => {\n00743|     if (checked) {\n00744|       setForm(prev => ({\n00745|         ...prev,\n00746|         fromLavsiteWarehouse: true,\n00747|         fromAddressDelivery: true,\n00748|         fromTerminal: false,\n00749|         fromCity: '–õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π',\n00750|         fromAddress: '–¥–µ—Ä–µ–≤–Ω—è –û—Å–µ–µ–≤–æ, 202, –≥–æ—Ä–æ–¥—Å–∫–æ–π –æ–∫—Ä—É–≥ –õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π, –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å'\n00751|       }));\n00752|     } else {\n00753|       setForm(prev => ({\n00754|         ...prev,\n00755|         fromLavsiteWarehouse: false,\n00756|         fromCity: '',\n00757|         fromAddress: ''\n00758|       }));\n00759|     }\n00760|   };\n00761| \n00762|   const addCargo = () => {\n00763|     const newId = (form.cargos.length + 1).toString();\n00764|     setForm(prev => ({\n00765|       ...prev,\n00766|       cargos: [...prev.cargos, { id: newId, length: 0, width: 0, height: 0, weight: 0 }]\n00767|     }));\n00768|   };\n00769| \n00770|   const updateCargo = (id: string, field: string, value: number) => {\n00771|     setForm(prev => {\n00772|       const updatedCargos = prev.cargos.map(cargo => \n00773|         cargo.id === id ? { ...cargo, [field]: value } : cargo\n00774|       );\n00775|       \n00776|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n00777|       const cleanResult = cleanEmptyCargos(updatedCargos, prev.selectedProducts || []);\n00778|       \n00779|       return {\n00780|         ...prev,\n00781|         cargos: cleanResult.cargos,\n00782|         selectedProducts: cleanResult.products\n00783|       };\n00784|     });\n00785|   };\n00786| \n00787|   const removeCargo = (id: string) => {\n00788|     if (form.cargos.length > 1) {\n00789|       setForm(prev => ({\n00790|         ...prev,\n00791|         cargos: prev.cargos.filter(cargo => cargo.id !== id)\n00792|       }));\n00793|     }\n00794|   };\n00795| \n00796|   // üîß –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ (–≤—Å–µ –ø–æ–ª—è —Ä–∞–≤–Ω—ã 0)\n00797|   const isEmptyCargo = (cargo: Cargo) => {\n00798|     return cargo.length === 0 && cargo.width === 0 && cargo.height === 0 && cargo.weight === 0;\n00799|   };\n00800| \n00801|   // üîß –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤\n00802|   const cleanEmptyCargos = (cargos: Cargo[], selectedProducts: ProductInForm[]) => {\n00803|     // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –≥—Ä—É–∑\n00804|     const hasFilledCargos = cargos.some(cargo => !isEmptyCargo(cargo));\n00805|     \n00806|     if (!hasFilledCargos) {\n00807|       // –ï—Å–ª–∏ –Ω–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –ø—É—Å—Ç–æ–π\n00808|       return {\n00809|         cargos: cargos.length > 0 ? [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }] : [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00810|         products: selectedProducts\n00811|       };\n00812|     }\n00813| \n00814|     // –°–æ–∑–¥–∞–µ–º –º–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ä—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –∫ –Ω–æ–≤—ã–º\n00815|     const oldToNewIndexMap = new globalThis.Map<number, number>();\n00816|     let newIndex = 0;\n00817|     \n00818|     cargos.forEach((cargo, oldIndex) => {\n00819|       if (!isEmptyCargo(cargo)) {\n00820|         oldToNewIndexMap.set(oldIndex, newIndex);\n00821|         newIndex++;\n00822|       }\n00823|     });\n00824|     \n00825|     // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –≥—Ä—É–∑—ã\n00826|     const filledCargos = cargos.filter(cargo => !isEmptyCargo(cargo));\n00827|     \n00828|     // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã —É —Ç–æ–≤–∞—Ä–æ–≤\n00829|     const updatedProducts = selectedProducts.map(productItem => ({\n00830|       ...productItem,\n00831|       cargoIndexes: productItem.cargoIndexes\n00832|         .map(oldIndex => oldToNewIndexMap.get(oldIndex))\n00833|         .filter(newIdx => newIdx !== undefined) as number[]\n00834|     }));\n00835|     \n00836|     return {\n00837|       cargos: filledCargos,\n00838|       products: updatedProducts\n00839|     };\n00840|   };\n00841| \n00842|   // üîß –§—É–Ω–∫—Ü–∏—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≥—Ä—É–∑–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n00843|   interface GroupedCargoDisplay {\n00844|     length: number;\n00845|     width: number;\n00846|     height: number;\n00847|     weight: number;\n00848|     quantity: number;\n00849|     indices: number[];\n00850|     isEmpty: boolean;\n00851|   }\n00852| \n00853|   const groupCargosForDisplay = (cargos: Cargo[]): GroupedCargoDisplay[] => {\n00854|     const groups = new globalThis.Map<string, GroupedCargoDisplay>();\n00855|     \n00856|     cargos.forEach((cargo, index) => {\n00857|       const isEmpty = isEmptyCargo(cargo);\n00858|       \n00859|       // –î–ª—è –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ –Ω–µ –≥—Ä—É–ø–ø–∏—Ä—É–µ–º\n00860|       if (isEmpty) {\n00861|         groups.set(`empty_${index}`, {\n00862|           length: 0,\n00863|           width: 0,\n00864|           height: 0,\n00865|           weight: 0,\n00866|           quantity: 1,\n00867|           indices: [index],\n00868|           isEmpty: true\n00869|         });\n00870|         return;\n00871|       }\n00872|       \n00873|       // –°–æ–∑–¥–∞–µ–º –∫–ª—é—á –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –∏ –≤–µ—Å–∞\n00874|       const key = `${cargo.length}_${cargo.width}_${cargo.height}_${cargo.weight}`;\n00875|       \n00876|       if (groups.has(key)) {\n00877|         const existing = groups.get(key)!;\n00878|         existing.quantity += 1;\n00879|         existing.indices.push(index);\n00880|       } else {\n00881|         groups.set(key, {\n00882|           length: cargo.length,\n00883|           width: cargo.width,\n00884|           height: cargo.height,\n00885|           weight: cargo.weight,\n00886|           quantity: 1,\n00887|           indices: [index],\n00888|           isEmpty: false\n00889|         });\n00890|       }\n00891|     });\n00892|     \n00893|     // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤: —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ (–ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É–±—ã–≤–∞–Ω–∏—è), –ø–æ—Ç–æ–º –ø—É—Å—Ç—ã–µ\n00894|     return Array.from(groups.values()).sort((a, b) => {\n00895|       if (a.isEmpty && !b.isEmpty) return 1;\n00896|       if (!a.isEmpty && b.isEmpty) return -1;\n00897|       if (!a.isEmpty && !b.isEmpty) {\n00898|         return b.quantity - a.quantity; // –ü–æ —É–±—ã–≤–∞–Ω–∏—é –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞\n00899|       }\n00900|       return a.indices[0] - b.indices[0]; // –ü—É—Å—Ç—ã–µ –ø–æ –ø–æ—Ä—è–¥–∫—É –∏–Ω–¥–µ–∫—Å–æ–≤\n00901|     });\n00902|   };\n00903| \n00904|   // üîß –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏\n00905|   const handleProductAdd = (product: FurnitureProduct) => {\n00906|     const timestamp = Date.now();\n00907|     \n00908|     console.log(`‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞: ${product.name} (${product.cargoPlaces.length} –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç)`);\n00909|     \n00910|     // –°–æ–∑–¥–∞–µ–º –≥—Ä—É–∑–æ–≤—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è —Ç–æ–≤–∞—Ä–∞\n00911|     const newCargos = createCargosForProduct(product, 1, timestamp);\n00912|     \n00913|     console.log('–°–æ–∑–¥–∞–Ω–æ –Ω–æ–≤—ã—Ö –≥—Ä—É–∑–æ–≤:', newCargos.length);\n00914|     console.log('–ù–æ–≤—ã–µ –≥—Ä—É–∑—ã:', newCargos.map(c => ({ id: c.id, productId: c.productId, addedAt: c.addedAt })));\n00915|     \n00916|     // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç —Ç–æ–≤–∞—Ä–∞ –≤ —Ñ–æ—Ä–º–µ\n00917|     const productInForm: ProductInForm = {\n00918|       product,\n00919|       quantity: 1,\n00920|       totalPrice: product.retailPrice,\n00921|       cargoIndexes: [], // –ó–∞–ø–æ–ª–Ω–∏–º –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–∑–æ–≤\n00922|       addedAt: timestamp\n00923|     };\n00924|     \n00925|     setForm(prev => {\n00926|       let updatedCargos = [...prev.cargos];\n00927|       let cargoIndexes: number[] = [];\n00928|       \n00929|       // –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è\n00930|       const emptyCargos = updatedCargos\n00931|         .map((cargo, index) => ({ cargo, index }))\n00932|         .filter(item => isEmptyCargo(item.cargo));\n00933|       \n00934|       console.log('–ù–∞–π–¥–µ–Ω–æ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤:', emptyCargos.length);\n00935|       console.log('–ù—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –≥—Ä—É–∑–æ–≤:', newCargos.length);\n00936|       \n00937|       // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞\n00938|       let filledCount = 0;\n00939|       for (let i = 0; i < Math.min(emptyCargos.length, newCargos.length); i++) {\n00940|         const emptyCargoIndex = emptyCargos[i].index;\n00941|         const newCargoData = newCargos[i];\n00942|         \n00943|         updatedCargos[emptyCargoIndex] = {\n00944|           ...updatedCargos[emptyCargoIndex],\n00945|           length: newCargoData.length,\n00946|           width: newCargoData.width,\n00947|           height: newCargoData.height,\n00948|           weight: newCargoData.weight,\n00949|           productId: newCargoData.productId,\n00950|           placeNumber: newCargoData.placeNumber,\n00951|           isFromProduct: newCargoData.isFromProduct,\n00952|           addedAt: newCargoData.addedAt\n00953|         };\n00954|         \n00955|         cargoIndexes.push(emptyCargoIndex);\n00956|         filledCount++;\n00957|       }\n00958|       \n00959|       // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –≥—Ä—É–∑–æ–≤, —á–µ–º –µ—Å—Ç—å –ø—É—Å—Ç—ã—Ö - –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ\n00960|       if (filledCount < newCargos.length) {\n00961|         const remainingCargos = newCargos.slice(filledCount);\n00962|         const startIndex = updatedCargos.length;\n00963|         \n00964|         for (let i = 0; i < remainingCargos.length; i++) {\n00965|           updatedCargos.push(remainingCargos[i]);\n00966|           cargoIndexes.push(startIndex + i);\n00967|         }\n00968|       }\n00969|       \n00970|       productInForm.cargoIndexes = cargoIndexes;\n00971|       \n00972|       console.log('–ò–Ω–¥–µ–∫—Å—ã –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤:', cargoIndexes);\n00973|       console.log('–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:', updatedCargos.length);\n00974|       \n00975|       // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n00976|       const prevSelectedProducts = prev.selectedProducts || [];\n00977|       const newSelectedProducts = [...prevSelectedProducts, productInForm];\n00978|       const newDeclaredValue = calculateTotalValue(newSelectedProducts);\n00979|       \n00980|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n00981|       const cleanResult = cleanEmptyCargos(updatedCargos, newSelectedProducts);\n00982|       \n00983|       return {\n00984|         ...prev,\n00985|         cargos: cleanResult.cargos,\n00986|         selectedProducts: cleanResult.products,\n00987|         declaredValue: newDeclaredValue\n00988|       };\n00989|     });\n00990|     \n00991|     console.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä: ${product.name} (${newCargos.length} –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç)`);\n00992|     console.log('–§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥—Ä—É–∑–æ–≤:', newCargos.length);\n00993|   };\n00994| \n00995|   const handleProductQuantityChange = (productId: string, addedAt: number, newQuantity: number) => {\n00996|     setForm(prev => {\n00997|       console.log(`üî¢ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞ ${productId} —Å ${prev.selectedProducts?.find(p => p.product.id === productId && p.addedAt === addedAt)?.quantity || 0} –Ω–∞ ${newQuantity}`);\n00998|       \n00999|       // –ù–∞—Ö–æ–¥–∏–º —Ç–æ–≤–∞—Ä\n01000|       const selectedProducts = prev.selectedProducts || [];\n01001|       const productIndex = selectedProducts.findIndex(p => \n01002|         p.product.id === productId && p.addedAt === addedAt\n01003|       );\n01004|       \n01005|       if (productIndex === -1) {\n01006|         console.warn('‚ùå –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞');\n01007|         return prev;\n01008|       }\n01009|       \n01010|       const product = selectedProducts[productIndex];\n01011|       console.log('–ì—Ä—É–∑—ã –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞:', prev.cargos.length);\n01012|       \n01013|       // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –≥—Ä—É–∑—ã —ç—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞\n01014|       const cargosWithoutProduct = removeCargosForProduct(\n01015|         prev.cargos as CargoWithMetadata[], \n01016|         productId, \n01017|         addedAt\n01018|       );\n01019|       \n01020|       console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö:', cargosWithoutProduct.length);\n01021|       \n01022|       // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –≥—Ä—É–∑—ã —Å –Ω–æ–≤—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º\n01023|       const newCargos = createCargosForProduct(product.product, newQuantity, addedAt);\n01024|       const updatedCargos = [...cargosWithoutProduct, ...newCargos];\n01025|       \n01026|       console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö:', updatedCargos.length);\n01027|       \n01028|       // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä\n01029|       const updatedProduct = {\n01030|         ...product,\n01031|         quantity: newQuantity,\n01032|         totalPrice: product.product.retailPrice * newQuantity,\n01033|         cargoIndexes: findCargoIndexesForProduct(updatedCargos, productId, addedAt)\n01034|       };\n01035|       \n01036|       const updatedProducts = selectedProducts.map((p, index) => \n01037|         index === productIndex ? updatedProduct : p\n01038|       );\n01039|       \n01040|       // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n01041|       const newDeclaredValue = calculateTotalValue(updatedProducts);\n01042|       \n01043|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n01044|       const cleanResult = cleanEmptyCargos(updatedCargos, updatedProducts);\n01045|       \n01046|       return {\n01047|         ...prev,\n01048|         cargos: cleanResult.cargos,\n01049|         selectedProducts: cleanResult.products,\n01050|         declaredValue: newDeclaredValue\n01051|       };\n01052|     });\n01053|     \n01054|     console.log(`üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ ${productId}: ${newQuantity} —à—Ç.`);\n01055|   };\n01056| \n01057|   const handleProductRemove = (productId: string, addedAt: number) => {\n01058|     setForm(prev => {\n01059|       console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ ${productId} (addedAt: ${addedAt})`);\n01060|       \n01061|       // –ù–∞—Ö–æ–¥–∏–º —Ç–æ–≤–∞—Ä –∏ –µ–≥–æ –∏–Ω–¥–µ–∫—Å—ã –≥—Ä—É–∑–æ–≤\n01062|       const selectedProducts = prev.selectedProducts || [];\n01063|       const product = selectedProducts.find(p => \n01064|         p.product.id === productId && p.addedAt === addedAt\n01065|       );\n01066|       \n01067|       if (!product) {\n01068|         console.log('–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω');\n01069|         return prev;\n01070|       }\n01071|       \n01072|       // –û—á–∏—â–∞–µ–º –≥—Ä—É–∑—ã —Ç–æ–≤–∞—Ä–∞ (–¥–µ–ª–∞–µ–º –∏—Ö –ø—É—Å—Ç—ã–º–∏ –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è)\n01073|       const updatedCargos = prev.cargos.map((cargo, index) => {\n01074|         if (product.cargoIndexes.includes(index)) {\n01075|           return {\n01076|             ...cargo,\n01077|             length: 0,\n01078|             width: 0,\n01079|             height: 0,\n01080|             weight: 0,\n01081|             productId: undefined,\n01082|             placeNumber: undefined,\n01083|             isFromProduct: undefined,\n01084|             addedAt: undefined\n01085|           };\n01086|         }\n01087|         return cargo;\n01088|       });\n01089|       \n01090|       // –£–¥–∞–ª—è–µ–º —Ç–æ–≤–∞—Ä –∏–∑ —Å–ø–∏—Å–∫–∞\n01091|       const updatedProducts = selectedProducts.filter(p => \n01092|         !(p.product.id === productId && p.addedAt === addedAt)\n01093|       );\n01094|       \n01095|       // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n01096|       const newDeclaredValue = calculateTotalValue(updatedProducts);\n01097|       \n01098|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n01099|       const cleanResult = cleanEmptyCargos(updatedCargos, updatedProducts);\n01100|       \n01101|       console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:', cleanResult.cargos.length);\n01102|       console.log('–£–¥–∞–ª–µ–Ω–æ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤:', updatedCargos.length - cleanResult.cargos.length);\n01103|       \n01104|       return {\n01105|         ...prev,\n01106|         cargos: cleanResult.cargos,\n01107|         selectedProducts: cleanResult.products,\n01108|         declaredValue: newDeclaredValue\n01109|       };\n01110|     });\n01111|     \n01112|     console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω —Ç–æ–≤–∞—Ä ${productId}`);\n01113|   };\n01114| \n01115|   // –ü–æ–ª—É—á–µ–Ω–∏–µ sessionID –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n01116|   const getDellinSessionId = async (): Promise<string | null> => {\n01117|     try {\n01118|       const authResponse = await fetch('https://api.dellin.ru/v3/auth/login.json', {\n01119|         method: 'POST',\n01120|         headers: {\n01121|           'Content-Type': 'application/json'\n01122|         },\n01123|         body: JSON.stringify({\n01124|           appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n01125|           login: 'service@lavsit.ru',\n01126|           password: 'edcwsx123QAZ'\n01127|         })\n01128|       });\n01129| \n01130|       const authData = await authResponse.json();\n01131|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ response.ok:', authResponse.ok);\n01132|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData:', authData);\n01133|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData.data:', authData.data);\n01134|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData.data?.sessionID:', authData.data?.sessionID);\n01135|       \n01136|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ –∫ sessionID\n01137|       let sessionID = null;\n01138|       \n01139|       if (authData.data?.sessionID) {\n01140|         sessionID = authData.data.sessionID;\n01141|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ data.sessionID:', sessionID);\n01142|       } else if (authData.sessionID) {\n01143|         sessionID = authData.sessionID;\n01144|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ sessionID:', sessionID);\n01145|       } else if (authData.data?.session) {\n01146|         sessionID = authData.data.session;\n01147|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ data.session:', sessionID);\n01148|       }\n01149|       \n01150|       if (authResponse.ok && sessionID) {\n01151|         return sessionID;\n01152|       } else {\n01153|         console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', authData);\n01154|         console.error('‚ùå –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', authResponse.status);\n01155|         console.error('‚ùå –¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞:', authResponse.statusText);\n01156|         return null;\n01157|       }\n01158|     } catch (error) {\n01159|       console.error('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', error);\n01160|     }\n01161|     return null;\n01162|   };\n01163| \n01164|   // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –≥–æ—Ä–æ–¥–æ–≤ –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n01165|   const loadDellinCities = async () => {\n01166|     try {\n01167|       const response = await fetch('/data/dellin-cities.json');\n01168|       if (!response.ok) {\n01169|         console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –≥–æ—Ä–æ–¥–æ–≤');\n01170|         return null;\n01171|       }\n01172|       const data = await response.json();\n01173|       return data.cities;\n01174|     } catch (error) {\n01175|       console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –≥–æ—Ä–æ–¥–æ–≤:', error);\n01176|       return null;\n01177|     }\n01178|   };\n01179| \n01180|   // –ü–æ–∏—Å–∫ cityID –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ\n01181|   const getCityIDFromLocal = async (cityName: string): Promise<string | null> => {\n01182|     const cities = await loadDellinCities();\n01183|     if (!cities) return null;\n01184| \n01185|     const normalizedSearch = cityName.toLowerCase().trim()\n01186|       .replace(/^–≥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥ \"\n01187|       .replace(/^–≥–æ—Ä–æ–¥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥–æ—Ä–æ–¥ \"\n01188|       .replace(/\\s+/g, ' '); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—Ä–æ–±–µ–ª—ã\n01189| \n01190|     console.log(`üîç –ü–æ–∏—Å–∫ cityID –¥–ª—è –≥–æ—Ä–æ–¥–∞: \"${normalizedSearch}\"`);\n01191| \n01192|     // –ü–æ–∏—Å–∫ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ\n01193|     for (const city of cities) {\n01194|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –∏–º–µ–Ω–µ–º –≥–æ—Ä–æ–¥–∞\n01195|       if (city.name.toLowerCase() === normalizedSearch) {\n01196|         console.log(`‚úÖ –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: \"${city.name}\" -> cityID: ${city.cityID}`);\n01197|         return city.cityID;\n01198|       }\n01199| \n01200|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –ø–æ–∏—Å–∫–æ–≤—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏\n01201|       for (const searchString of city.searchStrings) {\n01202|         if (searchString === normalizedSearch) {\n01203|           console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ –≤ –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫–∞—Ö: \"${searchString}\" –¥–ª—è –≥–æ—Ä–æ–¥–∞ \"${city.name}\" -> cityID: ${city.cityID}`);\n01204|           return city.cityID;\n01205|         }\n01206|       }\n01207|     }\n01208| \n01209|     console.warn(`‚ö†Ô∏è cityID –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –¥–ª—è –≥–æ—Ä–æ–¥–∞: \"${normalizedSearch}\"`);\n01210|     return null;\n01211|   };\n01212| \n01213|   // –ü–æ–ª—É—á–µ–Ω–∏–µ cityID —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n01214|   const findCityInDellinDirectory = async (cityName: string): Promise<{cityID: number, code: string} | null> => {\n01215|     try {\n01216|       console.log(`üîç –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –î–õ: ${cityName}`);\n01217|       \n01218|       // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞\n01219|       const normalizedCity = cityName.toLowerCase().trim()\n01220|         .replace(/^–≥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥ \"\n01221|         .replace(/^–≥–æ—Ä–æ–¥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥–æ—Ä–æ–¥ \"\n01222|         .replace(/\\s+/g, ' '); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—Ä–æ–±–µ–ª—ã\n01223|       \n01224|       // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞—Å–µ–ª–µ–Ω–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤\n01225|       const response = await fetch('https://api.dellin.ru/v2/public/kladr.json', {\n01226|         method: 'POST',\n01227|         headers: {\n01228|           'Content-Type': 'application/json'\n01229|         },\n01230|         body: JSON.stringify({\n01231|           appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n01232|           q: normalizedCity,\n01233|           limit: 10\n01234|         })\n01235|       });\n01236|       \n01237|       const data = await response.json();\n01238|       console.log(`üèôÔ∏è –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞ \"${normalizedCity}\" response:`, data);\n01239|       \n01240|       if (response.ok && data.cities && Array.isArray(data.cities) && data.cities.length > 0) {\n01241|         // –ò—â–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–ª–∏ –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –≥–æ—Ä–æ–¥\n01242|         let bestMatch = data.cities.find((city: any) => \n01243|           city.searchString?.toLowerCase() === normalizedCity ||\n01244|           city.aString?.toLowerCase().includes(normalizedCity)\n01245|         );\n01246|         \n01247|         // –ï—Å–ª–∏ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –Ω–µ—Ç, –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞–º–∏\n01248|         if (!bestMatch) {\n01249|           bestMatch = data.cities.find((city: any) => city.isTerminal === 1);\n01250|         }\n01251|         \n01252|         // –ï—Å–ª–∏ –∏ —ç—Ç–æ–≥–æ –Ω–µ—Ç, –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π\n01253|         if (!bestMatch) {\n01254|           bestMatch = data.cities[0];\n01255|         }\n01256|         \n01257|         if (bestMatch) {\n01258|           console.log(`‚úÖ –ù–∞–π–¥–µ–Ω –≥–æ—Ä–æ–¥:`, {\n01259|             cityID: bestMatch.cityID,\n01260|             name: bestMatch.aString,\n01261|             code: bestMatch.code,\n01262|             hasTerminals: bestMatch.isTerminal === 1\n01263|           });\n01264|           \n01265|           return {\n01266|             cityID: bestMatch.cityID,\n01267|             code: bestMatch.code\n01268|           };\n01269|         }\n01270|       }\n01271|       \n01272|       console.warn(`‚ö†Ô∏è –ì–æ—Ä–æ–¥ \"${normalizedCity}\" –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –î–õ`);\n01273|       return null;\n01274|       \n01275|     } catch (error) {\n01276|       console.error(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –≥–æ—Ä–æ–¥–∞ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –î–õ:`, error);\n01277|       return null;\n01278|     }\n01279|   };\n01280|   \n01281| \n01282|   \n01283|   // –ü–æ–∏—Å–∫ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ —Ä–∞–±–æ—á–∏–π v1 API (–∏–∑ test-dellin-terminals-simple.js)\n01284|   const getDellinTerminalByDirection = async (citySearch: string, direction: 'arrival' | 'derival'): Promise<string | null> => {\n01285|     try {\n01286|       console.log(`üîç –†–ê–ë–û–ß–ò–ô v1 API: –ü–æ–∏—Å–∫ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ ${direction} –¥–ª—è –≥–æ—Ä–æ–¥–∞: ${citySearch}`);\n01287|       \n01288|       // –ü–æ–ª—É—á–∞–µ–º sessionID –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞\n01289|       const sessionID = await getDellinSessionId();\n01290|       if (!sessionID) {\n01291|         console.error('‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç sessionID –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤');\n01292|         return null;\n01293|       }\n01294|       \n01295|       // –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ —Ä–∞–±–æ—á–µ–º—É API\n01296|       const requestData = {\n01297|         appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n01298|         sessionID: sessionID,\n01299|         search: citySearch,\n01300|         direction: direction\n01301|       };\n01302|       \n01303|       console.log(`üì§ –ó–∞–ø—Ä–æ—Å —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤:`, requestData);\n01304|       \n01305|       const response = await fetch('https://api.dellin.ru/v1/public/request_terminals.json', {\n01306|         method: 'POST',\n01307|         headers: {\n01308|           'Content-Type': 'application/json'\n01309|         },\n01310|         body: JSON.stringify(requestData)\n01311|       });\n01312|       \n01313|       const data = await response.json();\n01314|       console.log(`üì• –û—Ç–≤–µ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ (${response.status}):`, data);\n01315|       \n01316|       if (!response.ok) {\n01317|         console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤:', data);\n01318|         return null;\n01319|       }\n01320|       \n01321|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –≤ –æ—Ç–≤–µ—Ç–µ\n01322|       const terminals = data.terminals || [];\n01323|       if (terminals.length === 0) {\n01324|         console.warn(`‚ö†Ô∏è –¢–µ—Ä–º–∏–Ω–∞–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è –≥–æ—Ä–æ–¥–∞ \"${citySearch}\"`);\n01325|         return null;\n01326|       }\n01327|       \n01328|       // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª\n01329|       const selectedTerminal = terminals[0];\n01330|       \n01331|       console.log(`‚úÖ –ù–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª ${direction}:`, {\n01332|         id: selectedTerminal.id,\n01333|         name: selectedTerminal.name,\n01334|         address: selectedTerminal.address\n01335|       });\n01336|       \n01337|       return selectedTerminal.id.toString();\n01338|       \n01339|     } catch (error) {\n01340|       console.error(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ ${direction} (v1 API):`, error);\n01341|       return null;\n01342|     }\n01343|   };\n01344| \n01345|   // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ –¥–ª—è –≥–æ—Ä–æ–¥–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º)\n01346|   const getDellinTerminal = async (citySearch: string): Promise<string | null> => {\n01347|     return getDellinTerminalByDirection(citySearch, 'arrival');\n01348|   };\n01349|   \n01350|   // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ DaData –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n01351|   const normalizeAddressForDellin = async (address: string): Promise<string> => {\n01352|     try {\n01353|       console.log(`üåê –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ DaData: ${address}`);\n01354|       \n01355|       const response = await fetch('/api/dadata', {\n01356|         method: 'POST',\n01357|         headers: {\n01358|           'Content-Type': 'application/json'\n01359|         },\n01360|         body: JSON.stringify({\n01361|           address: address,\n01362|           type: 'clean'\n01363|         })\n01364|       });\n01365|       \n01366|       const data = await response.json();\n01367|       console.log(`üåê DaData response:`, data);\n01368|       \n01369|       if (data.success && data.data?.dellinFormat) {\n01370|         console.log(`‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å: ${data.data.dellinFormat}`);\n01371|         return data.data.dellinFormat;\n01372|       }\n01373|       \n01374|       // –ï—Å–ª–∏ DaData –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∞–¥—Ä–µ—Å\n01375|       console.warn(`‚ö†Ô∏è DaData –Ω–µ —Å–º–æ–≥ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π`);\n01376|       return address;\n01377|       \n01378|     } catch (error) {\n01379|       console.error(`‚ùå –û—à–∏–±–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ DaData:`, error);\n01380|       return address; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∞–¥—Ä–µ—Å –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏\n01381|     }\n01382|   };\n01383| \n01384|   // –ü–æ–ª—É—á–µ–Ω–∏–µ UID —É–ø–∞–∫–æ–≤–∫–∏ —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π workflow —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –î–õ\n01385|   const getDellinPackageUid = async (packageName: string = 'crate_with_bubble'): Promise<string | null> => {\n01386|     try {\n01387|       console.log(`üì¶ CSV WORKFLOW: –ü–æ–ª—É—á–µ–Ω–∏–µ UID —É–ø–∞–∫–æ–≤–∫–∏ \"${packageName}\" —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π workflow...`);\n01388|       console.log('üì¶ CSV WORKFLOW: API –î–õ ‚Üí CSV —Å—Å—ã–ª–∫–∞ ‚Üí —Å–∫–∞—á–∞—Ç—å CSV ‚Üí –ø–∞—Ä—Å–∏—Ç—å ‚Üí –ø–æ–ª—É—á–∏—Ç—å UID');\n01389|       \n01390|       const response = await fetch('/api/dellin-packages', {\n01391|         method: 'GET',\n01392|         headers: {\n01393|           'Content-Type': 'application/json'\n01394|         }\n01395|       });\n01396| \n01397|       const data = await response.json();\n01398|       console.log('üì¶ CSV WORKFLOW response.ok:', response.ok);\n01399|       console.log('üì¶ CSV WORKFLOW status:', response.status);\n01400|       console.log('üì¶ CSV WORKFLOW workflow info:', data.workflow || 'not specified');\n01401|       \n01402|       if (response.ok && data.success && data.data && Array.isArray(data.data)) {\n01403|         console.log('üì¶ CSV WORKFLOW: —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫');\n01404|         console.log('üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–ø–∞–∫–æ–≤–æ–∫ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ:', data.data.length);\n01405|         console.log('üì¶ –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:', data.cached ? '–∫—ç—à (24—á)' : '—Å–≤–µ–∂–∏–π CSV —Ñ–∞–π–ª');\n01406|         if (data.csvUrl) {\n01407|           console.log('üì¶ CSV URL:', data.csvUrl);\n01408|         }\n01409|         \n01410|         // –ü–æ–∏—Å–∫ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –≤–∞—Ä–∏–∞–Ω—Ç–∞–º –Ω–∞–∑–≤–∞–Ω–∏—è\n01411|         const searchTerms = [\n01412|           packageName,\n01413|           '–æ–±—Ä–µ—à–µ—Ç–∫–∞',\n01414|           '–æ–±—Ä–µ—à—ë—Ç–∫–∞',\n01415|           '–∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è',\n01416|           'bubble',\n01417|           '–∑–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞'\n01418|         ];\n01419|         \n01420|         let foundPackage: any = null;\n01421|         \n01422|         for (const term of searchTerms) {\n01423|           foundPackage = data.data.find((pkg: any) => \n01424|             pkg.name && pkg.name.toLowerCase().includes(term.toLowerCase())\n01425|           );\n01426|           \n01427|           if (foundPackage) {\n01428|             console.log(`‚úÖ CSV WORKFLOW: –ù–∞–π–¥–µ–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∞ –ø–æ —Ç–µ—Ä–º–∏–Ω—É \"${term}\": ${foundPackage.name} ‚Üí ${foundPackage.uid}`);\n01429|             break;\n01430|           }\n01431|         }\n01432|         \n01433|         if (foundPackage && foundPackage.uid) {\n01434|           return foundPackage.uid;\n01435|         } else {\n01436|           console.log('‚ùå CSV WORKFLOW: –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –ø–æ –ø–æ–∏—Å–∫–æ–≤—ã–º —Ç–µ—Ä–º–∏–Ω–∞–º');\n01437|           \n01438|           // –í—ã–≤–æ–¥–∏–º –ø–µ—Ä–≤—ã–µ 10 —É–ø–∞–∫–æ–≤–æ–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n01439|           console.log('üì¶ –î–æ—Å—Ç—É–ø–Ω—ã–µ —É–ø–∞–∫–æ–≤–∫–∏ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ (–ø–µ—Ä–≤—ã–µ 10):');\n01440|           data.data.slice(0, 10).forEach((pkg: any, index: number) => {\n01441|             console.log(`  ${index + 1}. ${pkg.name} (${pkg.uid})`);\n01442|           });\n01443|         }\n01444|       } else {\n01445|         console.error('‚ùå CSV WORKFLOW: –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞:', data);\n01446|       }\n01447|       \n01448|       return null;\n01449|         \n01450|     } catch (error) {\n01451|       console.error('‚ùå CSV WORKFLOW: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', error);\n01452|       return null;\n01453|     }\n01454|   };\n01455| \n01456|   // –†–∞—Å—á–µ—Ç –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π —á–µ—Ä–µ–∑ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π API v2/calculator.json —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n01457|   const calculateDellin = async (): Promise<CalculationResult> => {\n01458|     const { enhancedApiRequest } = await import('@/lib/api-utils');\n01459|     const apiUrl = 'https://api.dellin.ru/v2/calculator.json';\n01460|     const maxRetries = 2;\n01461|     \n01462|     console.log('üöÄ === –ù–ê–ß–ê–õ–û –†–ê–°–ß–ï–¢–ê –î–ï–õ–û–í–´–• –õ–ò–ù–ò–ô ===');\n01463|     console.log('üöÄ API URL:', apiUrl);\n01464|     \n01465|     try {\n01466|       let sessionID = await getDellinSessionId();\n01467|       \n01468|       if (!sessionID) {\n01469|         return {\n01470|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01471|           price: 0,\n01472|           days: 0,\n01473|           error: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å sessionID',\n01474|           apiUrl,\n01475|           requestData: null,\n01476|           responseData: null\n01477|         };\n01478|       }\n01479| \n01480|       // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏ –æ–±—ä–µ–º—ã\n01481|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n01482|       const totalVolume = form.cargos.reduce((sum, cargo) => \n01483|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n01484|       );\n01485|       const maxLength = Math.max(...form.cargos.map(c => c.length)) / 100; // –≤ –º–µ—Ç—Ä–∞—Ö\n01486|       const maxWidth = Math.max(...form.cargos.map(c => c.width)) / 100;\n01487|       const maxHeight = Math.max(...form.cargos.map(c => c.height)) / 100;\n01488| \n01489|       // –ü–æ–ª—É—á–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª—ã –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∞–¥—Ä–µ—Å–∞\n01490|       let fromTerminalId: string | null = null;\n01491|       let toTerminalId: string | null = null;\n01492|       let normalizedFromAddress: string | null = null;\n01493|       let normalizedToAddress: string | null = null;\n01494|       \n01495|       // –î–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ–ª—É—á–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª—ã\n01496|       if (!form.fromAddressDelivery) {\n01497|         fromTerminalId = await getDellinTerminalByDirection(form.fromCity, 'derival');\n01498|       } else {\n01499|         // –î–ª—è –∞–¥—Ä–µ—Å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∞–¥—Ä–µ—Å\n01500|         const addressToNormalize = form.fromAddress || form.fromCity;\n01501|         normalizedFromAddress = await normalizeAddressForDellin(addressToNormalize);\n01502|       }\n01503|       \n01504|       if (!form.toAddressDelivery) {\n01505|         toTerminalId = await getDellinTerminalByDirection(form.toCity, 'arrival');\n01506|       } else {\n01507|         // –î–ª—è –∞–¥—Ä–µ—Å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∞–¥—Ä–µ—Å\n01508|         const addressToNormalize = form.toAddress || form.toCity;\n01509|         normalizedToAddress = await normalizeAddressForDellin(addressToNormalize);\n01510|       }\n01511|       \n01512|       console.log('üè¢ –î–ê–ù–ù–´–ï –î–õ:');\n01513|       console.log('üè¢ form.fromAddressDelivery:', form.fromAddressDelivery);\n01514|       console.log('üè¢ form.toAddressDelivery:', form.toAddressDelivery);\n01515|       console.log('üè¢ fromTerminalId:', fromTerminalId);\n01516|       console.log('üè¢ toTerminalId:', toTerminalId);\n01517|       console.log('üè¢ normalizedFromAddress:', normalizedFromAddress);\n01518|       console.log('üè¢ normalizedToAddress:', normalizedToAddress);\n01519|       \n01520|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã –Ω–∞–π–¥–µ–Ω—ã –¢–û–õ–¨–ö–û –¥–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏\n01521|       if (!form.fromAddressDelivery && !fromTerminalId) {\n01522|         console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –≥–æ—Ä–æ–¥–∞:', form.fromCity);\n01523|         return {\n01524|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01525|           price: 0,\n01526|           days: 0,\n01527|           error: `–ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π –≤ –≥–æ—Ä–æ–¥–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è: ${form.fromCity}`,\n01528|           apiUrl,\n01529|           requestData: null,\n01530|           responseData: null\n01531|         };\n01532|       }\n01533|       \n01534|       if (!form.toAddressDelivery && !toTerminalId) {\n01535|         console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≥–æ—Ä–æ–¥–∞:', form.toCity);\n01536|         return {\n01537|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01538|           price: 0,\n01539|           days: 0,\n01540|           error: `–ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π –≤ –≥–æ—Ä–æ–¥–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: ${form.toCity}`,\n01541|           apiUrl,\n01542|           requestData: null,\n01543|           responseData: null\n01544|         };\n01545|       }\n01546|       \n01547|       // –î–ª—è –∞–¥—Ä–µ—Å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∞–¥—Ä–µ—Å–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã\n01548|       if (form.fromAddressDelivery && !normalizedFromAddress) {\n01549|         console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è:', form.fromAddress || form.fromCity);\n01550|         return {\n01551|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01552|           price: 0,\n01553|           days: 0,\n01554|           error: `–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è: ${form.fromAddress || form.fromCity}`,\n01555|           apiUrl,\n01556|           requestData: null,\n01557|           responseData: null\n01558|         };\n01559|       }\n01560|       \n01561|       if (form.toAddressDelivery && !normalizedToAddress) {\n01562|         console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:', form.toAddress || form.toCity);\n01563|         return {\n01564|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01565|           price: 0,\n01566|           days: 0,\n01567|           error: `–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: ${form.toAddress || form.toCity}`,\n01568|           apiUrl,\n01569|           requestData: null,\n01570|           responseData: null\n01571|         };\n01572|       }\n01573| \n01574|       // –ü–æ–ª—É—á–∞–µ–º UID —É–ø–∞–∫–æ–≤–∫–∏ crate_with_bubble (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∞)\n01575|       let packageUid: string | null = null;\n01576|       console.log('=== –ù–ê–ß–ê–õ–û –û–¢–õ–ê–î–ö–ò –£–ü–ê–ö–û–í–ö–ò ===');\n01577|       console.log('üîç –û–¢–õ–ê–î–ö–ê –£–ü–ê–ö–û–í–ö–ò: form.needPackaging =', form.needPackaging);\n01578|       console.log('üîç –û–¢–õ–ê–î–ö–ê –£–ü–ê–ö–û–í–ö–ò: typeof form.needPackaging =', typeof form.needPackaging);\n01579|       \n01580|       if (form.needPackaging) {\n01581|         console.log('üîç ‚úÖ –£–ü–ê–ö–û–í–ö–ê –¢–†–ï–ë–£–ï–¢–°–Ø - –ó–ê–ü–†–ê–®–ò–í–ê–ï–ú UID —á–µ—Ä–µ–∑ CSV WORKFLOW...');\n01582|         try {\n01583|           packageUid = await getDellinPackageUid('crate_with_bubble');\n01584|           console.log('üîç ‚úÖ –ü–û–õ–£–ß–ï–ù packageUid –∏–∑ CSV WORKFLOW:', packageUid);\n01585|           \n01586|           // –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ UID –∏–∑ CSV, –∏—Å–ø–æ–ª—å–∑—É–µ–º UID —Å —Å–∞–π—Ç–∞ –î–õ (–∏—Å–ø—Ä–∞–≤–ª—è–µ–º —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ 500‚ÇΩ)\n01587|           if (!packageUid) {\n01588|             packageUid = '0x9dd8901b0ecef10c11e8ed001199bf6e'; // UID —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ –î–õ\n01589|             console.log('üîç üß™ –ò–°–ü–û–õ–¨–ó–£–ï–ú UID –° –°–ê–ô–¢–ê –î–õ (–∏—Å–ø—Ä–∞–≤–ª—è–µ–º —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ):', packageUid);\n01590|           }\n01591|           \n01592|           console.log('üîç ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô packageUid:', packageUid);\n01593|           console.log('üîç ‚úÖ typeof packageUid:', typeof packageUid);\n01594|           console.log('üîç ‚úÖ packageUid truthy:', !!packageUid);\n01595|         } catch (error) {\n01596|           console.log('üîç ‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ packageUid —á–µ—Ä–µ–∑ CSV WORKFLOW:', error);\n01597|           // –ò—Å–ø–æ–ª—å–∑—É–µ–º UID —Å —Å–∞–π—Ç–∞ –î–õ –∫–∞–∫ fallback (–∏—Å–ø—Ä–∞–≤–ª—è–µ–º —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ)\n01598|           packageUid = '0x9dd8901b0ecef10c11e8ed001199bf6e'; // UID —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ –î–õ\n01599|           console.log('üîç üß™ –ò–°–ü–û–õ–¨–ó–£–ï–ú UID –° –°–ê–ô–¢–ê –î–õ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ (–∏—Å–ø—Ä–∞–≤–ª—è–µ–º —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ):', packageUid);\n01600|         }\n01601|       } else {\n01602|         console.log('üîç ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ UID');\n01603|       }\n01604|       console.log('=== –ö–û–ù–ï–¶ –û–¢–õ–ê–î–ö–ò –£–ü–ê–ö–û–í–ö–ò ===');\n01605| \n01606|       // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞—Ç—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞\n01607|       const tomorrow = new Date();\n01608|       tomorrow.setDate(tomorrow.getDate() + 1);\n01609|       const produceDate = tomorrow.toISOString().split('T')[0];\n01610| \n01611|       // –û—Ç–ª–∞–¥–∫–∞ –ø–µ—Ä–µ–¥ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–∞\n01612|       console.log('=== –û–¢–õ–ê–î–ö–ê –§–û–†–ú–ò–†–û–í–ê–ù–ò–Ø –ó–ê–ü–†–û–°–ê ===');\n01613|       console.log('üîç form.needPackaging =', form.needPackaging, '(—Ç–∏–ø:', typeof form.needPackaging, ')');\n01614|       console.log('üîç packageUid =', packageUid, '(—Ç–∏–ø:', typeof packageUid, ')');\n01615|       console.log('üîç packageUid truthy =', !!packageUid);\n01616|       console.log('üîç –£—Å–ª–æ–≤–∏–µ (form.needPackaging && packageUid) =', form.needPackaging && packageUid);\n01617|       \n01618|       if (form.needPackaging && packageUid) {\n01619|         console.log('‚úÖ PACKAGES –ë–£–î–ï–¢ –î–û–ë–ê–í–õ–ï–ù –í –ó–ê–ü–†–û–°!');\n01620|       } else {\n01621|         console.log('‚ùå PACKAGES –ù–ï –ë–£–î–ï–¢ –î–û–ë–ê–í–õ–ï–ù:');\n01622|         if (!form.needPackaging) console.log('  - form.needPackaging = false');\n01623|         if (!packageUid) console.log('  - packageUid –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç/null');\n01624|       }\n01625| \n01626|       // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n01627|       const requestData = {\n01628|         appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n01629|         sessionID: sessionID,\n01630|         delivery: {\n01631|           deliveryType: {\n01632|             type: 'auto'  // –í—Å–µ–≥–¥–∞ \"auto\" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n01633|           },\n01634|           derival: {\n01635|             produceDate: produceDate,  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –¥–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n01636|             variant: form.fromAddressDelivery ? 'address' : 'terminal',\n01637|             ...(form.fromAddressDelivery ? {\n01638|               address: {\n01639|                 search: normalizedFromAddress || form.fromAddress || form.fromCity\n01640|               }\n01641|             } : {\n01642|               terminalID: fromTerminalId\n01643|             }),\n01644|             time: {\n01645|               worktimeStart: '10:00',\n01646|               worktimeEnd: '18:00',\n01647|               breakStart: '13:00',\n01648|               breakEnd: '14:00',\n01649|               exactTime: false\n01650|             }\n01651|             // handling –≤ derival –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n01652|           },\n01653|           arrival: {\n01654|             variant: form.toAddressDelivery ? 'address' : 'terminal',\n01655|             ...(form.toAddressDelivery ? {\n01656|               address: {\n01657|                 search: normalizedToAddress || form.toAddress || form.toCity\n01658|               }\n01659|             } : {\n01660|               terminalID: toTerminalId\n01661|             }),\n01662|             time: {\n01663|               worktimeStart: '10:00',\n01664|               worktimeEnd: '18:00',\n01665|               breakStart: '13:00',\n01666|               breakEnd: '14:00',\n01667|               exactTime: false\n01668|             },\n01669|             // handling –≤ arrival –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—ä–µ–º\n01670|             ...(form.needCarry ? {\n01671|               handling: {\n01672|                 freightLift: form.hasFreightLift, // true —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –≥–∞–ª–æ—á–∫–∞ \"–Ω–∞–ª–∏—á–∏–µ –≥—Ä—É–∑–æ–≤–æ–≥–æ –ª–∏—Ñ—Ç–∞\"\n01673|                 toFloor: form.floor, // —ç—Ç–∞–∂ –∏–∑ —Ñ–æ—Ä–º—ã\n01674|                 carry: 0\n01675|               }\n01676|             } : {})\n01677|           },\n01678|           ...(form.needPackaging && packageUid ? {\n01679|             packages: [{\n01680|               uid: packageUid,  // UID —É–ø–∞–∫–æ–≤–∫–∏ crate_with_bubble –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞\n01681|               count: 1  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1\n01682|             }]\n01683|           } : {})\n01684|         },\n01685|         cargo: {\n01686|           quantity: form.cargos.length,\n01687|           length: maxLength,\n01688|           width: maxWidth,\n01689|           height: maxHeight,\n01690|           weight: totalWeight,\n01691|           totalVolume: totalVolume,\n01692|           totalWeight: totalWeight,\n01693|           oversizedWeight: 0,\n01694|           oversizedVolume: 0,\n01695|           hazardClass: 0,  // –í—Å–µ–≥–¥–∞ 0 –µ—Å–ª–∏ –Ω–µ—Ç –æ–ø–∞—Å–Ω—ã—Ö –≥—Ä—É–∑–æ–≤\n01696|           ...(form.needInsurance && form.declaredValue > 0 ? {\n01697|             insurance: {\n01698|               statedValue: form.declaredValue,\n01699|               term: true  // –í—Å–µ–≥–¥–∞ true –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è\n01700|             }\n01701|           } : {})\n01702|         },\n01703|         payment: {\n01704|           type: 'noncash',  // –í—Å–µ–≥–¥–∞ \"noncash\"\n01705|           paymentCitySearch: {\n01706|             search: form.fromCity  // –ì–æ—Ä–æ–¥ –æ–ø–ª–∞—Ç—ã\n01707|           }\n01708|         }\n01709|       };\n01710| \n01711|       console.log('üöÄ –ò–¢–û–ì–û–í–´–ô –ó–ê–ü–†–û–° –ö –î–õ:', JSON.stringify(requestData, null, 2));\n01712|       \n01713|       // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∞ packages\n01714|       if (requestData.delivery.packages) {\n01715|         console.log('‚úÖ PACKAGES –ù–ê–ô–î–ï–ù –í –ó–ê–ü–†–û–°–ï:', requestData.delivery.packages);\n01716|       } else {\n01717|         console.log('‚ùå PACKAGES –ù–ï –ù–ê–ô–î–ï–ù –í –ó–ê–ü–†–û–°–ï');\n01718|         console.log('   form.needPackaging =', form.needPackaging);\n01719|         console.log('   packageUid =', packageUid);\n01720|         console.log('   –£—Å–ª–æ–≤–∏–µ:', form.needPackaging && packageUid);\n01721|       }\n01722| \n01723|       // –ü–æ–ø—ã—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö\n01724|       let response: any = null;\n01725|       let data: any = null;\n01726|       \n01727|       for (let attempt = 1; attempt <= maxRetries; attempt++) {\n01728|         console.log(`üîÑ –î–õ: –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ ${attempt}/${maxRetries}`);\n01729|         \n01730|         response = await fetch(apiUrl, {\n01731|           method: 'POST',\n01732|           headers: {\n01733|             'Content-Type': 'application/json',\n01734|             'Accept': 'application/json'\n01735|           },\n01736|           body: JSON.stringify(requestData)\n01737|         });\n01738| \n01739|         try {\n01740|           data = await response.json();\n01741|         } catch (parseError) {\n01742|           console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –æ—Ç–≤–µ—Ç–∞ –î–õ:', parseError);\n01743|           throw new Error(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ API: ${parseError instanceof Error ? parseError.message : '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);\n01744|         }\n01745|         \n01746|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ response.ok:', response.ok);\n01747|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ status:', response.status);\n01748|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ data:', data);\n01749|         \n01750|         // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\n01751|         const isAuthError = response.status === 401 || \n01752|                            response.status === 403 ||\n01753|                            (response.status === 400 && data?.errors?.some((err: any) => \n01754|                              err.detail?.toLowerCase()?.includes('session') ||\n01755|                              err.detail?.toLowerCase()?.includes('auth') ||\n01756|                              err.detail?.toLowerCase()?.includes('invalid')\n01757|                            ));\n01758| \n01759|         if (isAuthError && attempt < maxRetries) {\n01760|           console.log('üîÑ –î–õ: –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –≤—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...');\n01761|           const newSessionId = await getDellinSessionId();\n01762|           if (newSessionId) {\n01763|             console.log('‚úÖ –î–õ: –ø–æ–ª—É—á–µ–Ω –Ω–æ–≤—ã–π SessionID, –æ–±–Ω–æ–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å...');\n01764|             // –û–±–Ω–æ–≤–ª—è–µ–º sessionID –≤ –∑–∞–ø—Ä–æ—Å–µ\n01765|             requestData.sessionID = newSessionId;\n01766|             sessionID = newSessionId;\n01767|             continue; // –ü—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —Å –Ω–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n01768|           } else {\n01769|             console.error('‚ùå –î–õ: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π SessionID');\n01770|             break;\n01771|           }\n01772|         }\n01773|         \n01774|         if (response.status === 400 && data?.errors) {\n01775|           console.log('=== –ê–ù–ê–õ–ò–ó –û–®–ò–ë–ö–ò 400 ===');\n01776|           console.log('üîç –û—à–∏–±–∫–∏:', data.errors);\n01777|           data.errors.forEach((error: any, index: number) => {\n01778|             console.log(`üîç –û—à–∏–±–∫–∞ ${index + 1}:`, error);\n01779|             console.log(`   - –ü–æ–ª–µ: ${error.field || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`);\n01780|             console.log(`   - –°–æ–æ–±—â–µ–Ω–∏–µ: ${error.detail || error.message || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`);\n01781|           });\n01782|           console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –û–®–ò–ë–ö–ò 400 ===');\n01783|         }\n01784| \n01785|         // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–Ω—ã–π –∏–ª–∏ –Ω–µ —Å–≤—è–∑–∞–Ω —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É\n01786|         break;\n01787|       }\n01788| \n01789|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –æ—à–∏–±–∫–∏ –ü–ï–†–ï–î –∞–Ω–∞–ª–∏–∑–æ–º –¥–∞–Ω–Ω—ã—Ö\n01790|       if (!response.ok || !data.data) {\n01791|         console.log('‚ùå –û—à–∏–±–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç API - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö');\n01792|         const errorMessage = data.metadata?.detail || \n01793|                            data.metadata?.message || \n01794|                            data.errors?.[0]?.detail || \n01795|                            (data.metadata?.status !== 200 ? `HTTP ${data.metadata?.status}` : '') ||\n01796|                            `HTTP ${response.status} - ${response.statusText}` ||\n01797|                            '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏';\n01798|         return {\n01799|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01800|           price: 0,\n01801|           days: 0,\n01802|           error: errorMessage,\n01803|           requestData,\n01804|           responseData: data,\n01805|           apiUrl,\n01806|           sessionId: sessionID\n01807|         };\n01808|       }\n01809|       \n01810|       // –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –°–¢–†–ê–•–û–í–ö–ò (—Ç–æ–ª—å–∫–æ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞)\n01811|       console.log('=== –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –°–¢–†–ê–•–û–í–ö–ò ===');\n01812|       console.log('üîç –ü–†–û–í–ï–†–ö–ê –°–¢–†–£–ö–¢–£–†–´ –î–ê–ù–ù–´–•:');\n01813|       console.log('üîç data:', data ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n01814|       console.log('üîç typeof data:', typeof data);\n01815|       console.log('üîç data.data:', data?.data ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n01816|       console.log('üîç typeof data.data:', typeof data?.data);\n01817|       \n01818|       // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–π—Å—Ç–≤ data.data\n01819|       if (data?.data) {\n01820|         console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤–æ–π—Å—Ç–≤–∞ data.data:');\n01821|         console.log('üîç data.data.derival:', typeof data.data.derival, data.data.derival);\n01822|         console.log('üîç data.data.arrival:', typeof data.data.arrival, data.data.arrival);\n01823|         console.log('üîç data.data.intercity:', typeof data.data.intercity, data.data.intercity);\n01824|       }\n01825|       \n01826|       if (!data) {\n01827|         console.error('‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: data undefined/null');\n01828|         return {\n01829|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01830|           price: 0,\n01831|           days: 0,\n01832|           error: '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ API: –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã',\n01833|           apiUrl,\n01834|           requestData,\n01835|           responseData: null\n01836|         };\n01837|       }\n01838|       \n01839|       try {\n01840|         console.log('üîç –ü–û–õ–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê data.data:', JSON.stringify(data.data, null, 2));\n01841|       } catch (jsonError) {\n01842|         console.error('‚ùå –û—à–∏–±–∫–∞ JSON.stringify –¥–ª—è data.data:', jsonError);\n01843|         console.log('üîç data.data (toString):', data.data?.toString?.() || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å');\n01844|       }\n01845|       \n01846|       // –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç—Ä–∞—Ö–æ–≤–∫–æ–π\n01847|       console.log('üí≥ –ü–û–ò–°–ö –ö–û–ú–ü–û–ù–ï–ù–¢–û–í –°–¢–†–ê–•–û–í–ö–ò:');\n01848|       console.log('üí≥ data.data.insurance:', data.data?.insurance);\n01849|       console.log('üí≥ data.data.cargoInsurance:', data.data?.cargoInsurance);\n01850|       console.log('üí≥ data.data.termInsurance:', data.data?.termInsurance);\n01851|       console.log('üí≥ data.data.insuranceDetails:', data.data?.insuranceDetails);\n01852|       console.log('üí≥ data.data.services:', data.data?.services);\n01853|       console.log('üí≥ data.data.additionalServices:', data.data?.additionalServices);\n01854|       \n01855|       // –ü–æ–∏—Å–∫ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏ –≤ –¥—Ä—É–≥–∏—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö\n01856|       try {\n01857|         console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º derival...');\n01858|         if (data.data?.derival) {\n01859|           console.log('üí≥ derival –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n01860|           console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –ó–ê–ë–û–ï data.data.derival.insurance:', data.data.derival?.insurance);\n01861|         } else {\n01862|           console.log('üí≥ derival –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n01863|         }\n01864|         \n01865|         console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º arrival...');\n01866|         if (data.data?.arrival) {\n01867|           console.log('üí≥ arrival –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n01868|           console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –î–û–°–¢–ê–í–ö–ï data.data.arrival.insurance:', data.data.arrival?.insurance);\n01869|         } else {\n01870|           console.log('üí≥ arrival –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n01871|         }\n01872|         \n01873|         console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º intercity...');\n01874|         if (data.data?.intercity) {\n01875|           console.log('üí≥ intercity –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n01876|           console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –ü–ï–†–ï–í–û–ó–ö–ï data.data.intercity.insurance:', data.data.intercity?.insurance);\n01877|         } else {\n01878|           console.log('üí≥ intercity –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n01879|         }\n01880|       } catch (error) {\n01881|         console.error('‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–µ–∫—Ü–∏–π —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏:', error);\n01882|         console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', error instanceof Error ? error.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n01883|       }\n01884|       \n01885|       // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö \"insurance\"\n01886|       const findInsuranceFields = (obj: any, path = '') => {\n01887|         if (typeof obj !== 'object' || obj === null || obj === undefined) return;\n01888|         \n01889|         try {\n01890|           Object.keys(obj).forEach(key => {\n01891|             const fullPath = path ? `${path}.${key}` : key;\n01892|             if (key.toLowerCase().includes('insurance') || key.toLowerCase().includes('insur')) {\n01893|               console.log(`üí≥ –ù–ê–ô–î–ï–ù–û –ü–û–õ–ï –°–¢–†–ê–•–û–í–ö–ò [${fullPath}]:`, obj[key]);\n01894|             }\n01895|             if (typeof obj[key] === 'object' && obj[key] !== null && obj[key] !== undefined) {\n01896|               findInsuranceFields(obj[key], fullPath);\n01897|             }\n01898|           });\n01899|         } catch (error) {\n01900|           console.error(`üí≥ –û—à–∏–±–∫–∞ –≤ findInsuranceFields –¥–ª—è –ø—É—Ç–∏ ${path}:`, error);\n01901|         }\n01902|       };\n01903|       \n01904|       console.log('üí≥ –†–ï–ö–£–†–°–ò–í–ù–´–ô –ü–û–ò–°–ö –ü–û–õ–ï–ô –°–¢–†–ê–•–û–í–ö–ò:');\n01905|       try {\n01906|         if (data && data.data) {\n01907|           findInsuranceFields(data.data, 'data.data');\n01908|         } else {\n01909|           console.log('üí≥ –ü—Ä–æ–ø—É—Å–∫ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞: data.data –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');\n01910|         }\n01911|       } catch (error) {\n01912|         console.error('‚ùå –û–®–ò–ë–ö–ê –≤ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–º –ø–æ–∏—Å–∫–µ:', error);\n01913|         console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', error instanceof Error ? error.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n01914|       }\n01915|       console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –°–¢–†–ê–•–û–í–ö–ò ===');\n01916|       \n01917|       // –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ packages –≤ –æ—Ç–≤–µ—Ç–µ\n01918|       console.log('=== –ü–û–ò–°–ö PACKAGES –í –û–¢–í–ï–¢–ï ===');\n01919|       console.log('üì¶ data.data =', data.data);\n01920|       console.log('üì¶ data.data.packages =', data.data?.packages);\n01921|       console.log('üì¶ –¢–∏–ø data.data.packages:', typeof data.data?.packages);\n01922|       if (data.data?.packages) {\n01923|         console.log('‚úÖ PACKAGES –ù–ê–ô–î–ï–ù –í –û–¢–í–ï–¢–ï!');\n01924|         try {\n01925|           console.log('üì¶ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ packages:', JSON.stringify(data.data.packages, null, 2));\n01926|         } catch (jsonError) {\n01927|           console.error('‚ùå –û—à–∏–±–∫–∞ JSON.stringify –¥–ª—è packages:', jsonError);\n01928|           console.log('üì¶ packages (toString):', data.data.packages?.toString?.() || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å');\n01929|         }\n01930|       } else {\n01931|         console.log('‚ùå PACKAGES –ù–ï –ù–ê–ô–î–ï–ù –í –û–¢–í–ï–¢–ï');\n01932|       }\n01933|       console.log('=== –ö–û–ù–ï–¶ –ü–û–ò–°–ö–ê PACKAGES ===');\n01934| \n01935|       if (response.ok && data.data && data.metadata?.status === 200) {\n01936|         let totalPrice = data.data.price || 0;\n01937|         console.log('üí∞ –†–ê–°–ß–ï–¢ –ò–¢–û–ì–û–í–û–ô –°–¢–û–ò–ú–û–°–¢–ò:');\n01938|         console.log('üí∞ –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å data.data.price (–£–ñ–ï –í–ö–õ–Æ–ß–ê–ï–¢ –í–°–ï):', totalPrice);\n01939|         \n01940|         // –°–¢–†–ê–•–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n01941|         if (data.data.insurance) {\n01942|           console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ data.data.insurance (–£–ñ–ï –≤–∫–ª—é—á–µ–Ω–∞ –≤ –±–∞–∑–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):', data.data.insurance);\n01943|           console.log('üí∞ –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞—Ö–æ–≤–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ');\n01944|         } else {\n01945|           console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–≤–µ—Ç–µ');\n01946|         }\n01947|         \n01948|         // –£–ü–ê–ö–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n01949|         console.log('üí∞ –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–ë –£–ü–ê–ö–û–í–ö–ï (–£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –í –û–°–ù–û–í–ù–£–Æ –°–¢–û–ò–ú–û–°–¢–¨):');\n01950|         console.log('üí∞ data.data.packages =', data.data.packages);\n01951|         console.log('üí∞ form.needPackaging =', form.needPackaging);\n01952|         \n01953|         if (data.data.packages && form.needPackaging) {\n01954|           console.log('üí∞ ‚úÖ –£–ü–ê–ö–û–í–ö–ê –ü–†–ò–°–£–¢–°–¢–í–£–ï–¢ –í –û–¢–í–ï–¢–ï (—Ü–µ–Ω–∞ —É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ data.data.price)');\n01955|           console.log('üí∞ –¢–∏–ø packages:', Array.isArray(data.data.packages) ? 'Array' : 'Object');\n01956|           \n01957|           if (Array.isArray(data.data.packages)) {\n01958|             data.data.packages.forEach((pkg: any, index: number) => {\n01959|               console.log(`üí∞ Package [${index}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n01960|             });\n01961|           } else {\n01962|             Object.entries(data.data.packages).forEach(([key, pkg]: [string, any]) => {\n01963|               console.log(`üí∞ Package [${key}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n01964|             });\n01965|           }\n01966|         } else {\n01967|           console.log('üí∞ ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∞—Å—å');\n01968|         }\n01969| \n01970|         // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–∞–∫ —Ä–∞–∑–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –¥–∞—Ç–∞–º–∏ pickup –∏ arrivalToOspReceiver\n01971|         let deliveryDays = 0;\n01972|         try {\n01973|           console.log('=== –ü–û–ò–°–ö –î–ê–¢ –í –û–¢–í–ï–¢–ï ===');\n01974|           \n01975|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–µ—Å—Ç–∞ –≥–¥–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–∞—Ç—ã\n01976|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.pickup:', data.data?.pickup);\n01977|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.pickup:', data.pickup);\n01978|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.pickup:', data?.pickup);\n01979|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.arrivalToOspReceiver:', data.data?.arrivalToOspReceiver);\n01980|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.arrivalToOspReceiver:', data.arrivalToOspReceiver);\n01981|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.arrivalToOspReceiver:', data?.arrivalToOspReceiver);\n01982|           \n01983|           // –ë–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–π –ø–æ–∏—Å–∫ –≤–æ –≤—Å–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ data\n01984|           const findDateInObject = (obj: any, fieldName: string): string | null => {\n01985|             if (!obj || typeof obj !== 'object') return null;\n01986|             \n01987|             for (const [key, value] of Object.entries(obj)) {\n01988|               if (key === fieldName && typeof value === 'string') {\n01989|                 return value;\n01990|               }\n01991|               if (typeof value === 'object' && value !== null) {\n01992|                 const found = findDateInObject(value, fieldName);\n01993|                 if (found) return found;\n01994|               }\n01995|             }\n01996|             return null;\n01997|           };\n01998|           \n01999|           const pickup = findDateInObject(data, 'pickup');\n02000|           const arrivalToOspReceiver = findDateInObject(data, 'arrivalToOspReceiver');\n\n(File has more lines. Use 'offset' parameter to read beyond line 2000)\n</file>",
    "metadata": {
      "preview": "'use client';\n\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Switch } from '@/components/ui/switch';\nimport { Plus, Truck, Building2, Map, Settings, Package2, Trash2 } from 'lucide-react';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { Collapsible, CollapsibleContent } from '@/components/ui/collapsible';\nimport ProductSearch from '@/components/ProductSearch';\nimport ProductManager from '@/components/ProductManager';\nimport TruckVisualization from '@/components/TruckVisualization';\nimport { FurnitureProduct, ProductInForm, CargoWithMetadata } from '@/lib/furniture-types';\nimport { saveFormData, loadFormData, hasStoredFormData, createDebouncedSaver, clearFormData } from '@/lib/form-storage';\nimport { "
    },
    "title": "app/page.tsx",
    "time": {
      "start": 1760452194718,
      "end": 1760452194722
    }
  }
}