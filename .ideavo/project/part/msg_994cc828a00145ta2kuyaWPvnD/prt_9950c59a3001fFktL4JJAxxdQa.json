{
  "type": "text",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "messageID": "msg_994cc828a00145ta2kuyaWPvnD",
  "id": "prt_9950c59a3001fFktL4JJAxxdQa",
  "text": "I need to move the entire 3D visualization block to the right of the calculation results in the TruckVisualization component. Let me update the layout structure:\n\n<bun_run>\n<command>cd /home/user/project && find . -name \"TruckVisualization.tsx\" -type f</command>\n</bun_run>\n\n<write_file>\n<path>/home/user/project/components/TruckVisualization.tsx</path>\n<content>\"use client\";\n\nimport { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Slider } from '@/components/ui/slider';\nimport { Badge } from '@/components/ui/badge';\nimport { Package, RotateCcw, Gamepad2 } from 'lucide-react';\n\ninterface Product {\n  id: number;\n  name: string;\n  length: number;\n  width: number;\n  height: number;\n  weight: number;\n  quantity: number;\n}\n\ninterface TruckVisualizationProps {\n  products: Product[];\n  truckLength: number;\n  truckWidth: number;\n  truckHeight: number;\n  totalWeight: number;\n  totalVolume: number;\n  weightCapacity: number;\n  volumeCapacity: number;\n}\n\ninterface PlacedProduct {\n  product: Product;\n  x: number;\n  y: number;\n  z: number;\n  color: string;\n}\n\nconst COLORS = [\n  '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57',\n  '#ff9ff3', '#54a0ff', '#5f27cd', '#00d2d3', '#ff9f43',\n  '#10ac84', '#ee5a24', '#0abde3', '#3742fa', '#2f3542'\n];\n\nexport default function TruckVisualization({ \n  products, \n  truckLength, \n  truckWidth, \n  truckHeight,\n  totalWeight,\n  totalVolume,\n  weightCapacity,\n  volumeCapacity \n}: TruckVisualizationProps) {\n  const [placedProducts, setPlacedProducts] = useState<PlacedProduct[]>([]);\n  \n  // 3D View Controls\n  const [rotationX, setRotationX] = useState(0);\n  const [rotationY, setRotationY] = useState(-45);\n  const [rotationZ, setRotationZ] = useState(0);\n  const [positionX, setPositionX] = useState(0);\n  const [positionY, setPositionY] = useState(0);\n  const [scale, setScale] = useState(70);\n\n  // Joystick controls\n  const [isDragging, setIsDragging] = useState(false);\n  const [joystickCenter, setJoystickCenter] = useState({ x: 0, y: 0 });\n\n  const resetView = () => {\n    setRotationX(0);\n    setRotationY(-45);\n    setRotationZ(0);\n    setPositionX(0);\n    setPositionY(0);\n    setScale(70);\n  };\n\n  const handleJoystickStart = (e: React.MouseEvent | React.TouchEvent) => {\n    setIsDragging(true);\n    const rect = (e.target as HTMLElement).getBoundingClientRect();\n    setJoystickCenter({\n      x: rect.left + rect.width / 2,\n      y: rect.top + rect.height / 2\n    });\n  };\n\n  const handleJoystickMove = (e: React.MouseEvent | React.TouchEvent) => {\n    if (!isDragging) return;\n\n    const clientX = 'clientX' in e ? e.clientX : e.touches[0].clientX;\n    const clientY = 'clientY' in e ? e.clientY : e.touches[0].clientY;\n    \n    const deltaX = clientX - joystickCenter.x;\n    const deltaY = clientY - joystickCenter.y;\n    \n    setRotationY(prev => Math.max(-180, Math.min(180, prev + deltaX * 0.5)));\n    setRotationX(prev => Math.max(-90, Math.min(90, prev - deltaY * 0.5)));\n  };\n\n  const handleJoystickEnd = () => {\n    setIsDragging(false);\n  };\n\n  const checkCollision = (newProduct: Product, x: number, y: number, z: number, placed: PlacedProduct[]): boolean => {\n    for (const placedItem of placed) {\n      const p = placedItem.product;\n      \n      if (x < placedItem.x + p.length && \n          x + newProduct.length > placedItem.x &&\n          y < placedItem.y + p.width && \n          y + newProduct.width > placedItem.y &&\n          z < placedItem.z + p.height && \n          z + newProduct.height > placedItem.z) {\n        return true;\n      }\n    }\n    return false;\n  };\n\n  const canPlaceOnTop = (newProduct: Product, x: number, y: number, z: number, placed: PlacedProduct[]): boolean => {\n    if (z === 0) return true;\n    \n    const supportingItems = placed.filter(item => {\n      const p = item.product;\n      return item.z + p.height === z &&\n             item.x < x + newProduct.length && \n             item.x + p.length > x &&\n             item.y < y + newProduct.width && \n             item.y + p.width > y;\n    });\n    \n    if (supportingItems.length === 0) return false;\n    \n    let supportArea = 0;\n    for (const support of supportingItems) {\n      const overlapX = Math.min(x + newProduct.length, support.x + support.product.length) - Math.max(x, support.x);\n      const overlapY = Math.min(y + newProduct.width, support.y + support.product.width) - Math.max(y, support.y);\n      supportArea += overlapX * overlapY;\n    }\n    \n    const requiredSupport = (newProduct.length * newProduct.width) * 0.7;\n    return supportArea >= requiredSupport;\n  };\n\n  const placeProducts = () => {\n    const sortedProducts = [...products]\n      .filter(p => p.quantity > 0)\n      .flatMap(product => Array(product.quantity).fill(product))\n      .sort((a, b) => {\n        if (a.name.toLowerCase().includes('стул') && !b.name.toLowerCase().includes('стул')) return -1;\n        if (!a.name.toLowerCase().includes('стул') && b.name.toLowerCase().includes('стул')) return 1;\n        return (b.weight + b.length * b.width * b.height) - (a.weight + a.length * a.width * a.height);\n      });\n\n    const placed: PlacedProduct[] = [];\n    let colorIndex = 0;\n\n    for (const product of sortedProducts) {\n      let bestPosition = null;\n      let minZ = Infinity;\n\n      for (let z = 0; z <= truckHeight - product.height; z += 10) {\n        for (let x = 0; x <= truckLength - product.length; x += 10) {\n          for (let y = 0; y <= truckWidth - product.width; y += 10) {\n            if (!checkCollision(product, x, y, z, placed) && \n                canPlaceOnTop(product, x, y, z, placed)) {\n              if (z < minZ) {\n                minZ = z;\n                bestPosition = { x, y, z };\n              }\n            }\n          }\n        }\n        if (bestPosition) break;\n      }\n\n      if (bestPosition) {\n        const productColor = COLORS[colorIndex % COLORS.length];\n        placed.push({\n          product,\n          ...bestPosition,\n          color: productColor\n        });\n        \n        if (placed.filter(p => p.product.id === product.id).length === 1) {\n          colorIndex++;\n        }\n      }\n    }\n\n    setPlacedProducts(placed);\n  };\n\n  useEffect(() => {\n    if (products.length > 0) {\n      placeProducts();\n    }\n  }, [products, truckLength, truckWidth, truckHeight]);\n\n  const renderTruck3D = () => {\n    const viewBoxSize = 800;\n    const centerX = viewBoxSize / 2;\n    const centerY = viewBoxSize / 2;\n\n    const transform = `\n      translate(${centerX + positionX}, ${centerY + positionY}) \n      scale(${scale / 100}) \n      rotateX(${rotationX}deg) \n      rotateY(${rotationY}deg) \n      rotateZ(${rotationZ}deg)\n    `;\n\n    const truckScale = 300 / Math.max(truckLength, truckWidth, truckHeight);\n\n    return (\n      <div className=\"relative w-full h-96 bg-gray-50 rounded-lg overflow-hidden border\">\n        <svg \n          width=\"100%\" \n          height=\"100%\" \n          viewBox={`0 0 ${viewBoxSize} ${viewBoxSize}`}\n          style={{ \n            transformStyle: 'preserve-3d',\n            perspective: '1000px'\n          }}\n        >\n          <g style={{ transform, transformStyle: 'preserve-3d' }}>\n            {/* Truck cabin */}\n            <g transform={`translate(${-truckLength * truckScale * 0.25}, 0, ${truckHeight * truckScale * 0.8})`}>\n              <rect \n                x={-30} y={-25} \n                width=\"60\" height=\"50\" \n                fill=\"#2d5a27\" \n                stroke=\"#1a3d18\" \n                strokeWidth=\"2\"\n                rx=\"5\"\n              />\n            </g>\n\n            {/* Truck chassis */}\n            <rect \n              x={-truckLength * truckScale / 2} \n              y={-truckWidth * truckScale / 2} \n              width={truckLength * truckScale} \n              height={truckWidth * truckScale} \n              fill=\"#4a4a4a\" \n              stroke=\"#2a2a2a\" \n              strokeWidth=\"2\"\n              transform={`translate(0, 0, ${-10})`}\n            />\n\n            {/* Truck wheels */}\n            {[-0.3, 0.3].map((xPos, i) => \n              [-0.4, 0.4].map((yPos, j) => (\n                <circle \n                  key={`wheel-${i}-${j}`}\n                  cx={xPos * truckLength * truckScale} \n                  cy={yPos * truckWidth * truckScale} \n                  r=\"15\" \n                  fill=\"#2a2a2a\" \n                  stroke=\"#1a1a1a\" \n                  strokeWidth=\"2\"\n                  transform={`translate(0, 0, ${-20})`}\n                />\n              ))\n            )}\n\n            {/* Cargo space floor */}\n            <rect \n              x={-truckLength * truckScale / 2} \n              y={-truckWidth * truckScale / 2} \n              width={truckLength * truckScale} \n              height={truckWidth * truckScale} \n              fill=\"#f0f0f0\" \n              stroke=\"#d0d0d0\" \n              strokeWidth=\"1\"\n            />\n\n            {/* Cargo space walls */}\n            <g fill=\"#e0e0e0\" stroke=\"#c0c0c0\" strokeWidth=\"1\" fillOpacity=\"0.3\">\n              {/* Back wall */}\n              <rect \n                x={-truckLength * truckScale / 2} \n                y={-truckWidth * truckScale / 2} \n                width={truckWidth * truckScale} \n                height={truckHeight * truckScale} \n                transform={`rotateY(90deg) translate(0, 0, ${-truckLength * truckScale / 2})`}\n              />\n              {/* Left wall */}\n              <rect \n                x={-truckLength * truckScale / 2} \n                y={0} \n                width={truckLength * truckScale} \n                height={truckHeight * truckScale} \n                transform={`rotateX(-90deg) translate(0, ${-truckWidth * truckScale / 2}, 0)`}\n              />\n              {/* Right wall */}\n              <rect \n                x={-truckLength * truckScale / 2} \n                y={0} \n                width={truckLength * truckScale} \n                height={truckHeight * truckScale} \n                transform={`rotateX(90deg) translate(0, ${truckWidth * truckScale / 2}, 0)`}\n              />\n            </g>\n\n            {/* Placed products */}\n            {placedProducts.map((item, index) => (\n              <rect\n                key={index}\n                x={(item.x - truckLength/2) * truckScale}\n                y={(item.y - truckWidth/2) * truckScale}\n                width={item.product.length * truckScale}\n                height={item.product.width * truckScale}\n                fill={item.color}\n                stroke=\"rgba(0,0,0,0.3)\"\n                strokeWidth=\"1\"\n                fillOpacity=\"0.8\"\n                transform={`translate(0, 0, ${item.z * truckScale})`}\n              />\n            ))}\n          </g>\n        </svg>\n\n        {/* 3D Controls Overlay */}\n        <div className=\"absolute top-2 right-2 bg-white/90 p-3 rounded-lg shadow-lg backdrop-blur-sm\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <Gamepad2 className=\"h-4 w-4\" />\n            <span className=\"text-xs font-medium\">3D Управление</span>\n            <Button variant=\"outline\" size=\"sm\" onClick={resetView} className=\"ml-2\">\n              <RotateCcw className=\"h-3 w-3\" />\n            </Button>\n          </div>\n\n          {/* Joystick */}\n          <div className=\"mb-3\">\n            <label className=\"text-xs text-gray-600 mb-1 block\">Поворот (X/Y)</label>\n            <div \n              className=\"w-16 h-16 bg-gray-200 rounded-full relative cursor-move border-2 border-gray-300 select-none\"\n              onMouseDown={handleJoystickStart}\n              onMouseMove={handleJoystickMove}\n              onMouseUp={handleJoystickEnd}\n              onMouseLeave={handleJoystickEnd}\n              onTouchStart={handleJoystickStart}\n              onTouchMove={handleJoystickMove}\n              onTouchEnd={handleJoystickEnd}\n            >\n              <div className=\"w-4 h-4 bg-blue-500 rounded-full absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none\" />\n            </div>\n          </div>\n\n          {/* Position Controls */}\n          <div className=\"space-y-2 text-xs\">\n            <div>\n              <label className=\"text-gray-600\">Позиция X: {positionX}</label>\n              <Slider\n                value={[positionX]}\n                onValueChange={([value]) => setPositionX(value)}\n                min={-200}\n                max={200}\n                step={10}\n                className=\"w-20\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-gray-600\">Позиция Y: {positionY}",
  "time": {
    "start": 1759142238627,
    "end": 1759142238627
  }
}