{
  "id": "prt_ab44c32ad001pb2QFmjfo2vA7L",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "messageID": "msg_ab44bcb32001cQuJ4Xb24ov2JM",
  "type": "tool",
  "callID": "call_eed6376c024b4cbf8cc7ad7b",
  "tool": "write",
  "state": {
    "status": "completed",
    "input": {
      "content": "// –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Nord Wheel —Å –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º\nconst https = require('https');\nconst querystring = require('querystring');\n\n// –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏\nconst testForm = {\n  fromCity: '–ú–æ—Å–∫–≤–∞',\n  toCity: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', \n  fromTerminal: true,\n  toTerminal: true,\n  cargos: [\n    {\n      length: 40,\n      width: 30,\n      height: 20,\n      weight: 5\n    }\n  ],\n  needInsurance: false,\n  declaredValue: 0,\n  needPackaging: false\n};\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ Nord Wheel (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –∏–∑ app/page.tsx)\nasync function calculateNordWheel() {\n  const apiUrl = 'https://api.nordw.orog.ru/api/v1/calculate';\n  \n  try {\n    const totalWeight = testForm.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n    const totalVolume = testForm.cargos.reduce((sum, cargo) => \n      sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n    );\n\n    // Nord Wheel - –∞–≤–∏–∞–ø–µ—Ä–µ–≤–æ–∑—á–∏–∫ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –≤–µ—Å–æ–º 25–∫–≥\n    const minWeight = 25;\n    const adjustedWeight = Math.max(totalWeight, minWeight);\n    \n    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ª–æ–∫–∞—Ü–∏–∏ (–∞—ç—Ä–æ–ø–æ—Ä—Ç—ã: 1 = –ú–æ—Å–∫–≤–∞, 24 = –°–ü–±)\n    const getDispatchLocation = () => {\n      if (testForm.fromTerminal) {\n        return {\n          type: 'terminal',\n          terminal_id: testForm.fromCity.toLowerCase().includes('–º–æ—Å–∫–≤–∞') ? '1' : '24',\n          city_fias: testForm.fromCity.toLowerCase().includes('–º–æ—Å–∫–≤–∞') ? '0c5b2444-70a0-4932-980c-b4dc0d3f02b5' : 'c2deb16a-0330-4f05-821f-1d09c93331e6'\n        };\n      } else {\n        return {\n          type: 'address',\n          address: testForm.fromAddress || testForm.fromCity\n        };\n      }\n    };\n\n    const getDestinationLocation = () => {\n      if (testForm.toTerminal) {\n        return {\n          type: 'terminal',\n          terminal_id: testForm.toCity.toLowerCase().includes('–º–æ—Å–∫–≤–∞') ? '1' : '24',\n          city_fias: testForm.toCity.toLowerCase().includes('–º–æ—Å–∫–≤–∞') ? '0c5b2444-70a0-4932-980c-b4dc0d3f02b5' : 'c2deb16a-0330-4f05-821f-1d09c93331e6'\n        };\n      } else {\n        return {\n          type: 'address',\n          address: testForm.toAddress || testForm.toCity\n        };\n      }\n    };\n\n    const requestData = {\n      dispatch: {\n        location: getDispatchLocation()\n      },\n      destination: {\n        location: getDestinationLocation()\n      },\n      cargo: {\n        total_weight: adjustedWeight,\n        total_volume: Math.round(totalVolume * 100) / 100,\n        total_quantity: testForm.cargos.length\n      },\n      insurance: testForm.needInsurance && testForm.declaredValue ? testForm.declaredValue : null,\n      insurance_refuse: !testForm.needInsurance,\n      services: {\n        is_package: testForm.needPackaging,\n        is_documents_return: false,\n        is_fragile: false\n      },\n      promocode: null\n    };\n    \n    if (totalWeight < minWeight) {\n      console.log(`‚úàÔ∏è Nord Wheel: –≤–µ—Å —É–≤–µ–ª–∏—á–µ–Ω —Å ${totalWeight}–∫–≥ –¥–æ ${adjustedWeight}–∫–≥ (–º–∏–Ω–∏–º—É–º ${minWeight}–∫–≥)`);\n    }\n\n    console.log('üöõ Nord Wheel –∑–∞–ø—Ä–æ—Å –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:', JSON.stringify(requestData, null, 2));\n\n    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å\n    const response = await fetch(apiUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${process.env.NORDWHEEL_API_KEY}`\n      },\n      body: JSON.stringify(requestData)\n    });\n\n    let data;\n    try {\n      data = await response.json();\n      console.log('üöõ Nord Wheel API –æ—Ç–≤–µ—Ç:', JSON.stringify(data, null, 2));\n    } catch (parseError) {\n      console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞:', parseError);\n      return { success: false, error: 'Parse error' };\n    }\n\n    if (!response.ok && (!data || !data.success)) {\n      console.error('‚ùå Nord Wheel API –æ—à–∏–±–∫–∞:', response.status, response.statusText);\n      return { success: false, error: `API Error: ${response.status}` };\n    }\n\n    // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞\n    if (data.success && Array.isArray(data.data) && data.data.length > 0) {\n      const airlineTariff = data.data[0];\n      const price = parseFloat(airlineTariff.price) || 0;\n      const days = 1;\n      \n      console.log(`‚úÖ –£—Å–ø–µ—à–Ω—ã–π —Ä–∞—Å—á–µ—Ç Nord Wheel:`);\n      console.log(`   - –¶–µ–Ω–∞: ${price}‚ÇΩ`);\n      console.log(`   - –°—Ä–æ–∫: ${days} –¥–µ–Ω—å`);\n      console.log(`   - –í–µ—Å: ${adjustedWeight}–∫–≥ (–±—ã–ª–æ ${totalWeight}–∫–≥)`);\n      console.log(`   - –ê—ç—Ä–æ–ø–æ—Ä—Ç—ã: ${airlineTariff.airport_from_id}‚Üí${airlineTariff.airport_to_id}`);\n      console.log(`   - –ú–∏–Ω. –≤–µ—Å: ${airlineTariff.min_paid_weight}–∫–≥`);\n      \n      return {\n        success: true,\n        price,\n        days,\n        details: {\n          airlineId: airlineTariff.airline_id,\n          airportFromId: airlineTariff.airport_from_id,\n          airportToId: airlineTariff.airport_to_id,\n          minPaidWeight: airlineTariff.min_paid_weight || 25,\n          originalWeight: totalWeight,\n          adjustedWeight,\n          currency: 'RUB',\n          transportType: 'aviation'\n        }\n      };\n    } else {\n      console.log('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API');\n      return { success: false, error: 'Invalid response format' };\n    }\n    \n  } catch (error) {\n    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ Nord Wheel:', error);\n    return { success: false, error: error.message };\n  }\n}\n\n// –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞\nconsole.log('üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Nord Wheel —Å –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º...\\n');\ncalculateNordWheel().then(result => {\n  console.log('\\nüìã –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:', JSON.stringify(result, null, 2));\n}).catch(error => {\n  console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', error);\n});",
      "filePath": "/home/user/project/test-nordwheel-integration.js"
    },
    "output": "",
    "title": "test-nordwheel-integration.js",
    "metadata": {
      "diagnostics": {},
      "filepath": "/home/user/project/test-nordwheel-integration.js",
      "exists": false
    },
    "time": {
      "start": 1763961483954,
      "end": 1763961483955
    }
  }
}