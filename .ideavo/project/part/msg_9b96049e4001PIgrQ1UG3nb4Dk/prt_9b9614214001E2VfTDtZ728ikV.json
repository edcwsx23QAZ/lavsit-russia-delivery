{
  "id": "prt_9b9614214001E2VfTDtZ728ikV",
  "messageID": "msg_9b96049e4001PIgrQ1UG3nb4Dk",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "read",
  "callID": "toolu_015kMBpBkomaPpQ5zcDACzNs",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/components/ServiceWorkerRegistration.tsx"
    },
    "output": "<file>\n00001| 'use client';\n00002| \n00003| import { useEffect } from 'react';\n00004| \n00005| export default function ServiceWorkerRegistration() {\n00006|   useEffect(() => {\n00007|     if ('serviceWorker' in navigator) {\n00008|       // NUCLEAR APPROACH: Агрессивное детектирование dev режима\n00009|       const isProduction = process.env.NODE_ENV === 'production' && \n00010|                           typeof window !== 'undefined' && \n00011|                           !window.location.hostname.includes('localhost') && \n00012|                           !window.location.hostname.includes('127.0.0.1') && \n00013|                           !window.location.hostname.includes('.e2b.app') &&\n00014|                           !window.location.hostname.includes('ideavo') &&\n00015|                           !window.location.port;\n00016|       \n00017|       if (isProduction) {\n00018|         navigator.serviceWorker\n00019|           .register('/sw.js')\n00020|           .then((registration) => {\n00021|             console.log('[SW] Service Worker registered successfully:', registration);\n00022|             \n00023|             // Check for updates\n00024|             registration.addEventListener('updatefound', () => {\n00025|               const newWorker = registration.installing;\n00026|               if (newWorker) {\n00027|                 newWorker.addEventListener('statechange', () => {\n00028|                   if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {\n00029|                     console.log('[SW] New version available');\n00030|                     // Could show a notification to user about update\n00031|                   }\n00032|                 });\n00033|               }\n00034|             });\n00035|           })\n00036|           .catch((error) => {\n00037|             console.warn('[SW] Service Worker registration failed:', error);\n00038|           });\n00039| \n00040|         // Listen for messages from service worker\n00041|         navigator.serviceWorker.addEventListener('message', (event) => {\n00042|           console.log('[SW] Message from service worker:', event.data);\n00043|         });\n00044|       } else {\n00045|         // DEVELOPMENT MODE: NUCLEAR SW DESTRUCTION\n00046|         console.log('[SW] DEV: NUCLEAR SERVICE WORKER DESTRUCTION INITIATED');\n00047|         \n00048|         // Step 1: Brute force cache clearing\n00049|         if ('caches' in window) {\n00050|           const clearAllCaches = async () => {\n00051|             try {\n00052|               const cacheNames = await caches.keys();\n00053|               console.log('[SW] DEV: Found caches to delete:', cacheNames);\n00054|               \n00055|               const deletePromises = cacheNames.map(async (cacheName) => {\n00056|                 const deleted = await caches.delete(cacheName);\n00057|                 console.log(`[SW] DEV: Cache ${cacheName} deleted:`, deleted);\n00058|                 return deleted;\n00059|               });\n00060|               \n00061|               await Promise.all(deletePromises);\n00062|               console.log('[SW] DEV: All caches cleared');\n00063|             } catch (error) {\n00064|               console.error('[SW] DEV: Error clearing caches:', error);\n00065|             }\n00066|           };\n00067|           \n00068|           clearAllCaches();\n00069|           \n00070|           // Repeat cache clearing every 2 seconds for 10 seconds\n00071|           const clearIntervalId = setInterval(clearAllCaches, 2000);\n00072|           setTimeout(() => clearInterval(clearIntervalId), 10000);\n00073|         }\n00074|         \n00075|         // Step 2: Unregister ALL existing SWs aggressively\n00076|         const unregisterAll = async () => {\n00077|           try {\n00078|             const registrations = await navigator.serviceWorker.getRegistrations();\n00079|             console.log('[SW] DEV: Found SW registrations:', registrations.length);\n00080|             \n00081|             const unregisterPromises = registrations.map(async (registration) => {\n00082|               const unregistered = await registration.unregister();\n00083|               console.log('[SW] DEV: SW unregistered:', unregistered, registration.scope);\n00084|               return unregistered;\n00085|             });\n00086|             \n00087|             await Promise.all(unregisterPromises);\n00088|             console.log('[SW] DEV: All SWs unregistered');\n00089|           } catch (error) {\n00090|             console.error('[SW] DEV: Error unregistering SWs:', error);\n00091|           }\n00092|         };\n00093|         \n00094|         unregisterAll();\n00095|         \n00096|         // Repeat unregistration every 3 seconds for 15 seconds\n00097|         const unregisterIntervalId = setInterval(unregisterAll, 3000);\n00098|         setTimeout(() => clearInterval(unregisterIntervalId), 15000);\n00099|         \n00100|         // Step 3: Check for active SW and force reload if found\n00101|         const checkActiveSW = () => {\n00102|           if (navigator.serviceWorker.controller) {\n00103|             console.log('[SW] DEV: Active SW detected, force reloading in 3 seconds...');\n00104|             setTimeout(() => {\n00105|               console.log('[SW] DEV: Force reloading page to clear SW state');\n00106|               window.location.reload();\n00107|             }, 3000);\n00108|           }\n00109|         };\n00110|         \n00111|         // Check immediately and periodically\n00112|         setTimeout(checkActiveSW, 5000);\n00113|         const checkIntervalId = setInterval(checkActiveSW, 5000);\n00114|         setTimeout(() => clearInterval(checkIntervalId), 30000);\n00115|       }\n00116|     }\n00117|   }, []);\n00118| \n00119|   return null; // This component renders nothing\n00120| }\n</file>",
    "metadata": {
      "preview": "'use client';\n\nimport { useEffect } from 'react';\n\nexport default function ServiceWorkerRegistration() {\n  useEffect(() => {\n    if ('serviceWorker' in navigator) {\n      // NUCLEAR APPROACH: Агрессивное детектирование dev режима\n      const isProduction = process.env.NODE_ENV === 'production' && \n                          typeof window !== 'undefined' && \n                          !window.location.hostname.includes('localhost') && \n                          !window.location.hostname.includes('127.0.0.1') && \n                          !window.location.hostname.includes('.e2b.app') &&\n                          !window.location.hostname.includes('ideavo') &&\n                          !window.location.port;\n      \n      if (isProduction) {\n        navigator.serviceWorker\n          .register('/sw.js')\n          .then((registration) => {"
    },
    "title": "components/ServiceWorkerRegistration.tsx",
    "time": {
      "start": 1759751783618,
      "end": 1759751783621
    }
  }
}