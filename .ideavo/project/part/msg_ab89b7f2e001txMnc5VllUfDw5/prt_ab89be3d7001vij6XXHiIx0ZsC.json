{
  "id": "prt_ab89be3d7001vij6XXHiIx0ZsC",
  "sessionID": "ses_54b97e247ffenCZZa4jZiIWD0l",
  "messageID": "msg_ab89b7f2e001txMnc5VllUfDw5",
  "type": "tool",
  "callID": "call_91a5f7ad73644ba9a58c82df",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx",
      "limit": 500,
      "offset": 2000
    },
    "output": "<file>\n02001|         console.log('üí∞ –†–ê–°–ß–ï–¢ –ò–¢–û–ì–û–í–û–ô –°–¢–û–ò–ú–û–°–¢–ò:');\n02002|         console.log('üí∞ –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å data.data.price (–£–ñ–ï –í–ö–õ–Æ–ß–ê–ï–¢ –í–°–ï):', totalPrice);\n02003|         \n02004|         // –°–¢–†–ê–•–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n02005|         if (data.data.insurance) {\n02006|           console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ data.data.insurance (–£–ñ–ï –≤–∫–ª—é—á–µ–Ω–∞ –≤ –±–∞–∑–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):', data.data.insurance);\n02007|           console.log('üí∞ –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞—Ö–æ–≤–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ');\n02008|         } else {\n02009|           console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–≤–µ—Ç–µ');\n02010|         }\n02011|         \n02012|         // –£–ü–ê–ö–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n02013|         console.log('üí∞ –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–ë –£–ü–ê–ö–û–í–ö–ï (–£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –í –û–°–ù–û–í–ù–£–Æ –°–¢–û–ò–ú–û–°–¢–¨):');\n02014|         console.log('üí∞ data.data.packages =', data.data.packages);\n02015|         console.log('üí∞ form.needPackaging =', form.needPackaging);\n02016|         \n02017|         if (data.data.packages && form.needPackaging) {\n02018|           console.log('üí∞ ‚úÖ –£–ü–ê–ö–û–í–ö–ê –ü–†–ò–°–£–¢–°–¢–í–£–ï–¢ –í –û–¢–í–ï–¢–ï (—Ü–µ–Ω–∞ —É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ data.data.price)');\n02019|           console.log('üí∞ –¢–∏–ø packages:', Array.isArray(data.data.packages) ? 'Array' : 'Object');\n02020|           \n02021|           if (Array.isArray(data.data.packages)) {\n02022|             data.data.packages.forEach((pkg: any, index: number) => {\n02023|               console.log(`üí∞ Package [${index}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n02024|             });\n02025|           } else {\n02026|             Object.entries(data.data.packages).forEach(([key, pkg]: [string, any]) => {\n02027|               console.log(`üí∞ Package [${key}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n02028|             });\n02029|           }\n02030|         } else {\n02031|           console.log('üí∞ ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∞—Å—å');\n02032|         }\n02033| \n02034|         // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–∞–∫ —Ä–∞–∑–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –¥–∞—Ç–∞–º–∏ pickup –∏ arrivalToOspReceiver\n02035|         let deliveryDays = 0;\n02036|         try {\n02037|           console.log('=== –ü–û–ò–°–ö –î–ê–¢ –í –û–¢–í–ï–¢–ï ===');\n02038|           \n02039|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–µ—Å—Ç–∞ –≥–¥–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–∞—Ç—ã\n02040|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.pickup:', data.data?.pickup);\n02041|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.pickup:', data.pickup);\n02042|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.pickup:', data?.pickup);\n02043|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.arrivalToOspReceiver:', data.data?.arrivalToOspReceiver);\n02044|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.arrivalToOspReceiver:', data.arrivalToOspReceiver);\n02045|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.arrivalToOspReceiver:', data?.arrivalToOspReceiver);\n02046|           \n02047|           // –ë–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–π –ø–æ–∏—Å–∫ –≤–æ –≤—Å–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ data\n02048|           const findDateInObject = (obj: any, fieldName: string): string | null => {\n02049|             if (!obj || typeof obj !== 'object') return null;\n02050|             \n02051|             for (const [key, value] of Object.entries(obj)) {\n02052|               if (key === fieldName && typeof value === 'string') {\n02053|                 return value;\n02054|               }\n02055|               if (typeof value === 'object' && value !== null) {\n02056|                 const found = findDateInObject(value, fieldName);\n02057|                 if (found) return found;\n02058|               }\n02059|             }\n02060|             return null;\n02061|           };\n02062|           \n02063|           const pickup = findDateInObject(data, 'pickup');\n02064|           const arrivalToOspReceiver = findDateInObject(data, 'arrivalToOspReceiver');\n02065|           \n02066|           console.log('–ù–ê–ô–î–ï–ù–ù–´–ï –î–ê–¢–´:');\n02067|           console.log('pickup:', pickup);\n02068|           console.log('arrivalToOspReceiver:', arrivalToOspReceiver);\n02069|           \n02070|           if (pickup && arrivalToOspReceiver) {\n02071|             // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—ã (—Ñ–æ—Ä–º–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å \"2025-09-27\" –∏–ª–∏ \"2025-09-27 10:00:00\")\n02072|             const pickupDate = new Date(pickup);\n02073|             const arrivalDate = new Date(arrivalToOspReceiver);\n02074|             \n02075|             console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ pickup:', pickupDate);\n02076|             console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ arrival:', arrivalDate);\n02077|             \n02078|             // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã\n02079|             if (!isNaN(pickupDate.getTime()) && !isNaN(arrivalDate.getTime())) {\n02080|               // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–æ—Å—Ç—å –≤ –¥–Ω—è—Ö\n02081|               const timeDiff = arrivalDate.getTime() - pickupDate.getTime();\n02082|               deliveryDays = Math.max(1, Math.ceil(timeDiff / (1000 * 3600 * 24))); // –ú–∏–Ω–∏–º—É–º 1 –¥–µ–Ω—å\n02083|               \n02084|               console.log('–†–∞–∑–Ω–æ—Å—Ç—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö:', timeDiff);\n02085|               console.log('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –í–´–ß–ò–°–õ–ï–ù —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:', deliveryDays, '–¥–Ω–µ–π');\n02086|             } else {\n02087|               console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞—Ç—ã –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞');\n02088|               console.error('pickup Date object:', pickupDate);\n02089|               console.error('arrival Date object:', arrivalDate);\n02090|             }\n02091|           } else {\n02092|             console.warn('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ –Ω–∞–π–¥–µ–Ω—ã –¥–∞—Ç—ã pickup –∏–ª–∏ arrivalToOspReceiver');\n02093|             console.log('pickup –Ω–∞–π–¥–µ–Ω:', !!pickup, pickup);\n02094|             console.log('arrivalToOspReceiver –Ω–∞–π–¥–µ–Ω:', !!arrivalToOspReceiver, arrivalToOspReceiver);\n02095|           }\n02096|         } catch (error) {\n02097|           console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –û—à–∏–±–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:', error);\n02098|         }\n02099| \n02100|         console.log('üí∞ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ò–¢–û–ì–û–í–ê–Ø –°–¢–û–ò–ú–û–°–¢–¨:', Math.round(totalPrice));\n02101|         \n02102|         return {\n02103|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n02104|           price: Math.round(totalPrice),\n02105|           days: deliveryDays || 0,\n02106|           details: data.data || {},\n02107|           requestData,\n02108|           responseData: data,\n02109|           apiUrl,\n02110|           sessionId: sessionID\n02111|         };\n02112|       } else {\n02113|         const errorMessage = data.metadata?.detail || \n02114|                            data.metadata?.message || \n02115|                            data.errors?.[0]?.detail || \n02116|                            (data.metadata?.status !== 200 ? `HTTP ${data.metadata?.status}` : '') ||\n02117|                            '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏';\n02118|         return {\n02119|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n02120|           price: 0,\n02121|           days: 0,\n02122|           error: errorMessage,\n02123|           requestData,\n02124|           responseData: data,\n02125|           apiUrl,\n02126|           sessionId: sessionID\n02127|         };\n02128|       }\n02129|     } catch (error: any) {\n02130|       return {\n02131|         company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n02132|         price: 0,\n02133|         days: 0,\n02134|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n02135|         requestData: null,\n02136|         responseData: null,\n02137|         apiUrl\n02138|       };\n02139|     }\n02140|   };\n02141| \n02142| \n02143| \n02144|   // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–Ω–æ–π –∑–æ–Ω—ã –∏ —Å–∫–ª–∞–¥–∞ –ü–≠–ö –ø–æ –∞–¥—Ä–µ—Å—É —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏\n02145|   const getPekZoneByAddress = async (address: string) => {\n02146|     try {\n02147|       console.log(`üîç –ü–≠–ö: –ø–æ–∏—Å–∫ –∑–æ–Ω—ã –¥–ª—è –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n02148| \n02149|       const result = await enhancedApiRequest(\n02150|         '/api/pek',\n02151|         {\n02152|           method: 'POST',\n02153|           headers: {\n02154|             'Content-Type': 'application/json',\n02155|           },\n02156|           body: JSON.stringify({\n02157|             method: 'findzonebyaddress',\n02158|             address: address\n02159|           })\n02160|         },\n02161|         { operation: 'findzonebyaddress', company: '–ü–≠–ö' }\n02162|       );\n02163| \n02164|       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n02165|         console.error(`‚ùå –ü–≠–ö API –æ—à–∏–±–∫–∞:`, result.error);\n02166|         console.log(`üîÑ –ü–≠–ö: –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥—É –¥–ª—è \"${address}\"`);\n02167|         return getPekZoneFallback(address);\n02168|       }\n02169| \n02170|       const response = result as Response;\n02171|       console.log(`üì° –ü–≠–ö API —Å—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`);\n02172| \n02173|       if (!response.ok) {\n02174|         let errorData;\n02175|         try {\n02176|           errorData = await response.json();\n02177|         } catch {\n02178|           errorData = { error: '–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç' };\n02179|         }\n02180| \n02181|         console.error(`‚ùå –ü–≠–ö API –æ—à–∏–±–∫–∞ ${response.status}:`, errorData);\n02182| \n02183|         // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫\n02184|         if (response.status === 401) {\n02185|           console.error('‚ùå –ü–≠–ö: –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω');\n02186|         } else if (response.status === 404) {\n02187|           console.error('‚ùå –ü–≠–ö: –ú–µ—Ç–æ–¥ API –Ω–µ –Ω–∞–π–¥–µ–Ω');\n02188|         } else if (response.status === 400) {\n02189|           console.error('‚ùå –ü–≠–ö: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞');\n02190|         } else if (response.status >= 500) {\n02191|           console.error('‚ùå –ü–≠–ö: –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ü–≠–ö');\n02192|         }\n02193| \n02194|         console.log(`üîÑ –ü–≠–ö: –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥—É –¥–ª—è \"${address}\"`);\n02195|         return getPekZoneFallback(address);\n02196|       }\n02197| \n02198|       const data = await response.json();\n02199|       console.log(`‚úÖ –ü–≠–ö –∑–æ–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞:`, data);\n02200| \n02201|       if (data.zoneId && data.mainWarehouseId) {\n02202|         return {\n02203|           zoneId: data.zoneId,\n02204|           zoneName: data.zoneName,\n02205|           branchUID: data.branchUID,\n02206|           branchCode: data.branchCode,\n02207|           branchTitle: data.branchTitle,\n02208|           mainWarehouseId: data.mainWarehouseId,\n02209|           warehousePoint: data.warehousePoint,\n02210|           geoData: data.GeoData,\n02211|           precision: data.GeoData?.precision\n02212|         };\n02213|       }\n02214| \n02215|       console.warn(`‚ö†Ô∏è –ü–≠–ö: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç:`, data);\n02216|       return getPekZoneFallback(address);\n02217| \n02218|     } catch (error) {\n02219|       console.error('‚ùå –ü–≠–ö: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∑–æ–Ω—ã:', error);\n02220|       return getPekZoneFallback(address);\n02221|     }\n02222|   };\n02223| \n02224|   // –§–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–æ–Ω—ã –ü–≠–ö\n02225|   const getPekZoneFallback = (address: string) => {\n02226|     console.log(`üîÑ –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –∞–Ω–∞–ª–∏–∑ –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n02227|     \n02228|     const addressLower = address.toLowerCase();\n02229|     \n02230|     // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –∏ –∏—Ö –¥–∞–Ω–Ω—ã–µ\n02231|     const cityMappings: { [key: string]: any } = {\n02232|       '–º–æ—Å–∫–≤–∞': {\n02233|         zoneId: 'moscow-zone-001',\n02234|         zoneName: '–ú–æ—Å–∫–≤–∞',\n02235|         branchUID: 'moscow-branch-001',\n02236|         branchCode: '–ú–°–ö',\n02237|         branchTitle: '–ú–æ—Å–∫–≤–∞',\n02238|         mainWarehouseId: 'dc6c746d-812d-11e4-bbfc-001999d8b3c5',\n02239|         warehousePoint: {\n02240|           latitude: 55.755826,\n02241|           longitude: 37.6173\n02242|         }\n02243|       },\n02244|       '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': {\n02245|         zoneId: 'spb-zone-001',\n02246|         zoneName: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n02247|         branchUID: 'spb-branch-001',\n02248|         branchCode: '–°–ü–ë',\n02249|         branchTitle: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n02250|         mainWarehouseId: 'b436c978-086d-11e6-b6ca-00155d668909',\n02251|         warehousePoint: {\n02252|           latitude: 59.9311,\n02253|           longitude: 30.3609\n02254|         }\n02255|       },\n02256|       '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': {\n02257|         zoneId: 'ekb-zone-001',\n02258|         zoneName: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',\n02259|         branchUID: 'ekb-branch-001',\n02260|         branchCode: '–ï–ö–ë',\n02261|         branchTitle: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',\n02262|         mainWarehouseId: 'f8d9c8e3-8e2d-11e4-bbfc-001999d8b3c5',\n02263|         warehousePoint: {\n02264|           latitude: 56.8431,\n02265|           longitude: 60.6454\n02266|         }\n02267|       }\n02268|     };\n02269|     \n02270|     for (const [city, data] of Object.entries(cityMappings)) {\n02271|       if (addressLower.includes(city) || addressLower.includes(city.replace('-', ' '))) {\n02272|         console.log(`‚úÖ –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –Ω–∞–π–¥–µ–Ω –≥–æ—Ä–æ–¥ ${city}`);\n02273|         return {\n02274|           ...data,\n02275|           geoData: {\n02276|             precision: 'fallback',\n02277|             kind: 'locality'\n02278|           },\n02279|           precision: 'fallback'\n02280|         };\n02281|       }\n02282|     }\n02283|     \n02284|     console.warn(`‚ùå –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –≥–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ \"${address}\"`);\n02285|     return null;\n02286|   };\n02287| \n02288|   // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –ü–≠–ö\n02289|   const getPekNearestDepartments = async (address: string, coordinates?: { latitude: string, longitude: string }) => {\n02290|     try {\n02291|       console.log(`üè¢ –ü–≠–ö: –ø–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –¥–ª—è \"${address}\"`);\n02292| \n02293|       const requestBody: any = {\n02294|         departmentOperation: 3, // –≤—ã–¥–∞—á–∞ –≥—Ä—É–∑–æ–≤\n02295|         type: 3, // –∞–≤—Ç–æ-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç\n02296|         searchRadius: 50, // –∫–º\n02297|         limit: 5\n02298|       };\n02299| \n02300|       // –ü–≠–ö API —Ç—Ä–µ–±—É–µ—Ç –∏ –∞–¥—Ä–µ—Å, –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ\n02301|       requestBody.address = address;\n02302| \n02303|       if (coordinates) {\n02304|         requestBody.coordinates = coordinates;\n02305|         console.log(`üìç –ü–≠–ö: –ø–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\" –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º`, coordinates);\n02306|       } else {\n02307|         console.log(`üìç –ü–≠–ö: –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\"`);\n02308|       }\n02309| \n02310|       const result = await enhancedApiRequest(\n02311|         '/api/pek',\n02312|         {\n02313|           method: 'POST',\n02314|           headers: {\n02315|             'Content-Type': 'application/json',\n02316|           },\n02317|           body: JSON.stringify({\n02318|             method: 'nearestdepartments',\n02319|             ...requestBody\n02320|           })\n02321|         },\n02322|         { operation: 'nearestdepartments', company: '–ü–≠–ö' }\n02323|       );\n02324| \n02325|       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n02326|         console.error(`‚ùå –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API –æ—à–∏–±–∫–∞:`, result.error);\n02327|         return null;\n02328|       }\n02329| \n02330|       const response = result as Response;\n02331|       console.log(`üì° –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API —Å—Ç–∞—Ç—É—Å: ${response.status}`);\n02332| \n02333|       if (!response.ok) {\n02334|         const errorText = await response.text();\n02335|         console.error(`‚ùå –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API –æ—à–∏–±–∫–∞: ${response.status} ${response.statusText}`);\n02336|         console.error(`‚ùå –û—Ç–≤–µ—Ç:`, errorText.substring(0, 500));\n02337|         return null;\n02338|       }\n02339| \n02340|       const data = await response.json();\n02341|       console.log(`‚úÖ –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–∞–π–¥–µ–Ω—ã:`, data);\n02342| \n02343|       // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤–æ–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ —Å –Ω–∞–∏–≤—ã—Å—à–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º\n02344|       if (data.freeDepartments && data.freeDepartments.length > 0) {\n02345|         const bestDepartment = data.freeDepartments.sort((a: any, b: any) => b.priority - a.priority)[0];\n02346|         console.log(`‚úÖ –ü–≠–ö: –≤—ã–±—Ä–∞–Ω–æ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ`, bestDepartment.divisionName);\n02347|         return {\n02348|           warehouseId: bestDepartment.warehouseId,\n02349|           branchId: bestDepartment.branchId,\n02350|           branchName: bestDepartment.branchName,\n02351|           divisionName: bestDepartment.divisionName,\n02352|           address: bestDepartment.address,\n02353|           coordinates: bestDepartment.coordinates,\n02354|           phone: bestDepartment.phone,\n02355|           email: bestDepartment.email\n02356|         };\n02357|       }\n02358| \n02359|       console.warn(`‚ùå –ü–≠–ö: –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è \"${address}\"`);\n02360|       return null;\n02361|     } catch (error) {\n02362|       console.error('‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –æ—Ç–¥–µ–ª–µ–Ω–∏–π:', error);\n02363|       return null;\n02364|     }\n02365|   };\n02366| \n02367|   // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ü–≠–ö)\n02368|   const getYandexCoordinates = async (address: string): Promise<{ latitude: string, longitude: string } | null> => {\n02369|     try {\n02370|       const encodedAddress = encodeURIComponent(address);\n02371|       const response = await fetch(`https://geocode-maps.yandex.ru/1.x/?apikey=YOUR_API_KEY&geocode=${encodedAddress}&format=json`);\n02372|       \n02373|       if (!response.ok) return null;\n02374|       \n02375|       const data = await response.json();\n02376|       const coords = data?.response?.GeoObjectCollection?.featureMember?.[0]?.GeoObject?.Point?.pos?.split(' ');\n02377|       \n02378|       if (coords && coords.length === 2) {\n02379|         return {\n02380|           longitude: coords[0],\n02381|           latitude: coords[1]\n02382|         };\n02383|       }\n02384|       \n02385|       return null;\n02386|     } catch (error) {\n02387|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ø–Ω–¥–µ–∫—Å:', error);\n02388|       return null;\n02389|     }\n02390|   };\n02391| \n02392|   // –†–∞—Å—á–µ—Ç –¥–ª—è –ü–≠–ö —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API v1/calculateprice/\n02393|   const calculatePEK = async (): Promise<CalculationResult> => {\n02394|     const apiUrl = 'https://kabinet.pecom.ru/api/v1/calculateprice/';\n02395|     \n02396|     // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç\n02397|     const validateCoordinates = (coords: any) => {\n02398|       console.log('üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:', coords);\n02399|       \n02400|       if (!coords) {\n02401|         console.log('‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç');\n02402|         return null;\n02403|       }\n02404|       \n02405|       if (typeof coords.latitude !== 'number' || typeof coords.longitude !== 'number') {\n02406|         console.warn(`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ —è–≤–ª—è—é—Ç—Å—è —á–∏—Å–ª–∞–º–∏:`, { \n02407|           lat: coords.latitude, \n02408|           lng: coords.longitude,\n02409|           latType: typeof coords.latitude,\n02410|           lngType: typeof coords.longitude\n02411|         });\n02412|         return null;\n02413|       }\n02414|       \n02415|       const lat = Number(coords.latitude);\n02416|       const lng = Number(coords.longitude);\n02417|       \n02418|       console.log(`üìç –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: lat=${lat}, lng=${lng}`);\n02419|       \n02420|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω—ã\n02421|       if (lat < -90 || lat > 90 || lng < -180 || lng > 180 || isNaN(lat) || isNaN(lng)) {\n02422|         console.warn(`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–Ω–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞:`, { \n02423|           lat, lng, \n02424|           latValid: lat >= -90 && lat <= 90,\n02425|           lngValid: lng >= -180 && lng <= 180,\n02426|           latIsNaN: isNaN(lat),\n02427|           lngIsNaN: isNaN(lng)\n02428|         });\n02429|         return null;\n02430|       }\n02431|       \n02432|       console.log('‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã:', { latitude: lat, longitude: lng });\n02433|       return { latitude: lat, longitude: lng };\n02434|     };\n02435|     \n02436|     try {\n02437|       // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–æ–Ω–∞—Ö –∏ —Å–∫–ª–∞–¥–∞—Ö –ø–æ –∞–¥—Ä–µ—Å–∞–º\n02438|       console.log(`üöÄ –ü–≠–ö: –Ω–∞—á–∏–Ω–∞–µ–º —Ä–∞—Å—á–µ—Ç`);\n02439|       console.log(`üìç –û—Ç: ${form.fromAddress || form.fromCity}`);\n02440|       console.log(`üìç –î–æ: ${form.toAddress || form.toCity}`);\n02441|       \n02442|       const senderZone = await getPekZoneByAddress(form.fromAddress || `–≥ ${form.fromCity}`);\n02443|       const receiverZone = await getPekZoneByAddress(form.toAddress || `–≥ ${form.toCity}`);\n02444|       \n02445|       console.log(`üîç –ü–≠–ö –∑–æ–Ω—ã:`);\n02446|       console.log(`üìç –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å:`, senderZone ? `${senderZone.branchTitle} (${senderZone.mainWarehouseId})` : '–ù–ï –ù–ê–ô–î–ï–ù–ê');\n02447|       console.log(`üìç –ü–æ–ª—É—á–∞—Ç–µ–ª—å:`, receiverZone ? `${receiverZone.branchTitle} (${receiverZone.mainWarehouseId})` : '–ù–ï –ù–ê–ô–î–ï–ù–ê');\n02448|       \n02449|       if (!senderZone || !receiverZone) {\n02450|         // –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞\n02451|         const debugInfo = {\n02452|           senderAddress: form.fromAddress || form.fromCity,\n02453|           receiverAddress: form.toAddress || form.toCity,\n02454|           senderZoneFound: !!senderZone,\n02455|           receiverZoneFound: !!receiverZone,\n02456|           apiTested: true\n02457|         };\n02458|         \n02459|         console.error(`‚ùå –ü–≠–ö: –∑–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã`, debugInfo);\n02460|         \n02461|         return {\n02462|           company: '–ü–≠–ö',\n02463|           price: 0,\n02464|           days: 0,\n02465|           error: `–ó–æ–Ω–∞ –ü–≠–ö –Ω–µ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥—Ä–µ—Å–∞: ${!senderZone ? (form.fromAddress || form.fromCity) : ''} ${!receiverZone ? (form.toAddress || form.toCity) : ''}`.trim(),\n02466|           apiUrl,\n02467|           requestData: debugInfo,\n02468|           responseData: { senderZone, receiverZone }\n02469|         };\n02470|       }\n02471| \n02472|       // –ü–æ–ª—É—á–∞–µ–º –±–ª–∏–∂–∞–π—à–∏–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –∞–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞\n02473|       let senderWarehouseId = senderZone.mainWarehouseId;\n02474|       let receiverWarehouseId = receiverZone.mainWarehouseId;\n02475|       \n02476|       if (form.fromAddressDelivery && senderZone.warehousePoint) {\n02477|         const validSenderCoords = validateCoordinates(senderZone.warehousePoint);\n02478|         if (validSenderCoords) {\n02479|           try {\n02480|             const senderDepartment = await getPekNearestDepartments(\n02481|               form.fromAddress || form.fromCity,\n02482|               {\n02483|                 latitude: validSenderCoords.latitude.toString(),\n02484|                 longitude: validSenderCoords.longitude.toString()\n02485|               }\n02486|             );\n02487|             if (senderDepartment) {\n02488|               senderWarehouseId = senderDepartment.warehouseId;\n02489|               console.log('‚úÖ –ù–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π —Å–∫–ª–∞–¥ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è:', senderDepartment.warehouseId);\n02490|             }\n02491|           } catch (error) {\n02492|             console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥:', error);\n02493|           }\n02494|         } else {\n02495|           console.warn('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥');\n02496|         }\n02497|       }\n02498|       \n02499|       if (form.toAddressDelivery && receiverZone.warehousePoint) {\n02500|         const validReceiverCoords = validateCoordinates(receiverZone.warehousePoint);\n\n(File has more lines. Use 'offset' parameter to read beyond line 2500)\n</file>",
    "title": "app/page.tsx",
    "metadata": {
      "preview": "        console.log('üí∞ –†–ê–°–ß–ï–¢ –ò–¢–û–ì–û–í–û–ô –°–¢–û–ò–ú–û–°–¢–ò:');\n        console.log('üí∞ –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å data.data.price (–£–ñ–ï –í–ö–õ–Æ–ß–ê–ï–¢ –í–°–ï):', totalPrice);\n        \n        // –°–¢–†–ê–•–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n        if (data.data.insurance) {\n          console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ data.data.insurance (–£–ñ–ï –≤–∫–ª—é—á–µ–Ω–∞ –≤ –±–∞–∑–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):', data.data.insurance);\n          console.log('üí∞ –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞—Ö–æ–≤–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ');\n        } else {\n          console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–≤–µ—Ç–µ');\n        }\n        \n        // –£–ü–ê–ö–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n        console.log('üí∞ –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–ë –£–ü–ê–ö–û–í–ö–ï (–£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –í –û–°–ù–û–í–ù–£–Æ –°–¢–û–ò–ú–û–°–¢–¨):');\n        console.log('üí∞ data.data.packages =', data.data.packages);\n        console.log('üí∞ form.needPackaging =', form.needPackaging);\n        \n        if (data.data.packages && form.needPackaging) {\n          console.log('üí∞ ‚úÖ –£–ü–ê–ö–û–í–ö–ê –ü–†–ò–°–£–¢–°–¢–í–£–ï–¢ –í –û–¢–í–ï–¢–ï (—Ü–µ–Ω–∞ —É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ data.data.price)');\n          console.log('üí∞ –¢–∏–ø packages:', Array.isArray(data.data.packages) ? 'Array' : 'Object');\n          "
    },
    "time": {
      "start": 1764033815513,
      "end": 1764033815519
    }
  }
}