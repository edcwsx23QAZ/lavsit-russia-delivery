{
  "id": "prt_a96d0c26c001Ib9KpdFpnAENiF",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "messageID": "msg_a96d0b8fd00204JsFDsCs7ioWq",
  "type": "tool",
  "callID": "call_78152738",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "components/diagnostic/ApiMasterTab.tsx",
      "offset": 280
    },
    "output": "<file>\n00281|             body: JSON.stringify({ method: 'test' })\n00282|           });\n00283|           testResult = railResponse.ok;\n00284|           break;\n00285| \n00286|         case 'nordwheel':\n00287|            // NordWheel API test - check if API key is configured\n00288|            const nordwheelApiKey = api.credentials.apiKey;\n00289|            if (nordwheelApiKey && nordwheelApiKey.length > 0) {\n00290|              testResult = true;\n00291|            } else {\n00292|              testResult = false;\n00293|              errorMessage = 'API ключ NordWheel не настроен';\n00294|            }\n00295|            break;\n00296| \n00297|         case 'dadata':\n00298|           const dadataResponse = await fetch('https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address', {\n00299|             method: 'POST',\n00300|             headers: {\n00301|               'Content-Type': 'application/json',\n00302|               'Authorization': `Token ${api.credentials.apiKey}`\n00303|             },\n00304|             body: JSON.stringify({ query: 'Москва', count: 1 })\n00305|           });\n00306|           testResult = dadataResponse.ok;\n00307|           break;\n00308| \n00309|         default:\n00310|           testResult = true; // For internal APIs, assume working\n00311|       }\n00312| \n00313|       setApis(prev => prev.map(a =>\n00314|         a.key === api.key ? {\n00315|           ...a,\n00316|           status: testResult ? 'working' : 'error',\n00317|           lastChecked: new Date(),\n00318|           errorMessage: testResult ? undefined : errorMessage\n00319|         } : a\n00320|       ));\n00321| \n00322|     } catch (error) {\n00323|       setApis(prev => prev.map(a =>\n00324|         a.key === api.key ? {\n00325|           ...a,\n00326|           status: 'error',\n00327|           lastChecked: new Date(),\n00328|           errorMessage: 'Сетевая ошибка'\n00329|         } : a\n00330|       ));\n00331|     }\n00332|   }, []);\n00333| \n00334|   const testAllApis = useCallback(async () => {\n00335|     setTestingAll(true);\n00336|     for (const api of apis) {\n00337|       await testApi(api);\n00338|       await new Promise(resolve => setTimeout(resolve, 500)); // Delay between tests\n00339|     }\n00340|     setTestingAll(false);\n00341|     saveApiConfigurations();\n00342|   }, [apis, testApi, saveApiConfigurations]);\n00343| \n00344|   const startEditing = useCallback((apiKey: string) => {\n00345|     const api = apis.find(a => a.key === apiKey);\n00346|     if (api) {\n00347|       setEditingApi(apiKey);\n00348|       setEditCredentials({ ...api.credentials });\n00349|     }\n00350|   }, [apis]);\n00351| \n00352|   const saveCredentials = useCallback(() => {\n00353|     if (editingApi) {\n00354|       setApis(prev => prev.map(a =>\n00355|         a.key === editingApi ? { ...a, credentials: { ...editCredentials } } : a\n00356|       ));\n00357|       setEditingApi(null);\n00358|       saveApiConfigurations();\n00359|     }\n00360|   }, [editingApi, editCredentials, saveApiConfigurations]);\n00361| \n00362|   const getStatusIcon = (status: string) => {\n00363|     switch (status) {\n00364|       case 'working': return <CheckCircle className=\"h-4 w-4 text-green-500\" />;\n00365|       case 'error': return <XCircle className=\"h-4 w-4 text-red-500\" />;\n00366|       case 'expired': return <AlertTriangle className=\"h-4 w-4 text-yellow-500\" />;\n00367|       default: return <RefreshCw className=\"h-4 w-4 text-gray-500\" />;\n00368|     }\n00369|   };\n00370| \n00371|   const getStatusText = (status: string) => {\n00372|     switch (status) {\n00373|       case 'working': return 'Работает';\n00374|       case 'error': return 'Ошибка';\n00375|       case 'expired': return 'Устарел';\n00376|       default: return 'Неизвестно';\n00377|     }\n00378|   };\n00379| \n00380|   const getCategoryIcon = (category: string) => {\n00381|     switch (category) {\n00382|       case 'transport': return <Truck className=\"h-4 w-4\" />;\n00383|       case 'service': return <Globe className=\"h-4 w-4\" />;\n00384|       case 'internal': return <Database className=\"h-4 w-4\" />;\n00385|       default: return <Settings className=\"h-4 w-4\" />;\n00386|     }\n00387|   };\n00388| \n00389|   const transportApis = apis.filter(api => api.category === 'transport');\n00390|   const serviceApis = apis.filter(api => api.category === 'service');\n00391|   const internalApis = apis.filter(api => api.category === 'internal');\n00392| \n00393|   return (\n00394|     <div className=\"space-y-6\">\n00395|       <div className=\"flex justify-between items-center\">\n00396|         <div>\n00397|           <h2 className=\"text-2xl font-bold text-white mb-2\">Все API</h2>\n00398|           <p className=\"text-gray-400\">Централизованное управление всеми API приложения</p>\n00399|         </div>\n00400|         <Button\n00401|           onClick={testAllApis}\n00402|           disabled={testingAll}\n00403|           className=\"bg-blue-600 hover:bg-blue-700\"\n00404|         >\n00405|           {testingAll ? (\n00406|             <>\n00407|               <RefreshCw className=\"h-4 w-4 mr-2 animate-spin\" />\n00408|               Тестирование...\n00409|             </>\n00410|           ) : (\n00411|             <>\n00412|               <Play className=\"h-4 w-4 mr-2\" />\n00413|               Протестировать все\n00414|             </>\n00415|           )}\n00416|         </Button>\n00417|       </div>\n00418| \n00419|       <Tabs defaultValue=\"transport\" className=\"w-full\">\n00420|         <TabsList className=\"grid w-full grid-cols-3 bg-gray-800 border-gray-700\">\n00421|           <TabsTrigger value=\"transport\" className=\"text-white\">\n00422|             <Truck className=\"h-4 w-4 mr-2\" />\n00423|             Транспорт ({transportApis.length})\n00424|           </TabsTrigger>\n00425|           <TabsTrigger value=\"service\" className=\"text-white\">\n00426|             <Globe className=\"h-4 w-4 mr-2\" />\n00427|             Сервисы ({serviceApis.length})\n00428|           </TabsTrigger>\n00429|           <TabsTrigger value=\"internal\" className=\"text-white\">\n00430|             <Database className=\"h-4 w-4 mr-2\" />\n00431|             Внутренние ({internalApis.length})\n00432|           </TabsTrigger>\n00433|         </TabsList>\n00434| \n00435|         <TabsContent value=\"transport\" className=\"mt-6\">\n00436|           <div className=\"grid gap-4\">\n00437|             {transportApis.map((api) => (\n00438|               <Card key={api.key} className=\"bg-gray-800 border-gray-700\">\n00439|                 <CardHeader className=\"pb-3\">\n00440|                   <div className=\"flex items-center justify-between\">\n00441|                     <div className=\"flex items-center gap-3\">\n00442|                       {getCategoryIcon(api.category)}\n00443|                       <div>\n00444|                         <CardTitle className=\"text-white text-lg\">{api.name}</CardTitle>\n00445|                         <p className=\"text-gray-400 text-sm\">{api.description}</p>\n00446|                       </div>\n00447|                     </div>\n00448|                     <div className=\"flex items-center gap-2\">\n00449|                       {getStatusIcon(api.status)}\n00450|                       <Badge variant={api.status === 'working' ? 'default' : 'destructive'}>\n00451|                         {getStatusText(api.status)}\n00452|                       </Badge>\n00453|                     </div>\n00454|                   </div>\n00455|                 </CardHeader>\n00456|                 <CardContent>\n00457|                   <div className=\"space-y-4\">\n00458|                     {api.errorMessage && (\n00459|                       <Alert className=\"border-red-500 bg-red-900/20\">\n00460|                         <AlertTriangle className=\"h-4 w-4\" />\n00461|                         <AlertDescription className=\"text-red-400\">\n00462|                           {api.errorMessage}\n00463|                         </AlertDescription>\n00464|                       </Alert>\n00465|                     )}\n00466| \n00467|                     <div className=\"grid grid-cols-2 gap-4\">\n00468|                       <div>\n00469|                         <Label className=\"text-gray-300 text-sm\">Последняя проверка</Label>\n00470|                         <p className=\"text-white text-sm\">\n00471|                           {api.lastChecked ? api.lastChecked.toLocaleString('ru-RU') : 'Не проверялся'}\n00472|                         </p>\n00473|                       </div>\n00474|                       <div>\n00475|                         <Label className=\"text-gray-300 text-sm\">Эндпоинты</Label>\n00476|                         <div className=\"flex flex-wrap gap-1\">\n00477|                           {api.endpoints.map((endpoint, idx) => (\n00478|                             <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n00479|                               {endpoint}\n00480|                             </Badge>\n00481|                           ))}\n00482|                         </div>\n00483|                       </div>\n00484|                     </div>\n00485| \n00486|                     <div className=\"flex gap-2\">\n00487|                       <Button\n00488|                         onClick={() => testApi(api)}\n00489|                         variant=\"outline\"\n00490|                         size=\"sm\"\n00491|                         className=\"border-blue-500 text-blue-400 hover:bg-blue-900/20\"\n00492|                       >\n00493|                         <Play className=\"h-3 w-3 mr-1\" />\n00494|                         Тест\n00495|                       </Button>\n00496|                       <Button\n00497|                         onClick={() => startEditing(api.key)}\n00498|                         variant=\"outline\"\n00499|                         size=\"sm\"\n00500|                         className=\"border-green-500 text-green-400 hover:bg-green-900/20\"\n00501|                       >\n00502|                         <Key className=\"h-3 w-3 mr-1\" />\n00503|                         Ключи\n00504|                       </Button>\n00505|                     </div>\n00506| \n00507|                     {editingApi === api.key && (\n00508|                       <Card className=\"bg-gray-700 border-gray-600 mt-4\">\n00509|                         <CardHeader className=\"pb-2\">\n00510|                           <CardTitle className=\"text-white text-sm\">Редактирование учетных данных</CardTitle>\n00511|                         </CardHeader>\n00512|                         <CardContent className=\"space-y-3\">\n00513|                           {Object.keys(api.credentials).map((key) => (\n00514|                             <div key={key}>\n00515|                               <Label className=\"text-gray-300 text-sm capitalize\">{key}</Label>\n00516|                               <Input\n00517|                                 type={key.includes('secret') || key.includes('password') ? 'password' : 'text'}\n00518|                                 value={editCredentials[key] || ''}\n00519|                                 onChange={(e) => setEditCredentials(prev => ({ ...prev, [key]: e.target.value }))}\n00520|                                 className=\"bg-gray-600 border-gray-500 text-white\"\n00521|                               />\n00522|                             </div>\n00523|                           ))}\n00524|                           <div className=\"flex gap-2\">\n00525|                             <Button onClick={saveCredentials} size=\"sm\" className=\"bg-green-600 hover:bg-green-700\">\n00526|                               Сохранить\n00527|                             </Button>\n00528|                             <Button onClick={() => setEditingApi(null)} variant=\"outline\" size=\"sm\">\n00529|                               Отмена\n00530|                             </Button>\n00531|                           </div>\n00532|                         </CardContent>\n00533|                       </Card>\n00534|                     )}\n00535|                   </div>\n00536|                 </CardContent>\n00537|               </Card>\n00538|             ))}\n00539|           </div>\n00540|         </TabsContent>\n00541| \n00542|         <TabsContent value=\"service\" className=\"mt-6\">\n00543|           <div className=\"grid gap-4\">\n00544|             {serviceApis.map((api) => (\n00545|               <Card key={api.key} className=\"bg-gray-800 border-gray-700\">\n00546|                 <CardHeader className=\"pb-3\">\n00547|                   <div className=\"flex items-center justify-between\">\n00548|                     <div className=\"flex items-center gap-3\">\n00549|                       {getCategoryIcon(api.category)}\n00550|                       <div>\n00551|                         <CardTitle className=\"text-white text-lg\">{api.name}</CardTitle>\n00552|                         <p className=\"text-gray-400 text-sm\">{api.description}</p>\n00553|                       </div>\n00554|                     </div>\n00555|                     <div className=\"flex items-center gap-2\">\n00556|                       {getStatusIcon(api.status)}\n00557|                       <Badge variant={api.status === 'working' ? 'default' : 'destructive'}>\n00558|                         {getStatusText(api.status)}\n00559|                       </Badge>\n00560|                     </div>\n00561|                   </div>\n00562|                 </CardHeader>\n00563|                 <CardContent>\n00564|                   <div className=\"space-y-4\">\n00565|                     {api.errorMessage && (\n00566|                       <Alert className=\"border-red-500 bg-red-900/20\">\n00567|                         <AlertTriangle className=\"h-4 w-4\" />\n00568|                         <AlertDescription className=\"text-red-400\">\n00569|                           {api.errorMessage}\n00570|                         </AlertDescription>\n00571|                       </Alert>\n00572|                     )}\n00573| \n00574|                     <div className=\"flex gap-2\">\n00575|                       <Button\n00576|                         onClick={() => testApi(api)}\n00577|                         variant=\"outline\"\n00578|                         size=\"sm\"\n00579|                         className=\"border-blue-500 text-blue-400 hover:bg-blue-900/20\"\n00580|                       >\n00581|                         <Play className=\"h-3 w-3 mr-1\" />\n00582|                         Тест\n00583|                       </Button>\n00584|                       <Button\n00585|                         onClick={() => startEditing(api.key)}\n00586|                         variant=\"outline\"\n00587|                         size=\"sm\"\n00588|                         className=\"border-green-500 text-green-400 hover:bg-green-900/20\"\n00589|                       >\n00590|                         <Key className=\"h-3 w-3 mr-1\" />\n00591|                         Ключи\n00592|                       </Button>\n00593|                     </div>\n00594|                   </div>\n00595|                 </CardContent>\n00596|               </Card>\n00597|             ))}\n00598|           </div>\n00599|         </TabsContent>\n00600| \n00601|         <TabsContent value=\"internal\" className=\"mt-6\">\n00602|           <div className=\"grid gap-4\">\n00603|             {internalApis.map((api) => (\n00604|               <Card key={api.key} className=\"bg-gray-800 border-gray-700\">\n00605|                 <CardHeader className=\"pb-3\">\n00606|                   <div className=\"flex items-center justify-between\">\n00607|                     <div className=\"flex items-center gap-3\">\n00608|                       {getCategoryIcon(api.category)}\n00609|                       <div>\n00610|                         <CardTitle className=\"text-white text-lg\">{api.name}</CardTitle>\n00611|                         <p className=\"text-gray-400 text-sm\">{api.description}</p>\n00612|                       </div>\n00613|                     </div>\n00614|                     <div className=\"flex items-center gap-2\">\n00615|                       {getStatusIcon(api.status)}\n00616|                       <Badge variant={api.status === 'working' ? 'default' : 'destructive'}>\n00617|                         {getStatusText(api.status)}\n00618|                       </Badge>\n00619|                       <Button\n00620|                         onClick={() => window.open(api.endpoints[0], '_blank')}\n00621|                         variant=\"outline\"\n00622|                         size=\"sm\"\n00623|                         className=\"border-purple-500 text-purple-400 hover:bg-purple-900/20\"\n00624|                       >\n00625|                         <ExternalLink className=\"h-3 w-3 mr-1\" />\n00626|                         Открыть\n00627|                       </Button>\n00628|                     </div>\n00629|                   </div>\n00630|                 </CardHeader>\n00631|               </Card>\n00632|             ))}\n00633|           </div>\n00634|         </TabsContent>\n00635|       </Tabs>\n00636|     </div>\n00637|   );\n00638| };\n00639| \n00640| export default ApiMasterTab;\n</file>",
    "title": "components/diagnostic/ApiMasterTab.tsx",
    "metadata": {
      "preview": "            body: JSON.stringify({ method: 'test' })\n          });\n          testResult = railResponse.ok;\n          break;\n\n        case 'nordwheel':\n           // NordWheel API test - check if API key is configured\n           const nordwheelApiKey = api.credentials.apiKey;\n           if (nordwheelApiKey && nordwheelApiKey.length > 0) {\n             testResult = true;\n           } else {\n             testResult = false;\n             errorMessage = 'API ключ NordWheel не настроен';\n           }\n           break;\n\n        case 'dadata':\n          const dadataResponse = await fetch('https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address', {\n            method: 'POST',\n            headers: {"
    },
    "time": {
      "start": 1763466855021,
      "end": 1763466855023
    }
  }
}