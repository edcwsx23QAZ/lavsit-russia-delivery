{
  "id": "prt_a96e0e7c0001tB32Kl3hWBTmfZ",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "messageID": "msg_a96e0cf34001H6tFLYWWle2bb9",
  "type": "tool",
  "callID": "call_90137268",
  "tool": "edit",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "test-nordwheel-api.js",
      "newString": "// Тестовый скрипт для проверки NordWheel API\nconst testNordWheelAPI = async () => {\n  const apiUrl = 'https://api.nordw.orog.ru/api/v1/calculate';\n\n  const requestData = {\n    dispatch: {\n      location: {\n        type: 'terminal',\n        terminal_id: '0c7a2795-1220-486d-a7ce-8bcf130a1224' // Москва terminal GUID\n      }\n    },\n    destination: {\n      location: {\n        type: 'terminal',\n        terminal_id: '3ca02b62-3632-4da0-8fde-de9d9c77c553' // СПб terminal GUID\n      }\n    },\n    cargo: {\n      total_weight: 10,\n      total_volume: 1.0,\n      total_quantity: 1\n    },\n    insurance: 1000,\n    insurance_refuse: false,\n    services: {\n      is_package: false,\n      is_documents_return: false,\n      is_fragile: false\n    },\n    promocode: null\n  };\n\n  try {\n    console.log('Отправка запроса к NordWheel API...');\n    console.log('URL:', apiUrl);\n    console.log('Request data:', JSON.stringify(requestData, null, 2));\n\n    const response = await fetch(apiUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${process.env.NORDWHEEL_API_KEY || '5|WYpV9f788Y2ASobpv3xy6N5qxtIUaKhxFF4yWETOfc398950'}`\n      },\n      body: JSON.stringify(requestData)\n    });\n\n    console.log('Статус ответа:', response.status);\n\n    if (!response.ok) {\n      console.error('Ошибка API:', response.status, response.statusText);\n      const errorText = await response.text();\n      console.error('Тело ошибки:', errorText);\n      return;\n    }\n\n    const data = await response.json();\n    console.log('Ответ от API:', JSON.stringify(data, null, 2));\n\n    if (data.success) {\n      console.log('Цена:', data.price);\n      console.log('Дни:', data.days);\n    } else {\n      console.log('API вернул success: false');\n      if (data.message) {\n        console.log('Сообщение:', data.message);\n      }\n    }\n\n  } catch (error) {\n    console.error('Ошибка соединения:', error);\n  }\n};\n\ntestNordWheelAPI();",
      "oldString": "// Тестовый скрипт для проверки NordWheel API\nconst testNordWheelTerminals = async () => {\n  const apiUrl = 'https://api.nordw.orog.ru/api/v1/terminals';\n\n  try {\n    console.log('Получение списка терминалов NordWheel...');\n\n    const response = await fetch(apiUrl, {\n      method: 'GET',\n      headers: {\n        'Authorization': `Bearer ${process.env.NORDWHEEL_API_KEY || '5|WYpV9f788Y2ASobpv3xy6N5qxtIUaKhxFF4yWETOfc398950'}`\n      }\n    });\n\n    console.log('Статус ответа:', response.status);\n\n    if (!response.ok) {\n      console.error('Ошибка API:', response.status, response.statusText);\n      const errorText = await response.text();\n      console.error('Тело ошибки:', errorText);\n      return;\n    }\n\n    const data = await response.json();\n    console.log('Терминалы:', JSON.stringify(data, null, 2));\n\n  } catch (error) {\n    console.error('Ошибка соединения:', error);\n  }\n};\n\nconst testNordWheelAPI = async () => {\n  const apiUrl = 'https://api.nordw.orog.ru/api/v1/calculate';\n\n  const requestData = {\n    dispatch: {\n      location: {\n        type: 'terminal',\n        terminal_id: '0c7a2795-1220-486d-a7ce-8bcf130a1224' // Москва terminal GUID\n      }\n    },\n    destination: {\n      location: {\n        type: 'terminal',\n        terminal_id: '3ca02b62-3632-4da0-8fde-de9d9c77c553' // СПб terminal GUID\n      }\n    },\n    cargo: {\n      total_weight: 10,\n      total_volume: 1.0,\n      total_quantity: 1\n    },\n    insurance: 1000,\n    insurance_refuse: false,\n    services: {\n      is_package: false,\n      is_documents_return: false,\n      is_fragile: false\n    },\n    promocode: null\n  };\n\n  try {\n    console.log('Отправка запроса к NordWheel API...');\n    console.log('URL:', apiUrl);\n    console.log('Request data:', JSON.stringify(requestData, null, 2));\n\n    const response = await fetch(apiUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${process.env.NORDWHEEL_API_KEY || '5|WYpV9f788Y2ASobpv3xy6N5qxtIUaKhxFF4yWETOfc398950'}`\n      },\n      body: JSON.stringify(requestData)\n    });\n\n    console.log('Статус ответа:', response.status);\n\n    if (!response.ok) {\n      console.error('Ошибка API:', response.status, response.statusText);\n      const errorText = await response.text();\n      console.error('Тело ошибки:', errorText);\n      return;\n    }\n\n    const data = await response.json();\n    console.log('Ответ от API:', JSON.stringify(data, null, 2));\n\n    if (data.success) {\n      console.log('Цена:', data.price);\n      console.log('Дни:', data.days);\n    } else {\n      console.log('API вернул success: false');\n      if (data.message) {\n        console.log('Сообщение:', data.message);\n      }\n    }\n\n  } catch (error) {\n    console.error('Ошибка соединения:', error);\n  }\n};\n\n// Сначала получим терминалы, потом протестируем расчет\ntestNordWheelTerminals().then(() => {\n  console.log('\\n--- Тестирование расчета ---\\n');\n  testNordWheelAPI();\n});"
    },
    "output": "",
    "title": "test-nordwheel-api.js",
    "metadata": {
      "diagnostics": {},
      "diff": "Index: /home/user/project/test-nordwheel-api.js\n===================================================================\n--- /home/user/project/test-nordwheel-api.js\n+++ /home/user/project/test-nordwheel-api.js\n@@ -1,16 +1,48 @@\n // Тестовый скрипт для проверки NordWheel API\n-const testNordWheelTerminals = async () => {\n-  const apiUrl = 'https://api.nordw.orog.ru/api/v1/terminals';\n+const testNordWheelAPI = async () => {\n+  const apiUrl = 'https://api.nordw.orog.ru/api/v1/calculate';\n \n+  const requestData = {\n+    dispatch: {\n+      location: {\n+        type: 'terminal',\n+        terminal_id: '0c7a2795-1220-486d-a7ce-8bcf130a1224' // Москва terminal GUID\n+      }\n+    },\n+    destination: {\n+      location: {\n+        type: 'terminal',\n+        terminal_id: '3ca02b62-3632-4da0-8fde-de9d9c77c553' // СПб terminal GUID\n+      }\n+    },\n+    cargo: {\n+      total_weight: 10,\n+      total_volume: 1.0,\n+      total_quantity: 1\n+    },\n+    insurance: 1000,\n+    insurance_refuse: false,\n+    services: {\n+      is_package: false,\n+      is_documents_return: false,\n+      is_fragile: false\n+    },\n+    promocode: null\n+  };\n+\n   try {\n-    console.log('Получение списка терминалов NordWheel...');\n+    console.log('Отправка запроса к NordWheel API...');\n+    console.log('URL:', apiUrl);\n+    console.log('Request data:', JSON.stringify(requestData, null, 2));\n \n     const response = await fetch(apiUrl, {\n-      method: 'GET',\n+      method: 'POST',\n       headers: {\n+        'Content-Type': 'application/json',\n         'Authorization': `Bearer ${process.env.NORDWHEEL_API_KEY || '5|WYpV9f788Y2ASobpv3xy6N5qxtIUaKhxFF4yWETOfc398950'}`\n-      }\n+      },\n+      body: JSON.stringify(requestData)\n     });\n \n     console.log('Статус ответа:', response.status);\n \n@@ -21,8 +53,37 @@\n       return;\n     }\n \n     const data = await response.json();\n+    console.log('Ответ от API:', JSON.stringify(data, null, 2));\n+\n+    if (data.success) {\n+      console.log('Цена:', data.price);\n+      console.log('Дни:', data.days);\n+    } else {\n+      console.log('API вернул success: false');\n+      if (data.message) {\n+        console.log('Сообщение:', data.message);\n+      }\n+    }\n+\n+  } catch (error) {\n+    console.error('Ошибка соединения:', error);\n+  }\n+};\n+\n+testNordWheelAPI();\n+\n+    console.log('Статус ответа:', response.status);\n+\n+    if (!response.ok) {\n+      console.error('Ошибка API:', response.status, response.statusText);\n+      const errorText = await response.text();\n+      console.error('Тело ошибки:', errorText);\n+      return;\n+    }\n+\n+    const data = await response.json();\n     console.log('Терминалы:', JSON.stringify(data, null, 2));\n \n   } catch (error) {\n     console.error('Ошибка соединения:', error);\n"
    },
    "time": {
      "start": 1763467913154,
      "end": 1763467913161
    }
  }
}