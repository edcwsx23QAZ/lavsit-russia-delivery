{
  "id": "prt_98b7eb0df001sElf4v0khwU3c3",
  "type": "text",
  "text": "1. Для Деловых Линий в случае возникновения в логе любых ошибок пропиши процедуру повторной авторизации через логин и пароль, и получения SessionID\n2. Для ПЭК проверь варианты обработки успешного ответа в строке  1425:26.\n\nТакже документация для метода Метод /calculator/calculateprice/ описана ниже:\n\nМетод /calculator/calculateprice/ — расчет стоимости и сроков перевозки\nДоступ\nЗарегистрированные пользователи\nКомментарии\nОбщие рекомендации по передаче адреса забора/доставки в запрос при интеграции с транспортной компанией\nВыбор адреса отправления и адреса получения осуществляется по следующей логике: если заказана услуга забора/доставки, то расчет стоимости ведется по координатам напрямую переданным в запрос (параметр \"coordinates\" блоков pickup / delivery), или координатам, полученным по переданной строке адреса (параметр \"address\" блоков pickup / delivery). Все прочие параметры определяющие адреса будут проигнорированы.\nЕсли услуга забора/доставки не заказана, то необходимо передавать ID склада отправления/назначения (параметр senderWarehouseId / receiverWarehouseId).\nID склада населенного пункта (с отбором по разрешенным габаритам можно получить методом /branches/nearestdepartments, возвращающим ближайшие отделения к переданному в запрос адресу. Или самостоятельно выбирать удобное отделение/склад из ответа метода /branches/all (поле branches[].divisions[].warehouses[].id), при этом необходимо учитывать доступность складов по габаритам и разрешенных для них операций.\nБыстро получить ID склада основного отделения любого филиала можно используя метод /branches/findzonebyaddress. в ответе метода реквизит mainWarehouseId. Основное отделение является центральным складом конкретного филиала, из которого можно дозаказать доставку до адреса или ПВЗ, который относится к зоне обслуживаемого филиала.\nНапример, по адресу «Самарская область, город Отрадный», основным является отделение филиала «Самара» по адресу: ул. Земеца, д. 32 литера 354, так как город Отрадный обслуживает филиал «Самара».\nОбъекты со стоимостью услуг для разных видов перевозки возвращаются отдельно в массиве transfers. Тип перевозки указывается в поле объекта transfers[].type; 3 соответствует автоперевозке, 1 — авиа.\nСроки авиаперевозки могут указываться несколькими значениями, для разных вариантов времени сдачи груза на склад отправителем. В ответе метод возвращает массив данных по времени приемки груза — transportingTimes. Количество элементов в массивах сроков перевозки commonTerms[].transporting и перевозки с доставкой commonTerms[].transportingWithDelivery равно количеству элементов в данном массиве transportingTimes. Чтобы определить ориентировочный срок доставки, нужно сначала выбрать элемент массива данных по времени приемки груза transportingTimes со временем, ранее которого груз был сдан на склад. После этого ориентировочный срок доставки можно смотреть в соответствующих элементах массивов commonTerms[].transporting и commonTerms[].transportingWithDelivery.\nВ массиве cargos нужно передавать информацию по каждому грузоместу груза, заполняя несколько элементов массива. Каждый элемент массива будет восприниматься, как отдельное грузоместо одного груза. Если Вам известны габариты и вес каждого грузоместа, то передавайте Длину, Ширину, Высоту и Вес. Если Вам известны только общие габариты всего груза (Объём, Вес, Максимальный габарит и количество мест) и не известны вес и габариты каждого грузоместа, то передавайте на вход столько элементов массива - сколько мест. В каждом элементе массива указывайте средние Вес и Объём грузоместа (разделите общий вес груза и общий объём груза на кол-во мест) и Максимальный габарит грузоместа. Важно! Признак isHP в калькуляторе рассчитывается всегда по грузу в целом - если хотя бы у одного грузоместа значение будет true, то защитная транспортировочная упаковка будет рассчитана для всего груза.\nПараметр needReturnDocuments необязательный. Выберите, если необходим возврат документов с подписью и печатью получателя, подтверждающих, что груз им получен. Подробнее.\nПараметр needArrangeTransportationDocuments необязательный. Выберите, чтобы расчитать передачу вместе с грузом комплекта сопроводительных документов, которые будут выданы грузополучателю вместе с грузом. Подробнее.\nАрхив с примерами минимальных запросов CalculatePrice (.zip, 2Кб).\nФормат запроса\n{\n   \"currencyCode\": \"643\", // Код валюты [String]. Необязательно. По умолчанию 643 - российский рубль.\n                          // Допустимые валюты см.в ответе метода /currency/all/\n\n   \"types\": [ 1 ], // Массив идентификаторов продуктов/тарифов ПЭК для расчета [Array][Number]. Обязательно.\n                   // Полный список доступных в API продуктов/тарифов можно получить методом /typesOfDelivery/all/\n                   // ВНИМАНИЕ! В настоящее время метод не позволяет рассчитывать стоимость по продукту/тарифу 5 - ПЭК:Express Авто \n   \"senderWarehouseId\": \"dc6c746d-812d-11e4-bbfc-001999d8b3c5\", // Идентификатор склада отправителя [String]\n   \"receiverWarehouseId\": \"b436c978-086d-11e6-b6ca-00155d668909\", // Идентификатор склада получателя [String]\n   \"isOpenCarSender\": false, // Растентовка отправителя [Boolean]\n   \"isOpenCarReceiver\": false, // Растентовка получателя [Boolean]\n   \"isHyperMarket\": false, // признак гипермаркета [Boolean]\n   \"plannedDateTime\": \"2023-02-28T14:00:00\", // Дата и время планируемой передачи груза в ПЭК (по часовому поясу филиала отправления) [DateTime]:\n                                             // при заказанном заборе - дата и время начала интервала забора груза \n                                             // (не позднее 4-х часов до окончания работы филиала),\n                                             // при самопривозе - дата и время плановой сдачи груза на склад ПЭК\n   \"isInsurance\": true, // Страхование [Boolean]\n   \"isInsurancePrice\": 234.15, // Стоимость груза (сумма, на которую будет застрахован груз), руб [Number]\n   \"isPickUp\": false, // Нужен забор [Boolean]\n   \"isDelivery\": false, // Нужна доставка [Boolean]\n   \"needReturnDocuments\": false, // Возврат документов [Boolean] (см. комментарии)\n   \"needArrangeTransportationDocuments\": false, // Организация перевозки сопроводительных документов [Boolean] (см. комментарии)\n   \n   \"senderDistanceType\": 0, // В актуальной версии протокола не используется [Number]\n   \"receiverDistanceType\": 0, // В актуальной версии протокола не используется [Number]\n   \"pickupServices\": { // Погрузочно-разгрузочные работы при заборе\n       \"isLoading\": true, // Расчитывать ПРР [Boolean]\n       \"floor\": 0, // Поднять/спустить на этаж [Number]\n       \"carryingDistance\": 0, // Перенести груз (в метрах) [Number]\n       \"isElevator\": false // Подъем на лифте [Boolean]\n    },\n   \"deliveryServices\": { // Погрузочно-разгрузочные работы при доставке\n       \"isLoading\": true, // Расчитывать ПРР [Boolean]\n       \"floor\": 3, // Поднять/спустить на этаж [Number]\n       \"carryingDistance\": 50, // Перенести груз (в метрах) [Number]\n       \"isElevator\": true // Подъем на лифте [Boolean]\n   },\n   \"pickup\": {\n        \"address\" : \"Россия, Москва, улица Большая Лубянка, 2\",\t// Обязательный параметр для расчёта забора груза. Для успешного определения \n                                                                // координат адреса забора, передавайте все составляющие адреса в такой \n                                                                // последовательности: страна, регион, район, населенный пункт, улица, дом, \n                                                                // квартира и разделяйте их запятыми. Запрещено в данной строке указывать \n                                                                // данные, не являющиеся частью адреса (см. комментарии)\n        \"coordinates\" : { // Необязательный параметр координат адреса (используется для точности вычислений)\n            \"latitude\" : \"55.761011\",\n            \"longitude\" : \"37.627553\"\n        }\n   },\n   \"delivery\" : {\n        \"address\" : \"Россия, Москва, улица Большая Лубянка, 2\",\t// Обязательный параметр для расчёта доставки груза. Для успешного определения \n                                                                // координат адреса доставки, передавайте все составляющие адреса в такой \n                                                                // последовательности: страна, регион, район, населенный пункт, улица, дом, \n                                                                // квартира и разделяйте их запятыми. Запрещено в данной строке указывать \n                                                                // данные, не являющиеся частью адреса (см. комментарии)\n        \"coordinates\" : { // Необязательный параметр координат адреса (используется для точности вычислений)\n            \"latitude\" : \"55.761011\",\n            \"longitude\" : \"37.627553\"\n        }\n   },\n   \"counterpart\": { // Данные контрагента для расчета с учетом спецусловий\n        \"inn\": \"1234567890\", // ИНН контрагента [String]\n        \"kpp\": \"123456789\", // КПП контрагента [String], поле необязательно\n        \"counterpartClientCard\": \"1234567890\", // Номер карты клиента [String]\n        \"whoMakesCalculation\": [1,2,3,4] // Роль заказчика перевозки  [Array][Number]. (Кто производит расчет: \n                                         // 1 - отправитель, 2 - получатель, 3 - плательщик, 4 - не участник перевозки)\n   },\n   \"cargos\": [{ // Данные о грузе/грузоместах груза (см. комментарии) [Array]\n                // Для корректного расчёта передавайте не более двух знаков после запятой, \n                // На нашей стороне округление выполняется до сотых в большую сторону.\n                // Например, 0.00041 будет 0.01;  1.871001 будет 1.88\n      \"length\": 3.2, // Длина груза, м [Number]. Необязательно, если передан maxSize\n      \"width\": 0.9, // Ширина груза, м [Number]. Необязательно, если передан maxSize\n      \"height\": 1.5, // Высота груза, м [Number]. Необязательно, если передан maxSize\n      \"volume\": 4.32, // Объем груза, м3 [Number]. Необязательно, если переданы длина, ширина, высота.\n      \"maxSize\": 3.2, // Максимальный габарит, м [Number]. Необязательно, если переданы длина, ширина, высота (которые имеют приоритет). \n      \"isHP\": false, // Защитная транспортировочная упаковка [Boolean]. Необязательно\n      \"sealingPositionsCount\": 0, // Количество мест для пломбировки - пломб (применяются для небольших мест или сложных грузов)[Number]. Необязательно.\n      \"weight\": 622.5 // Вес, кг [Number]. Обязательно.\n      \"maxPlaceWeight\": 50.2 [Number] // максимальный вес грузоместа. Необязательно.\n                                      // Рекомендуем передавать только в массиве с одним элементом\n                                      // для общих параметров всего груза.\n   }]\n}\nФормат ответа\n{\n    \"hasError\": false, // Признак ошибок при расчетах [Boolean]\n    \"errorMessage\": null, // Текст ошибки [String]\n    \"currencyCode\": \"643\", // Код валюты, в которой выполнен расчет стоимости [String]\n    \"branchSenderUID\": \"b473ce9f-dd68-44ea-a4b2-4cb63b6e970d\",// Идентификатор филиала отправления [String]\n    \"branchSender\": \"Москва Восток\", // Наименование филиала отправления [String]. \n                                     // Отвечает за оказание услуги \"первая миля\". При сдаче в отделении \n                                     // выводится филиал по организационной структуре\n    \"branchReceiverUID\": \"64adbe2c-a185-11dc-a911-000a5e19ccb4\",// Идентификатор филиала получения [String]\n    \"branchReceiver\": \"Санкт-Петербург\", // Наименование филиала получения [String]. \n                                         // Отвечает за оказание услуги \"последняя миля\". При выдаче в отделении\n                                         // выводится филиал по организационной структуре\n    \"transfers\": [{ // Результаты расчетов по каждому из запрошенных продуктов/тарифов [Array]\n            \"type\": 3, // Продукт/тариф, для которого выведена стоимость [Number]\n            \"hasError\": false, // Признак ошибок при расчетах [Boolean]\n            \"errorMessage\": null, // Текст ошибки [String]\n            \"costTotal\": 5319, // Общая стоимость услуг по продукту/тарифу, руб. [Number]\n            \"estDeliveryTime\": 3, // Срок перевозки (календарные дни) [Number]. На основании заказанных услуг забора/доставки\n            \"services\": [// Данные по услугам, входящим в продукт/тариф [Array]\n                // Перечень услуг, которые будут выставлены в УПД, после перевозки груза с указанными параметрами\n                // Каждый элемент массива и подмассива - отдельная услуга, со своей стоимостью\n                {\n                    \"serviceType\": \"Перевозка\", // Наименование группы услуги [String]\n                    \"senderCity\": \"Москва\", // Город отправитель [String]\n                    \"cost\": 5269, // Сумма за услугу, руб. [String]\n                    \"info\": \"Перевозка:\" // Наименование конкретной услуги [String]\n                    \"services\": null // Вложенные услуги [Array] элементов service\n                }, {\n                    \"serviceType\": \"Перевозка\",\n                    \"senderCity\": \"Москва\",\n                    \"cost\": 50,\n                    \"info\": \"Страхование:\",\n                    \"services\": null\n                }, {\n                    \"serviceType\": \"Перевозка\",\n                    \"senderCity\": \"Москва\",\n                    \"cost\": 446.6, // Стоимость основной услуги (не включает стоимости подуслуг из вложенного массива services)\n                    \"info\": \"Доставка груза\",\n                    \"services\": [// Массив отдельно выделяемых услуг со стоимостью [Array].\n                        //Стоимость услуг из массива НЕ ВХОДИТ в стоимость (реквизит Cost) родительского элемента\n                        {\n                            \"serviceType\": \"Перевозка\",\n                            \"senderCity\": \"Москва\",\n                            \"cost\": 200.0,\n                            \"info\": \"Перенос груза по улице и внутри зданий более 30 метров\",\n                            \"services\": null\n                        }, {\n                            \"serviceType\": \"Перевозка\",\n                            \"senderCity\": \"Москва\",\n                            \"cost\": 250.0,\n                            \"info\": \"Погрузо-разгрузочные работы\",\n                            \"services\": null\n                        }\n                    ]\n                }\n            ],\n            \"transportingTypes\": 1 // В актуальной версии протокола API не используется\n        }, {\n            \"type\": 1,\n            \"hasError\": true,\n            \"errorMessage\": \"Длина груза превышает допустимую для АВИА. Допустимая длина 2 м.\n            Груз может быть не принят к данному виду перевозки; Ширина груза превышает допустимую для АВИА. Допустимая ширина 1 м.\n            Груз может быть не принят к данному виду перевозки; Высота груза превышает допустимую для АВИА. Допустимая высота 0,8 м.\n            Груз может быть не принят к данному виду перевозки\",\n            \"costTotal\": 0,\n            \"services\": [],\n            \"transportingTypes\": 2 // В актуальной версии протокола API не используется\n        }, {\n            \"type\": 12,\n            \"hasError\": false,\n            \"errorMessage\": null,\n            \"costTotal\": 430.0,\n            \"services\": [{\n                    \"serviceType\": \"Перевозка\",\n                    \"senderCity\": \"Москва\",\n                    \"cost\": 430.0,\n                    \"info\": \"Автоперевозка\",\n                    \"services\": null\n                }\n            ]\n        }\n    ],\n    \"transportingTimes\": [// Массив данных по времени приемки груза [Array]. Используется для точного определения сроков перевозки.\n        \"0001-01-01T12:00:00\", // Значения времени, до которого ожидается, что груз будет сдан на склад.\n        // Из соответствующего элемента массива transporting или\n        // transportingWithDelivery нужно взять значение сроков перевозки\n        \"0001-01-01T15:00:00\",\n        \"0001-01-01T17:00:00\"\n    ],\n    \"commonTerms\": [{ // Общие данные по срокам перевозок [Array]\n            // Значения по срокам перевозки представлены в виде строки \"КоличествоДнейПеревозки\"\n            // или \"МинимальноеКоличествоДнейПеревозки – МаксимальноеКоличествоДнейПеревозки\"\n            \"type\": 3, // Продукт/тариф, для которого выведены сроки перевозки [Number]\n            \"branchSender\": \"Москва Восток\", // Филиал-отправитель [String]\n            \"branchReceiver\": \"Санкт-Петербург\", // Филиал-получатель [String]\n            \"discountedDeliveryWeekDays\": [// Дни льготной доставки [Array]\n                2, 4 // Значения соответствуют дню недели льготной доставки (понедельник - 1, воскресенье - 7)\n            ],\n            \"transporting\": [// Ориентировочные сроки перевозки, суток [Array]\n                // из массива надо выбрать элемент в соответствии со временем сдачи груза на склад и\n                // Массивом данных по времени приемки груза transportingTimes\n                \"1\",\n                \"1 - 2\",\n                \"2 - 3\"\n            ],\n            \"transportingWithDelivery\": [// Ориентировочные сроки перевозки с доставкой, суток [Array]\n                \"2 - 3\",\n                \"2 - 4\",\n                \"3 - 5\"\n            ],\n            \"transportingWithPickup\": \"3 - 4\", // Срок перевозки с забором, суток [String]\n            \"transportingWithDeliveryWithPickup\": \"4 - 6\", // Срок перевозки с забором и доставкой, суток [String]\n            \"senderShippingDays\": [// Указываются дни недели отправки груза из филиала отправления в филиал получения. 1 - ПН, 2 - ВТ и т.д\n                1,\n                2,\n                3,\n                4,\n                5,\n                6\n            ],\n            \"transportingTypes\": 1 // В актуальной версии протокола API не используется\n        }, {\n            \"type\": 12,\n            ...\n        }, {\n            \"type\": 1,\n            ...\n        }\n    ]\n}\nМетод /calculator/checkdeliverydate/ — возвращает ближайшие даты и интервалы времени по дате забора/доставки от даты запроса \"requestDateTime\"\nДоступ\nЗарегистрированные пользователи\nФормат запроса\n{\n    \"requestDateTime\": \"2023-01-17\", // дата запроса, необязательный параметр,\n                                     // если не заполнен считается от текущей даты [Date]\n    \"calculateDays\": 1, // количество дней для расчета забора/доставки от даты запроса, расчет не более 7 дней,\n                        // если не заполнен значение по умолчанию равно 1 [Number], необязательный параметр\n    \"address\": \"Россия, Москва, улица Большая Лубянка, 2\",  // адрес забора/доставки груза [String],необязательный параметр, если переданы координаты\n    \"coordinates\": { // координаты адреса забора/доставки (используется для точности вычислений), \n                     // если переданы координаты, то значение в поле address игнорируется. Необязательный параметр\n        \"latitude\": 55.761016, // [Number]\n        \"longitude\": 37.627562 // [Number] \n    }\n}\nФормат ответа\n[\n    {\n        \"date\": \"2022-12-31T00:00:00\", // ближайший день забора/доставки от переданной даты в запросе [DateTime]\n        \"isPreferential\": false, // в этот день действует льготный тариф на забор/доставку по запрошенному адресу [Boolean]\n        \"periods\": [ // минимальные временные интервалы на забор/доставку груза\n            {\n                \"periodTimeFrom\": \"14:00:00\",  // время начала интервала [TimeSpan]\n                \"periodTimeTo\": \"18:00:00\", // время окончания интервала [TimeSpan]\n                \"isDayLight\": true // временной интервал без наценки на забор/доставку в ночное время [Boolean], \n                                   // значение false означает, что будет наценка за ночное время (возможность оказания услуги необходимо уточнять у менеджера)\n            },\n            {\n                \"periodTimeFrom\": \"15:00:00\",\n                \"periodTimeTo\": \"19:00:00\",\n                \"isDayLight\": true\n            },\n            {\n                \"periodTimeFrom\": \"16:00:00\",\n                \"periodTimeTo\": \"20:00:00\",\n                \"isDayLight\": true\n            },\n            {\n                \"periodTimeFrom\": \"17:00:00\",\n                \"periodTimeTo\": \"21:00:00\",\n                \"isDayLight\": true\n            },\n            {\n                \"periodTimeFrom\": \"18:00:00\",\n                \"periodTimeTo\": \"22:00:00\",\n                \"isDayLight\": true\n            },\n            {\n                \"periodTimeFrom\": \"19:00:00\",\n                \"periodTimeTo\": \"23:00:00\",\n                \"isDayLight\": true\n            },\n            {\n                \"periodTimeFrom\": \"20:00:00\",\n                \"periodTimeTo\": \"00:00:00\",\n                \"isDayLight\": true\n            },\n            {\n                \"periodTimeFrom\": \"21:00:00\",\n                \"periodTimeTo\": \"01:00:00\",\n                \"isDayLight\": true\n            },\n            {\n                \"periodTimeFrom\": \"22:00:00\",\n                \"periodTimeTo\": \"02:00:00\",\n                \"isDayLight\": true\n            },\n            {\n                \"periodTimeFrom\": \"23:00:00\",\n                \"periodTimeTo\": \"03:00:00\",\n                \"isDayLight\": true\n            }\n        ]\n    }\n]",
  "messageID": "msg_98b7eb0dd001pVyhaWs89EHtyN",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14"
}