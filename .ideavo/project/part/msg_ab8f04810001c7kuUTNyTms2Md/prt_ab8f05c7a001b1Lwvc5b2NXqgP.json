{
  "id": "prt_ab8f05c7a001b1Lwvc5b2NXqgP",
  "sessionID": "ses_54b97e247ffenCZZa4jZiIWD0l",
  "messageID": "msg_ab8f04810001c7kuUTNyTms2Md",
  "type": "tool",
  "callID": "call_a5995795e63a4e6082daa677",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/api/calculations/route.ts"
    },
    "output": "<file>\n00001| import { NextRequest, NextResponse } from 'next/server';\n00002| import { PrismaClient } from '@prisma/client';\n00003| \n00004| const prisma = new PrismaClient();\n00005| \n00006| export async function POST(request: NextRequest) {\n00007|   try {\n00008|     const body = await request.json();\n00009|     const { orderNumber, formData, results, screenshot } = body;\n00010| \n00011|     console.log('üíæ Saving calculation:', { orderNumber, hasScreenshot: !!screenshot });\n00012| \n00013|     // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π\n00014|     if (!formData || !results) {\n00015|       return NextResponse.json(\n00016|         { \n00017|           success: false, \n00018|           error: 'Missing required fields: formData and results are required' \n00019|         },\n00020|         { status: 400 }\n00021|       );\n00022|     }\n00023| \n00024|     // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\n00025|     const calculation = await prisma.calculation.create({\n00026|       data: {\n00027|         orderNumber: orderNumber || null,\n00028|         formData: formData,\n00029|         results: results,\n00030|         screenshot: screenshot || null,\n00031|         status: 'active'\n00032|       }\n00033|     });\n00034| \n00035|     console.log('‚úÖ Calculation saved successfully:', calculation.id);\n00036| \n00037|     return NextResponse.json({\n00038|       success: true,\n00039|       data: {\n00040|         id: calculation.id,\n00041|         orderNumber: calculation.orderNumber,\n00042|         createdAt: calculation.createdAt\n00043|       }\n00044|     });\n00045| \n00046|   } catch (error: any) {\n00047|     console.error('‚ùå Error saving calculation:', error);\n00048|     \n00049|     // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\n00050|     if (error.code === 'P1001') {\n00051|       return NextResponse.json(\n00052|         { \n00053|           success: false, \n00054|           error: 'Database connection error. Please check DATABASE_URL configuration.' \n00055|         },\n00056|         { status: 500 }\n00057|       );\n00058|     }\n00059| \n00060|     // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Prisma\n00061|     if (error.code === 'P2002') {\n00062|       return NextResponse.json(\n00063|         { \n00064|           success: false, \n00065|           error: 'Order number already exists. Please use a different order number.' \n00066|         },\n00067|         { status: 409 }\n00068|       );\n00069|     }\n00070| \n00071|     return NextResponse.json(\n00072|       { \n00073|         success: false, \n00074|         error: 'Internal server error: ' + error.message \n00075|       },\n00076|       { status: 500 }\n00077|     );\n00078|   } finally {\n00079|     await prisma.$disconnect();\n00080|   }\n00081| }\n00082| \n00083| export async function GET(request: NextRequest) {\n00084|   try {\n00085|     const { searchParams } = new URL(request.url);\n00086|     const orderNumber = searchParams.get('orderNumber');\n00087| \n00088|     console.log('üìã Fetching calculations:', { orderNumber });\n00089| \n00090|     if (orderNumber) {\n00091|       // –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∑–∞–∫–∞–∑–∞\n00092|       const calculation = await prisma.calculation.findUnique({\n00093|         where: { orderNumber }\n00094|       });\n00095| \n00096|       if (!calculation) {\n00097|         return NextResponse.json(\n00098|           { \n00099|             success: false, \n00100|             error: 'Calculation not found' \n00101|           },\n00102|           { status: 404 }\n00103|         );\n00104|       }\n00105| \n00106|       return NextResponse.json({\n00107|         success: true,\n00108|         data: calculation\n00109|       });\n00110|     } else {\n00111|       // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–∞—Å—á–µ—Ç–æ–≤ (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ)\n00112|       const calculations = await prisma.calculation.findMany({\n00113|         orderBy: { createdAt: 'desc' },\n00114|         take: 50 // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n00115|       });\n00116| \n00117|       return NextResponse.json({\n00118|         success: true,\n00119|         data: calculations\n00120|       });\n00121|     }\n00122| \n00123|   } catch (error: any) {\n00124|     console.error('‚ùå Error fetching calculations:', error);\n00125|     \n00126|     return NextResponse.json(\n00127|       { \n00128|         success: false, \n00129|         error: 'Internal server error: ' + error.message \n00130|       },\n00131|       { status: 500 }\n00132|     );\n00133|   } finally {\n00134|     await prisma.$disconnect();\n00135|   }\n00136| }\n</file>",
    "title": "app/api/calculations/route.ts",
    "metadata": {
      "preview": "import { NextRequest, NextResponse } from 'next/server';\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { orderNumber, formData, results, screenshot } = body;\n\n    console.log('üíæ Saving calculation:', { orderNumber, hasScreenshot: !!screenshot });\n\n    // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π\n    if (!formData || !results) {\n      return NextResponse.json(\n        { \n          success: false, \n          error: 'Missing required fields: formData and results are required' \n        },\n        { status: 400 }"
    },
    "time": {
      "start": 1764039351420,
      "end": 1764039351425
    }
  }
}