{
  "id": "prt_9853bb9b6001XWVm9LP17pRtaE",
  "messageID": "msg_9853abeef00102ZzqvYw8pQ3gw",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "edit",
  "callID": "toolu_012M17dNgcmrUPNyFb26zd5Z",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx",
      "oldString": "  // Получение доступных упаковок Деловые Линии\n  const getDellinPackages = async (fromPoint: string, toPoint: string, cargo: any): Promise<string | null> => {\n    try {\n      const response = await fetch('https://api.dellin.ru/v1/public/packages_available.json', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n          arrivalPoint: toPoint,\n          derivalPoint: fromPoint,\n          length: cargo.length / 100, // в метрах\n          width: cargo.width / 100,\n          height: cargo.height / 100,\n          weight: cargo.weight,\n          quantity: 1\n        })\n      });\n\n      const data = await response.json();\n      console.log('Деловые Линии доступные упаковки:', data);\n      \n      if (response.ok && data.packages && data.packages.length > 0) {\n        // Берем первый доступный пакет\n        return data.packages[0].uid;\n      }\n      \n      return null;\n    } catch (error) {\n      console.error('Ошибка получения упаковок Деловые Линии:', error);\n      return null;\n    }\n  };",
      "newString": "  // Получение доступных упаковок Деловые Линии\n  const getDellinPackages = async (fromPoint: string, toPoint: string, cargo: any): Promise<string | null> => {\n    try {\n      // Для демонстрации используем примерные коды городов\n      // В реальности нужно получать их из API городов/терминалов\n      const cityCodeMap: { [key: string]: string } = {\n        'москва': '7700000000000000000000000',\n        'санкт-петербург': '7800000000000000000000000',\n        'спб': '7800000000000000000000000',\n        'петербург': '7800000000000000000000000',\n        'екатеринбург': '6600000000000000000000000',\n        'новосибирск': '5400000000000000000000000',\n        'нижний новгород': '5200000000000000000000000',\n        'самара': '6300000000000000000000000',\n        'краснодар': '2300000000000000000000000',\n        'ростов-на-дону': '6100000000000000000000000',\n        'казань': '1600000000000000000000000'\n      };\n\n      const fromCode = cityCodeMap[fromPoint.toLowerCase().trim()] || fromPoint;\n      const toCode = cityCodeMap[toPoint.toLowerCase().trim()] || toPoint;\n\n      const requestBody = {\n        appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n        arrivalPoint: toCode,\n        derivalPoint: fromCode,\n        length: cargo.length / 100, // в метрах\n        width: cargo.width / 100,\n        height: cargo.height / 100,\n        weight: cargo.weight,\n        quantity: 1\n      };\n\n      console.log('Деловые Линии запрос упаковок:', requestBody);\n\n      const response = await fetch('https://api.dellin.ru/v1/public/packages_available.json', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(requestBody)\n      });\n\n      const data = await response.json();\n      console.log('Деловые Линии доступные упаковки:', data);\n      \n      if (response.ok && data.packages && data.packages.length > 0) {\n        // Берем первый доступный пакет без несовместимостей\n        const compatiblePackage = data.packages.find((pkg: any) => \n          !pkg.incompatible_uids || pkg.incompatible_uids.length === 0\n        );\n        return compatiblePackage?.uid || data.packages[0].uid;\n      }\n      \n      return null;\n    } catch (error) {\n      console.error('Ошибка получения упаковок Деловые Линии:', error);\n      return null;\n    }\n  };"
    },
    "output": "",
    "metadata": {
      "diagnostics": {},
      "diff": "Index: /home/user/project/app/page.tsx\n===================================================================\n--- /home/user/project/app/page.tsx\n+++ /home/user/project/app/page.tsx\n@@ -267,31 +267,57 @@\n \n // Получение доступных упаковок Деловые Линии\n const getDellinPackages = async (fromPoint: string, toPoint: string, cargo: any): Promise<string | null> => {\n   try {\n+    // Для демонстрации используем примерные коды городов\n+    // В реальности нужно получать их из API городов/терминалов\n+    const cityCodeMap: { [key: string]: string } = {\n+      'москва': '7700000000000000000000000',\n+      'санкт-петербург': '7800000000000000000000000',\n+      'спб': '7800000000000000000000000',\n+      'петербург': '7800000000000000000000000',\n+      'екатеринбург': '6600000000000000000000000',\n+      'новосибирск': '5400000000000000000000000',\n+      'нижний новгород': '5200000000000000000000000',\n+      'самара': '6300000000000000000000000',\n+      'краснодар': '2300000000000000000000000',\n+      'ростов-на-дону': '6100000000000000000000000',\n+      'казань': '1600000000000000000000000'\n+    };\n+\n+    const fromCode = cityCodeMap[fromPoint.toLowerCase().trim()] || fromPoint;\n+    const toCode = cityCodeMap[toPoint.toLowerCase().trim()] || toPoint;\n+\n+    const requestBody = {\n+      appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n+      arrivalPoint: toCode,\n+      derivalPoint: fromCode,\n+      length: cargo.length / 100, // в метрах\n+      width: cargo.width / 100,\n+      height: cargo.height / 100,\n+      weight: cargo.weight,\n+      quantity: 1\n+    };\n+\n+    console.log('Деловые Линии запрос упаковок:', requestBody);\n+\n     const response = await fetch('https://api.dellin.ru/v1/public/packages_available.json', {\n       method: 'POST',\n       headers: {\n         'Content-Type': 'application/json'\n       },\n-      body: JSON.stringify({\n-        appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n-        arrivalPoint: toPoint,\n-        derivalPoint: fromPoint,\n-        length: cargo.length / 100, // в метрах\n-        width: cargo.width / 100,\n-        height: cargo.height / 100,\n-        weight: cargo.weight,\n-        quantity: 1\n-      })\n+      body: JSON.stringify(requestBody)\n     });\n \n     const data = await response.json();\n     console.log('Деловые Линии доступные упаковки:', data);\n     \n     if (response.ok && data.packages && data.packages.length > 0) {\n-      // Берем первый доступный пакет\n-      return data.packages[0].uid;\n+      // Берем первый доступный пакет без несовместимостей\n+      const compatiblePackage = data.packages.find((pkg: any) => \n+        !pkg.incompatible_uids || pkg.incompatible_uids.length === 0\n+      );\n+      return compatiblePackage?.uid || data.packages[0].uid;\n     }\n     \n     return null;\n   } catch (error) {\n"
    },
    "title": "app/page.tsx",
    "time": {
      "start": 1758876919980,
      "end": 1758876919993
    }
  }
}