{
  "id": "prt_ab4737ac5001bdNYavntc8ivUT",
  "sessionID": "ses_54b97e247ffenCZZa4jZiIWD0l",
  "messageID": "msg_ab473310b002mJ6ZuAqyF74mV2",
  "type": "tool",
  "callID": "call_1d35087b713c49129db205a1",
  "tool": "write",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/components/CalculationProgress.tsx",
      "content": "'use client';\n\nimport React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Progress } from '@/components/ui/progress';\nimport { Badge } from '@/components/ui/badge';\nimport { Loader2, CheckCircle, XCircle, Clock } from 'lucide-react';\n\ninterface CompanyProgress {\n  name: string;\n  status: 'pending' | 'loading' | 'completed' | 'error';\n  progress?: number;\n  error?: string;\n  duration?: number;\n}\n\ninterface CalculationProgressProps {\n  companies: CompanyProgress[];\n  totalDuration?: number;\n  isVisible: boolean;\n}\n\nexport default function CalculationProgress({ \n  companies, \n  totalDuration = 0, \n  isVisible \n}: CalculationProgressProps) {\n  if (!isVisible) return null;\n\n  const completedCount = companies.filter(c => c.status === 'completed').length;\n  const errorCount = companies.filter(c => c.status === 'error').length;\n  const loadingCount = companies.filter(c => c.status === 'loading').length;\n  const totalCount = companies.length;\n  const overallProgress = totalCount > 0 ? (completedCount + errorCount) / totalCount * 100 : 0;\n\n  const getStatusIcon = (status: CompanyProgress['status']) => {\n    switch (status) {\n      case 'loading':\n        return <Loader2 className=\"h-4 w-4 animate-spin text-blue-500\" />;\n      case 'completed':\n        return <CheckCircle className=\"h-4 w-4 text-green-500\" />;\n      case 'error':\n        return <XCircle className=\"h-4 w-4 text-red-500\" />;\n      default:\n        return <Clock className=\"h-4 w-4 text-gray-400\" />;\n    }\n  };\n\n  const getStatusColor = (status: CompanyProgress['status']) => {\n    switch (status) {\n      case 'loading':\n        return 'bg-blue-500';\n      case 'completed':\n        return 'bg-green-500';\n      case 'error':\n        return 'bg-red-500';\n      default:\n        return 'bg-gray-300';\n    }\n  };\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader className=\"pb-3\">\n        <CardTitle className=\"flex items-center justify-between text-lg\">\n          <span className=\"flex items-center gap-2\">\n            <Loader2 className=\"h-5 w-5 animate-spin\" />\n            Расчет стоимости доставки\n          </span>\n          <div className=\"flex items-center gap-2 text-sm font-normal\">\n            {totalDuration > 0 && (\n              <Badge variant=\"outline\" className=\"text-xs\">\n                {totalDuration.toFixed(0)}мс\n              </Badge>\n            )}\n            <Badge variant={errorCount > 0 ? \"destructive\" : \"default\"}>\n              {completedCount}/{totalCount} завершено\n            </Badge>\n          </div>\n        </CardTitle>\n        <Progress value={overallProgress} className=\"w-full\" />\n      </CardHeader>\n      \n      <CardContent className=\"space-y-3\">\n        <div className=\"grid gap-3\">\n          {companies.map((company, index) => (\n            <div \n              key={company.name} \n              className=\"flex items-center justify-between p-3 rounded-lg border bg-card\"\n            >\n              <div className=\"flex items-center gap-3\">\n                {getStatusIcon(company.status)}\n                <div>\n                  <div className=\"font-medium\">{company.name}</div>\n                  {company.error && (\n                    <div className=\"text-xs text-red-600 mt-1 max-w-md\">\n                      {company.error}\n                    </div>\n                  )}\n                  {company.duration && company.status === 'completed' && (\n                    <div className=\"text-xs text-green-600 mt-1\">\n                      Выполнено за {company.duration.toFixed(0)}мс\n                    </div>\n                  )}\n                </div>\n              </div>\n              \n              <div className=\"flex items-center gap-2\">\n                {company.status === 'loading' && company.progress !== undefined && (\n                  <div className=\"w-20\">\n                    <Progress value={company.progress} className=\"h-2\" />\n                  </div>\n                )}\n                \n                <Badge \n                  variant={company.status === 'error' ? 'destructive' : 'secondary'}\n                  className=\"text-xs\"\n                >\n                  {company.status === 'pending' && 'Ожидание'}\n                  {company.status === 'loading' && 'Выполняется'}\n                  {company.status === 'completed' && 'Завершено'}\n                  {company.status === 'error' && 'Ошибка'}\n                </Badge>\n              </div>\n            </div>\n          ))}\n        </div>\n        \n        {/* Статистика */}\n        <div className=\"flex justify-between items-center pt-3 border-t text-sm text-muted-foreground\">\n          <div className=\"flex gap-4\">\n            <span>Завершено: {completedCount}</span>\n            {errorCount > 0 && <span className=\"text-red-600\">Ошибок: {errorCount}</span>}\n            {loadingCount > 0 && <span>Выполняется: {loadingCount}</span>}\n          </div>\n          <div>\n            Общий прогресс: {overallProgress.toFixed(0)}%\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}"
    },
    "output": "",
    "title": "components/CalculationProgress.tsx",
    "metadata": {
      "diagnostics": {},
      "filepath": "/home/user/project/components/CalculationProgress.tsx",
      "exists": false
    },
    "time": {
      "start": 1763964058313,
      "end": 1763964058314
    }
  }
}