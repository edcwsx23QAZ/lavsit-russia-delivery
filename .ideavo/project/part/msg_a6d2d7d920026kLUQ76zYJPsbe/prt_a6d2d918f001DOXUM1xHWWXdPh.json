{
  "id": "prt_a6d2d918f001DOXUM1xHWWXdPh",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "messageID": "msg_a6d2d7d920026kLUQ76zYJPsbe",
  "type": "tool",
  "callID": "toolu_01QRrgCh6AQc5xzqky2Jt1bN",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "app/page.tsx",
      "limit": 100,
      "offset": 3530
    },
    "output": "<file>\n03531|       };\n03532|     }\n03533|   };\n03534| \n03535|   const calculateCdek = async (): Promise<CalculationResult> => {\n03536|     const apiUrl = '/api/cdek';\n03537|     \n03538|     try {\n03539|       validateMultipleCargos(form.cargos);\n03540|       \n03541|       const packages = form.cargos.map(cargo => ({\n03542|         height: cargo.height,\n03543|         length: cargo.length,\n03544|         width: cargo.width,\n03545|         weight: cargo.weight * 1000\n03546|       }));\n03547| \n03548|       const requestData: any = {\n03549|         from_city: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n03550|         to_city: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n03551|         packages: packages\n03552|       };\n03553| \n03554|       if (form.needInsurance && form.declaredValue > 0) {\n03555|         requestData.services = [{\n03556|           code: 'INSURANCE',\n03557|           parameter: form.declaredValue\n03558|         }];\n03559|         console.log('üì¶ CDEK: –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ', form.declaredValue);\n03560|       }\n03561| \n03562|       console.log('üì¶ CDEK –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03563|       console.log('üì¶ CDEK –º–∞—Ä—à—Ä—É—Ç:', {\n03564|         fromAddressDelivery: form.fromAddressDelivery,\n03565|         fromLavsiteWarehouse: form.fromLavsiteWarehouse,\n03566|         toAddressDelivery: form.toAddressDelivery\n03567|       });\n03568| \n03569|        const result = await enhancedApiRequest(\n03570|          apiUrl,\n03571|          {\n03572|            method: 'POST',\n03573|            headers: {\n03574|              'Content-Type': 'application/json',\n03575|            },\n03576|            body: JSON.stringify(requestData)\n03577|          },\n03578|          { operation: 'calculate', company: '–°–î–≠–ö' }\n03579|        );\n03580| \n03581|        if (result && typeof result === 'object' && 'success' in result && !result.success) {\n03582|          console.error('‚ùå –°–î–≠–ö API –æ—à–∏–±–∫–∞:', result.error);\n03583|          return {\n03584|            company: '–°–î–≠–ö',\n03585|            price: 0,\n03586|            days: 0,\n03587|            error: result.error.userMessage || result.error.message,\n03588|            requestData,\n03589|            responseData: null,\n03590|            apiUrl\n03591|          };\n03592|        }\n03593| \n03594|        const response = result as Response;\n03595|        const data = await response.json();\n03596|        console.log('üì¶ CDEK –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω, —Ç–∞—Ä–∏—Ñ–æ–≤:', data.tariff_codes?.length || 0);\n03597| \n03598|       if (response.ok && data.tariff_codes && data.tariff_codes.length > 0) {\n03599|         const isFromDoor = form.fromAddressDelivery || form.fromLavsiteWarehouse;\n03600|         const isToDoor = form.toAddressDelivery;\n03601|         \n03602|         let deliveryMode: number;\n03603|         let deliveryModeText: string;\n03604|         \n03605|         if (isFromDoor && isToDoor) {\n03606|           deliveryMode = 1;\n03607|           deliveryModeText = '–¥–≤–µ—Ä—å-–¥–≤–µ—Ä—å';\n03608|         } else if (isFromDoor && !isToDoor) {\n03609|           deliveryMode = 2;\n03610|           deliveryModeText = '–¥–≤–µ—Ä—å-—Å–∫–ª–∞–¥';\n03611|         } else if (!isFromDoor && isToDoor) {\n03612|           deliveryMode = 3;\n03613|           deliveryModeText = '—Å–∫–ª–∞–¥-–¥–≤–µ—Ä—å';\n03614|         } else {\n03615|           deliveryMode = 4;\n03616|           deliveryModeText = '—Å–∫–ª–∞–¥-—Å–∫–ª–∞–¥';\n03617|         }\n03618| \n03619|         console.log(`üì¶ CDEK –≤—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º –¥–æ—Å—Ç–∞–≤–∫–∏: ${deliveryMode} (${deliveryModeText})`);\n03620| \n03621|         const filteredTariffs = data.tariff_codes.filter((t: any) => t.delivery_mode === deliveryMode);\n03622|         \n03623|         console.log(`üì¶ CDEK –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è —Ä–µ–∂–∏–º–∞ ${deliveryModeText}:`, filteredTariffs.length);\n03624| \n03625|         if (filteredTariffs.length === 0) {\n03626|           return {\n03627|             company: '–°–î–≠–ö',\n03628|             price: 0,\n03629|             days: 0,\n03630|             error: `–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∞ ${deliveryModeText}`,\n\n(File has more lines. Use 'offset' parameter to read beyond line 3630)\n</file>",
    "title": "app/page.tsx",
    "metadata": {
      "preview": "      };\n    }\n  };\n\n  const calculateCdek = async (): Promise<CalculationResult> => {\n    const apiUrl = '/api/cdek';\n    \n    try {\n      validateMultipleCargos(form.cargos);\n      \n      const packages = form.cargos.map(cargo => ({\n        height: cargo.height,\n        length: cargo.length,\n        width: cargo.width,\n        weight: cargo.weight * 1000\n      }));\n\n      const requestData: any = {\n        from_city: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n        to_city: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',"
    },
    "time": {
      "start": 1762768294980,
      "end": 1762768294984
    }
  }
}