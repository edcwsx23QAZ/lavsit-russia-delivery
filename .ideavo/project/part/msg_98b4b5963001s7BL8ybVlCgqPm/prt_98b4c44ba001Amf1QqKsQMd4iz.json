{
  "id": "prt_98b4c44ba001Amf1QqKsQMd4iz",
  "messageID": "msg_98b4b5963001s7BL8ybVlCgqPm",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "multiedit",
  "callID": "toolu_01ToCDryagAkgASYMPm6X2tb",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx",
      "edits": [
        {
          "oldString": "      if (form.fromAddressDelivery && senderZone.warehousePoint) {\n        const senderDepartment = await getPekNearestDepartments(\n          form.fromAddress || form.fromCity,\n          {\n            latitude: senderZone.warehousePoint.latitude.toString(),\n            longitude: senderZone.warehousePoint.longitude.toString()\n          }\n        );\n        if (senderDepartment) {\n          senderWarehouseId = senderDepartment.warehouseId;\n        }\n      }\n      \n      if (form.toAddressDelivery && receiverZone.warehousePoint) {\n        const receiverDepartment = await getPekNearestDepartments(\n          form.toAddress || form.toCity,\n          {\n            latitude: receiverZone.warehousePoint.latitude.toString(),\n            longitude: receiverZone.warehousePoint.longitude.toString()\n          }\n        );\n        if (receiverDepartment) {\n          receiverWarehouseId = receiverDepartment.warehouseId;\n        }\n      }",
          "newString": "      if (form.fromAddressDelivery && senderZone.warehousePoint) {\n        const validSenderCoords = validateCoordinates(senderZone.warehousePoint);\n        if (validSenderCoords) {\n          const senderDepartment = await getPekNearestDepartments(\n            form.fromAddress || form.fromCity,\n            {\n              latitude: validSenderCoords.latitude.toString(),\n              longitude: validSenderCoords.longitude.toString()\n            }\n          );\n          if (senderDepartment) {\n            senderWarehouseId = senderDepartment.warehouseId;\n          }\n        } else {\n          console.warn('⚠️ Некорректные координаты отправителя, используем основной склад');\n        }\n      }\n      \n      if (form.toAddressDelivery && receiverZone.warehousePoint) {\n        const validReceiverCoords = validateCoordinates(receiverZone.warehousePoint);\n        if (validReceiverCoords) {\n          const receiverDepartment = await getPekNearestDepartments(\n            form.toAddress || form.toCity,\n            {\n              latitude: validReceiverCoords.latitude.toString(),\n              longitude: validReceiverCoords.longitude.toString()\n            }\n          );\n          if (receiverDepartment) {\n            receiverWarehouseId = receiverDepartment.warehouseId;\n          }\n        } else {\n          console.warn('⚠️ Некорректные координаты получателя, используем основной склад');\n        }\n      }"
        }
      ]
    },
    "output": "",
    "metadata": {
      "results": [
        {
          "diagnostics": {},
          "diff": "Index: /home/user/project/app/page.tsx\n===================================================================\n--- /home/user/project/app/page.tsx\n+++ /home/user/project/app/page.tsx\n@@ -1102,30 +1102,40 @@\n let senderWarehouseId = senderZone.mainWarehouseId;\n let receiverWarehouseId = receiverZone.mainWarehouseId;\n \n if (form.fromAddressDelivery && senderZone.warehousePoint) {\n-  const senderDepartment = await getPekNearestDepartments(\n-    form.fromAddress || form.fromCity,\n-    {\n-      latitude: senderZone.warehousePoint.latitude.toString(),\n-      longitude: senderZone.warehousePoint.longitude.toString()\n+  const validSenderCoords = validateCoordinates(senderZone.warehousePoint);\n+  if (validSenderCoords) {\n+    const senderDepartment = await getPekNearestDepartments(\n+      form.fromAddress || form.fromCity,\n+      {\n+        latitude: validSenderCoords.latitude.toString(),\n+        longitude: validSenderCoords.longitude.toString()\n+      }\n+    );\n+    if (senderDepartment) {\n+      senderWarehouseId = senderDepartment.warehouseId;\n     }\n-  );\n-  if (senderDepartment) {\n-    senderWarehouseId = senderDepartment.warehouseId;\n+  } else {\n+    console.warn('⚠️ Некорректные координаты отправителя, используем основной склад');\n   }\n }\n \n if (form.toAddressDelivery && receiverZone.warehousePoint) {\n-  const receiverDepartment = await getPekNearestDepartments(\n-    form.toAddress || form.toCity,\n-    {\n-      latitude: receiverZone.warehousePoint.latitude.toString(),\n-      longitude: receiverZone.warehousePoint.longitude.toString()\n+  const validReceiverCoords = validateCoordinates(receiverZone.warehousePoint);\n+  if (validReceiverCoords) {\n+    const receiverDepartment = await getPekNearestDepartments(\n+      form.toAddress || form.toCity,\n+      {\n+        latitude: validReceiverCoords.latitude.toString(),\n+        longitude: validReceiverCoords.longitude.toString()\n+      }\n+    );\n+    if (receiverDepartment) {\n+      receiverWarehouseId = receiverDepartment.warehouseId;\n     }\n-  );\n-  if (receiverDepartment) {\n-    receiverWarehouseId = receiverDepartment.warehouseId;\n+  } else {\n+    console.warn('⚠️ Некорректные координаты получателя, используем основной склад');\n   }\n }\n \n // Формируем дату завтра для забора\n"
        }
      ]
    },
    "title": "app/page.tsx",
    "time": {
      "start": 1758978667194,
      "end": 1758978667210
    }
  }
}