{
  "id": "prt_a97199641001KLZoChCiq3naxU",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "messageID": "msg_a971990f7001I4z4pTO03KgDPZ",
  "type": "tool",
  "callID": "call_53763012",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "app/page.tsx",
      "offset": 3187
    },
    "output": "<file>\n03188|     const apiUrl = '/api/vozovoz';\n03189|     \n03190|     try {\n03191|       // –í—ã—á–∏—Å–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥—Ä—É–∑–∞\n03192|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n03193|       const totalVolume = form.cargos.reduce((sum, cargo) => \n03194|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n03195|       );\n03196|       \n03197|       // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –í–æ–∑–æ–≤–æ–∑\n03198|       const maxDimensions = form.cargos.reduce((max, cargo) => {\n03199|         const length = cargo.length / 1000; // –ø–µ—Ä–µ–≤–æ–¥–∏–º –º–º –≤ –º\n03200|         const width = cargo.width / 1000;\n03201|         const height = cargo.height / 1000;\n03202|         const weight = cargo.weight;\n03203|         \n03204|         return {\n03205|           length: Math.max(max.length, length),\n03206|           width: Math.max(max.width, width),\n03207|           height: Math.max(max.height, height),\n03208|           weight: Math.max(max.weight, weight)\n03209|         };\n03210|       }, { length: 0, width: 0, height: 0, weight: 0 });\n03211|       \n03212|       console.log('üöö –í–æ–∑–æ–≤–æ–∑: –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');\n03213|       console.log('   - –û–±—â–∏–π –≤–µ—Å:', totalWeight, '–∫–≥');\n03214|       console.log('   - –û–±—â–∏–π –æ–±—ä–µ–º:', totalVolume, '–º¬≥');\n03215|       console.log('   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã:', maxDimensions);\n03216|       console.log('   - –û—Ç–∫—É–¥–∞:', form.fromCity);\n03217|       console.log('   - –ö—É–¥–∞:', form.toCity);\n03218|       \n03219|       // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º —Ç–∏–ø–æ–º –¥–æ—Å—Ç–∞–≤–∫–∏\n03220|       const createRequestData = (useAddressType: boolean) => ({\n03221|         object: \"price\",\n03222|         action: \"get\",\n03223|         params: {\n03224|           cargo: {\n03225|             dimension: {\n03226|               max: {                              // ‚úÖ –î–æ–±–∞–≤–ª—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É max\n03227|                 length: maxDimensions.length,     // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –≤ –º–µ—Ç—Ä–∞—Ö\n03228|                 width: maxDimensions.width,       // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –≤ –º–µ—Ç—Ä–∞—Ö\n03229|                 height: maxDimensions.height,     // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –≤ –º–µ—Ç—Ä–∞—Ö\n03230|                 weight: maxDimensions.weight      // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –≤ –∫–≥\n03231|               },\n03232|               quantity: form.cargos.length,       // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç\n03233|               volume: totalVolume,                // –û–±—â–∏–π –æ–±—ä–µ–º –≤ –º¬≥\n03234|               weight: totalWeight                 // –û–±—â–∏–π –≤–µ—Å –≤ –∫–≥\n03235|             },\n03236|             ...(form.needInsurance && form.declaredValue > 0 ? {\n03237|               insurance: form.declaredValue,      // ‚úÖ –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n03238|               insuranceNdv: false                 // –û—Ç–∫–ª—é—á–∞–µ–º —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –±–µ–∑ –æ–±—ä—è–≤–ª–µ–Ω–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n03239|             } : {\n03240|               insuranceNdv: true                  // –í–∫–ª—é—á–∞–µ–º —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –±–µ–∑ –æ–±—ä—è–≤–ª–µ–Ω–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n03241|             }),\n03242|              ...(form.needPackaging ? {\n03243|                wrapping: {\n03244|                  \"hardPackageVolume\": totalVolume  // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥ \"–ñ—ë—Å—Ç–∫–∞—è —É–ø–∞–∫–æ–≤–∫–∞\" –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n03245|                }\n03246|              } : {})\n03247|           },\n03248|           gateway: {\n03249|             dispatch: {\n03250|               point: {\n03251|                 location: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n03252|                 // ‚úÖ –ü–æ–ª—è address –∏ terminal –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n03253|                 ...(useAddressType || form.fromAddressDelivery ? {\n03254|                   address: form.fromAddress || \"–∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\"\n03255|                 } : {\n03256|                   terminal: \"default\"\n03257|                 })\n03258|               }\n03259|             },\n03260|             destination: {\n03261|               point: {\n03262|                 location: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n03263|                 // ‚úÖ –ü–æ–ª—è address –∏ terminal –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n03264|                 ...(useAddressType || form.toAddressDelivery ? {\n03265|                   address: form.toAddress || \"–∞–¥—Ä–µ—Å –ø–æ–ª—É—á–µ–Ω–∏—è\"\n03266|                 } : {\n03267|                   terminal: \"default\"\n03268|                 })\n03269|               }\n03270|             }\n03271|           }\n03272|         }\n03273|       });\n03274| \n03275|       // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º —Å terminal —Ç–∏–ø–æ–º (–µ—Å–ª–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω address delivery)\n03276|       let useAddressType = false;\n03277|       let requestData = createRequestData(useAddressType);\n03278|       \n03279|       console.log('üöö –í–æ–∑–æ–≤–æ–∑ –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03280| \n03281|       let result = await enhancedApiRequest(\n03282|         apiUrl,\n03283|         {\n03284|           method: 'POST',\n03285|           headers: {\n03286|             'Content-Type': 'application/json',\n03287|           },\n03288|           body: JSON.stringify(requestData)\n03289|         },\n03290|         { operation: 'calculate', company: '–í–æ–∑–æ–≤–æ–∑' }\n03291|       );\n03292| \n03293|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ—à–∏–±–∫–∞ –æ —Ç–æ–º, —á—Ç–æ –≥–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è terminal\n03294|       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n03295|         const errorMessage = result.error?.userMessage || result.error?.message || '';\n03296|         console.log('üöö –í–æ–∑–æ–≤–æ–∑: –ø–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ —Å terminal –≤–µ—Ä–Ω—É–ª–∞ –æ—à–∏–±–∫—É:', errorMessage);\n03297|         \n03298|         // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –≥–æ—Ä–æ–¥–æ–º/—Ç–µ—Ä–º–∏–Ω–∞–ª–æ–º, –ø—Ä–æ–±—É–µ–º —Å address —Ç–∏–ø–æ–º\n03299|         if (errorMessage.toLowerCase().includes('–≥–æ—Ä–æ–¥') || \n03300|             errorMessage.toLowerCase().includes('—Ç–µ—Ä–º–∏–Ω–∞–ª') || \n03301|             errorMessage.toLowerCase().includes('city') ||\n03302|             errorMessage.toLowerCase().includes('terminal')) {\n03303|           \n03304|           console.log('üöö –í–æ–∑–æ–≤–æ–∑: –≥–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è terminal, –ø—Ä–æ–±—É–µ–º —Å address —Ç–∏–ø–æ–º...');\n03305|           useAddressType = true;\n03306|           requestData = createRequestData(useAddressType);\n03307|           \n03308|           console.log('üöö –í–æ–∑–æ–≤–æ–∑ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å address:', JSON.stringify(requestData, null, 2));\n03309|           \n03310|           result = await enhancedApiRequest(\n03311|             apiUrl,\n03312|             {\n03313|               method: 'POST',\n03314|               headers: {\n03315|                 'Content-Type': 'application/json',\n03316|               },\n03317|               body: JSON.stringify(requestData)\n03318|             },\n03319|             { operation: 'calculate', company: '–í–æ–∑–æ–≤–æ–∑' }\n03320|           );\n03321|         }\n03322|       }\n03323| \n03324|       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n03325|         console.error('‚ùå –í–æ–∑–æ–≤–æ–∑ API –æ—à–∏–±–∫–∞:', result.error);\n03326|         return {\n03327|           company: '–í–æ–∑–æ–≤–æ–∑',\n03328|           price: 0,\n03329|           days: 0,\n03330|           error: result.error.userMessage || result.error.message,\n03331|           requestData,\n03332|           responseData: null,\n03333|           apiUrl\n03334|         };\n03335|       }\n03336| \n03337|       const response = result as Response;\n03338|       const data = await response.json();\n03339|       console.log('üöö –í–æ–∑–æ–≤–æ–∑ –æ—Ç–≤–µ—Ç:', JSON.stringify(data, null, 2));\n03340| \n03341|       if (response.ok && data.response) {\n03342|         const responseData = data.response;\n03343|         \n03344|         console.log('üöö –í–æ–∑–æ–≤–æ–∑ –∞–Ω–∞–ª–∏–∑ –æ—Ç–≤–µ—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:', responseData);\n03345|         \n03346|         // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n03347|         const services: { name: string; description: string; price: number }[] = [];\n03348|         let totalPrice = responseData.price || responseData.basePrice || 0;\n03349|         \n03350|         // ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –º–∞—Å—Å–∏–≤ —É—Å–ª—É–≥ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API\n03351|         if (responseData.service && Array.isArray(responseData.service)) {\n03352|           console.log('üöö –í–æ–∑–æ–≤–æ–∑ –Ω–∞–π–¥–µ–Ω –º–∞—Å—Å–∏–≤ —É—Å–ª—É–≥:', responseData.service.length);\n03353|           \n03354|           responseData.service.forEach((service: any, index: number) => {\n03355|             console.log(`üöö –£—Å–ª—É–≥–∞ [${index}]:`, service);\n03356|             if (service.price > 0) {\n03357|               services.push({\n03358|                 name: service.name || '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —É—Å–ª—É–≥–∞',\n03359|                 description: service.description || '',\n03360|                 price: service.price\n03361|               });\n03362|             }\n03363|           });\n03364|         } else {\n03365|           console.log('üöö –í–æ–∑–æ–≤–æ–∑: –º–∞—Å—Å–∏–≤ —É—Å–ª—É–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –ø—É—Å—Ç');\n03366|           \n03367|           // –ï—Å–ª–∏ –º–∞—Å—Å–∏–≤–∞ —É—Å–ª—É–≥ –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n03368|           if (responseData.basePrice && responseData.basePrice > 0) {\n03369|             services.push({\n03370|               name: '–ë–∞–∑–æ–≤–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞',\n03371|               description: `${form.fromCity} - ${form.toCity}`,\n03372|               price: responseData.basePrice\n03373|             });\n03374|           }\n03375|           \n03376|           // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–∫–∏–¥–∫–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—ë –æ—Ç–¥–µ–ª—å–Ω–æ\n03377|           if (responseData.price !== responseData.basePrice && responseData.price > 0) {\n03378|             const discount = (responseData.basePrice || 0) - responseData.price;\n03379|             if (discount > 0) {\n03380|               services.push({\n03381|                 name: '–°–∫–∏–¥–∫–∞',\n03382|                 description: '–ü—Ä–∏–º–µ–Ω–µ–Ω–∞ —Å–∫–∏–¥–∫–∞',\n03383|                 price: -discount\n03384|               });\n03385|             }\n03386|           }\n03387|         }\n03388|         \n03389|         // –ï—Å–ª–∏ –Ω–∏–∫–∞–∫–∏—Ö —É—Å–ª—É–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n03390|         if (services.length === 0 && totalPrice > 0) {\n03391|           services.push({\n03392|             name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n03393|             description: `${form.fromCity} - ${form.toCity}`,\n03394|             price: totalPrice\n03395|           });\n03396|         }\n03397| \n03398|         console.log('üöö –í–æ–∑–æ–≤–æ–∑ –∏—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:', totalPrice);\n03399|         console.log('üöö –í–æ–∑–æ–≤–æ–∑ —É—Å–ª—É–≥–∏:', services);\n03400| \n03401|         return {\n03402|           company: '–í–æ–∑–æ–≤–æ–∑',\n03403|           price: Math.round(totalPrice),\n03404|           days: responseData.deliveryTime?.to || responseData.deliveryTime?.from || 3,\n03405|           details: {\n03406|             note: `–î–æ—Å—Ç–∞–≤–∫–∞ ${form.fromCity} - ${form.toCity}`,\n03407|             services,\n03408|             basePrice: responseData.basePrice,\n03409|             finalPrice: responseData.price,\n03410|             deliveryTime: responseData.deliveryTime,\n03411|             weight: totalWeight,\n03412|             volume: totalVolume\n03413|           },\n03414|           requestData,\n03415|           responseData: data,\n03416|           apiUrl\n03417|         };\n03418|       } else {\n03419|         return {\n03420|           company: '–í–æ–∑–æ–≤–æ–∑',\n03421|           price: 0,\n03422|           days: 0,\n03423|           error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –í–æ–∑–æ–≤–æ–∑',\n03424|           requestData,\n03425|           responseData: data,\n03426|           apiUrl\n03427|         };\n03428|       }\n03429|     } catch (error: any) {\n03430|       console.error('üöö –í–æ–∑–æ–≤–æ–∑ –æ—à–∏–±–∫–∞:', error);\n03431|       return {\n03432|         company: '–í–æ–∑–æ–≤–æ–∑',\n03433|         price: 0,\n03434|         days: 0,\n03435|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03436|         apiUrl\n03437|       };\n03438|     }\n03439|   };\n03440| \n03441|   // –†–∞—Å—á–µ—Ç –¥–ª—è Nord Wheel\n03442|   const calculateNordWheel = async (): Promise<CalculationResult> => {\n03443|     const apiUrl = 'https://api.nordw.orog.ru/api/v1/calculate';\n03444| \n03445|     try {\n03446|       // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03447|       validateMultipleCargos(form.cargos);\n03448|       \n03449|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n03450|       const totalVolume = form.cargos.reduce((sum, cargo) => \n03451|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n03452|       );\n03453| \n03454|       // üîß –î–û–ë–ê–í–õ–ï–ù–û: –†–∞—Å—á–µ—Ç –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03455|       const maxLength = Math.max(...form.cargos.map(c => c.length));\n03456|       const maxWidth = Math.max(...form.cargos.map(c => c.width));\n03457|       const maxHeight = Math.max(...form.cargos.map(c => c.height));\n03458|       \n03459|       // üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n03460|       console.log('üåê Nord Wheel: –ê–Ω–∞–ª–∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç:');\n03461|       console.log(`   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç: ${form.cargos.length}`);\n03462|       console.log(`   - –û–±—â–∏–π –≤–µ—Å: ${totalWeight} –∫–≥`);\n03463|       console.log(`   - –û–±—â–∏–π –æ–±—ä–µ–º: ${totalVolume.toFixed(3)} –º¬≥`);\n03464|       \n03465|       form.cargos.forEach((cargo, index) => {\n03466|         console.log(`   üì¶ –ú–µ—Å—Ç–æ ${index + 1}:`);\n03467|         console.log(`     - –ì–∞–±–∞—Ä–∏—Ç—ã: ${cargo.length}√ó${cargo.width}√ó${cargo.height} —Å–º`);\n03468|         console.log(`     - –í–µ—Å: ${cargo.weight} –∫–≥`);\n03469|         console.log(`     - –û–±—ä–µ–º: ${((cargo.length * cargo.width * cargo.height) / 1000000).toFixed(3)} –º¬≥`);\n03470|       });\n03471| \n03472|       if (form.cargos.length > 1) {\n03473|         console.log(`   üìê –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã: ${maxLength}√ó${maxWidth}√ó${maxHeight} —Å–º`);\n03474|       }\n03475| \n03476|       // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è –Ω–æ–≤–æ–≥–æ API NordWheel\n03477|       const requestData = {\n03478|         dispatch: {\n03479|           location: {\n03480|             type: 'terminal',\n03481|             terminal_id: '0c7a2795-1220-486d-a7ce-8bcf130a1224', // –ú–æ—Å–∫–≤–∞ terminal GUID\n03482|             city_fias: '0c5b2444-70a0-4932-980c-b4dc0d3f02b5' // –ú–æ—Å–∫–≤–∞ FIAS (—Ç—Ä–µ–±—É–µ—Ç—Å—è API, –Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - TODO: –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –≥–æ—Ä–æ–¥–æ–≤)\n03483|           }\n03484|         },\n03485|         destination: {\n03486|           location: {\n03487|             type: 'terminal',\n03488|             terminal_id: '3ca02b62-3632-4da0-8fde-de9d9c77c553', // –°–ü–± terminal GUID\n03489|             city_fias: 'c2deb16a-0330-4f05-821f-1d09c93331e6' // –°–ü–± FIAS (—Ç—Ä–µ–±—É–µ—Ç—Å—è API, –Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - TODO: –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –≥–æ—Ä–æ–¥–æ–≤)\n03490|           }\n03491|         },\n03492|         cargo: {\n03493|           total_weight: totalWeight,\n03494|           total_volume: totalVolume,\n03495|           total_quantity: form.cargos.length\n03496|         },\n03497|         insurance: form.needInsurance && form.declaredValue ? form.declaredValue : 0,\n03498|         insurance_refuse: !form.needInsurance,\n03499|         services: {\n03500|           is_package: form.needPackaging,\n03501|           is_documents_return: false,\n03502|           is_fragile: false\n03503|         },\n03504|         promocode: null\n03505|       };\n03506| \n03507|       console.log('üöõ Nord Wheel –Ω–æ–≤—ã–π API –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03508| \n03509|       const response = await fetch(apiUrl, {\n03510|         method: 'POST',\n03511|         headers: {\n03512|           'Content-Type': 'application/json',\n03513|           'Authorization': `Bearer ${process.env.NORDWHEEL_API_KEY}`\n03514|         },\n03515|         body: JSON.stringify(requestData)\n03516|       });\n03517| \n03518|       if (!response.ok) {\n03519|         console.error('‚ùå Nord Wheel API –æ—à–∏–±–∫–∞:', response.status, response.statusText);\n03520|         return {\n03521|           company: 'Nord Wheel',\n03522|           price: 0,\n03523|           days: 0,\n03524|           error: `–û—à–∏–±–∫–∞ API: ${response.status} ${response.statusText}`,\n03525|           apiUrl,\n03526|           requestData\n03527|         };\n03528|       }\n03529| \n03530|       const data = await response.json();\n03531|       console.log('üöõ Nord Wheel –Ω–æ–≤—ã–π API –æ—Ç–≤–µ—Ç:', data);\n03532| \n03533|       // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ –Ω–æ–≤–æ–≥–æ API\n03534|       if (data.success) {\n03535|         const price = data.price || 0;\n03536|         const days = data.days || 0;\n03537| \n03538|         return {\n03539|           company: 'Nord Wheel',\n03540|           price: Math.round(price),\n03541|           days: days,\n03542|           details: {\n03543|             totalCost: price,\n03544|             deliveryCost: data.delivery_cost || 0,\n03545|             pickupCost: data.pickup_cost || 0,\n03546|             insuranceCost: data.insurance_cost || 0,\n03547|             services: data.services || []\n03548|           },\n03549|           requestData,\n03550|           responseData: data,\n03551|           apiUrl\n03552|         };\n03553|       } else {\n03554|         return {\n03555|           company: 'Nord Wheel',\n03556|           price: 0,\n03557|           days: 0,\n03558|           error: data.message || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ Nord Wheel - –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö',\n03559|           requestData,\n03560|           responseData: data,\n03561|           apiUrl\n03562|         };\n03563|       }\n03564|     } catch (error: any) {\n03565|       console.error('üöõ Nord Wheel –æ—à–∏–±–∫–∞:', error);\n03566|       return {\n03567|         company: 'Nord Wheel',\n03568|         price: 0,\n03569|         days: 0,\n03570|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03571|         apiUrl\n03572|       };\n03573|     }\n03574|   };\n03575|     const calculateCdek = async (): Promise<CalculationResult> => {\n03576|     const apiUrl = '/api/cdek';\n03577|     \n03578|     try {\n03579|       validateMultipleCargos(form.cargos);\n03580|       \n03581|       const packages = form.cargos.map(cargo => ({\n03582|         height: cargo.height,\n03583|         length: cargo.length,\n03584|         width: cargo.width,\n03585|         weight: cargo.weight * 1000\n03586|       }));\n03587| \n03588|       const requestData: any = {\n03589|         from_city: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n03590|         to_city: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n03591|         packages: packages\n03592|       };\n03593| \n03594|       if (form.needInsurance && form.declaredValue > 0) {\n03595|         requestData.services = [{\n03596|           code: 'INSURANCE',\n03597|           parameter: form.declaredValue\n03598|         }];\n03599|         console.log('üì¶ CDEK: –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ', form.declaredValue);\n03600|       }\n03601| \n03602|       console.log('üì¶ CDEK –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03603|       console.log('üì¶ CDEK –º–∞—Ä—à—Ä—É—Ç:', {\n03604|         fromAddressDelivery: form.fromAddressDelivery,\n03605|         fromLavsiteWarehouse: form.fromLavsiteWarehouse,\n03606|         toAddressDelivery: form.toAddressDelivery\n03607|       });\n03608| \n03609|        const result = await enhancedApiRequest(\n03610|          apiUrl,\n03611|          {\n03612|            method: 'POST',\n03613|            headers: {\n03614|              'Content-Type': 'application/json',\n03615|            },\n03616|            body: JSON.stringify(requestData)\n03617|          },\n03618|          { operation: 'calculate', company: '–°–î–≠–ö' }\n03619|        );\n03620| \n03621|        if (result && typeof result === 'object' && 'success' in result && !result.success) {\n03622|          console.error('‚ùå –°–î–≠–ö API –æ—à–∏–±–∫–∞:', result.error);\n03623|          return {\n03624|            company: '–°–î–≠–ö',\n03625|            price: 0,\n03626|            days: 0,\n03627|            error: result.error.userMessage || result.error.message,\n03628|            requestData,\n03629|            responseData: null,\n03630|            apiUrl\n03631|          };\n03632|        }\n03633| \n03634|        const response = result as Response;\n03635|        const data = await response.json();\n03636|        console.log('üì¶ CDEK –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω, —Ç–∞—Ä–∏—Ñ–æ–≤:', data.tariff_codes?.length || 0);\n03637| \n03638|       if (response.ok && data.tariff_codes && data.tariff_codes.length > 0) {\n03639|         const isFromDoor = form.fromAddressDelivery || form.fromLavsiteWarehouse;\n03640|         const isToDoor = form.toAddressDelivery;\n03641|         \n03642|         let deliveryMode: number;\n03643|         let deliveryModeText: string;\n03644|         \n03645|         if (isFromDoor && isToDoor) {\n03646|           deliveryMode = 1;\n03647|           deliveryModeText = '–¥–≤–µ—Ä—å-–¥–≤–µ—Ä—å';\n03648|         } else if (isFromDoor && !isToDoor) {\n03649|           deliveryMode = 2;\n03650|           deliveryModeText = '–¥–≤–µ—Ä—å-—Å–∫–ª–∞–¥';\n03651|         } else if (!isFromDoor && isToDoor) {\n03652|           deliveryMode = 3;\n03653|           deliveryModeText = '—Å–∫–ª–∞–¥-–¥–≤–µ—Ä—å';\n03654|         } else {\n03655|           deliveryMode = 4;\n03656|           deliveryModeText = '—Å–∫–ª–∞–¥-—Å–∫–ª–∞–¥';\n03657|         }\n03658| \n03659|         console.log(`üì¶ CDEK –≤—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º –¥–æ—Å—Ç–∞–≤–∫–∏: ${deliveryMode} (${deliveryModeText})`);\n03660| \n03661|         const filteredTariffs = data.tariff_codes.filter((t: any) => t.delivery_mode === deliveryMode);\n03662|         \n03663|         console.log(`üì¶ CDEK –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è —Ä–µ–∂–∏–º–∞ ${deliveryModeText}:`, filteredTariffs.length);\n03664| \n03665|         if (filteredTariffs.length === 0) {\n03666|           return {\n03667|             company: '–°–î–≠–ö',\n03668|             price: 0,\n03669|             days: 0,\n03670|             error: `–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∞ ${deliveryModeText}`,\n03671|             requestData,\n03672|             responseData: data,\n03673|             apiUrl\n03674|           };\n03675|         }\n03676| \n03677|         const bestTariff = filteredTariffs.reduce((min: any, tariff: any) => \n03678|           (tariff.delivery_sum < min.delivery_sum) ? tariff : min\n03679|         );\n03680| \n03681|         console.log(`üì¶ CDEK –ª—É—á—à–∏–π —Ç–∞—Ä–∏—Ñ: ${bestTariff.tariff_name} - ${bestTariff.delivery_sum}‚ÇΩ`);\n03682| \n03683|         const detailsRequest: any = {\n03684|           ...requestData,\n03685|           tariff_code: bestTariff.tariff_code,\n03686|           get_details: true\n03687|         };\n03688| \n03689|         console.log('üì¶ CDEK: –∑–∞–ø—Ä–æ—Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏...');\n03690| \n03691|           const detailsResult = await enhancedApiRequest(\n03692|             apiUrl,\n03693|             {\n03694|               method: 'POST',\n03695|               headers: {\n03696|                 'Content-Type': 'application/json',\n03697|               },\n03698|               body: JSON.stringify(detailsRequest)\n03699|             },\n03700|             { operation: 'tariff_details', company: '–°–î–≠–ö' }\n03701|           );\n03702| \n03703|           let tariffDetails: any = null;\n03704|           if (detailsResult && typeof detailsResult === 'object' && 'success' in detailsResult && detailsResult.success) {\n03705|             const detailsResponse = detailsResult as Response;\n03706|             if (detailsResponse.ok) {\n03707|               const detailsData = await detailsResponse.json();\n03708|               tariffDetails = detailsData.tariff_details;\n03709|               console.log('üì¶ –°–î–≠–ö –¥–µ—Ç–∞–ª–∏ —Ç–∞—Ä–∏—Ñ–∞:', tariffDetails);\n03710|             }\n03711|           }\n03712| \n03713|         const finalPrice = tariffDetails?.total_sum || bestTariff.delivery_sum;\n03714|         \n03715|         return {\n03716|           company: '–°–î–≠–ö',\n03717|           price: Math.round(finalPrice),\n03718|           days: bestTariff.period_max || 0,\n03719|           details: {\n03720|             tariff_name: bestTariff.tariff_name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n03721|             tariff_code: bestTariff.tariff_code,\n03722|             delivery_mode: deliveryModeText,\n03723|             period_min: bestTariff.period_min,\n03724|             period_max: bestTariff.period_max,\n03725|             calendar_min: bestTariff.calendar_min,\n03726|             calendar_max: bestTariff.calendar_max,\n03727|             all_tariffs: filteredTariffs,\n03728|             services: tariffDetails?.services || [],\n03729|             delivery_sum: tariffDetails?.delivery_sum || bestTariff.delivery_sum,\n03730|             total_sum: finalPrice,\n03731|             weight_calc: tariffDetails?.weight_calc\n03732|           },\n03733|           requestData,\n03734|           responseData: data,\n03735|           apiUrl\n03736|         };\n03737|       } else {\n03738|         return {\n03739|           company: '–°–î–≠–ö',\n03740|           price: 0,\n03741|           days: 0,\n03742|           error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –°–î–≠–ö',\n03743|           requestData,\n03744|           responseData: data,\n03745|           apiUrl\n03746|         };\n03747|       }\n03748|     } catch (error: any) {\n03749|       console.error('üì¶ –°–î–≠–ö –æ—à–∏–±–∫–∞:', error);\n03750|       return {\n03751|         company: '–°–î–≠–ö',\n03752|         price: 0,\n03753|         days: 0,\n03754|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03755|         apiUrl\n03756|       };\n03757|     }\n03758|   };\n03759| \n03760|   const calculateKit = async (): Promise<CalculationResult> => {\n03761|     const apiUrl = '/api/kit';\n03762|     \n03763|     try {\n03764|       validateMultipleCargos(form.cargos);\n03765|       \n03766|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n03767| \n03768|       const requestData = {\n03769|         from_city: form.fromCity || '–ú–æ—Å–∫–≤–∞',\n03770|         to_city: form.toCity || '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n03771|         declared_price: form.declaredValue || 10000,\n03772|         service: ['S089']\n03773|       };\n03774| \n03775|       console.log('üöõ –ö–ò–¢ –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n03776| \n03777|        const result = await enhancedApiRequest(\n03778|          apiUrl,\n03779|          {\n03780|            method: 'POST',\n03781|            headers: {\n03782|              'Content-Type': 'application/json',\n03783|            },\n03784|            body: JSON.stringify(requestData)\n03785|          },\n03786|          { operation: 'calculate', company: '–ö–ò–¢' }\n03787|        );\n03788| \n03789|        if (result && typeof result === 'object' && 'success' in result && !result.success) {\n03790|          console.error('‚ùå –ö–ò–¢ API –æ—à–∏–±–∫–∞:', result.error);\n03791|          return {\n03792|            company: '–ö–ò–¢',\n03793|            price: 0,\n03794|            days: 0,\n03795|            error: result.error.userMessage || result.error.message,\n03796|            requestData,\n03797|            responseData: null,\n03798|            apiUrl\n03799|          };\n03800|        }\n03801| \n03802|        const response = result as Response;\n03803|        const data = await response.json();\n03804|        console.log('üöõ –ö–ò–¢ –æ—Ç–≤–µ—Ç:', data);\n03805| \n03806|       if (response.ok && Array.isArray(data) && data.length > 0) {\n03807|         const rubData = data.find((item: any) => {\n03808|           const tariffData: any = Object.values(item)[0];\n03809|           return tariffData?.currency_code === 'RUB';\n03810|         });\n03811|         \n03812|         if (rubData) {\n03813|           const tariffKey = Object.keys(rubData)[0];\n03814|           const tariffData: any = rubData[tariffKey];\n03815|           \n03816|           console.log('üöõ –ö–ò–¢ –≤—ã–±—Ä–∞–Ω —Ç–∞—Ä–∏—Ñ:', tariffKey, tariffData);\n03817| \n03818|           return {\n03819|             company: '–ö–ò–¢',\n03820|             price: Math.round(tariffData.cost || 0),\n03821|             days: tariffData.time || 0,\n03822|             details: {\n03823|               tariff_name: tariffData.name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n03824|               tariff_type: tariffKey,\n03825|               services: tariffData.detail || [],\n03826|               currency: tariffData.currency_code\n03827|             },\n03828|             requestData,\n03829|             responseData: data,\n03830|             apiUrl\n03831|           };\n03832|         }\n03833|       }\n03834| \n03835|       return {\n03836|         company: '–ö–ò–¢',\n03837|         price: 0,\n03838|         days: 0,\n03839|         error: data.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –ö–ò–¢',\n03840|         requestData,\n03841|         responseData: data,\n03842|         apiUrl\n03843|       };\n03844|     } catch (error: any) {\n03845|       console.error('üöõ –ö–ò–¢ –æ—à–∏–±–∫–∞:', error);\n03846|       return {\n03847|         company: '–ö–ò–¢',\n03848|         price: 0,\n03849|         days: 0,\n03850|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n03851|         apiUrl\n03852|       };\n03853|     }\n03854|   };\n03855| \n03856|   const handleCalculate = async () => {\n03857|     setCalculating(true);\n03858|     setCalculations([]);\n03859|     \n03860|     // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø–æ—Å–ª–µ —Ä–∞—Å—á–µ—Ç–∞ (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ, –±–µ–∑ –¥–µ–±–∞—É–Ω—Å–∞)\n03861|     saveFormData({\n03862|       cargos: form.cargos,\n03863|       fromCity: form.fromCity,\n03864|       toCity: form.toCity,\n03865|       fromAddress: form.fromAddress,\n03866|       toAddress: form.toAddress,\n03867|       declaredValue: form.declaredValue,\n03868|       needPackaging: form.needPackaging,\n03869|       needLoading: form.needLoading,\n03870|       needCarry: form.needCarry,\n03871|       floor: form.floor,\n03872|       hasFreightLift: form.hasFreightLift,\n03873|       needInsurance: form.needInsurance,\n03874|       fromTerminal: form.fromTerminal,\n03875|       toTerminal: form.toTerminal,\n03876|       fromAddressDelivery: form.fromAddressDelivery,\n03877|       toAddressDelivery: form.toAddressDelivery,\n03878|       selectedProducts: form.selectedProducts,\n03879|     });\n03880|     \n03881|     try {\n03882|       // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ —Ñ—É–Ω–∫—Ü–∏–π —Ä–∞—Å—á–µ—Ç–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n03883|       const calculationFunctions: Promise<CalculationResult>[] = [];\n03884|       \n03885|       if (enabledCompanies.dellin) {\n03886|         calculationFunctions.push(calculateDellin());\n03887|       }\n03888|       if (enabledCompanies.pek) {\n03889|         calculationFunctions.push(calculatePEK());\n03890|       }\n03891|       if (enabledCompanies.nordwheel) {\n03892|         calculationFunctions.push(calculateNordWheel());\n03893|       }\n03894|       if (enabledCompanies.railcontinent) {\n03895|         calculationFunctions.push(calculateRailContinent());\n03896|       }\n03897|       if (enabledCompanies.vozovoz) {\n03898|         calculationFunctions.push(calculateVozovoz());\n03899|       }\n03900|       if (enabledCompanies.cdek) {\n03901|         calculationFunctions.push(calculateCdek());\n03902|       }\n03903|       if (enabledCompanies.kit) {\n03904|         calculationFunctions.push(calculateKit());\n03905|       }\n03906|       \n03907|       // –ï—Å–ª–∏ –Ω–∏ –æ–¥–Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞\n03908|       if (calculationFunctions.length === 0) {\n03909|         setCalculations([]);\n03910|         return;\n03911|       }\n03912|       \n03913|       const results = await Promise.all(calculationFunctions);\n03914|       \n03915|       // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ü–µ–Ω–µ\n03916|       const sortedResults = results\n03917|         .filter(result => !result.error)\n03918|         .sort((a, b) => a.price - b.price)\n03919|         .concat(results.filter(result => result.error));\n03920|       \n03921|       setCalculations(sortedResults);\n03922|     } catch (error) {\n03923|       console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ:', error);\n03924|     } finally {\n03925|       setCalculating(false);\n03926|     }\n03927|   };\n03928| \n03929|   const exportToPDF = () => {\n03930|     if (typeof window !== 'undefined') {\n03931|       // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Å–µ –¥–µ—Ç–∞–ª–∏ –ø–µ—Ä–µ–¥ –ø–µ—á–∞—Ç—å—é\n03932|       const allExpanded = calculations.reduce((acc, calc) => {\n03933|         acc[calc.company] = true;\n03934|         return acc;\n03935|       }, {} as { [key: string]: boolean });\n03936|       \n03937|       setExpandedDetails(allExpanded);\n03938|       \n03939|       // –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DOM\n03940|       setTimeout(() => {\n03941|         window.print();\n03942|       }, 100);\n03943|     }\n03944|   };\n03945| \n03946|   const toggleDetails = (company: string) => {\n03947|     setExpandedDetails(prev => ({\n03948|       ...prev,\n03949|       [company]: !prev[company]\n03950|     }));\n03951|   };\n03952| \n03953|   const toggleDebugInfo = (company: string) => {\n03954|     setExpandedDebugInfo(prev => ({\n03955|       ...prev,\n03956|       [company]: !prev[company]\n03957|     }));\n03958|   };\n03959| \n03960|   // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞—Å—á–µ—Ç–∞\n03961|   const handleReset = () => {\n03962|     if (typeof window !== 'undefined') {\n03963|       // –û—á–∏—â–∞–µ–º localStorage\n03964|       localStorage.removeItem('deliveryForm');\n03965|       \n03966|       // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É\n03967|       setForm(initialFormState);\n03968|       \n03969|       // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è\n03970|       setCalculations([]);\n03971|       setExpandedDetails({});\n03972|       setExpandedDebugInfo({});\n03973|       setSuggestions([]);\n03974|       setShowSuggestions(false);\n03975|       setActiveField('');\n03976|       \n03977|       console.log('–§–æ—Ä–º–∞ —Å–±—Ä–æ—à–µ–Ω–∞ –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é');\n03978|     }\n03979|   };\n03980| \n03981|   // –ü–∞—Ä—Å–µ—Ä –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è —á–∏—Ç–∞–µ–º–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞\n03982|   const parseCalculationDetails = (calc: CalculationResult) => {\n03983|     console.log('üîç parseCalculationDetails –ø–æ–ª—É—á–∏–ª calc:', calc?.company || 'undefined');\n03984|     console.log('üîç calc.details:', calc?.details ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n03985|     console.log('üîç typeof calc.details:', typeof calc?.details);\n03986|     \n03987|     const details: { service: string; description: string; price: number }[] = [];\n03988|     \n03989|     try {\n03990|       if (calc.company === '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏' && calc.details) {\n03991|         console.log('üîç –ù–∞—á–∏–Ω–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–µ—Ç–∞–ª–µ–π –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π...');\n03992|       // –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ (—É–∂–µ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –±–∞–∑–æ–≤—ã–µ —É—Å–ª—É–≥–∏ –∏ —É–ø–∞–∫–æ–≤–∫—É)\n03993|       let basePrice = calc.details?.price || calc.price || 0;\n03994|       \n03995|       // –†–∞–∑–±–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ\n03996|       let intercityPrice = 0;\n03997|       let derivalPrice = 0;\n03998|       let arrivalPrice = 0;\n03999|       let packagingPrice = 0;\n04000|       // packagingPremiums –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è - –Ω–∞–¥–±–∞–≤–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ pkg.price\n04001|       let insurancePrice = 0;\n04002|       \n04003|       // –ú–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞\n04004|       if (calc.details?.intercity?.price) {\n04005|         intercityPrice = calc.details.intercity.price;\n04006|         details.push({\n04007|           service: '–ú–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞',\n04008|           description: `${form.fromCity} - ${form.toCity}`,\n04009|           price: intercityPrice\n04010|         });\n04011|       }\n04012|       \n04013|       // –ó–∞–±–æ—Ä –≥—Ä—É–∑–∞\n04014|       if (calc.details?.derival?.price) {\n04015|         derivalPrice = calc.details.derival.price;\n04016|         details.push({\n04017|           service: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n04018|           description: '–û—Ç –∞–¥—Ä–µ—Å–∞',\n04019|           price: derivalPrice\n04020|         });\n04021|       }\n04022|       \n04023|       // –î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞\n04024|       if (calc.details?.arrival?.price) {\n04025|         arrivalPrice = calc.details.arrival.price;\n04026|         details.push({\n04027|           service: '–û—Ç–≤–æ–∑ –≥—Ä—É–∑–∞',\n04028|           description: '–î–æ –∞–¥—Ä–µ—Å–∞',\n04029|           price: arrivalPrice\n04030|         });\n04031|       }\n04032|       \n04033|       // –£–ø–∞–∫–æ–≤–∫–∞ (–Ω–∞–¥–±–∞–≤–∫–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ pkg.price, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏)\n04034|       if (form.needPackaging && calc.details?.packages) {\n04035|         Object.entries(calc.details?.packages || {}).forEach(([key, pkg]: [string, any]) => {\n04036|           if (pkg.price && pkg.price > 0) {\n04037|             // –í—ã—á–∏—Å–ª—è–µ–º –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É —É–ø–∞–∫–æ–≤–∫–∏ (–±–µ–∑ –Ω–∞–¥–±–∞–≤–æ–∫) –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n04038|             let basePkgPrice = pkg.price;\n04039|             let totalPremiums = 0;\n04040|             \n04041|             if (pkg.premiumDetails && Array.isArray(pkg.premiumDetails)) {\n04042|               totalPremiums = pkg.premiumDetails.reduce((sum: number, premium: any) => \n04043|                 sum + (premium.value || 0), 0);\n04044|               basePkgPrice = pkg.price - totalPremiums;\n04045|             }\n04046|             \n04047|             packagingPrice += pkg.price; // –í –æ–±—â—É—é —Å—É–º–º—É –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–Ω—É—é —Ü–µ–Ω—É\n04048|             \n04049|             // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—É—é —É–ø–∞–∫–æ–≤–∫—É\n04050|             details.push({\n04051|               service: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n04052|               description: '–£–ø–∞–∫–æ–≤–∞—Ç—å –≤ –∫–æ–º–ø–ª–µ–∫—Å ¬´–æ–±—Ä–µ—à—ë—Ç–∫–∞ + –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è¬ª',\n04053|               price: basePkgPrice\n04054|             });\n04055|             \n04056|             // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–¥–±–∞–≤–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ (–¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏, –Ω–æ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –∫ –æ–±—â–µ–π —Å—É–º–º–µ)\n04057|             if (pkg.premiumDetails && Array.isArray(pkg.premiumDetails)) {\n04058|               pkg.premiumDetails.forEach((premium: any) => {\n04059|                 if (premium.value && premium.value > 0) {\n04060|                   details.push({\n04061|                     service: '–ù–∞–¥–±–∞–≤–∫–∞ –∫ —É–ø–∞–∫–æ–≤–∫–µ',\n04062|                     description: premium.name || '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–¥–±–∞–≤–∫–∞',\n04063|                     price: premium.value\n04064|                   });\n04065|                 }\n04066|               });\n04067|             }\n04068|           }\n04069|         });\n04070|       }\n04071|       \n04072|       // –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ\n04073|       if (form.needInsurance && calc.details?.insurance) {\n04074|         insurancePrice = calc.details.insurance;\n04075|         details.push({\n04076|           service: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n04077|           description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n04078|           price: insurancePrice\n04079|         });\n04080|       }\n04081|       \n04082|       // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏\n04083|       details.push({\n04084|         service: '–î–æ–ø.—É—Å–ª—É–≥–∏',\n04085|         description: '–ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ –≥—Ä—É–∑–∞',\n04086|         price: 15\n04087|       });\n04088|       \n04089|       // –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –º–µ–∂–¥—É —Å—É–º–º–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é, –¥–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞—Ç–æ–∫\n04090|       const calculatedSum = intercityPrice + derivalPrice + arrivalPrice + packagingPrice + insurancePrice + 15;\n04091|       const remainder = basePrice - calculatedSum;\n04092|       \n04093|       if (Math.abs(remainder) > 1) { // –ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –±–æ–ª—å—à–µ 1 —Ä—É–±–ª—è\n04094|         details.push({\n04095|           service: remainder > 0 ? '–ü—Ä–æ—á–∏–µ —É—Å–ª—É–≥–∏' : '–°–∫–∏–¥–∫–∞',\n04096|           description: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–±–æ—Ä—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏',\n04097|           price: remainder\n04098|         });\n04099|       }\n04100|     } else if (calc.company === 'Nord Wheel' && calc.details) {\n04101|       // –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –¥–ª—è Nord Wheel —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º\n04102|       if (calc.details.totalCost) {\n04103|         details.push({\n04104|           service: '–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',\n04105|           description: '',\n04106|           price: calc.details.totalCost\n04107|         });\n04108|       }\n04109|       if (calc.details.deliveryCost) {\n04110|         details.push({\n04111|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–∑–∫–∏',\n04112|           description: '',\n04113|           price: calc.details.deliveryCost\n04114|         });\n04115|       }\n04116|       if (calc.details.terminalCost) {\n04117|         details.push({\n04118|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –º–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–≤–æ–∑–∫–∏',\n04119|           description: '',\n04120|           price: calc.details.terminalCost\n04121|         });\n04122|       }\n04123|       if (calc.details.pickupCost) {\n04124|         details.push({\n04125|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–±–æ—Ä–∞',\n04126|           description: '',\n04127|           price: calc.details.pickupCost\n04128|         });\n04129|       }\n04130|       if (calc.details.deliveryToDoorCost) {\n04131|         details.push({\n04132|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–æ –¥–≤–µ—Ä–∏',\n04133|           description: '',\n04134|           price: calc.details.deliveryToDoorCost\n04135|         });\n04136|       }\n04137|       if (calc.details.additionalServices && calc.details.additionalServices > 0) {\n04138|         details.push({\n04139|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ–ø.—É—Å–ª—É–≥',\n04140|           description: '',\n04141|           price: calc.details.additionalServices\n04142|         });\n04143|       }\n04144| \n04145|     } else if (calc.company === '–ü–≠–ö' && calc.details?.services) {\n04146|       // –î–ª—è –ü–≠–ö –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ API\n04147|       calc.details.services.forEach((service: any) => {\n04148|         if (service.price > 0) {\n04149|           details.push({\n04150|             service: service.name || '–£—Å–ª—É–≥–∞ –ü–≠–ö',\n04151|             description: service.description || '',\n04152|             price: service.price\n04153|           });\n04154|         }\n04155|       });\n04156|     } else if (calc.company === '–°–î–≠–ö' && calc.details) {\n04157|       const cdekServiceNames: Record<string, string> = {\n04158|         'INSURANCE': '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n04159|         'HEAVY_CARGO': '–¢—è–∂–µ–ª–æ–≤–µ—Å–Ω—ã–π –≥—Ä—É–∑',\n04160|         'DELIVERY_TO_DOOR': '–î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –¥–≤–µ—Ä–∏',\n04161|         'PICKUP_FROM_SENDER': '–ó–∞–±–æ—Ä –æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è',\n04162|         'PACKAGE': '–£–ø–∞–∫–æ–≤–∫–∞',\n04163|         'TRYING_ON': '–ü—Ä–∏–º–µ—Ä–∫–∞ –Ω–∞ –¥–æ–º—É',\n04164|         'PART_DELIVERY': '–ß–∞—Å—Ç–∏—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞'\n04165|       };\n04166| \n04167|       if (calc.details.services && calc.details.services.length > 0) {\n04168|         calc.details.services.forEach((service: any) => {\n04169|           const serviceName = cdekServiceNames[service.code] || service.code || '–£—Å–ª—É–≥–∞ –°–î–≠–ö';\n04170|           const servicePrice = service.total_sum || service.sum || 0;\n04171|           \n04172|           if (servicePrice > 0) {\n04173|             details.push({\n04174|               service: serviceName,\n04175|               description: service.code === 'HEAVY_CARGO' \n04176|                 ? `–°–±–æ—Ä –∑–∞ –≥–∞–±–∞—Ä–∏—Ç–Ω—ã–π –≥—Ä—É–∑ (—Ä–∞—Å—á–µ—Ç–Ω—ã–π –≤–µ—Å: ${(calc.details.weight_calc / 1000).toFixed(0)} –∫–≥)`\n04177|                 : service.code === 'INSURANCE'\n04178|                 ? `–û–±—ä—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${form.declaredValue?.toLocaleString() || 0} ‚ÇΩ`\n04179|                 : '',\n04180|               price: servicePrice\n04181|             });\n04182|           }\n04183|         });\n04184|         \n04185|         if (calc.details.delivery_sum && calc.details.total_sum) {\n04186|           details.push({\n04187|             service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n04188|             description: '',\n04189|             price: 0\n04190|           });\n04191|           details.push({\n04192|             service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',\n04193|             description: calc.details.tariff_name || '–ü–µ—Ä–µ–≤–æ–∑–∫–∞',\n04194|             price: Math.round(calc.details.delivery_sum)\n04195|           });\n04196|           \n04197|           const additionalSum = calc.details.services.reduce((sum: number, s: any) => \n04198|             sum + (s.total_sum || s.sum || 0), 0\n04199|           );\n04200|           \n04201|           if (additionalSum > 0) {\n04202|             details.push({\n04203|               service: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏',\n04204|               description: '–î–æ–ø. —Å–±–æ—Ä—ã',\n04205|               price: Math.round(additionalSum)\n04206|             });\n04207|           }\n04208|           \n04209|           details.push({\n04210|             service: '–ò–¢–û–ì–û',\n04211|             description: '–ö –æ–ø–ª–∞—Ç–µ',\n04212|             price: Math.round(calc.details.total_sum)\n04213|           });\n04214|         }\n04215|       } else {\n04216|         details.push({\n04217|           service: '–¢–∞—Ä–∏—Ñ',\n04218|           description: calc.details.tariff_name || '–ù–µ —É–∫–∞–∑–∞–Ω',\n04219|           price: calc.price\n04220|         });\n04221|         \n04222|         if (calc.details.delivery_mode) {\n04223|           details.push({\n04224|             service: '–†–µ–∂–∏–º –¥–æ—Å—Ç–∞–≤–∫–∏',\n04225|             description: calc.details.delivery_mode,\n04226|             price: 0\n04227|           });\n04228|         }\n04229|       }\n04230|       \n04231|       if (calc.details.period_min && calc.details.period_max) {\n04232|         details.push({\n04233|           service: '–°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏',\n04234|           description: `${calc.details.period_min}-${calc.details.period_max} –¥–Ω–µ–π`,\n04235|           price: 0\n04236|         });\n04237|       }\n04238|       \n04239|       if (calc.details.weight_calc) {\n04240|         details.push({\n04241|           service: '–†–∞—Å—á–µ—Ç–Ω—ã–π –≤–µ—Å',\n04242|           description: `${calc.details.weight_calc} –∫–≥`,\n04243|           price: 0\n04244|         });\n04245|       }\n04246|     } else if (calc.company === '–í–æ–∑–æ–≤–æ–∑' && calc.details?.service) {\n04247|       // ‚úÖ –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –í–æ–∑–æ–≤–æ–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ API –æ—Ç–≤–µ—Ç–∞\n04248|       const basePrice = calc.details.basePrice || 0;\n04249|       const finalPrice = calc.details.price || calc.price || 0;\n04250|       const totalDiscount = basePrice - finalPrice;\n04251|       \n04252|       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é —É—Å–ª—É–≥—É —Å –±–∞–∑–æ–≤–æ–π —Ü–µ–Ω–æ–π –∏ —Å–∫–∏–¥–∫–æ–π\n04253|       calc.details.service.forEach((service: any) => {\n04254|         const serviceDiscount = (service.basePrice || 0) - (service.price || 0);\n04255|         \n04256|         // –û—Å–Ω–æ–≤–Ω–∞—è —É—Å–ª—É–≥–∞\n04257|         details.push({\n04258|           service: service.name || '–£—Å–ª—É–≥–∞ –í–æ–∑–æ–≤–æ–∑',\n04259|           description: '',\n04260|           price: service.price || 0\n04261|         });\n04262|         \n04263|         // –°–∫–∏–¥–∫–∞ –Ω–∞ —É—Å–ª—É–≥—É (–µ—Å–ª–∏ –µ—Å—Ç—å)\n04264|         if (serviceDiscount > 0) {\n04265|           details.push({\n04266|             service: `–°–∫–∏–¥–∫–∞ –Ω–∞ ${service.name?.toLowerCase() || '—É—Å–ª—É–≥—É'}`,\n04267|             description: `${(service.basePrice || 0).toLocaleString()} - ${(service.price || 0).toLocaleString()}`,\n04268|             price: -serviceDiscount\n04269|           });\n04270|         }\n04271|       });\n04272|       \n04273|       // –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Å –æ–±—â–∏–º–∏ —Å–∫–∏–¥–∫–∞–º–∏\n04274|       if (totalDiscount > 0) {\n04275|         details.push({\n04276|           service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n04277|           description: '',\n04278|           price: 0\n04279|         });\n04280|         details.push({\n04281|           service: '–ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å',\n04282|           description: '–î–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–∫–∏–¥–æ–∫',\n04283|           price: basePrice\n04284|         });\n04285|         details.push({\n04286|           service: '–û–±—â–∏–µ —Å–∫–∏–¥–∫–∏',\n04287|           description: `–≠–∫–æ–Ω–æ–º–∏—è ${totalDiscount.toLocaleString()} ‚ÇΩ`,\n04288|           price: -totalDiscount\n04289|         });\n04290|         details.push({\n04291|           service: '–ò–¢–û–ì–û',\n04292|           description: '–ö –æ–ø–ª–∞—Ç–µ',\n04293|           price: finalPrice\n04294|         });\n04295|       }\n04296|     } else if (calc.company === '–ö–ò–¢' && calc.details?.services) {\n04297|       calc.details.services.forEach((service: any) => {\n04298|         details.push({\n04299|           service: service.name || '–£—Å–ª—É–≥–∞ –ö–ò–¢',\n04300|           description: service.code || '',\n04301|           price: service.price || 0\n04302|         });\n04303|       });\n04304|       \n04305|       if (calc.details.tariff_name) {\n04306|         details.push({\n04307|           service: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',\n04308|           description: '',\n04309|           price: 0\n04310|         });\n04311|         details.push({\n04312|           service: '–¢–∞—Ä–∏—Ñ',\n04313|           description: calc.details.tariff_name,\n04314|           price: 0\n04315|         });\n04316|         details.push({\n04317|           service: '–ò–¢–û–ì–û',\n04318|           description: calc.details.currency || 'RUB',\n04319|           price: calc.price\n04320|         });\n04321|       }\n04322|     } else {\n04323|       // –î–ª—è –¥—Ä—É–≥–∏—Ö –¢–ö - –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n04324|       details.push({\n04325|         service: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n04326|         description: `${form.fromCity} - ${form.toCity}`,\n04327|         price: calc.price\n04328|       });\n04329|       \n04330|       if (form.needInsurance && form.declaredValue > 0) {\n04331|         details.push({\n04332|           service: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ',\n04333|           description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n04334|           price: Math.round(form.declaredValue * 0.02)\n04335|         });\n04336|       }\n04337|       \n04338|       if (form.needPackaging) {\n04339|         const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n04340|         details.push({\n04341|           service: '–£–ø–∞–∫–æ–≤–∫–∞',\n04342|           description: '',\n04343|           price: Math.round(totalWeight * 30)\n04344|         });\n04345|       }\n04346|     }\n04347|     \n04348|     return details;\n04349|   } catch (globalError) {\n04350|     console.error('‚ùå –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –û–®–ò–ë–ö–ê –≤ parseCalculationDetails:', globalError);\n04351|     console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', globalError instanceof Error ? globalError.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n04352|     console.log('‚ùå calc object:', calc);\n04353|     // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ\n04354|     return [{\n04355|       service: '–î–æ—Å—Ç–∞–≤–∫–∞',\n04356|       description: '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞',\n04357|       price: calc?.price || 0\n04358|     }];\n04359|   }\n04360| };\n04361| \n04362|   // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –ø–æ–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏)\n04363|   if (!isLoaded) {\n04364|     return (\n04365|       <div className=\"min-h-screen bg-gray-900 text-white p-4 relative flex items-center justify-center\">\n04366|         <div className=\"text-center\">\n04367|           <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400 mx-auto mb-4\"></div>\n04368|           <p className=\"text-blue-400\">–ó–∞–≥—Ä—É–∑–∫–∞...</p>\n04369|         </div>\n04370|       </div>\n04371|     );\n04372|   }\n04373| \n04374|   return (\n04375|     <div className=\"min-h-screen bg-gray-900 text-white p-4 relative\">\n04376|       <div className=\"max-w-7xl mx-auto\">\n04377|         <div className=\"flex items-center justify-between mb-3\">\n04378|           <h1 className=\"text-xl font-bold text-blue-400\">\n04379|             –ú–µ–∂–¥—É–≥–æ—Ä–æ–¥–Ω—è—è –¥–æ—Å—Ç–∞–≤–∫–∞ –õ–∞–≤—Å–∏—Ç\n04380|           </h1>\n04381|           \n04382|           {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è */}\n04383|           <div className=\"flex items-center gap-4\">\n04384|             {isFormChanged ? (\n04385|               <div className=\"flex items-center gap-2 text-yellow-400 text-sm\">\n04386|                 <div className=\"w-2 h-2 bg-yellow-400 rounded-full animate-pulse\"></div>\n04387|                 –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...\n04388|               </div>\n04389|             ) : lastSaveTime ? (\n04390|               <div className=\"flex items-center gap-2 text-green-400 text-sm\">\n04391|                 <div className=\"w-2 h-2 bg-green-400 rounded-full\"></div>\n04392|                 –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ {lastSaveTime.toLocaleTimeString()}\n04393|               </div>\n04394|             ) : hasStoredFormData() ? (\n04395|               <div className=\"flex items-center gap-2 text-blue-400 text-sm\">\n04396|                 <div className=\"w-2 h-2 bg-blue-400 rounded-full\"></div>\n04397|                 –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã\n04398|               </div>\n04399|             ) : null}\n04400|             \n04401|             {/* –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö */}\n04402|             {hasStoredFormData() && (\n04403|               <Button\n04404|                 onClick={() => {\n04405|                   if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã?')) {\n04406|                     clearFormData();\n04407|                     setForm(initialFormState);\n04408|                     setLastSaveTime(null);\n04409|                     setIsFormChanged(false);\n04410|                   }\n04411|                 }}\n04412|                 variant=\"outline\"\n04413|                 size=\"sm\"\n04414|                 className=\"border-red-500 text-red-400 hover:bg-red-900/20\"\n04415|               >\n04416|                 <Trash2 className=\"h-3 w-3 mr-1\" />\n04417|                 –û—á–∏—Å—Ç–∏—Ç—å\n04418|               </Button>\n04419|             )}\n04420|           </div>\n04421|         </div>\n04422|         \n04423|         {/* –ö–Ω–æ–ø–∫–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ */}\n04424|         <div className=\"flex justify-end gap-2 mb-4\">\n04425|           <Button \n04426|             onClick={() => window.open('/diagnostic?tab=api', '_blank')}\n04427|             variant=\"outline\" \n04428|             className=\"border-green-500 text-green-400 hover:bg-green-900/20\"\n04429|           >\n04430|             <Settings className=\"h-4 w-4 mr-2\" />\n04431|             –í—Å–µ API\n04432|           </Button>\n04433|           <Button \n04434|             onClick={() => window.open('/diagnostic?tab=docs', '_blank')}\n04435|             variant=\"outline\" \n04436|             className=\"border-purple-500 text-purple-400 hover:bg-purple-900/20\"\n04437|           >\n04438|             <Package2 className=\"h-4 w-4 mr-2\" />\n04439|             –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è\n04440|           </Button>\n04441|           <Button \n04442|             onClick={() => window.open('/diagnostic', '_blank')}\n04443|             variant=\"outline\" \n04444|             className=\"border-blue-500 text-blue-400 hover:bg-blue-900/20\"\n04445|           >\n04446|             <Settings className=\"h-4 w-4 mr-2\" />\n04447|             –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞\n04448|           </Button>\n04449|         </div>\n04450|         \n04451|         <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-3 h-[85vh]\">\n04452|           {/* –õ–µ–≤–∞—è —á–∞—Å—Ç—å - —Ñ–æ—Ä–º–∞ */}\n04453|           <div className=\"space-y-2 overflow-y-auto pr-2\">\n04454|             {/* –ö–∞—Ç–∞–ª–æ–≥ –º–µ–±–µ–ª–∏ */}\n04455|             <Card className=\"bg-gray-800 border-gray-700\">\n04456|               <CardHeader className=\"pb-2\">\n04457|                 <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n04458|                   <Package2 className=\"h-3 w-3\" />\n04459|                   –ö–∞—Ç–∞–ª–æ–≥ –º–µ–±–µ–ª–∏\n04460|                 </CardTitle>\n04461|               </CardHeader>\n04462|               <CardContent className=\"space-y-2\">\n04463|                 {/* –ü–æ–∏—Å–∫ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ */}\n04464|                 <ProductSearch \n04465|                   onProductAdd={handleProductAdd}\n04466|                   disabled={calculating}\n04467|                 />\n04468|                 \n04469|                 {/* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏ */}\n04470|                 <ProductManager\n04471|                   products={form.selectedProducts}\n04472|                   onQuantityChange={handleProductQuantityChange}\n04473|                   onProductRemove={handleProductRemove}\n04474|                   disabled={calculating}\n04475|                 />\n04476|               </CardContent>\n04477|             </Card>\n04478| \n04479|             {/* –ì—Ä—É–∑—ã */}\n04480|             <Card className=\"bg-gray-800 border-gray-700\">\n04481|               <CardHeader className=\"pb-2\">\n04482|                 <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n04483|                   <Truck className=\"h-3 w-3\" />\n04484|                   –ì—Ä—É–∑—ã\n04485|                 </CardTitle>\n04486|               </CardHeader>\n04487|               <CardContent className=\"space-y-2\">\n04488|                 {groupCargosForDisplay(form.cargos).map((group, groupIndex) => (\n04489|                    <div key={`group_${groupIndex}`} className=\"border border-gray-600 rounded p-2\">\n04490|                     <div className=\"flex justify-between items-center mb-2\">\n04491|                       <h4 className=\"text-sm font-medium text-white\">\n04492|                         {group.isEmpty ? (\n04493|                           `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1}`\n04494|                         ) : group.quantity === 1 ? (\n04495|                           `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1}`\n04496|                         ) : (\n04497|                           `–ì—Ä—É–∑ ‚Ññ${group.indices[0] + 1} - ${group.quantity} –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –º–µ—Å—Ç–∞`\n04498|                         )}\n04499|                       </h4>\n04500|                       {form.cargos.length > 1 && group.quantity === 1 && (\n04501|                         <Button\n04502|                           variant=\"destructive\"\n04503|                           size=\"sm\"\n04504|                           onClick={() => removeCargo(form.cargos[group.indices[0]].id)}\n04505|                           className=\"h-6 text-xs\"\n04506|                         >\n04507|                           –£–¥–∞–ª–∏—Ç—å\n04508|                         </Button>\n04509|                       )}\n04510|                       {group.quantity > 1 && (\n04511|                         <Badge variant=\"secondary\" className=\"text-xs\">\n04512|                           {group.quantity} —à—Ç.\n04513|                         </Badge>\n04514|                       )}\n04515|                     </div>\n04516|                     \n04517|                     {group.isEmpty || group.quantity === 1 ? (\n04518|                       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞ –¥–ª—è –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ –∏–ª–∏ –µ–¥–∏–Ω–∏—á–Ω—ã—Ö\n04519|                       <div className=\"grid grid-cols-2 gap-2\">\n04520|                         <div>\n04521|                           <Label className=\"text-white text-xs\">–î–ª–∏–Ω–∞ (—Å–º)</Label>\n04522|                           <Input\n04523|                             type=\"number\"\n04524|                             value={form.cargos[group.indices[0]].length || ''}\n04525|                             onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'length', Number(e.target.value))}\n04526|                             className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n04527|                           />\n04528|                         </div>\n04529|                         <div>\n04530|                           <Label className=\"text-white text-xs\">–®–∏—Ä–∏–Ω–∞ (—Å–º)</Label>\n04531|                           <Input\n04532|                             type=\"number\"\n04533|                             value={form.cargos[group.indices[0]].width || ''}\n04534|                             onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'width', Number(e.target.value))}\n04535|                             className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n04536|                           />\n04537|                         </div>\n04538|                         <div>\n04539|                           <Label className=\"text-white text-xs\">–í—ã—Å–æ—Ç–∞ (—Å–º)</Label>\n04540|                           <Input\n04541|                             type=\"number\"\n04542|                             value={form.cargos[group.indices[0]].height || ''}\n04543|                             onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'height', Number(e.target.value))}\n04544|                             className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n04545|                           />\n04546|                         </div>\n04547|                         <div>\n04548|                           <Label className=\"text-white text-xs\">–í–µ—Å (–∫–≥)</Label>\n04549|                           <Input\n04550|                             type=\"number\"\n04551|                             value={form.cargos[group.indices[0]].weight || ''}\n04552|                             onChange={(e) => updateCargo(form.cargos[group.indices[0]].id, 'weight', Number(e.target.value))}\n04553|                             className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n04554|                           />\n04555|                         </div>\n04556|                       </div>\n04557|                     ) : (\n04558|                       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –≥—Ä—É–ø–ø\n04559|                       <div className=\"grid grid-cols-2 gap-2 text-sm text-gray-300\">\n04560|                         <div>–î–ª–∏–Ω–∞: {group.length} —Å–º</div>\n04561|                         <div>–®–∏—Ä–∏–Ω–∞: {group.width} —Å–º</div>\n04562|                         <div>–í—ã—Å–æ—Ç–∞: {group.height} —Å–º</div>\n04563|                         <div>–í–µ—Å: {group.weight} –∫–≥</div>\n04564|                         <div className=\"col-span-2 text-xs text-blue-300 mt-1\">\n04565|                           –û–±—â–∏–π –≤–µ—Å: {(group.weight * group.quantity).toFixed(1)} –∫–≥, \n04566|                           –æ–±—ä–µ–º: {((group.length * group.width * group.height * group.quantity) / 1000000).toFixed(3)} –º¬≥\n04567|                         </div>\n04568|                       </div>\n04569|                     )}\n04570|                   </div>\n04571|                 ))}\n04572|                  <Button onClick={addCargo} className=\"w-full h-7 text-xs\" variant=\"outline\">\n04573|                   <Plus className=\"h-3 w-3 mr-1\" />\n04574|                   –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–∑\n04575|                 </Button>\n04576|               </CardContent>\n04577|             </Card>\n04578| \n04579|             {/* –ú–∞—Ä—à—Ä—É—Ç */}\n04580|             <Card className=\"bg-gray-800 border-gray-700\">\n04581|               <CardHeader className=\"pb-2\">\n04582|                 <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n04583|                   <Map className=\"h-3 w-3\" />\n04584|                   –ú–∞—Ä—à—Ä—É—Ç\n04585|                 </CardTitle>\n04586|               </CardHeader>\n04587|               <CardContent className=\"space-y-2\">\n04588|                 {/* –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */}\n04589|                 <div className=\"space-y-2\">\n04590|                   <Label className=\"text-sm font-medium text-white\">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</Label>\n04591|                   <div className=\"flex gap-3 flex-wrap\">\n04592|                     <label className=\"flex items-center space-x-1\">\n04593|                       <input\n04594|                         type=\"radio\"\n04595|                         name=\"fromDelivery\"\n04596|                         checked={form.fromTerminal}\n04597|                         onChange={() => setForm(prev => ({ ...prev, fromTerminal: true, fromAddressDelivery: false, fromLavsiteWarehouse: false }))}\n04598|                       />\n04599|                       <span className=\"text-white text-xs\">–û—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞</span>\n04600|                     </label>\n04601|                     <label className=\"flex items-center space-x-1\">\n04602|                       <input\n04603|                         type=\"radio\"\n04604|                         name=\"fromDelivery\"\n04605|                         checked={form.fromAddressDelivery && !form.fromLavsiteWarehouse}\n04606|                         onChange={() => setForm(prev => ({ ...prev, fromTerminal: false, fromAddressDelivery: true, fromLavsiteWarehouse: false }))}\n04607|                       />\n04608|                       <span className=\"text-white text-xs\">–û—Ç –∞–¥—Ä–µ—Å–∞</span>\n04609|                     </label>\n04610|                     <label className=\"flex items-center space-x-1\">\n04611|                       <Checkbox\n04612|                         id=\"lavsiteWarehouse\"\n04613|                         checked={form.fromLavsiteWarehouse}\n04614|                         onCheckedChange={handleLavsiteWarehouseChange}\n04615|                       />\n04616|                       <span className=\"text-white text-xs cursor-pointer\">–°–æ —Å–∫–ª–∞–¥–∞ –õ–∞–≤—Å–∏—Ç</span>\n04617|                     </label>\n04618|                   </div>\n04619|                   \n04620|                   <div>\n04621|                     <Label className=\"text-white text-xs\">–ì–æ—Ä–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</Label>\n04622|                     <Input\n04623|                       value={form.fromCity}\n04624|                       onChange={(e) => !form.fromLavsiteWarehouse && handleAddressChange('fromCity', e.target.value, e.target)}\n04625|                       placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –≥–æ—Ä–æ–¥\"\n04626|                       disabled={form.fromLavsiteWarehouse}\n04627|                       className={`bg-gray-700 border-gray-600 h-7 text-white text-xs ${form.fromLavsiteWarehouse ? 'opacity-50 cursor-not-allowed' : ''}`}\n04628|                     />\n04629|                   </div>\n04630|                   \n04631|                   {form.fromAddressDelivery && (\n04632|                     <div>\n04633|                       <Label className=\"text-white text-xs\">–ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</Label>\n04634|                       <Input\n04635|                         value={form.fromAddress}\n04636|                         onChange={(e) => !form.fromLavsiteWarehouse && handleAddressChange('fromAddress', e.target.value, e.target)}\n04637|                         placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å\"\n04638|                         disabled={form.fromLavsiteWarehouse}\n04639|                         className={`bg-gray-700 border-gray-600 h-7 text-white text-xs ${form.fromLavsiteWarehouse ? 'opacity-50 cursor-not-allowed' : ''}`}\n04640|                       />\n04641|                     </div>\n04642|                   )}\n04643|                 </div>\n04644| \n04645|                 {/* –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ */}\n04646|                 <div className=\"space-y-2\">\n04647|                   <Label className=\"text-sm font-medium text-white\">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</Label>\n04648|                   <div className=\"flex gap-3 flex-wrap\">\n04649|                     <label className=\"flex items-center space-x-1\">\n04650|                       <input\n04651|                         type=\"radio\"\n04652|                         name=\"toDelivery\"\n04653|                         checked={form.toTerminal}\n04654|                         onChange={() => setForm(prev => ({ ...prev, toTerminal: true, toAddressDelivery: false }))}\n04655|                       />\n04656|                       <span className=\"text-white text-xs\">–î–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞</span>\n04657|                     </label>\n04658|                     <label className=\"flex items-center space-x-1\">\n04659|                       <input\n04660|                         type=\"radio\"\n04661|                         name=\"toDelivery\"\n04662|                         checked={form.toAddressDelivery}\n04663|                         onChange={() => setForm(prev => ({ ...prev, toTerminal: false, toAddressDelivery: true }))}\n04664|                       />\n04665|                       <span className=\"text-white text-xs\">–î–æ –∞–¥—Ä–µ—Å–∞</span>\n04666|                     </label>\n04667|                   </div>\n04668|                   \n04669|                   <div>\n04670|                     <Label className=\"text-white text-xs\">–ì–æ—Ä–æ–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</Label>\n04671|                     <Input\n04672|                       value={form.toCity}\n04673|                       onChange={(e) => handleAddressChange('toCity', e.target.value, e.target)}\n04674|                       placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –≥–æ—Ä–æ–¥\"\n04675|                       className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n04676|                     />\n04677|                   </div>\n04678|                   \n04679|                   {form.toAddressDelivery && (\n04680|                     <div>\n04681|                       <Label className=\"text-white text-xs\">–ê–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</Label>\n04682|                       <Input\n04683|                         value={form.toAddress}\n04684|                         onChange={(e) => handleAddressChange('toAddress', e.target.value, e.target)}\n04685|                         placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å\"\n04686|                         className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n04687|                       />\n04688|                     </div>\n04689|                   )}\n04690|                 </div>\n04691| \n04692|                 <div>\n04693|                   <Label className=\"text-white text-xs\">–û–±—ä—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (—Ä—É–±.)</Label>\n04694|                   <Input\n04695|                     type=\"number\"\n04696|                     value={form.declaredValue || ''}\n04697|                     onChange={(e) => setForm(prev => ({ ...prev, declaredValue: Number(e.target.value) }))}\n04698|                     className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n04699|                   />\n04700|                 </div>\n04701|                 \n04702|                 <div className=\"space-y-2\">\n04703|                   <div className=\"flex items-center space-x-2\">\n04704|                     <Checkbox\n04705|                       id=\"packaging\"\n04706|                       checked={form.needPackaging}\n04707|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needPackaging: checked as boolean }))}\n04708|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n04709|                     />\n04710|                     <Label htmlFor=\"packaging\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è —É–ø–∞–∫–æ–≤–∫–∞</Label>\n04711|                   </div>\n04712|                   \n04713|                   <div className=\"flex items-center space-x-2\">\n04714|                     <Checkbox\n04715|                       id=\"insurance\"\n04716|                       checked={form.needInsurance}\n04717|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needInsurance: checked as boolean }))}\n04718|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n04719|                     />\n04720|                     <Label htmlFor=\"insurance\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞</Label>\n04721|                   </div>\n04722|                   \n04723|                   <div className=\"flex items-center space-x-2\">\n04724|                     <Checkbox\n04725|                       id=\"loading\"\n04726|                       checked={form.needLoading}\n04727|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needLoading: checked as boolean }))}\n04728|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n04729|                     />\n04730|                     <Label htmlFor=\"loading\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≥—Ä—É–∑–∫–∞/—Ä–∞–∑–≥—Ä—É–∑–∫–∞</Label>\n04731|                   </div>\n04732|                   \n04733|                   <div className=\"flex items-center space-x-2\">\n04734|                     <Checkbox\n04735|                       id=\"carry\"\n04736|                       checked={form.needCarry}\n04737|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needCarry: checked as boolean }))}\n04738|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n04739|                     />\n04740|                     <Label htmlFor=\"carry\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—ä–µ–º</Label>\n04741|                   </div>\n04742|                   \n04743|                   {form.needCarry && (\n04744|                     <div className=\"ml-6 space-y-2 border-l-2 border-gray-600 pl-3\">\n04745|                       <div>\n04746|                         <Label className=\"text-white text-xs\">–≠—Ç–∞–∂</Label>\n04747|                         <Input\n04748|                           type=\"number\"\n04749|                           value={form.floor}\n04750|                           onChange={(e) => setForm(prev => ({ ...prev, floor: Number(e.target.value) }))}\n04751|                           className=\"bg-gray-700 border-gray-600 h-7 text-white text-xs\"\n04752|                         />\n04753|                       </div>\n04754|                       <div className=\"flex items-center space-x-2\">\n04755|                         <Checkbox\n04756|                           id=\"freightLift\"\n04757|                           checked={form.hasFreightLift}\n04758|                           onCheckedChange={(checked) => setForm(prev => ({ ...prev, hasFreightLift: checked as boolean }))}\n04759|                         />\n04760|                         <Label htmlFor=\"freightLift\" className=\"text-white text-xs\">–ù–∞–ª–∏—á–∏–µ –≥—Ä—É–∑–æ–≤–æ–≥–æ –ª–∏—Ñ—Ç–∞</Label>\n04761|                       </div>\n04762|                     </div>\n04763|                   )}\n04764|                 </div>\n04765|                 \n04766|                 <div className=\"space-y-2\">\n04767|                   <Button \n04768|                     onClick={handleCalculate} \n04769|                     className=\"w-full bg-blue-600 hover:bg-blue-700 h-7 text-xs\" \n04770|                     disabled={calculating}\n04771|                   >\n04772|                     {calculating ? '–†–∞—Å—á–µ—Ç...' : '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å'}\n04773|                   </Button>\n04774|                   \n04775|                   <Button \n04776|                     onClick={handleReset} \n04777|                     variant=\"outline\" \n04778|                     className=\"w-full h-7 text-xs text-black border-gray-600 hover:bg-gray-700 hover:text-white\" \n04779|                     disabled={calculating}\n04780|                   >\n04781|                     –°–±—Ä–æ—Å–∏—Ç—å —Ä–∞—Å—á–µ—Ç\n04782|                   </Button>\n04783|                 </div>\n04784|               </CardContent>\n04785|             </Card>\n04786|           </div>\n04787| \n04788|           {/* –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã */}\n04789|           <div className=\"space-y-2 overflow-y-auto\">\n04790|             {calculations.length > 0 && (\n04791|                  <div className=\"space-y-2\">\n04792|                 <div className=\"flex justify-between items-center\">\n04793|                   <h2 className=\"text-lg font-bold text-blue-400\">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞</h2>\n04794|                   <Button \n04795|                     onClick={exportToPDF} \n04796|                     variant=\"outline\" \n04797|                     size=\"sm\" \n04798|                     className=\"h-7 text-xs border-blue-500 text-blue-400 hover:bg-blue-900/20 print:hidden\"\n04799|                   >\n04800|                     –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ PDF\n04801|                   </Button>\n04802|                 </div>\n04803|                 \n04804|                 {calculations.map((calc, index) => (\n04805|                    <Card key={index} className=\"bg-gray-800 border-gray-700 text-xs\">\n04806|                      <CardHeader className=\"pb-1\">\n04807|                       <div className=\"flex justify-between items-center\">\n04808|                          <CardTitle className=\"text-white flex items-center gap-2 text-xs\">\n04809|                            <Building2 className=\"h-3 w-3\" />\n04810|                           {calc.company}\n04811|                         </CardTitle>\n04812|                         {calc.error ? (\n04813|                           <Badge variant=\"destructive\" className=\"text-xs\">–û—à–∏–±–∫–∞</Badge>\n04814|                         ) : (\n04815|                           <Badge variant=\"default\" className=\"bg-green-600 text-xs\">\n04816|                             {calc.price.toLocaleString()} ‚ÇΩ\n04817|                           </Badge>\n04818|                         )}\n04819|                       </div>\n04820|                     </CardHeader>\n04821|                     <CardContent className=\"pt-0\">\n04822|                       <div className=\"space-y-2\">\n04823|                         {calc.error ? (\n04824|                           <div className=\"space-y-2\">\n04825|                             <Alert className=\"border-red-600\">\n04826|                               <AlertDescription className=\"text-white text-xs\">{calc.error}</AlertDescription>\n04827|                             </Alert>\n04828|                             {calc.price > 0 && (\n04829|                               <>\n04830|                                 <p className=\"text-white text-xs\"><strong>–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {calc.price.toLocaleString()} ‚ÇΩ</p>\n04831|                                 <p className=\"text-white text-xs\"><strong>–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Å—Ä–æ–∫:</strong> {calc.days} –¥–Ω–µ–π</p>\n04832|                               </>\n04833|                             )}\n04834|                           </div>\n04835|                         ) : (\n04836|                           <>\n04837|                             <p className=\"text-white text-xs\"><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {calc.price.toLocaleString()} ‚ÇΩ</p>\n04838|                             <p className=\"text-white text-xs\"><strong>–°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> {calc.days} –¥–Ω–µ–π</p>\n04839|                           </>\n04840|                         )}\n04841|                         \n04842|                         <div className=\"flex gap-2 mt-2\">\n04843|                           {!calc.error && (\n04844|                             <Button\n04845|                               variant=\"outline\"\n04846|                               size=\"sm\"\n04847|                               onClick={() => toggleDetails(calc.company)}\n04848|                               className=\"h-6 text-xs\"\n04849|                             >\n04850|                               {expandedDetails[calc.company] ? '–°–∫—Ä—ã—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ' : '–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ'}\n04851|                             </Button>\n04852|                           )}\n04853|                           <Button\n04854|                             variant=\"outline\"\n04855|                             size=\"sm\"\n04856|                             onClick={() => toggleDebugInfo(calc.company)}\n04857|                             className=\"h-6 text-xs\"\n04858|                           >\n04859|                             {expandedDebugInfo[calc.company] ? '–°–∫—Ä—ã—Ç—å –æ—Ç–ª–∞–¥–∫—É' : '–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'}\n04860|                           </Button>\n04861|                         </div>\n04862|                         \n04863|                         {/* –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ */}\n04864|                         {!calc.error && (\n04865|                           <Collapsible open={expandedDetails[calc.company]}>\n04866|                             <CollapsibleContent className=\"mt-2\">\n04867|                               <div className=\"bg-gray-900 p-3 rounded text-xs\">\n04868|                                 <h4 className=\"font-bold mb-2 text-white\">–î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞:</h4>\n04869|                                 {(() => {\n04870|                                   const details = parseCalculationDetails(calc);\n04871|                                   const totalPrice = details.reduce((sum, detail) => sum + detail.price, 0);\n04872|                                   \n04873|                                   return (\n04874|                                     <div className=\"space-y-1\">\n04875|                                       {details.map((detail, idx) => (\n04876|                                         <div key={idx} className=\"flex justify-between text-white\">\n04877|                                           <div>\n04878|                                             <div className=\"font-medium\">{detail.service}</div>\n04879|                                             {detail.description && (\n04880|                                               <div className=\"text-gray-400 text-xs\">{detail.description}</div>\n04881|                                             )}\n04882|                                           </div>\n04883|                                           <div className=\"font-medium\">{detail.price.toLocaleString()} ‚ÇΩ</div>\n04884|                                         </div>\n04885|                                       ))}\n04886|                                     </div>\n04887|                                   );\n04888|                                 })()}\n04889|                               </div>\n04890|                             </CollapsibleContent>\n04891|                           </Collapsible>\n04892|                         )}\n04893|                         \n04894|                         {/* –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è - –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ */}\n04895|                         <Collapsible open={expandedDebugInfo[calc.company]}>\n04896|                           <CollapsibleContent className=\"mt-2\">\n04897|                             <div className=\"bg-gray-900 p-3 rounded text-xs\">\n04898|                               <h4 className=\"font-bold mb-2 text-white\">–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h4>\n04899|                               \n04900|                               {calc.apiUrl && (\n04901|                                 <div className=\"mb-3\">\n04902|                                   <h5 className=\"font-bold mb-1 text-white\">–ó–∞–ø—Ä–æ—Å –∫ API:</h5>\n04903|                                   <p className=\"text-gray-300 break-all text-xs\">URL: {calc.apiUrl}</p>\n04904|                                 </div>\n04905|                               )}\n04906|                               \n04907|                               {calc.sessionId && (\n04908|                                 <div className=\"mb-3\">\n04909|                                   <h5 className=\"font-bold mb-1 text-white\">Session ID:</h5>\n04910|                                   <p className=\"text-gray-300 text-xs\">{calc.sessionId}</p>\n04911|                                 </div>\n04912|                               )}\n04913|                               \n04914|                               {calc.requestData && (\n04915|                                 <div className=\"mb-3\">\n04916|                                   <h5 className=\"font-bold mb-1 text-white\">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å:</h5>\n04917|                                   <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n04918|                                     {JSON.stringify(calc.requestData, null, 2)}\n04919|                                   </pre>\n04920|                                 </div>\n04921|                               )}\n04922|                               \n04923|                               {calc.responseData && (\n04924|                                 <div className=\"mb-3\">\n04925|                                   <h5 className=\"font-bold mb-1 text-white\">–ü–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç:</h5>\n04926|                                   <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n04927|                                     {JSON.stringify(calc.responseData, null, 2)}\n04928|                                   </pre>\n04929|                                 </div>\n04930|                               )}\n04931|                               \n04932|                               {calc.details && (\n04933|                                 <div className=\"mb-3\">\n04934|                                   <h5 className=\"font-bold mb-1 text-white\">–î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ (JSON):</h5>\n04935|                                   <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n04936|                                     {JSON.stringify(calc.details, null, 2)}\n04937|                                   </pre>\n04938|                                 </div>\n04939|                               )}\n04940|                               \n04941|                               {calc.error && (\n04942|                                 <div className=\"mb-3\">\n04943|                                   <h5 className=\"font-bold mb-1 text-red-400\">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ:</h5>\n04944|                                   <p className=\"text-red-300 text-xs\">{calc.error}</p>\n04945|                                 </div>\n04946|                               )}\n04947|                             </div>\n04948|                           </CollapsibleContent>\n04949|                         </Collapsible>\n04950|                       </div>\n04951|                     </CardContent>\n04952|                   </Card>\n04953|                 ))}\n04954|               </div>\n04955|             )}\n04956| \n04957|             {/* –°–ø–∏—Å–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –¢–ö - –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º—ã–π */}\n04958|             <Card className=\"bg-gray-800 border-gray-700\">\n04959|               <CardHeader className=\"pb-2\">\n04960|                 <CardTitle className=\"text-white text-sm\">\n04961|                   –ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ ({COMPANIES_BASE.length})\n04962|                 </CardTitle>\n04963|               </CardHeader>\n04964|               <CardContent>\n04965|                 <div className=\"grid grid-cols-2 gap-2\">\n04966|                   {COMPANIES_BASE.map((company, index) => {\n04967|                     const isConnected = apiStatus[company.apiKey as keyof typeof apiStatus] === '–ø–æ–¥–∫–ª—é—á–µ–Ω–æ';\n04968|                     const statusText = apiStatus[company.apiKey as keyof typeof apiStatus];\n04969|                     const isEnabled = enabledCompanies[company.apiKey];\n04970|                     \n04971|                     // –û—Ç–ª–∞–¥–∫–∞ –¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–æ–º–ø–∞–Ω–∏–π\n04972|                     if (index < 3) {\n04973|                       console.log(`üîç –ö–æ–º–ø–∞–Ω–∏—è ${index}: ${company.name}, apiKey: ${company.apiKey}, isEnabled: ${isEnabled}, statusText: ${statusText}`);\n04974|                     }\n04975|                     \n04976|                     return (\n04977|                       <div key={index} className=\"flex items-center justify-between p-1.5 bg-gray-700 rounded\">\n04978|                         <div className=\"flex items-center gap-2\">\n04979|                           <span className=\"text-lg\">{company.logo}</span>\n04980|                           <div>\n04981|                             <p className=\"font-medium text-white text-[10px] leading-tight\">{company.name}</p>\n04982|                             <Badge \n04983|                               variant={isConnected ? \"default\" : \"destructive\"} \n04984|                               className=\"text-[9px] py-0 px-1\"\n04985|                             >\n04986|                               {isConnected ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–∞' : statusText === '–ø—Ä–æ–≤–µ—Ä–∫–∞...' ? '–ü—Ä–æ–≤–µ—Ä–∫–∞...' : '–û—à–∏–±–∫–∞'}\n04987|                             </Badge>\n04988|                           </div>\n04989|                         </div>\n04990|                         <div className=\"flex items-center gap-2\">\n04991|                           <span className=\"text-[9px] text-gray-300\">\n04992|                             {isEnabled ? '–í–∫–ª' : '–í—ã–∫–ª'}\n04993|                           </span>\n04994|                           <Switch\n04995|                             checked={isEnabled}\n04996|                             onCheckedChange={(checked) => {\n04997|                               setEnabledCompanies(prev => ({\n04998|                                 ...prev,\n04999|                                 [company.apiKey]: checked\n05000|                               }));\n05001|                             }}\n05002|                             disabled={!isConnected}\n05003|                           />\n05004|                         </div>\n05005|                       </div>\n05006|                     );\n05007|                   })}\n05008|                 </div>\n05009|               </CardContent>\n05010|             </Card>\n05011| \n05012|             {/* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫—É–∑–æ–≤–∞ */}\n05013|             {calculations.length > 0 && (\n05014|               <TruckVisualization \n05015|                 cargos={form.cargos.map(cargo => ({\n05016|                   id: cargo.id,\n05017|                   length: cargo.length * 10, // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n05018|                   width: cargo.width * 10,   // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n05019|                   height: cargo.height * 10, // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–º\n05020|                   weight: cargo.weight,\n05021|                   productName: form.selectedProducts?.find(p => \n05022|                     p.cargoIndexes.includes(form.cargos.indexOf(cargo))\n05023|                   )?.product.name\n05024|                 }))}\n05025|                 isVisible={true}\n05026|               />\n05027|             )}\n05028|           </div>\n05029|         </div>\n05030|       </div>\n05031| \n05032|       {/* –ê–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–∫–∏ */}\n05033|       {showSuggestions && suggestions.length > 0 && (\n05034|         <div \n05035|           className=\"fixed z-50 bg-gray-800 border border-gray-700 rounded-md shadow-lg max-w-sm w-full max-h-60 overflow-y-auto\"\n05036|           style={{\n05037|             top: suggestionPosition.top,\n05038|             left: suggestionPosition.left\n05039|           }}\n05040|         >\n05041|           <div className=\"p-1\">\n05042|             {suggestions.map((suggestion, index) => (\n05043|               <div\n05044|                 key={index}\n05045|                 className=\"p-2 hover:bg-gray-700 cursor-pointer text-xs text-white rounded transition-colors\"\n05046|                 onClick={() => selectSuggestion(suggestion)}\n05047|               >\n05048|                 {suggestion.value}\n05049|               </div>\n05050|             ))}\n05051|           </div>\n05052|         </div>\n05053|       )}\n05054|     </div>\n05055|   );\n05056| }\n</file>",
    "title": "app/page.tsx",
    "metadata": {
      "preview": "    const apiUrl = '/api/vozovoz';\n    \n    try {\n      // –í—ã—á–∏—Å–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥—Ä—É–∑–∞\n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n      const totalVolume = form.cargos.reduce((sum, cargo) => \n        sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n      );\n      \n      // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –í–æ–∑–æ–≤–æ–∑\n      const maxDimensions = form.cargos.reduce((max, cargo) => {\n        const length = cargo.length / 1000; // –ø–µ—Ä–µ–≤–æ–¥–∏–º –º–º –≤ –º\n        const width = cargo.width / 1000;\n        const height = cargo.height / 1000;\n        const weight = cargo.weight;\n        \n        return {\n          length: Math.max(max.length, length),\n          width: Math.max(max.width, width),\n          height: Math.max(max.height, height),"
    },
    "time": {
      "start": 1763471627844,
      "end": 1763471627851
    }
  }
}