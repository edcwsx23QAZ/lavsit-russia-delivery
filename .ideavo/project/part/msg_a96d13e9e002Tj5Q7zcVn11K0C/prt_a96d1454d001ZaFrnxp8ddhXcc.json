{
  "id": "prt_a96d1454d001ZaFrnxp8ddhXcc",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "messageID": "msg_a96d13e9e002Tj5Q7zcVn11K0C",
  "type": "tool",
  "callID": "call_37205323",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "app/page.tsx",
      "offset": 607
    },
    "output": "<file>\n00608|         try {\n00609|           const totalWeight = 10;\n00610|           const totalVolume = 0.1;\n00611|           \n00612|           const params = new URLSearchParams({\n00613|             from: '91',\n00614|             to: '92',\n00615|             pickup: '1',\n00616|             deliver: '1',\n00617|             weight: totalWeight.toString(),\n00618|             volume: totalVolume.toString(),\n00619|             oversized: '0',\n00620|             package: '1',\n00621|             packageCount: '1',\n00622|             insurance: '1',\n00623|             sum: '50000',\n00624|             documentsReturn: '0',\n00625|             fragile: '1'\n00626|           });\n00627| \n00628|           const fullUrl = `https://nordw.ru/tools/api/calc/calculate/?${params.toString()}`;\n00629|        const result = await enhancedApiRequest(\n00630|          fullUrl,\n00631|          {\n00632|            method: 'GET'\n00633|          },\n00634|          { operation: 'calculate', company: 'Nord Wheel' }\n00635|        );\n00636| \n00637|         if (result && typeof result === 'object' && 'success' in result && !result.success) {\n00638|           console.error('‚ùå Nord Wheel API –æ—à–∏–±–∫–∞:', result.error);\n00639|           return {\n00640|             company: 'Nord Wheel',\n00641|             price: 0,\n00642|             days: 0,\n00643|             error: result.error.userMessage || result.error.message,\n00644|             requestData: params,\n00645|             responseData: null,\n00646|             apiUrl: fullUrl\n00647|           };\n00648|         }\n00649| \n00650|        const response = result as Response;\n00651|        const data = await response.json();\n00652|           \n00653|           if (response.ok && data.status === 'success') {\n00654|             return { success: true };\n00655|           } else {\n00656|             return { error: true };\n00657|           }\n00658|         } catch (error) {\n00659|           return { error: true };\n00660|         }\n00661|       }),\n00662|       \n00663|       checkAPIStatus('cdek', async () => {\n00664|         try {\n00665|           const response = await fetch('/api/cdek', {\n00666|             method: 'POST',\n00667|             headers: { 'Content-Type': 'application/json' },\n00668|             body: JSON.stringify({\n00669|               from_city: testData.fromCity,\n00670|               to_city: testData.toCity,\n00671|               packages: [{\n00672|                 height: 10,\n00673|                 length: 20,\n00674|                 width: 10,\n00675|                 weight: 1000\n00676|               }]\n00677|             })\n00678|           });\n00679|           const data = await response.json();\n00680|           \n00681|           if (response.ok && data.tariff_codes && data.tariff_codes.length > 0) {\n00682|             return { success: true };\n00683|           } else {\n00684|             return { error: true };\n00685|           }\n00686|         } catch (error) {\n00687|           return { error: true };\n00688|         }\n00689|       })\n00690|     ]).finally(() => {\n00691|       // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n00692|       setForm(currentForm);\n00693|     });\n00694|   };\n00695| \n00696|   const searchAddresses = useCallback(async (query: string, field: string, element?: HTMLInputElement) => {\n00697|     if (query.length < 3) {\n00698|       setSuggestions([]);\n00699|       setShowSuggestions(false);\n00700|       return;\n00701|     }\n00702| \n00703|     setActiveField(field);\n00704|     \n00705|     // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ –∞–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–æ–∫\n00706|     if (element) {\n00707|       const rect = element.getBoundingClientRect();\n00708|       setSuggestionPosition({\n00709|         top: rect.bottom + window.scrollY,\n00710|         left: rect.left + window.scrollX\n00711|       });\n00712|     }\n00713|     \n00714|     try {\n00715|       const response = await fetch('https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address', {\n00716|         method: 'POST',\n00717|         headers: {\n00718|           'Content-Type': 'application/json',\n00719|           'Accept': 'application/json',\n00720|           'Authorization': 'Token eb87bbb3789bb43ed465f796892ea951f9e91008'\n00721|         },\n00722|         body: JSON.stringify({\n00723|           query: query,\n00724|           count: 10,\n00725|           // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª–µ–π –≥–æ—Ä–æ–¥–æ–≤ - —Ç–æ–ª—å–∫–æ –≥–æ—Ä–æ–¥–∞\n00726|           ...(field === 'fromCity' || field === 'toCity' ? {\n00727|             restrict_value: true,\n00728|             locations: [{\n00729|               country: '–†–æ—Å—Å–∏—è'\n00730|             }],\n00731|             from_bound: { value: 'city' },\n00732|             to_bound: { value: 'city' }\n00733|           } : {})\n00734|         })\n00735|       });\n00736| \n00737|       if (response.ok) {\n00738|         const data = await response.json();\n00739|         setSuggestions(data.suggestions || []);\n00740|         setShowSuggestions(true);\n00741|       }\n00742|     } catch (error) {\n00743|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫:', error);\n00744|     }\n00745|   }, []);\n00746| \n00747|   const debounceTimer = React.useRef<NodeJS.Timeout>();\n00748|   const handleAddressChange = (field: string, value: string, element?: HTMLInputElement) => {\n00749|     setForm(prev => ({ ...prev, [field]: value }));\n00750|     \n00751|     clearTimeout(debounceTimer.current);\n00752|     debounceTimer.current = setTimeout(() => {\n00753|       searchAddresses(value, field, element);\n00754|     }, 50);\n00755|   };\n00756| \n00757|   const selectSuggestion = (suggestion: AddressSuggestion) => {\n00758|     setForm(prev => ({ ...prev, [activeField]: suggestion.value }));\n00759|     setShowSuggestions(false);\n00760|     setActiveField('');\n00761|   };\n00762| \n00763|   // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞ \"–°–æ —Å–∫–ª–∞–¥–∞ –õ–∞–≤—Å–∏—Ç\"\n00764|   const handleLavsiteWarehouseChange = (checked: boolean) => {\n00765|     if (checked) {\n00766|       setForm(prev => ({\n00767|         ...prev,\n00768|         fromLavsiteWarehouse: true,\n00769|         fromAddressDelivery: true,\n00770|         fromTerminal: false,\n00771|         fromCity: '–õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π',\n00772|         fromAddress: '–¥–µ—Ä–µ–≤–Ω—è –û—Å–µ–µ–≤–æ, 202, –≥–æ—Ä–æ–¥—Å–∫–æ–π –æ–∫—Ä—É–≥ –õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π, –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å'\n00773|       }));\n00774|     } else {\n00775|       setForm(prev => ({\n00776|         ...prev,\n00777|         fromLavsiteWarehouse: false,\n00778|         fromCity: '',\n00779|         fromAddress: ''\n00780|       }));\n00781|     }\n00782|   };\n00783| \n00784|   const addCargo = () => {\n00785|     const newId = (form.cargos.length + 1).toString();\n00786|     setForm(prev => ({\n00787|       ...prev,\n00788|       cargos: [...prev.cargos, { id: newId, length: 0, width: 0, height: 0, weight: 0 }]\n00789|     }));\n00790|   };\n00791| \n00792|   const updateCargo = (id: string, field: string, value: number) => {\n00793|     setForm(prev => {\n00794|       const updatedCargos = prev.cargos.map(cargo => \n00795|         cargo.id === id ? { ...cargo, [field]: value } : cargo\n00796|       );\n00797|       \n00798|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n00799|       const cleanResult = cleanEmptyCargos(updatedCargos, prev.selectedProducts || []);\n00800|       \n00801|       return {\n00802|         ...prev,\n00803|         cargos: cleanResult.cargos,\n00804|         selectedProducts: cleanResult.products\n00805|       };\n00806|     });\n00807|   };\n00808| \n00809|   const removeCargo = (id: string) => {\n00810|     if (form.cargos.length > 1) {\n00811|       setForm(prev => ({\n00812|         ...prev,\n00813|         cargos: prev.cargos.filter(cargo => cargo.id !== id)\n00814|       }));\n00815|     }\n00816|   };\n00817| \n00818|   // üîß –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ (–≤—Å–µ –ø–æ–ª—è —Ä–∞–≤–Ω—ã 0)\n00819|   const isEmptyCargo = (cargo: Cargo) => {\n00820|     return cargo.length === 0 && cargo.width === 0 && cargo.height === 0 && cargo.weight === 0;\n00821|   };\n00822| \n00823|   // üîß –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤\n00824|   const cleanEmptyCargos = (cargos: Cargo[], selectedProducts: ProductInForm[]) => {\n00825|     // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –≥—Ä—É–∑\n00826|     const hasFilledCargos = cargos.some(cargo => !isEmptyCargo(cargo));\n00827|     \n00828|     if (!hasFilledCargos) {\n00829|       // –ï—Å–ª–∏ –Ω–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –ø—É—Å—Ç–æ–π\n00830|       return {\n00831|         cargos: cargos.length > 0 ? [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }] : [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00832|         products: selectedProducts\n00833|       };\n00834|     }\n00835| \n00836|     // –°–æ–∑–¥–∞–µ–º –º–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ä—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –∫ –Ω–æ–≤—ã–º\n00837|     const oldToNewIndexMap = new globalThis.Map<number, number>();\n00838|     let newIndex = 0;\n00839|     \n00840|     cargos.forEach((cargo, oldIndex) => {\n00841|       if (!isEmptyCargo(cargo)) {\n00842|         oldToNewIndexMap.set(oldIndex, newIndex);\n00843|         newIndex++;\n00844|       }\n00845|     });\n00846|     \n00847|     // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –≥—Ä—É–∑—ã\n00848|     const filledCargos = cargos.filter(cargo => !isEmptyCargo(cargo));\n00849|     \n00850|     // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã —É —Ç–æ–≤–∞—Ä–æ–≤\n00851|     const updatedProducts = selectedProducts.map(productItem => ({\n00852|       ...productItem,\n00853|       cargoIndexes: productItem.cargoIndexes\n00854|         .map(oldIndex => oldToNewIndexMap.get(oldIndex))\n00855|         .filter(newIdx => newIdx !== undefined) as number[]\n00856|     }));\n00857|     \n00858|     return {\n00859|       cargos: filledCargos,\n00860|       products: updatedProducts\n00861|     };\n00862|   };\n00863| \n00864|   // üîß –§—É–Ω–∫—Ü–∏—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≥—Ä—É–∑–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n00865|   interface GroupedCargoDisplay {\n00866|     length: number;\n00867|     width: number;\n00868|     height: number;\n00869|     weight: number;\n00870|     quantity: number;\n00871|     indices: number[];\n00872|     isEmpty: boolean;\n00873|   }\n00874| \n00875|   const groupCargosForDisplay = (cargos: Cargo[]): GroupedCargoDisplay[] => {\n00876|     const groups = new globalThis.Map<string, GroupedCargoDisplay>();\n00877|     \n00878|     cargos.forEach((cargo, index) => {\n00879|       const isEmpty = isEmptyCargo(cargo);\n00880|       \n00881|       // –î–ª—è –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ –Ω–µ –≥—Ä—É–ø–ø–∏—Ä—É–µ–º\n00882|       if (isEmpty) {\n00883|         groups.set(`empty_${index}`, {\n00884|           length: 0,\n00885|           width: 0,\n00886|           height: 0,\n00887|           weight: 0,\n00888|           quantity: 1,\n00889|           indices: [index],\n00890|           isEmpty: true\n00891|         });\n00892|         return;\n00893|       }\n00894|       \n00895|       // –°–æ–∑–¥–∞–µ–º –∫–ª—é—á –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –∏ –≤–µ—Å–∞\n00896|       const key = `${cargo.length}_${cargo.width}_${cargo.height}_${cargo.weight}`;\n00897|       \n00898|       if (groups.has(key)) {\n00899|         const existing = groups.get(key)!;\n00900|         existing.quantity += 1;\n00901|         existing.indices.push(index);\n00902|       } else {\n00903|         groups.set(key, {\n00904|           length: cargo.length,\n00905|           width: cargo.width,\n00906|           height: cargo.height,\n00907|           weight: cargo.weight,\n00908|           quantity: 1,\n00909|           indices: [index],\n00910|           isEmpty: false\n00911|         });\n00912|       }\n00913|     });\n00914|     \n00915|     // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤: —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ (–ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É–±—ã–≤–∞–Ω–∏—è), –ø–æ—Ç–æ–º –ø—É—Å—Ç—ã–µ\n00916|     return Array.from(groups.values()).sort((a, b) => {\n00917|       if (a.isEmpty && !b.isEmpty) return 1;\n00918|       if (!a.isEmpty && b.isEmpty) return -1;\n00919|       if (!a.isEmpty && !b.isEmpty) {\n00920|         return b.quantity - a.quantity; // –ü–æ —É–±—ã–≤–∞–Ω–∏—é –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞\n00921|       }\n00922|       return a.indices[0] - b.indices[0]; // –ü—É—Å—Ç—ã–µ –ø–æ –ø–æ—Ä—è–¥–∫—É –∏–Ω–¥–µ–∫—Å–æ–≤\n00923|     });\n00924|   };\n00925| \n00926|   // üîß –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏\n00927|   const handleProductAdd = (product: FurnitureProduct) => {\n00928|     const timestamp = Date.now();\n00929|     \n00930|     console.log(`‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞: ${product.name} (${product.cargoPlaces.length} –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç)`);\n00931|     \n00932|     // –°–æ–∑–¥–∞–µ–º –≥—Ä—É–∑–æ–≤—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è —Ç–æ–≤–∞—Ä–∞\n00933|     const newCargos = createCargosForProduct(product, 1, timestamp);\n00934|     \n00935|     console.log('–°–æ–∑–¥–∞–Ω–æ –Ω–æ–≤—ã—Ö –≥—Ä—É–∑–æ–≤:', newCargos.length);\n00936|     console.log('–ù–æ–≤—ã–µ –≥—Ä—É–∑—ã:', newCargos.map(c => ({ id: c.id, productId: c.productId, addedAt: c.addedAt })));\n00937|     \n00938|     // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç —Ç–æ–≤–∞—Ä–∞ –≤ —Ñ–æ—Ä–º–µ\n00939|     const productInForm: ProductInForm = {\n00940|       product,\n00941|       quantity: 1,\n00942|       totalPrice: product.retailPrice,\n00943|       cargoIndexes: [], // –ó–∞–ø–æ–ª–Ω–∏–º –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–∑–æ–≤\n00944|       addedAt: timestamp\n00945|     };\n00946|     \n00947|     setForm(prev => {\n00948|       let updatedCargos = [...prev.cargos];\n00949|       let cargoIndexes: number[] = [];\n00950|       \n00951|       // –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è\n00952|       const emptyCargos = updatedCargos\n00953|         .map((cargo, index) => ({ cargo, index }))\n00954|         .filter(item => isEmptyCargo(item.cargo));\n00955|       \n00956|       console.log('–ù–∞–π–¥–µ–Ω–æ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤:', emptyCargos.length);\n00957|       console.log('–ù—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –≥—Ä—É–∑–æ–≤:', newCargos.length);\n00958|       \n00959|       // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞\n00960|       let filledCount = 0;\n00961|       for (let i = 0; i < Math.min(emptyCargos.length, newCargos.length); i++) {\n00962|         const emptyCargoIndex = emptyCargos[i].index;\n00963|         const newCargoData = newCargos[i];\n00964|         \n00965|         updatedCargos[emptyCargoIndex] = {\n00966|           ...updatedCargos[emptyCargoIndex],\n00967|           length: newCargoData.length,\n00968|           width: newCargoData.width,\n00969|           height: newCargoData.height,\n00970|           weight: newCargoData.weight,\n00971|           productId: newCargoData.productId,\n00972|           placeNumber: newCargoData.placeNumber,\n00973|           isFromProduct: newCargoData.isFromProduct,\n00974|           addedAt: newCargoData.addedAt\n00975|         };\n00976|         \n00977|         cargoIndexes.push(emptyCargoIndex);\n00978|         filledCount++;\n00979|       }\n00980|       \n00981|       // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –≥—Ä—É–∑–æ–≤, —á–µ–º –µ—Å—Ç—å –ø—É—Å—Ç—ã—Ö - –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ\n00982|       if (filledCount < newCargos.length) {\n00983|         const remainingCargos = newCargos.slice(filledCount);\n00984|         const startIndex = updatedCargos.length;\n00985|         \n00986|         for (let i = 0; i < remainingCargos.length; i++) {\n00987|           updatedCargos.push(remainingCargos[i]);\n00988|           cargoIndexes.push(startIndex + i);\n00989|         }\n00990|       }\n00991|       \n00992|       productInForm.cargoIndexes = cargoIndexes;\n00993|       \n00994|       console.log('–ò–Ω–¥–µ–∫—Å—ã –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤:', cargoIndexes);\n00995|       console.log('–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:', updatedCargos.length);\n00996|       \n00997|       // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n00998|       const prevSelectedProducts = prev.selectedProducts || [];\n00999|       const newSelectedProducts = [...prevSelectedProducts, productInForm];\n01000|       const newDeclaredValue = calculateTotalValue(newSelectedProducts);\n01001|       \n01002|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n01003|       const cleanResult = cleanEmptyCargos(updatedCargos, newSelectedProducts);\n01004|       \n01005|       return {\n01006|         ...prev,\n01007|         cargos: cleanResult.cargos,\n01008|         selectedProducts: cleanResult.products,\n01009|         declaredValue: newDeclaredValue\n01010|       };\n01011|     });\n01012|     \n01013|     console.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä: ${product.name} (${newCargos.length} –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç)`);\n01014|     console.log('–§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥—Ä—É–∑–æ–≤:', newCargos.length);\n01015|   };\n01016| \n01017|   const handleProductQuantityChange = (productId: string, addedAt: number, newQuantity: number) => {\n01018|     setForm(prev => {\n01019|       console.log(`üî¢ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞ ${productId} —Å ${prev.selectedProducts?.find(p => p.product.id === productId && p.addedAt === addedAt)?.quantity || 0} –Ω–∞ ${newQuantity}`);\n01020|       \n01021|       // –ù–∞—Ö–æ–¥–∏–º —Ç–æ–≤–∞—Ä\n01022|       const selectedProducts = prev.selectedProducts || [];\n01023|       const productIndex = selectedProducts.findIndex(p => \n01024|         p.product.id === productId && p.addedAt === addedAt\n01025|       );\n01026|       \n01027|       if (productIndex === -1) {\n01028|         console.warn('‚ùå –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞');\n01029|         return prev;\n01030|       }\n01031|       \n01032|       const product = selectedProducts[productIndex];\n01033|       console.log('–ì—Ä—É–∑—ã –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞:', prev.cargos.length);\n01034|       \n01035|       // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –≥—Ä—É–∑—ã —ç—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞\n01036|       const cargosWithoutProduct = removeCargosForProduct(\n01037|         prev.cargos as CargoWithMetadata[], \n01038|         productId, \n01039|         addedAt\n01040|       );\n01041|       \n01042|       console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö:', cargosWithoutProduct.length);\n01043|       \n01044|       // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –≥—Ä—É–∑—ã —Å –Ω–æ–≤—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º\n01045|       const newCargos = createCargosForProduct(product.product, newQuantity, addedAt);\n01046|       const updatedCargos = [...cargosWithoutProduct, ...newCargos];\n01047|       \n01048|       console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö:', updatedCargos.length);\n01049|       \n01050|       // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä\n01051|       const updatedProduct = {\n01052|         ...product,\n01053|         quantity: newQuantity,\n01054|         totalPrice: product.product.retailPrice * newQuantity,\n01055|         cargoIndexes: findCargoIndexesForProduct(updatedCargos, productId, addedAt)\n01056|       };\n01057|       \n01058|       const updatedProducts = selectedProducts.map((p, index) => \n01059|         index === productIndex ? updatedProduct : p\n01060|       );\n01061|       \n01062|       // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n01063|       const newDeclaredValue = calculateTotalValue(updatedProducts);\n01064|       \n01065|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n01066|       const cleanResult = cleanEmptyCargos(updatedCargos, updatedProducts);\n01067|       \n01068|       return {\n01069|         ...prev,\n01070|         cargos: cleanResult.cargos,\n01071|         selectedProducts: cleanResult.products,\n01072|         declaredValue: newDeclaredValue\n01073|       };\n01074|     });\n01075|     \n01076|     console.log(`üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ ${productId}: ${newQuantity} —à—Ç.`);\n01077|   };\n01078| \n01079|   const handleProductRemove = (productId: string, addedAt: number) => {\n01080|     setForm(prev => {\n01081|       console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ ${productId} (addedAt: ${addedAt})`);\n01082|       \n01083|       // –ù–∞—Ö–æ–¥–∏–º —Ç–æ–≤–∞—Ä –∏ –µ–≥–æ –∏–Ω–¥–µ–∫—Å—ã –≥—Ä—É–∑–æ–≤\n01084|       const selectedProducts = prev.selectedProducts || [];\n01085|       const product = selectedProducts.find(p => \n01086|         p.product.id === productId && p.addedAt === addedAt\n01087|       );\n01088|       \n01089|       if (!product) {\n01090|         console.log('–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω');\n01091|         return prev;\n01092|       }\n01093|       \n01094|       // –û—á–∏—â–∞–µ–º –≥—Ä—É–∑—ã —Ç–æ–≤–∞—Ä–∞ (–¥–µ–ª–∞–µ–º –∏—Ö –ø—É—Å—Ç—ã–º–∏ –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è)\n01095|       const updatedCargos = prev.cargos.map((cargo, index) => {\n01096|         if (product.cargoIndexes.includes(index)) {\n01097|           return {\n01098|             ...cargo,\n01099|             length: 0,\n01100|             width: 0,\n01101|             height: 0,\n01102|             weight: 0,\n01103|             productId: undefined,\n01104|             placeNumber: undefined,\n01105|             isFromProduct: undefined,\n01106|             addedAt: undefined\n01107|           };\n01108|         }\n01109|         return cargo;\n01110|       });\n01111|       \n01112|       // –£–¥–∞–ª—è–µ–º —Ç–æ–≤–∞—Ä –∏–∑ —Å–ø–∏—Å–∫–∞\n01113|       const updatedProducts = selectedProducts.filter(p => \n01114|         !(p.product.id === productId && p.addedAt === addedAt)\n01115|       );\n01116|       \n01117|       // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n01118|       const newDeclaredValue = calculateTotalValue(updatedProducts);\n01119|       \n01120|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n01121|       const cleanResult = cleanEmptyCargos(updatedCargos, updatedProducts);\n01122|       \n01123|       console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:', cleanResult.cargos.length);\n01124|       console.log('–£–¥–∞–ª–µ–Ω–æ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤:', updatedCargos.length - cleanResult.cargos.length);\n01125|       \n01126|       return {\n01127|         ...prev,\n01128|         cargos: cleanResult.cargos,\n01129|         selectedProducts: cleanResult.products,\n01130|         declaredValue: newDeclaredValue\n01131|       };\n01132|     });\n01133|     \n01134|     console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω —Ç–æ–≤–∞—Ä ${productId}`);\n01135|   };\n01136| \n01137|   // –ü–æ–ª—É—á–µ–Ω–∏–µ sessionID –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n01138|   const getDellinSessionId = async (): Promise<string | null> => {\n01139|     try {\n01140|       const authResponse = await fetch('https://api.dellin.ru/v3/auth/login.json', {\n01141|         method: 'POST',\n01142|         headers: {\n01143|           'Content-Type': 'application/json'\n01144|         },\n01145|         body: JSON.stringify({\n01146|           appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n01147|           login: 'service@lavsit.ru',\n01148|           password: 'edcwsx123QAZ'\n01149|         })\n01150|       });\n01151| \n01152|       const authData = await authResponse.json();\n01153|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ response.ok:', authResponse.ok);\n01154|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData:', authData);\n01155|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData.data:', authData.data);\n01156|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData.data?.sessionID:', authData.data?.sessionID);\n01157|       \n01158|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ –∫ sessionID\n01159|       let sessionID = null;\n01160|       \n01161|       if (authData.data?.sessionID) {\n01162|         sessionID = authData.data.sessionID;\n01163|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ data.sessionID:', sessionID);\n01164|       } else if (authData.sessionID) {\n01165|         sessionID = authData.sessionID;\n01166|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ sessionID:', sessionID);\n01167|       } else if (authData.data?.session) {\n01168|         sessionID = authData.data.session;\n01169|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ data.session:', sessionID);\n01170|       }\n01171|       \n01172|       if (authResponse.ok && sessionID) {\n01173|         return sessionID;\n01174|       } else {\n01175|         console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', authData);\n01176|         console.error('‚ùå –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', authResponse.status);\n01177|         console.error('‚ùå –¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞:', authResponse.statusText);\n01178|         return null;\n01179|       }\n01180|     } catch (error) {\n01181|       console.error('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', error);\n01182|     }\n01183|     return null;\n01184|   };\n01185| \n01186|   // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –≥–æ—Ä–æ–¥–æ–≤ –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n01187|   const loadDellinCities = async () => {\n01188|     try {\n01189|       const response = await fetch('/data/dellin-cities.json');\n01190|       if (!response.ok) {\n01191|         console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –≥–æ—Ä–æ–¥–æ–≤');\n01192|         return null;\n01193|       }\n01194|       const data = await response.json();\n01195|       return data.cities;\n01196|     } catch (error) {\n01197|       console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –≥–æ—Ä–æ–¥–æ–≤:', error);\n01198|       return null;\n01199|     }\n01200|   };\n01201| \n01202|   // –ü–æ–∏—Å–∫ cityID –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ\n01203|   const getCityIDFromLocal = async (cityName: string): Promise<string | null> => {\n01204|     const cities = await loadDellinCities();\n01205|     if (!cities) return null;\n01206| \n01207|     const normalizedSearch = cityName.toLowerCase().trim()\n01208|       .replace(/^–≥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥ \"\n01209|       .replace(/^–≥–æ—Ä–æ–¥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥–æ—Ä–æ–¥ \"\n01210|       .replace(/\\s+/g, ' '); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—Ä–æ–±–µ–ª—ã\n01211| \n01212|     console.log(`üîç –ü–æ–∏—Å–∫ cityID –¥–ª—è –≥–æ—Ä–æ–¥–∞: \"${normalizedSearch}\"`);\n01213| \n01214|     // –ü–æ–∏—Å–∫ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ\n01215|     for (const city of cities) {\n01216|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –∏–º–µ–Ω–µ–º –≥–æ—Ä–æ–¥–∞\n01217|       if (city.name.toLowerCase() === normalizedSearch) {\n01218|         console.log(`‚úÖ –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: \"${city.name}\" -> cityID: ${city.cityID}`);\n01219|         return city.cityID;\n01220|       }\n01221| \n01222|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –ø–æ–∏—Å–∫–æ–≤—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏\n01223|       for (const searchString of city.searchStrings) {\n01224|         if (searchString === normalizedSearch) {\n01225|           console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ –≤ –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫–∞—Ö: \"${searchString}\" –¥–ª—è –≥–æ—Ä–æ–¥–∞ \"${city.name}\" -> cityID: ${city.cityID}`);\n01226|           return city.cityID;\n01227|         }\n01228|       }\n01229|     }\n01230| \n01231|     console.warn(`‚ö†Ô∏è cityID –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –¥–ª—è –≥–æ—Ä–æ–¥–∞: \"${normalizedSearch}\"`);\n01232|     return null;\n01233|   };\n01234| \n01235|   // –ü–æ–ª—É—á–µ–Ω–∏–µ cityID —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n01236|   const findCityInDellinDirectory = async (cityName: string): Promise<{cityID: number, code: string} | null> => {\n01237|     try {\n01238|       console.log(`üîç –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –î–õ: ${cityName}`);\n01239|       \n01240|       // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞\n01241|       const normalizedCity = cityName.toLowerCase().trim()\n01242|         .replace(/^–≥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥ \"\n01243|         .replace(/^–≥–æ—Ä–æ–¥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥–æ—Ä–æ–¥ \"\n01244|         .replace(/\\s+/g, ' '); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—Ä–æ–±–µ–ª—ã\n01245|       \n01246|       // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞—Å–µ–ª–µ–Ω–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤\n01247|       const response = await fetch('https://api.dellin.ru/v2/public/kladr.json', {\n01248|         method: 'POST',\n01249|         headers: {\n01250|           'Content-Type': 'application/json'\n01251|         },\n01252|         body: JSON.stringify({\n01253|           appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n01254|           q: normalizedCity,\n01255|           limit: 10\n01256|         })\n01257|       });\n01258|       \n01259|       const data = await response.json();\n01260|       console.log(`üèôÔ∏è –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞ \"${normalizedCity}\" response:`, data);\n01261|       \n01262|       if (response.ok && data.cities && Array.isArray(data.cities) && data.cities.length > 0) {\n01263|         // –ò—â–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–ª–∏ –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –≥–æ—Ä–æ–¥\n01264|         let bestMatch = data.cities.find((city: any) => \n01265|           city.searchString?.toLowerCase() === normalizedCity ||\n01266|           city.aString?.toLowerCase().includes(normalizedCity)\n01267|         );\n01268|         \n01269|         // –ï—Å–ª–∏ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –Ω–µ—Ç, –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞–º–∏\n01270|         if (!bestMatch) {\n01271|           bestMatch = data.cities.find((city: any) => city.isTerminal === 1);\n01272|         }\n01273|         \n01274|         // –ï—Å–ª–∏ –∏ —ç—Ç–æ–≥–æ –Ω–µ—Ç, –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π\n01275|         if (!bestMatch) {\n01276|           bestMatch = data.cities[0];\n01277|         }\n01278|         \n01279|         if (bestMatch) {\n01280|           console.log(`‚úÖ –ù–∞–π–¥–µ–Ω –≥–æ—Ä–æ–¥:`, {\n01281|             cityID: bestMatch.cityID,\n01282|             name: bestMatch.aString,\n01283|             code: bestMatch.code,\n01284|             hasTerminals: bestMatch.isTerminal === 1\n01285|           });\n01286|           \n01287|           return {\n01288|             cityID: bestMatch.cityID,\n01289|             code: bestMatch.code\n01290|           };\n01291|         }\n01292|       }\n01293|       \n01294|       console.warn(`‚ö†Ô∏è –ì–æ—Ä–æ–¥ \"${normalizedCity}\" –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –î–õ`);\n01295|       return null;\n01296|       \n01297|     } catch (error) {\n01298|       console.error(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –≥–æ—Ä–æ–¥–∞ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –î–õ:`, error);\n01299|       return null;\n01300|     }\n01301|   };\n01302|   \n01303| \n01304|   \n01305|   // –ü–æ–∏—Å–∫ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ —Ä–∞–±–æ—á–∏–π v1 API (–∏–∑ test-dellin-terminals-simple.js)\n01306|   const getDellinTerminalByDirection = async (citySearch: string, direction: 'arrival' | 'derival'): Promise<string | null> => {\n01307|     try {\n01308|       console.log(`üîç –†–ê–ë–û–ß–ò–ô v1 API: –ü–æ–∏—Å–∫ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ ${direction} –¥–ª—è –≥–æ—Ä–æ–¥–∞: ${citySearch}`);\n01309|       \n01310|       // –ü–æ–ª—É—á–∞–µ–º sessionID –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞\n01311|       const sessionID = await getDellinSessionId();\n01312|       if (!sessionID) {\n01313|         console.error('‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç sessionID –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤');\n01314|         return null;\n01315|       }\n01316|       \n01317|       // –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ —Ä–∞–±–æ—á–µ–º—É API\n01318|       const requestData = {\n01319|         appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n01320|         sessionID: sessionID,\n01321|         search: citySearch,\n01322|         direction: direction\n01323|       };\n01324|       \n01325|       console.log(`üì§ –ó–∞–ø—Ä–æ—Å —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤:`, requestData);\n01326|       \n01327|       const response = await fetch('https://api.dellin.ru/v1/public/request_terminals.json', {\n01328|         method: 'POST',\n01329|         headers: {\n01330|           'Content-Type': 'application/json'\n01331|         },\n01332|         body: JSON.stringify(requestData)\n01333|       });\n01334|       \n01335|       const data = await response.json();\n01336|       console.log(`üì• –û—Ç–≤–µ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ (${response.status}):`, data);\n01337|       \n01338|       if (!response.ok) {\n01339|         console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤:', data);\n01340|         return null;\n01341|       }\n01342|       \n01343|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –≤ –æ—Ç–≤–µ—Ç–µ\n01344|       const terminals = data.terminals || [];\n01345|       if (terminals.length === 0) {\n01346|         console.warn(`‚ö†Ô∏è –¢–µ—Ä–º–∏–Ω–∞–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è –≥–æ—Ä–æ–¥–∞ \"${citySearch}\"`);\n01347|         return null;\n01348|       }\n01349|       \n01350|       // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª\n01351|       const selectedTerminal = terminals[0];\n01352|       \n01353|       console.log(`‚úÖ –ù–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª ${direction}:`, {\n01354|         id: selectedTerminal.id,\n01355|         name: selectedTerminal.name,\n01356|         address: selectedTerminal.address\n01357|       });\n01358|       \n01359|       return selectedTerminal.id.toString();\n01360|       \n01361|     } catch (error) {\n01362|       console.error(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ ${direction} (v1 API):`, error);\n01363|       return null;\n01364|     }\n01365|   };\n01366| \n01367|   // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ –¥–ª—è –≥–æ—Ä–æ–¥–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º)\n01368|   const getDellinTerminal = async (citySearch: string): Promise<string | null> => {\n01369|     return getDellinTerminalByDirection(citySearch, 'arrival');\n01370|   };\n01371|   \n01372|   // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ DaData –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n01373|   const normalizeAddressForDellin = async (address: string): Promise<string> => {\n01374|     try {\n01375|       console.log(`üåê –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ DaData: ${address}`);\n01376|       \n01377|       const response = await fetch('/api/dadata', {\n01378|         method: 'POST',\n01379|         headers: {\n01380|           'Content-Type': 'application/json'\n01381|         },\n01382|         body: JSON.stringify({\n01383|           address: address,\n01384|           type: 'clean'\n01385|         })\n01386|       });\n01387|       \n01388|       const data = await response.json();\n01389|       console.log(`üåê DaData response:`, data);\n01390|       \n01391|       if (data.success && data.data?.dellinFormat) {\n01392|         console.log(`‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å: ${data.data.dellinFormat}`);\n01393|         return data.data.dellinFormat;\n01394|       }\n01395|       \n01396|       // –ï—Å–ª–∏ DaData –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∞–¥—Ä–µ—Å\n01397|       console.warn(`‚ö†Ô∏è DaData –Ω–µ —Å–º–æ–≥ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π`);\n01398|       return address;\n01399|       \n01400|     } catch (error) {\n01401|       console.error(`‚ùå –û—à–∏–±–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ DaData:`, error);\n01402|       return address; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∞–¥—Ä–µ—Å –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏\n01403|     }\n01404|   };\n01405| \n01406|   // –ü–æ–ª—É—á–µ–Ω–∏–µ UID —É–ø–∞–∫–æ–≤–∫–∏ —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π workflow —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –î–õ\n01407|   const getDellinPackageUid = async (packageName: string = 'crate_with_bubble'): Promise<string | null> => {\n01408|     try {\n01409|       console.log(`üì¶ CSV WORKFLOW: –ü–æ–ª—É—á–µ–Ω–∏–µ UID —É–ø–∞–∫–æ–≤–∫–∏ \"${packageName}\" —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π workflow...`);\n01410|       console.log('üì¶ CSV WORKFLOW: API –î–õ ‚Üí CSV —Å—Å—ã–ª–∫–∞ ‚Üí —Å–∫–∞—á–∞—Ç—å CSV ‚Üí –ø–∞—Ä—Å–∏—Ç—å ‚Üí –ø–æ–ª—É—á–∏—Ç—å UID');\n01411|       \n01412|       const response = await fetch('/api/dellin-packages', {\n01413|         method: 'GET',\n01414|         headers: {\n01415|           'Content-Type': 'application/json'\n01416|         }\n01417|       });\n01418| \n01419|       const data = await response.json();\n01420|       console.log('üì¶ CSV WORKFLOW response.ok:', response.ok);\n01421|       console.log('üì¶ CSV WORKFLOW status:', response.status);\n01422|       console.log('üì¶ CSV WORKFLOW workflow info:', data.workflow || 'not specified');\n01423|       \n01424|       if (response.ok && data.success && data.data && Array.isArray(data.data)) {\n01425|         console.log('üì¶ CSV WORKFLOW: —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫');\n01426|         console.log('üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–ø–∞–∫–æ–≤–æ–∫ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ:', data.data.length);\n01427|         console.log('üì¶ –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:', data.cached ? '–∫—ç—à (24—á)' : '—Å–≤–µ–∂–∏–π CSV —Ñ–∞–π–ª');\n01428|         if (data.csvUrl) {\n01429|           console.log('üì¶ CSV URL:', data.csvUrl);\n01430|         }\n01431|         \n01432|         // –ü–æ–∏—Å–∫ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –≤–∞—Ä–∏–∞–Ω—Ç–∞–º –Ω–∞–∑–≤–∞–Ω–∏—è\n01433|         const searchTerms = [\n01434|           packageName,\n01435|           '–æ–±—Ä–µ—à–µ—Ç–∫–∞',\n01436|           '–æ–±—Ä–µ—à—ë—Ç–∫–∞',\n01437|           '–∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è',\n01438|           'bubble',\n01439|           '–∑–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞'\n01440|         ];\n01441|         \n01442|         let foundPackage: any = null;\n01443|         \n01444|         for (const term of searchTerms) {\n01445|           foundPackage = data.data.find((pkg: any) => \n01446|             pkg.name && pkg.name.toLowerCase().includes(term.toLowerCase())\n01447|           );\n01448|           \n01449|           if (foundPackage) {\n01450|             console.log(`‚úÖ CSV WORKFLOW: –ù–∞–π–¥–µ–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∞ –ø–æ —Ç–µ—Ä–º–∏–Ω—É \"${term}\": ${foundPackage.name} ‚Üí ${foundPackage.uid}`);\n01451|             break;\n01452|           }\n01453|         }\n01454|         \n01455|         if (foundPackage && foundPackage.uid) {\n01456|           return foundPackage.uid;\n01457|         } else {\n01458|           console.log('‚ùå CSV WORKFLOW: –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –ø–æ –ø–æ–∏—Å–∫–æ–≤—ã–º —Ç–µ—Ä–º–∏–Ω–∞–º');\n01459|           \n01460|           // –í—ã–≤–æ–¥–∏–º –ø–µ—Ä–≤—ã–µ 10 —É–ø–∞–∫–æ–≤–æ–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n01461|           console.log('üì¶ –î–æ—Å—Ç—É–ø–Ω—ã–µ —É–ø–∞–∫–æ–≤–∫–∏ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ (–ø–µ—Ä–≤—ã–µ 10):');\n01462|           data.data.slice(0, 10).forEach((pkg: any, index: number) => {\n01463|             console.log(`  ${index + 1}. ${pkg.name} (${pkg.uid})`);\n01464|           });\n01465|         }\n01466|       } else {\n01467|         console.error('‚ùå CSV WORKFLOW: –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞:', data);\n01468|       }\n01469|       \n01470|       return null;\n01471|         \n01472|     } catch (error) {\n01473|       console.error('‚ùå CSV WORKFLOW: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', error);\n01474|       return null;\n01475|     }\n01476|   };\n01477| \n01478|   // –†–∞—Å—á–µ—Ç –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π —á–µ—Ä–µ–∑ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π API v2/calculator.json —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n01479|   const calculateDellin = async (): Promise<CalculationResult> => {\n01480|     const { enhancedApiRequest } = await import('@/lib/api-utils');\n01481|     const apiUrl = 'https://api.dellin.ru/v2/calculator.json';\n01482|     const maxRetries = 2;\n01483|     \n01484|     console.log('üöÄ === –ù–ê–ß–ê–õ–û –†–ê–°–ß–ï–¢–ê –î–ï–õ–û–í–´–• –õ–ò–ù–ò–ô ===');\n01485|     console.log('üöÄ API URL:', apiUrl);\n01486|     \n01487|     try {\n01488|       let sessionID = await getDellinSessionId();\n01489|       \n01490|       if (!sessionID) {\n01491|         return {\n01492|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01493|           price: 0,\n01494|           days: 0,\n01495|           error: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å sessionID',\n01496|           apiUrl,\n01497|           requestData: null,\n01498|           responseData: null\n01499|         };\n01500|       }\n01501| \n01502|       // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏ –æ–±—ä–µ–º—ã\n01503|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n01504|       const totalVolume = form.cargos.reduce((sum, cargo) => \n01505|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n01506|       );\n01507|       const maxLength = Math.max(...form.cargos.map(c => c.length)) / 100; // –≤ –º–µ—Ç—Ä–∞—Ö\n01508|       const maxWidth = Math.max(...form.cargos.map(c => c.width)) / 100;\n01509|       const maxHeight = Math.max(...form.cargos.map(c => c.height)) / 100;\n01510| \n01511|       // –ü–æ–ª—É—á–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª—ã –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∞–¥—Ä–µ—Å–∞\n01512|       let fromTerminalId: string | null = null;\n01513|       let toTerminalId: string | null = null;\n01514|       let normalizedFromAddress: string | null = null;\n01515|       let normalizedToAddress: string | null = null;\n01516|       \n01517|       // –î–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ–ª—É—á–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª—ã\n01518|       if (!form.fromAddressDelivery) {\n01519|         fromTerminalId = await getDellinTerminalByDirection(form.fromCity, 'derival');\n01520|       } else {\n01521|         // –î–ª—è –∞–¥—Ä–µ—Å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∞–¥—Ä–µ—Å\n01522|         const addressToNormalize = form.fromAddress || form.fromCity;\n01523|         normalizedFromAddress = await normalizeAddressForDellin(addressToNormalize);\n01524|       }\n01525|       \n01526|       if (!form.toAddressDelivery) {\n01527|         toTerminalId = await getDellinTerminalByDirection(form.toCity, 'arrival');\n01528|       } else {\n01529|         // –î–ª—è –∞–¥—Ä–µ—Å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∞–¥—Ä–µ—Å\n01530|         const addressToNormalize = form.toAddress || form.toCity;\n01531|         normalizedToAddress = await normalizeAddressForDellin(addressToNormalize);\n01532|       }\n01533|       \n01534|       console.log('üè¢ –î–ê–ù–ù–´–ï –î–õ:');\n01535|       console.log('üè¢ form.fromAddressDelivery:', form.fromAddressDelivery);\n01536|       console.log('üè¢ form.toAddressDelivery:', form.toAddressDelivery);\n01537|       console.log('üè¢ fromTerminalId:', fromTerminalId);\n01538|       console.log('üè¢ toTerminalId:', toTerminalId);\n01539|       console.log('üè¢ normalizedFromAddress:', normalizedFromAddress);\n01540|       console.log('üè¢ normalizedToAddress:', normalizedToAddress);\n01541|       \n01542|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã –Ω–∞–π–¥–µ–Ω—ã –¢–û–õ–¨–ö–û –¥–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏\n01543|       if (!form.fromAddressDelivery && !fromTerminalId) {\n01544|         console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –≥–æ—Ä–æ–¥–∞:', form.fromCity);\n01545|         return {\n01546|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01547|           price: 0,\n01548|           days: 0,\n01549|           error: `–ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π –≤ –≥–æ—Ä–æ–¥–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è: ${form.fromCity}`,\n01550|           apiUrl,\n01551|           requestData: null,\n01552|           responseData: null\n01553|         };\n01554|       }\n01555|       \n01556|       if (!form.toAddressDelivery && !toTerminalId) {\n01557|         console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≥–æ—Ä–æ–¥–∞:', form.toCity);\n01558|         return {\n01559|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01560|           price: 0,\n01561|           days: 0,\n01562|           error: `–ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π –≤ –≥–æ—Ä–æ–¥–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: ${form.toCity}`,\n01563|           apiUrl,\n01564|           requestData: null,\n01565|           responseData: null\n01566|         };\n01567|       }\n01568|       \n01569|       // –î–ª—è –∞–¥—Ä–µ—Å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∞–¥—Ä–µ—Å–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã\n01570|       if (form.fromAddressDelivery && !normalizedFromAddress) {\n01571|         console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è:', form.fromAddress || form.fromCity);\n01572|         return {\n01573|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01574|           price: 0,\n01575|           days: 0,\n01576|           error: `–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è: ${form.fromAddress || form.fromCity}`,\n01577|           apiUrl,\n01578|           requestData: null,\n01579|           responseData: null\n01580|         };\n01581|       }\n01582|       \n01583|       if (form.toAddressDelivery && !normalizedToAddress) {\n01584|         console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:', form.toAddress || form.toCity);\n01585|         return {\n01586|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01587|           price: 0,\n01588|           days: 0,\n01589|           error: `–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: ${form.toAddress || form.toCity}`,\n01590|           apiUrl,\n01591|           requestData: null,\n01592|           responseData: null\n01593|         };\n01594|       }\n01595| \n01596|       // –ü–æ–ª—É—á–∞–µ–º UID —É–ø–∞–∫–æ–≤–∫–∏ crate_with_bubble (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∞)\n01597|       let packageUid: string | null = null;\n01598|       console.log('=== –ù–ê–ß–ê–õ–û –û–¢–õ–ê–î–ö–ò –£–ü–ê–ö–û–í–ö–ò ===');\n01599|       console.log('üîç –û–¢–õ–ê–î–ö–ê –£–ü–ê–ö–û–í–ö–ò: form.needPackaging =', form.needPackaging);\n01600|       console.log('üîç –û–¢–õ–ê–î–ö–ê –£–ü–ê–ö–û–í–ö–ò: typeof form.needPackaging =', typeof form.needPackaging);\n01601|       \n01602|       if (form.needPackaging) {\n01603|         console.log('üîç ‚úÖ –£–ü–ê–ö–û–í–ö–ê –¢–†–ï–ë–£–ï–¢–°–Ø - –ó–ê–ü–†–ê–®–ò–í–ê–ï–ú UID —á–µ—Ä–µ–∑ CSV WORKFLOW...');\n01604|         try {\n01605|           packageUid = await getDellinPackageUid('crate_with_bubble');\n01606|           console.log('üîç ‚úÖ –ü–û–õ–£–ß–ï–ù packageUid –∏–∑ CSV WORKFLOW:', packageUid);\n01607|           \n01608|           // –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ UID –∏–∑ CSV, –∏—Å–ø–æ–ª—å–∑—É–µ–º UID —Å —Å–∞–π—Ç–∞ –î–õ (–∏—Å–ø—Ä–∞–≤–ª—è–µ–º —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ 500‚ÇΩ)\n01609|           if (!packageUid) {\n01610|             packageUid = '0x9dd8901b0ecef10c11e8ed001199bf6e'; // UID —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ –î–õ\n01611|             console.log('üîç üß™ –ò–°–ü–û–õ–¨–ó–£–ï–ú UID –° –°–ê–ô–¢–ê –î–õ (–∏—Å–ø—Ä–∞–≤–ª—è–µ–º —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ):', packageUid);\n01612|           }\n01613|           \n01614|           console.log('üîç ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô packageUid:', packageUid);\n01615|           console.log('üîç ‚úÖ typeof packageUid:', typeof packageUid);\n01616|           console.log('üîç ‚úÖ packageUid truthy:', !!packageUid);\n01617|         } catch (error) {\n01618|           console.log('üîç ‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ packageUid —á–µ—Ä–µ–∑ CSV WORKFLOW:', error);\n01619|           // –ò—Å–ø–æ–ª—å–∑—É–µ–º UID —Å —Å–∞–π—Ç–∞ –î–õ –∫–∞–∫ fallback (–∏—Å–ø—Ä–∞–≤–ª—è–µ–º —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ)\n01620|           packageUid = '0x9dd8901b0ecef10c11e8ed001199bf6e'; // UID —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ –î–õ\n01621|           console.log('üîç üß™ –ò–°–ü–û–õ–¨–ó–£–ï–ú UID –° –°–ê–ô–¢–ê –î–õ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ (–∏—Å–ø—Ä–∞–≤–ª—è–µ–º —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ):', packageUid);\n01622|         }\n01623|       } else {\n01624|         console.log('üîç ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ UID');\n01625|       }\n01626|       console.log('=== –ö–û–ù–ï–¶ –û–¢–õ–ê–î–ö–ò –£–ü–ê–ö–û–í–ö–ò ===');\n01627| \n01628|       // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞—Ç—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞\n01629|       const tomorrow = new Date();\n01630|       tomorrow.setDate(tomorrow.getDate() + 1);\n01631|       const produceDate = tomorrow.toISOString().split('T')[0];\n01632| \n01633|       // –û—Ç–ª–∞–¥–∫–∞ –ø–µ—Ä–µ–¥ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–∞\n01634|       console.log('=== –û–¢–õ–ê–î–ö–ê –§–û–†–ú–ò–†–û–í–ê–ù–ò–Ø –ó–ê–ü–†–û–°–ê ===');\n01635|       console.log('üîç form.needPackaging =', form.needPackaging, '(—Ç–∏–ø:', typeof form.needPackaging, ')');\n01636|       console.log('üîç packageUid =', packageUid, '(—Ç–∏–ø:', typeof packageUid, ')');\n01637|       console.log('üîç packageUid truthy =', !!packageUid);\n01638|       console.log('üîç –£—Å–ª–æ–≤–∏–µ (form.needPackaging && packageUid) =', form.needPackaging && packageUid);\n01639|       \n01640|       if (form.needPackaging && packageUid) {\n01641|         console.log('‚úÖ PACKAGES –ë–£–î–ï–¢ –î–û–ë–ê–í–õ–ï–ù –í –ó–ê–ü–†–û–°!');\n01642|       } else {\n01643|         console.log('‚ùå PACKAGES –ù–ï –ë–£–î–ï–¢ –î–û–ë–ê–í–õ–ï–ù:');\n01644|         if (!form.needPackaging) console.log('  - form.needPackaging = false');\n01645|         if (!packageUid) console.log('  - packageUid –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç/null');\n01646|       }\n01647| \n01648|       // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n01649|       const requestData = {\n01650|         appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n01651|         sessionID: sessionID,\n01652|         delivery: {\n01653|           deliveryType: {\n01654|             type: 'auto'  // –í—Å–µ–≥–¥–∞ \"auto\" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n01655|           },\n01656|           derival: {\n01657|             produceDate: produceDate,  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –¥–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n01658|             variant: form.fromAddressDelivery ? 'address' : 'terminal',\n01659|             ...(form.fromAddressDelivery ? {\n01660|               address: {\n01661|                 search: normalizedFromAddress || form.fromAddress || form.fromCity\n01662|               }\n01663|             } : {\n01664|               terminalID: fromTerminalId\n01665|             }),\n01666|             time: {\n01667|               worktimeStart: '10:00',\n01668|               worktimeEnd: '18:00',\n01669|               breakStart: '13:00',\n01670|               breakEnd: '14:00',\n01671|               exactTime: false\n01672|             }\n01673|             // handling –≤ derival –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n01674|           },\n01675|           arrival: {\n01676|             variant: form.toAddressDelivery ? 'address' : 'terminal',\n01677|             ...(form.toAddressDelivery ? {\n01678|               address: {\n01679|                 search: normalizedToAddress || form.toAddress || form.toCity\n01680|               }\n01681|             } : {\n01682|               terminalID: toTerminalId\n01683|             }),\n01684|             time: {\n01685|               worktimeStart: '10:00',\n01686|               worktimeEnd: '18:00',\n01687|               breakStart: '13:00',\n01688|               breakEnd: '14:00',\n01689|               exactTime: false\n01690|             },\n01691|             // handling –≤ arrival –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—ä–µ–º\n01692|             ...(form.needCarry ? {\n01693|               handling: {\n01694|                 freightLift: form.hasFreightLift, // true —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –≥–∞–ª–æ—á–∫–∞ \"–Ω–∞–ª–∏—á–∏–µ –≥—Ä—É–∑–æ–≤–æ–≥–æ –ª–∏—Ñ—Ç–∞\"\n01695|                 toFloor: form.floor, // —ç—Ç–∞–∂ –∏–∑ —Ñ–æ—Ä–º—ã\n01696|                 carry: 0\n01697|               }\n01698|             } : {})\n01699|           },\n01700|           ...(form.needPackaging && packageUid ? {\n01701|             packages: [{\n01702|               uid: packageUid,  // UID —É–ø–∞–∫–æ–≤–∫–∏ crate_with_bubble –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞\n01703|               count: 1  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1\n01704|             }]\n01705|           } : {})\n01706|         },\n01707|         cargo: {\n01708|           quantity: form.cargos.length,\n01709|           length: maxLength,\n01710|           width: maxWidth,\n01711|           height: maxHeight,\n01712|           weight: totalWeight,\n01713|           totalVolume: totalVolume,\n01714|           totalWeight: totalWeight,\n01715|           oversizedWeight: 0,\n01716|           oversizedVolume: 0,\n01717|           hazardClass: 0,  // –í—Å–µ–≥–¥–∞ 0 –µ—Å–ª–∏ –Ω–µ—Ç –æ–ø–∞—Å–Ω—ã—Ö –≥—Ä—É–∑–æ–≤\n01718|           ...(form.needInsurance && form.declaredValue > 0 ? {\n01719|             insurance: {\n01720|               statedValue: form.declaredValue,\n01721|               term: true  // –í—Å–µ–≥–¥–∞ true –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è\n01722|             }\n01723|           } : {})\n01724|         },\n01725|         payment: {\n01726|           type: 'noncash',  // –í—Å–µ–≥–¥–∞ \"noncash\"\n01727|           paymentCitySearch: {\n01728|             search: form.fromCity  // –ì–æ—Ä–æ–¥ –æ–ø–ª–∞—Ç—ã\n01729|           }\n01730|         }\n01731|       };\n01732| \n01733|       console.log('üöÄ –ò–¢–û–ì–û–í–´–ô –ó–ê–ü–†–û–° –ö –î–õ:', JSON.stringify(requestData, null, 2));\n01734|       \n01735|       // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∞ packages\n01736|       if (requestData.delivery.packages) {\n01737|         console.log('‚úÖ PACKAGES –ù–ê–ô–î–ï–ù –í –ó–ê–ü–†–û–°–ï:', requestData.delivery.packages);\n01738|       } else {\n01739|         console.log('‚ùå PACKAGES –ù–ï –ù–ê–ô–î–ï–ù –í –ó–ê–ü–†–û–°–ï');\n01740|         console.log('   form.needPackaging =', form.needPackaging);\n01741|         console.log('   packageUid =', packageUid);\n01742|         console.log('   –£—Å–ª–æ–≤–∏–µ:', form.needPackaging && packageUid);\n01743|       }\n01744| \n01745|       // –ü–æ–ø—ã—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö\n01746|       let response: any = null;\n01747|       let data: any = null;\n01748|       \n01749|       for (let attempt = 1; attempt <= maxRetries; attempt++) {\n01750|         console.log(`üîÑ –î–õ: –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ ${attempt}/${maxRetries}`);\n01751|         \n01752|         const result = await enhancedApiRequest(\n01753|           apiUrl,\n01754|           {\n01755|             method: 'POST',\n01756|             headers: {\n01757|               'Content-Type': 'application/json',\n01758|               'Accept': 'application/json'\n01759|             },\n01760|             body: JSON.stringify(requestData)\n01761|           },\n01762|           { operation: 'calculate', company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏' }\n01763|         );\n01764| \n01765|         if (result && typeof result === 'object' && 'success' in result && !result.success) {\n01766|           console.error('‚ùå –î–õ API –æ—à–∏–±–∫–∞:', result.error);\n01767|           // For Dellin, we still want to handle retries manually for session renewal\n01768|           // So we'll create a mock response that indicates failure\n01769|           response = {\n01770|             ok: false,\n01771|             status: 500,\n01772|             json: async () => ({ error: result.error.message })\n01773|           } as any;\n01774|           data = { error: result.error.message };\n01775|         } else {\n01776|           response = result as Response;\n01777|           try {\n01778|             data = await response.json();\n01779|           } catch (parseError) {\n01780|             console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –æ—Ç–≤–µ—Ç–∞ –î–õ:', parseError);\n01781|             throw new Error(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ API: ${parseError instanceof Error ? parseError.message : '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);\n01782|           }\n01783|         }\n01784|         \n01785|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ response.ok:', response.ok);\n01786|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ status:', response.status);\n01787|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ data:', data);\n01788|         \n01789|         // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\n01790|         const isAuthError = response.status === 401 || \n01791|                            response.status === 403 ||\n01792|                            (response.status === 400 && data?.errors?.some((err: any) => \n01793|                              err.detail?.toLowerCase()?.includes('session') ||\n01794|                              err.detail?.toLowerCase()?.includes('auth') ||\n01795|                              err.detail?.toLowerCase()?.includes('invalid')\n01796|                            ));\n01797| \n01798|         if (isAuthError && attempt < maxRetries) {\n01799|           console.log('üîÑ –î–õ: –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –≤—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...');\n01800|           const newSessionId = await getDellinSessionId();\n01801|           if (newSessionId) {\n01802|             console.log('‚úÖ –î–õ: –ø–æ–ª—É—á–µ–Ω –Ω–æ–≤—ã–π SessionID, –æ–±–Ω–æ–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å...');\n01803|             // –û–±–Ω–æ–≤–ª—è–µ–º sessionID –≤ –∑–∞–ø—Ä–æ—Å–µ\n01804|             requestData.sessionID = newSessionId;\n01805|             sessionID = newSessionId;\n01806|             continue; // –ü—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —Å –Ω–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n01807|           } else {\n01808|             console.error('‚ùå –î–õ: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π SessionID');\n01809|             break;\n01810|           }\n01811|         }\n01812|         \n01813|         if (response.status === 400 && data?.errors) {\n01814|           console.log('=== –ê–ù–ê–õ–ò–ó –û–®–ò–ë–ö–ò 400 ===');\n01815|           console.log('üîç –û—à–∏–±–∫–∏:', data.errors);\n01816|           data.errors.forEach((error: any, index: number) => {\n01817|             console.log(`üîç –û—à–∏–±–∫–∞ ${index + 1}:`, error);\n01818|             console.log(`   - –ü–æ–ª–µ: ${error.field || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`);\n01819|             console.log(`   - –°–æ–æ–±—â–µ–Ω–∏–µ: ${error.detail || error.message || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`);\n01820|           });\n01821|           console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –û–®–ò–ë–ö–ò 400 ===');\n01822|         }\n01823| \n01824|         // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–Ω—ã–π –∏–ª–∏ –Ω–µ —Å–≤—è–∑–∞–Ω —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É\n01825|         break;\n01826|       }\n01827| \n01828|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –æ—à–∏–±–∫–∏ –ü–ï–†–ï–î –∞–Ω–∞–ª–∏–∑–æ–º –¥–∞–Ω–Ω—ã—Ö\n01829|       if (!response.ok || !data.data) {\n01830|         console.log('‚ùå –û—à–∏–±–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç API - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö');\n01831|         const errorMessage = data.metadata?.detail || \n01832|                            data.metadata?.message || \n01833|                            data.errors?.[0]?.detail || \n01834|                            (data.metadata?.status !== 200 ? `HTTP ${data.metadata?.status}` : '') ||\n01835|                            `HTTP ${response.status} - ${response.statusText}` ||\n01836|                            '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏';\n01837|         return {\n01838|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01839|           price: 0,\n01840|           days: 0,\n01841|           error: errorMessage,\n01842|           requestData,\n01843|           responseData: data,\n01844|           apiUrl,\n01845|           sessionId: sessionID\n01846|         };\n01847|       }\n01848|       \n01849|       // –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –°–¢–†–ê–•–û–í–ö–ò (—Ç–æ–ª—å–∫–æ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞)\n01850|       console.log('=== –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –°–¢–†–ê–•–û–í–ö–ò ===');\n01851|       console.log('üîç –ü–†–û–í–ï–†–ö–ê –°–¢–†–£–ö–¢–£–†–´ –î–ê–ù–ù–´–•:');\n01852|       console.log('üîç data:', data ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n01853|       console.log('üîç typeof data:', typeof data);\n01854|       console.log('üîç data.data:', data?.data ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n01855|       console.log('üîç typeof data.data:', typeof data?.data);\n01856|       \n01857|       // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–π—Å—Ç–≤ data.data\n01858|       if (data?.data) {\n01859|         console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤–æ–π—Å—Ç–≤–∞ data.data:');\n01860|         console.log('üîç data.data.derival:', typeof data.data.derival, data.data.derival);\n01861|         console.log('üîç data.data.arrival:', typeof data.data.arrival, data.data.arrival);\n01862|         console.log('üîç data.data.intercity:', typeof data.data.intercity, data.data.intercity);\n01863|       }\n01864|       \n01865|       if (!data) {\n01866|         console.error('‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: data undefined/null');\n01867|         return {\n01868|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01869|           price: 0,\n01870|           days: 0,\n01871|           error: '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ API: –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã',\n01872|           apiUrl,\n01873|           requestData,\n01874|           responseData: null\n01875|         };\n01876|       }\n01877|       \n01878|       try {\n01879|         console.log('üîç –ü–û–õ–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê data.data:', JSON.stringify(data.data, null, 2));\n01880|       } catch (jsonError) {\n01881|         console.error('‚ùå –û—à–∏–±–∫–∞ JSON.stringify –¥–ª—è data.data:', jsonError);\n01882|         console.log('üîç data.data (toString):', data.data?.toString?.() || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å');\n01883|       }\n01884|       \n01885|       // –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç—Ä–∞—Ö–æ–≤–∫–æ–π\n01886|       console.log('üí≥ –ü–û–ò–°–ö –ö–û–ú–ü–û–ù–ï–ù–¢–û–í –°–¢–†–ê–•–û–í–ö–ò:');\n01887|       console.log('üí≥ data.data.insurance:', data.data?.insurance);\n01888|       console.log('üí≥ data.data.cargoInsurance:', data.data?.cargoInsurance);\n01889|       console.log('üí≥ data.data.termInsurance:', data.data?.termInsurance);\n01890|       console.log('üí≥ data.data.insuranceDetails:', data.data?.insuranceDetails);\n01891|       console.log('üí≥ data.data.services:', data.data?.services);\n01892|       console.log('üí≥ data.data.additionalServices:', data.data?.additionalServices);\n01893|       \n01894|       // –ü–æ–∏—Å–∫ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏ –≤ –¥—Ä—É–≥–∏—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö\n01895|       try {\n01896|         console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º derival...');\n01897|         if (data.data?.derival) {\n01898|           console.log('üí≥ derival –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n01899|           console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –ó–ê–ë–û–ï data.data.derival.insurance:', data.data.derival?.insurance);\n01900|         } else {\n01901|           console.log('üí≥ derival –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n01902|         }\n01903|         \n01904|         console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º arrival...');\n01905|         if (data.data?.arrival) {\n01906|           console.log('üí≥ arrival –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n01907|           console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –î–û–°–¢–ê–í–ö–ï data.data.arrival.insurance:', data.data.arrival?.insurance);\n01908|         } else {\n01909|           console.log('üí≥ arrival –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n01910|         }\n01911|         \n01912|         console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º intercity...');\n01913|         if (data.data?.intercity) {\n01914|           console.log('üí≥ intercity –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n01915|           console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –ü–ï–†–ï–í–û–ó–ö–ï data.data.intercity.insurance:', data.data.intercity?.insurance);\n01916|         } else {\n01917|           console.log('üí≥ intercity –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n01918|         }\n01919|       } catch (error) {\n01920|         console.error('‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–µ–∫—Ü–∏–π —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏:', error);\n01921|         console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', error instanceof Error ? error.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n01922|       }\n01923|       \n01924|       // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö \"insurance\"\n01925|       const findInsuranceFields = (obj: any, path = '') => {\n01926|         if (typeof obj !== 'object' || obj === null || obj === undefined) return;\n01927|         \n01928|         try {\n01929|           Object.keys(obj).forEach(key => {\n01930|             const fullPath = path ? `${path}.${key}` : key;\n01931|             if (key.toLowerCase().includes('insurance') || key.toLowerCase().includes('insur')) {\n01932|               console.log(`üí≥ –ù–ê–ô–î–ï–ù–û –ü–û–õ–ï –°–¢–†–ê–•–û–í–ö–ò [${fullPath}]:`, obj[key]);\n01933|             }\n01934|             if (typeof obj[key] === 'object' && obj[key] !== null && obj[key] !== undefined) {\n01935|               findInsuranceFields(obj[key], fullPath);\n01936|             }\n01937|           });\n01938|         } catch (error) {\n01939|           console.error(`üí≥ –û—à–∏–±–∫–∞ –≤ findInsuranceFields –¥–ª—è –ø—É—Ç–∏ ${path}:`, error);\n01940|         }\n01941|       };\n01942|       \n01943|       console.log('üí≥ –†–ï–ö–£–†–°–ò–í–ù–´–ô –ü–û–ò–°–ö –ü–û–õ–ï–ô –°–¢–†–ê–•–û–í–ö–ò:');\n01944|       try {\n01945|         if (data && data.data) {\n01946|           findInsuranceFields(data.data, 'data.data');\n01947|         } else {\n01948|           console.log('üí≥ –ü—Ä–æ–ø—É—Å–∫ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞: data.data –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');\n01949|         }\n01950|       } catch (error) {\n01951|         console.error('‚ùå –û–®–ò–ë–ö–ê –≤ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–º –ø–æ–∏—Å–∫–µ:', error);\n01952|         console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', error instanceof Error ? error.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n01953|       }\n01954|       console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –°–¢–†–ê–•–û–í–ö–ò ===');\n01955|       \n01956|       // –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ packages –≤ –æ—Ç–≤–µ—Ç–µ\n01957|       console.log('=== –ü–û–ò–°–ö PACKAGES –í –û–¢–í–ï–¢–ï ===');\n01958|       console.log('üì¶ data.data =', data.data);\n01959|       console.log('üì¶ data.data.packages =', data.data?.packages);\n01960|       console.log('üì¶ –¢–∏–ø data.data.packages:', typeof data.data?.packages);\n01961|       if (data.data?.packages) {\n01962|         console.log('‚úÖ PACKAGES –ù–ê–ô–î–ï–ù –í –û–¢–í–ï–¢–ï!');\n01963|         try {\n01964|           console.log('üì¶ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ packages:', JSON.stringify(data.data.packages, null, 2));\n01965|         } catch (jsonError) {\n01966|           console.error('‚ùå –û—à–∏–±–∫–∞ JSON.stringify –¥–ª—è packages:', jsonError);\n01967|           console.log('üì¶ packages (toString):', data.data.packages?.toString?.() || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å');\n01968|         }\n01969|       } else {\n01970|         console.log('‚ùå PACKAGES –ù–ï –ù–ê–ô–î–ï–ù –í –û–¢–í–ï–¢–ï');\n01971|       }\n01972|       console.log('=== –ö–û–ù–ï–¶ –ü–û–ò–°–ö–ê PACKAGES ===');\n01973| \n01974|       if (response.ok && data.data && data.metadata?.status === 200) {\n01975|         let totalPrice = data.data.price || 0;\n01976|         console.log('üí∞ –†–ê–°–ß–ï–¢ –ò–¢–û–ì–û–í–û–ô –°–¢–û–ò–ú–û–°–¢–ò:');\n01977|         console.log('üí∞ –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å data.data.price (–£–ñ–ï –í–ö–õ–Æ–ß–ê–ï–¢ –í–°–ï):', totalPrice);\n01978|         \n01979|         // –°–¢–†–ê–•–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n01980|         if (data.data.insurance) {\n01981|           console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ data.data.insurance (–£–ñ–ï –≤–∫–ª—é—á–µ–Ω–∞ –≤ –±–∞–∑–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):', data.data.insurance);\n01982|           console.log('üí∞ –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞—Ö–æ–≤–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ');\n01983|         } else {\n01984|           console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–≤–µ—Ç–µ');\n01985|         }\n01986|         \n01987|         // –£–ü–ê–ö–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n01988|         console.log('üí∞ –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–ë –£–ü–ê–ö–û–í–ö–ï (–£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –í –û–°–ù–û–í–ù–£–Æ –°–¢–û–ò–ú–û–°–¢–¨):');\n01989|         console.log('üí∞ data.data.packages =', data.data.packages);\n01990|         console.log('üí∞ form.needPackaging =', form.needPackaging);\n01991|         \n01992|         if (data.data.packages && form.needPackaging) {\n01993|           console.log('üí∞ ‚úÖ –£–ü–ê–ö–û–í–ö–ê –ü–†–ò–°–£–¢–°–¢–í–£–ï–¢ –í –û–¢–í–ï–¢–ï (—Ü–µ–Ω–∞ —É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ data.data.price)');\n01994|           console.log('üí∞ –¢–∏–ø packages:', Array.isArray(data.data.packages) ? 'Array' : 'Object');\n01995|           \n01996|           if (Array.isArray(data.data.packages)) {\n01997|             data.data.packages.forEach((pkg: any, index: number) => {\n01998|               console.log(`üí∞ Package [${index}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n01999|             });\n02000|           } else {\n02001|             Object.entries(data.data.packages).forEach(([key, pkg]: [string, any]) => {\n02002|               console.log(`üí∞ Package [${key}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n02003|             });\n02004|           }\n02005|         } else {\n02006|           console.log('üí∞ ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∞—Å—å');\n02007|         }\n02008| \n02009|         // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–∞–∫ —Ä–∞–∑–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –¥–∞—Ç–∞–º–∏ pickup –∏ arrivalToOspReceiver\n02010|         let deliveryDays = 0;\n02011|         try {\n02012|           console.log('=== –ü–û–ò–°–ö –î–ê–¢ –í –û–¢–í–ï–¢–ï ===');\n02013|           \n02014|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–µ—Å—Ç–∞ –≥–¥–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–∞—Ç—ã\n02015|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.pickup:', data.data?.pickup);\n02016|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.pickup:', data.pickup);\n02017|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.pickup:', data?.pickup);\n02018|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.arrivalToOspReceiver:', data.data?.arrivalToOspReceiver);\n02019|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.arrivalToOspReceiver:', data.arrivalToOspReceiver);\n02020|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.arrivalToOspReceiver:', data?.arrivalToOspReceiver);\n02021|           \n02022|           // –ë–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–π –ø–æ–∏—Å–∫ –≤–æ –≤—Å–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ data\n02023|           const findDateInObject = (obj: any, fieldName: string): string | null => {\n02024|             if (!obj || typeof obj !== 'object') return null;\n02025|             \n02026|             for (const [key, value] of Object.entries(obj)) {\n02027|               if (key === fieldName && typeof value === 'string') {\n02028|                 return value;\n02029|               }\n02030|               if (typeof value === 'object' && value !== null) {\n02031|                 const found = findDateInObject(value, fieldName);\n02032|                 if (found) return found;\n02033|               }\n02034|             }\n02035|             return null;\n02036|           };\n02037|           \n02038|           const pickup = findDateInObject(data, 'pickup');\n02039|           const arrivalToOspReceiver = findDateInObject(data, 'arrivalToOspReceiver');\n02040|           \n02041|           console.log('–ù–ê–ô–î–ï–ù–ù–´–ï –î–ê–¢–´:');\n02042|           console.log('pickup:', pickup);\n02043|           console.log('arrivalToOspReceiver:', arrivalToOspReceiver);\n02044|           \n02045|           if (pickup && arrivalToOspReceiver) {\n02046|             // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—ã (—Ñ–æ—Ä–º–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å \"2025-09-27\" –∏–ª–∏ \"2025-09-27 10:00:00\")\n02047|             const pickupDate = new Date(pickup);\n02048|             const arrivalDate = new Date(arrivalToOspReceiver);\n02049|             \n02050|             console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ pickup:', pickupDate);\n02051|             console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ arrival:', arrivalDate);\n02052|             \n02053|             // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã\n02054|             if (!isNaN(pickupDate.getTime()) && !isNaN(arrivalDate.getTime())) {\n02055|               // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–æ—Å—Ç—å –≤ –¥–Ω—è—Ö\n02056|               const timeDiff = arrivalDate.getTime() - pickupDate.getTime();\n02057|               deliveryDays = Math.max(1, Math.ceil(timeDiff / (1000 * 3600 * 24))); // –ú–∏–Ω–∏–º—É–º 1 –¥–µ–Ω—å\n02058|               \n02059|               console.log('–†–∞–∑–Ω–æ—Å—Ç—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö:', timeDiff);\n02060|               console.log('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –í–´–ß–ò–°–õ–ï–ù —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:', deliveryDays, '–¥–Ω–µ–π');\n02061|             } else {\n02062|               console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞—Ç—ã –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞');\n02063|               console.error('pickup Date object:', pickupDate);\n02064|               console.error('arrival Date object:', arrivalDate);\n02065|             }\n02066|           } else {\n02067|             console.warn('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ –Ω–∞–π–¥–µ–Ω—ã –¥–∞—Ç—ã pickup –∏–ª–∏ arrivalToOspReceiver');\n02068|             console.log('pickup –Ω–∞–π–¥–µ–Ω:', !!pickup, pickup);\n02069|             console.log('arrivalToOspReceiver –Ω–∞–π–¥–µ–Ω:', !!arrivalToOspReceiver, arrivalToOspReceiver);\n02070|           }\n02071|         } catch (error) {\n02072|           console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –û—à–∏–±–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:', error);\n02073|         }\n02074| \n02075|         console.log('üí∞ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ò–¢–û–ì–û–í–ê–Ø –°–¢–û–ò–ú–û–°–¢–¨:', Math.round(totalPrice));\n02076|         \n02077|         return {\n02078|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n02079|           price: Math.round(totalPrice),\n02080|           days: deliveryDays || 0,\n02081|           details: data.data || {},\n02082|           requestData,\n02083|           responseData: data,\n02084|           apiUrl,\n02085|           sessionId: sessionID\n02086|         };\n02087|       } else {\n02088|         const errorMessage = data.metadata?.detail || \n02089|                            data.metadata?.message || \n02090|                            data.errors?.[0]?.detail || \n02091|                            (data.metadata?.status !== 200 ? `HTTP ${data.metadata?.status}` : '') ||\n02092|                            '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏';\n02093|         return {\n02094|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n02095|           price: 0,\n02096|           days: 0,\n02097|           error: errorMessage,\n02098|           requestData,\n02099|           responseData: data,\n02100|           apiUrl,\n02101|           sessionId: sessionID\n02102|         };\n02103|       }\n02104|     } catch (error: any) {\n02105|       return {\n02106|         company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n02107|         price: 0,\n02108|         days: 0,\n02109|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n02110|         requestData: null,\n02111|         responseData: null,\n02112|         apiUrl\n02113|       };\n02114|     }\n02115|   };\n02116| \n02117| \n02118| \n02119|   // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–Ω–æ–π –∑–æ–Ω—ã –∏ —Å–∫–ª–∞–¥–∞ –ü–≠–ö –ø–æ –∞–¥—Ä–µ—Å—É —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏\n02120|   const getPekZoneByAddress = async (address: string) => {\n02121|     try {\n02122|       console.log(`üîç –ü–≠–ö: –ø–æ–∏—Å–∫ –∑–æ–Ω—ã –¥–ª—è –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n02123| \n02124|       const result = await enhancedApiRequest(\n02125|         '/api/pek',\n02126|         {\n02127|           method: 'POST',\n02128|           headers: {\n02129|             'Content-Type': 'application/json',\n02130|           },\n02131|           body: JSON.stringify({\n02132|             method: 'findzonebyaddress',\n02133|             address: address\n02134|           })\n02135|         },\n02136|         { operation: 'findzonebyaddress', company: '–ü–≠–ö' }\n02137|       );\n02138| \n02139|       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n02140|         console.error(`‚ùå –ü–≠–ö API –æ—à–∏–±–∫–∞:`, result.error);\n02141|         console.log(`üîÑ –ü–≠–ö: –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥—É –¥–ª—è \"${address}\"`);\n02142|         return getPekZoneFallback(address);\n02143|       }\n02144| \n02145|       const response = result as Response;\n02146|       console.log(`üì° –ü–≠–ö API —Å—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`);\n02147| \n02148|       if (!response.ok) {\n02149|         let errorData;\n02150|         try {\n02151|           errorData = await response.json();\n02152|         } catch {\n02153|           errorData = { error: '–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç' };\n02154|         }\n02155| \n02156|         console.error(`‚ùå –ü–≠–ö API –æ—à–∏–±–∫–∞ ${response.status}:`, errorData);\n02157| \n02158|         // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫\n02159|         if (response.status === 401) {\n02160|           console.error('‚ùå –ü–≠–ö: –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω');\n02161|         } else if (response.status === 404) {\n02162|           console.error('‚ùå –ü–≠–ö: –ú–µ—Ç–æ–¥ API –Ω–µ –Ω–∞–π–¥–µ–Ω');\n02163|         } else if (response.status === 400) {\n02164|           console.error('‚ùå –ü–≠–ö: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞');\n02165|         } else if (response.status >= 500) {\n02166|           console.error('‚ùå –ü–≠–ö: –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ü–≠–ö');\n02167|         }\n02168| \n02169|         console.log(`üîÑ –ü–≠–ö: –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥—É –¥–ª—è \"${address}\"`);\n02170|         return getPekZoneFallback(address);\n02171|       }\n02172| \n02173|       const data = await response.json();\n02174|       console.log(`‚úÖ –ü–≠–ö –∑–æ–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞:`, data);\n02175| \n02176|       if (data.zoneId && data.mainWarehouseId) {\n02177|         return {\n02178|           zoneId: data.zoneId,\n02179|           zoneName: data.zoneName,\n02180|           branchUID: data.branchUID,\n02181|           branchCode: data.branchCode,\n02182|           branchTitle: data.branchTitle,\n02183|           mainWarehouseId: data.mainWarehouseId,\n02184|           warehousePoint: data.warehousePoint,\n02185|           geoData: data.GeoData,\n02186|           precision: data.GeoData?.precision\n02187|         };\n02188|       }\n02189| \n02190|       console.warn(`‚ö†Ô∏è –ü–≠–ö: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç:`, data);\n02191|       return getPekZoneFallback(address);\n02192| \n02193|     } catch (error) {\n02194|       console.error('‚ùå –ü–≠–ö: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∑–æ–Ω—ã:', error);\n02195|       return getPekZoneFallback(address);\n02196|     }\n02197|   };\n02198| \n02199|   // –§–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–æ–Ω—ã –ü–≠–ö\n02200|   const getPekZoneFallback = (address: string) => {\n02201|     console.log(`üîÑ –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –∞–Ω–∞–ª–∏–∑ –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n02202|     \n02203|     const addressLower = address.toLowerCase();\n02204|     \n02205|     // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –∏ –∏—Ö –¥–∞–Ω–Ω—ã–µ\n02206|     const cityMappings: { [key: string]: any } = {\n02207|       '–º–æ—Å–∫–≤–∞': {\n02208|         zoneId: 'moscow-zone-001',\n02209|         zoneName: '–ú–æ—Å–∫–≤–∞',\n02210|         branchUID: 'moscow-branch-001',\n02211|         branchCode: '–ú–°–ö',\n02212|         branchTitle: '–ú–æ—Å–∫–≤–∞',\n02213|         mainWarehouseId: 'dc6c746d-812d-11e4-bbfc-001999d8b3c5',\n02214|         warehousePoint: {\n02215|           latitude: 55.755826,\n02216|           longitude: 37.6173\n02217|         }\n02218|       },\n02219|       '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': {\n02220|         zoneId: 'spb-zone-001',\n02221|         zoneName: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n02222|         branchUID: 'spb-branch-001',\n02223|         branchCode: '–°–ü–ë',\n02224|         branchTitle: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n02225|         mainWarehouseId: 'b436c978-086d-11e6-b6ca-00155d668909',\n02226|         warehousePoint: {\n02227|           latitude: 59.9311,\n02228|           longitude: 30.3609\n02229|         }\n02230|       },\n02231|       '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': {\n02232|         zoneId: 'ekb-zone-001',\n02233|         zoneName: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',\n02234|         branchUID: 'ekb-branch-001',\n02235|         branchCode: '–ï–ö–ë',\n02236|         branchTitle: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',\n02237|         mainWarehouseId: 'f8d9c8e3-8e2d-11e4-bbfc-001999d8b3c5',\n02238|         warehousePoint: {\n02239|           latitude: 56.8431,\n02240|           longitude: 60.6454\n02241|         }\n02242|       }\n02243|     };\n02244|     \n02245|     for (const [city, data] of Object.entries(cityMappings)) {\n02246|       if (addressLower.includes(city) || addressLower.includes(city.replace('-', ' '))) {\n02247|         console.log(`‚úÖ –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –Ω–∞–π–¥–µ–Ω –≥–æ—Ä–æ–¥ ${city}`);\n02248|         return {\n02249|           ...data,\n02250|           geoData: {\n02251|             precision: 'fallback',\n02252|             kind: 'locality'\n02253|           },\n02254|           precision: 'fallback'\n02255|         };\n02256|       }\n02257|     }\n02258|     \n02259|     console.warn(`‚ùå –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –≥–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ \"${address}\"`);\n02260|     return null;\n02261|   };\n02262| \n02263|   // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –ü–≠–ö\n02264|   const getPekNearestDepartments = async (address: string, coordinates?: { latitude: string, longitude: string }) => {\n02265|     try {\n02266|       console.log(`üè¢ –ü–≠–ö: –ø–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –¥–ª—è \"${address}\"`);\n02267| \n02268|       const requestBody: any = {\n02269|         departmentOperation: 3, // –≤—ã–¥–∞—á–∞ –≥—Ä—É–∑–æ–≤\n02270|         type: 3, // –∞–≤—Ç–æ-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç\n02271|         searchRadius: 50, // –∫–º\n02272|         limit: 5\n02273|       };\n02274| \n02275|       // –ü–≠–ö API —Ç—Ä–µ–±—É–µ—Ç –∏ –∞–¥—Ä–µ—Å, –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ\n02276|       requestBody.address = address;\n02277| \n02278|       if (coordinates) {\n02279|         requestBody.coordinates = coordinates;\n02280|         console.log(`üìç –ü–≠–ö: –ø–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\" –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º`, coordinates);\n02281|       } else {\n02282|         console.log(`üìç –ü–≠–ö: –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\"`);\n02283|       }\n02284| \n02285|       const result = await enhancedApiRequest(\n02286|         '/api/pek',\n02287|         {\n02288|           method: 'POST',\n02289|           headers: {\n02290|             'Content-Type': 'application/json',\n02291|           },\n02292|           body: JSON.stringify({\n02293|             method: 'nearestdepartments',\n02294|             ...requestBody\n02295|           })\n02296|         },\n02297|         { operation: 'nearestdepartments', company: '–ü–≠–ö' }\n02298|       );\n02299| \n02300|       if (result && typeof result === 'object' && 'success' in result && !result.success) {\n02301|         console.error(`‚ùå –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API –æ—à–∏–±–∫–∞:`, result.error);\n02302|         return null;\n02303|       }\n02304| \n02305|       const response = result as Response;\n02306|       console.log(`üì° –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API —Å—Ç–∞—Ç—É—Å: ${response.status}`);\n02307| \n02308|       if (!response.ok) {\n02309|         const errorText = await response.text();\n02310|         console.error(`‚ùå –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API –æ—à–∏–±–∫–∞: ${response.status} ${response.statusText}`);\n02311|         console.error(`‚ùå –û—Ç–≤–µ—Ç:`, errorText.substring(0, 500));\n02312|         return null;\n02313|       }\n02314| \n02315|       const data = await response.json();\n02316|       console.log(`‚úÖ –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–∞–π–¥–µ–Ω—ã:`, data);\n02317| \n02318|       // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤–æ–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ —Å –Ω–∞–∏–≤—ã—Å—à–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º\n02319|       if (data.freeDepartments && data.freeDepartments.length > 0) {\n02320|         const bestDepartment = data.freeDepartments.sort((a: any, b: any) => b.priority - a.priority)[0];\n02321|         console.log(`‚úÖ –ü–≠–ö: –≤—ã–±—Ä–∞–Ω–æ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ`, bestDepartment.divisionName);\n02322|         return {\n02323|           warehouseId: bestDepartment.warehouseId,\n02324|           branchId: bestDepartment.branchId,\n02325|           branchName: bestDepartment.branchName,\n02326|           divisionName: bestDepartment.divisionName,\n02327|           address: bestDepartment.address,\n02328|           coordinates: bestDepartment.coordinates,\n02329|           phone: bestDepartment.phone,\n02330|           email: bestDepartment.email\n02331|         };\n02332|       }\n02333| \n02334|       console.warn(`‚ùå –ü–≠–ö: –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è \"${address}\"`);\n02335|       return null;\n02336|     } catch (error) {\n02337|       console.error('‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –æ—Ç–¥–µ–ª–µ–Ω–∏–π:', error);\n02338|       return null;\n02339|     }\n02340|   };\n02341| \n02342|   // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ü–≠–ö)\n02343|   const getYandexCoordinates = async (address: string): Promise<{ latitude: string, longitude: string } | null> => {\n02344|     try {\n02345|       const encodedAddress = encodeURIComponent(address);\n02346|       const response = await fetch(`https://geocode-maps.yandex.ru/1.x/?apikey=YOUR_API_KEY&geocode=${encodedAddress}&format=json`);\n02347|       \n02348|       if (!response.ok) return null;\n02349|       \n02350|       const data = await response.json();\n02351|       const coords = data?.response?.GeoObjectCollection?.featureMember?.[0]?.GeoObject?.Point?.pos?.split(' ');\n02352|       \n02353|       if (coords && coords.length === 2) {\n02354|         return {\n02355|           longitude: coords[0],\n02356|           latitude: coords[1]\n02357|         };\n02358|       }\n02359|       \n02360|       return null;\n02361|     } catch (error) {\n02362|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ø–Ω–¥–µ–∫—Å:', error);\n02363|       return null;\n02364|     }\n02365|   };\n02366| \n02367|   // –†–∞—Å—á–µ—Ç –¥–ª—è –ü–≠–ö —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API v1/calculateprice/\n02368|   const calculatePEK = async (): Promise<CalculationResult> => {\n02369|     const apiUrl = 'https://kabinet.pecom.ru/api/v1/calculateprice/';\n02370|     \n02371|     // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç\n02372|     const validateCoordinates = (coords: any) => {\n02373|       console.log('üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:', coords);\n02374|       \n02375|       if (!coords) {\n02376|         console.log('‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç');\n02377|         return null;\n02378|       }\n02379|       \n02380|       if (typeof coords.latitude !== 'number' || typeof coords.longitude !== 'number') {\n02381|         console.warn(`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ —è–≤–ª—è—é—Ç—Å—è —á–∏—Å–ª–∞–º–∏:`, { \n02382|           lat: coords.latitude, \n02383|           lng: coords.longitude,\n02384|           latType: typeof coords.latitude,\n02385|           lngType: typeof coords.longitude\n02386|         });\n02387|         return null;\n02388|       }\n02389|       \n02390|       const lat = Number(coords.latitude);\n02391|       const lng = Number(coords.longitude);\n02392|       \n02393|       console.log(`üìç –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: lat=${lat}, lng=${lng}`);\n02394|       \n02395|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω—ã\n02396|       if (lat < -90 || lat > 90 || lng < -180 || lng > 180 || isNaN(lat) || isNaN(lng)) {\n02397|         console.warn(`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–Ω–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞:`, { \n02398|           lat, lng, \n02399|           latValid: lat >= -90 && lat <= 90,\n02400|           lngValid: lng >= -180 && lng <= 180,\n02401|           latIsNaN: isNaN(lat),\n02402|           lngIsNaN: isNaN(lng)\n02403|         });\n02404|         return null;\n02405|       }\n02406|       \n02407|       console.log('‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã:', { latitude: lat, longitude: lng });\n02408|       return { latitude: lat, longitude: lng };\n02409|     };\n02410|     \n02411|     try {\n02412|       // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–æ–Ω–∞—Ö –∏ —Å–∫–ª–∞–¥–∞—Ö –ø–æ –∞–¥—Ä–µ—Å–∞–º\n02413|       console.log(`üöÄ –ü–≠–ö: –Ω–∞—á–∏–Ω–∞–µ–º —Ä–∞—Å—á–µ—Ç`);\n02414|       console.log(`üìç –û—Ç: ${form.fromAddress || form.fromCity}`);\n02415|       console.log(`üìç –î–æ: ${form.toAddress || form.toCity}`);\n02416|       \n02417|       const senderZone = await getPekZoneByAddress(form.fromAddress || `–≥ ${form.fromCity}`);\n02418|       const receiverZone = await getPekZoneByAddress(form.toAddress || `–≥ ${form.toCity}`);\n02419|       \n02420|       console.log(`üîç –ü–≠–ö –∑–æ–Ω—ã:`);\n02421|       console.log(`üìç –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å:`, senderZone ? `${senderZone.branchTitle} (${senderZone.mainWarehouseId})` : '–ù–ï –ù–ê–ô–î–ï–ù–ê');\n02422|       console.log(`üìç –ü–æ–ª—É—á–∞—Ç–µ–ª—å:`, receiverZone ? `${receiverZone.branchTitle} (${receiverZone.mainWarehouseId})` : '–ù–ï –ù–ê–ô–î–ï–ù–ê');\n02423|       \n02424|       if (!senderZone || !receiverZone) {\n02425|         // –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞\n02426|         const debugInfo = {\n02427|           senderAddress: form.fromAddress || form.fromCity,\n02428|           receiverAddress: form.toAddress || form.toCity,\n02429|           senderZoneFound: !!senderZone,\n02430|           receiverZoneFound: !!receiverZone,\n02431|           apiTested: true\n02432|         };\n02433|         \n02434|         console.error(`‚ùå –ü–≠–ö: –∑–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã`, debugInfo);\n02435|         \n02436|         return {\n02437|           company: '–ü–≠–ö',\n02438|           price: 0,\n02439|           days: 0,\n02440|           error: `–ó–æ–Ω–∞ –ü–≠–ö –Ω–µ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥—Ä–µ—Å–∞: ${!senderZone ? (form.fromAddress || form.fromCity) : ''} ${!receiverZone ? (form.toAddress || form.toCity) : ''}`.trim(),\n02441|           apiUrl,\n02442|           requestData: debugInfo,\n02443|           responseData: { senderZone, receiverZone }\n02444|         };\n02445|       }\n02446| \n02447|       // –ü–æ–ª—É—á–∞–µ–º –±–ª–∏–∂–∞–π—à–∏–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –∞–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞\n02448|       let senderWarehouseId = senderZone.mainWarehouseId;\n02449|       let receiverWarehouseId = receiverZone.mainWarehouseId;\n02450|       \n02451|       if (form.fromAddressDelivery && senderZone.warehousePoint) {\n02452|         const validSenderCoords = validateCoordinates(senderZone.warehousePoint);\n02453|         if (validSenderCoords) {\n02454|           try {\n02455|             const senderDepartment = await getPekNearestDepartments(\n02456|               form.fromAddress || form.fromCity,\n02457|               {\n02458|                 latitude: validSenderCoords.latitude.toString(),\n02459|                 longitude: validSenderCoords.longitude.toString()\n02460|               }\n02461|             );\n02462|             if (senderDepartment) {\n02463|               senderWarehouseId = senderDepartment.warehouseId;\n02464|               console.log('‚úÖ –ù–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π —Å–∫–ª–∞–¥ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è:', senderDepartment.warehouseId);\n02465|             }\n02466|           } catch (error) {\n02467|             console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥:', error);\n02468|           }\n02469|         } else {\n02470|           console.warn('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥');\n02471|         }\n02472|       }\n02473|       \n02474|       if (form.toAddressDelivery && receiverZone.warehousePoint) {\n02475|         const validReceiverCoords = validateCoordinates(receiverZone.warehousePoint);\n02476|         if (validReceiverCoords) {\n02477|           try {\n02478|             const receiverDepartment = await getPekNearestDepartments(\n02479|               form.toAddress || form.toCity,\n02480|               {\n02481|                 latitude: validReceiverCoords.latitude.toString(),\n02482|                 longitude: validReceiverCoords.longitude.toString()\n02483|               }\n02484|             );\n02485|             if (receiverDepartment) {\n02486|               receiverWarehouseId = receiverDepartment.warehouseId;\n02487|               console.log('‚úÖ –ù–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π —Å–∫–ª–∞–¥ –ø–æ–ª—É—á–∞—Ç–µ–ª—è:', receiverDepartment.warehouseId);\n02488|             }\n02489|           } catch (error) {\n02490|             console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥:', error);\n02491|           }\n02492|         } else {\n02493|           console.warn('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥');\n02494|         }\n02495|       }\n02496| \n02497|       // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞—Ç—ã N –¥–Ω–µ–π –æ—Ç —Å–µ–≥–æ–¥–Ω—è\n02498|       const getDateForCalculation = (daysFromToday: number): string => {\n02499|         const date = new Date();\n02500|         date.setDate(date.getDate() + daysFromToday);\n02501|         return date.toISOString().slice(0, 19); // 2025-09-28T14:00:00\n02502|       };\n02503| \n02504|       // –ù–∞—á–∏–Ω–∞–µ–º —Å –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–≥–æ –¥–Ω—è\n02505|       let currentDayOffset = 1;\n02506|       let plannedDateTime = getDateForCalculation(currentDayOffset);\n02507| \n02508|       // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤ (–±–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç)\n02509|       const cargos = form.cargos.map(cargo => {\n02510|         const cargoData = {\n02511|           length: cargo.length / 100, // –ø–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–µ—Ç—Ä—ã\n02512|           width: cargo.width / 100,\n02513|           height: cargo.height / 100,\n02514|           volume: (cargo.length * cargo.width * cargo.height) / 1000000, // –º3\n02515|           weight: cargo.weight,\n02516|           isHP: form.needPackaging, // –∑–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n02517|           sealingPositionsCount: 0\n02518|         };\n02519|         \n02520|         console.log('üì¶ –ì—Ä—É–∑ –¥–ª—è –ü–≠–ö:', cargoData);\n02521|         return cargoData;\n02522|       });\n02523| \n02524|       // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (–Ω—É–∂–Ω–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ)\n02525|       let finalRequestData: any = null;\n02526|       \n02527|       // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ —Ä–∞—Å—á–µ—Ç–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç–æ–π\n02528|       const tryCalculateWithDate = async (plannedDateTime: string): Promise<any> => {\n02529|         // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –∫ API –ü–≠–ö —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n02530|         const requestData: any = {\n02531|           currencyCode: \"643\", // —Ä—É–±–ª–∏\n02532|           types: [3], // —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ –ø–µ—Ä–µ–≤–æ–∑–∫–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –º–∞—Å—Å–∏–≤)\n02533|           senderWarehouseId,\n02534|           receiverWarehouseId,\n02535|           isOpenCarSender: false,\n02536|           isOpenCarReceiver: false,\n02537|           isHyperMarket: false,\n02538|           plannedDateTime,\n02539|           isInsurance: form.needInsurance && form.declaredValue > 0,\n02540|           isInsurancePrice: form.needInsurance ? form.declaredValue : 0,\n02541|           isPickUp: form.fromAddressDelivery,\n02542|           isDelivery: form.toAddressDelivery,\n02543|           needReturnDocuments: false,\n02544|           needArrangeTransportationDocuments: false,\n02545|           senderDistanceType: 0,\n02546|           receiverDistanceType: 0,\n02547|           cargos // –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤\n02548|         };\n02549|         \n02550|         console.log('üìã –ü–≠–ö: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ requestData:', JSON.stringify(requestData, null, 2));\n02551| \n02552|         // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏ –ü–†–† –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\n02553|         if (form.needCarry) {\n02554|           requestData.pickupServices = {\n02555|             isLoading: true,\n02556|             floor: Math.max(0, form.floor - 1), // –ü–≠–ö —Å—á–∏—Ç–∞–µ—Ç —Å 0\n02557|             carryingDistance: 0,\n02558|             isElevator: form.hasFreightLift\n02559|           };\n02560|           requestData.deliveryServices = {\n02561|             isLoading: true,\n02562|             floor: Math.max(0, form.floor - 1),\n02563|             carryingDistance: 0,\n02564|             isElevator: form.hasFreightLift\n02565|           };\n02566|         }\n02567| \n02568|         // –î–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫–∏ pickup/delivery —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ü–≠–ö\n02569|         if (form.fromAddressDelivery) {\n02570|           console.log('üìç –ü–≠–ö: –¥–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ pickup –¥–ª—è –∑–∞–±–æ—Ä–∞');\n02571|           requestData.pickup = {\n02572|             address: form.fromAddress || `–†–æ—Å—Å–∏—è, ${form.fromCity}`\n02573|             // coordinates –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏\n02574|           };\n02575|         }\n02576|         \n02577|         if (form.toAddressDelivery) {\n02578|           console.log('üìç –ü–≠–ö: –¥–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ delivery –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏');\n02579|           requestData.delivery = {\n02580|             address: form.toAddress || `–†–æ—Å—Å–∏—è, ${form.toCity}`\n02581|             // coordinates –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏\n02582|           };\n02583|         }\n02584| \n02585|         // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n02586|         const requiredFields = ['types', 'senderWarehouseId', 'receiverWarehouseId', 'plannedDateTime', 'cargos'];\n02587|         const missingFields = requiredFields.filter(field => !requestData[field]);\n02588|         \n02589|         if (missingFields.length > 0) {\n02590|           throw new Error(`–ü–≠–ö: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: ${missingFields.join(', ')}`);\n02591|         }\n02592|         \n02593|         if (!Array.isArray(requestData.types) || requestData.types.length === 0) {\n02594|           throw new Error('–ü–≠–ö: –ø–æ–ª–µ types –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º');\n02595|         }\n02596|         \n02597|         if (!Array.isArray(requestData.cargos) || requestData.cargos.length === 0) {\n02598|           throw new Error('–ü–≠–ö: –ø–æ–ª–µ cargos –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º');\n02599|         }\n02600|         \n02601|         console.log('‚úÖ –ü–≠–ö: –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –ø—Ä–æ–π–¥–µ–Ω–∞');\n02602| \n02603|         // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏\n02604|         finalRequestData = {\n02605|           method: 'calculateprice',\n02606|           ...requestData\n02607|         };\n\n(File has more lines. Use 'offset' parameter to read beyond line 2607)\n</file>",
    "title": "app/page.tsx",
    "metadata": {
      "preview": "        try {\n          const totalWeight = 10;\n          const totalVolume = 0.1;\n          \n          const params = new URLSearchParams({\n            from: '91',\n            to: '92',\n            pickup: '1',\n            deliver: '1',\n            weight: totalWeight.toString(),\n            volume: totalVolume.toString(),\n            oversized: '0',\n            package: '1',\n            packageCount: '1',\n            insurance: '1',\n            sum: '50000',\n            documentsReturn: '0',\n            fragile: '1'\n          });\n"
    },
    "time": {
      "start": 1763466888526,
      "end": 1763466888531
    }
  }
}