{
  "id": "prt_b22ca93aa001elTrBYhSO6bc3D",
  "sessionID": "ses_4ec400949ffekDUyPGFumLInaA",
  "messageID": "msg_b22ca9395001QhTJW0MdmeVqf2",
  "type": "text",
  "text": "–†–µ–∞–ª–∏–∑—É–π —Å–ª–µ–¥—É—é—â–∏–π –ø–ª–∞–Ω:\n\n–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø–ª–∞–Ω –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è API Nordwheel\n–î–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –ø–ª–∞–Ω—É\n1. –£–¥–∞–ª–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è\n–ü—Ä–∏—á–∏–Ω–∞: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ Dadata –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.\n\n2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ fallback –ª–æ–≥–∏–∫–∏\n–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ: –ï—Å–ª–∏ Dadata –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ä–æ–¥ –∫–∞–∫ —Å—Ç—Ä–æ–∫—É –≤–º–µ—Å—Ç–æ FIAS –∫–æ–¥–∞.\n\n–ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ getNordwheelCityFias:\n\nasync function getNordwheelCityFias(cityName: string): Promise<string> {\n  try {\n    // –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ Dadata findById\n    const response = await fetch('/api/dadata?fias_id=' + encodeURIComponent(cityName) + '&type=findById');\n    const data = await response.json();\n\n    if (data.success && data.data?.data?.city_fias_id) {\n      console.log(`üöõ Nordwheel: –ü–æ–ª—É—á–µ–Ω –∞–∫—Ç—É–∞–ª—å–Ω—ã–π FIAS –¥–ª—è ${cityName}:`, data.data.data.city_fias_id);\n      return data.data.data.city_fias_id;\n    } else {\n      // FIAS –Ω–µ –Ω–∞–π–¥–µ–Ω - –≤—ã–≤–æ–¥–∏–º –æ—à–∏–±–∫—É\n      console.error(`üöõ Nordwheel: FIAS –∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –≥–æ—Ä–æ–¥–∞ ${cityName}`);\n      throw new Error(`FIAS –∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –≥–æ—Ä–æ–¥–∞ ${cityName}`);\n    }\n  } catch (error) {\n    console.warn(`üöõ Nordwheel: Dadata –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è ${cityName}, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–æ—Ä–æ–¥ –∫–∞–∫ —Å—Ç—Ä–æ–∫—É:`, error);\n    // Fallback: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≥–æ—Ä–æ–¥ –∫–∞–∫ —Å—Ç—Ä–æ–∫—É –≤–º–µ—Å—Ç–æ FIAS –∫–æ–¥–∞\n    return cityName;\n  }\n}\n3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ FIAS –∫–æ–¥–∞\n–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ: –ï—Å–ª–∏ FIAS –Ω–µ –Ω–∞–π–¥–µ–Ω, –≤—ã–≤–µ—Å—Ç–∏ –æ—à–∏–±–∫—É.\n\n–ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ getDispatchLocation –∏ getDestinationLocation:\n\nconst getDispatchLocation = async () => {\n  try {\n    if (form.fromTerminal) {\n      return {\n        type: 'terminal' as const,\n        city_fias: await getNordwheelCityFias(form.fromCity)\n      };\n    } else if (form.fromLavsiteWarehouse) {\n      return {\n        type: 'address' as const,\n        address: form.fromAddress || '–¥–µ—Ä–µ–≤–Ω—è –û—Å–µ–µ–≤–æ, 202, –≥–æ—Ä–æ–¥—Å–∫–æ–π –æ–∫—Ä—É–≥ –õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π, –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å'\n      };\n    } else {\n      return {\n        type: 'address' as const,\n        address: form.fromAddress || form.fromCity\n      };\n    }\n  } catch (error) {\n    console.error(`üöõ Nordwheel: –û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è:`, error);\n    throw error; // –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –≤—ã—à–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ calculateNordWheel\n  }\n};\n4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ calculateNordWheel\n–î–æ–±–∞–≤–ª–µ–Ω–∏–µ: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –æ—Ç —Ñ—É–Ω–∫—Ü–∏–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–π.\n\ntry {\n  const requestData = {\n    dispatch: {\n      location: await getDispatchLocation()\n    },\n    destination: {\n      location: await getDestinationLocation()\n    },\n    cargo: {\n      total_weight: totalWeight,\n      total_volume: totalVolume,\n      total_quantity: 1\n    },\n    insurance: form.needInsurance && form.declaredValue ? form.declaredValue : null,\n    insurance_refuse: !form.needInsurance,\n    services: {\n      is_package: form.needPackaging,\n      is_documents_return: false,\n      is_fragile: false\n    },\n    promocode: null\n  };\n\n  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥\n} catch (locationError) {\n  console.error('üöõ Nordwheel: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–π:', locationError);\n  return {\n    company: 'Nord Wheel',\n    price: 0,\n    days: 0,\n    error: `–û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞–¥—Ä–µ—Å–æ–≤: ${locationError.message}`,\n    apiUrl\n  };\n}\n–ò—Ç–æ–≥–æ–≤—ã–π –ø–ª–∞–Ω –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Ç–æ–ª—å–∫–æ –¥–ª—è Nordwheel)\n–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:\napp/page.tsx (—Ñ—É–Ω–∫—Ü–∏—è calculateNordWheel)\n–î–æ–±–∞–≤–ª—è–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:\ngetNordwheelCityFias() - –ª–æ–∫–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è FIAS —á–µ—Ä–µ–∑ Dadata\n–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ getDispatchLocation() - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫\n–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ getDestinationLocation() - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫\n–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:\n–°–∫–ª–∞–¥ –õ–∞–≤—Å–∏—Ç ‚Üí type: 'address' –≤–º–µ—Å—Ç–æ type: 'terminal'\nDadata –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö FIAS –∫–æ–¥–æ–≤\nFallback –ª–æ–≥–∏–∫–∞ ‚Üí –≥–æ—Ä–æ–¥ –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Dadata\n–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ ‚Üí –≤—ã–≤–æ–¥ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ FIAS –∫–æ–¥–∞\n–ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π\n–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è:\n\n–¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞: type: 'terminal' + FIAS –∫–æ–¥\n–ê–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞: type: 'address' + –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å\n–°–∫–ª–∞–¥ –õ–∞–≤—Å–∏—Ç: type: 'address' + –∞–¥—Ä–µ—Å —Å–∫–ª–∞–¥–∞\n–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Dadata –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:\n\n–£—Å–ø–µ—à–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ FIAS –∫–æ–¥–∞\nFallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API\n–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è FIAS –∫–æ–¥–∞\n–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –¥—Ä—É–≥–∏–º–∏ –¢–ö:\n\n–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç –¥—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞—Å—á–µ—Ç–∞"
}