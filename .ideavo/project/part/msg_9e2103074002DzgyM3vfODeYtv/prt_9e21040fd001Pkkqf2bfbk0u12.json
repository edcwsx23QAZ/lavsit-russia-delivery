{
  "id": "prt_9e21040fd001Pkkqf2bfbk0u12",
  "messageID": "msg_9e2103074002DzgyM3vfODeYtv",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "edit",
  "callID": "toolu_01NttGpg4Q8Ls77pCv6R7iH3",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx",
      "oldString": "    } else if (calc.company === 'СДЭК' && calc.details) {\n      if (calc.details.services && calc.details.services.length > 0) {\n        calc.details.services.forEach((service: any) => {\n          details.push({\n            service: service.code || service.name || 'Услуга СДЭК',\n            description: service.name || '',\n            price: service.sum || 0\n          });\n        });\n        \n        if (calc.details.delivery_sum && calc.details.total_sum) {\n          details.push({\n            service: '─────────────────────────',\n            description: '',\n            price: 0\n          });\n          details.push({\n            service: 'Стоимость доставки',\n            description: 'Перевозка',\n            price: calc.details.delivery_sum\n          });\n          if (calc.details.total_sum !== calc.details.delivery_sum) {\n            details.push({\n              service: 'Дополнительные услуги',\n              description: 'Доп. сборы',\n              price: calc.details.total_sum - calc.details.delivery_sum\n            });\n          }\n          details.push({\n            service: 'ИТОГО',\n            description: calc.details.tariff_name || 'Тариф',\n            price: calc.details.total_sum\n          });\n        }\n      } else {",
      "newString": "    } else if (calc.company === 'СДЭК' && calc.details) {\n      const cdekServiceNames: Record<string, string> = {\n        'INSURANCE': 'Страхование груза',\n        'HEAVY_CARGO': 'Тяжеловесный груз',\n        'DELIVERY_TO_DOOR': 'Доставка до двери',\n        'PICKUP_FROM_SENDER': 'Забор от отправителя',\n        'PACKAGE': 'Упаковка',\n        'TRYING_ON': 'Примерка на дому',\n        'PART_DELIVERY': 'Частичная доставка'\n      };\n\n      if (calc.details.services && calc.details.services.length > 0) {\n        calc.details.services.forEach((service: any) => {\n          const serviceName = cdekServiceNames[service.code] || service.code || 'Услуга СДЭК';\n          const servicePrice = service.total_sum || service.sum || 0;\n          \n          if (servicePrice > 0) {\n            details.push({\n              service: serviceName,\n              description: service.code === 'HEAVY_CARGO' \n                ? `Сбор за габаритный груз (расчетный вес: ${(calc.details.weight_calc / 1000).toFixed(0)} кг)`\n                : service.code === 'INSURANCE'\n                ? `Объявленная стоимость: ${form.declaredValue?.toLocaleString() || 0} ₽`\n                : '',\n              price: servicePrice\n            });\n          }\n        });\n        \n        if (calc.details.delivery_sum && calc.details.total_sum) {\n          details.push({\n            service: '─────────────────────────',\n            description: '',\n            price: 0\n          });\n          details.push({\n            service: 'Стоимость доставки',\n            description: calc.details.tariff_name || 'Перевозка',\n            price: Math.round(calc.details.delivery_sum)\n          });\n          \n          const additionalSum = calc.details.services.reduce((sum: number, s: any) => \n            sum + (s.total_sum || s.sum || 0), 0\n          );\n          \n          if (additionalSum > 0) {\n            details.push({\n              service: 'Дополнительные услуги',\n              description: 'Доп. сборы',\n              price: Math.round(additionalSum)\n            });\n          }\n          \n          details.push({\n            service: 'ИТОГО',\n            description: 'К оплате',\n            price: Math.round(calc.details.total_sum)\n          });\n        }\n      } else {"
    },
    "output": "",
    "metadata": {
      "diagnostics": {},
      "diff": "Index: /home/user/project/app/page.tsx\n===================================================================\n--- /home/user/project/app/page.tsx\n+++ /home/user/project/app/page.tsx\n@@ -3859,15 +3859,34 @@\n       });\n     }\n   });\n } else if (calc.company === 'СДЭК' && calc.details) {\n+  const cdekServiceNames: Record<string, string> = {\n+    'INSURANCE': 'Страхование груза',\n+    'HEAVY_CARGO': 'Тяжеловесный груз',\n+    'DELIVERY_TO_DOOR': 'Доставка до двери',\n+    'PICKUP_FROM_SENDER': 'Забор от отправителя',\n+    'PACKAGE': 'Упаковка',\n+    'TRYING_ON': 'Примерка на дому',\n+    'PART_DELIVERY': 'Частичная доставка'\n+  };\n+\n   if (calc.details.services && calc.details.services.length > 0) {\n     calc.details.services.forEach((service: any) => {\n-      details.push({\n-        service: service.code || service.name || 'Услуга СДЭК',\n-        description: service.name || '',\n-        price: service.sum || 0\n-      });\n+      const serviceName = cdekServiceNames[service.code] || service.code || 'Услуга СДЭК';\n+      const servicePrice = service.total_sum || service.sum || 0;\n+      \n+      if (servicePrice > 0) {\n+        details.push({\n+          service: serviceName,\n+          description: service.code === 'HEAVY_CARGO' \n+            ? `Сбор за габаритный груз (расчетный вес: ${(calc.details.weight_calc / 1000).toFixed(0)} кг)`\n+            : service.code === 'INSURANCE'\n+            ? `Объявленная стоимость: ${form.declaredValue?.toLocaleString() || 0} ₽`\n+            : '',\n+          price: servicePrice\n+        });\n+      }\n     });\n     \n     if (calc.details.delivery_sum && calc.details.total_sum) {\n       details.push({\n@@ -3876,22 +3895,28 @@\n         price: 0\n       });\n       details.push({\n         service: 'Стоимость доставки',\n-        description: 'Перевозка',\n-        price: calc.details.delivery_sum\n+        description: calc.details.tariff_name || 'Перевозка',\n+        price: Math.round(calc.details.delivery_sum)\n       });\n-      if (calc.details.total_sum !== calc.details.delivery_sum) {\n+      \n+      const additionalSum = calc.details.services.reduce((sum: number, s: any) => \n+        sum + (s.total_sum || s.sum || 0), 0\n+      );\n+      \n+      if (additionalSum > 0) {\n         details.push({\n           service: 'Дополнительные услуги',\n           description: 'Доп. сборы',\n-          price: calc.details.total_sum - calc.details.delivery_sum\n+          price: Math.round(additionalSum)\n         });\n       }\n+      \n       details.push({\n         service: 'ИТОГО',\n-        description: calc.details.tariff_name || 'Тариф',\n-        price: calc.details.total_sum\n+        description: 'К оплате',\n+        price: Math.round(calc.details.total_sum)\n       });\n     }\n   } else {\n     details.push({\n"
    },
    "title": "app/page.tsx",
    "time": {
      "start": 1760434351465,
      "end": 1760434351487
    }
  }
}