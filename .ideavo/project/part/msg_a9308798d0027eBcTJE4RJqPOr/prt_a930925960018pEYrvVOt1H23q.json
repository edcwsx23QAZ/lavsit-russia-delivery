{
  "id": "prt_a930925960018pEYrvVOt1H23q",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "messageID": "msg_a9308798d0027eBcTJE4RJqPOr",
  "type": "tool",
  "callID": "call_13761643",
  "tool": "write",
  "state": {
    "status": "completed",
    "input": {
      "content": "'use client';\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport {\n  FileText,\n  RefreshCw,\n  Code,\n  Settings,\n  Truck,\n  Database,\n  Globe,\n  AlertTriangle,\n  CheckCircle,\n  Clock\n} from 'lucide-react';\n\ninterface DocumentationBlock {\n  id: string;\n  title: string;\n  type: 'function' | 'component' | 'api' | 'logic' | 'data';\n  description: string;\n  code?: string;\n  dependencies?: string[];\n  relatedFiles?: string[];\n  apiEndpoints?: string[];\n  lastModified?: Date;\n}\n\ninterface ChangeRecord {\n  id: string;\n  timestamp: Date;\n  type: 'added' | 'modified' | 'deleted';\n  impact: 'low' | 'medium' | 'high';\n  description: string;\n  affectedFunctions: string[];\n  files: string[];\n}\n\nconst TechnicalDocumentation: React.FC = () => {\n  const [documentation, setDocumentation] = useState<DocumentationBlock[]>([]);\n  const [changes, setChanges] = useState<ChangeRecord[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [lastAnalysis, setLastAnalysis] = useState<Date | null>(null);\n  const [activeTab, setActiveTab] = useState('overview');\n\n  // Load saved documentation and changes\n  useEffect(() => {\n    try {\n      const savedDocs = localStorage.getItem('technicalDocumentation');\n      const savedChanges = localStorage.getItem('documentationChanges');\n      const savedLastAnalysis = localStorage.getItem('lastDocumentationAnalysis');\n\n      if (savedDocs) {\n        const parsed = JSON.parse(savedDocs);\n        setDocumentation(parsed.map((doc: any) => ({\n          ...doc,\n          lastModified: doc.lastModified ? new Date(doc.lastModified) : undefined\n        })));\n      }\n\n      if (savedChanges) {\n        const parsed = JSON.parse(savedChanges);\n        setChanges(parsed.map((change: any) => ({\n          ...change,\n          timestamp: new Date(change.timestamp)\n        })));\n      }\n\n      if (savedLastAnalysis) {\n        setLastAnalysis(new Date(savedLastAnalysis));\n      }\n    } catch (error) {\n      console.error('Error loading documentation:', error);\n    }\n  }, []);\n\n  const analyzeApplication = useCallback(async () => {\n    setLoading(true);\n\n    try {\n      // Get git changes since last analysis\n      const changesResponse = await fetch('/api/run-tests?analyze=true', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          action: 'analyze_changes',\n          since: lastAnalysis?.toISOString()\n        })\n      });\n\n      let newChanges: ChangeRecord[] = [];\n      if (changesResponse.ok) {\n        const changesData = await changesResponse.json();\n        newChanges = changesData.changes || [];\n      }\n\n      // Generate comprehensive documentation\n      const docs: DocumentationBlock[] = [\n        // Core Functions\n        {\n          id: 'calculatePEK',\n          title: 'Функция расчета доставки ПЭК (calculatePEK)',\n          type: 'function',\n          description: `Основная функция расчета стоимости и сроков доставки для транспортной компании ПЭК.\n          \n**Назначение:** Выполняет полный цикл расчета доставки от получения данных формы до возврата результата.\n\n**Алгоритм работы:**\n1. Валидация входных данных (города, грузы, веса)\n2. Получение зоны доставки через API findzonebyaddress\n3. Расчет стоимости через API calculator\n4. Обработка ошибок и возврат результата\n\n**Параметры:**\n- form: DeliveryForm - данные формы доставки\n- Возвращает: Promise<CalculationResult>\n\n**Обработка ошибок:**\n- ZONE_NOT_SERVED - зона не обслуживается\n- INVALID_CREDENTIALS - неверные учетные данные\n- NETWORK_ERROR - проблемы с сетью\n\n**Связанные файлы:**\n- app/page.tsx:2368-2500 (основная логика)\n- app/api/pek/route.ts (API обработчик)\n- lib/api-utils.ts (утилиты API)`,\n          code: `const calculatePEK = async (): Promise<CalculationResult> => {\n  // Валидация данных\n  validateMultipleCargos(form.cargos);\n  \n  // Получение зоны доставки\n  const zoneData = await getPekZoneByAddress(fromAddress, toAddress);\n  \n  // Расчет через API\n  const result = await enhancedApiRequest('/api/pek', {\n    method: 'POST',\n    body: JSON.stringify(requestData)\n  }, { operation: 'calculate', company: 'ПЭК' });\n  \n  return processPekResult(result);\n};`,\n          dependencies: ['enhancedApiRequest', 'validateMultipleCargos', 'getPekZoneByAddress'],\n          relatedFiles: ['app/page.tsx', 'app/api/pek/route.ts', 'lib/api-utils.ts'],\n          apiEndpoints: ['/api/pek'],\n          lastModified: new Date()\n        },\n\n        {\n          id: 'calculateVozovoz',\n          title: 'Функция расчета доставки Возовоз (calculateVozovoz)',\n          type: 'function',\n          description: `Функция расчета стоимости доставки для транспортной компании Возовоз.\n          \n**Особенности:**\n- Использует API 2.5 Vozovoz\n- Поддерживает множественные грузы\n- Учитывает страхование и упаковку\n- Максимальные габариты одного места\n\n**Структура запроса:**\n\\`\\`\\`json\n{\n  \"object\": \"price\",\n  \"action\": \"get\",\n  \"params\": {\n    \"cargo\": {\n      \"dimension\": {\n        \"max\": { \"length\": 0.5, \"width\": 0.3, \"height\": 0.2, \"weight\": 15 },\n        \"quantity\": 2,\n        \"volume\": 0.03,\n        \"weight\": 15\n      },\n      \"insurance\": 10000,\n      \"wrapping\": { \"hardPackageVolume\": 0.03 }\n    },\n    \"gateway\": {\n      \"dispatch\": { \"point\": { \"location\": \"Москва\", \"terminal\": \"default\" } },\n      \"destination\": { \"point\": { \"location\": \"СПб\", \"terminal\": \"default\" } }\n    }\n  }\n}\n\\`\\`\\`\n\n**Текущие проблемы:**\n- Токен устарел: \\`sBDUaEmzVBO6syQWHvHxmjxJQiON2BZplQaqrU3N\\`\n- Возвращает HTML вместо JSON при ошибке авторизации`,\n          dependencies: ['enhancedApiRequest', 'validateMultipleCargos'],\n          relatedFiles: ['app/page.tsx', 'app/api/vozovoz/route.ts'],\n          apiEndpoints: ['/api/vozovoz'],\n          lastModified: new Date()\n        },\n\n        {\n          id: 'enhancedApiRequest',\n          title: 'Улучшенный API клиент (enhancedApiRequest)',\n          type: 'function',\n          description: `Универсальный клиент для выполнения HTTP запросов с расширенной обработкой ошибок.\n          \n**Функциональность:**\n- Таймауты и повторные попытки\n- Кеширование ответов\n- Детальное логирование\n- Обработка различных типов ошибок\n- Performance monitoring\n\n**Параметры:**\n- url: string - URL для запроса\n- options: RequestInit - опции fetch\n- context: { operation: string, company?: string } - контекст для логирования\n- retryConfig?: конфигурация повторных попыток\n\n**Особенности:**\n- Использует apiRequestWithTimeout для базовой функциональности\n- Добавляет кеш-ключ на основе тела запроса\n- Логирует все операции в PerformanceMonitor`,\n          code: `export async function enhancedApiRequest(\n  url: string,\n  options: RequestInit = {},\n  context: { operation: string; company?: string },\n  retryConfig?: Partial<{ maxRetries: number; baseDelay: number }>\n) {\n  const cacheKey = \\`\\${context.company || 'unknown'}_\\${context.operation}_\\${JSON.stringify(options.body || {})}\\`;\n  \n  return apiRequestWithErrorHandling(\n    url, options, context, retryConfig, cacheKey\n  );\n}`,\n          dependencies: ['apiRequestWithTimeout', 'PerformanceMonitor'],\n          relatedFiles: ['lib/api-utils.ts', 'lib/error-handling.ts'],\n          lastModified: new Date()\n        },\n\n        // Components\n        {\n          id: 'page_tsx',\n          title: 'Главная страница приложения (page.tsx)',\n          type: 'component',\n          description: `Основной компонент приложения - форма расчета доставки.\n          \n**Структура:**\n- Левая панель: форма ввода (каталог товаров, грузы)\n- Правая панель: результаты расчета, 3D визуализация\n- Верхняя панель: кнопки диагностики и управления\n\n**Основные функции:**\n- Управление товарами (ProductSearch, ProductManager)\n- Форма доставки с множественными грузами\n- Расчет стоимости у всех ТК параллельно\n- 3D визуализация грузов в кузове\n- Сохранение/восстановление данных\n\n**Состояние формы:**\n\\`\\`\\`typescript\ninterface DeliveryForm {\n  cargos: Cargo[];\n  fromCity: string;\n  toCity: string;\n  fromAddress: string;\n  toAddress: string;\n  declaredValue: number;\n  needPackaging: boolean;\n  needInsurance: boolean;\n  selectedProducts: ProductInForm[];\n}\n\\`\\`\\`\n\n**Ключевые обработчики:**\n- handleProductAdd - добавление товара из каталога\n- handleCalculation - запуск расчета у всех ТК\n- saveFormData/loadFormData - сохранение состояния`,\n          dependencies: ['ProductSearch', 'ProductManager', 'TruckVisualization', 'enhancedApiRequest'],\n          relatedFiles: ['app/page.tsx', 'lib/form-storage.ts', 'lib/furniture-utils.ts'],\n          lastModified: new Date()\n        },\n\n        {\n          id: 'truck_visualization',\n          title: '3D визуализация грузов (TruckVisualization)',\n          type: 'component',\n          description: `Компонент для трехмерной визуализации размещения грузов в кузове автомобиля.\n          \n**Функциональность:**\n- Отображение грузов как 3D объектов\n- Автоматическое позиционирование\n- Масштабирование и вращение камеры\n- Цветовая индикация типов грузов\n\n**Технологии:**\n- Three.js для 3D рендеринга\n- React Three Fiber для интеграции с React\n- Автоматический расчет позиций\n\n**Параметры:**\n- cargos: массив грузов с размерами\n- isVisible: boolean - показывать ли визуализацию\n\n**Особенности:**\n- Грузы отображаются как параллелепипеды\n- Разные цвета для разных товаров\n- Автоматическая укладка в оптимальном порядке`,\n          dependencies: ['@react-three/fiber', '@react-three/drei', 'three'],\n          relatedFiles: ['components/TruckVisualization.tsx'],\n          lastModified: new Date()\n        },\n\n        // API Documentation\n        {\n          id: 'pek_api',\n          title: 'API ПЭК',\n          type: 'api',\n          description: `Интеграция с транспортной компанией ПЭК.\n          \n**Эндпоинты:**\n- \\`/api/pek\\` - основной эндпоинт для расчетов\n\n**Методы:**\n- \\`findzonebyaddress\\` - определение зоны доставки\n- \\`calculator\\` - расчет стоимости и сроков\n\n**Аутентификация:**\n- Basic Auth с логином/паролем\n- Текущие credentials: \\`PEK_LOGIN\\` / \\`PEK_API_KEY\\`\n\n**Формат запроса:**\n\\`\\`\\`json\n{\n  \"method\": \"calculator\",\n  \"params\": {\n    \"from\": \"Москва\",\n    \"to\": \"Санкт-Петербург\",\n    \"weight\": 10,\n    \"volume\": 0.1,\n    \"declaredValue\": 50000\n  }\n}\n\\`\\`\\`\n\n**Формат ответа:**\n\\`\\`\\`json\n{\n  \"success\": true,\n  \"price\": 1250,\n  \"days\": 2,\n  \"zone\": \"Москва-Петербург\"\n}\n\\`\\`\\``,\n          apiEndpoints: ['/api/pek'],\n          relatedFiles: ['app/api/pek/route.ts'],\n          lastModified: new Date()\n        },\n\n        {\n          id: 'vozovoz_api',\n          title: 'API Возовоз (версия 2.5)',\n          type: 'api',\n          description: `Интеграция с транспортной компанией Возовоз.\n          \n**Эндпоинт:** \\`/api/vozovoz\\`\n\n**Аутентификация:**\n- Token-based: \\`Authorization: Bearer {token}\\`\n- Текущий токен: \\`sBDUaEmzVBO6syQWHvHxmjxJQiON2BZplQaqrU3N\\`\n\n**Основные объекты:**\n- \\`price\\` - расчет стоимости\n- \\`order\\` - оформление заказа\n- \\`terminal\\` - информация о терминалах\n\n**Структура груза:**\n\\`\\`\\`json\n{\n  \"cargo\": {\n    \"dimension\": {\n      \"max\": {\n        \"length\": 0.5,  // в метрах\n        \"width\": 0.3,\n        \"height\": 0.2,\n        \"weight\": 15    // в кг\n      },\n      \"quantity\": 2,    // количество мест\n      \"volume\": 0.03,   // общий объем м³\n      \"weight\": 15      // общий вес кг\n    },\n    \"insurance\": 10000,  // страхование\n    \"wrapping\": {        // упаковка\n      \"hardPackageVolume\": 0.03\n    }\n  }\n}\n\\`\\`\\`\n\n**Проблемы:**\n- Токен возвращает HTML вместо JSON\n- Вероятно, токен устарел или API изменился`,\n          apiEndpoints: ['/api/vozovoz'],\n          relatedFiles: ['app/api/vozovoz/route.ts', 'vozovoz-docs/'],\n          lastModified: new Date()\n        },\n\n        // Data Management\n        {\n          id: 'form_storage',\n          title: 'Система хранения данных формы',\n          type: 'logic',\n          description: `Комплексная система сохранения и восстановления состояния формы доставки.\n          \n**Функции:**\n- \\`saveFormData()\\` - сохранение в localStorage\n- \\`loadFormData()\\` - загрузка из localStorage\n- \\`createDebouncedSaver()\\` - отложенное сохранение\n- \\`clearFormData()\\` - очистка данных\n\n**Особенности:**\n- Автоматическое сохранение при изменениях\n- Debounced сохранение (500ms задержка)\n- Восстановление при перезагрузке страницы\n- Backup система для восстановления\n\n**Структура данных:**\n\\`\\`\\`typescript\ninterface StoredFormData {\n  form: DeliveryForm;\n  enabledCompanies: { [key: string]: boolean };\n  lastSaved: string;\n  version: string;\n}\n\\`\\`\\`\n\n**Механизм backup:**\n- Сохраняются последние 3 версии\n- Автоматическое восстановление при сбое\n- Предупреждение пользователя о несохраненных изменениях`,\n          dependencies: ['localStorage', 'JSON'],\n          relatedFiles: ['lib/form-storage.ts'],\n          lastModified: new Date()\n        },\n\n        {\n          id: 'product_management',\n          title: 'Управление товарами и мебелью',\n          type: 'logic',\n          description: `Система управления каталогом товаров и их добавлением в доставку.\n          \n**Компоненты:**\n- \\`ProductSearch\\` - поиск товаров в Google Sheets\n- \\`ProductManager\\` - управление добавленными товарами\n- \\`createCargosForProduct\\` - создание грузов из товаров\n\n**Источники данных:**\n- Google Sheets: \\`1e0P91PfGKVIuSWDY0ceWkIE7jD-vzD_xrIesBeQno1Y\\`\n- Локальный кеш товаров\n- Автоматическое обновление данных\n\n**Алгоритм создания грузов:**\n1. Получение размеров товара из базы\n2. Расчет количества упаковок\n3. Создание отдельных грузовых мест\n4. Связывание с товаром для отслеживания\n\n**Особенности:**\n- Поддержка множественных товаров\n- Автоматический расчет габаритов\n- Связи между товарами и грузовыми местами\n- Кеширование для производительности`,\n          dependencies: ['Google Sheets API', 'ProductSearch', 'ProductManager'],\n          relatedFiles: ['lib/furniture-utils.ts', 'components/ProductSearch.tsx', 'components/ProductManager.tsx'],\n          lastModified: new Date()\n        }\n      ];\n\n      setDocumentation(docs);\n      setChanges(prev => [...newChanges, ...prev]);\n      setLastAnalysis(new Date());\n\n      // Save to localStorage\n      localStorage.setItem('technicalDocumentation', JSON.stringify(docs));\n      localStorage.setItem('documentationChanges', JSON.stringify([...newChanges, ...changes]));\n      localStorage.setItem('lastDocumentationAnalysis', new Date().toISOString());\n\n    } catch (error) {\n      console.error('Error analyzing application:', error);\n    } finally {\n      setLoading(false);\n    }\n  }, [lastAnalysis, changes]);\n\n  const getTypeIcon = (type: string) => {\n    switch (type) {\n      case 'function': return <Code className=\"h-4 w-4\" />;\n      case 'component': return <Settings className=\"h-4 w-4\" />;\n      case 'api': return <Globe className=\"h-4 w-4\" />;\n      case 'logic': return <Database className=\"h-4 w-4\" />;\n      case 'data': return <FileText className=\"h-4 w-4\" />;\n      default: return <FileText className=\"h-4 w-4\" />;\n    }\n  };\n\n  const getTypeColor = (type: string) => {\n    switch (type) {\n      case 'function': return 'bg-blue-500';\n      case 'component': return 'bg-green-500';\n      case 'api': return 'bg-purple-500';\n      case 'logic': return 'bg-orange-500';\n      case 'data': return 'bg-gray-500';\n      default: return 'bg-gray-500';\n    }\n  };\n\n  const getImpactColor = (impact: string) => {\n    switch (impact) {\n      case 'high': return 'text-red-400';\n      case 'medium': return 'text-yellow-400';\n      case 'low': return 'text-green-400';\n      default: return 'text-gray-400';\n    }\n  };\n\n  const functions = documentation.filter(doc => doc.type === 'function');\n  const components = documentation.filter(doc => doc.type === 'component');\n  const apis = documentation.filter(doc => doc.type === 'api');\n  const logic = documentation.filter(doc => doc.type === 'logic');\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-white mb-2\">Техническая документация</h2>\n          <p className=\"text-gray-400\">\n            Автоматически сгенерированная документация приложения\n            {lastAnalysis && (\n              <span className=\"ml-2 text-sm\">\n                (последний анализ: {lastAnalysis.toLocaleString('ru-RU')})\n              </span>\n            )}\n          </p>\n        </div>\n        <Button\n          onClick={analyzeApplication}\n          disabled={loading}\n          className=\"bg-blue-600 hover:bg-blue-700\"\n        >\n          {loading ? (\n            <>\n              <RefreshCw className=\"h-4 w-4 mr-2 animate-spin\" />\n              Анализ...\n            </>\n          ) : (\n            <>\n              <RefreshCw className=\"h-4 w-4 mr-2\" />\n              Обновить\n            </>\n          )}\n        </Button>\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-3 bg-gray-800 border-gray-700\">\n          <TabsTrigger value=\"overview\" className=\"text-white\">\n            Обзор ({documentation.length})\n          </TabsTrigger>\n          <TabsTrigger value=\"details\" className=\"text-white\">\n            Детали\n          </TabsTrigger>\n          <TabsTrigger value=\"changes\" className=\"text-white\">\n            Изменения ({changes.length})\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"overview\" className=\"mt-6\">\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\n            <Card className=\"bg-gray-800 border-gray-700\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center gap-2\">\n                  <Code className=\"h-5 w-5 text-blue-500\" />\n                  <div>\n                    <p className=\"text-2xl font-bold text-white\">{functions.length}</p>\n                    <p className=\"text-sm text-gray-400\">Функций</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"bg-gray-800 border-gray-700\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center gap-2\">\n                  <Settings className=\"h-5 w-5 text-green-500\" />\n                  <div>\n                    <p className=\"text-2xl font-bold text-white\">{components.length}</p>\n                    <p className=\"text-sm text-gray-400\">Компонентов</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"bg-gray-800 border-gray-700\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center gap-2\">\n                  <Globe className=\"h-5 w-5 text-purple-500\" />\n                  <div>\n                    <p className=\"text-2xl font-bold text-white\">{apis.length}</p>\n                    <p className=\"text-sm text-gray-400\">API</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"bg-gray-800 border-gray-700\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center gap-2\">\n                  <Database className=\"h-5 w-5 text-orange-500\" />\n                  <div>\n                    <p className=\"text-2xl font-bold text-white\">{logic.length}</p>\n                    <p className=\"text-sm text-gray-400\">Логика</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          <div className=\"grid gap-4\">\n            {documentation.slice(0, 10).map((doc) => (\n              <Card key={doc.id} className=\"bg-gray-800 border-gray-700\">\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      {getTypeIcon(doc.type)}\n                      <CardTitle className=\"text-white text-lg\">{doc.title}</CardTitle>\n                    </div>\n                    <Badge className={`${getTypeColor(doc.type)} text-white`}>\n                      {doc.type}\n                    </Badge>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <ScrollArea className=\"h-32\">\n                    <div className=\"text-gray-300 text-sm whitespace-pre-wrap\">\n                      {doc.description.length > 300\n                        ? doc.description.substring(0, 300) + '...'\n                        : doc.description\n                      }\n                    </div>\n                  </ScrollArea>\n                  {doc.relatedFiles && doc.relatedFiles.length > 0 && (\n                    <div className=\"mt-3 flex flex-wrap gap-1\">\n                      {doc.relatedFiles.slice(0, 3).map((file, idx) => (\n                        <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n                          {file}\n                        </Badge>\n                      ))}\n                      {doc.relatedFiles.length > 3 && (\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          +{doc.relatedFiles.length - 3}\n                        </Badge>\n                      )}\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"details\" className=\"mt-6\">\n          <Tabs defaultValue=\"functions\" className=\"w-full\">\n            <TabsList className=\"grid w-full grid-cols-4 bg-gray-700\">\n              <TabsTrigger value=\"functions\">Функции ({functions.length})</TabsTrigger>\n              <TabsTrigger value=\"components\">Компоненты ({components.length})</TabsTrigger>\n              <TabsTrigger value=\"apis\">API ({apis.length})</TabsTrigger>\n              <TabsTrigger value=\"logic\">Логика ({logic.length})</TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"functions\" className=\"mt-4\">\n              <div className=\"space-y-4\">\n                {functions.map((doc) => (\n                  <Card key={doc.id} className=\"bg-gray-800 border-gray-700\">\n                    <CardHeader>\n                      <CardTitle className=\"text-white flex items-center gap-2\">\n                        {getTypeIcon(doc.type)}\n                        {doc.title}\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                      <ScrollArea className=\"h-64\">\n                        <div className=\"text-gray-300 whitespace-pre-wrap\">\n                          {doc.description}\n                        </div>\n                      </ScrollArea>\n\n                      {doc.code && (\n                        <div>\n                          <h4 className=\"text-white font-medium mb-2\">Пример кода:</h4>\n                          <ScrollArea className=\"h-32 bg-gray-900 rounded p-3\">\n                            <pre className=\"text-green-400 text-sm\">\n                              <code>{doc.code}</code>\n                            </pre>\n                          </ScrollArea>\n                        </div>\n                      )}\n\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        {doc.dependencies && doc.dependencies.length > 0 && (\n                          <div>\n                            <h4 className=\"text-white font-medium mb-2\">Зависимости:</h4>\n                            <div className=\"flex flex-wrap gap-1\">\n                              {doc.dependencies.map((dep, idx) => (\n                                <Badge key={idx} variant=\"outline\">{dep}</Badge>\n                              ))}\n                            </div>\n                          </div>\n                        )}\n\n                        {doc.relatedFiles && doc.relatedFiles.length > 0 && (\n                          <div>\n                            <h4 className=\"text-white font-medium mb-2\">Связанные файлы:</h4>\n                            <div className=\"flex flex-wrap gap-1\">\n                              {doc.relatedFiles.map((file, idx) => (\n                                <Badge key={idx} variant=\"outline\" className=\"text-xs\">{file}</Badge>\n                              ))}\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"components\" className=\"mt-4\">\n              <div className=\"space-y-4\">\n                {components.map((doc) => (\n                  <Card key={doc.id} className=\"bg-gray-800 border-gray-700\">\n                    <CardHeader>\n                      <CardTitle className=\"text-white flex items-center gap-2\">\n                        {getTypeIcon(doc.type)}\n                        {doc.title}\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <ScrollArea className=\"h-64\">\n                        <div className=\"text-gray-300 whitespace-pre-wrap\">\n                          {doc.description}\n                        </div>\n                      </ScrollArea>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"apis\" className=\"mt-4\">\n              <div className=\"space-y-4\">\n                {apis.map((doc) => (\n                  <Card key={doc.id} className=\"bg-gray-800 border-gray-700\">\n                    <CardHeader>\n                      <CardTitle className=\"text-white flex items-center gap-2\">\n                        {getTypeIcon(doc.type)}\n                        {doc.title}\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                      <ScrollArea className=\"h-64\">\n                        <div className=\"text-gray-300 whitespace-pre-wrap\">\n                          {doc.description}\n                        </div>\n                      </ScrollArea>\n\n                      {doc.apiEndpoints && doc.apiEndpoints.length > 0 && (\n                        <div>\n                          <h4 className=\"text-white font-medium mb-2\">Эндпоинты:</h4>\n                          <div className=\"flex flex-wrap gap-1\">\n                            {doc.apiEndpoints.map((endpoint, idx) => (\n                              <Badge key={idx} variant=\"outline\">{endpoint}</Badge>\n                            ))}\n                          </div>\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"logic\" className=\"mt-4\">\n              <div className=\"space-y-4\">\n                {logic.map((doc) => (\n                  <Card key={doc.id} className=\"bg-gray-800 border-gray-700\">\n                    <CardHeader>\n                      <CardTitle className=\"text-white flex items-center gap-2\">\n                        {getTypeIcon(doc.type)}\n                        {doc.title}\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <ScrollArea className=\"h-64\">\n                        <div className=\"text-gray-300 whitespace-pre-wrap\">\n                          {doc.description}\n                        </div>\n                      </ScrollArea>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </TabsContent>\n          </Tabs>\n        </TabsContent>\n\n        <TabsContent value=\"changes\" className=\"mt-6\">\n          <div className=\"space-y-4\">\n            {changes.length === 0 ? (\n              <Card className=\"bg-gray-800 border-gray-700\">\n                <CardContent className=\"p-6 text-center\">\n                  <Clock className=\"h-12 w-12 text-gray-500 mx-auto mb-4\" />\n                  <p className=\"text-gray-400\">Изменения не найдены</p>\n                  <p className=\"text-sm text-gray-500 mt-2\">\n                    Нажмите \"Обновить\" для анализа изменений в коде\n                  </p>\n                </CardContent>\n              </Card>\n            ) : (\n              changes.map((change) => (\n                <Card key={change.id} className=\"bg-gray-800 border-gray-700\">\n                  <CardHeader className=\"pb-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        {change.type === 'added' && <CheckCircle className=\"h-5 w-5 text-green-500\" />}\n                        {change.type === 'modified' && <RefreshCw className=\"h-5 w-5 text-blue-500\" />}\n                        {change.type === 'deleted' && <AlertTriangle className=\"h-5 w-5 text-red-500\" />}\n                        <div>\n                          <CardTitle className=\"text-white text-lg capitalize\">\n                            {change.type === 'added' ? 'Добавлено' :\n                             change.type === 'modified' ? 'Изменено' : 'Удалено'}\n                          </CardTitle>\n                          <p className=\"text-gray-400 text-sm\">\n                            {change.timestamp.toLocaleString('ru-RU')}\n                          </p>\n                        </div>\n                      </div>\n                      <Badge className={getImpactColor(change.impact)}>\n                        {change.impact === 'high' ? 'Высокий' :\n                         change.impact === 'medium' ? 'Средний' : 'Низкий'} приоритет\n                      </Badge>\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-gray-300 mb-3\">{change.description}</p>\n\n                    {change.affectedFunctions.length > 0 && (\n                      <div className=\"mb-3\">\n                        <h4 className=\"text-white font-medium mb-2\">Затрагиваемые функции:</h4>\n                        <div className=\"flex flex-wrap gap-1\">\n                          {change.affectedFunctions.map((func, idx) => (\n                            <Badge key={idx} variant=\"outline\">{func}</Badge>\n                          ))}\n                        </div>\n                      </div>\n                    )}\n\n                    {change.files.length > 0 && (\n                      <div>\n                        <h4 className=\"text-white font-medium mb-2\">Измененные файлы:</h4>\n                        <div className=\"flex flex-wrap gap-1\">\n                          {change.files.map((file, idx) => (\n                            <Badge key={idx} variant=\"outline\" className=\"text-xs\">{file}</Badge>\n                          ))}\n                        </div>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              ))\n            )}\n          </div>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n};\n\nexport default TechnicalDocumentation;",
      "filePath": "components/diagnostic/TechnicalDocumentation.tsx"
    },
    "output": "",
    "title": "components/diagnostic/TechnicalDocumentation.tsx",
    "metadata": {
      "diagnostics": {},
      "filepath": "/home/user/project/components/diagnostic/TechnicalDocumentation.tsx",
      "exists": false
    },
    "time": {
      "start": 1763403441564,
      "end": 1763403441565
    }
  }
}