{
  "id": "prt_9e314ebde001AoEqdVq0hWUPHd",
  "messageID": "msg_9e314b3f3001QVslRpwUvUSC9o",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "write",
  "callID": "call_10771911",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "components/diagnostic/SentryMonitor.tsx",
      "content": "'use client';\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport {\n  AlertTriangle,\n  CheckCircle,\n  XCircle,\n  Activity,\n  Bug,\n  Zap,\n  RefreshCw,\n  Settings,\n  Eye\n} from 'lucide-react';\nimport * as Sentry from '@sentry/nextjs';\n\ninterface ErrorEvent {\n  id: string;\n  timestamp: string;\n  message: string;\n  level: 'error' | 'warning' | 'info';\n  stack?: string;\n  url?: string;\n  userAgent?: string;\n}\n\ninterface PerformanceMetric {\n  name: string;\n  value: number;\n  unit: string;\n  timestamp: string;\n}\n\ninterface SentryMonitorProps {\n  className?: string;\n}\n\nexport default function SentryMonitor({ className }: SentryMonitorProps) {\n  const [isEnabled, setIsEnabled] = useState(false);\n  const [errors, setErrors] = useState<ErrorEvent[]>([]);\n  const [performanceMetrics, setPerformanceMetrics] = useState<PerformanceMetric[]>([]);\n  const [isCapturing, setIsCapturing] = useState(false);\n\n  useEffect(() => {\n    // Check if Sentry is configured\n    const dsn = process.env.NEXT_PUBLIC_SENTRY_DSN;\n    setIsEnabled(!!dsn);\n\n    if (dsn) {\n      // Set up error listener\n      const handleError = (event: ErrorEvent) => {\n        setErrors(prev => [event, ...prev.slice(0, 49)]); // Keep last 50 errors\n      };\n\n      // Listen for unhandled errors\n      window.addEventListener('error', (event) => {\n        handleError({\n          id: Date.now().toString(),\n          timestamp: new Date().toISOString(),\n          message: event.message,\n          level: 'error',\n          stack: event.error?.stack,\n          url: window.location.href,\n          userAgent: navigator.userAgent\n        });\n      });\n\n      // Listen for unhandled promise rejections\n      window.addEventListener('unhandledrejection', (event) => {\n        handleError({\n          id: Date.now().toString(),\n          timestamp: new Date().toISOString(),\n          message: event.reason?.message || 'Unhandled promise rejection',\n          level: 'error',\n          stack: event.reason?.stack,\n          url: window.location.href,\n          userAgent: navigator.userAgent\n        });\n      });\n    }\n  }, []);\n\n  const triggerTestError = useCallback(() => {\n    try {\n      // Trigger a test error\n      throw new Error('Test error from Sentry Monitor - this is intentional for testing');\n    } catch (error) {\n      Sentry.captureException(error);\n      console.log('Test error sent to Sentry');\n    }\n  }, []);\n\n  const triggerTestWarning = useCallback(() => {\n    // Send a test warning\n    Sentry.captureMessage('Test warning from Sentry Monitor - this is intentional for testing', 'warning');\n    console.log('Test warning sent to Sentry');\n  }, []);\n\n  const triggerPerformanceCapture = useCallback(() => {\n    setIsCapturing(true);\n\n    // Simulate performance measurement\n    const startTime = performance.now();\n\n    setTimeout(() => {\n      const endTime = performance.now();\n      const duration = endTime - startTime;\n\n      const metric: PerformanceMetric = {\n        name: 'Test Operation',\n        value: duration,\n        unit: 'ms',\n        timestamp: new Date().toISOString()\n      };\n\n      setPerformanceMetrics(prev => [metric, ...prev.slice(0, 49)]);\n\n      // Send to Sentry\n      Sentry.metrics.increment('test_operation_duration', duration, {\n        unit: 'millisecond'\n      });\n\n      setIsCapturing(false);\n    }, Math.random() * 1000 + 500);\n  }, []);\n\n  const clearErrors = useCallback(() => {\n    setErrors([]);\n  }, []);\n\n  const clearMetrics = useCallback(() => {\n    setPerformanceMetrics([]);\n  }, []);\n\n  const getErrorIcon = (level: string) => {\n    switch (level) {\n      case 'error':\n        return <XCircle className=\"h-4 w-4 text-red-500\" />;\n      case 'warning':\n        return <AlertTriangle className=\"h-4 w-4 text-yellow-500\" />;\n      case 'info':\n        return <Activity className=\"h-4 w-4 text-blue-500\" />;\n      default:\n        return <Bug className=\"h-4 w-4 text-gray-500\" />;\n    }\n  };\n\n  const getErrorBadge = (level: string) => {\n    switch (level) {\n      case 'error':\n        return <Badge variant=\"destructive\">Error</Badge>;\n      case 'warning':\n        return <Badge variant=\"secondary\" className=\"bg-yellow-500 text-white\">Warning</Badge>;\n      case 'info':\n        return <Badge variant=\"outline\">Info</Badge>;\n      default:\n        return <Badge variant=\"outline\">Unknown</Badge>;\n    }\n  };\n\n  if (!isEnabled) {\n    return (\n      <Card className={className}>\n        <CardContent className=\"flex items-center justify-center h-64\">\n          <div className=\"text-center\">\n            <Settings className=\"h-8 w-8 mx-auto mb-2 text-gray-400\" />\n            <p className=\"text-muted-foreground\">Sentry monitoring not configured</p>\n            <p className=\"text-sm text-muted-foreground mt-1\">\n              Add NEXT_PUBLIC_SENTRY_DSN to enable error tracking\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className={`space-y-6 ${className}`}>\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Activity className=\"h-5 w-5\" />\n            Sentry Error Monitoring\n          </CardTitle>\n          <CardDescription>\n            Real-time error tracking and performance monitoring\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex gap-2 mb-4\">\n            <Button onClick={triggerTestError} variant=\"destructive\" size=\"sm\">\n              <Bug className=\"h-4 w-4 mr-2\" />\n              Test Error\n            </Button>\n            <Button onClick={triggerTestWarning} variant=\"secondary\" size=\"sm\">\n              <AlertTriangle className=\"h-4 w-4 mr-2\" />\n              Test Warning\n            </Button>\n            <Button onClick={triggerPerformanceCapture} disabled={isCapturing} size=\"sm\">\n              {isCapturing ? (\n                <RefreshCw className=\"h-4 w-4 mr-2 animate-spin\" />\n              ) : (\n                <Zap className=\"h-4 w-4 mr-2\" />\n              )}\n              Test Performance\n            </Button>\n          </div>\n\n          <Tabs defaultValue=\"errors\" className=\"w-full\">\n            <TabsList className=\"grid w-full grid-cols-2\">\n              <TabsTrigger value=\"errors\" className=\"flex items-center gap-2\">\n                <Bug className=\"h-4 w-4\" />\n                Errors ({errors.length})\n              </TabsTrigger>\n              <TabsTrigger value=\"performance\" className=\"flex items-center gap-2\">\n                <Activity className=\"h-4 w-4\" />\n                Performance ({performanceMetrics.length})\n              </TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"errors\" className=\"space-y-4\">\n              <div className=\"flex justify-between items-center\">\n                <h3 className=\"text-lg font-semibold\">Recent Errors</h3>\n                <Button onClick={clearErrors} variant=\"outline\" size=\"sm\">\n                  Clear All\n                </Button>\n              </div>\n\n              {errors.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <CheckCircle className=\"h-8 w-8 mx-auto mb-2 text-green-500\" />\n                  <p>No errors captured yet</p>\n                  <p className=\"text-sm\">Trigger a test error to see monitoring in action</p>\n                </div>\n              ) : (\n                <ScrollArea className=\"h-96 w-full\">\n                  <div className=\"space-y-2\">\n                    {errors.map((error) => (\n                      <Card key={error.id} className=\"p-4\">\n                        <div className=\"flex items-start justify-between mb-2\">\n                          <div className=\"flex items-center gap-2\">\n                            {getErrorIcon(error.level)}\n                            <span className=\"font-medium\">{error.message}</span>\n                          </div>\n                          {getErrorBadge(error.level)}\n                        </div>\n\n                        <div className=\"text-sm text-muted-foreground space-y-1\">\n                          <div>Time: {new Date(error.timestamp).toLocaleString()}</div>\n                          {error.url && <div>URL: {error.url}</div>}\n                          {error.stack && (\n                            <details className=\"mt-2\">\n                              <summary className=\"cursor-pointer text-blue-600 hover:text-blue-800\">\n                                View Stack Trace\n                              </summary>\n                              <pre className=\"mt-2 text-xs bg-gray-100 p-2 rounded overflow-x-auto max-h-32\">\n                                {error.stack}\n                              </pre>\n                            </details>\n                          )}\n                        </div>\n                      </Card>\n                    ))}\n                  </div>\n                </ScrollArea>\n              )}\n            </TabsContent>\n\n            <TabsContent value=\"performance\" className=\"space-y-4\">\n              <div className=\"flex justify-between items-center\">\n                <h3 className=\"text-lg font-semibold\">Performance Metrics</h3>\n                <Button onClick={clearMetrics} variant=\"outline\" size=\"sm\">\n                  Clear All\n                </Button>\n              </div>\n\n              {performanceMetrics.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <Activity className=\"h-8 w-8 mx-auto mb-2 text-blue-500\" />\n                  <p>No performance metrics captured yet</p>\n                  <p className=\"text-sm\">Run a performance test to see metrics</p>\n                </div>\n              ) : (\n                <ScrollArea className=\"h-96 w-full\">\n                  <div className=\"space-y-2\">\n                    {performanceMetrics.map((metric, index) => (\n                      <Card key={index} className=\"p-4\">\n                        <div className=\"flex items-center justify-between mb-2\">\n                          <span className=\"font-medium\">{metric.name}</span>\n                          <div className=\"flex items-center gap-2\">\n                            <span className=\"text-lg font-bold text-blue-600\">\n                              {metric.value.toFixed(2)} {metric.unit}\n                            </span>\n                            <Badge variant=\"outline\">\n                              {new Date(metric.timestamp).toLocaleTimeString()}\n                            </Badge>\n                          </div>\n                        </div>\n                      </Card>\n                    ))}\n                  </div>\n                </ScrollArea>\n              )}\n            </TabsContent>\n          </Tabs>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Eye className=\"h-5 w-5\" />\n            Sentry Configuration Status\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid gap-4 md:grid-cols-2\">\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                <span className=\"text-sm\">Client-side DSN configured</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                <span className=\"text-sm\">Server-side DSN configured</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                <span className=\"text-sm\">Error boundary integration</span>\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                <span className=\"text-sm\">Performance monitoring enabled</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                <span className=\"text-sm\">Session replay configured</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                <span className=\"text-sm\">Source maps upload enabled</span>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}"
    },
    "output": "",
    "metadata": {
      "diagnostics": {},
      "filepath": "/home/user/project/components/diagnostic/SentryMonitor.tsx",
      "exists": false
    },
    "title": "components/diagnostic/SentryMonitor.tsx",
    "time": {
      "start": 1760451423200,
      "end": 1760451423200
    }
  }
}