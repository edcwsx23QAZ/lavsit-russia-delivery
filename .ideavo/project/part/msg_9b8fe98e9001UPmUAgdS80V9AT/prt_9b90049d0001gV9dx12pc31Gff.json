{
  "id": "prt_9b90049d0001gV9dx12pc31Gff",
  "messageID": "msg_9b8fe98e9001UPmUAgdS80V9AT",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "read",
  "callID": "toolu_01F4zvkfeWQus9qHXQdTBg7y",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/components/ServiceWorkerRegistration.tsx"
    },
    "output": "<file>\n00001| 'use client';\n00002| \n00003| import { useEffect } from 'react';\n00004| \n00005| export default function ServiceWorkerRegistration() {\n00006|   useEffect(() => {\n00007|     if ('serviceWorker' in navigator) {\n00008|       // Более надежная детекция production/development\n00009|       const isProduction = process.env.NODE_ENV === 'production' || \n00010|                           (typeof window !== 'undefined' && !window.location.hostname.includes('localhost') && \n00011|                            !window.location.hostname.includes('127.0.0.1') && \n00012|                            !window.location.hostname.includes('.e2b.app'));\n00013|       \n00014|       if (isProduction) {\n00015|         navigator.serviceWorker\n00016|           .register('/sw.js')\n00017|           .then((registration) => {\n00018|             console.log('[SW] Service Worker registered successfully:', registration);\n00019|             \n00020|             // Check for updates\n00021|             registration.addEventListener('updatefound', () => {\n00022|               const newWorker = registration.installing;\n00023|               if (newWorker) {\n00024|                 newWorker.addEventListener('statechange', () => {\n00025|                   if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {\n00026|                     console.log('[SW] New version available');\n00027|                     // Could show a notification to user about update\n00028|                   }\n00029|                 });\n00030|               }\n00031|             });\n00032|           })\n00033|           .catch((error) => {\n00034|             console.warn('[SW] Service Worker registration failed:', error);\n00035|           });\n00036| \n00037|         // Listen for messages from service worker\n00038|         navigator.serviceWorker.addEventListener('message', (event) => {\n00039|           console.log('[SW] Message from service worker:', event.data);\n00040|         });\n00041|       } else {\n00042|         // Принудительно отключаем SW в development/preview\n00043|         console.log('[SW] DEV: Принудительное отключение Service Worker');\n00044|         \n00045|         // Очищаем все кэши\n00046|         if ('caches' in window) {\n00047|           caches.keys().then(cacheNames => {\n00048|             cacheNames.forEach(cacheName => {\n00049|               caches.delete(cacheName).then(() => {\n00050|                 console.log('[SW] DEV: Кэш удален:', cacheName);\n00051|               });\n00052|             });\n00053|           });\n00054|         }\n00055|         \n00056|         // Отключаем все зарегистрированные SW\n00057|         navigator.serviceWorker.getRegistrations().then(registrations => {\n00058|           registrations.forEach(registration => {\n00059|             registration.unregister().then(() => {\n00060|               console.log('[SW] DEV: Service Worker отключен:', registration);\n00061|             });\n00062|           });\n00063|         });\n00064|         \n00065|         // Перезагружаем страницу если есть активный SW\n00066|         navigator.serviceWorker.ready.then(() => {\n00067|           if (navigator.serviceWorker.controller) {\n00068|             console.log('[SW] DEV: Обнаружен активный SW, перезагрузка страницы...');\n00069|             window.location.reload();\n00070|           }\n00071|         }).catch(() => {\n00072|           // SW не готов, это нормально в dev режиме\n00073|         });\n00074|       }\n00075|     }\n00076|   }, []);\n00077| \n00078|   return null; // This component renders nothing\n00079| }\n</file>",
    "metadata": {
      "preview": "'use client';\n\nimport { useEffect } from 'react';\n\nexport default function ServiceWorkerRegistration() {\n  useEffect(() => {\n    if ('serviceWorker' in navigator) {\n      // Более надежная детекция production/development\n      const isProduction = process.env.NODE_ENV === 'production' || \n                          (typeof window !== 'undefined' && !window.location.hostname.includes('localhost') && \n                           !window.location.hostname.includes('127.0.0.1') && \n                           !window.location.hostname.includes('.e2b.app'));\n      \n      if (isProduction) {\n        navigator.serviceWorker\n          .register('/sw.js')\n          .then((registration) => {\n            console.log('[SW] Service Worker registered successfully:', registration);\n            \n            // Check for updates"
    },
    "title": "components/ServiceWorkerRegistration.tsx",
    "time": {
      "start": 1759745428460,
      "end": 1759745428462
    }
  }
}