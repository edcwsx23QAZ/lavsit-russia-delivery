{
  "id": "prt_985f91930001RDh72fItuvIWTV",
  "messageID": "msg_985f8e20c001x1SbPqiiv2h79o",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "edit",
  "callID": "toolu_01Ksd1Yk6g5sJbSv6LNT7yHA",
  "state": {
    "status": "error",
    "input": {
      "filePath": "/home/user/project/app/page.tsx",
      "oldString": "        // Вычисляем срок доставки как разность между датами pickup и arrivalToOspReceiver\n        let deliveryDays = 0;\n        try {\n          // Более детальный поиск дат в разных местах ответа\n          console.log('=== ОТЛАДКА СРОКА ДОСТАВКИ ДЕЛОВЫЕ ЛИНИИ ===');\n          console.log('Полная структура data:', JSON.stringify(data, null, 2));\n          console.log('Структура data.data:', JSON.stringify(data.data, null, 2));\n          \n          // Ищем даты в разных возможных местах\n          const pickup = data.data?.pickup || \n                        data.pickup || \n                        data.data?.derival?.date ||\n                        data.data?.produceDate ||\n                        data.derival?.date;\n          \n          const arrivalToOspReceiver = data.data?.arrivalToOspReceiver || \n                                     data.arrivalToOspReceiver ||\n                                     data.data?.arrival?.date ||\n                                     data.arrival?.date ||\n                                     data.data?.deliveryDate;\n          \n          console.log('Найденная дата pickup:', pickup);\n          console.log('Найденная дата arrivalToOspReceiver:', arrivalToOspReceiver);\n          \n          if (pickup && arrivalToOspReceiver) {\n            const pickupDate = new Date(pickup);\n            const arrivalDate = new Date(arrivalToOspReceiver);\n            \n            console.log('Парсированная дата pickup:', pickupDate);\n            console.log('Парсированная дата arrival:', arrivalDate);\n            \n            // Проверяем, что даты валидны\n            if (!isNaN(pickupDate.getTime()) && !isNaN(arrivalDate.getTime())) {\n              // Вычисляем разность в днях\n              const timeDiff = arrivalDate.getTime() - pickupDate.getTime();\n              deliveryDays = Math.max(1, Math.ceil(timeDiff / (1000 * 3600 * 24))); // Минимум 1 день\n              \n              console.log('Разность в миллисекундах:', timeDiff);\n              console.log('ИТОГОВЫЙ срок доставки:', deliveryDays, 'дней');\n            } else {\n              console.error('Невалидные даты после парсинга');\n            }\n          } else {\n            console.warn('Не найдены даты pickup или arrivalToOspReceiver');\n            console.log('Все возможные поля дат в ответе:');\n            console.log('- data.data?.pickup:', data.data?.pickup);\n            console.log('- data.pickup:', data.pickup);\n            console.log('- data.data?.arrivalToOspReceiver:', data.data?.arrivalToOspReceiver);\n            console.log('- data.arrivalToOspReceiver:', data.arrivalToOspReceiver);\n            console.log('- data.data?.derival:', data.data?.derival);\n            console.log('- data.data?.arrival:', data.data?.arrival);\n          }\n          console.log('=== КОНЕЦ ОТЛАДКИ ===');\n        } catch (error) {\n          console.error('Ошибка вычисления срока доставки:', error);\n        }",
      "newString": "        // Вычисляем срок доставки как разность между датами pickup и arrivalToOspReceiver\n        let deliveryDays = 0;\n        try {\n          // Извлекаем точные поля из ответа API\n          const pickup = data.data?.pickup || data.pickup;\n          const arrivalToOspReceiver = data.data?.arrivalToOspReceiver || data.arrivalToOspReceiver;\n          \n          console.log('Деловые Линии - дата pickup:', pickup);\n          console.log('Деловые Линии - дата arrivalToOspReceiver:', arrivalToOspReceiver);\n          \n          if (pickup && arrivalToOspReceiver) {\n            // Парсим даты (формат может быть \"2025-09-27\" или \"2025-09-27 10:00:00\")\n            const pickupDate = new Date(pickup);\n            const arrivalDate = new Date(arrivalToOspReceiver);\n            \n            console.log('Парсированная дата pickup:', pickupDate);\n            console.log('Парсированная дата arrival:', arrivalDate);\n            \n            // Проверяем, что даты валидны\n            if (!isNaN(pickupDate.getTime()) && !isNaN(arrivalDate.getTime())) {\n              // Вычисляем разность в днях\n              const timeDiff = arrivalDate.getTime() - pickupDate.getTime();\n              deliveryDays = Math.max(1, Math.ceil(timeDiff / (1000 * 3600 * 24))); // Минимум 1 день\n              \n              console.log('Разность в миллисекундах:', timeDiff);\n              console.log('Деловые Линии - ВЫЧИСЛЕН срок доставки:', deliveryDays, 'дней');\n            } else {\n              console.error('Деловые Линии - Невалидные даты после парсинга');\n              console.error('pickup Date object:', pickupDate);\n              console.error('arrival Date object:', arrivalDate);\n            }\n          } else {\n            console.warn('Деловые Линии - Не найдены даты pickup или arrivalToOspReceiver');\n            console.log('pickup найден:', !!pickup, pickup);\n            console.log('arrivalToOspReceiver найден:', !!arrivalToOspReceiver, arrivalToOspReceiver);\n          }\n        } catch (error) {\n          console.error('Деловые Линии - Ошибка вычисления срока доставки:', error);\n        }"
    },
    "error": "Error: You must read the file /home/user/project/app/page.tsx before overwriting it. Use the Read tool first",
    "time": {
      "start": 1758889331732,
      "end": 1758889331734
    }
  }
}