{
  "id": "prt_a96d69171001A9WBaunxgXhBns",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "messageID": "msg_a96d665e5001ESXEi2gt3OKshQ",
  "type": "tool",
  "callID": "call_87480053",
  "tool": "edit",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "app/page.tsx",
      "newString": "  // –†–∞—Å—á–µ—Ç –¥–ª—è Nord Wheel\n  const calculateNordWheel = async (): Promise<CalculationResult> => {\n    const apiUrl = 'https://api.nordw.orog.ru/api/v1/calculate';\n\n    try {\n      // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      validateMultipleCargos(form.cargos);\n      \n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n      const totalVolume = form.cargos.reduce((sum, cargo) => \n        sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n      );\n\n      // üîß –î–û–ë–ê–í–õ–ï–ù–û: –†–∞—Å—á–µ—Ç –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      const maxLength = Math.max(...form.cargos.map(c => c.length));\n      const maxWidth = Math.max(...form.cargos.map(c => c.width));\n      const maxHeight = Math.max(...form.cargos.map(c => c.height));\n      \n      // üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      console.log('üåê Nord Wheel: –ê–Ω–∞–ª–∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç:');\n      console.log(`   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç: ${form.cargos.length}`);\n      console.log(`   - –û–±—â–∏–π –≤–µ—Å: ${totalWeight} –∫–≥`);\n      console.log(`   - –û–±—â–∏–π –æ–±—ä–µ–º: ${totalVolume.toFixed(3)} –º¬≥`);\n      \n      form.cargos.forEach((cargo, index) => {\n        console.log(`   üì¶ –ú–µ—Å—Ç–æ ${index + 1}:`);\n        console.log(`     - –ì–∞–±–∞—Ä–∏—Ç—ã: ${cargo.length}√ó${cargo.width}√ó${cargo.height} —Å–º`);\n        console.log(`     - –í–µ—Å: ${cargo.weight} –∫–≥`);\n        console.log(`     - –û–±—ä–µ–º: ${((cargo.length * cargo.width * cargo.height) / 1000000).toFixed(3)} –º¬≥`);\n      });\n\n      if (form.cargos.length > 1) {\n        console.log(`   üìê –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã: ${maxLength}√ó${maxWidth}√ó${maxHeight} —Å–º`);\n      }\n\n      // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è –Ω–æ–≤–æ–≥–æ API NordWheel\n      const requestData = {\n        dispatch: {\n          location: {\n            type: 'terminal',\n            city_fias: '0c5b2444-70a0-4932-980c-b4dc0d3f02b5' // –ú–æ—Å–∫–≤–∞\n          }\n        },\n        destination: {\n          location: {\n            type: 'terminal',\n            city_fias: 'c2deb16a-0330-4f05-821f-1d09c93331e6' // –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥\n          }\n        },\n        cargo: {\n          total_weight: totalWeight,\n          total_volume: totalVolume,\n          total_quantity: form.cargos.length\n        },\n        insurance: form.needInsurance && form.declaredValue ? form.declaredValue : 0,\n        insurance_refuse: !form.needInsurance,\n        services: {\n          is_package: form.needPackaging,\n          is_documents_return: false,\n          is_fragile: false\n        },\n        promocode: null\n      };\n\n      console.log('üöõ Nord Wheel –Ω–æ–≤—ã–π API –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n\n      const response = await fetch(apiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          // Add API key if available\n          ...(process.env.NORDWHEEL_API_KEY && { 'Authorization': `Bearer ${process.env.NORDWHEEL_API_KEY}` })\n        },\n        body: JSON.stringify(requestData)\n      });\n\n      if (!response.ok) {\n        console.error('‚ùå Nord Wheel API –æ—à–∏–±–∫–∞:', response.status, response.statusText);\n        return {\n          company: 'Nord Wheel',\n          price: 0,\n          days: 0,\n          error: `–û—à–∏–±–∫–∞ API: ${response.status} ${response.statusText}`,\n          apiUrl,\n          requestData\n        };\n      }\n\n      const data = await response.json();\n      console.log('üöõ Nord Wheel –Ω–æ–≤—ã–π API –æ—Ç–≤–µ—Ç:', data);\n\n      // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ –Ω–æ–≤–æ–≥–æ API\n      if (data.success) {\n        const price = data.price || 0;\n        const days = data.days || 0;\n\n        return {\n          company: 'Nord Wheel',\n          price: Math.round(price),\n          days: days,\n          details: {\n            totalCost: price,\n            deliveryCost: data.delivery_cost || 0,\n            pickupCost: data.pickup_cost || 0,\n            insuranceCost: data.insurance_cost || 0,\n            services: data.services || []\n          },\n          requestData,\n          responseData: data,\n          apiUrl\n        };\n      } else {\n        return {\n          company: 'Nord Wheel',\n          price: 0,\n          days: 0,\n          error: data.message || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ Nord Wheel - –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö',\n          requestData,\n          responseData: data,\n          apiUrl\n        };\n      }\n    } catch (error: any) {\n      console.error('üöõ Nord Wheel –æ—à–∏–±–∫–∞:', error);\n      return {\n        company: 'Nord Wheel',\n        price: 0,\n        days: 0,\n        error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n        apiUrl\n      };\n    }\n  };",
      "oldString": "  // –†–∞—Å—á–µ—Ç –¥–ª—è Nord Wheel\n  const calculateNordWheel = async (): Promise<CalculationResult> => {\n    const apiUrl = 'https://nordw.ru/tools/api/calc/calculate/';\n    \n    try {\n      // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      validateMultipleCargos(form.cargos);\n      \n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n      const totalVolume = form.cargos.reduce((sum, cargo) => \n        sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n      );\n\n      // üîß –î–û–ë–ê–í–õ–ï–ù–û: –†–∞—Å—á–µ—Ç –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      const maxLength = Math.max(...form.cargos.map(c => c.length));\n      const maxWidth = Math.max(...form.cargos.map(c => c.width));\n      const maxHeight = Math.max(...form.cargos.map(c => c.height));\n      \n      // üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n      console.log('üåê Nord Wheel: –ê–Ω–∞–ª–∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç:');\n      console.log(`   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç: ${form.cargos.length}`);\n      console.log(`   - –û–±—â–∏–π –≤–µ—Å: ${totalWeight} –∫–≥`);\n      console.log(`   - –û–±—â–∏–π –æ–±—ä–µ–º: ${totalVolume.toFixed(3)} –º¬≥`);\n      \n      form.cargos.forEach((cargo, index) => {\n        console.log(`   üì¶ –ú–µ—Å—Ç–æ ${index + 1}:`);\n        console.log(`     - –ì–∞–±–∞—Ä–∏—Ç—ã: ${cargo.length}√ó${cargo.width}√ó${cargo.height} —Å–º`);\n        console.log(`     - –í–µ—Å: ${cargo.weight} –∫–≥`);\n        console.log(`     - –û–±—ä–µ–º: ${((cargo.length * cargo.width * cargo.height) / 1000000).toFixed(3)} –º¬≥`);\n      });\n\n      if (form.cargos.length > 1) {\n        console.log(`   üìê –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã: ${maxLength}√ó${maxWidth}√ó${maxHeight} —Å–º`);\n      }\n\n      // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç–∞—Ä–æ–º—É API\n      const params = new URLSearchParams({\n        from: '91', // –ú–æ—Å–∫–≤–∞\n        to: '92', // –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥\n        pickup: form.fromAddressDelivery ? '1' : '0',\n        deliver: form.toAddressDelivery ? '1' : '0',\n        weight: totalWeight.toString(),\n        volume: totalVolume.toString(),\n        oversized: '0',\n        package: form.needPackaging ? '1' : '0',\n        packageCount: '1',\n        insurance: form.needInsurance ? '1' : '0',\n        sum: form.needInsurance && form.declaredValue ? form.declaredValue.toString() : '0',\n        documentsReturn: '0',\n        fragile: '0'\n      });\n\n      const fullUrl = `${apiUrl}?${params.toString()}`;\n      \n      console.log('üöõ Nord Wheel —Å—Ç–∞—Ä—ã–π API –∑–∞–ø—Ä–æ—Å:', fullUrl);\n\n      const response = await fetch(fullUrl, {\n        method: 'GET'\n      });\n\n      if (!response.ok) {\n        console.error('‚ùå Nord Wheel API –æ—à–∏–±–∫–∞:', response.status, response.statusText);\n        return {\n          company: 'Nord Wheel',\n          price: 0,\n          days: 0,\n          error: `–û—à–∏–±–∫–∞ API: ${response.status} ${response.statusText}`,\n          apiUrl: fullUrl,\n          requestData: params\n        };\n      }\n\n      const data = await response.json();\n      console.log('üöõ Nord Wheel —Å—Ç–∞—Ä—ã–π API –æ—Ç–≤–µ—Ç:', data);\n\n      // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ —Å—Ç–∞—Ä–æ–≥–æ API\n      if (data.status === 'success' && data.data) {\n        const price = data.data.total || data.data.price || 0;\n        const days = data.data.days || data.data.delivery_time || 0;\n\n        return {\n          company: 'Nord Wheel',\n          price: Math.round(price),\n          days: days,\n          details: {\n            totalCost: price,\n            deliveryCost: data.data.delivery_cost || 0,\n            pickupCost: data.data.pickup_cost || 0,\n            insuranceCost: data.data.insurance_cost || 0,\n            services: data.data.services || []\n          },\n          requestData: params,\n          responseData: data,\n          apiUrl: fullUrl\n        };\n      } else {\n        return {\n          company: 'Nord Wheel',\n          price: 0,\n          days: 0,\n          error: data.message || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ Nord Wheel - –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö',\n          requestData: params,\n          responseData: data,\n          apiUrl: fullUrl\n        };\n      }\n    } catch (error: any) {\n      console.error('üöõ Nord Wheel –æ—à–∏–±–∫–∞:', error);\n      return {\n        company: 'Nord Wheel',\n        price: 0,\n        days: 0,\n        error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n        apiUrl\n      };\n    }\n  };"
    },
    "output": "",
    "title": "app/page.tsx",
    "metadata": {
      "diagnostics": {},
      "diff": "Index: /home/user/project/app/page.tsx\n===================================================================\n--- /home/user/project/app/page.tsx\n+++ /home/user/project/app/page.tsx\n@@ -3404,10 +3404,10 @@\n };\n \n // –†–∞—Å—á–µ—Ç –¥–ª—è Nord Wheel\n const calculateNordWheel = async (): Promise<CalculationResult> => {\n-  const apiUrl = 'https://nordw.ru/tools/api/calc/calculate/';\n-  \n+  const apiUrl = 'https://api.nordw.orog.ru/api/v1/calculate';\n+\n   try {\n     // üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç\n     validateMultipleCargos(form.cargos);\n     \n@@ -3437,31 +3437,47 @@\n     if (form.cargos.length > 1) {\n       console.log(`   üìê –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã: ${maxLength}√ó${maxWidth}√ó${maxHeight} —Å–º`);\n     }\n \n-    // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç–∞—Ä–æ–º—É API\n-    const params = new URLSearchParams({\n-      from: '91', // –ú–æ—Å–∫–≤–∞\n-      to: '92', // –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥\n-      pickup: form.fromAddressDelivery ? '1' : '0',\n-      deliver: form.toAddressDelivery ? '1' : '0',\n-      weight: totalWeight.toString(),\n-      volume: totalVolume.toString(),\n-      oversized: '0',\n-      package: form.needPackaging ? '1' : '0',\n-      packageCount: '1',\n-      insurance: form.needInsurance ? '1' : '0',\n-      sum: form.needInsurance && form.declaredValue ? form.declaredValue.toString() : '0',\n-      documentsReturn: '0',\n-      fragile: '0'\n-    });\n+    // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è –Ω–æ–≤–æ–≥–æ API NordWheel\n+    const requestData = {\n+      dispatch: {\n+        location: {\n+          type: 'terminal',\n+          city_fias: '0c5b2444-70a0-4932-980c-b4dc0d3f02b5' // –ú–æ—Å–∫–≤–∞\n+        }\n+      },\n+      destination: {\n+        location: {\n+          type: 'terminal',\n+          city_fias: 'c2deb16a-0330-4f05-821f-1d09c93331e6' // –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥\n+        }\n+      },\n+      cargo: {\n+        total_weight: totalWeight,\n+        total_volume: totalVolume,\n+        total_quantity: form.cargos.length\n+      },\n+      insurance: form.needInsurance && form.declaredValue ? form.declaredValue : 0,\n+      insurance_refuse: !form.needInsurance,\n+      services: {\n+        is_package: form.needPackaging,\n+        is_documents_return: false,\n+        is_fragile: false\n+      },\n+      promocode: null\n+    };\n \n-    const fullUrl = `${apiUrl}?${params.toString()}`;\n-    \n-    console.log('üöõ Nord Wheel —Å—Ç–∞—Ä—ã–π API –∑–∞–ø—Ä–æ—Å:', fullUrl);\n+    console.log('üöõ Nord Wheel –Ω–æ–≤—ã–π API –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n \n-    const response = await fetch(fullUrl, {\n-      method: 'GET'\n+    const response = await fetch(apiUrl, {\n+      method: 'POST',\n+      headers: {\n+        'Content-Type': 'application/json',\n+        // Add API key if available\n+        ...(process.env.NORDWHEEL_API_KEY && { 'Authorization': `Bearer ${process.env.NORDWHEEL_API_KEY}` })\n+      },\n+      body: JSON.stringify(requestData)\n     });\n \n     if (!response.ok) {\n       console.error('‚ùå Nord Wheel API –æ—à–∏–±–∫–∞:', response.status, response.statusText);\n@@ -3469,45 +3485,45 @@\n         company: 'Nord Wheel',\n         price: 0,\n         days: 0,\n         error: `–û—à–∏–±–∫–∞ API: ${response.status} ${response.statusText}`,\n-        apiUrl: fullUrl,\n-        requestData: params\n+        apiUrl,\n+        requestData\n       };\n     }\n \n     const data = await response.json();\n-    console.log('üöõ Nord Wheel —Å—Ç–∞—Ä—ã–π API –æ—Ç–≤–µ—Ç:', data);\n+    console.log('üöõ Nord Wheel –Ω–æ–≤—ã–π API –æ—Ç–≤–µ—Ç:', data);\n \n-    // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ —Å—Ç–∞—Ä–æ–≥–æ API\n-    if (data.status === 'success' && data.data) {\n-      const price = data.data.total || data.data.price || 0;\n-      const days = data.data.days || data.data.delivery_time || 0;\n+    // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ –Ω–æ–≤–æ–≥–æ API\n+    if (data.success) {\n+      const price = data.price || 0;\n+      const days = data.days || 0;\n \n       return {\n         company: 'Nord Wheel',\n         price: Math.round(price),\n         days: days,\n         details: {\n           totalCost: price,\n-          deliveryCost: data.data.delivery_cost || 0,\n-          pickupCost: data.data.pickup_cost || 0,\n-          insuranceCost: data.data.insurance_cost || 0,\n-          services: data.data.services || []\n+          deliveryCost: data.delivery_cost || 0,\n+          pickupCost: data.pickup_cost || 0,\n+          insuranceCost: data.insurance_cost || 0,\n+          services: data.services || []\n         },\n-        requestData: params,\n+        requestData,\n         responseData: data,\n-        apiUrl: fullUrl\n+        apiUrl\n       };\n     } else {\n       return {\n         company: 'Nord Wheel',\n         price: 0,\n         days: 0,\n         error: data.message || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ Nord Wheel - –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö',\n-        requestData: params,\n+        requestData,\n         responseData: data,\n-        apiUrl: fullUrl\n+        apiUrl\n       };\n     }\n   } catch (error: any) {\n     console.error('üöõ Nord Wheel –æ—à–∏–±–∫–∞:', error);\n"
    },
    "time": {
      "start": 1763467235699,
      "end": 1763467235732
    }
  }
}