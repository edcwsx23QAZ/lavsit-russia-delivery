{
  "id": "prt_9b8a438c0001bxP3tZWkvqVoGv",
  "messageID": "msg_9b8a3d8170015cpqu0F07OpzCJ",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "read",
  "callID": "toolu_0147Nt3P5G4UGrE1KZStCiyj",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx",
      "offset": 3500,
      "limit": 500
    },
    "output": "<file>\n03501|                     <Label htmlFor=\"carry\" className=\"text-white text-xs\">Требуется подъем</Label>\n03502|                   </div>\n03503|                   \n03504|                   {form.needCarry && (\n03505|                     <div className=\"ml-6 space-y-2 border-l-2 border-gray-600 pl-3\">\n03506|                       <div>\n03507|                         <Label className=\"text-white text-xs\">Этаж</Label>\n03508|                         <Input\n03509|                           type=\"number\"\n03510|                           value={form.floor}\n03511|                           onChange={(e) => setForm(prev => ({ ...prev, floor: Number(e.target.value) }))}\n03512|                           className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n03513|                         />\n03514|                       </div>\n03515|                       <div className=\"flex items-center space-x-2\">\n03516|                         <Checkbox\n03517|                           id=\"freightLift\"\n03518|                           checked={form.hasFreightLift}\n03519|                           onCheckedChange={(checked) => setForm(prev => ({ ...prev, hasFreightLift: checked as boolean }))}\n03520|                         />\n03521|                         <Label htmlFor=\"freightLift\" className=\"text-white text-xs\">Наличие грузового лифта</Label>\n03522|                       </div>\n03523|                     </div>\n03524|                   )}\n03525|                 </div>\n03526|                 \n03527|                 <div className=\"space-y-2\">\n03528|                   <Button \n03529|                     onClick={handleCalculate} \n03530|                     className=\"w-full bg-blue-600 hover:bg-blue-700 h-8\" \n03531|                     disabled={calculating}\n03532|                   >\n03533|                     {calculating ? 'Расчет...' : 'Рассчитать'}\n03534|                   </Button>\n03535|                   \n03536|                   <Button \n03537|                     onClick={handleReset} \n03538|                     variant=\"outline\" \n03539|                     className=\"w-full h-8 text-black border-gray-600 hover:bg-gray-700 hover:text-white\" \n03540|                     disabled={calculating}\n03541|                   >\n03542|                     Сбросить расчет\n03543|                   </Button>\n03544|                 </div>\n03545|               </CardContent>\n03546|             </Card>\n03547|           </div>\n03548| \n03549|           {/* Правая часть - результаты */}\n03550|           <div className=\"space-y-3 overflow-y-auto\">\n03551|             {calculations.length > 0 && (\n03552|               <div className=\"space-y-3\">\n03553|                 <div className=\"flex justify-between items-center\">\n03554|                   <h2 className=\"text-xl font-bold text-blue-400\">Результаты расчета</h2>\n03555|                   <Button \n03556|                     onClick={exportToPDF} \n03557|                     variant=\"outline\" \n03558|                     size=\"sm\" \n03559|                     className=\"h-7 text-xs border-blue-500 text-blue-400 hover:bg-blue-900/20 print:hidden\"\n03560|                   >\n03561|                     Сохранить в PDF\n03562|                   </Button>\n03563|                 </div>\n03564|                 \n03565|                 {calculations.map((calc, index) => (\n03566|                   <Card key={index} className=\"bg-gray-800 border-gray-700\">\n03567|                     <CardHeader className=\"pb-2\">\n03568|                       <div className=\"flex justify-between items-center\">\n03569|                         <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n03570|                           <Building2 className=\"h-4 w-4\" />\n03571|                           {calc.company}\n03572|                         </CardTitle>\n03573|                         {calc.error ? (\n03574|                           <Badge variant=\"destructive\" className=\"text-xs\">Ошибка</Badge>\n03575|                         ) : (\n03576|                           <Badge variant=\"default\" className=\"bg-green-600 text-xs\">\n03577|                             {calc.price.toLocaleString()} ₽\n03578|                           </Badge>\n03579|                         )}\n03580|                       </div>\n03581|                     </CardHeader>\n03582|                     <CardContent className=\"pt-0\">\n03583|                       <div className=\"space-y-2\">\n03584|                         {calc.error ? (\n03585|                           <div className=\"space-y-2\">\n03586|                             <Alert className=\"border-red-600\">\n03587|                               <AlertDescription className=\"text-white text-xs\">{calc.error}</AlertDescription>\n03588|                             </Alert>\n03589|                             {calc.price > 0 && (\n03590|                               <>\n03591|                                 <p className=\"text-white text-xs\"><strong>Примерная стоимость:</strong> {calc.price.toLocaleString()} ₽</p>\n03592|                                 <p className=\"text-white text-xs\"><strong>Примерный срок:</strong> {calc.days} дней</p>\n03593|                               </>\n03594|                             )}\n03595|                           </div>\n03596|                         ) : (\n03597|                           <>\n03598|                             <p className=\"text-white text-xs\"><strong>Стоимость:</strong> {calc.price.toLocaleString()} ₽</p>\n03599|                             <p className=\"text-white text-xs\"><strong>Срок доставки:</strong> {calc.days} дней</p>\n03600|                           </>\n03601|                         )}\n03602|                         \n03603|                         <div className=\"flex gap-2 mt-2\">\n03604|                           {!calc.error && (\n03605|                             <Button\n03606|                               variant=\"outline\"\n03607|                               size=\"sm\"\n03608|                               onClick={() => toggleDetails(calc.company)}\n03609|                               className=\"h-6 text-xs\"\n03610|                             >\n03611|                               {expandedDetails[calc.company] ? 'Скрыть подробнее' : 'Показать подробнее'}\n03612|                             </Button>\n03613|                           )}\n03614|                           <Button\n03615|                             variant=\"outline\"\n03616|                             size=\"sm\"\n03617|                             onClick={() => toggleDebugInfo(calc.company)}\n03618|                             className=\"h-6 text-xs\"\n03619|                           >\n03620|                             {expandedDebugInfo[calc.company] ? 'Скрыть отладку' : 'Отладочная информация'}\n03621|                           </Button>\n03622|                         </div>\n03623|                         \n03624|                         {/* Детали расчета */}\n03625|                         {!calc.error && (\n03626|                           <Collapsible open={expandedDetails[calc.company]}>\n03627|                             <CollapsibleContent className=\"mt-2\">\n03628|                               <div className=\"bg-gray-900 p-3 rounded text-xs\">\n03629|                                 <h4 className=\"font-bold mb-2 text-white\">Детали расчета:</h4>\n03630|                                 {(() => {\n03631|                                   const details = parseCalculationDetails(calc);\n03632|                                   const totalPrice = details.reduce((sum, detail) => sum + detail.price, 0);\n03633|                                   \n03634|                                   return (\n03635|                                     <div className=\"space-y-1\">\n03636|                                       {details.map((detail, idx) => (\n03637|                                         <div key={idx} className=\"flex justify-between text-white\">\n03638|                                           <div>\n03639|                                             <div className=\"font-medium\">{detail.service}</div>\n03640|                                             {detail.description && (\n03641|                                               <div className=\"text-gray-400 text-xs\">{detail.description}</div>\n03642|                                             )}\n03643|                                           </div>\n03644|                                           <div className=\"font-medium\">{detail.price.toLocaleString()} ₽</div>\n03645|                                         </div>\n03646|                                       ))}\n03647|                                     </div>\n03648|                                   );\n03649|                                 })()}\n03650|                               </div>\n03651|                             </CollapsibleContent>\n03652|                           </Collapsible>\n03653|                         )}\n03654|                         \n03655|                         {/* Отладочная информация - всегда доступна */}\n03656|                         <Collapsible open={expandedDebugInfo[calc.company]}>\n03657|                           <CollapsibleContent className=\"mt-2\">\n03658|                             <div className=\"bg-gray-900 p-3 rounded text-xs\">\n03659|                               <h4 className=\"font-bold mb-2 text-white\">Отладочная информация:</h4>\n03660|                               \n03661|                               {calc.apiUrl && (\n03662|                                 <div className=\"mb-3\">\n03663|                                   <h5 className=\"font-bold mb-1 text-white\">Запрос к API:</h5>\n03664|                                   <p className=\"text-gray-300 break-all text-xs\">URL: {calc.apiUrl}</p>\n03665|                                 </div>\n03666|                               )}\n03667|                               \n03668|                               {calc.sessionId && (\n03669|                                 <div className=\"mb-3\">\n03670|                                   <h5 className=\"font-bold mb-1 text-white\">Session ID:</h5>\n03671|                                   <p className=\"text-gray-300 text-xs\">{calc.sessionId}</p>\n03672|                                 </div>\n03673|                               )}\n03674|                               \n03675|                               {calc.requestData && (\n03676|                                 <div className=\"mb-3\">\n03677|                                   <h5 className=\"font-bold mb-1 text-white\">Отправленный запрос:</h5>\n03678|                                   <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n03679|                                     {JSON.stringify(calc.requestData, null, 2)}\n03680|                                   </pre>\n03681|                                 </div>\n03682|                               )}\n03683|                               \n03684|                               {calc.responseData && (\n03685|                                 <div className=\"mb-3\">\n03686|                                   <h5 className=\"font-bold mb-1 text-white\">Полученный ответ:</h5>\n03687|                                   <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n03688|                                     {JSON.stringify(calc.responseData, null, 2)}\n03689|                                   </pre>\n03690|                                 </div>\n03691|                               )}\n03692|                               \n03693|                               {calc.details && (\n03694|                                 <div className=\"mb-3\">\n03695|                                   <h5 className=\"font-bold mb-1 text-white\">Детали расчета (JSON):</h5>\n03696|                                   <pre className=\"whitespace-pre-wrap overflow-auto max-h-32 text-gray-300 bg-gray-950 p-2 rounded text-xs\">\n03697|                                     {JSON.stringify(calc.details, null, 2)}\n03698|                                   </pre>\n03699|                                 </div>\n03700|                               )}\n03701|                               \n03702|                               {calc.error && (\n03703|                                 <div className=\"mb-3\">\n03704|                                   <h5 className=\"font-bold mb-1 text-red-400\">Информация об ошибке:</h5>\n03705|                                   <p className=\"text-red-300 text-xs\">{calc.error}</p>\n03706|                                 </div>\n03707|                               )}\n03708|                             </div>\n03709|                           </CollapsibleContent>\n03710|                         </Collapsible>\n03711|                       </div>\n03712|                     </CardContent>\n03713|                   </Card>\n03714|                 ))}\n03715|               </div>\n03716|             )}\n03717| \n03718|             {/* Визуализация кузова */}\n03719|             {calculations.length > 0 && (\n03720|               <TruckVisualization \n03721|                 cargos={form.cargos.map(cargo => ({\n03722|                   id: cargo.id,\n03723|                   length: cargo.length * 10, // Переводим см в мм\n03724|                   width: cargo.width * 10,   // Переводим см в мм\n03725|                   height: cargo.height * 10, // Переводим см в мм\n03726|                   weight: cargo.weight,\n03727|                   productName: form.selectedProducts?.find(p => \n03728|                     p.cargoIndexes.includes(form.cargos.indexOf(cargo))\n03729|                   )?.product.name\n03730|                 }))}\n03731|                 isVisible={true}\n03732|               />\n03733|             )}\n03734|             \n03735|             {/* Список подключенных ТК */}\n03736|             <Card className=\"bg-gray-800 border-gray-700\">\n03737|               <CardHeader className=\"pb-2\">\n03738|                 <CardTitle className=\"text-white text-sm\">Подключенные транспортные компании</CardTitle>\n03739|               </CardHeader>\n03740|               <CardContent>\n03741|                 <div className=\"grid grid-cols-1 gap-2\">\n03742|                   {COMPANIES_BASE.map((company, index) => {\n03743|                     const isConnected = apiStatus[company.apiKey as keyof typeof apiStatus] === 'подключено';\n03744|                     const statusText = apiStatus[company.apiKey as keyof typeof apiStatus];\n03745|                     const isEnabled = enabledCompanies[company.apiKey];\n03746|                     \n03747|                     return (\n03748|                       <div key={index} className=\"flex items-center justify-between p-2 bg-gray-700 rounded\">\n03749|                         <div className=\"flex items-center gap-2\">\n03750|                           <span className=\"text-lg\">{company.logo}</span>\n03751|                           <div>\n03752|                             <p className=\"font-medium text-white text-xs\">{company.name}</p>\n03753|                             <Badge \n03754|                               variant={isConnected ? \"default\" : \"destructive\"} \n03755|                               className=\"text-xs\"\n03756|                             >\n03757|                               {isConnected ? 'Подключена' : statusText === 'проверка...' ? 'Проверка...' : 'Ошибка'}\n03758|                             </Badge>\n03759|                           </div>\n03760|                         </div>\n03761|                         <div className=\"flex items-center gap-2\">\n03762|                           <span className=\"text-xs text-gray-300\">\n03763|                             {isEnabled ? 'Вкл' : 'Выкл'}\n03764|                           </span>\n03765|                           <Switch\n03766|                             checked={isEnabled}\n03767|                             onCheckedChange={(checked) => {\n03768|                               setEnabledCompanies(prev => ({\n03769|                                 ...prev,\n03770|                                 [company.apiKey]: checked\n03771|                               }));\n03772|                             }}\n03773|                             disabled={!isConnected}\n03774|                           />\n03775|                         </div>\n03776|                       </div>\n03777|                     );\n03778|                   })}\n03779|                 </div>\n03780|               </CardContent>\n03781|             </Card>\n03782|           </div>\n03783|         </div>\n03784|       </div>\n03785| \n03786|       {/* Автоподсказки */}\n03787|       {showSuggestions && suggestions.length > 0 && (\n03788|         <div \n03789|           className=\"fixed z-50 bg-gray-800 border border-gray-700 rounded-md shadow-lg max-w-sm w-full max-h-60 overflow-y-auto\"\n03790|           style={{\n03791|             top: suggestionPosition.top,\n03792|             left: suggestionPosition.left\n03793|           }}\n03794|         >\n03795|           <div className=\"p-1\">\n03796|             {suggestions.map((suggestion, index) => (\n03797|               <div\n03798|                 key={index}\n03799|                 className=\"p-2 hover:bg-gray-700 cursor-pointer text-xs text-white rounded transition-colors\"\n03800|                 onClick={() => selectSuggestion(suggestion)}\n03801|               >\n03802|                 {suggestion.value}\n03803|               </div>\n03804|             ))}\n03805|           </div>\n03806|         </div>\n03807|       )}\n03808|     </div>\n03809|   );\n03810| }\n</file>",
    "metadata": {
      "preview": "                    <Label htmlFor=\"carry\" className=\"text-white text-xs\">Требуется подъем</Label>\n                  </div>\n                  \n                  {form.needCarry && (\n                    <div className=\"ml-6 space-y-2 border-l-2 border-gray-600 pl-3\">\n                      <div>\n                        <Label className=\"text-white text-xs\">Этаж</Label>\n                        <Input\n                          type=\"number\"\n                          value={form.floor}\n                          onChange={(e) => setForm(prev => ({ ...prev, floor: Number(e.target.value) }))}\n                          className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n                        />\n                      </div>\n                      <div className=\"flex items-center space-x-2\">\n                        <Checkbox\n                          id=\"freightLift\"\n                          checked={form.hasFreightLift}\n                          onCheckedChange={(checked) => setForm(prev => ({ ...prev, hasFreightLift: checked as boolean }))}\n                        />"
    },
    "title": "app/page.tsx",
    "time": {
      "start": 1759739395181,
      "end": 1759739395183
    }
  }
}