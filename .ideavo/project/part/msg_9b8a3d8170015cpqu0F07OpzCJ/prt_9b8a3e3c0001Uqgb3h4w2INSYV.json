{
  "id": "prt_9b8a3e3c0001Uqgb3h4w2INSYV",
  "messageID": "msg_9b8a3d8170015cpqu0F07OpzCJ",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "read",
  "callID": "toolu_01VyW8L5bQfuQAhaeeaFaV8D",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx"
    },
    "output": "<file>\n00001| 'use client';\n00002| \n00003| import React, { useState, useEffect, useCallback } from 'react';\n00004| import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\n00005| import { Button } from '@/components/ui/button';\n00006| import { Input } from '@/components/ui/input';\n00007| import { Label } from '@/components/ui/label';\n00008| import { Checkbox } from '@/components/ui/checkbox';\n00009| import { Switch } from '@/components/ui/switch';\n00010| import { Plus, Truck, Building2, Map, Settings, Package2 } from 'lucide-react';\n00011| import { Alert, AlertDescription } from '@/components/ui/alert';\n00012| import { Badge } from '@/components/ui/badge';\n00013| import { Separator } from '@/components/ui/separator';\n00014| import { Collapsible, CollapsibleContent } from '@/components/ui/collapsible';\n00015| import ProductSearch from '@/components/ProductSearch';\n00016| import ProductManager from '@/components/ProductManager';\n00017| import TruckVisualization from '@/components/TruckVisualization';\n00018| import { FurnitureProduct, ProductInForm, CargoWithMetadata } from '@/lib/furniture-types';\n00019| import { \n00020|   createCargosForProduct, \n00021|   removeCargosForProduct, \n00022|   calculateTotalValue,\n00023|   findCargoIndexesForProduct \n00024| } from '@/lib/furniture-utils';\n00025| \n00026| interface Cargo {\n00027|   id: string;\n00028|   length: number;\n00029|   width: number;\n00030|   height: number;\n00031|   weight: number;\n00032|   // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–≤—è–∑–∏ —Å —Ç–æ–≤–∞—Ä–∞–º–∏\n00033|   productId?: string;\n00034|   placeNumber?: number;\n00035|   isFromProduct?: boolean;\n00036|   addedAt?: number;\n00037| }\n00038| \n00039| interface DeliveryForm {\n00040|   cargos: Cargo[];\n00041|   fromCity: string;\n00042|   toCity: string;\n00043|   fromAddress: string;\n00044|   toAddress: string;\n00045|   declaredValue: number;\n00046|   needPackaging: boolean;\n00047|   needLoading: boolean;\n00048|   needCarry: boolean;\n00049|   floor: number;\n00050|   hasFreightLift: boolean;\n00051|   needInsurance: boolean;\n00052|   fromTerminal: boolean;\n00053|   toTerminal: boolean;\n00054|   fromAddressDelivery: boolean;\n00055|   toAddressDelivery: boolean;\n00056|   // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ç–æ–≤–∞—Ä–æ–≤\n00057|   selectedProducts: ProductInForm[];\n00058| }\n00059| \n00060| interface CalculationResult {\n00061|   company: string;\n00062|   price: number;\n00063|   days: number;\n00064|   details?: any;\n00065|   error?: string;\n00066|   requestData?: any;\n00067|   responseData?: any;\n00068|   apiUrl?: string;\n00069|   sessionId?: string;\n00070| }\n00071| \n00072| interface AddressSuggestion {\n00073|   value: string;\n00074|   unrestricted_value: string;\n00075|   data: {\n00076|     city?: string;\n00077|     street?: string;\n00078|     house?: string;\n00079|   };\n00080| }\n00081| \n00082| // –û–ø—Ä–µ–¥–µ–ª–∏–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–º–ø–∞–Ω–∏–π\n00083| const COMPANIES_BASE = [\n00084|   { name: '–ü–≠–ö', logo: 'üöõ', apiKey: 'pek' },\n00085|   { name: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏', logo: 'üì¶', apiKey: 'dellin' },\n00086|   { name: 'Rail Continent', logo: 'üöÇ', apiKey: 'railcontinent' },\n00087|   { name: '–í–æ–∑–æ–≤–æ–∑', logo: 'üöö', apiKey: 'vozovoz' },\n00088|   { name: 'Nord Wheel', logo: 'üåê', apiKey: 'nordwheel' }\n00089| ];\n00090| \n00091| export default function Home() {\n00092|   // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n00093|   const initialFormState: DeliveryForm = {\n00094|     cargos: [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00095|     fromCity: '',\n00096|     toCity: '',\n00097|     fromAddress: '',\n00098|     toAddress: '',\n00099|     declaredValue: 0,\n00100|     needPackaging: false,\n00101|     needLoading: false,\n00102|     needCarry: false,\n00103|     floor: 1,\n00104|     hasFreightLift: false,\n00105|     needInsurance: false,\n00106|     fromTerminal: true,\n00107|     toTerminal: true,\n00108|     fromAddressDelivery: false,\n00109|     toAddressDelivery: false,\n00110|     selectedProducts: []\n00111|   };\n00112| \n00113|   const [form, setForm] = useState<DeliveryForm>(initialFormState);\n00114|   const [isLoaded, setIsLoaded] = useState(false);\n00115| \n00116|   const [suggestions, setSuggestions] = useState<AddressSuggestion[]>([]);\n00117|   const [showSuggestions, setShowSuggestions] = useState(false);\n00118|   const [activeField, setActiveField] = useState('');\n00119|   \n00120|   // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω–∏–µ–º/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n00121|   const [enabledCompanies, setEnabledCompanies] = useState<Record<string, boolean>>({\n00122|     pek: true,\n00123|     dellin: true,\n00124|     railcontinent: true,\n00125|     vozovoz: true,\n00126|     nordwheel: true\n00127|   });\n00128|   const [calculations, setCalculations] = useState<CalculationResult[]>([]);\n00129|   const [calculating, setCalculating] = useState(false);\n00130|   const [expandedDetails, setExpandedDetails] = useState<{ [key: string]: boolean }>({});\n00131|   const [expandedDebugInfo, setExpandedDebugInfo] = useState<{ [key: string]: boolean }>({});\n00132|   const [suggestionPosition, setSuggestionPosition] = useState({ top: 0, left: 0 });\n00133|   const [apiStatus, setApiStatus] = useState({\n00134|     pek: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00135|     dellin: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00136|     railcontinent: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00137|     vozovoz: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00138|     nordwheel: '–ø—Ä–æ–≤–µ—Ä–∫–∞...'\n00139|   });\n00140| \n00141|   // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)\n00142|   useEffect(() => {\n00143|     // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ\n00144|     if (typeof window !== 'undefined' && !isLoaded) {\n00145|       try {\n00146|         const saved = localStorage.getItem('deliveryForm');\n00147|         if (saved) {\n00148|           const savedForm = JSON.parse(saved);\n00149|           // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≥—Ä—É–∑\n00150|           if (!savedForm.cargos || savedForm.cargos.length === 0) {\n00151|             savedForm.cargos = [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }];\n00152|           }\n00153|           setForm(savedForm);\n00154|           console.log('–ó–∞–≥—Ä—É–∂–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã:', savedForm);\n00155|           \n00156|           // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è Supabase\n00157|           const currentTime = Math.floor(Date.now() / 1000);\n00158|           console.log('üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (timestamp):', currentTime);\n00159|           console.log('üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (ISO):', new Date().toISOString());\n00160|         }\n00161|       } catch (error) {\n00162|         console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);\n00163|         // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ\n00164|       } finally {\n00165|         setIsLoaded(true);\n00166|       }\n00167|     }\n00168|   }, [isLoaded]);\n00169| \n00170|   // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ (—Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)\n00171|   useEffect(() => {\n00172|     if (typeof window !== 'undefined' && isLoaded) {\n00173|       try {\n00174|         localStorage.setItem('deliveryForm', JSON.stringify(form));\n00175|         console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –≤ localStorage');\n00176|       } catch (error) {\n00177|         console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);\n00178|       }\n00179|     }\n00180|   }, [form, isLoaded]);\n00181| \n00182|   // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –ø—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n00183|   useEffect(() => {\n00184|     if (form.declaredValue > 0) {\n00185|       setForm(prev => ({ ...prev, needInsurance: true }));\n00186|     }\n00187|   }, [form.declaredValue]);\n00188| \n00189|   // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤\n00190|   useEffect(() => {\n00191|     const handleMessage = (event: MessageEvent) => {\n00192|       if (event.data && event.data.type === 'PRODUCTS_UPDATED') {\n00193|         console.log('üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤:', event.data.data);\n00194|         \n00195|         // –û—á–∏—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫—ç—à–∏ —Ç–æ–≤–∞—Ä–æ–≤\n00196|         const keysToRemove: string[] = [];\n00197|         for (let i = 0; i < localStorage.length; i++) {\n00198|           const key = localStorage.key(i);\n00199|           if (key && (key.startsWith('furniture_') || key.startsWith('product_') || key.includes('ProductSearch'))) {\n00200|             keysToRemove.push(key);\n00201|           }\n00202|         }\n00203|         keysToRemove.forEach(key => localStorage.removeItem(key));\n00204|         console.log(`üßΩ –û—á–∏—â–µ–Ω–æ ${keysToRemove.length} –∫–ª—é—á–µ–π –∫—ç—à–∞ —Ç–æ–≤–∞—Ä–æ–≤`);\n00205|         \n00206|         // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É ProductSearch –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è\n00207|         window.dispatchEvent(new CustomEvent('forceProductsReload', {\n00208|           detail: event.data.data\n00209|         }));\n00210|       }\n00211|     };\n00212|     \n00213|     window.addEventListener('message', handleMessage);\n00214|     \n00215|     return () => {\n00216|       window.removeEventListener('message', handleMessage);\n00217|     };\n00218|   }, []);\n00219| \n00220|   // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã\n00221|   useEffect(() => {\n00222|     if (typeof window !== 'undefined' && isLoaded) {\n00223|       checkAllAPIStatus();\n00224|     }\n00225|   }, [isLoaded]);\n00226| \n00227|   const checkAPIStatus = async (apiName: string, testFunction: () => Promise<any>) => {\n00228|     try {\n00229|       const result = await testFunction();\n00230|       if (result && !result.error) {\n00231|         setApiStatus(prev => ({ ...prev, [apiName]: '–ø–æ–¥–∫–ª—é—á–µ–Ω–æ' }));\n00232|       } else {\n00233|         setApiStatus(prev => ({ ...prev, [apiName]: '–æ—à–∏–±–∫–∞' }));\n00234|       }\n00235|     } catch (error) {\n00236|       setApiStatus(prev => ({ ...prev, [apiName]: '–æ—à–∏–±–∫–∞' }));\n00237|     }\n00238|   };\n00239| \n00240|   const checkAllAPIStatus = async () => {\n00241|     // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\n00242|     const testData = {\n00243|       fromCity: '–ú–æ—Å–∫–≤–∞',\n00244|       toCity: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', \n00245|       cargos: [{ id: '1', length: 100, width: 100, height: 100, weight: 10 }],\n00246|       declaredValue: 50000,\n00247|       fromAddressDelivery: false,\n00248|       toAddressDelivery: false,\n00249|       needPackaging: false,\n00250|       needInsurance: false\n00251|     };\n00252| \n00253|     // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n00254|     const currentForm = form;\n00255|     \n00256|     // –í—Ä–µ–º–µ–Ω–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ\n00257|     setForm({\n00258|       ...form,\n00259|       fromCity: testData.fromCity,\n00260|       toCity: testData.toCity,\n00261|       cargos: testData.cargos,\n00262|       declaredValue: testData.declaredValue,\n00263|       fromAddressDelivery: testData.fromAddressDelivery,\n00264|       toAddressDelivery: testData.toAddressDelivery,\n00265|       needPackaging: testData.needPackaging,\n00266|       needInsurance: testData.needInsurance\n00267|     });\n00268| \n00269|     // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ\n00270|     Promise.all([\n00271|       checkAPIStatus('pek', async () => {\n00272|         try {\n00273|           const response = await fetch('/api/pek', {\n00274|             method: 'POST',\n00275|             headers: { 'Content-Type': 'application/json' },\n00276|             body: JSON.stringify({ method: 'test' })\n00277|           });\n00278|           const data = await response.json();\n00279|           if (data.status === 'OK') {\n00280|             return { success: true };\n00281|           } else {\n00282|             return { error: true };\n00283|           }\n00284|         } catch (error) {\n00285|           return { error: true };\n00286|         }\n00287|       }),\n00288|       \n00289|       checkAPIStatus('dellin', async () => {\n00290|         try {\n00291|           // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ sessionID –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π (—Ç–æ—Ç –∂–µ –º–µ—Ç–æ–¥ —á—Ç–æ –≤ calculateDellin)\n00292|           const authResponse = await fetch('https://api.dellin.ru/v3/auth/login.json', {\n00293|             method: 'POST',\n00294|             headers: { 'Content-Type': 'application/json' },\n00295|             body: JSON.stringify({\n00296|               appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n00297|               login: 'service@lavsit.ru',\n00298|               password: 'edcwsx123QAZ'\n00299|             })\n00300|           });\n00301|           const authData = await authResponse.json();\n00302|           \n00303|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ –∫ sessionID –∫–∞–∫ –≤ calculateDellin\n00304|           if (authData.data?.sessionID || authData.sessionID || authData.data?.session) {\n00305|             return { success: true };\n00306|           } else {\n00307|             return { error: true };\n00308|           }\n00309|         } catch (error) {\n00310|           return { error: true };\n00311|         }\n00312|       }),\n00313|       \n00314|       checkAPIStatus('railcontinent', async () => {\n00315|         try {\n00316|           const response = await fetch('/api/rail-continent', {\n00317|             method: 'POST',\n00318|             headers: { 'Content-Type': 'application/json' },\n00319|             body: JSON.stringify({\n00320|               city_sender: testData.fromCity,\n00321|               city_receiver: testData.toCity,\n00322|               weight: 10,\n00323|               volume: 0.1,\n00324|               length: 1,\n00325|               width: 1,\n00326|               height: 1,\n00327|               declared_cost: testData.declaredValue,\n00328|               pickup: '0',\n00329|               delivery: '0',\n00330|               packaging: '0',\n00331|               insurance: '0',\n00332|               tariff: 'auto'\n00333|             })\n00334|           });\n00335|           return await response.json();\n00336|         } catch (error) {\n00337|           return { error: true };\n00338|         }\n00339|       }),\n00340|       \n00341|       checkAPIStatus('vozovoz', async () => {\n00342|         try {\n00343|           const response = await fetch('/api/vozovoz', {\n00344|             method: 'POST',\n00345|             headers: { 'Content-Type': 'application/json' },\n00346|             body: JSON.stringify({\n00347|               object: \"price\",\n00348|               action: \"get\",\n00349|               params: {\n00350|                 cargo: {\n00351|                   dimension: {\n00352|                     quantity: 1,\n00353|                     volume: 0.1,\n00354|                     weight: 10\n00355|                   }\n00356|                 },\n00357|                 gateway: {\n00358|                   dispatch: {\n00359|                     point: {\n00360|                       location: testData.fromCity,\n00361|                       terminal: \"default\"\n00362|                     }\n00363|                   },\n00364|                   destination: {\n00365|                     point: {\n00366|                       location: testData.toCity,\n00367|                       terminal: \"default\"\n00368|                     }\n00369|                   }\n00370|                 }\n00371|               }\n00372|             })\n00373|           });\n00374|           return await response.json();\n00375|         } catch (error) {\n00376|           return { error: true };\n00377|         }\n00378|       }),\n00379|       \n00380|       checkAPIStatus('nordwheel', async () => {\n00381|         try {\n00382|           const totalWeight = 10;\n00383|           const totalVolume = 0.1;\n00384|           \n00385|           const params = new URLSearchParams({\n00386|             from: '91',\n00387|             to: '92',\n00388|             pickup: '1',\n00389|             deliver: '1',\n00390|             weight: totalWeight.toString(),\n00391|             volume: totalVolume.toString(),\n00392|             oversized: '0',\n00393|             package: '1',\n00394|             packageCount: '1',\n00395|             insurance: '1',\n00396|             sum: '50000',\n00397|             documentsReturn: '0',\n00398|             fragile: '1'\n00399|           });\n00400| \n00401|           const fullUrl = `https://nordw.ru/tools/api/calc/calculate/?${params.toString()}`;\n00402|           const response = await fetch(fullUrl);\n00403|           const data = await response.json();\n00404|           \n00405|           if (response.ok && data.status === 'success') {\n00406|             return { success: true };\n00407|           } else {\n00408|             return { error: true };\n00409|           }\n00410|         } catch (error) {\n00411|           return { error: true };\n00412|         }\n00413|       })\n00414|     ]).finally(() => {\n00415|       // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n00416|       setForm(currentForm);\n00417|     });\n00418|   };\n00419| \n00420|   const searchAddresses = useCallback(async (query: string, field: string, element?: HTMLInputElement) => {\n00421|     if (query.length < 3) {\n00422|       setSuggestions([]);\n00423|       setShowSuggestions(false);\n00424|       return;\n00425|     }\n00426| \n00427|     setActiveField(field);\n00428|     \n00429|     // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ –∞–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–æ–∫\n00430|     if (element) {\n00431|       const rect = element.getBoundingClientRect();\n00432|       setSuggestionPosition({\n00433|         top: rect.bottom + window.scrollY,\n00434|         left: rect.left + window.scrollX\n00435|       });\n00436|     }\n00437|     \n00438|     try {\n00439|       const response = await fetch('https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address', {\n00440|         method: 'POST',\n00441|         headers: {\n00442|           'Content-Type': 'application/json',\n00443|           'Accept': 'application/json',\n00444|           'Authorization': 'Token eb87bbb3789bb43ed465f796892ea951f9e91008'\n00445|         },\n00446|         body: JSON.stringify({\n00447|           query: query,\n00448|           count: 10,\n00449|           // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª–µ–π –≥–æ—Ä–æ–¥–æ–≤ - —Ç–æ–ª—å–∫–æ –≥–æ—Ä–æ–¥–∞\n00450|           ...(field === 'fromCity' || field === 'toCity' ? {\n00451|             restrict_value: true,\n00452|             locations: [{\n00453|               country: '–†–æ—Å—Å–∏—è'\n00454|             }],\n00455|             from_bound: { value: 'city' },\n00456|             to_bound: { value: 'city' }\n00457|           } : {})\n00458|         })\n00459|       });\n00460| \n00461|       if (response.ok) {\n00462|         const data = await response.json();\n00463|         setSuggestions(data.suggestions || []);\n00464|         setShowSuggestions(true);\n00465|       }\n00466|     } catch (error) {\n00467|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫:', error);\n00468|     }\n00469|   }, []);\n00470| \n00471|   const debounceTimer = React.useRef<NodeJS.Timeout>();\n00472|   const handleAddressChange = (field: string, value: string, element?: HTMLInputElement) => {\n00473|     setForm(prev => ({ ...prev, [field]: value }));\n00474|     \n00475|     clearTimeout(debounceTimer.current);\n00476|     debounceTimer.current = setTimeout(() => {\n00477|       searchAddresses(value, field, element);\n00478|     }, 50);\n00479|   };\n00480| \n00481|   const selectSuggestion = (suggestion: AddressSuggestion) => {\n00482|     setForm(prev => ({ ...prev, [activeField]: suggestion.value }));\n00483|     setShowSuggestions(false);\n00484|     setSuggestions([]);\n00485|   };\n00486| \n00487|   const addCargo = () => {\n00488|     const newId = (form.cargos.length + 1).toString();\n00489|     setForm(prev => ({\n00490|       ...prev,\n00491|       cargos: [...prev.cargos, { id: newId, length: 0, width: 0, height: 0, weight: 0 }]\n00492|     }));\n00493|   };\n00494| \n00495|   const updateCargo = (id: string, field: string, value: number) => {\n00496|     setForm(prev => {\n00497|       const updatedCargos = prev.cargos.map(cargo => \n00498|         cargo.id === id ? { ...cargo, [field]: value } : cargo\n00499|       );\n00500|       \n00501|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n00502|       const cleanResult = cleanEmptyCargos(updatedCargos, prev.selectedProducts || []);\n00503|       \n00504|       return {\n00505|         ...prev,\n00506|         cargos: cleanResult.cargos,\n00507|         selectedProducts: cleanResult.products\n00508|       };\n00509|     });\n00510|   };\n00511| \n00512|   const removeCargo = (id: string) => {\n00513|     if (form.cargos.length > 1) {\n00514|       setForm(prev => ({\n00515|         ...prev,\n00516|         cargos: prev.cargos.filter(cargo => cargo.id !== id)\n00517|       }));\n00518|     }\n00519|   };\n00520| \n00521|   // üîß –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ (–≤—Å–µ –ø–æ–ª—è —Ä–∞–≤–Ω—ã 0)\n00522|   const isEmptyCargo = (cargo: Cargo) => {\n00523|     return cargo.length === 0 && cargo.width === 0 && cargo.height === 0 && cargo.weight === 0;\n00524|   };\n00525| \n00526|   // üîß –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤\n00527|   const cleanEmptyCargos = (cargos: Cargo[], selectedProducts: ProductInForm[]) => {\n00528|     // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –≥—Ä—É–∑\n00529|     const hasFilledCargos = cargos.some(cargo => !isEmptyCargo(cargo));\n00530|     \n00531|     if (!hasFilledCargos) {\n00532|       // –ï—Å–ª–∏ –Ω–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –ø—É—Å—Ç–æ–π\n00533|       return {\n00534|         cargos: cargos.length > 0 ? [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }] : [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00535|         products: selectedProducts\n00536|       };\n00537|     }\n00538| \n00539|     // –°–æ–∑–¥–∞–µ–º –º–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ä—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –∫ –Ω–æ–≤—ã–º\n00540|     const oldToNewIndexMap = new globalThis.Map<number, number>();\n00541|     let newIndex = 0;\n00542|     \n00543|     cargos.forEach((cargo, oldIndex) => {\n00544|       if (!isEmptyCargo(cargo)) {\n00545|         oldToNewIndexMap.set(oldIndex, newIndex);\n00546|         newIndex++;\n00547|       }\n00548|     });\n00549|     \n00550|     // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –≥—Ä—É–∑—ã\n00551|     const filledCargos = cargos.filter(cargo => !isEmptyCargo(cargo));\n00552|     \n00553|     // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã —É —Ç–æ–≤–∞—Ä–æ–≤\n00554|     const updatedProducts = selectedProducts.map(productItem => ({\n00555|       ...productItem,\n00556|       cargoIndexes: productItem.cargoIndexes\n00557|         .map(oldIndex => oldToNewIndexMap.get(oldIndex))\n00558|         .filter(newIdx => newIdx !== undefined) as number[]\n00559|     }));\n00560|     \n00561|     return {\n00562|       cargos: filledCargos,\n00563|       products: updatedProducts\n00564|     };\n00565|   };\n00566| \n00567|   // üîß –§—É–Ω–∫—Ü–∏—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≥—Ä—É–∑–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n00568|   interface GroupedCargoDisplay {\n00569|     length: number;\n00570|     width: number;\n00571|     height: number;\n00572|     weight: number;\n00573|     quantity: number;\n00574|     indices: number[];\n00575|     isEmpty: boolean;\n00576|   }\n00577| \n00578|   const groupCargosForDisplay = (cargos: Cargo[]): GroupedCargoDisplay[] => {\n00579|     const groups = new globalThis.Map<string, GroupedCargoDisplay>();\n00580|     \n00581|     cargos.forEach((cargo, index) => {\n00582|       const isEmpty = isEmptyCargo(cargo);\n00583|       \n00584|       // –î–ª—è –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ –Ω–µ –≥—Ä—É–ø–ø–∏—Ä—É–µ–º\n00585|       if (isEmpty) {\n00586|         groups.set(`empty_${index}`, {\n00587|           length: 0,\n00588|           width: 0,\n00589|           height: 0,\n00590|           weight: 0,\n00591|           quantity: 1,\n00592|           indices: [index],\n00593|           isEmpty: true\n00594|         });\n00595|         return;\n00596|       }\n00597|       \n00598|       // –°–æ–∑–¥–∞–µ–º –∫–ª—é—á –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –∏ –≤–µ—Å–∞\n00599|       const key = `${cargo.length}_${cargo.width}_${cargo.height}_${cargo.weight}`;\n00600|       \n00601|       if (groups.has(key)) {\n00602|         const existing = groups.get(key)!;\n00603|         existing.quantity += 1;\n00604|         existing.indices.push(index);\n00605|       } else {\n00606|         groups.set(key, {\n00607|           length: cargo.length,\n00608|           width: cargo.width,\n00609|           height: cargo.height,\n00610|           weight: cargo.weight,\n00611|           quantity: 1,\n00612|           indices: [index],\n00613|           isEmpty: false\n00614|         });\n00615|       }\n00616|     });\n00617|     \n00618|     // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤: —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ (–ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É–±—ã–≤–∞–Ω–∏—è), –ø–æ—Ç–æ–º –ø—É—Å—Ç—ã–µ\n00619|     return Array.from(groups.values()).sort((a, b) => {\n00620|       if (a.isEmpty && !b.isEmpty) return 1;\n00621|       if (!a.isEmpty && b.isEmpty) return -1;\n00622|       if (!a.isEmpty && !b.isEmpty) {\n00623|         return b.quantity - a.quantity; // –ü–æ —É–±—ã–≤–∞–Ω–∏—é –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞\n00624|       }\n00625|       return a.indices[0] - b.indices[0]; // –ü—É—Å—Ç—ã–µ –ø–æ –ø–æ—Ä—è–¥–∫—É –∏–Ω–¥–µ–∫—Å–æ–≤\n00626|     });\n00627|   };\n00628| \n00629|   // üîß –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏\n00630|   const handleProductAdd = (product: FurnitureProduct) => {\n00631|     const timestamp = Date.now();\n00632|     \n00633|     console.log(`‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞: ${product.name} (${product.cargoPlaces.length} –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç)`);\n00634|     \n00635|     // –°–æ–∑–¥–∞–µ–º –≥—Ä—É–∑–æ–≤—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è —Ç–æ–≤–∞—Ä–∞\n00636|     const newCargos = createCargosForProduct(product, 1, timestamp);\n00637|     \n00638|     console.log('–°–æ–∑–¥–∞–Ω–æ –Ω–æ–≤—ã—Ö –≥—Ä—É–∑–æ–≤:', newCargos.length);\n00639|     console.log('–ù–æ–≤—ã–µ –≥—Ä—É–∑—ã:', newCargos.map(c => ({ id: c.id, productId: c.productId, addedAt: c.addedAt })));\n00640|     \n00641|     // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç —Ç–æ–≤–∞—Ä–∞ –≤ —Ñ–æ—Ä–º–µ\n00642|     const productInForm: ProductInForm = {\n00643|       product,\n00644|       quantity: 1,\n00645|       totalPrice: product.retailPrice,\n00646|       cargoIndexes: [], // –ó–∞–ø–æ–ª–Ω–∏–º –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–∑–æ–≤\n00647|       addedAt: timestamp\n00648|     };\n00649|     \n00650|     setForm(prev => {\n00651|       let updatedCargos = [...prev.cargos];\n00652|       let cargoIndexes: number[] = [];\n00653|       \n00654|       // –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è\n00655|       const emptyCargos = updatedCargos\n00656|         .map((cargo, index) => ({ cargo, index }))\n00657|         .filter(item => isEmptyCargo(item.cargo));\n00658|       \n00659|       console.log('–ù–∞–π–¥–µ–Ω–æ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤:', emptyCargos.length);\n00660|       console.log('–ù—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –≥—Ä—É–∑–æ–≤:', newCargos.length);\n00661|       \n00662|       // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞\n00663|       let filledCount = 0;\n00664|       for (let i = 0; i < Math.min(emptyCargos.length, newCargos.length); i++) {\n00665|         const emptyCargoIndex = emptyCargos[i].index;\n00666|         const newCargoData = newCargos[i];\n00667|         \n00668|         updatedCargos[emptyCargoIndex] = {\n00669|           ...updatedCargos[emptyCargoIndex],\n00670|           length: newCargoData.length,\n00671|           width: newCargoData.width,\n00672|           height: newCargoData.height,\n00673|           weight: newCargoData.weight,\n00674|           productId: newCargoData.productId,\n00675|           placeNumber: newCargoData.placeNumber,\n00676|           isFromProduct: newCargoData.isFromProduct,\n00677|           addedAt: newCargoData.addedAt\n00678|         };\n00679|         \n00680|         cargoIndexes.push(emptyCargoIndex);\n00681|         filledCount++;\n00682|       }\n00683|       \n00684|       // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –≥—Ä—É–∑–æ–≤, —á–µ–º –µ—Å—Ç—å –ø—É—Å—Ç—ã—Ö - –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ\n00685|       if (filledCount < newCargos.length) {\n00686|         const remainingCargos = newCargos.slice(filledCount);\n00687|         const startIndex = updatedCargos.length;\n00688|         \n00689|         for (let i = 0; i < remainingCargos.length; i++) {\n00690|           updatedCargos.push(remainingCargos[i]);\n00691|           cargoIndexes.push(startIndex + i);\n00692|         }\n00693|       }\n00694|       \n00695|       productInForm.cargoIndexes = cargoIndexes;\n00696|       \n00697|       console.log('–ò–Ω–¥–µ–∫—Å—ã –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤:', cargoIndexes);\n00698|       console.log('–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:', updatedCargos.length);\n00699|       \n00700|       // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n00701|       const prevSelectedProducts = prev.selectedProducts || [];\n00702|       const newSelectedProducts = [...prevSelectedProducts, productInForm];\n00703|       const newDeclaredValue = calculateTotalValue(newSelectedProducts);\n00704|       \n00705|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n00706|       const cleanResult = cleanEmptyCargos(updatedCargos, newSelectedProducts);\n00707|       \n00708|       return {\n00709|         ...prev,\n00710|         cargos: cleanResult.cargos,\n00711|         selectedProducts: cleanResult.products,\n00712|         declaredValue: newDeclaredValue\n00713|       };\n00714|     });\n00715|     \n00716|     console.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä: ${product.name} (${newCargos.length} –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç)`);\n00717|     console.log('–§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥—Ä—É–∑–æ–≤:', newCargos.length);\n00718|   };\n00719| \n00720|   const handleProductQuantityChange = (productId: string, addedAt: number, newQuantity: number) => {\n00721|     setForm(prev => {\n00722|       console.log(`üî¢ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞ ${productId} —Å ${prev.selectedProducts?.find(p => p.product.id === productId && p.addedAt === addedAt)?.quantity || 0} –Ω–∞ ${newQuantity}`);\n00723|       \n00724|       // –ù–∞—Ö–æ–¥–∏–º —Ç–æ–≤–∞—Ä\n00725|       const selectedProducts = prev.selectedProducts || [];\n00726|       const productIndex = selectedProducts.findIndex(p => \n00727|         p.product.id === productId && p.addedAt === addedAt\n00728|       );\n00729|       \n00730|       if (productIndex === -1) {\n00731|         console.warn('‚ùå –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞');\n00732|         return prev;\n00733|       }\n00734|       \n00735|       const product = selectedProducts[productIndex];\n00736|       console.log('–ì—Ä—É–∑—ã –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞:', prev.cargos.length);\n00737|       \n00738|       // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –≥—Ä—É–∑—ã —ç—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞\n00739|       const cargosWithoutProduct = removeCargosForProduct(\n00740|         prev.cargos as CargoWithMetadata[], \n00741|         productId, \n00742|         addedAt\n00743|       );\n00744|       \n00745|       console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö:', cargosWithoutProduct.length);\n00746|       \n00747|       // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –≥—Ä—É–∑—ã —Å –Ω–æ–≤—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º\n00748|       const newCargos = createCargosForProduct(product.product, newQuantity, addedAt);\n00749|       const updatedCargos = [...cargosWithoutProduct, ...newCargos];\n00750|       \n00751|       console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö:', updatedCargos.length);\n00752|       \n00753|       // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä\n00754|       const updatedProduct = {\n00755|         ...product,\n00756|         quantity: newQuantity,\n00757|         totalPrice: product.product.retailPrice * newQuantity,\n00758|         cargoIndexes: findCargoIndexesForProduct(updatedCargos, productId, addedAt)\n00759|       };\n00760|       \n00761|       const updatedProducts = selectedProducts.map((p, index) => \n00762|         index === productIndex ? updatedProduct : p\n00763|       );\n00764|       \n00765|       // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n00766|       const newDeclaredValue = calculateTotalValue(updatedProducts);\n00767|       \n00768|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n00769|       const cleanResult = cleanEmptyCargos(updatedCargos, updatedProducts);\n00770|       \n00771|       return {\n00772|         ...prev,\n00773|         cargos: cleanResult.cargos,\n00774|         selectedProducts: cleanResult.products,\n00775|         declaredValue: newDeclaredValue\n00776|       };\n00777|     });\n00778|     \n00779|     console.log(`üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ ${productId}: ${newQuantity} —à—Ç.`);\n00780|   };\n00781| \n00782|   const handleProductRemove = (productId: string, addedAt: number) => {\n00783|     setForm(prev => {\n00784|       console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ ${productId} (addedAt: ${addedAt})`);\n00785|       \n00786|       // –ù–∞—Ö–æ–¥–∏–º —Ç–æ–≤–∞—Ä –∏ –µ–≥–æ –∏–Ω–¥–µ–∫—Å—ã –≥—Ä—É–∑–æ–≤\n00787|       const selectedProducts = prev.selectedProducts || [];\n00788|       const product = selectedProducts.find(p => \n00789|         p.product.id === productId && p.addedAt === addedAt\n00790|       );\n00791|       \n00792|       if (!product) {\n00793|         console.log('–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω');\n00794|         return prev;\n00795|       }\n00796|       \n00797|       // –û—á–∏—â–∞–µ–º –≥—Ä—É–∑—ã —Ç–æ–≤–∞—Ä–∞ (–¥–µ–ª–∞–µ–º –∏—Ö –ø—É—Å—Ç—ã–º–∏ –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è)\n00798|       const updatedCargos = prev.cargos.map((cargo, index) => {\n00799|         if (product.cargoIndexes.includes(index)) {\n00800|           return {\n00801|             ...cargo,\n00802|             length: 0,\n00803|             width: 0,\n00804|             height: 0,\n00805|             weight: 0,\n00806|             productId: undefined,\n00807|             placeNumber: undefined,\n00808|             isFromProduct: undefined,\n00809|             addedAt: undefined\n00810|           };\n00811|         }\n00812|         return cargo;\n00813|       });\n00814|       \n00815|       // –£–¥–∞–ª—è–µ–º —Ç–æ–≤–∞—Ä –∏–∑ —Å–ø–∏—Å–∫–∞\n00816|       const updatedProducts = selectedProducts.filter(p => \n00817|         !(p.product.id === productId && p.addedAt === addedAt)\n00818|       );\n00819|       \n00820|       // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n00821|       const newDeclaredValue = calculateTotalValue(updatedProducts);\n00822|       \n00823|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n00824|       const cleanResult = cleanEmptyCargos(updatedCargos, updatedProducts);\n00825|       \n00826|       console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:', cleanResult.cargos.length);\n00827|       console.log('–£–¥–∞–ª–µ–Ω–æ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤:', updatedCargos.length - cleanResult.cargos.length);\n00828|       \n00829|       return {\n00830|         ...prev,\n00831|         cargos: cleanResult.cargos,\n00832|         selectedProducts: cleanResult.products,\n00833|         declaredValue: newDeclaredValue\n00834|       };\n00835|     });\n00836|     \n00837|     console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω —Ç–æ–≤–∞—Ä ${productId}`);\n00838|   };\n00839| \n00840|   // –ü–æ–ª—É—á–µ–Ω–∏–µ sessionID –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n00841|   const getDellinSessionId = async (): Promise<string | null> => {\n00842|     try {\n00843|       const authResponse = await fetch('https://api.dellin.ru/v3/auth/login.json', {\n00844|         method: 'POST',\n00845|         headers: {\n00846|           'Content-Type': 'application/json'\n00847|         },\n00848|         body: JSON.stringify({\n00849|           appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n00850|           login: 'service@lavsit.ru',\n00851|           password: 'edcwsx123QAZ'\n00852|         })\n00853|       });\n00854| \n00855|       const authData = await authResponse.json();\n00856|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ response.ok:', authResponse.ok);\n00857|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData:', authData);\n00858|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData.data:', authData.data);\n00859|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData.data?.sessionID:', authData.data?.sessionID);\n00860|       \n00861|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ –∫ sessionID\n00862|       let sessionID = null;\n00863|       \n00864|       if (authData.data?.sessionID) {\n00865|         sessionID = authData.data.sessionID;\n00866|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ data.sessionID:', sessionID);\n00867|       } else if (authData.sessionID) {\n00868|         sessionID = authData.sessionID;\n00869|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ sessionID:', sessionID);\n00870|       } else if (authData.data?.session) {\n00871|         sessionID = authData.data.session;\n00872|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ data.session:', sessionID);\n00873|       }\n00874|       \n00875|       if (authResponse.ok && sessionID) {\n00876|         return sessionID;\n00877|       } else {\n00878|         console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', authData);\n00879|         console.error('‚ùå –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', authResponse.status);\n00880|         console.error('‚ùå –¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞:', authResponse.statusText);\n00881|         return null;\n00882|       }\n00883|     } catch (error) {\n00884|       console.error('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', error);\n00885|     }\n00886|     return null;\n00887|   };\n00888| \n00889|   // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ –¥–ª—è –≥–æ—Ä–æ–¥–∞\n00890|   const getDellinTerminal = async (citySearch: string): Promise<string | null> => {\n00891|     try {\n00892|       const response = await fetch('https://api.dellin.ru/v3/public/terminals.json', {\n00893|         method: 'POST',\n00894|         headers: {\n00895|           'Content-Type': 'application/json'\n00896|         },\n00897|         body: JSON.stringify({\n00898|           appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B'\n00899|         })\n00900|       });\n00901| \n00902|       const data = await response.json();\n00903|       console.log('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã:', data);\n00904|       \n00905|       if (response.ok && data.terminals) {\n00906|         // –ò—â–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –≥–æ—Ä–æ–¥–µ\n00907|         const normalizedCity = citySearch.toLowerCase().trim();\n00908|         const terminal = data.terminals.find((t: any) => \n00909|           t.city?.toLowerCase().includes(normalizedCity) ||\n00910|           normalizedCity.includes(t.city?.toLowerCase())\n00911|         );\n00912|         \n00913|         return terminal?.id || data.terminals[0]?.id || null;\n00914|       }\n00915|       \n00916|       return null;\n00917|     } catch (error) {\n00918|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', error);\n00919|       return null;\n00920|     }\n00921|   };\n00922| \n00923|   // –ü–æ–ª—É—á–µ–Ω–∏–µ UID —É–ø–∞–∫–æ–≤–∫–∏ \"crate_with_bubble\" –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ —É–ø–∞–∫–æ–≤–æ–∫ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n00924|   const getDellinCrateWithBubbleUid = async (): Promise<string | null> => {\n00925|     const maxRetries = 2;\n00926|     \n00927|     for (let attempt = 1; attempt <= maxRetries; attempt++) {\n00928|       try {\n00929|         console.log(`üì¶ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –ø–æ–ø—ã—Ç–∫–∞ ${attempt}/${maxRetries}`);\n00930|         \n00931|         const response = await fetch('/api/dellin-packages', {\n00932|           method: 'GET',\n00933|           headers: {\n00934|             'Content-Type': 'application/json'\n00935|           }\n00936|         });\n00937| \n00938|         const data = await response.json();\n00939|         console.log('üì¶ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö response.ok:', response.ok);\n00940|         console.log('üì¶ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö status:', response.status);\n00941|         console.log('üì¶ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö data:', data);\n00942|         \n00943|         // –ï—Å–ª–∏ 401 Unauthorized - –ø—Ä–æ–±—É–µ–º –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è\n00944|         if (response.status === 401 && attempt < maxRetries) {\n00945|           console.log('üîÑ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –ø–æ–ª—É—á–∏–ª–∏ 401, –≤—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...');\n00946|           const newSessionId = await getDellinSessionId();\n00947|           if (newSessionId) {\n00948|             console.log('‚úÖ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –ø–æ–ª—É—á–µ–Ω –Ω–æ–≤—ã–π SessionID, –ø–æ–≤—Ç–æ—Ä—è–µ–º –∑–∞–ø—Ä–æ—Å...');\n00949|             continue; // –ü—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —Å –Ω–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n00950|           } else {\n00951|             console.error('‚ùå –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π SessionID');\n00952|             return null;\n00953|           }\n00954|         }\n00955|         \n00956|         if (response.ok && data.data && Array.isArray(data.data)) {\n00957|           console.log('üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–ø–∞–∫–æ–≤–æ–∫ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ:', data.data.length);\n00958|           console.log('üì¶ –ü–µ—Ä–≤—ã–µ 3 —É–ø–∞–∫–æ–≤–∫–∏:', data.data.slice(0, 3).map(p => ({name: p.name, uid: p.uid})));\n00959|           \n00960|           // –ù–∞—Ö–æ–¥–∏–º —É–ø–∞–∫–æ–≤–∫—É —Å name \"crate_with_bubble\"\n00961|           const crateWithBubble = data.data.find((pkg: any) => \n00962|             pkg.name === 'crate_with_bubble'\n00963|           );\n00964|           \n00965|           console.log('üì¶ –ü–æ–∏—Å–∫ crate_with_bubble —Ä–µ–∑—É–ª—å—Ç–∞—Ç:', crateWithBubble);\n00966|           \n00967|           if (crateWithBubble && crateWithBubble.uid) {\n00968|             console.log('‚úÖ –ù–∞–π–¥–µ–Ω UID –¥–ª—è crate_with_bubble:', crateWithBubble.uid);\n00969|             return crateWithBubble.uid;\n00970|           } else {\n00971|             console.log('‚ùå crate_with_bubble –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ—Ç UID');\n00972|           }\n00973|         } else {\n00974|           console.log('‚ùå –û—à–∏–±–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–∞ API —É–ø–∞–∫–æ–≤–æ–∫');\n00975|         }\n00976|         \n00977|         // –ï—Å–ª–∏ –¥–æ—à–ª–∏ —Å—é–¥–∞, –∑–Ω–∞—á–∏—Ç –Ω–µ –Ω–∞—à–ª–∏ —É–ø–∞–∫–æ–≤–∫—É –∏–ª–∏ –±—ã–ª–∞ –¥—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞\n00978|         break;\n00979|         \n00980|       } catch (error) {\n00981|         console.error(`‚ùå –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –æ—à–∏–±–∫–∞ –Ω–∞ –ø–æ–ø—ã—Ç–∫–µ ${attempt}:`, error);\n00982|         if (attempt === maxRetries) {\n00983|           console.error('‚ùå –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –∏—Å—á–µ—Ä–ø–∞–Ω—ã –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏');\n00984|           return null;\n00985|         }\n00986|       }\n00987|     }\n00988|     \n00989|     console.warn('–£–ø–∞–∫–æ–≤–∫–∞ —Å name=crate_with_bubble –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ');\n00990|     return null;\n00991|   };\n00992| \n00993|   // –†–∞—Å—á–µ—Ç –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π —á–µ—Ä–µ–∑ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π API v2/calculator.json —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n00994|   const calculateDellin = async (): Promise<CalculationResult> => {\n00995|     const apiUrl = 'https://api.dellin.ru/v2/calculator.json';\n00996|     const maxRetries = 2;\n00997|     \n00998|     console.log('üöÄ === –ù–ê–ß–ê–õ–û –†–ê–°–ß–ï–¢–ê –î–ï–õ–û–í–´–• –õ–ò–ù–ò–ô ===');\n00999|     console.log('üöÄ API URL:', apiUrl);\n01000|     \n01001|     try {\n01002|       let sessionID = await getDellinSessionId();\n01003|       \n01004|       if (!sessionID) {\n01005|         return {\n01006|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01007|           price: 0,\n01008|           days: 0,\n01009|           error: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å sessionID',\n01010|           apiUrl,\n01011|           requestData: null,\n01012|           responseData: null\n01013|         };\n01014|       }\n01015| \n01016|       // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏ –æ–±—ä–µ–º—ã\n01017|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n01018|       const totalVolume = form.cargos.reduce((sum, cargo) => \n01019|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n01020|       );\n01021|       const maxLength = Math.max(...form.cargos.map(c => c.length)) / 100; // –≤ –º–µ—Ç—Ä–∞—Ö\n01022|       const maxWidth = Math.max(...form.cargos.map(c => c.width)) / 100;\n01023|       const maxHeight = Math.max(...form.cargos.map(c => c.height)) / 100;\n01024| \n01025|       // –ü–æ–ª—É—á–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª—ã –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)\n01026|       const fromTerminalId = !form.fromAddressDelivery ? await getDellinTerminal(form.fromCity) : null;\n01027|       const toTerminalId = !form.toAddressDelivery ? await getDellinTerminal(form.toCity) : null;\n01028|       \n01029|       console.log('üè¢ –¢–ï–†–ú–ò–ù–ê–õ–´ –î–õ:');\n01030|       console.log('üè¢ form.fromAddressDelivery:', form.fromAddressDelivery);\n01031|       console.log('üè¢ form.toAddressDelivery:', form.toAddressDelivery);\n01032|       console.log('üè¢ fromTerminalId:', fromTerminalId);\n01033|       console.log('üè¢ toTerminalId:', toTerminalId);\n01034|       \n01035|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏\n01036|       if (!form.fromAddressDelivery && !fromTerminalId) {\n01037|         console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –≥–æ—Ä–æ–¥–∞:', form.fromCity);\n01038|         return {\n01039|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01040|           price: 0,\n01041|           days: 0,\n01042|           error: `–ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π –≤ –≥–æ—Ä–æ–¥–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è: ${form.fromCity}`,\n01043|           apiUrl,\n01044|           requestData: null,\n01045|           responseData: null\n01046|         };\n01047|       }\n01048|       \n01049|       if (!form.toAddressDelivery && !toTerminalId) {\n01050|         console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≥–æ—Ä–æ–¥–∞:', form.toCity);\n01051|         return {\n01052|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01053|           price: 0,\n01054|           days: 0,\n01055|           error: `–ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π –≤ –≥–æ—Ä–æ–¥–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: ${form.toCity}`,\n01056|           apiUrl,\n01057|           requestData: null,\n01058|           responseData: null\n01059|         };\n01060|       }\n01061| \n01062|       // –ü–æ–ª—É—á–∞–µ–º UID —É–ø–∞–∫–æ–≤–∫–∏ crate_with_bubble (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∞)\n01063|       let packageUid: string | null = null;\n01064|       console.log('=== –ù–ê–ß–ê–õ–û –û–¢–õ–ê–î–ö–ò –£–ü–ê–ö–û–í–ö–ò ===');\n01065|       console.log('üîç –û–¢–õ–ê–î–ö–ê –£–ü–ê–ö–û–í–ö–ò: form.needPackaging =', form.needPackaging);\n01066|       console.log('üîç –û–¢–õ–ê–î–ö–ê –£–ü–ê–ö–û–í–ö–ò: typeof form.needPackaging =', typeof form.needPackaging);\n01067|       \n01068|       if (form.needPackaging) {\n01069|         console.log('üîç ‚úÖ –£–ü–ê–ö–û–í–ö–ê –¢–†–ï–ë–£–ï–¢–°–Ø - –ó–ê–ü–†–ê–®–ò–í–ê–ï–ú UID...');\n01070|         try {\n01071|           packageUid = await getDellinCrateWithBubbleUid();\n01072|           console.log('üîç ‚úÖ –ü–û–õ–£–ß–ï–ù packageUid –∏–∑ API:', packageUid);\n01073|           \n01074|           // –í–†–ï–ú–ï–ù–ù–û: –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ UID –∏–∑ API, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π\n01075|           if (!packageUid) {\n01076|             packageUid = '0xa6a7bd2bf950e67f4b2cf7cc3a97c111';\n01077|             console.log('üîç üß™ –ò–°–ü–û–õ–¨–ó–£–ï–ú –¢–ï–°–¢–û–í–´–ô UID:', packageUid);\n01078|           }\n01079|           \n01080|           console.log('üîç ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô packageUid:', packageUid);\n01081|           console.log('üîç ‚úÖ typeof packageUid:', typeof packageUid);\n01082|           console.log('üîç ‚úÖ packageUid truthy:', !!packageUid);\n01083|         } catch (error) {\n01084|           console.log('üîç ‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ packageUid:', error);\n01085|           // –í–†–ï–ú–ï–ù–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π UID –ø—Ä–∏ –æ—à–∏–±–∫–µ\n01086|           packageUid = '0xa6a7bd2bf950e67f4b2cf7cc3a97c111';\n01087|           console.log('üîç üß™ –ò–°–ü–û–õ–¨–ó–£–ï–ú –¢–ï–°–¢–û–í–´–ô UID –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏:', packageUid);\n01088|         }\n01089|       } else {\n01090|         console.log('üîç ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ UID');\n01091|       }\n01092|       console.log('=== –ö–û–ù–ï–¶ –û–¢–õ–ê–î–ö–ò –£–ü–ê–ö–û–í–ö–ò ===');\n01093| \n01094|       // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞—Ç—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞\n01095|       const tomorrow = new Date();\n01096|       tomorrow.setDate(tomorrow.getDate() + 1);\n01097|       const produceDate = tomorrow.toISOString().split('T')[0];\n01098| \n01099|       // –û—Ç–ª–∞–¥–∫–∞ –ø–µ—Ä–µ–¥ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–∞\n01100|       console.log('=== –û–¢–õ–ê–î–ö–ê –§–û–†–ú–ò–†–û–í–ê–ù–ò–Ø –ó–ê–ü–†–û–°–ê ===');\n01101|       console.log('üîç form.needPackaging =', form.needPackaging, '(—Ç–∏–ø:', typeof form.needPackaging, ')');\n01102|       console.log('üîç packageUid =', packageUid, '(—Ç–∏–ø:', typeof packageUid, ')');\n01103|       console.log('üîç packageUid truthy =', !!packageUid);\n01104|       console.log('üîç –£—Å–ª–æ–≤–∏–µ (form.needPackaging && packageUid) =', form.needPackaging && packageUid);\n01105|       \n01106|       if (form.needPackaging && packageUid) {\n01107|         console.log('‚úÖ PACKAGES –ë–£–î–ï–¢ –î–û–ë–ê–í–õ–ï–ù –í –ó–ê–ü–†–û–°!');\n01108|       } else {\n01109|         console.log('‚ùå PACKAGES –ù–ï –ë–£–î–ï–¢ –î–û–ë–ê–í–õ–ï–ù:');\n01110|         if (!form.needPackaging) console.log('  - form.needPackaging = false');\n01111|         if (!packageUid) console.log('  - packageUid –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç/null');\n01112|       }\n01113| \n01114|       // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n01115|       const requestData = {\n01116|         appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n01117|         sessionID: sessionID,\n01118|         delivery: {\n01119|           deliveryType: {\n01120|             type: 'auto'  // –í—Å–µ–≥–¥–∞ \"auto\" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n01121|           },\n01122|           derival: {\n01123|             produceDate: produceDate,  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –¥–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n01124|             variant: form.fromAddressDelivery ? 'address' : 'terminal',\n01125|             ...(form.fromAddressDelivery ? {\n01126|               address: {\n01127|                 search: form.fromAddress || form.fromCity\n01128|               }\n01129|             } : (fromTerminalId ? {\n01130|               terminalID: fromTerminalId\n01131|             } : {\n01132|               address: {\n01133|                 search: form.fromCity\n01134|               }\n01135|             })),\n01136|             time: {\n01137|               worktimeStart: '10:00',\n01138|               worktimeEnd: '18:00',\n01139|               breakStart: '13:00',\n01140|               breakEnd: '14:00',\n01141|               exactTime: false\n01142|             }\n01143|             // handling –≤ derival –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n01144|           },\n01145|           arrival: {\n01146|             variant: form.toAddressDelivery ? 'address' : 'terminal',\n01147|             ...(form.toAddressDelivery ? {\n01148|               address: {\n01149|                 search: form.toAddress || form.toCity\n01150|               }\n01151|             } : (toTerminalId ? {\n01152|               terminalID: toTerminalId\n01153|             } : {\n01154|               address: {\n01155|                 search: form.toCity\n01156|               }\n01157|             })),\n01158|             time: {\n01159|               worktimeStart: '10:00',\n01160|               worktimeEnd: '18:00',\n01161|               breakStart: '13:00',\n01162|               breakEnd: '14:00',\n01163|               exactTime: false\n01164|             },\n01165|             // handling –≤ arrival –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—ä–µ–º\n01166|             ...(form.needCarry ? {\n01167|               handling: {\n01168|                 freightLift: form.hasFreightLift, // true —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –≥–∞–ª–æ—á–∫–∞ \"–Ω–∞–ª–∏—á–∏–µ –≥—Ä—É–∑–æ–≤–æ–≥–æ –ª–∏—Ñ—Ç–∞\"\n01169|                 toFloor: form.floor, // —ç—Ç–∞–∂ –∏–∑ —Ñ–æ—Ä–º—ã\n01170|                 carry: 0\n01171|               }\n01172|             } : {})\n01173|           },\n01174|           ...(form.needPackaging && packageUid ? {\n01175|             packages: [{\n01176|               uid: packageUid,  // UID —É–ø–∞–∫–æ–≤–∫–∏ crate_with_bubble –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞\n01177|               count: 1  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1\n01178|             }]\n01179|           } : {})\n01180|         },\n01181|         cargo: {\n01182|           quantity: form.cargos.length,\n01183|           length: maxLength,\n01184|           width: maxWidth,\n01185|           height: maxHeight,\n01186|           weight: totalWeight,\n01187|           totalVolume: totalVolume,\n01188|           totalWeight: totalWeight,\n01189|           oversizedWeight: 0,\n01190|           oversizedVolume: 0,\n01191|           hazardClass: 0,  // –í—Å–µ–≥–¥–∞ 0 –µ—Å–ª–∏ –Ω–µ—Ç –æ–ø–∞—Å–Ω—ã—Ö –≥—Ä—É–∑–æ–≤\n01192|           ...(form.needInsurance && form.declaredValue > 0 ? {\n01193|             insurance: {\n01194|               statedValue: form.declaredValue,\n01195|               term: true  // –í—Å–µ–≥–¥–∞ true –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è\n01196|             }\n01197|           } : {})\n01198|         },\n01199|         payment: {\n01200|           type: 'noncash',  // –í—Å–µ–≥–¥–∞ \"noncash\"\n01201|           paymentCitySearch: {\n01202|             search: form.fromCity  // –ì–æ—Ä–æ–¥ –æ–ø–ª–∞—Ç—ã\n01203|           }\n01204|         }\n01205|       };\n01206| \n01207|       console.log('üöÄ –ò–¢–û–ì–û–í–´–ô –ó–ê–ü–†–û–° –ö –î–õ:', JSON.stringify(requestData, null, 2));\n01208|       \n01209|       // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∞ packages\n01210|       if (requestData.delivery.packages) {\n01211|         console.log('‚úÖ PACKAGES –ù–ê–ô–î–ï–ù –í –ó–ê–ü–†–û–°–ï:', requestData.delivery.packages);\n01212|       } else {\n01213|         console.log('‚ùå PACKAGES –ù–ï –ù–ê–ô–î–ï–ù –í –ó–ê–ü–†–û–°–ï');\n01214|         console.log('   form.needPackaging =', form.needPackaging);\n01215|         console.log('   packageUid =', packageUid);\n01216|         console.log('   –£—Å–ª–æ–≤–∏–µ:', form.needPackaging && packageUid);\n01217|       }\n01218| \n01219|       // –ü–æ–ø—ã—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö\n01220|       let response: any = null;\n01221|       let data: any = null;\n01222|       \n01223|       for (let attempt = 1; attempt <= maxRetries; attempt++) {\n01224|         console.log(`üîÑ –î–õ: –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ ${attempt}/${maxRetries}`);\n01225|         \n01226|         response = await fetch(apiUrl, {\n01227|           method: 'POST',\n01228|           headers: {\n01229|             'Content-Type': 'application/json',\n01230|             'Accept': 'application/json'\n01231|           },\n01232|           body: JSON.stringify(requestData)\n01233|         });\n01234| \n01235|         try {\n01236|           data = await response.json();\n01237|         } catch (parseError) {\n01238|           console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –æ—Ç–≤–µ—Ç–∞ –î–õ:', parseError);\n01239|           throw new Error(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ API: ${parseError instanceof Error ? parseError.message : '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);\n01240|         }\n01241|         \n01242|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ response.ok:', response.ok);\n01243|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ status:', response.status);\n01244|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ data:', data);\n01245|         \n01246|         // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\n01247|         const isAuthError = response.status === 401 || \n01248|                            response.status === 403 ||\n01249|                            (response.status === 400 && data?.errors?.some((err: any) => \n01250|                              err.detail?.toLowerCase()?.includes('session') ||\n01251|                              err.detail?.toLowerCase()?.includes('auth') ||\n01252|                              err.detail?.toLowerCase()?.includes('invalid')\n01253|                            ));\n01254| \n01255|         if (isAuthError && attempt < maxRetries) {\n01256|           console.log('üîÑ –î–õ: –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –≤—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...');\n01257|           const newSessionId = await getDellinSessionId();\n01258|           if (newSessionId) {\n01259|             console.log('‚úÖ –î–õ: –ø–æ–ª—É—á–µ–Ω –Ω–æ–≤—ã–π SessionID, –æ–±–Ω–æ–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å...');\n01260|             // –û–±–Ω–æ–≤–ª—è–µ–º sessionID –≤ –∑–∞–ø—Ä–æ—Å–µ\n01261|             requestData.sessionID = newSessionId;\n01262|             sessionID = newSessionId;\n01263|             continue; // –ü—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —Å –Ω–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n01264|           } else {\n01265|             console.error('‚ùå –î–õ: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π SessionID');\n01266|             break;\n01267|           }\n01268|         }\n01269|         \n01270|         if (response.status === 400 && data?.errors) {\n01271|           console.log('=== –ê–ù–ê–õ–ò–ó –û–®–ò–ë–ö–ò 400 ===');\n01272|           console.log('üîç –û—à–∏–±–∫–∏:', data.errors);\n01273|           data.errors.forEach((error: any, index: number) => {\n01274|             console.log(`üîç –û—à–∏–±–∫–∞ ${index + 1}:`, error);\n01275|             console.log(`   - –ü–æ–ª–µ: ${error.field || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`);\n01276|             console.log(`   - –°–æ–æ–±—â–µ–Ω–∏–µ: ${error.detail || error.message || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`);\n01277|           });\n01278|           console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –û–®–ò–ë–ö–ò 400 ===');\n01279|         }\n01280| \n01281|         // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–Ω—ã–π –∏–ª–∏ –Ω–µ —Å–≤—è–∑–∞–Ω —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É\n01282|         break;\n01283|       }\n01284| \n01285|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –æ—à–∏–±–∫–∏ –ü–ï–†–ï–î –∞–Ω–∞–ª–∏–∑–æ–º –¥–∞–Ω–Ω—ã—Ö\n01286|       if (!response.ok || !data.data) {\n01287|         console.log('‚ùå –û—à–∏–±–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç API - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö');\n01288|         const errorMessage = data.metadata?.detail || \n01289|                            data.metadata?.message || \n01290|                            data.errors?.[0]?.detail || \n01291|                            (data.metadata?.status !== 200 ? `HTTP ${data.metadata?.status}` : '') ||\n01292|                            `HTTP ${response.status} - ${response.statusText}` ||\n01293|                            '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏';\n01294|         return {\n01295|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01296|           price: 0,\n01297|           days: 0,\n01298|           error: errorMessage,\n01299|           requestData,\n01300|           responseData: data,\n01301|           apiUrl,\n01302|           sessionId: sessionID\n01303|         };\n01304|       }\n01305|       \n01306|       // –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –°–¢–†–ê–•–û–í–ö–ò (—Ç–æ–ª—å–∫–æ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞)\n01307|       console.log('=== –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –°–¢–†–ê–•–û–í–ö–ò ===');\n01308|       console.log('üîç –ü–†–û–í–ï–†–ö–ê –°–¢–†–£–ö–¢–£–†–´ –î–ê–ù–ù–´–•:');\n01309|       console.log('üîç data:', data ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n01310|       console.log('üîç typeof data:', typeof data);\n01311|       console.log('üîç data.data:', data?.data ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n01312|       console.log('üîç typeof data.data:', typeof data?.data);\n01313|       \n01314|       // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–π—Å—Ç–≤ data.data\n01315|       if (data?.data) {\n01316|         console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤–æ–π—Å—Ç–≤–∞ data.data:');\n01317|         console.log('üîç data.data.derival:', typeof data.data.derival, data.data.derival);\n01318|         console.log('üîç data.data.arrival:', typeof data.data.arrival, data.data.arrival);\n01319|         console.log('üîç data.data.intercity:', typeof data.data.intercity, data.data.intercity);\n01320|       }\n01321|       \n01322|       if (!data) {\n01323|         console.error('‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: data undefined/null');\n01324|         return {\n01325|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01326|           price: 0,\n01327|           days: 0,\n01328|           error: '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ API: –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã',\n01329|           apiUrl,\n01330|           requestData,\n01331|           responseData: null\n01332|         };\n01333|       }\n01334|       \n01335|       try {\n01336|         console.log('üîç –ü–û–õ–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê data.data:', JSON.stringify(data.data, null, 2));\n01337|       } catch (jsonError) {\n01338|         console.error('‚ùå –û—à–∏–±–∫–∞ JSON.stringify –¥–ª—è data.data:', jsonError);\n01339|         console.log('üîç data.data (toString):', data.data?.toString?.() || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å');\n01340|       }\n01341|       \n01342|       // –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç—Ä–∞—Ö–æ–≤–∫–æ–π\n01343|       console.log('üí≥ –ü–û–ò–°–ö –ö–û–ú–ü–û–ù–ï–ù–¢–û–í –°–¢–†–ê–•–û–í–ö–ò:');\n01344|       console.log('üí≥ data.data.insurance:', data.data?.insurance);\n01345|       console.log('üí≥ data.data.cargoInsurance:', data.data?.cargoInsurance);\n01346|       console.log('üí≥ data.data.termInsurance:', data.data?.termInsurance);\n01347|       console.log('üí≥ data.data.insuranceDetails:', data.data?.insuranceDetails);\n01348|       console.log('üí≥ data.data.services:', data.data?.services);\n01349|       console.log('üí≥ data.data.additionalServices:', data.data?.additionalServices);\n01350|       \n01351|       // –ü–æ–∏—Å–∫ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏ –≤ –¥—Ä—É–≥–∏—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö\n01352|       try {\n01353|         console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º derival...');\n01354|         if (data.data?.derival) {\n01355|           console.log('üí≥ derival –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n01356|           console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –ó–ê–ë–û–ï data.data.derival.insurance:', data.data.derival?.insurance);\n01357|         } else {\n01358|           console.log('üí≥ derival –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n01359|         }\n01360|         \n01361|         console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º arrival...');\n01362|         if (data.data?.arrival) {\n01363|           console.log('üí≥ arrival –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n01364|           console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –î–û–°–¢–ê–í–ö–ï data.data.arrival.insurance:', data.data.arrival?.insurance);\n01365|         } else {\n01366|           console.log('üí≥ arrival –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n01367|         }\n01368|         \n01369|         console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º intercity...');\n01370|         if (data.data?.intercity) {\n01371|           console.log('üí≥ intercity –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n01372|           console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –ü–ï–†–ï–í–û–ó–ö–ï data.data.intercity.insurance:', data.data.intercity?.insurance);\n01373|         } else {\n01374|           console.log('üí≥ intercity –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n01375|         }\n01376|       } catch (error) {\n01377|         console.error('‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–µ–∫—Ü–∏–π —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏:', error);\n01378|         console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', error instanceof Error ? error.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n01379|       }\n01380|       \n01381|       // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö \"insurance\"\n01382|       const findInsuranceFields = (obj: any, path = '') => {\n01383|         if (typeof obj !== 'object' || obj === null || obj === undefined) return;\n01384|         \n01385|         try {\n01386|           Object.keys(obj).forEach(key => {\n01387|             const fullPath = path ? `${path}.${key}` : key;\n01388|             if (key.toLowerCase().includes('insurance') || key.toLowerCase().includes('insur')) {\n01389|               console.log(`üí≥ –ù–ê–ô–î–ï–ù–û –ü–û–õ–ï –°–¢–†–ê–•–û–í–ö–ò [${fullPath}]:`, obj[key]);\n01390|             }\n01391|             if (typeof obj[key] === 'object' && obj[key] !== null && obj[key] !== undefined) {\n01392|               findInsuranceFields(obj[key], fullPath);\n01393|             }\n01394|           });\n01395|         } catch (error) {\n01396|           console.error(`üí≥ –û—à–∏–±–∫–∞ –≤ findInsuranceFields –¥–ª—è –ø—É—Ç–∏ ${path}:`, error);\n01397|         }\n01398|       };\n01399|       \n01400|       console.log('üí≥ –†–ï–ö–£–†–°–ò–í–ù–´–ô –ü–û–ò–°–ö –ü–û–õ–ï–ô –°–¢–†–ê–•–û–í–ö–ò:');\n01401|       try {\n01402|         if (data && data.data) {\n01403|           findInsuranceFields(data.data, 'data.data');\n01404|         } else {\n01405|           console.log('üí≥ –ü—Ä–æ–ø—É—Å–∫ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞: data.data –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');\n01406|         }\n01407|       } catch (error) {\n01408|         console.error('‚ùå –û–®–ò–ë–ö–ê –≤ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–º –ø–æ–∏—Å–∫–µ:', error);\n01409|         console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', error instanceof Error ? error.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n01410|       }\n01411|       console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –°–¢–†–ê–•–û–í–ö–ò ===');\n01412|       \n01413|       // –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ packages –≤ –æ—Ç–≤–µ—Ç–µ\n01414|       console.log('=== –ü–û–ò–°–ö PACKAGES –í –û–¢–í–ï–¢–ï ===');\n01415|       console.log('üì¶ data.data =', data.data);\n01416|       console.log('üì¶ data.data.packages =', data.data?.packages);\n01417|       console.log('üì¶ –¢–∏–ø data.data.packages:', typeof data.data?.packages);\n01418|       if (data.data?.packages) {\n01419|         console.log('‚úÖ PACKAGES –ù–ê–ô–î–ï–ù –í –û–¢–í–ï–¢–ï!');\n01420|         try {\n01421|           console.log('üì¶ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ packages:', JSON.stringify(data.data.packages, null, 2));\n01422|         } catch (jsonError) {\n01423|           console.error('‚ùå –û—à–∏–±–∫–∞ JSON.stringify –¥–ª—è packages:', jsonError);\n01424|           console.log('üì¶ packages (toString):', data.data.packages?.toString?.() || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å');\n01425|         }\n01426|       } else {\n01427|         console.log('‚ùå PACKAGES –ù–ï –ù–ê–ô–î–ï–ù –í –û–¢–í–ï–¢–ï');\n01428|       }\n01429|       console.log('=== –ö–û–ù–ï–¶ –ü–û–ò–°–ö–ê PACKAGES ===');\n01430| \n01431|       if (response.ok && data.data && data.metadata?.status === 200) {\n01432|         let totalPrice = data.data.price || 0;\n01433|         console.log('üí∞ –†–ê–°–ß–ï–¢ –ò–¢–û–ì–û–í–û–ô –°–¢–û–ò–ú–û–°–¢–ò:');\n01434|         console.log('üí∞ –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å data.data.price (–£–ñ–ï –í–ö–õ–Æ–ß–ê–ï–¢ –í–°–ï):', totalPrice);\n01435|         \n01436|         // –°–¢–†–ê–•–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n01437|         if (data.data.insurance) {\n01438|           console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ data.data.insurance (–£–ñ–ï –≤–∫–ª—é—á–µ–Ω–∞ –≤ –±–∞–∑–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):', data.data.insurance);\n01439|           console.log('üí∞ –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞—Ö–æ–≤–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ');\n01440|         } else {\n01441|           console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–≤–µ—Ç–µ');\n01442|         }\n01443|         \n01444|         // –£–ü–ê–ö–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n01445|         console.log('üí∞ –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–ë –£–ü–ê–ö–û–í–ö–ï (–£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –í –û–°–ù–û–í–ù–£–Æ –°–¢–û–ò–ú–û–°–¢–¨):');\n01446|         console.log('üí∞ data.data.packages =', data.data.packages);\n01447|         console.log('üí∞ form.needPackaging =', form.needPackaging);\n01448|         \n01449|         if (data.data.packages && form.needPackaging) {\n01450|           console.log('üí∞ ‚úÖ –£–ü–ê–ö–û–í–ö–ê –ü–†–ò–°–£–¢–°–¢–í–£–ï–¢ –í –û–¢–í–ï–¢–ï (—Ü–µ–Ω–∞ —É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ data.data.price)');\n01451|           console.log('üí∞ –¢–∏–ø packages:', Array.isArray(data.data.packages) ? 'Array' : 'Object');\n01452|           \n01453|           if (Array.isArray(data.data.packages)) {\n01454|             data.data.packages.forEach((pkg: any, index: number) => {\n01455|               console.log(`üí∞ Package [${index}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n01456|             });\n01457|           } else {\n01458|             Object.entries(data.data.packages).forEach(([key, pkg]: [string, any]) => {\n01459|               console.log(`üí∞ Package [${key}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n01460|             });\n01461|           }\n01462|         } else {\n01463|           console.log('üí∞ ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∞—Å—å');\n01464|         }\n01465| \n01466|         // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–∞–∫ —Ä–∞–∑–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –¥–∞—Ç–∞–º–∏ pickup –∏ arrivalToOspReceiver\n01467|         let deliveryDays = 0;\n01468|         try {\n01469|           console.log('=== –ü–û–ò–°–ö –î–ê–¢ –í –û–¢–í–ï–¢–ï ===');\n01470|           \n01471|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–µ—Å—Ç–∞ –≥–¥–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–∞—Ç—ã\n01472|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.pickup:', data.data?.pickup);\n01473|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.pickup:', data.pickup);\n01474|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.pickup:', data?.pickup);\n01475|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.arrivalToOspReceiver:', data.data?.arrivalToOspReceiver);\n01476|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.arrivalToOspReceiver:', data.arrivalToOspReceiver);\n01477|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.arrivalToOspReceiver:', data?.arrivalToOspReceiver);\n01478|           \n01479|           // –ë–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–π –ø–æ–∏—Å–∫ –≤–æ –≤—Å–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ data\n01480|           const findDateInObject = (obj: any, fieldName: string): string | null => {\n01481|             if (!obj || typeof obj !== 'object') return null;\n01482|             \n01483|             for (const [key, value] of Object.entries(obj)) {\n01484|               if (key === fieldName && typeof value === 'string') {\n01485|                 return value;\n01486|               }\n01487|               if (typeof value === 'object' && value !== null) {\n01488|                 const found = findDateInObject(value, fieldName);\n01489|                 if (found) return found;\n01490|               }\n01491|             }\n01492|             return null;\n01493|           };\n01494|           \n01495|           const pickup = findDateInObject(data, 'pickup');\n01496|           const arrivalToOspReceiver = findDateInObject(data, 'arrivalToOspReceiver');\n01497|           \n01498|           console.log('–ù–ê–ô–î–ï–ù–ù–´–ï –î–ê–¢–´:');\n01499|           console.log('pickup:', pickup);\n01500|           console.log('arrivalToOspReceiver:', arrivalToOspReceiver);\n01501|           \n01502|           if (pickup && arrivalToOspReceiver) {\n01503|             // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—ã (—Ñ–æ—Ä–º–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å \"2025-09-27\" –∏–ª–∏ \"2025-09-27 10:00:00\")\n01504|             const pickupDate = new Date(pickup);\n01505|             const arrivalDate = new Date(arrivalToOspReceiver);\n01506|             \n01507|             console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ pickup:', pickupDate);\n01508|             console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ arrival:', arrivalDate);\n01509|             \n01510|             // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã\n01511|             if (!isNaN(pickupDate.getTime()) && !isNaN(arrivalDate.getTime())) {\n01512|               // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–æ—Å—Ç—å –≤ –¥–Ω—è—Ö\n01513|               const timeDiff = arrivalDate.getTime() - pickupDate.getTime();\n01514|               deliveryDays = Math.max(1, Math.ceil(timeDiff / (1000 * 3600 * 24))); // –ú–∏–Ω–∏–º—É–º 1 –¥–µ–Ω—å\n01515|               \n01516|               console.log('–†–∞–∑–Ω–æ—Å—Ç—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö:', timeDiff);\n01517|               console.log('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –í–´–ß–ò–°–õ–ï–ù —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:', deliveryDays, '–¥–Ω–µ–π');\n01518|             } else {\n01519|               console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞—Ç—ã –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞');\n01520|               console.error('pickup Date object:', pickupDate);\n01521|               console.error('arrival Date object:', arrivalDate);\n01522|             }\n01523|           } else {\n01524|             console.warn('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ –Ω–∞–π–¥–µ–Ω—ã –¥–∞—Ç—ã pickup –∏–ª–∏ arrivalToOspReceiver');\n01525|             console.log('pickup –Ω–∞–π–¥–µ–Ω:', !!pickup, pickup);\n01526|             console.log('arrivalToOspReceiver –Ω–∞–π–¥–µ–Ω:', !!arrivalToOspReceiver, arrivalToOspReceiver);\n01527|           }\n01528|         } catch (error) {\n01529|           console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –û—à–∏–±–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:', error);\n01530|         }\n01531| \n01532|         console.log('üí∞ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ò–¢–û–ì–û–í–ê–Ø –°–¢–û–ò–ú–û–°–¢–¨:', Math.round(totalPrice));\n01533|         \n01534|         return {\n01535|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01536|           price: Math.round(totalPrice),\n01537|           days: deliveryDays || 0,\n01538|           details: data.data || {},\n01539|           requestData,\n01540|           responseData: data,\n01541|           apiUrl,\n01542|           sessionId: sessionID\n01543|         };\n01544|       } else {\n01545|         const errorMessage = data.metadata?.detail || \n01546|                            data.metadata?.message || \n01547|                            data.errors?.[0]?.detail || \n01548|                            (data.metadata?.status !== 200 ? `HTTP ${data.metadata?.status}` : '') ||\n01549|                            '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏';\n01550|         return {\n01551|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01552|           price: 0,\n01553|           days: 0,\n01554|           error: errorMessage,\n01555|           requestData,\n01556|           responseData: data,\n01557|           apiUrl,\n01558|           sessionId: sessionID\n01559|         };\n01560|       }\n01561|     } catch (error: any) {\n01562|       return {\n01563|         company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01564|         price: 0,\n01565|         days: 0,\n01566|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n01567|         requestData: null,\n01568|         responseData: null,\n01569|         apiUrl\n01570|       };\n01571|     }\n01572|   };\n01573| \n01574| \n01575| \n01576|   // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–Ω–æ–π –∑–æ–Ω—ã –∏ —Å–∫–ª–∞–¥–∞ –ü–≠–ö –ø–æ –∞–¥—Ä–µ—Å—É —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏\n01577|   const getPekZoneByAddress = async (address: string) => {\n01578|     try {\n01579|       console.log(`üîç –ü–≠–ö: –ø–æ–∏—Å–∫ –∑–æ–Ω—ã –¥–ª—è –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n01580|       \n01581|       const response = await fetch('/api/pek', {\n01582|         method: 'POST',\n01583|         headers: {\n01584|           'Content-Type': 'application/json',\n01585|         },\n01586|         body: JSON.stringify({\n01587|           method: 'findzonebyaddress',\n01588|           address: address\n01589|         })\n01590|       });\n01591| \n01592|       console.log(`üì° –ü–≠–ö API —Å—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`);\n01593|       \n01594|       if (!response.ok) {\n01595|         let errorData;\n01596|         try {\n01597|           errorData = await response.json();\n01598|         } catch {\n01599|           errorData = { error: '–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç' };\n01600|         }\n01601|         \n01602|         console.error(`‚ùå –ü–≠–ö API –æ—à–∏–±–∫–∞ ${response.status}:`, errorData);\n01603|         \n01604|         // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫\n01605|         if (response.status === 401) {\n01606|           console.error('‚ùå –ü–≠–ö: –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω');\n01607|         } else if (response.status === 404) {\n01608|           console.error('‚ùå –ü–≠–ö: –ú–µ—Ç–æ–¥ API –Ω–µ –Ω–∞–π–¥–µ–Ω');\n01609|         } else if (response.status === 400) {\n01610|           console.error('‚ùå –ü–≠–ö: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞');\n01611|         } else if (response.status >= 500) {\n01612|           console.error('‚ùå –ü–≠–ö: –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ü–≠–ö');\n01613|         }\n01614|         \n01615|         console.log(`üîÑ –ü–≠–ö: –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥—É –¥–ª—è \"${address}\"`);\n01616|         return getPekZoneFallback(address);\n01617|       }\n01618| \n01619|       const data = await response.json();\n01620|       console.log(`‚úÖ –ü–≠–ö –∑–æ–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞:`, data);\n01621|       \n01622|       if (data.zoneId && data.mainWarehouseId) {\n01623|         return {\n01624|           zoneId: data.zoneId,\n01625|           zoneName: data.zoneName,\n01626|           branchUID: data.branchUID,\n01627|           branchCode: data.branchCode,\n01628|           branchTitle: data.branchTitle,\n01629|           mainWarehouseId: data.mainWarehouseId,\n01630|           warehousePoint: data.warehousePoint,\n01631|           geoData: data.GeoData,\n01632|           precision: data.GeoData?.precision\n01633|         };\n01634|       }\n01635|       \n01636|       console.warn(`‚ö†Ô∏è –ü–≠–ö: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç:`, data);\n01637|       return getPekZoneFallback(address);\n01638|       \n01639|     } catch (error) {\n01640|       console.error('‚ùå –ü–≠–ö: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∑–æ–Ω—ã:', error);\n01641|       return getPekZoneFallback(address);\n01642|     }\n01643|   };\n01644| \n01645|   // –§–æ–ª–ª–±—ç–∫ –º–µ—Ç–æ–¥ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–æ–Ω—ã –ü–≠–ö\n01646|   const getPekZoneFallback = (address: string) => {\n01647|     console.log(`üîÑ –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –∞–Ω–∞–ª–∏–∑ –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n01648|     \n01649|     const addressLower = address.toLowerCase();\n01650|     \n01651|     // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –∏ –∏—Ö –¥–∞–Ω–Ω—ã–µ\n01652|     const cityMappings: { [key: string]: any } = {\n01653|       '–º–æ—Å–∫–≤–∞': {\n01654|         zoneId: 'moscow-zone-001',\n01655|         zoneName: '–ú–æ—Å–∫–≤–∞',\n01656|         branchUID: 'moscow-branch-001',\n01657|         branchCode: '–ú–°–ö',\n01658|         branchTitle: '–ú–æ—Å–∫–≤–∞',\n01659|         mainWarehouseId: 'dc6c746d-812d-11e4-bbfc-001999d8b3c5',\n01660|         warehousePoint: {\n01661|           latitude: 55.755826,\n01662|           longitude: 37.6173\n01663|         }\n01664|       },\n01665|       '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': {\n01666|         zoneId: 'spb-zone-001',\n01667|         zoneName: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n01668|         branchUID: 'spb-branch-001',\n01669|         branchCode: '–°–ü–ë',\n01670|         branchTitle: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',\n01671|         mainWarehouseId: 'b436c978-086d-11e6-b6ca-00155d668909',\n01672|         warehousePoint: {\n01673|           latitude: 59.9311,\n01674|           longitude: 30.3609\n01675|         }\n01676|       },\n01677|       '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': {\n01678|         zoneId: 'ekb-zone-001',\n01679|         zoneName: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',\n01680|         branchUID: 'ekb-branch-001',\n01681|         branchCode: '–ï–ö–ë',\n01682|         branchTitle: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',\n01683|         mainWarehouseId: 'f8d9c8e3-8e2d-11e4-bbfc-001999d8b3c5',\n01684|         warehousePoint: {\n01685|           latitude: 56.8431,\n01686|           longitude: 60.6454\n01687|         }\n01688|       }\n01689|     };\n01690|     \n01691|     for (const [city, data] of Object.entries(cityMappings)) {\n01692|       if (addressLower.includes(city) || addressLower.includes(city.replace('-', ' '))) {\n01693|         console.log(`‚úÖ –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –Ω–∞–π–¥–µ–Ω –≥–æ—Ä–æ–¥ ${city}`);\n01694|         return {\n01695|           ...data,\n01696|           geoData: {\n01697|             precision: 'fallback',\n01698|             kind: 'locality'\n01699|           },\n01700|           precision: 'fallback'\n01701|         };\n01702|       }\n01703|     }\n01704|     \n01705|     console.warn(`‚ùå –ü–≠–ö —Ñ–æ–ª–ª–±—ç–∫: –≥–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ \"${address}\"`);\n01706|     return null;\n01707|   };\n01708| \n01709|   // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –ü–≠–ö\n01710|   const getPekNearestDepartments = async (address: string, coordinates?: { latitude: string, longitude: string }) => {\n01711|     try {\n01712|       console.log(`üè¢ –ü–≠–ö: –ø–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –¥–ª—è \"${address}\"`);\n01713|       \n01714|       const requestBody: any = {\n01715|         departmentOperation: 3, // –≤—ã–¥–∞—á–∞ –≥—Ä—É–∑–æ–≤\n01716|         type: 3, // –∞–≤—Ç–æ-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç\n01717|         searchRadius: 50, // –∫–º\n01718|         limit: 5\n01719|       };\n01720|       \n01721|       // –ü–≠–ö API —Ç—Ä–µ–±—É–µ—Ç –∏ –∞–¥—Ä–µ—Å, –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ\n01722|       requestBody.address = address;\n01723|       \n01724|       if (coordinates) {\n01725|         requestBody.coordinates = coordinates;\n01726|         console.log(`üìç –ü–≠–ö: –ø–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\" –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º`, coordinates);\n01727|       } else {\n01728|         console.log(`üìç –ü–≠–ö: –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\"`);\n01729|       }\n01730|       \n01731|       const response = await fetch('/api/pek', {\n01732|         method: 'POST',\n01733|         headers: {\n01734|           'Content-Type': 'application/json',\n01735|         },\n01736|         body: JSON.stringify({\n01737|           method: 'nearestdepartments',\n01738|           ...requestBody\n01739|         })\n01740|       });\n01741| \n01742|       console.log(`üì° –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API —Å—Ç–∞—Ç—É—Å: ${response.status}`);\n01743|       \n01744|       if (!response.ok) {\n01745|         const errorText = await response.text();\n01746|         console.error(`‚ùå –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API –æ—à–∏–±–∫–∞: ${response.status} ${response.statusText}`);\n01747|         console.error(`‚ùå –û—Ç–≤–µ—Ç:`, errorText.substring(0, 500));\n01748|         return null;\n01749|       }\n01750| \n01751|       const data = await response.json();\n01752|       console.log(`‚úÖ –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–∞–π–¥–µ–Ω—ã:`, data);\n01753|       \n01754|       // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤–æ–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ —Å –Ω–∞–∏–≤—ã—Å—à–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º\n01755|       if (data.freeDepartments && data.freeDepartments.length > 0) {\n01756|         const bestDepartment = data.freeDepartments.sort((a: any, b: any) => b.priority - a.priority)[0];\n01757|         console.log(`‚úÖ –ü–≠–ö: –≤—ã–±—Ä–∞–Ω–æ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ`, bestDepartment.divisionName);\n01758|         return {\n01759|           warehouseId: bestDepartment.warehouseId,\n01760|           branchId: bestDepartment.branchId,\n01761|           branchName: bestDepartment.branchName,\n01762|           divisionName: bestDepartment.divisionName,\n01763|           address: bestDepartment.address,\n01764|           coordinates: bestDepartment.coordinates,\n01765|           phone: bestDepartment.phone,\n01766|           email: bestDepartment.email\n01767|         };\n01768|       }\n01769|       \n01770|       console.warn(`‚ùå –ü–≠–ö: –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è \"${address}\"`);\n01771|       return null;\n01772|     } catch (error) {\n01773|       console.error('‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –æ—Ç–¥–µ–ª–µ–Ω–∏–π:', error);\n01774|       return null;\n01775|     }\n01776|   };\n01777| \n01778|   // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ü–≠–ö)\n01779|   const getYandexCoordinates = async (address: string): Promise<{ latitude: string, longitude: string } | null> => {\n01780|     try {\n01781|       const encodedAddress = encodeURIComponent(address);\n01782|       const response = await fetch(`https://geocode-maps.yandex.ru/1.x/?apikey=YOUR_API_KEY&geocode=${encodedAddress}&format=json`);\n01783|       \n01784|       if (!response.ok) return null;\n01785|       \n01786|       const data = await response.json();\n01787|       const coords = data?.response?.GeoObjectCollection?.featureMember?.[0]?.GeoObject?.Point?.pos?.split(' ');\n01788|       \n01789|       if (coords && coords.length === 2) {\n01790|         return {\n01791|           longitude: coords[0],\n01792|           latitude: coords[1]\n01793|         };\n01794|       }\n01795|       \n01796|       return null;\n01797|     } catch (error) {\n01798|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ø–Ω–¥–µ–∫—Å:', error);\n01799|       return null;\n01800|     }\n01801|   };\n01802| \n01803|   // –†–∞—Å—á–µ—Ç –¥–ª—è –ü–≠–ö —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API v1/calculateprice/\n01804|   const calculatePEK = async (): Promise<CalculationResult> => {\n01805|     const apiUrl = 'https://kabinet.pecom.ru/api/v1/calculateprice/';\n01806|     \n01807|     // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç\n01808|     const validateCoordinates = (coords: any) => {\n01809|       console.log('üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:', coords);\n01810|       \n01811|       if (!coords) {\n01812|         console.log('‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç');\n01813|         return null;\n01814|       }\n01815|       \n01816|       if (typeof coords.latitude !== 'number' || typeof coords.longitude !== 'number') {\n01817|         console.warn(`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ —è–≤–ª—è—é—Ç—Å—è —á–∏—Å–ª–∞–º–∏:`, { \n01818|           lat: coords.latitude, \n01819|           lng: coords.longitude,\n01820|           latType: typeof coords.latitude,\n01821|           lngType: typeof coords.longitude\n01822|         });\n01823|         return null;\n01824|       }\n01825|       \n01826|       const lat = Number(coords.latitude);\n01827|       const lng = Number(coords.longitude);\n01828|       \n01829|       console.log(`üìç –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: lat=${lat}, lng=${lng}`);\n01830|       \n01831|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω—ã\n01832|       if (lat < -90 || lat > 90 || lng < -180 || lng > 180 || isNaN(lat) || isNaN(lng)) {\n01833|         console.warn(`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–Ω–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞:`, { \n01834|           lat, lng, \n01835|           latValid: lat >= -90 && lat <= 90,\n01836|           lngValid: lng >= -180 && lng <= 180,\n01837|           latIsNaN: isNaN(lat),\n01838|           lngIsNaN: isNaN(lng)\n01839|         });\n01840|         return null;\n01841|       }\n01842|       \n01843|       console.log('‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã:', { latitude: lat, longitude: lng });\n01844|       return { latitude: lat, longitude: lng };\n01845|     };\n01846|     \n01847|     try {\n01848|       // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–æ–Ω–∞—Ö –∏ —Å–∫–ª–∞–¥–∞—Ö –ø–æ –∞–¥—Ä–µ—Å–∞–º\n01849|       console.log(`üöÄ –ü–≠–ö: –Ω–∞—á–∏–Ω–∞–µ–º —Ä–∞—Å—á–µ—Ç`);\n01850|       console.log(`üìç –û—Ç: ${form.fromAddress || form.fromCity}`);\n01851|       console.log(`üìç –î–æ: ${form.toAddress || form.toCity}`);\n01852|       \n01853|       const senderZone = await getPekZoneByAddress(form.fromAddress || `–≥ ${form.fromCity}`);\n01854|       const receiverZone = await getPekZoneByAddress(form.toAddress || `–≥ ${form.toCity}`);\n01855|       \n01856|       console.log(`üîç –ü–≠–ö –∑–æ–Ω—ã:`);\n01857|       console.log(`üìç –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å:`, senderZone ? `${senderZone.branchTitle} (${senderZone.mainWarehouseId})` : '–ù–ï –ù–ê–ô–î–ï–ù–ê');\n01858|       console.log(`üìç –ü–æ–ª—É—á–∞—Ç–µ–ª—å:`, receiverZone ? `${receiverZone.branchTitle} (${receiverZone.mainWarehouseId})` : '–ù–ï –ù–ê–ô–î–ï–ù–ê');\n01859|       \n01860|       if (!senderZone || !receiverZone) {\n01861|         // –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞\n01862|         const debugInfo = {\n01863|           senderAddress: form.fromAddress || form.fromCity,\n01864|           receiverAddress: form.toAddress || form.toCity,\n01865|           senderZoneFound: !!senderZone,\n01866|           receiverZoneFound: !!receiverZone,\n01867|           apiTested: true\n01868|         };\n01869|         \n01870|         console.error(`‚ùå –ü–≠–ö: –∑–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã`, debugInfo);\n01871|         \n01872|         return {\n01873|           company: '–ü–≠–ö',\n01874|           price: 0,\n01875|           days: 0,\n01876|           error: `–ó–æ–Ω–∞ –ü–≠–ö –Ω–µ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥—Ä–µ—Å–∞: ${!senderZone ? (form.fromAddress || form.fromCity) : ''} ${!receiverZone ? (form.toAddress || form.toCity) : ''}`.trim(),\n01877|           apiUrl,\n01878|           requestData: debugInfo,\n01879|           responseData: { senderZone, receiverZone }\n01880|         };\n01881|       }\n01882| \n01883|       // –ü–æ–ª—É—á–∞–µ–º –±–ª–∏–∂–∞–π—à–∏–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –∞–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞\n01884|       let senderWarehouseId = senderZone.mainWarehouseId;\n01885|       let receiverWarehouseId = receiverZone.mainWarehouseId;\n01886|       \n01887|       if (form.fromAddressDelivery && senderZone.warehousePoint) {\n01888|         const validSenderCoords = validateCoordinates(senderZone.warehousePoint);\n01889|         if (validSenderCoords) {\n01890|           try {\n01891|             const senderDepartment = await getPekNearestDepartments(\n01892|               form.fromAddress || form.fromCity,\n01893|               {\n01894|                 latitude: validSenderCoords.latitude.toString(),\n01895|                 longitude: validSenderCoords.longitude.toString()\n01896|               }\n01897|             );\n01898|             if (senderDepartment) {\n01899|               senderWarehouseId = senderDepartment.warehouseId;\n01900|               console.log('‚úÖ –ù–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π —Å–∫–ª–∞–¥ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è:', senderDepartment.warehouseId);\n01901|             }\n01902|           } catch (error) {\n01903|             console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥:', error);\n01904|           }\n01905|         } else {\n01906|           console.warn('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥');\n01907|         }\n01908|       }\n01909|       \n01910|       if (form.toAddressDelivery && receiverZone.warehousePoint) {\n01911|         const validReceiverCoords = validateCoordinates(receiverZone.warehousePoint);\n01912|         if (validReceiverCoords) {\n01913|           try {\n01914|             const receiverDepartment = await getPekNearestDepartments(\n01915|               form.toAddress || form.toCity,\n01916|               {\n01917|                 latitude: validReceiverCoords.latitude.toString(),\n01918|                 longitude: validReceiverCoords.longitude.toString()\n01919|               }\n01920|             );\n01921|             if (receiverDepartment) {\n01922|               receiverWarehouseId = receiverDepartment.warehouseId;\n01923|               console.log('‚úÖ –ù–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π —Å–∫–ª–∞–¥ –ø–æ–ª—É—á–∞—Ç–µ–ª—è:', receiverDepartment.warehouseId);\n01924|             }\n01925|           } catch (error) {\n01926|             console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥:', error);\n01927|           }\n01928|         } else {\n01929|           console.warn('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥');\n01930|         }\n01931|       }\n01932| \n01933|       // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞—Ç—ã N –¥–Ω–µ–π –æ—Ç —Å–µ–≥–æ–¥–Ω—è\n01934|       const getDateForCalculation = (daysFromToday: number): string => {\n01935|         const date = new Date();\n01936|         date.setDate(date.getDate() + daysFromToday);\n01937|         return date.toISOString().slice(0, 19); // 2025-09-28T14:00:00\n01938|       };\n01939| \n01940|       // –ù–∞—á–∏–Ω–∞–µ–º —Å –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–≥–æ –¥–Ω—è\n01941|       let currentDayOffset = 1;\n01942|       let plannedDateTime = getDateForCalculation(currentDayOffset);\n01943| \n01944|       // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤ (–±–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç)\n01945|       const cargos = form.cargos.map(cargo => {\n01946|         const cargoData = {\n01947|           length: cargo.length / 100, // –ø–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–µ—Ç—Ä—ã\n01948|           width: cargo.width / 100,\n01949|           height: cargo.height / 100,\n01950|           volume: (cargo.length * cargo.width * cargo.height) / 1000000, // –º3\n01951|           weight: cargo.weight,\n01952|           isHP: form.needPackaging, // –∑–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n01953|           sealingPositionsCount: 0\n01954|         };\n01955|         \n01956|         console.log('üì¶ –ì—Ä—É–∑ –¥–ª—è –ü–≠–ö:', cargoData);\n01957|         return cargoData;\n01958|       });\n01959| \n01960|       // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (–Ω—É–∂–Ω–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ)\n01961|       let finalRequestData: any = null;\n01962|       \n01963|       // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ —Ä–∞—Å—á–µ—Ç–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç–æ–π\n01964|       const tryCalculateWithDate = async (plannedDateTime: string): Promise<any> => {\n01965|         // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –∫ API –ü–≠–ö —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n01966|         const requestData: any = {\n01967|           currencyCode: \"643\", // —Ä—É–±–ª–∏\n01968|           types: [3], // —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ –ø–µ—Ä–µ–≤–æ–∑–∫–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –º–∞—Å—Å–∏–≤)\n01969|           senderWarehouseId,\n01970|           receiverWarehouseId,\n01971|           isOpenCarSender: false,\n01972|           isOpenCarReceiver: false,\n01973|           isHyperMarket: false,\n01974|           plannedDateTime,\n01975|           isInsurance: form.needInsurance && form.declaredValue > 0,\n01976|           isInsurancePrice: form.needInsurance ? form.declaredValue : 0,\n01977|           isPickUp: form.fromAddressDelivery,\n01978|           isDelivery: form.toAddressDelivery,\n01979|           needReturnDocuments: false,\n01980|           needArrangeTransportationDocuments: false,\n01981|           senderDistanceType: 0,\n01982|           receiverDistanceType: 0,\n01983|           cargos // –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤\n01984|         };\n01985|         \n01986|         console.log('üìã –ü–≠–ö: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ requestData:', JSON.stringify(requestData, null, 2));\n01987| \n01988|         // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏ –ü–†–† –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\n01989|         if (form.needCarry) {\n01990|           requestData.pickupServices = {\n01991|             isLoading: true,\n01992|             floor: Math.max(0, form.floor - 1), // –ü–≠–ö —Å—á–∏—Ç–∞–µ—Ç —Å 0\n01993|             carryingDistance: 0,\n01994|             isElevator: form.hasFreightLift\n01995|           };\n01996|           requestData.deliveryServices = {\n01997|             isLoading: true,\n01998|             floor: Math.max(0, form.floor - 1),\n01999|             carryingDistance: 0,\n02000|             isElevator: form.hasFreightLift\n\n(File has more lines. Use 'offset' parameter to read beyond line 2000)\n</file>",
    "metadata": {
      "preview": "'use client';\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Switch } from '@/components/ui/switch';\nimport { Plus, Truck, Building2, Map, Settings, Package2 } from 'lucide-react';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { Collapsible, CollapsibleContent } from '@/components/ui/collapsible';\nimport ProductSearch from '@/components/ProductSearch';\nimport ProductManager from '@/components/ProductManager';\nimport TruckVisualization from '@/components/TruckVisualization';\nimport { FurnitureProduct, ProductInForm, CargoWithMetadata } from '@/lib/furniture-types';\nimport { \n  createCargosForProduct, "
    },
    "title": "app/page.tsx",
    "time": {
      "start": 1759739372978,
      "end": 1759739372988
    }
  }
}