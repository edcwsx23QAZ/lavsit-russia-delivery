{
  "id": "prt_9ba37ccda001EjzMCpiKMjuLP7",
  "messageID": "msg_9ba37a46b0013egSdA023iJu20",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "read",
  "callID": "toolu_013Vs6NbDwnpiDaDCpu56HEP",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx"
    },
    "output": "<file>\n00001| 'use client';\n00002| \n00003| import React, { useState, useEffect, useCallback, useMemo } from 'react';\n00004| import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\n00005| import { Button } from '@/components/ui/button';\n00006| import { Input } from '@/components/ui/input';\n00007| import { Label } from '@/components/ui/label';\n00008| import { Checkbox } from '@/components/ui/checkbox';\n00009| import { Switch } from '@/components/ui/switch';\n00010| import { Plus, Truck, Building2, Map, Settings, Package2, Trash2 } from 'lucide-react';\n00011| import { Alert, AlertDescription } from '@/components/ui/alert';\n00012| import { Badge } from '@/components/ui/badge';\n00013| import { Separator } from '@/components/ui/separator';\n00014| import { Collapsible, CollapsibleContent } from '@/components/ui/collapsible';\n00015| import ProductSearch from '@/components/ProductSearch';\n00016| import ProductManager from '@/components/ProductManager';\n00017| import TruckVisualization from '@/components/TruckVisualization';\n00018| import { FurnitureProduct, ProductInForm, CargoWithMetadata } from '@/lib/furniture-types';\n00019| import { saveFormData, loadFormData, hasStoredFormData, createDebouncedSaver, clearFormData } from '@/lib/form-storage';\n00020| import { \n00021|   createCargosForProduct, \n00022|   removeCargosForProduct, \n00023|   calculateTotalValue,\n00024|   findCargoIndexesForProduct \n00025| } from '@/lib/furniture-utils';\n00026| \n00027| interface Cargo {\n00028|   id: string;\n00029|   length: number;\n00030|   width: number;\n00031|   height: number;\n00032|   weight: number;\n00033|   // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–≤—è–∑–∏ —Å —Ç–æ–≤–∞—Ä–∞–º–∏\n00034|   productId?: string;\n00035|   placeNumber?: number;\n00036|   isFromProduct?: boolean;\n00037|   addedAt?: number;\n00038| }\n00039| \n00040| interface DeliveryForm {\n00041|   cargos: Cargo[];\n00042|   fromCity: string;\n00043|   toCity: string;\n00044|   fromAddress: string;\n00045|   toAddress: string;\n00046|   declaredValue: number;\n00047|   needPackaging: boolean;\n00048|   needLoading: boolean;\n00049|   needCarry: boolean;\n00050|   floor: number;\n00051|   hasFreightLift: boolean;\n00052|   needInsurance: boolean;\n00053|   fromTerminal: boolean;\n00054|   toTerminal: boolean;\n00055|   fromAddressDelivery: boolean;\n00056|   toAddressDelivery: boolean;\n00057|   fromLavsiteWarehouse: boolean;\n00058|   // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ç–æ–≤–∞—Ä–æ–≤\n00059|   selectedProducts: ProductInForm[];\n00060| }\n00061| \n00062| interface CalculationResult {\n00063|   company: string;\n00064|   price: number;\n00065|   days: number;\n00066|   details?: any;\n00067|   error?: string;\n00068|   requestData?: any;\n00069|   responseData?: any;\n00070|   apiUrl?: string;\n00071|   sessionId?: string;\n00072| }\n00073| \n00074| interface AddressSuggestion {\n00075|   value: string;\n00076|   unrestricted_value: string;\n00077|   data: {\n00078|     city?: string;\n00079|     street?: string;\n00080|     house?: string;\n00081|   };\n00082| }\n00083| \n00084| // –û–ø—Ä–µ–¥–µ–ª–∏–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–º–ø–∞–Ω–∏–π\n00085| const COMPANIES_BASE = [\n00086|   { name: '–ü–≠–ö', logo: 'üöõ', apiKey: 'pek' },\n00087|   { name: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏', logo: 'üì¶', apiKey: 'dellin' },\n00088|   { name: 'Rail Continent', logo: 'üöÇ', apiKey: 'railcontinent' },\n00089|   { name: '–í–æ–∑–æ–≤–æ–∑', logo: 'üöö', apiKey: 'vozovoz' },\n00090|   { name: 'Nord Wheel', logo: 'üåê', apiKey: 'nordwheel' },\n00091|   { name: '–°–¥—ç–∫', logo: 'üìÆ', apiKey: 'cdek' },\n00092|   { name: '–ù–æ–≤–∞—è –ª–∏–Ω–∏—è', logo: 'üõ£Ô∏è', apiKey: 'newline' },\n00093|   { name: '–ò—Ä-–¢—Ä–∞—Å—Ç', logo: 'üè≠', apiKey: 'irtrust' },\n00094|   { name: '–ú–∞–π–æ—Ä —Ç—Ä–∞–Ω—Å', logo: '‚≠ê', apiKey: 'majortrans' },\n00095|   { name: '–ë–ê–ô–ö–ê–õ –°–ï–†–í–ò–°', logo: 'üåä', apiKey: 'baikalservice' },\n00096|   { name: '–ê–¥–∞–º–∞–Ω—Ç', logo: 'üíé', apiKey: 'adamant' },\n00097|   { name: '–≠–ù–ï–†–ì–ò–Ø', logo: '‚ö°', apiKey: 'energiya' },\n00098|   { name: '–¶–ê–ü', logo: 'üéØ', apiKey: 'cap' },\n00099|   { name: '–£—Ä–∞–ª–¢—Ä–∞–Ω—Å–ö–æ–º–ø–∞–Ω–∏', logo: '‚õ∞Ô∏è', apiKey: 'uraltrans' },\n00100|   { name: '–ù–û–í–û–¢–≠–ö', logo: 'üîß', apiKey: 'novotek' },\n00101|   { name: '–ö–∏—Ç', logo: 'üêã', apiKey: 'kit' },\n00102|   { name: '–ö–∞—Ä–∞–≤–∞–Ω', logo: 'üê™', apiKey: 'karavan' },\n00103|   { name: '–ñ–µ–ª–î–æ—Ä–≠–∫—Å–ø–µ–¥–∏—Ü–∏—è', logo: 'üöÑ', apiKey: 'zeldor' },\n00104|   { name: '–î–ö –¢—Ä–∞–Ω–∑–∏—Ç', logo: 'üöê', apiKey: 'dktransit' },\n00105|   { name: '–ì–ª–∞–≤—Ç—Ä–∞—Å—Å–∞', logo: 'üõ§Ô∏è', apiKey: 'glavtrassa' },\n00106|   { name: '–ë–∞–ª—Ç–∏–π—Å–∫–∞—è –°–ª—É–∂–±–∞ –î–æ—Å—Ç–∞–≤–∫–∏', logo: '‚öì', apiKey: 'baltservice' },\n00107|   { name: '–ê–ù–ö–û–†', logo: 'üîó', apiKey: 'ankor' }\n00108| ];\n00109| \n00110| export default function Home() {\n00111|   // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n00112|   const initialFormState: DeliveryForm = {\n00113|     cargos: [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00114|     fromCity: '',\n00115|     toCity: '',\n00116|     fromAddress: '',\n00117|     toAddress: '',\n00118|     declaredValue: 0,\n00119|     needPackaging: false,\n00120|     needLoading: false,\n00121|     needCarry: false,\n00122|     floor: 1,\n00123|     hasFreightLift: false,\n00124|     needInsurance: false,\n00125|     fromTerminal: true,\n00126|     toTerminal: true,\n00127|     fromAddressDelivery: false,\n00128|     toAddressDelivery: false,\n00129|     fromLavsiteWarehouse: false,\n00130|     selectedProducts: []\n00131|   };\n00132| \n00133|   const [form, setForm] = useState<DeliveryForm>(initialFormState);\n00134|   const [isLoaded, setIsLoaded] = useState(false);\n00135|   const [isRestoring, setIsRestoring] = useState(false);\n00136|   const [lastSaveTime, setLastSaveTime] = useState<Date | null>(null);\n00137|   const [isFormChanged, setIsFormChanged] = useState(false);\n00138|   \n00139|   // –°–æ–∑–¥–∞–µ–º –¥–µ–±–∞—É–Ω—Å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (—Å–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è)\n00140|   const debouncedSave = useMemo(() => {\n00141|     const saver = createDebouncedSaver(1000);\n00142|     // –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã\n00143|     return (formData: any) => {\n00144|       setIsFormChanged(true);\n00145|       saver(formData);\n00146|       // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É\n00147|       setTimeout(() => {\n00148|         setLastSaveTime(new Date());\n00149|         setIsFormChanged(false);\n00150|       }, 1100);\n00151|     };\n00152|   }, []);\n00153| \n00154|   const [suggestions, setSuggestions] = useState<AddressSuggestion[]>([]);\n00155|   const [showSuggestions, setShowSuggestions] = useState(false);\n00156|   const [activeField, setActiveField] = useState('');\n00157|   \n00158|   // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω–∏–µ–º/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n00159|   const [enabledCompanies, setEnabledCompanies] = useState<Record<string, boolean>>({\n00160|     pek: true,\n00161|     dellin: true,\n00162|     railcontinent: true,\n00163|     vozovoz: true,\n00164|     nordwheel: true,\n00165|     cdek: false,\n00166|     newline: false,\n00167|     irtrust: false,\n00168|     majortrans: false,\n00169|     baikalservice: false,\n00170|     adamant: false,\n00171|     energiya: false,\n00172|     cap: false,\n00173|     uraltrans: false,\n00174|     novotek: false,\n00175|     kit: false,\n00176|     karavan: false,\n00177|     zeldor: false,\n00178|     dktransit: false,\n00179|     glavtrassa: false,\n00180|     baltservice: false,\n00181|     ankor: false\n00182|   });\n00183|   const [calculations, setCalculations] = useState<CalculationResult[]>([]);\n00184|   const [calculating, setCalculating] = useState(false);\n00185|   const [expandedDetails, setExpandedDetails] = useState<{ [key: string]: boolean }>({});\n00186|   const [expandedDebugInfo, setExpandedDebugInfo] = useState<{ [key: string]: boolean }>({});\n00187|   const [suggestionPosition, setSuggestionPosition] = useState({ top: 0, left: 0 });\n00188|   const [apiStatus, setApiStatus] = useState({\n00189|     pek: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00190|     dellin: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00191|     railcontinent: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00192|     vozovoz: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00193|     nordwheel: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00194|     cdek: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00195|     newline: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00196|     irtrust: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00197|     majortrans: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00198|     baikalservice: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00199|     adamant: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00200|     energiya: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00201|     cap: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00202|     uraltrans: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00203|     novotek: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00204|     kit: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00205|     karavan: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00206|     zeldor: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00207|     dktransit: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00208|     glavtrassa: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00209|     baltservice: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00210|     ankor: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ'\n00211|   });\n00212| \n00213|   // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö - –ù–ï –æ—á–∏—â–∞–µ–º localStorage –≤ dev —Ä–µ–∂–∏–º–µ\n00214|   // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞–º–∏\n00215| \n00216|   // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏\n00217|   useEffect(() => {\n00218|     if (typeof window !== 'undefined' && isLoaded) {\n00219|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ (–ø–æ—Å–ª–µ Clear-Site-Data)\n00220|       const delayedCheck = setTimeout(() => {\n00221|         const currentFormData = loadFormData();\n00222|         if (!currentFormData) {\n00223|           console.log('üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –∏—â–µ–º backup...');\n00224|           \n00225|           // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ backup –¥–∞–Ω–Ω—ã–µ\n00226|           const backupKeys = ['formBackup1', 'formBackup2', 'formBackup3'];\n00227|           for (const key of backupKeys) {\n00228|             const backup = localStorage.getItem(key);\n00229|             if (backup) {\n00230|               try {\n00231|                 localStorage.setItem('deliveryFormData', backup);\n00232|                 console.log('üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ backup:', key);\n00233|                 \n00234|                 // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ\n00235|                 const restoredData = loadFormData();\n00236|                 if (restoredData) {\n00237|                   setIsRestoring(true);\n00238|                   const restoredForm: DeliveryForm = {\n00239|                     cargos: restoredData.cargos.length > 0 ? restoredData.cargos : [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00240|                     fromCity: restoredData.fromCity,\n00241|                     toCity: restoredData.toCity,\n00242|                     fromAddress: restoredData.fromAddress,\n00243|                     toAddress: restoredData.toAddress,\n00244|                     declaredValue: restoredData.declaredValue,\n00245|                     needPackaging: restoredData.needPackaging,\n00246|                     needLoading: restoredData.needLoading,\n00247|                     needCarry: restoredData.needCarry,\n00248|                     floor: restoredData.floor,\n00249|                     hasFreightLift: restoredData.hasFreightLift,\n00250|                     needInsurance: restoredData.needInsurance,\n00251|                     fromTerminal: restoredData.fromTerminal,\n00252|                     toTerminal: restoredData.toTerminal,\n00253|                     fromAddressDelivery: restoredData.fromAddressDelivery,\n00254|                     toAddressDelivery: restoredData.toAddressDelivery,\n00255|                     fromLavsiteWarehouse: restoredData.fromLavsiteWarehouse || false,\n00256|                     selectedProducts: restoredData.selectedProducts,\n00257|                   };\n00258|                   setForm(restoredForm);\n00259|                   if (restoredData.enabledCompanies && Object.keys(restoredData.enabledCompanies).length > 0) {\n00260|                     setEnabledCompanies(restoredData.enabledCompanies);\n00261|                   }\n00262|                   setTimeout(() => setIsRestoring(false), 100);\n00263|                   console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!');\n00264|                 }\n00265|                 break;\n00266|               } catch (e) {\n00267|                 console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ backup:', key, e);\n00268|               }\n00269|             }\n00270|           }\n00271|         }\n00272|       }, 2000);\n00273|       \n00274|       return () => clearTimeout(delayedCheck);\n00275|     }\n00276|   }, [isLoaded]);\n00277| \n00278|   // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)\n00279|   useEffect(() => {\n00280|     // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ\n00281|     if (typeof window !== 'undefined' && !isLoaded) {\n00282|       let dataRestored = false;\n00283|       try {\n00284|         setIsRestoring(true); // –ë–ª–æ–∫–∏—Ä—É–µ–º –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è\n00285|         \n00286|         // –ú—è–≥–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –±–µ–∑ –æ—á–∏—Å—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö\n00287|         const currentVersion = 'v2.4.0-persistent-storage'; // –í–µ—Ä—Å–∏—è —Å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º\n00288|         const savedVersion = localStorage.getItem('appVersion');\n00289|         \n00290|         if (savedVersion !== currentVersion) {\n00291|           console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ', currentVersion);\n00292|           // –ù–ï –æ—á–∏—â–∞–µ–º localStorage - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ\n00293|           localStorage.setItem('appVersion', currentVersion);\n00294|         }\n00295|         \n00296|         // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É\n00297|         const savedFormData = loadFormData();\n00298|         if (savedFormData) {\n00299|           // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞\n00300|           const restoredForm: DeliveryForm = {\n00301|             cargos: savedFormData.cargos.length > 0 ? savedFormData.cargos : [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00302|             fromCity: savedFormData.fromCity,\n00303|             toCity: savedFormData.toCity,\n00304|             fromAddress: savedFormData.fromAddress,\n00305|             toAddress: savedFormData.toAddress,\n00306|             declaredValue: savedFormData.declaredValue,\n00307|             needPackaging: savedFormData.needPackaging,\n00308|             needLoading: savedFormData.needLoading,\n00309|             needCarry: savedFormData.needCarry,\n00310|             floor: savedFormData.floor,\n00311|             hasFreightLift: savedFormData.hasFreightLift,\n00312|             needInsurance: savedFormData.needInsurance,\n00313|             fromTerminal: savedFormData.fromTerminal,\n00314|             toTerminal: savedFormData.toTerminal,\n00315|             fromAddressDelivery: savedFormData.fromAddressDelivery,\n00316|             toAddressDelivery: savedFormData.toAddressDelivery,\n00317|             fromLavsiteWarehouse: savedFormData.fromLavsiteWarehouse || false,\n00318|             selectedProducts: savedFormData.selectedProducts,\n00319|           };\n00320|           \n00321|           setForm(restoredForm);\n00322|           \n00323|           // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n00324|           if (savedFormData.enabledCompanies && Object.keys(savedFormData.enabledCompanies).length > 0) {\n00325|             setEnabledCompanies(savedFormData.enabledCompanies);\n00326|           }\n00327|           console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ localStorage');\n00328|           \n00329|           // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è Supabase\n00330|           const currentTime = Math.floor(Date.now() / 1000);\n00331|           console.log('üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (timestamp):', currentTime);\n00332|           console.log('üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (ISO):', new Date().toISOString());\n00333|           \n00334|           dataRestored = true;\n00335|           // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—Å–ø–µ–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è\n00336|           setTimeout(() => {\n00337|             setIsRestoring(false);\n00338|           }, 100);\n00339|         } else {\n00340|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏\n00341|           const oldSaved = localStorage.getItem('deliveryForm');\n00342|           if (oldSaved) {\n00343|             console.log('üîÑ –ù–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç–∞—Ä–æ–º —Ñ–æ—Ä–º–∞—Ç–µ, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è...');\n00344|             const oldForm = JSON.parse(oldSaved);\n00345|             if (!oldForm.cargos || oldForm.cargos.length === 0) {\n00346|               oldForm.cargos = [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }];\n00347|             }\n00348|             setForm(oldForm);\n00349|             \n00350|             // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –∏ —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ\n00351|             saveFormData(oldForm);\n00352|             localStorage.removeItem('deliveryForm');\n00353|             console.log('‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');\n00354|             \n00355|             dataRestored = true;\n00356|             // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—Å–ø–µ–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è\n00357|             setTimeout(() => {\n00358|               setIsRestoring(false);\n00359|             }, 100);\n00360|           }\n00361|         }\n00362|         \n00363|         // –í—ã–≤–æ–¥–∏–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¢–ö –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n00364|         console.log('üìã –í—Å–µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ –¢–ö:', COMPANIES_BASE.length);\n00365|         console.log('üìã –°–ø–∏—Å–æ–∫ –¢–ö:', COMPANIES_BASE.map(c => c.name));\n00366|         \n00367|       } catch (error) {\n00368|         console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);\n00369|         // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ\n00370|       } finally {\n00371|         // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, —Å—Ä–∞–∑—É —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ\n00372|         if (!dataRestored) {\n00373|           setIsRestoring(false);\n00374|         }\n00375|         setIsLoaded(true);\n00376|       }\n00377|     }\n00378|   }, [isLoaded]);\n00379| \n00380|   // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–æ—Ä–º—ã (—Å –¥–µ–±–∞—É–Ω—Å–æ–º)\n00381|   useEffect(() => {\n00382|     if (typeof window !== 'undefined' && isLoaded && !isRestoring) {\n00383|       // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–±–∞—É–Ω—Å –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è\n00384|       debouncedSave({\n00385|         cargos: form.cargos,\n00386|         fromCity: form.fromCity,\n00387|         toCity: form.toCity,\n00388|         fromAddress: form.fromAddress,\n00389|         toAddress: form.toAddress,\n00390|         declaredValue: form.declaredValue,\n00391|         needPackaging: form.needPackaging,\n00392|         needLoading: form.needLoading,\n00393|         needCarry: form.needCarry,\n00394|         floor: form.floor,\n00395|         hasFreightLift: form.hasFreightLift,\n00396|         needInsurance: form.needInsurance,\n00397|         fromTerminal: form.fromTerminal,\n00398|         toTerminal: form.toTerminal,\n00399|         fromAddressDelivery: form.fromAddressDelivery,\n00400|         toAddressDelivery: form.toAddressDelivery,\n00401|         fromLavsiteWarehouse: form.fromLavsiteWarehouse,\n00402|         selectedProducts: form.selectedProducts,\n00403|         enabledCompanies: enabledCompanies,\n00404|       });\n00405|     }\n00406|   }, [form, enabledCompanies, isLoaded, isRestoring, debouncedSave]);\n00407| \n00408|   // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –ø—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n00409|   useEffect(() => {\n00410|     if (form.declaredValue > 0) {\n00411|       setForm(prev => ({ ...prev, needInsurance: true }));\n00412|     }\n00413|   }, [form.declaredValue]);\n00414| \n00415|   // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤\n00416|   useEffect(() => {\n00417|     const handleMessage = (event: MessageEvent) => {\n00418|       if (event.data && event.data.type === 'PRODUCTS_UPDATED') {\n00419|         console.log('üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤:', event.data.data);\n00420|         \n00421|         // –û—á–∏—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫—ç—à–∏ —Ç–æ–≤–∞—Ä–æ–≤\n00422|         const keysToRemove: string[] = [];\n00423|         for (let i = 0; i < localStorage.length; i++) {\n00424|           const key = localStorage.key(i);\n00425|           if (key && (key.startsWith('furniture_') || key.startsWith('product_') || key.includes('ProductSearch'))) {\n00426|             keysToRemove.push(key);\n00427|           }\n00428|         }\n00429|         keysToRemove.forEach(key => localStorage.removeItem(key));\n00430|         console.log(`üßΩ –û—á–∏—â–µ–Ω–æ ${keysToRemove.length} –∫–ª—é—á–µ–π –∫—ç—à–∞ —Ç–æ–≤–∞—Ä–æ–≤`);\n00431|         \n00432|         // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É ProductSearch –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è\n00433|         window.dispatchEvent(new CustomEvent('forceProductsReload', {\n00434|           detail: event.data.data\n00435|         }));\n00436|       }\n00437|     };\n00438|     \n00439|     window.addEventListener('message', handleMessage);\n00440|     \n00441|     return () => {\n00442|       window.removeEventListener('message', handleMessage);\n00443|     };\n00444|   }, []);\n00445| \n00446|   // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã\n00447|   useEffect(() => {\n00448|     if (typeof window !== 'undefined' && isLoaded) {\n00449|       checkAllAPIStatus();\n00450|     }\n00451|   }, [isLoaded]);\n00452| \n00453|   const checkAPIStatus = async (apiName: string, testFunction: () => Promise<any>) => {\n00454|     try {\n00455|       const result = await testFunction();\n00456|       if (result && !result.error) {\n00457|         setApiStatus(prev => ({ ...prev, [apiName]: '–ø–æ–¥–∫–ª—é—á–µ–Ω–æ' }));\n00458|       } else {\n00459|         setApiStatus(prev => ({ ...prev, [apiName]: '–æ—à–∏–±–∫–∞' }));\n00460|       }\n00461|     } catch (error) {\n00462|       setApiStatus(prev => ({ ...prev, [apiName]: '–æ—à–∏–±–∫–∞' }));\n00463|     }\n00464|   };\n00465| \n00466|   const checkAllAPIStatus = async () => {\n00467|     // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\n00468|     const testData = {\n00469|       fromCity: '–ú–æ—Å–∫–≤–∞',\n00470|       toCity: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', \n00471|       cargos: [{ id: '1', length: 100, width: 100, height: 100, weight: 10 }],\n00472|       declaredValue: 50000,\n00473|       fromAddressDelivery: false,\n00474|       toAddressDelivery: false,\n00475|       needPackaging: false,\n00476|       needInsurance: false\n00477|     };\n00478| \n00479|     // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n00480|     const currentForm = form;\n00481|     \n00482|     // –í—Ä–µ–º–µ–Ω–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ\n00483|     setForm({\n00484|       ...form,\n00485|       fromCity: testData.fromCity,\n00486|       toCity: testData.toCity,\n00487|       cargos: testData.cargos,\n00488|       declaredValue: testData.declaredValue,\n00489|       fromAddressDelivery: testData.fromAddressDelivery,\n00490|       toAddressDelivery: testData.toAddressDelivery,\n00491|       needPackaging: testData.needPackaging,\n00492|       needInsurance: testData.needInsurance\n00493|     });\n00494| \n00495|     // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ\n00496|     Promise.all([\n00497|       checkAPIStatus('pek', async () => {\n00498|         try {\n00499|           const response = await fetch('/api/pek', {\n00500|             method: 'POST',\n00501|             headers: { 'Content-Type': 'application/json' },\n00502|             body: JSON.stringify({ method: 'test' })\n00503|           });\n00504|           const data = await response.json();\n00505|           if (data.status === 'OK') {\n00506|             return { success: true };\n00507|           } else {\n00508|             return { error: true };\n00509|           }\n00510|         } catch (error) {\n00511|           return { error: true };\n00512|         }\n00513|       }),\n00514|       \n00515|       checkAPIStatus('dellin', async () => {\n00516|         try {\n00517|           // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ sessionID –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π (—Ç–æ—Ç –∂–µ –º–µ—Ç–æ–¥ —á—Ç–æ –≤ calculateDellin)\n00518|           const authResponse = await fetch('https://api.dellin.ru/v3/auth/login.json', {\n00519|             method: 'POST',\n00520|             headers: { 'Content-Type': 'application/json' },\n00521|             body: JSON.stringify({\n00522|               appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n00523|               login: 'service@lavsit.ru',\n00524|               password: 'edcwsx123QAZ'\n00525|             })\n00526|           });\n00527|           const authData = await authResponse.json();\n00528|           \n00529|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ –∫ sessionID –∫–∞–∫ –≤ calculateDellin\n00530|           if (authData.data?.sessionID || authData.sessionID || authData.data?.session) {\n00531|             return { success: true };\n00532|           } else {\n00533|             return { error: true };\n00534|           }\n00535|         } catch (error) {\n00536|           return { error: true };\n00537|         }\n00538|       }),\n00539|       \n00540|       checkAPIStatus('railcontinent', async () => {\n00541|         try {\n00542|           const response = await fetch('/api/rail-continent', {\n00543|             method: 'POST',\n00544|             headers: { 'Content-Type': 'application/json' },\n00545|             body: JSON.stringify({\n00546|               city_sender: testData.fromCity,\n00547|               city_receiver: testData.toCity,\n00548|               weight: 10,\n00549|               volume: 0.1,\n00550|               length: 1,\n00551|               width: 1,\n00552|               height: 1,\n00553|               declared_cost: testData.declaredValue,\n00554|               pickup: '0',\n00555|               delivery: '0',\n00556|               packaging: '0',\n00557|               insurance: '0',\n00558|               tariff: 'auto'\n00559|             })\n00560|           });\n00561|           return await response.json();\n00562|         } catch (error) {\n00563|           return { error: true };\n00564|         }\n00565|       }),\n00566|       \n00567|       checkAPIStatus('vozovoz', async () => {\n00568|         try {\n00569|           const response = await fetch('/api/vozovoz', {\n00570|             method: 'POST',\n00571|             headers: { 'Content-Type': 'application/json' },\n00572|             body: JSON.stringify({\n00573|               object: \"price\",\n00574|               action: \"get\",\n00575|               params: {\n00576|                 cargo: {\n00577|                   dimension: {\n00578|                     quantity: 1,\n00579|                     volume: 0.1,\n00580|                     weight: 10\n00581|                   }\n00582|                 },\n00583|                 gateway: {\n00584|                   dispatch: {\n00585|                     point: {\n00586|                       location: testData.fromCity,\n00587|                       terminal: \"default\"\n00588|                     }\n00589|                   },\n00590|                   destination: {\n00591|                     point: {\n00592|                       location: testData.toCity,\n00593|                       terminal: \"default\"\n00594|                     }\n00595|                   }\n00596|                 }\n00597|               }\n00598|             })\n00599|           });\n00600|           return await response.json();\n00601|         } catch (error) {\n00602|           return { error: true };\n00603|         }\n00604|       }),\n00605|       \n00606|       checkAPIStatus('nordwheel', async () => {\n00607|         try {\n00608|           const totalWeight = 10;\n00609|           const totalVolume = 0.1;\n00610|           \n00611|           const params = new URLSearchParams({\n00612|             from: '91',\n00613|             to: '92',\n00614|             pickup: '1',\n00615|             deliver: '1',\n00616|             weight: totalWeight.toString(),\n00617|             volume: totalVolume.toString(),\n00618|             oversized: '0',\n00619|             package: '1',\n00620|             packageCount: '1',\n00621|             insurance: '1',\n00622|             sum: '50000',\n00623|             documentsReturn: '0',\n00624|             fragile: '1'\n00625|           });\n00626| \n00627|           const fullUrl = `https://nordw.ru/tools/api/calc/calculate/?${params.toString()}`;\n00628|           const response = await fetch(fullUrl);\n00629|           const data = await response.json();\n00630|           \n00631|           if (response.ok && data.status === 'success') {\n00632|             return { success: true };\n00633|           } else {\n00634|             return { error: true };\n00635|           }\n00636|         } catch (error) {\n00637|           return { error: true };\n00638|         }\n00639|       })\n00640|     ]).finally(() => {\n00641|       // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n00642|       setForm(currentForm);\n00643|     });\n00644|   };\n00645| \n00646|   const searchAddresses = useCallback(async (query: string, field: string, element?: HTMLInputElement) => {\n00647|     if (query.length < 3) {\n00648|       setSuggestions([]);\n00649|       setShowSuggestions(false);\n00650|       return;\n00651|     }\n00652| \n00653|     setActiveField(field);\n00654|     \n00655|     // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ –∞–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–æ–∫\n00656|     if (element) {\n00657|       const rect = element.getBoundingClientRect();\n00658|       setSuggestionPosition({\n00659|         top: rect.bottom + window.scrollY,\n00660|         left: rect.left + window.scrollX\n00661|       });\n00662|     }\n00663|     \n00664|     try {\n00665|       const response = await fetch('https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address', {\n00666|         method: 'POST',\n00667|         headers: {\n00668|           'Content-Type': 'application/json',\n00669|           'Accept': 'application/json',\n00670|           'Authorization': 'Token eb87bbb3789bb43ed465f796892ea951f9e91008'\n00671|         },\n00672|         body: JSON.stringify({\n00673|           query: query,\n00674|           count: 10,\n00675|           // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª–µ–π –≥–æ—Ä–æ–¥–æ–≤ - —Ç–æ–ª—å–∫–æ –≥–æ—Ä–æ–¥–∞\n00676|           ...(field === 'fromCity' || field === 'toCity' ? {\n00677|             restrict_value: true,\n00678|             locations: [{\n00679|               country: '–†–æ—Å—Å–∏—è'\n00680|             }],\n00681|             from_bound: { value: 'city' },\n00682|             to_bound: { value: 'city' }\n00683|           } : {})\n00684|         })\n00685|       });\n00686| \n00687|       if (response.ok) {\n00688|         const data = await response.json();\n00689|         setSuggestions(data.suggestions || []);\n00690|         setShowSuggestions(true);\n00691|       }\n00692|     } catch (error) {\n00693|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫:', error);\n00694|     }\n00695|   }, []);\n00696| \n00697|   const debounceTimer = React.useRef<NodeJS.Timeout>();\n00698|   const handleAddressChange = (field: string, value: string, element?: HTMLInputElement) => {\n00699|     setForm(prev => ({ ...prev, [field]: value }));\n00700|     \n00701|     clearTimeout(debounceTimer.current);\n00702|     debounceTimer.current = setTimeout(() => {\n00703|       searchAddresses(value, field, element);\n00704|     }, 50);\n00705|   };\n00706| \n00707|   const selectSuggestion = (suggestion: AddressSuggestion) => {\n00708|     setForm(prev => ({ ...prev, [activeField]: suggestion.value }));\n00709|     setShowSuggestions(false);\n00710|     setActiveField('');\n00711|   };\n00712| \n00713|   // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞ \"–°–æ —Å–∫–ª–∞–¥–∞ –õ–∞–≤—Å–∏—Ç\"\n00714|   const handleLavsiteWarehouseChange = (checked: boolean) => {\n00715|     if (checked) {\n00716|       setForm(prev => ({\n00717|         ...prev,\n00718|         fromLavsiteWarehouse: true,\n00719|         fromAddressDelivery: true,\n00720|         fromTerminal: false,\n00721|         fromCity: '–õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π',\n00722|         fromAddress: '–¥–µ—Ä–µ–≤–Ω—è –û—Å–µ–µ–≤–æ, 202, –≥–æ—Ä–æ–¥—Å–∫–æ–π –æ–∫—Ä—É–≥ –õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π, –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å'\n00723|       }));\n00724|     } else {\n00725|       setForm(prev => ({\n00726|         ...prev,\n00727|         fromLavsiteWarehouse: false,\n00728|         fromCity: '',\n00729|         fromAddress: ''\n00730|       }));\n00731|     }\n00732|   };\n00733| \n00734|   const addCargo = () => {\n00735|     const newId = (form.cargos.length + 1).toString();\n00736|     setForm(prev => ({\n00737|       ...prev,\n00738|       cargos: [...prev.cargos, { id: newId, length: 0, width: 0, height: 0, weight: 0 }]\n00739|     }));\n00740|   };\n00741| \n00742|   const updateCargo = (id: string, field: string, value: number) => {\n00743|     setForm(prev => {\n00744|       const updatedCargos = prev.cargos.map(cargo => \n00745|         cargo.id === id ? { ...cargo, [field]: value } : cargo\n00746|       );\n00747|       \n00748|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n00749|       const cleanResult = cleanEmptyCargos(updatedCargos, prev.selectedProducts || []);\n00750|       \n00751|       return {\n00752|         ...prev,\n00753|         cargos: cleanResult.cargos,\n00754|         selectedProducts: cleanResult.products\n00755|       };\n00756|     });\n00757|   };\n00758| \n00759|   const removeCargo = (id: string) => {\n00760|     if (form.cargos.length > 1) {\n00761|       setForm(prev => ({\n00762|         ...prev,\n00763|         cargos: prev.cargos.filter(cargo => cargo.id !== id)\n00764|       }));\n00765|     }\n00766|   };\n00767| \n00768|   // üîß –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ (–≤—Å–µ –ø–æ–ª—è —Ä–∞–≤–Ω—ã 0)\n00769|   const isEmptyCargo = (cargo: Cargo) => {\n00770|     return cargo.length === 0 && cargo.width === 0 && cargo.height === 0 && cargo.weight === 0;\n00771|   };\n00772| \n00773|   // üîß –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤\n00774|   const cleanEmptyCargos = (cargos: Cargo[], selectedProducts: ProductInForm[]) => {\n00775|     // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –≥—Ä—É–∑\n00776|     const hasFilledCargos = cargos.some(cargo => !isEmptyCargo(cargo));\n00777|     \n00778|     if (!hasFilledCargos) {\n00779|       // –ï—Å–ª–∏ –Ω–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –ø—É—Å—Ç–æ–π\n00780|       return {\n00781|         cargos: cargos.length > 0 ? [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }] : [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00782|         products: selectedProducts\n00783|       };\n00784|     }\n00785| \n00786|     // –°–æ–∑–¥–∞–µ–º –º–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ä—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –∫ –Ω–æ–≤—ã–º\n00787|     const oldToNewIndexMap = new globalThis.Map<number, number>();\n00788|     let newIndex = 0;\n00789|     \n00790|     cargos.forEach((cargo, oldIndex) => {\n00791|       if (!isEmptyCargo(cargo)) {\n00792|         oldToNewIndexMap.set(oldIndex, newIndex);\n00793|         newIndex++;\n00794|       }\n00795|     });\n00796|     \n00797|     // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –≥—Ä—É–∑—ã\n00798|     const filledCargos = cargos.filter(cargo => !isEmptyCargo(cargo));\n00799|     \n00800|     // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã —É —Ç–æ–≤–∞—Ä–æ–≤\n00801|     const updatedProducts = selectedProducts.map(productItem => ({\n00802|       ...productItem,\n00803|       cargoIndexes: productItem.cargoIndexes\n00804|         .map(oldIndex => oldToNewIndexMap.get(oldIndex))\n00805|         .filter(newIdx => newIdx !== undefined) as number[]\n00806|     }));\n00807|     \n00808|     return {\n00809|       cargos: filledCargos,\n00810|       products: updatedProducts\n00811|     };\n00812|   };\n00813| \n00814|   // üîß –§—É–Ω–∫—Ü–∏—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≥—Ä—É–∑–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n00815|   interface GroupedCargoDisplay {\n00816|     length: number;\n00817|     width: number;\n00818|     height: number;\n00819|     weight: number;\n00820|     quantity: number;\n00821|     indices: number[];\n00822|     isEmpty: boolean;\n00823|   }\n00824| \n00825|   const groupCargosForDisplay = (cargos: Cargo[]): GroupedCargoDisplay[] => {\n00826|     const groups = new globalThis.Map<string, GroupedCargoDisplay>();\n00827|     \n00828|     cargos.forEach((cargo, index) => {\n00829|       const isEmpty = isEmptyCargo(cargo);\n00830|       \n00831|       // –î–ª—è –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ –Ω–µ –≥—Ä—É–ø–ø–∏—Ä—É–µ–º\n00832|       if (isEmpty) {\n00833|         groups.set(`empty_${index}`, {\n00834|           length: 0,\n00835|           width: 0,\n00836|           height: 0,\n00837|           weight: 0,\n00838|           quantity: 1,\n00839|           indices: [index],\n00840|           isEmpty: true\n00841|         });\n00842|         return;\n00843|       }\n00844|       \n00845|       // –°–æ–∑–¥–∞–µ–º –∫–ª—é—á –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –∏ –≤–µ—Å–∞\n00846|       const key = `${cargo.length}_${cargo.width}_${cargo.height}_${cargo.weight}`;\n00847|       \n00848|       if (groups.has(key)) {\n00849|         const existing = groups.get(key)!;\n00850|         existing.quantity += 1;\n00851|         existing.indices.push(index);\n00852|       } else {\n00853|         groups.set(key, {\n00854|           length: cargo.length,\n00855|           width: cargo.width,\n00856|           height: cargo.height,\n00857|           weight: cargo.weight,\n00858|           quantity: 1,\n00859|           indices: [index],\n00860|           isEmpty: false\n00861|         });\n00862|       }\n00863|     });\n00864|     \n00865|     // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤: —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ (–ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É–±—ã–≤–∞–Ω–∏—è), –ø–æ—Ç–æ–º –ø—É—Å—Ç—ã–µ\n00866|     return Array.from(groups.values()).sort((a, b) => {\n00867|       if (a.isEmpty && !b.isEmpty) return 1;\n00868|       if (!a.isEmpty && b.isEmpty) return -1;\n00869|       if (!a.isEmpty && !b.isEmpty) {\n00870|         return b.quantity - a.quantity; // –ü–æ —É–±—ã–≤–∞–Ω–∏—é –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞\n00871|       }\n00872|       return a.indices[0] - b.indices[0]; // –ü—É—Å—Ç—ã–µ –ø–æ –ø–æ—Ä—è–¥–∫—É –∏–Ω–¥–µ–∫—Å–æ–≤\n00873|     });\n00874|   };\n00875| \n00876|   // üîß –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏\n00877|   const handleProductAdd = (product: FurnitureProduct) => {\n00878|     const timestamp = Date.now();\n00879|     \n00880|     console.log(`‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞: ${product.name} (${product.cargoPlaces.length} –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç)`);\n00881|     \n00882|     // –°–æ–∑–¥–∞–µ–º –≥—Ä—É–∑–æ–≤—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è —Ç–æ–≤–∞—Ä–∞\n00883|     const newCargos = createCargosForProduct(product, 1, timestamp);\n00884|     \n00885|     console.log('–°–æ–∑–¥–∞–Ω–æ –Ω–æ–≤—ã—Ö –≥—Ä—É–∑–æ–≤:', newCargos.length);\n00886|     console.log('–ù–æ–≤—ã–µ –≥—Ä—É–∑—ã:', newCargos.map(c => ({ id: c.id, productId: c.productId, addedAt: c.addedAt })));\n00887|     \n00888|     // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç —Ç–æ–≤–∞—Ä–∞ –≤ —Ñ–æ—Ä–º–µ\n00889|     const productInForm: ProductInForm = {\n00890|       product,\n00891|       quantity: 1,\n00892|       totalPrice: product.retailPrice,\n00893|       cargoIndexes: [], // –ó–∞–ø–æ–ª–Ω–∏–º –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–∑–æ–≤\n00894|       addedAt: timestamp\n00895|     };\n00896|     \n00897|     setForm(prev => {\n00898|       let updatedCargos = [...prev.cargos];\n00899|       let cargoIndexes: number[] = [];\n00900|       \n00901|       // –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è\n00902|       const emptyCargos = updatedCargos\n00903|         .map((cargo, index) => ({ cargo, index }))\n00904|         .filter(item => isEmptyCargo(item.cargo));\n00905|       \n00906|       console.log('–ù–∞–π–¥–µ–Ω–æ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤:', emptyCargos.length);\n00907|       console.log('–ù—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –≥—Ä—É–∑–æ–≤:', newCargos.length);\n00908|       \n00909|       // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞\n00910|       let filledCount = 0;\n00911|       for (let i = 0; i < Math.min(emptyCargos.length, newCargos.length); i++) {\n00912|         const emptyCargoIndex = emptyCargos[i].index;\n00913|         const newCargoData = newCargos[i];\n00914|         \n00915|         updatedCargos[emptyCargoIndex] = {\n00916|           ...updatedCargos[emptyCargoIndex],\n00917|           length: newCargoData.length,\n00918|           width: newCargoData.width,\n00919|           height: newCargoData.height,\n00920|           weight: newCargoData.weight,\n00921|           productId: newCargoData.productId,\n00922|           placeNumber: newCargoData.placeNumber,\n00923|           isFromProduct: newCargoData.isFromProduct,\n00924|           addedAt: newCargoData.addedAt\n00925|         };\n00926|         \n00927|         cargoIndexes.push(emptyCargoIndex);\n00928|         filledCount++;\n00929|       }\n00930|       \n00931|       // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –≥—Ä—É–∑–æ–≤, —á–µ–º –µ—Å—Ç—å –ø—É—Å—Ç—ã—Ö - –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ\n00932|       if (filledCount < newCargos.length) {\n00933|         const remainingCargos = newCargos.slice(filledCount);\n00934|         const startIndex = updatedCargos.length;\n00935|         \n00936|         for (let i = 0; i < remainingCargos.length; i++) {\n00937|           updatedCargos.push(remainingCargos[i]);\n00938|           cargoIndexes.push(startIndex + i);\n00939|         }\n00940|       }\n00941|       \n00942|       productInForm.cargoIndexes = cargoIndexes;\n00943|       \n00944|       console.log('–ò–Ω–¥–µ–∫—Å—ã –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤:', cargoIndexes);\n00945|       console.log('–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:', updatedCargos.length);\n00946|       \n00947|       // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n00948|       const prevSelectedProducts = prev.selectedProducts || [];\n00949|       const newSelectedProducts = [...prevSelectedProducts, productInForm];\n00950|       const newDeclaredValue = calculateTotalValue(newSelectedProducts);\n00951|       \n00952|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n00953|       const cleanResult = cleanEmptyCargos(updatedCargos, newSelectedProducts);\n00954|       \n00955|       return {\n00956|         ...prev,\n00957|         cargos: cleanResult.cargos,\n00958|         selectedProducts: cleanResult.products,\n00959|         declaredValue: newDeclaredValue\n00960|       };\n00961|     });\n00962|     \n00963|     console.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä: ${product.name} (${newCargos.length} –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç)`);\n00964|     console.log('–§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥—Ä—É–∑–æ–≤:', newCargos.length);\n00965|   };\n00966| \n00967|   const handleProductQuantityChange = (productId: string, addedAt: number, newQuantity: number) => {\n00968|     setForm(prev => {\n00969|       console.log(`üî¢ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞ ${productId} —Å ${prev.selectedProducts?.find(p => p.product.id === productId && p.addedAt === addedAt)?.quantity || 0} –Ω–∞ ${newQuantity}`);\n00970|       \n00971|       // –ù–∞—Ö–æ–¥–∏–º —Ç–æ–≤–∞—Ä\n00972|       const selectedProducts = prev.selectedProducts || [];\n00973|       const productIndex = selectedProducts.findIndex(p => \n00974|         p.product.id === productId && p.addedAt === addedAt\n00975|       );\n00976|       \n00977|       if (productIndex === -1) {\n00978|         console.warn('‚ùå –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞');\n00979|         return prev;\n00980|       }\n00981|       \n00982|       const product = selectedProducts[productIndex];\n00983|       console.log('–ì—Ä—É–∑—ã –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞:', prev.cargos.length);\n00984|       \n00985|       // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –≥—Ä—É–∑—ã —ç—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞\n00986|       const cargosWithoutProduct = removeCargosForProduct(\n00987|         prev.cargos as CargoWithMetadata[], \n00988|         productId, \n00989|         addedAt\n00990|       );\n00991|       \n00992|       console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö:', cargosWithoutProduct.length);\n00993|       \n00994|       // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –≥—Ä—É–∑—ã —Å –Ω–æ–≤—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º\n00995|       const newCargos = createCargosForProduct(product.product, newQuantity, addedAt);\n00996|       const updatedCargos = [...cargosWithoutProduct, ...newCargos];\n00997|       \n00998|       console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö:', updatedCargos.length);\n00999|       \n01000|       // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä\n01001|       const updatedProduct = {\n01002|         ...product,\n01003|         quantity: newQuantity,\n01004|         totalPrice: product.product.retailPrice * newQuantity,\n01005|         cargoIndexes: findCargoIndexesForProduct(updatedCargos, productId, addedAt)\n01006|       };\n01007|       \n01008|       const updatedProducts = selectedProducts.map((p, index) => \n01009|         index === productIndex ? updatedProduct : p\n01010|       );\n01011|       \n01012|       // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n01013|       const newDeclaredValue = calculateTotalValue(updatedProducts);\n01014|       \n01015|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n01016|       const cleanResult = cleanEmptyCargos(updatedCargos, updatedProducts);\n01017|       \n01018|       return {\n01019|         ...prev,\n01020|         cargos: cleanResult.cargos,\n01021|         selectedProducts: cleanResult.products,\n01022|         declaredValue: newDeclaredValue\n01023|       };\n01024|     });\n01025|     \n01026|     console.log(`üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ ${productId}: ${newQuantity} —à—Ç.`);\n01027|   };\n01028| \n01029|   const handleProductRemove = (productId: string, addedAt: number) => {\n01030|     setForm(prev => {\n01031|       console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ ${productId} (addedAt: ${addedAt})`);\n01032|       \n01033|       // –ù–∞—Ö–æ–¥–∏–º —Ç–æ–≤–∞—Ä –∏ –µ–≥–æ –∏–Ω–¥–µ–∫—Å—ã –≥—Ä—É–∑–æ–≤\n01034|       const selectedProducts = prev.selectedProducts || [];\n01035|       const product = selectedProducts.find(p => \n01036|         p.product.id === productId && p.addedAt === addedAt\n01037|       );\n01038|       \n01039|       if (!product) {\n01040|         console.log('–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω');\n01041|         return prev;\n01042|       }\n01043|       \n01044|       // –û—á–∏—â–∞–µ–º –≥—Ä—É–∑—ã —Ç–æ–≤–∞—Ä–∞ (–¥–µ–ª–∞–µ–º –∏—Ö –ø—É—Å—Ç—ã–º–∏ –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è)\n01045|       const updatedCargos = prev.cargos.map((cargo, index) => {\n01046|         if (product.cargoIndexes.includes(index)) {\n01047|           return {\n01048|             ...cargo,\n01049|             length: 0,\n01050|             width: 0,\n01051|             height: 0,\n01052|             weight: 0,\n01053|             productId: undefined,\n01054|             placeNumber: undefined,\n01055|             isFromProduct: undefined,\n01056|             addedAt: undefined\n01057|           };\n01058|         }\n01059|         return cargo;\n01060|       });\n01061|       \n01062|       // –£–¥–∞–ª—è–µ–º —Ç–æ–≤–∞—Ä –∏–∑ —Å–ø–∏—Å–∫–∞\n01063|       const updatedProducts = selectedProducts.filter(p => \n01064|         !(p.product.id === productId && p.addedAt === addedAt)\n01065|       );\n01066|       \n01067|       // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n01068|       const newDeclaredValue = calculateTotalValue(updatedProducts);\n01069|       \n01070|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n01071|       const cleanResult = cleanEmptyCargos(updatedCargos, updatedProducts);\n01072|       \n01073|       console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:', cleanResult.cargos.length);\n01074|       console.log('–£–¥–∞–ª–µ–Ω–æ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤:', updatedCargos.length - cleanResult.cargos.length);\n01075|       \n01076|       return {\n01077|         ...prev,\n01078|         cargos: cleanResult.cargos,\n01079|         selectedProducts: cleanResult.products,\n01080|         declaredValue: newDeclaredValue\n01081|       };\n01082|     });\n01083|     \n01084|     console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω —Ç–æ–≤–∞—Ä ${productId}`);\n01085|   };\n01086| \n01087|   // –ü–æ–ª—É—á–µ–Ω–∏–µ sessionID –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n01088|   const getDellinSessionId = async (): Promise<string | null> => {\n01089|     try {\n01090|       const authResponse = await fetch('https://api.dellin.ru/v3/auth/login.json', {\n01091|         method: 'POST',\n01092|         headers: {\n01093|           'Content-Type': 'application/json'\n01094|         },\n01095|         body: JSON.stringify({\n01096|           appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n01097|           login: 'service@lavsit.ru',\n01098|           password: 'edcwsx123QAZ'\n01099|         })\n01100|       });\n01101| \n01102|       const authData = await authResponse.json();\n01103|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ response.ok:', authResponse.ok);\n01104|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData:', authData);\n01105|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData.data:', authData.data);\n01106|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData.data?.sessionID:', authData.data?.sessionID);\n01107|       \n01108|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ –∫ sessionID\n01109|       let sessionID = null;\n01110|       \n01111|       if (authData.data?.sessionID) {\n01112|         sessionID = authData.data.sessionID;\n01113|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ data.sessionID:', sessionID);\n01114|       } else if (authData.sessionID) {\n01115|         sessionID = authData.sessionID;\n01116|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ sessionID:', sessionID);\n01117|       } else if (authData.data?.session) {\n01118|         sessionID = authData.data.session;\n01119|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ data.session:', sessionID);\n01120|       }\n01121|       \n01122|       if (authResponse.ok && sessionID) {\n01123|         return sessionID;\n01124|       } else {\n01125|         console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', authData);\n01126|         console.error('‚ùå –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', authResponse.status);\n01127|         console.error('‚ùå –¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞:', authResponse.statusText);\n01128|         return null;\n01129|       }\n01130|     } catch (error) {\n01131|       console.error('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', error);\n01132|     }\n01133|     return null;\n01134|   };\n01135| \n01136|   // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –≥–æ—Ä–æ–¥–æ–≤ –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n01137|   const loadDellinCities = async () => {\n01138|     try {\n01139|       const response = await fetch('/data/dellin-cities.json');\n01140|       if (!response.ok) {\n01141|         console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –≥–æ—Ä–æ–¥–æ–≤');\n01142|         return null;\n01143|       }\n01144|       const data = await response.json();\n01145|       return data.cities;\n01146|     } catch (error) {\n01147|       console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –≥–æ—Ä–æ–¥–æ–≤:', error);\n01148|       return null;\n01149|     }\n01150|   };\n01151| \n01152|   // –ü–æ–∏—Å–∫ cityID –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ\n01153|   const getCityIDFromLocal = async (cityName: string): Promise<string | null> => {\n01154|     const cities = await loadDellinCities();\n01155|     if (!cities) return null;\n01156| \n01157|     const normalizedSearch = cityName.toLowerCase().trim()\n01158|       .replace(/^–≥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥ \"\n01159|       .replace(/^–≥–æ—Ä–æ–¥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥–æ—Ä–æ–¥ \"\n01160|       .replace(/\\s+/g, ' '); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—Ä–æ–±–µ–ª—ã\n01161| \n01162|     console.log(`üîç –ü–æ–∏—Å–∫ cityID –¥–ª—è –≥–æ—Ä–æ–¥–∞: \"${normalizedSearch}\"`);\n01163| \n01164|     // –ü–æ–∏—Å–∫ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ\n01165|     for (const city of cities) {\n01166|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –∏–º–µ–Ω–µ–º –≥–æ—Ä–æ–¥–∞\n01167|       if (city.name.toLowerCase() === normalizedSearch) {\n01168|         console.log(`‚úÖ –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: \"${city.name}\" -> cityID: ${city.cityID}`);\n01169|         return city.cityID;\n01170|       }\n01171| \n01172|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –ø–æ–∏—Å–∫–æ–≤—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏\n01173|       for (const searchString of city.searchStrings) {\n01174|         if (searchString === normalizedSearch) {\n01175|           console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ –≤ –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫–∞—Ö: \"${searchString}\" –¥–ª—è –≥–æ—Ä–æ–¥–∞ \"${city.name}\" -> cityID: ${city.cityID}`);\n01176|           return city.cityID;\n01177|         }\n01178|       }\n01179|     }\n01180| \n01181|     console.warn(`‚ö†Ô∏è cityID –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –¥–ª—è –≥–æ—Ä–æ–¥–∞: \"${normalizedSearch}\"`);\n01182|     return null;\n01183|   };\n01184| \n01185|   // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ –¥–ª—è –≥–æ—Ä–æ–¥–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n01186|   const getDellinTerminalByDirection = async (citySearch: string, direction: 'arrival' | 'derival'): Promise<string | null> => {\n01187|     try {\n01188|       // –ü–æ–ª—É—á–∞–µ–º –≤–∞–ª–∏–¥–Ω—ã–π sessionID\n01189|       const sessionID = await getDellinSessionId();\n01190|       if (!sessionID) {\n01191|         console.error(`‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å sessionID –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ ${direction}`);\n01192|         return null;\n01193|       }\n01194| \n01195|       // –ü–æ–ª—É—á–∞–µ–º cityID –¥–ª—è –≥–æ—Ä–æ–¥–∞ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞\n01196|       const cityID = await getCityIDFromLocal(citySearch);\n01197|       if (!cityID) {\n01198|         console.warn(`‚ö†Ô∏è cityID –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –≥–æ—Ä–æ–¥–∞ \"${citySearch}\". –ü—Ä–æ–±—É–µ–º –ø–æ–∏—Å–∫ –±–µ–∑ cityID...`);\n01199|       }\n01200| \n01201|       console.log(`üîç –ü–æ–∏—Å–∫ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ ${direction} –¥–ª—è –≥–æ—Ä–æ–¥–∞:`, citySearch);\n01202|       console.log(`üÜî –ò—Å–ø–æ–ª—å–∑—É–µ–º cityID:`, cityID);\n01203|       console.log(`üîë –ò—Å–ø–æ–ª—å–∑—É–µ–º sessionID:`, sessionID);\n01204| \n01205|       // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞\n01206|       const normalizedCity = citySearch.toLowerCase().trim()\n01207|         .replace(/^–≥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥ \"\n01208|         .replace(/^–≥–æ—Ä–æ–¥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥–æ—Ä–æ–¥ \"\n01209|         .replace(/\\s+/g, ' '); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—Ä–æ–±–µ–ª—ã\n01210| \n01211|       // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API endpoint –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤\n01212|       // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–≥–ª–∞—Å–Ω–æ API –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n01213|       const requestBody: any = {\n01214|         appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n01215|         sessionID: sessionID,\n01216|         search: normalizedCity,\n01217|         direction: direction,\n01218|         maxCargoDimensions: {\n01219|           length: 3.0,\n01220|           width: 3.0,\n01221|           height: 3.0,\n01222|           weight: 3.0,\n01223|           maxVolume: 3.0,\n01224|           totalVolume: 3.0,\n01225|           totalWeight: 3.0\n01226|         },\n01227|         express: true,\n01228|         freeStorageDays: \"2\"\n01229|       };\n01230| \n01231|       // –î–æ–±–∞–≤–ª—è–µ–º cityID –µ—Å–ª–∏ –æ–Ω –Ω–∞–π–¥–µ–Ω\n01232|       if (cityID) {\n01233|         requestBody.cityid = cityID;\n01234|         console.log(`üÜî –î–æ–±–∞–≤–ª—è–µ–º cityID –≤ –∑–∞–ø—Ä–æ—Å: ${cityID}`);\n01235|       }\n01236| \n01237|       console.log(`üì§ –ó–∞–ø—Ä–æ—Å —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ ${direction}:`, JSON.stringify(requestBody, null, 2));\n01238| \n01239|       const response = await fetch('https://api.dellin.ru/v1/public/request_terminals.json', {\n01240|         method: 'POST',\n01241|         headers: {\n01242|           'Content-Type': 'application/json'\n01243|         },\n01244|         body: JSON.stringify(requestBody)\n01245|       });\n01246| \n01247|       const data = await response.json();\n01248|       console.log(`üöõ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã ${direction} response status:`, response.status);\n01249|       console.log(`üöõ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã ${direction} response:`, data);\n01250|       \n01251|       // –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–∞\n01252|       console.log(`üîç –ê–Ω–∞–ª–∏–∑ –æ—Ç–≤–µ—Ç–∞ –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π ${direction}:`);\n01253|       console.log(`   - response.ok: ${response.ok}`);\n01254|       console.log(`   - data —Ç–∏–ø:`, typeof data);\n01255|       console.log(`   - data.terminals:`, data.terminals);\n01256|       console.log(`   - data.terminals —Ç–∏–ø:`, typeof data.terminals);\n01257|       console.log(`   - data.terminals.length:`, data.terminals?.length);\n01258|       console.log(`   - data.metadata:`, data.metadata);\n01259|       console.log(`   - data.errors:`, data.errors);\n01260|       console.log(`   - –í—Å–µ –∫–ª—é—á–∏ data:`, Object.keys(data));\n01261|       \n01262|       if (response.ok && data.terminals && data.terminals.length > 0) {\n01263|         console.log(`üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã ${direction}:`, data.terminals.map((t: any) => ({\n01264|           id: t.id,\n01265|           city: t.city,\n01266|           name: t.name,\n01267|           address: t.address,\n01268|           default: t.default\n01269|         })));\n01270|         \n01271|         // –ò—â–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n01272|         let terminal = data.terminals.find((t: any) => t.default === true);\n01273|         \n01274|         // –ï—Å–ª–∏ –Ω–µ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π\n01275|         if (!terminal && data.terminals.length > 0) {\n01276|           terminal = data.terminals[0];\n01277|         }\n01278|         \n01279|         if (terminal) {\n01280|           console.log(`‚úÖ –ù–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª ${direction}:`, { \n01281|             id: terminal.id, \n01282|             city: terminal.city, \n01283|             name: terminal.name,\n01284|             default: terminal.default \n01285|           });\n01286|           return terminal.id.toString();\n01287|         }\n01288|       }\n01289|       \n01290|       // –ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ–∏—Å–∫ –Ω–µ –¥–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã\n01291|       console.warn(`‚ö†Ô∏è –¢–µ—Ä–º–∏–Ω–∞–ª—ã ${direction} –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è –≥–æ—Ä–æ–¥–∞ \"${normalizedCity}\". –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã...`);\n01292|       \n01293|       // –°–ø–∏—Å–æ–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –Ω–∞–∑–≤–∞–Ω–∏–π –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤\n01294|       const alternativeNames: { [key: string]: string[] } = {\n01295|         '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': ['—Å–ø–±', '—Å–∞–Ω–∫—Ç –ø–µ—Ç–µ—Ä–±—É—Ä–≥', '–ø–µ—Ç–µ—Ä–±—É—Ä–≥', '–ª–µ–Ω–∏–Ω–≥—Ä–∞–¥'],\n01296|         '–º–æ—Å–∫–≤–∞': ['–º–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–º—Å–∫'],\n01297|         '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': ['—Å–≤–µ—Ä–¥–ª–æ–≤—Å–∫', '–µ–∫–±'],\n01298|         '–Ω–∏–∂–Ω–∏–π –Ω–æ–≤–≥–æ—Ä–æ–¥': ['–Ω.–Ω–æ–≤–≥–æ—Ä–æ–¥', '–Ω–∏–∂–Ω–∏–π-–Ω–æ–≤–≥–æ—Ä–æ–¥'],\n01299|         '—Ä–æ—Å—Ç–æ–≤-–Ω–∞-–¥–æ–Ω—É': ['—Ä–æ—Å—Ç–æ–≤ –Ω–∞ –¥–æ–Ω—É', '—Ä–æ—Å—Ç–æ–≤'],\n01300|       };\n01301|       \n01302|       if (alternativeNames[normalizedCity]) {\n01303|         for (const altName of alternativeNames[normalizedCity]) {\n01304|           console.log(`üîÑ –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: \"${altName}\"`);\n01305|           \n01306|           const altRequestBody = {\n01307|             ...requestBody,\n01308|             search: altName\n01309|           };\n01310|           \n01311|           // –£–±–∏—Ä–∞–µ–º cityID –¥–ª—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞\n01312|           delete altRequestBody.cityid;\n01313|           \n01314|           try {\n01315|             const altResponse = await fetch('https://api.dellin.ru/v1/public/request_terminals.json', {\n01316|               method: 'POST',\n01317|               headers: {\n01318|                 'Content-Type': 'application/json'\n01319|               },\n01320|               body: JSON.stringify(altRequestBody)\n01321|             });\n01322|             \n01323|             const altData = await altResponse.json();\n01324|             console.log(`üöõ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ \"${altName}\" response:`, altData);\n01325|             \n01326|             if (altResponse.ok && altData.terminals && altData.terminals.length > 0) {\n01327|               let terminal = altData.terminals.find((t: any) => t.default === true);\n01328|               if (!terminal && altData.terminals.length > 0) {\n01329|                 terminal = altData.terminals[0];\n01330|               }\n01331|               \n01332|               if (terminal) {\n01333|                 console.log(`‚úÖ –ù–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª ${direction} –ø–æ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–º—É –Ω–∞–∑–≤–∞–Ω–∏—é \"${altName}\":`, { \n01334|                   id: terminal.id, \n01335|                   city: terminal.city, \n01336|                   name: terminal.name \n01337|                 });\n01338|                 return terminal.id.toString();\n01339|               }\n01340|             }\n01341|           } catch (altError) {\n01342|             console.warn(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ \"${altName}\":`, altError);\n01343|           }\n01344|         }\n01345|       }\n01346|       \n01347|       console.warn(`‚ùå –¢–µ—Ä–º–∏–Ω–∞–ª—ã ${direction} –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è –≥–æ—Ä–æ–¥–∞:`, citySearch);\n01348|       console.warn('‚ö†Ô∏è Response status:', response.status);\n01349|       console.warn('‚ö†Ô∏è Response data:', data);\n01350|       return null;\n01351|     } catch (error) {\n01352|       console.error(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ ${direction} –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:`, error);\n01353|       return null;\n01354|     }\n01355|   };\n01356| \n01357|   // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ –¥–ª—è –≥–æ—Ä–æ–¥–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º)\n01358|   const getDellinTerminal = async (citySearch: string): Promise<string | null> => {\n01359|     return getDellinTerminalByDirection(citySearch, 'arrival');\n01360|   };\n01361| \n01362|   // –ü–æ–ª—É—á–µ–Ω–∏–µ UID —É–ø–∞–∫–æ–≤–∫–∏ \"crate_with_bubble\" –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ —É–ø–∞–∫–æ–≤–æ–∫ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n01363|   const getDellinCrateWithBubbleUid = async (): Promise<string | null> => {\n01364|     const maxRetries = 2;\n01365|     \n01366|     for (let attempt = 1; attempt <= maxRetries; attempt++) {\n01367|       try {\n01368|         console.log(`üì¶ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –ø–æ–ø—ã—Ç–∫–∞ ${attempt}/${maxRetries}`);\n01369|         \n01370|         const response = await fetch('/api/dellin-packages', {\n01371|           method: 'GET',\n01372|           headers: {\n01373|             'Content-Type': 'application/json'\n01374|           }\n01375|         });\n01376| \n01377|         const data = await response.json();\n01378|         console.log('üì¶ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö response.ok:', response.ok);\n01379|         console.log('üì¶ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö status:', response.status);\n01380|         console.log('üì¶ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö data:', data);\n01381|         \n01382|         // –ï—Å–ª–∏ 401 Unauthorized - –ø—Ä–æ–±—É–µ–º –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è\n01383|         if (response.status === 401 && attempt < maxRetries) {\n01384|           console.log('üîÑ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –ø–æ–ª—É—á–∏–ª–∏ 401, –≤—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...');\n01385|           const newSessionId = await getDellinSessionId();\n01386|           if (newSessionId) {\n01387|             console.log('‚úÖ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –ø–æ–ª—É—á–µ–Ω –Ω–æ–≤—ã–π SessionID, –ø–æ–≤—Ç–æ—Ä—è–µ–º –∑–∞–ø—Ä–æ—Å...');\n01388|             continue; // –ü—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —Å –Ω–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n01389|           } else {\n01390|             console.error('‚ùå –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π SessionID');\n01391|             return null;\n01392|           }\n01393|         }\n01394|         \n01395|         if (response.ok && data.data && Array.isArray(data.data)) {\n01396|           console.log('üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–ø–∞–∫–æ–≤–æ–∫ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ:', data.data.length);\n01397|           console.log('üì¶ –ü–µ—Ä–≤—ã–µ 3 —É–ø–∞–∫–æ–≤–∫–∏:', data.data.slice(0, 3).map(p => ({name: p.name, uid: p.uid})));\n01398|           \n01399|           // –ù–∞—Ö–æ–¥–∏–º —É–ø–∞–∫–æ–≤–∫—É —Å name \"crate_with_bubble\"\n01400|           const crateWithBubble = data.data.find((pkg: any) => \n01401|             pkg.name === 'crate_with_bubble'\n01402|           );\n01403|           \n01404|           console.log('üì¶ –ü–æ–∏—Å–∫ crate_with_bubble —Ä–µ–∑—É–ª—å—Ç–∞—Ç:', crateWithBubble);\n01405|           \n01406|           if (crateWithBubble && crateWithBubble.uid) {\n01407|             console.log('‚úÖ –ù–∞–π–¥–µ–Ω UID –¥–ª—è crate_with_bubble:', crateWithBubble.uid);\n01408|             return crateWithBubble.uid;\n01409|           } else {\n01410|             console.log('‚ùå crate_with_bubble –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ—Ç UID');\n01411|           }\n01412|         } else {\n01413|           console.log('‚ùå –û—à–∏–±–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–∞ API —É–ø–∞–∫–æ–≤–æ–∫');\n01414|         }\n01415|         \n01416|         // –ï—Å–ª–∏ –¥–æ—à–ª–∏ —Å—é–¥–∞, –∑–Ω–∞—á–∏—Ç –Ω–µ –Ω–∞—à–ª–∏ —É–ø–∞–∫–æ–≤–∫—É –∏–ª–∏ –±—ã–ª–∞ –¥—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞\n01417|         break;\n01418|         \n01419|       } catch (error) {\n01420|         console.error(`‚ùå –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –æ—à–∏–±–∫–∞ –Ω–∞ –ø–æ–ø—ã—Ç–∫–µ ${attempt}:`, error);\n01421|         if (attempt === maxRetries) {\n01422|           console.error('‚ùå –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö: –∏—Å—á–µ—Ä–ø–∞–Ω—ã –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏');\n01423|           return null;\n01424|         }\n01425|       }\n01426|     }\n01427|     \n01428|     console.warn('–£–ø–∞–∫–æ–≤–∫–∞ —Å name=crate_with_bubble –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ');\n01429|     return null;\n01430|   };\n01431| \n01432|   // –†–∞—Å—á–µ—Ç –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π —á–µ—Ä–µ–∑ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π API v2/calculator.json —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n01433|   const calculateDellin = async (): Promise<CalculationResult> => {\n01434|     const apiUrl = 'https://api.dellin.ru/v2/calculator.json';\n01435|     const maxRetries = 2;\n01436|     \n01437|     console.log('üöÄ === –ù–ê–ß–ê–õ–û –†–ê–°–ß–ï–¢–ê –î–ï–õ–û–í–´–• –õ–ò–ù–ò–ô ===');\n01438|     console.log('üöÄ API URL:', apiUrl);\n01439|     \n01440|     try {\n01441|       let sessionID = await getDellinSessionId();\n01442|       \n01443|       if (!sessionID) {\n01444|         return {\n01445|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01446|           price: 0,\n01447|           days: 0,\n01448|           error: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å sessionID',\n01449|           apiUrl,\n01450|           requestData: null,\n01451|           responseData: null\n01452|         };\n01453|       }\n01454| \n01455|       // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏ –æ–±—ä–µ–º—ã\n01456|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n01457|       const totalVolume = form.cargos.reduce((sum, cargo) => \n01458|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n01459|       );\n01460|       const maxLength = Math.max(...form.cargos.map(c => c.length)) / 100; // –≤ –º–µ—Ç—Ä–∞—Ö\n01461|       const maxWidth = Math.max(...form.cargos.map(c => c.width)) / 100;\n01462|       const maxHeight = Math.max(...form.cargos.map(c => c.height)) / 100;\n01463| \n01464|       // –ü–æ–ª—É—á–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª—ã –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)\n01465|       const fromTerminalId = !form.fromAddressDelivery ? await getDellinTerminalByDirection(form.fromCity, 'derival') : null;\n01466|       const toTerminalId = !form.toAddressDelivery ? await getDellinTerminalByDirection(form.toCity, 'arrival') : null;\n01467|       \n01468|       console.log('üè¢ –¢–ï–†–ú–ò–ù–ê–õ–´ –î–õ:');\n01469|       console.log('üè¢ form.fromAddressDelivery:', form.fromAddressDelivery);\n01470|       console.log('üè¢ form.toAddressDelivery:', form.toAddressDelivery);\n01471|       console.log('üè¢ fromTerminalId:', fromTerminalId);\n01472|       console.log('üè¢ toTerminalId:', toTerminalId);\n01473|       \n01474|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏\n01475|       if (!form.fromAddressDelivery && !fromTerminalId) {\n01476|         console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –≥–æ—Ä–æ–¥–∞:', form.fromCity);\n01477|         return {\n01478|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01479|           price: 0,\n01480|           days: 0,\n01481|           error: `–ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π –≤ –≥–æ—Ä–æ–¥–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è: ${form.fromCity}`,\n01482|           apiUrl,\n01483|           requestData: null,\n01484|           responseData: null\n01485|         };\n01486|       }\n01487|       \n01488|       if (!form.toAddressDelivery && !toTerminalId) {\n01489|         console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≥–æ—Ä–æ–¥–∞:', form.toCity);\n01490|         return {\n01491|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01492|           price: 0,\n01493|           days: 0,\n01494|           error: `–ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π –≤ –≥–æ—Ä–æ–¥–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: ${form.toCity}`,\n01495|           apiUrl,\n01496|           requestData: null,\n01497|           responseData: null\n01498|         };\n01499|       }\n01500| \n01501|       // –ü–æ–ª—É—á–∞–µ–º UID —É–ø–∞–∫–æ–≤–∫–∏ crate_with_bubble (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∞)\n01502|       let packageUid: string | null = null;\n01503|       console.log('=== –ù–ê–ß–ê–õ–û –û–¢–õ–ê–î–ö–ò –£–ü–ê–ö–û–í–ö–ò ===');\n01504|       console.log('üîç –û–¢–õ–ê–î–ö–ê –£–ü–ê–ö–û–í–ö–ò: form.needPackaging =', form.needPackaging);\n01505|       console.log('üîç –û–¢–õ–ê–î–ö–ê –£–ü–ê–ö–û–í–ö–ò: typeof form.needPackaging =', typeof form.needPackaging);\n01506|       \n01507|       if (form.needPackaging) {\n01508|         console.log('üîç ‚úÖ –£–ü–ê–ö–û–í–ö–ê –¢–†–ï–ë–£–ï–¢–°–Ø - –ó–ê–ü–†–ê–®–ò–í–ê–ï–ú UID...');\n01509|         try {\n01510|           packageUid = await getDellinCrateWithBubbleUid();\n01511|           console.log('üîç ‚úÖ –ü–û–õ–£–ß–ï–ù packageUid –∏–∑ API:', packageUid);\n01512|           \n01513|           // –í–†–ï–ú–ï–ù–ù–û: –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ UID –∏–∑ API, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π\n01514|           if (!packageUid) {\n01515|             packageUid = '0xa6a7bd2bf950e67f4b2cf7cc3a97c111';\n01516|             console.log('üîç üß™ –ò–°–ü–û–õ–¨–ó–£–ï–ú –¢–ï–°–¢–û–í–´–ô UID:', packageUid);\n01517|           }\n01518|           \n01519|           console.log('üîç ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô packageUid:', packageUid);\n01520|           console.log('üîç ‚úÖ typeof packageUid:', typeof packageUid);\n01521|           console.log('üîç ‚úÖ packageUid truthy:', !!packageUid);\n01522|         } catch (error) {\n01523|           console.log('üîç ‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ packageUid:', error);\n01524|           // –í–†–ï–ú–ï–ù–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π UID –ø—Ä–∏ –æ—à–∏–±–∫–µ\n01525|           packageUid = '0xa6a7bd2bf950e67f4b2cf7cc3a97c111';\n01526|           console.log('üîç üß™ –ò–°–ü–û–õ–¨–ó–£–ï–ú –¢–ï–°–¢–û–í–´–ô UID –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏:', packageUid);\n01527|         }\n01528|       } else {\n01529|         console.log('üîç ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ UID');\n01530|       }\n01531|       console.log('=== –ö–û–ù–ï–¶ –û–¢–õ–ê–î–ö–ò –£–ü–ê–ö–û–í–ö–ò ===');\n01532| \n01533|       // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞—Ç—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞\n01534|       const tomorrow = new Date();\n01535|       tomorrow.setDate(tomorrow.getDate() + 1);\n01536|       const produceDate = tomorrow.toISOString().split('T')[0];\n01537| \n01538|       // –û—Ç–ª–∞–¥–∫–∞ –ø–µ—Ä–µ–¥ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–∞\n01539|       console.log('=== –û–¢–õ–ê–î–ö–ê –§–û–†–ú–ò–†–û–í–ê–ù–ò–Ø –ó–ê–ü–†–û–°–ê ===');\n01540|       console.log('üîç form.needPackaging =', form.needPackaging, '(—Ç–∏–ø:', typeof form.needPackaging, ')');\n01541|       console.log('üîç packageUid =', packageUid, '(—Ç–∏–ø:', typeof packageUid, ')');\n01542|       console.log('üîç packageUid truthy =', !!packageUid);\n01543|       console.log('üîç –£—Å–ª–æ–≤–∏–µ (form.needPackaging && packageUid) =', form.needPackaging && packageUid);\n01544|       \n01545|       if (form.needPackaging && packageUid) {\n01546|         console.log('‚úÖ PACKAGES –ë–£–î–ï–¢ –î–û–ë–ê–í–õ–ï–ù –í –ó–ê–ü–†–û–°!');\n01547|       } else {\n01548|         console.log('‚ùå PACKAGES –ù–ï –ë–£–î–ï–¢ –î–û–ë–ê–í–õ–ï–ù:');\n01549|         if (!form.needPackaging) console.log('  - form.needPackaging = false');\n01550|         if (!packageUid) console.log('  - packageUid –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç/null');\n01551|       }\n01552| \n01553|       // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n01554|       const requestData = {\n01555|         appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n01556|         sessionID: sessionID,\n01557|         delivery: {\n01558|           deliveryType: {\n01559|             type: 'auto'  // –í—Å–µ–≥–¥–∞ \"auto\" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n01560|           },\n01561|           derival: {\n01562|             produceDate: produceDate,  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –¥–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n01563|             variant: form.fromAddressDelivery ? 'address' : 'terminal',\n01564|             ...(form.fromAddressDelivery ? {\n01565|               address: {\n01566|                 search: form.fromAddress || form.fromCity\n01567|               }\n01568|             } : (fromTerminalId ? {\n01569|               terminalID: fromTerminalId\n01570|             } : {\n01571|               address: {\n01572|                 search: form.fromCity\n01573|               }\n01574|             })),\n01575|             time: {\n01576|               worktimeStart: '10:00',\n01577|               worktimeEnd: '18:00',\n01578|               breakStart: '13:00',\n01579|               breakEnd: '14:00',\n01580|               exactTime: false\n01581|             }\n01582|             // handling –≤ derival –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n01583|           },\n01584|           arrival: {\n01585|             variant: form.toAddressDelivery ? 'address' : 'terminal',\n01586|             ...(form.toAddressDelivery ? {\n01587|               address: {\n01588|                 search: form.toAddress || form.toCity\n01589|               }\n01590|             } : (toTerminalId ? {\n01591|               terminalID: toTerminalId\n01592|             } : {\n01593|               address: {\n01594|                 search: form.toCity\n01595|               }\n01596|             })),\n01597|             time: {\n01598|               worktimeStart: '10:00',\n01599|               worktimeEnd: '18:00',\n01600|               breakStart: '13:00',\n01601|               breakEnd: '14:00',\n01602|               exactTime: false\n01603|             },\n01604|             // handling –≤ arrival –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—ä–µ–º\n01605|             ...(form.needCarry ? {\n01606|               handling: {\n01607|                 freightLift: form.hasFreightLift, // true —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –≥–∞–ª–æ—á–∫–∞ \"–Ω–∞–ª–∏—á–∏–µ –≥—Ä—É–∑–æ–≤–æ–≥–æ –ª–∏—Ñ—Ç–∞\"\n01608|                 toFloor: form.floor, // —ç—Ç–∞–∂ –∏–∑ —Ñ–æ—Ä–º—ã\n01609|                 carry: 0\n01610|               }\n01611|             } : {})\n01612|           },\n01613|           ...(form.needPackaging && packageUid ? {\n01614|             packages: [{\n01615|               uid: packageUid,  // UID —É–ø–∞–∫–æ–≤–∫–∏ crate_with_bubble –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞\n01616|               count: 1  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1\n01617|             }]\n01618|           } : {})\n01619|         },\n01620|         cargo: {\n01621|           quantity: form.cargos.length,\n01622|           length: maxLength,\n01623|           width: maxWidth,\n01624|           height: maxHeight,\n01625|           weight: totalWeight,\n01626|           totalVolume: totalVolume,\n01627|           totalWeight: totalWeight,\n01628|           oversizedWeight: 0,\n01629|           oversizedVolume: 0,\n01630|           hazardClass: 0,  // –í—Å–µ–≥–¥–∞ 0 –µ—Å–ª–∏ –Ω–µ—Ç –æ–ø–∞—Å–Ω—ã—Ö –≥—Ä—É–∑–æ–≤\n01631|           ...(form.needInsurance && form.declaredValue > 0 ? {\n01632|             insurance: {\n01633|               statedValue: form.declaredValue,\n01634|               term: true  // –í—Å–µ–≥–¥–∞ true –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è\n01635|             }\n01636|           } : {})\n01637|         },\n01638|         payment: {\n01639|           type: 'noncash',  // –í—Å–µ–≥–¥–∞ \"noncash\"\n01640|           paymentCitySearch: {\n01641|             search: form.fromCity  // –ì–æ—Ä–æ–¥ –æ–ø–ª–∞—Ç—ã\n01642|           }\n01643|         }\n01644|       };\n01645| \n01646|       console.log('üöÄ –ò–¢–û–ì–û–í–´–ô –ó–ê–ü–†–û–° –ö –î–õ:', JSON.stringify(requestData, null, 2));\n01647|       \n01648|       // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∞ packages\n01649|       if (requestData.delivery.packages) {\n01650|         console.log('‚úÖ PACKAGES –ù–ê–ô–î–ï–ù –í –ó–ê–ü–†–û–°–ï:', requestData.delivery.packages);\n01651|       } else {\n01652|         console.log('‚ùå PACKAGES –ù–ï –ù–ê–ô–î–ï–ù –í –ó–ê–ü–†–û–°–ï');\n01653|         console.log('   form.needPackaging =', form.needPackaging);\n01654|         console.log('   packageUid =', packageUid);\n01655|         console.log('   –£—Å–ª–æ–≤–∏–µ:', form.needPackaging && packageUid);\n01656|       }\n01657| \n01658|       // –ü–æ–ø—ã—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö\n01659|       let response: any = null;\n01660|       let data: any = null;\n01661|       \n01662|       for (let attempt = 1; attempt <= maxRetries; attempt++) {\n01663|         console.log(`üîÑ –î–õ: –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ ${attempt}/${maxRetries}`);\n01664|         \n01665|         response = await fetch(apiUrl, {\n01666|           method: 'POST',\n01667|           headers: {\n01668|             'Content-Type': 'application/json',\n01669|             'Accept': 'application/json'\n01670|           },\n01671|           body: JSON.stringify(requestData)\n01672|         });\n01673| \n01674|         try {\n01675|           data = await response.json();\n01676|         } catch (parseError) {\n01677|           console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –æ—Ç–≤–µ—Ç–∞ –î–õ:', parseError);\n01678|           throw new Error(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ API: ${parseError instanceof Error ? parseError.message : '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);\n01679|         }\n01680|         \n01681|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ response.ok:', response.ok);\n01682|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ status:', response.status);\n01683|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ data:', data);\n01684|         \n01685|         // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\n01686|         const isAuthError = response.status === 401 || \n01687|                            response.status === 403 ||\n01688|                            (response.status === 400 && data?.errors?.some((err: any) => \n01689|                              err.detail?.toLowerCase()?.includes('session') ||\n01690|                              err.detail?.toLowerCase()?.includes('auth') ||\n01691|                              err.detail?.toLowerCase()?.includes('invalid')\n01692|                            ));\n01693| \n01694|         if (isAuthError && attempt < maxRetries) {\n01695|           console.log('üîÑ –î–õ: –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –≤—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...');\n01696|           const newSessionId = await getDellinSessionId();\n01697|           if (newSessionId) {\n01698|             console.log('‚úÖ –î–õ: –ø–æ–ª—É—á–µ–Ω –Ω–æ–≤—ã–π SessionID, –æ–±–Ω–æ–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å...');\n01699|             // –û–±–Ω–æ–≤–ª—è–µ–º sessionID –≤ –∑–∞–ø—Ä–æ—Å–µ\n01700|             requestData.sessionID = newSessionId;\n01701|             sessionID = newSessionId;\n01702|             continue; // –ü—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —Å –Ω–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n01703|           } else {\n01704|             console.error('‚ùå –î–õ: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π SessionID');\n01705|             break;\n01706|           }\n01707|         }\n01708|         \n01709|         if (response.status === 400 && data?.errors) {\n01710|           console.log('=== –ê–ù–ê–õ–ò–ó –û–®–ò–ë–ö–ò 400 ===');\n01711|           console.log('üîç –û—à–∏–±–∫–∏:', data.errors);\n01712|           data.errors.forEach((error: any, index: number) => {\n01713|             console.log(`üîç –û—à–∏–±–∫–∞ ${index + 1}:`, error);\n01714|             console.log(`   - –ü–æ–ª–µ: ${error.field || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`);\n01715|             console.log(`   - –°–æ–æ–±—â–µ–Ω–∏–µ: ${error.detail || error.message || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`);\n01716|           });\n01717|           console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –û–®–ò–ë–ö–ò 400 ===');\n01718|         }\n01719| \n01720|         // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–Ω—ã–π –∏–ª–∏ –Ω–µ —Å–≤—è–∑–∞–Ω —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É\n01721|         break;\n01722|       }\n01723| \n01724|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –æ—à–∏–±–∫–∏ –ü–ï–†–ï–î –∞–Ω–∞–ª–∏–∑–æ–º –¥–∞–Ω–Ω—ã—Ö\n01725|       if (!response.ok || !data.data) {\n01726|         console.log('‚ùå –û—à–∏–±–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç API - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö');\n01727|         const errorMessage = data.metadata?.detail || \n01728|                            data.metadata?.message || \n01729|                            data.errors?.[0]?.detail || \n01730|                            (data.metadata?.status !== 200 ? `HTTP ${data.metadata?.status}` : '') ||\n01731|                            `HTTP ${response.status} - ${response.statusText}` ||\n01732|                            '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏';\n01733|         return {\n01734|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01735|           price: 0,\n01736|           days: 0,\n01737|           error: errorMessage,\n01738|           requestData,\n01739|           responseData: data,\n01740|           apiUrl,\n01741|           sessionId: sessionID\n01742|         };\n01743|       }\n01744|       \n01745|       // –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –°–¢–†–ê–•–û–í–ö–ò (—Ç–æ–ª—å–∫–æ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞)\n01746|       console.log('=== –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –°–¢–†–ê–•–û–í–ö–ò ===');\n01747|       console.log('üîç –ü–†–û–í–ï–†–ö–ê –°–¢–†–£–ö–¢–£–†–´ –î–ê–ù–ù–´–•:');\n01748|       console.log('üîç data:', data ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n01749|       console.log('üîç typeof data:', typeof data);\n01750|       console.log('üîç data.data:', data?.data ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n01751|       console.log('üîç typeof data.data:', typeof data?.data);\n01752|       \n01753|       // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–π—Å—Ç–≤ data.data\n01754|       if (data?.data) {\n01755|         console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤–æ–π—Å—Ç–≤–∞ data.data:');\n01756|         console.log('üîç data.data.derival:', typeof data.data.derival, data.data.derival);\n01757|         console.log('üîç data.data.arrival:', typeof data.data.arrival, data.data.arrival);\n01758|         console.log('üîç data.data.intercity:', typeof data.data.intercity, data.data.intercity);\n01759|       }\n01760|       \n01761|       if (!data) {\n01762|         console.error('‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: data undefined/null');\n01763|         return {\n01764|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01765|           price: 0,\n01766|           days: 0,\n01767|           error: '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ API: –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã',\n01768|           apiUrl,\n01769|           requestData,\n01770|           responseData: null\n01771|         };\n01772|       }\n01773|       \n01774|       try {\n01775|         console.log('üîç –ü–û–õ–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê data.data:', JSON.stringify(data.data, null, 2));\n01776|       } catch (jsonError) {\n01777|         console.error('‚ùå –û—à–∏–±–∫–∞ JSON.stringify –¥–ª—è data.data:', jsonError);\n01778|         console.log('üîç data.data (toString):', data.data?.toString?.() || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å');\n01779|       }\n01780|       \n01781|       // –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç—Ä–∞—Ö–æ–≤–∫–æ–π\n01782|       console.log('üí≥ –ü–û–ò–°–ö –ö–û–ú–ü–û–ù–ï–ù–¢–û–í –°–¢–†–ê–•–û–í–ö–ò:');\n01783|       console.log('üí≥ data.data.insurance:', data.data?.insurance);\n01784|       console.log('üí≥ data.data.cargoInsurance:', data.data?.cargoInsurance);\n01785|       console.log('üí≥ data.data.termInsurance:', data.data?.termInsurance);\n01786|       console.log('üí≥ data.data.insuranceDetails:', data.data?.insuranceDetails);\n01787|       console.log('üí≥ data.data.services:', data.data?.services);\n01788|       console.log('üí≥ data.data.additionalServices:', data.data?.additionalServices);\n01789|       \n01790|       // –ü–æ–∏—Å–∫ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏ –≤ –¥—Ä—É–≥–∏—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö\n01791|       try {\n01792|         console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º derival...');\n01793|         if (data.data?.derival) {\n01794|           console.log('üí≥ derival –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n01795|           console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –ó–ê–ë–û–ï data.data.derival.insurance:', data.data.derival?.insurance);\n01796|         } else {\n01797|           console.log('üí≥ derival –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n01798|         }\n01799|         \n01800|         console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º arrival...');\n01801|         if (data.data?.arrival) {\n01802|           console.log('üí≥ arrival –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n01803|           console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –î–û–°–¢–ê–í–ö–ï data.data.arrival.insurance:', data.data.arrival?.insurance);\n01804|         } else {\n01805|           console.log('üí≥ arrival –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n01806|         }\n01807|         \n01808|         console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º intercity...');\n01809|         if (data.data?.intercity) {\n01810|           console.log('üí≥ intercity –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n01811|           console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –ü–ï–†–ï–í–û–ó–ö–ï data.data.intercity.insurance:', data.data.intercity?.insurance);\n01812|         } else {\n01813|           console.log('üí≥ intercity –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n01814|         }\n01815|       } catch (error) {\n01816|         console.error('‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–µ–∫—Ü–∏–π —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏:', error);\n01817|         console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', error instanceof Error ? error.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n01818|       }\n01819|       \n01820|       // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö \"insurance\"\n01821|       const findInsuranceFields = (obj: any, path = '') => {\n01822|         if (typeof obj !== 'object' || obj === null || obj === undefined) return;\n01823|         \n01824|         try {\n01825|           Object.keys(obj).forEach(key => {\n01826|             const fullPath = path ? `${path}.${key}` : key;\n01827|             if (key.toLowerCase().includes('insurance') || key.toLowerCase().includes('insur')) {\n01828|               console.log(`üí≥ –ù–ê–ô–î–ï–ù–û –ü–û–õ–ï –°–¢–†–ê–•–û–í–ö–ò [${fullPath}]:`, obj[key]);\n01829|             }\n01830|             if (typeof obj[key] === 'object' && obj[key] !== null && obj[key] !== undefined) {\n01831|               findInsuranceFields(obj[key], fullPath);\n01832|             }\n01833|           });\n01834|         } catch (error) {\n01835|           console.error(`üí≥ –û—à–∏–±–∫–∞ –≤ findInsuranceFields –¥–ª—è –ø—É—Ç–∏ ${path}:`, error);\n01836|         }\n01837|       };\n01838|       \n01839|       console.log('üí≥ –†–ï–ö–£–†–°–ò–í–ù–´–ô –ü–û–ò–°–ö –ü–û–õ–ï–ô –°–¢–†–ê–•–û–í–ö–ò:');\n01840|       try {\n01841|         if (data && data.data) {\n01842|           findInsuranceFields(data.data, 'data.data');\n01843|         } else {\n01844|           console.log('üí≥ –ü—Ä–æ–ø—É—Å–∫ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞: data.data –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');\n01845|         }\n01846|       } catch (error) {\n01847|         console.error('‚ùå –û–®–ò–ë–ö–ê –≤ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–º –ø–æ–∏—Å–∫–µ:', error);\n01848|         console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', error instanceof Error ? error.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n01849|       }\n01850|       console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –°–¢–†–ê–•–û–í–ö–ò ===');\n01851|       \n01852|       // –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ packages –≤ –æ—Ç–≤–µ—Ç–µ\n01853|       console.log('=== –ü–û–ò–°–ö PACKAGES –í –û–¢–í–ï–¢–ï ===');\n01854|       console.log('üì¶ data.data =', data.data);\n01855|       console.log('üì¶ data.data.packages =', data.data?.packages);\n01856|       console.log('üì¶ –¢–∏–ø data.data.packages:', typeof data.data?.packages);\n01857|       if (data.data?.packages) {\n01858|         console.log('‚úÖ PACKAGES –ù–ê–ô–î–ï–ù –í –û–¢–í–ï–¢–ï!');\n01859|         try {\n01860|           console.log('üì¶ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ packages:', JSON.stringify(data.data.packages, null, 2));\n01861|         } catch (jsonError) {\n01862|           console.error('‚ùå –û—à–∏–±–∫–∞ JSON.stringify –¥–ª—è packages:', jsonError);\n01863|           console.log('üì¶ packages (toString):', data.data.packages?.toString?.() || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å');\n01864|         }\n01865|       } else {\n01866|         console.log('‚ùå PACKAGES –ù–ï –ù–ê–ô–î–ï–ù –í –û–¢–í–ï–¢–ï');\n01867|       }\n01868|       console.log('=== –ö–û–ù–ï–¶ –ü–û–ò–°–ö–ê PACKAGES ===');\n01869| \n01870|       if (response.ok && data.data && data.metadata?.status === 200) {\n01871|         let totalPrice = data.data.price || 0;\n01872|         console.log('üí∞ –†–ê–°–ß–ï–¢ –ò–¢–û–ì–û–í–û–ô –°–¢–û–ò–ú–û–°–¢–ò:');\n01873|         console.log('üí∞ –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å data.data.price (–£–ñ–ï –í–ö–õ–Æ–ß–ê–ï–¢ –í–°–ï):', totalPrice);\n01874|         \n01875|         // –°–¢–†–ê–•–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n01876|         if (data.data.insurance) {\n01877|           console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ data.data.insurance (–£–ñ–ï –≤–∫–ª—é—á–µ–Ω–∞ –≤ –±–∞–∑–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):', data.data.insurance);\n01878|           console.log('üí∞ –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞—Ö–æ–≤–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ');\n01879|         } else {\n01880|           console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–≤–µ—Ç–µ');\n01881|         }\n01882|         \n01883|         // –£–ü–ê–ö–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n01884|         console.log('üí∞ –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–ë –£–ü–ê–ö–û–í–ö–ï (–£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –í –û–°–ù–û–í–ù–£–Æ –°–¢–û–ò–ú–û–°–¢–¨):');\n01885|         console.log('üí∞ data.data.packages =', data.data.packages);\n01886|         console.log('üí∞ form.needPackaging =', form.needPackaging);\n01887|         \n01888|         if (data.data.packages && form.needPackaging) {\n01889|           console.log('üí∞ ‚úÖ –£–ü–ê–ö–û–í–ö–ê –ü–†–ò–°–£–¢–°–¢–í–£–ï–¢ –í –û–¢–í–ï–¢–ï (—Ü–µ–Ω–∞ —É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ data.data.price)');\n01890|           console.log('üí∞ –¢–∏–ø packages:', Array.isArray(data.data.packages) ? 'Array' : 'Object');\n01891|           \n01892|           if (Array.isArray(data.data.packages)) {\n01893|             data.data.packages.forEach((pkg: any, index: number) => {\n01894|               console.log(`üí∞ Package [${index}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n01895|             });\n01896|           } else {\n01897|             Object.entries(data.data.packages).forEach(([key, pkg]: [string, any]) => {\n01898|               console.log(`üí∞ Package [${key}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n01899|             });\n01900|           }\n01901|         } else {\n01902|           console.log('üí∞ ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∞—Å—å');\n01903|         }\n01904| \n01905|         // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–∞–∫ —Ä–∞–∑–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –¥–∞—Ç–∞–º–∏ pickup –∏ arrivalToOspReceiver\n01906|         let deliveryDays = 0;\n01907|         try {\n01908|           console.log('=== –ü–û–ò–°–ö –î–ê–¢ –í –û–¢–í–ï–¢–ï ===');\n01909|           \n01910|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–µ—Å—Ç–∞ –≥–¥–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–∞—Ç—ã\n01911|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.pickup:', data.data?.pickup);\n01912|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.pickup:', data.pickup);\n01913|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.pickup:', data?.pickup);\n01914|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.arrivalToOspReceiver:', data.data?.arrivalToOspReceiver);\n01915|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.arrivalToOspReceiver:', data.arrivalToOspReceiver);\n01916|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.arrivalToOspReceiver:', data?.arrivalToOspReceiver);\n01917|           \n01918|           // –ë–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–π –ø–æ–∏—Å–∫ –≤–æ –≤—Å–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ data\n01919|           const findDateInObject = (obj: any, fieldName: string): string | null => {\n01920|             if (!obj || typeof obj !== 'object') return null;\n01921|             \n01922|             for (const [key, value] of Object.entries(obj)) {\n01923|               if (key === fieldName && typeof value === 'string') {\n01924|                 return value;\n01925|               }\n01926|               if (typeof value === 'object' && value !== null) {\n01927|                 const found = findDateInObject(value, fieldName);\n01928|                 if (found) return found;\n01929|               }\n01930|             }\n01931|             return null;\n01932|           };\n01933|           \n01934|           const pickup = findDateInObject(data, 'pickup');\n01935|           const arrivalToOspReceiver = findDateInObject(data, 'arrivalToOspReceiver');\n01936|           \n01937|           console.log('–ù–ê–ô–î–ï–ù–ù–´–ï –î–ê–¢–´:');\n01938|           console.log('pickup:', pickup);\n01939|           console.log('arrivalToOspReceiver:', arrivalToOspReceiver);\n01940|           \n01941|           if (pickup && arrivalToOspReceiver) {\n01942|             // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—ã (—Ñ–æ—Ä–º–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å \"2025-09-27\" –∏–ª–∏ \"2025-09-27 10:00:00\")\n01943|             const pickupDate = new Date(pickup);\n01944|             const arrivalDate = new Date(arrivalToOspReceiver);\n01945|             \n01946|             console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ pickup:', pickupDate);\n01947|             console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ arrival:', arrivalDate);\n01948|             \n01949|             // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã\n01950|             if (!isNaN(pickupDate.getTime()) && !isNaN(arrivalDate.getTime())) {\n01951|               // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–æ—Å—Ç—å –≤ –¥–Ω—è—Ö\n01952|               const timeDiff = arrivalDate.getTime() - pickupDate.getTime();\n01953|               deliveryDays = Math.max(1, Math.ceil(timeDiff / (1000 * 3600 * 24))); // –ú–∏–Ω–∏–º—É–º 1 –¥–µ–Ω—å\n01954|               \n01955|               console.log('–†–∞–∑–Ω–æ—Å—Ç—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö:', timeDiff);\n01956|               console.log('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –í–´–ß–ò–°–õ–ï–ù —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:', deliveryDays, '–¥–Ω–µ–π');\n01957|             } else {\n01958|               console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞—Ç—ã –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞');\n01959|               console.error('pickup Date object:', pickupDate);\n01960|               console.error('arrival Date object:', arrivalDate);\n01961|             }\n01962|           } else {\n01963|             console.warn('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ –Ω–∞–π–¥–µ–Ω—ã –¥–∞—Ç—ã pickup –∏–ª–∏ arrivalToOspReceiver');\n01964|             console.log('pickup –Ω–∞–π–¥–µ–Ω:', !!pickup, pickup);\n01965|             console.log('arrivalToOspReceiver –Ω–∞–π–¥–µ–Ω:', !!arrivalToOspReceiver, arrivalToOspReceiver);\n01966|           }\n01967|         } catch (error) {\n01968|           console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –û—à–∏–±–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:', error);\n01969|         }\n01970| \n01971|         console.log('üí∞ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ò–¢–û–ì–û–í–ê–Ø –°–¢–û–ò–ú–û–°–¢–¨:', Math.round(totalPrice));\n01972|         \n01973|         return {\n01974|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01975|           price: Math.round(totalPrice),\n01976|           days: deliveryDays || 0,\n01977|           details: data.data || {},\n01978|           requestData,\n01979|           responseData: data,\n01980|           apiUrl,\n01981|           sessionId: sessionID\n01982|         };\n01983|       } else {\n01984|         const errorMessage = data.metadata?.detail || \n01985|                            data.metadata?.message || \n01986|                            data.errors?.[0]?.detail || \n01987|                            (data.metadata?.status !== 200 ? `HTTP ${data.metadata?.status}` : '') ||\n01988|                            '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏';\n01989|         return {\n01990|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01991|           price: 0,\n01992|           days: 0,\n01993|           error: errorMessage,\n01994|           requestData,\n01995|           responseData: data,\n01996|           apiUrl,\n01997|           sessionId: sessionID\n01998|         };\n01999|       }\n02000|     } catch (error: any) {\n\n(File has more lines. Use 'offset' parameter to read beyond line 2000)\n</file>",
    "metadata": {
      "preview": "'use client';\n\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Switch } from '@/components/ui/switch';\nimport { Plus, Truck, Building2, Map, Settings, Package2, Trash2 } from 'lucide-react';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { Collapsible, CollapsibleContent } from '@/components/ui/collapsible';\nimport ProductSearch from '@/components/ProductSearch';\nimport ProductManager from '@/components/ProductManager';\nimport TruckVisualization from '@/components/TruckVisualization';\nimport { FurnitureProduct, ProductInForm, CargoWithMetadata } from '@/lib/furniture-types';\nimport { saveFormData, loadFormData, hasStoredFormData, createDebouncedSaver, clearFormData } from '@/lib/form-storage';\nimport { "
    },
    "title": "app/page.tsx",
    "time": {
      "start": 1759765843759,
      "end": 1759765843766
    }
  }
}