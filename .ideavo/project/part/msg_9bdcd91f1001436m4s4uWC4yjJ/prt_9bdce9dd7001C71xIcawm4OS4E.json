{
  "id": "prt_9bdce9dd7001C71xIcawm4OS4E",
  "messageID": "msg_9bdcd91f1001436m4s4uWC4yjJ",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "read",
  "callID": "toolu_01LXEUpU5ZW9YC6apjr4nrhT",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/lib/form-storage.ts",
      "offset": 150,
      "limit": 100
    },
    "output": "<file>\n00151|   }\n00152| };\n00153| \n00154| /**\n00155|  * –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å —Ç—Ä–æ–π–Ω–æ–π –∑–∞—â–∏—Ç–æ–π (localStorage -> IndexedDB -> cookies)\n00156|  */\n00157| export const loadFormData = (): StoredFormData | null => {\n00158|   try {\n00159|     if (typeof window === 'undefined') {\n00160|       return null; // SSR safe\n00161|     }\n00162| \n00163|     let savedData = localStorage.getItem(FORM_DATA_KEY);\n00164|     let dataSource = 'localStorage';\n00165|     \n00166|     // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –≤ localStorage, –ø—Ä–æ–±—É–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –¥—Ä—É–≥–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤\n00167|     if (!savedData) {\n00168|       console.log('üìù –î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ localStorage, –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥—Ä—É–≥–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏...');\n00169|       \n00170|       // –ü—Ä–æ–±—É–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ IndexedDB (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)\n00171|       loadFormDataFromIndexedDB().then(indexedData => {\n00172|         if (indexedData) {\n00173|           console.log('üìÇ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ IndexedDB');\n00174|           try {\n00175|             localStorage.setItem(FORM_DATA_KEY, indexedData);\n00176|             console.log('üíæ –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ localStorage –∏–∑ IndexedDB');\n00177|           } catch (error) {\n00178|             console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å localStorage –∏–∑ IndexedDB:', error);\n00179|           }\n00180|         }\n00181|       }).catch(error => {\n00182|         console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ IndexedDB:', error);\n00183|       });\n00184|       \n00185|       // –ü—Ä–æ–±—É–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ cookies (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)\n00186|       const cookieData = loadFormDataFromCookies();\n00187|       if (cookieData) {\n00188|         savedData = cookieData;\n00189|         dataSource = 'cookies';\n00190|         console.log('üìÇ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ cookies');\n00191|         try {\n00192|           localStorage.setItem(FORM_DATA_KEY, cookieData);\n00193|           console.log('üíæ –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ localStorage –∏–∑ cookies');\n00194|         } catch (error) {\n00195|           console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å localStorage –∏–∑ cookies:', error);\n00196|         }\n00197|       }\n00198|     }\n00199|     \n00200|     if (!savedData) {\n00201|       console.log('üìù –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∏ –≤ –æ–¥–Ω–æ–º –∏—Å—Ç–æ—á–Ω–∏–∫–µ');\n00202|       return null;\n00203|     }\n00204| \n00205|     const parsedData = JSON.parse(savedData) as StoredFormData;\n00206|     \n00207|     // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –¥–∞–Ω–Ω—ã—Ö\n00208|     if (parsedData.version !== FORM_VERSION) {\n00209|       console.warn('‚ö†Ô∏è –í–µ—Ä—Å–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è...');\n00210|       // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã\n00211|       return migrateFormData(parsedData);\n00212|     }\n00213| \n00214|     // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–∞–≤–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ - —É–¥–∞–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π)\n00215|     const thirtyDaysInMs = 30 * 24 * 60 * 60 * 1000;\n00216|     if (Date.now() - parsedData.timestamp > thirtyDaysInMs) {\n00217|       console.log('üóëÔ∏è –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä—ã–µ, —É–¥–∞–ª—è–µ–º...');\n00218|       clearFormData();\n00219|       return null;\n00220|     }\n00221| \n00222|     console.log(`üìÇ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ ${dataSource}:`, parsedData);\n00223|     return parsedData;\n00224|   } catch (error) {\n00225|     console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã:', error);\n00226|     return null;\n00227|   }\n00228| };\n00229| \n00230| /**\n00231|  * –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã\n00232|  */\n00233| const migrateFormData = (oldData: any): StoredFormData | null => {\n00234|   try {\n00235|     // –ë–∞–∑–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è - –ø—Ä–∏–≤–æ–¥–∏–º –∫ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ\n00236|     const migratedData: StoredFormData = {\n00237|       version: FORM_VERSION,\n00238|       timestamp: Date.now(),\n00239|       cargos: oldData.cargos || [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00240|       fromCity: oldData.fromCity || '',\n00241|       toCity: oldData.toCity || '',\n00242|       fromAddress: oldData.fromAddress || '',\n00243|       toAddress: oldData.toAddress || '',\n00244|       declaredValue: oldData.declaredValue || 0,\n00245|       needPackaging: oldData.needPackaging || false,\n00246|       needLoading: oldData.needLoading || false,\n00247|       needCarry: oldData.needCarry || false,\n00248|       floor: oldData.floor || 1,\n00249|       hasFreightLift: oldData.hasFreightLift || false,\n00250|       needInsurance: oldData.needInsurance || false,\n\n(File has more lines. Use 'offset' parameter to read beyond line 250)\n</file>",
    "metadata": {
      "preview": "  }\n};\n\n/**\n * –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å —Ç—Ä–æ–π–Ω–æ–π –∑–∞—â–∏—Ç–æ–π (localStorage -> IndexedDB -> cookies)\n */\nexport const loadFormData = (): StoredFormData | null => {\n  try {\n    if (typeof window === 'undefined') {\n      return null; // SSR safe\n    }\n\n    let savedData = localStorage.getItem(FORM_DATA_KEY);\n    let dataSource = 'localStorage';\n    \n    // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –≤ localStorage, –ø—Ä–æ–±—É–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –¥—Ä—É–≥–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤\n    if (!savedData) {\n      console.log('üìù –î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ localStorage, –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥—Ä—É–≥–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏...');\n      \n      // –ü—Ä–æ–±—É–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ IndexedDB (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)"
    },
    "title": "lib/form-storage.ts",
    "time": {
      "start": 1759826059123,
      "end": 1759826059125
    }
  }
}