{
  "id": "prt_9e324c1250017ptqWwBprLsnNc",
  "messageID": "msg_9e324aa80001R1OG0ucCBUuin5",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "read",
  "callID": "call_64597308",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "components/diagnostic/TestRunner.tsx"
    },
    "output": "<file>\n00001| 'use client';\n00002| \n00003| import React, { useState, useCallback } from 'react';\n00004| import { Button } from '@/components/ui/button';\n00005| import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\n00006| import { Badge } from '@/components/ui/badge';\n00007| import { ScrollArea } from '@/components/ui/scroll-area';\n00008| import { Play, CheckCircle, XCircle, Clock, Terminal } from 'lucide-react';\n00009| import { apiRequestWithTimeout } from '@/lib/api-utils';\n00010| \n00011| interface TestResult {\n00012|   testType: string;\n00013|   success: boolean;\n00014|   output: string | null;\n00015|   errors: string | null;\n00016|   executionTime: number;\n00017|   timestamp: string;\n00018| }\n00019| \n00020| interface TestRunnerProps {\n00021|   className?: string;\n00022| }\n00023| \n00024| const availableTests = [\n00025|   {\n00026|     id: 'dellin-api',\n00027|     name: 'Dellin API Tests',\n00028|     description: 'Test Dellin API endpoints and validation',\n00029|     script: 'test-dellin-api.js'\n00030|   },\n00031|   {\n00032|     id: 'performance',\n00033|     name: 'Performance Tests',\n00034|     description: 'Comprehensive performance testing and metrics',\n00035|     script: 'performance-test.js'\n00036|   },\n00037|   {\n00038|     id: 'dellin-derival',\n00039|     name: 'Dellin Derival Tests',\n00040|     description: 'Test derival error handling fixes',\n00041|     script: 'test-dellin-derival.js'\n00042|   },\n00043|   {\n00044|     id: 'dellin-terminals',\n00045|     name: 'Dellin Terminals Tests',\n00046|     description: 'Test terminal data processing',\n00047|     script: 'test-dellin-terminals.js'\n00048|   },\n00049|   {\n00050|     id: 'dellin-terminals-simple',\n00051|     name: 'Simple Terminals Tests',\n00052|     description: 'Simplified terminal testing',\n00053|     script: 'test-dellin-terminals-simple.js'\n00054|   },\n00055|   {\n00056|     id: 'spb-terminals',\n00057|     name: 'SPB Terminals Tests',\n00058|     description: 'Saint Petersburg terminals testing',\n00059|     script: 'test-spb-terminals.js'\n00060|   }\n00061| ];\n00062| \n00063| export default function TestRunner({ className }: TestRunnerProps) {\n00064|   const [runningTests, setRunningTests] = useState<Set<string>>(new Set());\n00065|   const [testResults, setTestResults] = useState<Map<string, TestResult>>(new Map());\n00066|   const [selectedTest, setSelectedTest] = useState<string | null>(null);\n00067| \n00068|   const runTest = useCallback(async (testId: string) => {\n00069|     setRunningTests(prev => new Set(prev).add(testId));\n00070|     setSelectedTest(testId);\n00071| \n00072|     try {\n00073|       const response = await apiRequestWithTimeout('/api/run-tests', {\n00074|         method: 'POST',\n00075|         headers: { 'Content-Type': 'application/json' },\n00076|         body: JSON.stringify({ testType: testId })\n00077|       }, { timeout: 35000 });\n00078| \n00079|       const result: TestResult = await response.json();\n00080|       setTestResults(prev => new Map(prev).set(testId, result));\n00081|     } catch (error: any) {\n00082|       const errorResult: TestResult = {\n00083|         testType: testId,\n00084|         success: false,\n00085|         output: null,\n00086|         errors: error.message || 'Network error',\n00087|         executionTime: 0,\n00088|         timestamp: new Date().toISOString()\n00089|       };\n00090|       setTestResults(prev => new Map(prev).set(testId, errorResult));\n00091|     } finally {\n00092|       setRunningTests(prev => {\n00093|         const newSet = new Set(prev);\n00094|         newSet.delete(testId);\n00095|         return newSet;\n00096|       });\n00097|     }\n00098|   }, []);\n00099| \n00100|   const runAllTests = useCallback(async () => {\n00101|     for (const test of availableTests) {\n00102|       await runTest(test.id);\n00103|       // Small delay between tests\n00104|       await new Promise(resolve => setTimeout(resolve, 500));\n00105|     }\n00106|   }, [runTest]);\n00107| \n00108|   const getTestStatus = (testId: string) => {\n00109|     if (runningTests.has(testId)) return 'running';\n00110|     const result = testResults.get(testId);\n00111|     if (!result) return 'idle';\n00112|     return result.success ? 'success' : 'error';\n00113|   };\n00114| \n00115|   const getStatusIcon = (status: string) => {\n00116|     switch (status) {\n00117|       case 'running':\n00118|         return <Clock className=\"h-4 w-4 animate-spin text-blue-500\" />;\n00119|       case 'success':\n00120|         return <CheckCircle className=\"h-4 w-4 text-green-500\" />;\n00121|       case 'error':\n00122|         return <XCircle className=\"h-4 w-4 text-red-500\" />;\n00123|       default:\n00124|         return <Terminal className=\"h-4 w-4 text-gray-400\" />;\n00125|     }\n00126|   };\n00127| \n00128|   const getStatusBadge = (status: string) => {\n00129|     switch (status) {\n00130|       case 'running':\n00131|         return <Badge variant=\"secondary\">Running</Badge>;\n00132|       case 'success':\n00133|         return <Badge variant=\"default\" className=\"bg-green-500\">Passed</Badge>;\n00134|       case 'error':\n00135|         return <Badge variant=\"destructive\">Failed</Badge>;\n00136|       default:\n00137|         return <Badge variant=\"outline\">Not Run</Badge>;\n00138|     }\n00139|   };\n00140| \n00141|   const selectedResult = selectedTest ? testResults.get(selectedTest) : null;\n00142| \n00143|   return (\n00144|     <div className={`space-y-6 ${className}`}>\n00145|       <Card>\n00146|         <CardHeader>\n00147|           <CardTitle className=\"flex items-center gap-2\">\n00148|             <Terminal className=\"h-5 w-5\" />\n00149|             Test Runner\n00150|           </CardTitle>\n00151|           <CardDescription>\n00152|             Run standalone test scripts and view results in real-time\n00153|           </CardDescription>\n00154|         </CardHeader>\n00155|         <CardContent>\n00156|           <div className=\"flex gap-2 mb-4\">\n00157|             <Button\n00158|               onClick={runAllTests}\n00159|               disabled={runningTests.size > 0}\n00160|               className=\"flex items-center gap-2\"\n00161|             >\n00162|               <Play className=\"h-4 w-4\" />\n00163|               Run All Tests\n00164|             </Button>\n00165|           </div>\n00166| \n00167|           <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n00168|             {availableTests.map((test) => {\n00169|               const status = getTestStatus(test.id);\n00170|               const result = testResults.get(test.id);\n00171| \n00172|               return (\n00173|                 <Card key={test.id} className=\"cursor-pointer hover:shadow-md transition-shadow\">\n00174|                   <CardHeader className=\"pb-3\">\n00175|                     <div className=\"flex items-center justify-between\">\n00176|                       <CardTitle className=\"text-sm\">{test.name}</CardTitle>\n00177|                       {getStatusIcon(status)}\n00178|                     </div>\n00179|                     <CardDescription className=\"text-xs\">\n00180|                       {test.description}\n00181|                     </CardDescription>\n00182|                   </CardHeader>\n00183|                   <CardContent className=\"pt-0\">\n00184|                     <div className=\"flex items-center justify-between mb-2\">\n00185|                       {getStatusBadge(status)}\n00186|                       {result && (\n00187|                         <span className=\"text-xs text-muted-foreground\">\n00188|                           {result.executionTime}ms\n00189|                         </span>\n00190|                       )}\n00191|                     </div>\n00192|                     <Button\n00193|                       size=\"sm\"\n00194|                       variant={selectedTest === test.id ? \"default\" : \"outline\"}\n00195|                       onClick={() => runTest(test.id)}\n00196|                       disabled={runningTests.has(test.id)}\n00197|                       className=\"w-full\"\n00198|                     >\n00199|                       {runningTests.has(test.id) ? 'Running...' : 'Run Test'}\n00200|                     </Button>\n00201|                   </CardContent>\n00202|                 </Card>\n00203|               );\n00204|             })}\n00205|           </div>\n00206|         </CardContent>\n00207|       </Card>\n00208| \n00209|       {selectedResult && (\n00210|         <Card>\n00211|           <CardHeader>\n00212|             <CardTitle className=\"flex items-center gap-2\">\n00213|               {getStatusIcon(selectedResult.success ? 'success' : 'error')}\n00214|               Test Results: {availableTests.find(t => t.id === selectedTest)?.name}\n00215|             </CardTitle>\n00216|             <CardDescription>\n00217|               Executed at {new Date(selectedResult.timestamp).toLocaleString('ru-RU')} â€¢ {selectedResult.executionTime}ms\n00218|             </CardDescription>\n00219|           </CardHeader>\n00220|           <CardContent>\n00221|             <ScrollArea className=\"h-96 w-full rounded-md border p-4\">\n00222|               {selectedResult.output && (\n00223|                 <div className=\"mb-4\">\n00224|                   <h4 className=\"font-semibold text-green-600 mb-2\">Output:</h4>\n00225|                   <pre className=\"text-sm bg-green-50 p-3 rounded border overflow-x-auto\">\n00226|                     {selectedResult.output}\n00227|                   </pre>\n00228|                 </div>\n00229|               )}\n00230| \n00231|               {selectedResult.errors && (\n00232|                 <div>\n00233|                   <h4 className=\"font-semibold text-red-600 mb-2\">Errors:</h4>\n00234|                   <pre className=\"text-sm bg-red-50 p-3 rounded border overflow-x-auto text-red-800\">\n00235|                     {selectedResult.errors}\n00236|                   </pre>\n00237|                 </div>\n00238|               )}\n00239| \n00240|               {!selectedResult.output && !selectedResult.errors && (\n00241|                 <div className=\"text-center text-muted-foreground py-8\">\n00242|                   No output generated\n00243|                 </div>\n00244|               )}\n00245|             </ScrollArea>\n00246|           </CardContent>\n00247|         </Card>\n00248|       )}\n00249|     </div>\n00250|   );\n00251| }\n</file>",
    "metadata": {
      "preview": "'use client';\n\nimport React, { useState, useCallback } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Play, CheckCircle, XCircle, Clock, Terminal } from 'lucide-react';\nimport { apiRequestWithTimeout } from '@/lib/api-utils';\n\ninterface TestResult {\n  testType: string;\n  success: boolean;\n  output: string | null;\n  errors: string | null;\n  executionTime: number;\n  timestamp: string;\n}\n\ninterface TestRunnerProps {"
    },
    "title": "components/diagnostic/TestRunner.tsx",
    "time": {
      "start": 1760452460838,
      "end": 1760452460840
    }
  }
}