{
  "id": "prt_ab8c3c41a001KECjLlCxQnHs4V",
  "sessionID": "ses_54b97e247ffenCZZa4jZiIWD0l",
  "messageID": "msg_ab8c2d709001kCLD3uOXfLgpyY",
  "type": "tool",
  "callID": "call_e1db29d268bf4ba289a5962b",
  "tool": "write",
  "state": {
    "status": "completed",
    "input": {
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { orderNumber, formData, results, screenshot } = body;\n\n    console.log('üíæ Saving calculation:', { orderNumber, hasScreenshot: !!screenshot });\n\n    // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π\n    if (!formData || !results) {\n      return NextResponse.json(\n        { \n          success: false, \n          error: 'Missing required fields: formData and results are required' \n        },\n        { status: 400 }\n      );\n    }\n\n    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\n    const calculation = await prisma.calculation.create({\n      data: {\n        orderNumber: orderNumber || null,\n        formData: formData,\n        results: results,\n        screenshot: screenshot || null,\n        status: 'active'\n      }\n    });\n\n    console.log('‚úÖ Calculation saved successfully:', calculation.id);\n\n    return NextResponse.json({\n      success: true,\n      data: {\n        id: calculation.id,\n        orderNumber: calculation.orderNumber,\n        createdAt: calculation.createdAt\n      }\n    });\n\n  } catch (error: any) {\n    console.error('‚ùå Error saving calculation:', error);\n    \n    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\n    if (error.code === 'P1001') {\n      return NextResponse.json(\n        { \n          success: false, \n          error: 'Database connection error. Please check DATABASE_URL configuration.' \n        },\n        { status: 500 }\n      );\n    }\n\n    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Prisma\n    if (error.code === 'P2002') {\n      return NextResponse.json(\n        { \n          success: false, \n          error: 'Order number already exists. Please use a different order number.' \n        },\n        { status: 409 }\n      );\n    }\n\n    return NextResponse.json(\n      { \n        success: false, \n        error: 'Internal server error: ' + error.message \n      },\n      { status: 500 }\n    );\n  } finally {\n    await prisma.$disconnect();\n  }\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const orderNumber = searchParams.get('orderNumber');\n\n    console.log('üìã Fetching calculations:', { orderNumber });\n\n    if (orderNumber) {\n      // –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∑–∞–∫–∞–∑–∞\n      const calculation = await prisma.calculation.findUnique({\n        where: { orderNumber }\n      });\n\n      if (!calculation) {\n        return NextResponse.json(\n          { \n            success: false, \n            error: 'Calculation not found' \n          },\n          { status: 404 }\n        );\n      }\n\n      return NextResponse.json({\n        success: true,\n        data: calculation\n      });\n    } else {\n      // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–∞—Å—á–µ—Ç–æ–≤ (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ)\n      const calculations = await prisma.calculation.findMany({\n        orderBy: { createdAt: 'desc' },\n        take: 50 // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n      });\n\n      return NextResponse.json({\n        success: true,\n        data: calculations\n      });\n    }\n\n  } catch (error: any) {\n    console.error('‚ùå Error fetching calculations:', error);\n    \n    return NextResponse.json(\n      { \n        success: false, \n        error: 'Internal server error: ' + error.message \n      },\n      { status: 500 }\n    );\n  } finally {\n    await prisma.$disconnect();\n  }\n}",
      "filePath": "/home/user/project/app/api/calculations/route.ts"
    },
    "output": "",
    "title": "app/api/calculations/route.ts",
    "metadata": {
      "diagnostics": {},
      "filepath": "/home/user/project/app/api/calculations/route.ts",
      "exists": false
    },
    "time": {
      "start": 1764036428830,
      "end": 1764036428833
    }
  }
}