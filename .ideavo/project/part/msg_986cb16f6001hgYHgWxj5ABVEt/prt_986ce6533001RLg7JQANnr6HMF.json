{
  "id": "prt_986ce6533001RLg7JQANnr6HMF",
  "messageID": "msg_986cb16f6001hgYHgWxj5ABVEt",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "read",
  "callID": "toolu_01UFZaRAEWFCKEsuYMYg6KEo",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx",
      "offset": 1090,
      "limit": 450
    },
    "output": "<file>\n01091|           'Authorization': `Bearer 624FC93CA677B23673BB476D4982294DC27E246F`\n01092|         },\n01093|         body: JSON.stringify(requestData)\n01094|       });\n01095| \n01096|       const data = await response.json();\n01097|       console.log('üöÄ –ü–≠–ö API –æ—Ç–≤–µ—Ç:', JSON.stringify(data, null, 2));\n01098| \n01099|       if (response.ok && !data.hasError && data.transfers && data.transfers.length > 0) {\n01100|         const transfer = data.transfers[0]; // –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Ç–∞—Ä–∏—Ñ (–∞–≤—Ç–æ)\n01101|         \n01102|         if (!transfer.hasError) {\n01103|           // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —É—Å–ª—É–≥\n01104|           const services: { name: string; description: string; price: number }[] = [];\n01105|           let totalCalculated = 0;\n01106| \n01107|           const processServices = (servicesList: any[], parentName = '') => {\n01108|             servicesList.forEach(service => {\n01109|               const serviceName = parentName ? `${parentName} - ${service.info}` : service.info;\n01110|               const serviceCost = parseFloat(service.cost) || 0;\n01111|               \n01112|               if (serviceCost > 0) {\n01113|                 services.push({\n01114|                   name: serviceName,\n01115|                   description: service.serviceType || '',\n01116|                   price: serviceCost\n01117|                 });\n01118|                 totalCalculated += serviceCost;\n01119|               }\n01120| \n01121|               // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏\n01122|               if (service.services && Array.isArray(service.services)) {\n01123|                 processServices(service.services, serviceName);\n01124|               }\n01125|             });\n01126|           };\n01127| \n01128|           if (transfer.services) {\n01129|             processServices(transfer.services);\n01130|           }\n01131| \n01132|           // –ï—Å–ª–∏ –Ω–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —É—Å–ª—É–≥, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n01133|           if (services.length === 0) {\n01134|             services.push({\n01135|               name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n01136|               description: `${senderZone.branchTitle} - ${receiverZone.branchTitle}`,\n01137|               price: Math.round(transfer.costTotal)\n01138|             });\n01139|           }\n01140| \n01141|           return {\n01142|             company: '–ü–≠–ö',\n01143|             price: Math.round(transfer.costTotal),\n01144|             days: transfer.estDeliveryTime || 3,\n01145|             details: {\n01146|               note: `–î–æ—Å—Ç–∞–≤–∫–∞ ${senderZone.branchTitle} - ${receiverZone.branchTitle} (–∞–≤—Ç–æ)`,\n01147|               services,\n01148|               senderZone: {\n01149|                 title: senderZone.branchTitle,\n01150|                 zone: senderZone.zoneName,\n01151|                 warehouseId: senderWarehouseId\n01152|               },\n01153|               receiverZone: {\n01154|                 title: receiverZone.branchTitle,\n01155|                 zone: receiverZone.zoneName,\n01156|                 warehouseId: receiverWarehouseId\n01157|               }\n01158|             },\n01159|             requestData,\n01160|             responseData: data,\n01161|             apiUrl\n01162|           };\n01163|         } else {\n01164|           throw new Error(transfer.errorMessage || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞ –ü–≠–ö');\n01165|         }\n01166|       } else {\n01167|         throw new Error(data.errorMessage || data.message || '–û—à–∏–±–∫–∞ API –ü–≠–ö');\n01168|       }\n01169|       \n01170|     } catch (error: any) {\n01171|       console.error('üö® –û—à–∏–±–∫–∞ –ü–≠–ö API:', error);\n01172|       \n01173|       // –§–æ–ª–ª–±—ç–∫ —Ä–∞—Å—á–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ\n01174|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n01175|       let basePrice = totalWeight * 18; // 18 —Ä—É–± –∑–∞ –∫–≥ –¥–ª—è –ü–≠–ö\n01176|       \n01177|       if (form.fromAddressDelivery) basePrice += 600;\n01178|       if (form.toAddressDelivery) basePrice += 600;\n01179|       if (form.needInsurance && form.declaredValue > 0) basePrice += form.declaredValue * 0.012;\n01180|       if (form.needPackaging) basePrice += totalWeight * 25;\n01181|       if (form.needCarry) basePrice += 500;\n01182|       \n01183|       return {\n01184|         company: '–ü–≠–ö',\n01185|         price: Math.round(basePrice),\n01186|         days: 3,\n01187|         details: {\n01188|           note: '–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º –ü–≠–ö (–æ—à–∏–±–∫–∞ API)',\n01189|           services: [\n01190|             {\n01191|               name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n01192|               description: `${form.fromCity} - ${form.toCity}`,\n01193|               price: Math.round(basePrice)\n01194|             }\n01195|           ]\n01196|         },\n01197|         requestData: null,\n01198|         responseData: null,\n01199|         apiUrl,\n01200|         error: `–û—à–∏–±–∫–∞ API –ü–≠–ö: ${error.message}. –ü–æ–∫–∞–∑–∞–Ω –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç.`\n01201|       };\n01202|     }\n01203|   };\n01204| \n01205|   // –ü–æ–ª—É—á–µ–Ω–∏–µ ID —Å–∫–ª–∞–¥–∞ –ü–≠–ö –ø–æ –∞–¥—Ä–µ—Å—É —á–µ—Ä–µ–∑ API\n01206|   const findPekWarehouseId = async (address: string): Promise<string | null> => {\n01207|     try {\n01208|       // –ò—Å–ø–æ–ª—å–∑—É–µ–º API –ü–≠–ö –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–∫–ª–∞–¥–∞ –ø–æ –∞–¥—Ä–µ—Å—É\n01209|       const response = await fetch('https://api.pecom.ru/v1/branches/findzonebyaddress', {\n01210|         method: 'POST',\n01211|         headers: {\n01212|           'Content-Type': 'application/json',\n01213|           'Authorization': 'Basic ' + btoa('C04C5BF2AE367BDCBDC71E7DA520A69B167D1984:')\n01214|         },\n01215|         body: JSON.stringify({\n01216|           address: address\n01217|         })\n01218|       });\n01219| \n01220|       if (response.ok) {\n01221|         const data = await response.json();\n01222|         return data.mainWarehouseId || null;\n01223|       }\n01224|       \n01225|       // –§–æ–ª–ª–±—ç–∫ –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤\n01226|       const fallbackWarehouses: { [key: string]: string } = {\n01227|         '–º–æ—Å–∫–≤–∞': 'dc6c746d-812d-11e4-bbfc-001999d8b3c5',\n01228|         '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': 'b436c978-086d-11e6-b6ca-00155d668909',\n01229|         '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': '550e8400-e29b-41d4-a716-446655440000'\n01230|       };\n01231|       \n01232|       const normalizedCity = address.toLowerCase().trim()\n01233|         .replace(/—ë/g, '–µ')\n01234|         .replace(/[\\s\\-\\.]+/g, '');\n01235|       \n01236|       for (const [city, warehouseId] of Object.entries(fallbackWarehouses)) {\n01237|         const normalizedCityKey = city.replace(/[\\s\\-\\.]+/g, '');\n01238|         if (normalizedCity.includes(normalizedCityKey) || normalizedCityKey.includes(normalizedCity)) {\n01239|           return warehouseId;\n01240|         }\n01241|       }\n01242|       \n01243|       return null;\n01244|     } catch (error) {\n01245|       console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ —Å–∫–ª–∞–¥–∞ –ü–≠–ö:', error);\n01246|       return null;\n01247|     }\n01248|   };\n01249| \n01250|   // –†–∞—Å—á–µ—Ç –¥–ª—è –ü–≠–ö —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–π API\n01251|   const calculatePEK = async (): Promise<CalculationResult> => {\n01252|     const apiUrl = 'http://calc.pecom.ru/bitrix/components/pecom/calc/ajax.php';\n01253|     \n01254|     try {\n01255|       // –ü–æ–ª—É—á–∞–µ–º ID –≥–æ—Ä–æ–¥–æ–≤\n01256|       const fromCityId = await findPekCityId(form.fromCity);\n01257|       const toCityId = await findPekCityId(form.toCity);\n01258|       \n01259|       if (!fromCityId || !toCityId) {\n01260|         return {\n01261|           company: '–ü–≠–ö',\n01262|           price: 0,\n01263|           days: 0,\n01264|           error: `–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –ü–≠–ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: ${!fromCityId ? form.fromCity : ''} ${!toCityId ? form.toCity : ''}`.trim(),\n01265|           apiUrl,\n01266|           requestData: { fromCity: form.fromCity, toCity: form.toCity, fromCityId, toCityId },\n01267|           responseData: null\n01268|         };\n01269|       }\n01270| \n01271|       // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –ø—É–±–ª–∏—á–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n01272|       const params = new URLSearchParams();\n01273|       \n01274|       // –î–æ–±–∞–≤–ª—è–µ–º –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ —Ñ–æ—Ä–º–∞—Ç—É: –®–∏—Ä–∏–Ω–∞ (–º), –î–ª–∏–Ω–∞ (–º), –í—ã—Å–æ—Ç–∞ (–º), –û–±—ä–µ–º (–º3), –í–µ—Å (–∫–≥), –ù–µ–≥–∞–±–∞—Ä–∏—Ç (0/1), –ó–¢–£ (0/1)\n01275|       form.cargos.forEach((cargo, index) => {\n01276|         const width = cargo.width / 100; // –ø–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–µ—Ç—Ä—ã\n01277|         const length = cargo.length / 100;\n01278|         const height = cargo.height / 100;\n01279|         const volume = width * length * height;\n01280|         const weight = cargo.weight;\n01281|         const isOversized = (width > 2.4 || length > 12 || height > 2.7 || weight > 1500) ? 1 : 0;\n01282|         const needZTU = form.needPackaging ? 1 : 0;\n01283|         \n01284|         params.append(`places[${index}][]`, width.toString());\n01285|         params.append(`places[${index}][]`, length.toString());\n01286|         params.append(`places[${index}][]`, height.toString());\n01287|         params.append(`places[${index}][]`, volume.toString());\n01288|         params.append(`places[${index}][]`, weight.toString());\n01289|         params.append(`places[${index}][]`, isOversized.toString());\n01290|         params.append(`places[${index}][]`, needZTU.toString());\n01291|       });\n01292|       \n01293|       // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–±–æ—Ä–∞\n01294|       params.append('take[town]', fromCityId.toString());\n01295|       params.append('take[tent]', '0'); // —Ä–∞—Å—Ç–µ–Ω—Ç—Ä–æ–≤–∫–∞\n01296|       params.append('take[gidro]', form.needLoading ? '1' : '0'); // –≥–∏–¥—Ä–æ–ª–∏—Ñ—Ç\n01297|       params.append('take[manip]', '0'); // –º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä\n01298|       params.append('take[speed]', '0'); // —Å—Ä–æ—á–Ω—ã–π –∑–∞–±–æ—Ä\n01299|       params.append('take[moscow]', '0'); // –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –ú–æ—Å–∫–≤–µ\n01300|       \n01301|       // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ—Å—Ç–∞–≤–∫–∏\n01302|       params.append('deliver[town]', toCityId.toString());\n01303|       params.append('deliver[tent]', '0');\n01304|       params.append('deliver[gidro]', form.needLoading ? '1' : '0');\n01305|       params.append('deliver[manip]', '0');\n01306|       params.append('deliver[speed]', '0');\n01307|       params.append('deliver[moscow]', '0');\n01308|       \n01309|       // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏\n01310|       params.append('plombir', '0'); // –ø–ª–æ–º–±—ã\n01311|       params.append('strah', form.needInsurance ? form.declaredValue.toString() : '0'); // —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞\n01312|       params.append('ashan', '0'); // –¥–æ—Å—Ç–∞–≤–∫–∞ –≤ –ê—à–∞–Ω\n01313|       params.append('night', '0'); // –Ω–æ—á–Ω–æ–µ –≤—Ä–µ–º—è\n01314|       params.append('pal', '0'); // –∑–∞–ø–∞–ª–ª–µ—á–∏–≤–∞–Ω–∏–µ\n01315|       params.append('pallets', '0'); // –ø–∞–ª–ª–µ—Ç–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞\n01316| \n01317|       const fullUrl = `${apiUrl}?${params.toString()}`;\n01318|       const requestData = Object.fromEntries(params);\n01319| \n01320|       console.log('–ü–≠–ö –∑–∞–ø—Ä–æ—Å URL:', fullUrl);\n01321|       console.log('–ü–≠–ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:', requestData);\n01322| \n01323|       // –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ API (–±–µ–∑ –ø—Ä–æ–∫—Å–∏, —Ç–∞–∫ –∫–∞–∫ HTTPS —Å–∞–π—Ç –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å HTTP –∑–∞–ø—Ä–æ—Å—ã)\n01324|       const response = await fetch(fullUrl);\n01325|       const data = await response.json();\n01326|       \n01327|       console.log('–ü–≠–ö –æ—Ç–≤–µ—Ç:', data);\n01328| \n01329|       if (response.ok && data.success) {\n01330|         let totalPrice = 0;\n01331|         let services: { name: string; description: string; price: number }[] = [];\n01332|         \n01333|         // –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏\n01334|         if (data.data?.totalCost) {\n01335|           totalPrice = data.data.totalCost;\n01336|           \n01337|           // –†–∞–∑–±–∏–≤–∫–∞ –ø–æ —É—Å–ª—É–≥–∞–º –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞\n01338|           if (data.data.services) {\n01339|             data.data.services.forEach((service: any) => {\n01340|               services.push({\n01341|                 name: service.name || '–£—Å–ª—É–≥–∞ –ü–≠–ö',\n01342|                 description: service.description || '',\n01343|                 price: service.cost || 0\n01344|               });\n01345|             });\n01346|           } else {\n01347|             // –û—Å–Ω–æ–≤–Ω–∞—è —É—Å–ª—É–≥–∞\n01348|             services.push({\n01349|               name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n01350|               description: `${form.fromCity} - ${form.toCity}`,\n01351|               price: totalPrice\n01352|             });\n01353|           }\n01354|         }\n01355|         \n01356|         // –ó–∞–±–æ—Ä –≥—Ä—É–∑–∞\n01357|         if (data.data?.pickupCost && form.fromAddressDelivery) {\n01358|           services.push({\n01359|             name: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n01360|             description: '–û—Ç –∞–¥—Ä–µ—Å–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è',\n01361|             price: data.data.pickupCost\n01362|           });\n01363|         }\n01364|         \n01365|         // –î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –∞–¥—Ä–µ—Å–∞\n01366|         if (data.data?.deliveryCost && form.toAddressDelivery) {\n01367|           services.push({\n01368|             name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n01369|             description: '–î–æ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è',\n01370|             price: data.data.deliveryCost\n01371|           });\n01372|         }\n01373| \n01374|         // –°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏\n01375|         const deliveryDays = data.data?.deliveryDays || 3;\n01376| \n01377|         return {\n01378|           company: '–ü–≠–ö',\n01379|           price: Math.round(totalPrice),\n01380|           days: deliveryDays,\n01381|           details: {\n01382|             services,\n01383|             totalCost: data.data?.totalCost,\n01384|             pickupCost: data.data?.pickupCost,\n01385|             deliveryCost: data.data?.deliveryCost,\n01386|             deliveryDays: data.data?.deliveryDays,\n01387|             fromCityId,\n01388|             toCityId,\n01389|             rawData: data.data\n01390|           },\n01391|           requestData,\n01392|           responseData: data,\n01393|           apiUrl\n01394|         };\n01395|       } else {\n01396|         // –§–æ–ª–ª–±—ç–∫ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–∞–≥–ª—É—à–∫—É –µ—Å–ª–∏ API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç\n01397|         const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n01398|         let basePrice = totalWeight * 15; // 15 —Ä—É–± –∑–∞ –∫–≥ –±–∞–∑–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞\n01399|         \n01400|         if (form.fromAddressDelivery) basePrice += 500; // –∑–∞–±–æ—Ä\n01401|         if (form.toAddressDelivery) basePrice += 500; // –¥–æ—Å—Ç–∞–≤–∫–∞\n01402|         if (form.needInsurance) basePrice += form.declaredValue * 0.01; // —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞\n01403|         if (form.needPackaging) basePrice += totalWeight * 20; // —É–ø–∞–∫–æ–≤–∫–∞\n01404|         \n01405|         return {\n01406|           company: '–ü–≠–ö',\n01407|           price: Math.round(basePrice),\n01408|           days: 3,\n01409|           details: {\n01410|             note: '–†–∞—Å—á–µ—Ç –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º (API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)',\n01411|             fromCityId,\n01412|             toCityId,\n01413|             services: [\n01414|               { name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞', description: `${form.fromCity} - ${form.toCity}`, price: basePrice }\n01415|             ]\n01416|           },\n01417|           requestData,\n01418|           responseData: data,\n01419|           apiUrl,\n01420|           error: data.message || data.error || 'API –ü–≠–ö –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–∫–∞–∑–∞–Ω –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç'\n01421|         };\n01422|       }\n01423|     } catch (error: any) {\n01424|       // –§–æ–ª–ª–±—ç–∫ —Ä–∞—Å—á–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n01425|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n01426|       let basePrice = totalWeight * 15; // 15 —Ä—É–± –∑–∞ –∫–≥\n01427|       \n01428|       if (form.fromAddressDelivery) basePrice += 500;\n01429|       if (form.toAddressDelivery) basePrice += 500; \n01430|       if (form.needInsurance) basePrice += form.declaredValue * 0.01;\n01431|       if (form.needPackaging) basePrice += totalWeight * 20;\n01432|       \n01433|       return {\n01434|         company: '–ü–≠–ö',\n01435|         price: Math.round(basePrice),\n01436|         days: 3,\n01437|         details: {\n01438|           note: '–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º (–æ—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å API)',\n01439|           services: [\n01440|             { name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞', description: `${form.fromCity} - ${form.toCity}`, price: basePrice }\n01441|           ]\n01442|         },\n01443|         requestData: null,\n01444|         responseData: null,\n01445|         apiUrl,\n01446|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}. –ü–æ–∫–∞–∑–∞–Ω –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç.`\n01447|       };\n01448|     }\n01449|   };\n01450| \n01451|   const calculateRailContinent = async (): Promise<CalculationResult> => {\n01452|     await new Promise(resolve => setTimeout(resolve, 1200));\n01453|     const basePrice = form.cargos.reduce((sum, cargo) => sum + cargo.weight * 12, 0);\n01454|     let totalPrice = basePrice;\n01455|     \n01456|     if (form.needInsurance) totalPrice += form.declaredValue * 0.025;\n01457|     if (form.needPackaging) totalPrice += basePrice * 0.08;\n01458|     \n01459|     return {\n01460|       company: 'Rail Continent',\n01461|       price: totalPrice,\n01462|       days: 5,\n01463|       apiUrl: 'https://www.railcontinent.ru/services/prochie-gruzoperevozki/forshop/api-manual/',\n01464|       details: { note: '–ó–∞–≥–ª—É—à–∫–∞ - API –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω' }\n01465|     };\n01466|   };\n01467| \n01468|   const handleCalculate = async () => {\n01469|     setCalculating(true);\n01470|     setCalculations([]);\n01471|     \n01472|     // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø–æ—Å–ª–µ —Ä–∞—Å—á–µ—Ç–∞\n01473|     localStorage.setItem('deliveryForm', JSON.stringify(form));\n01474|     \n01475|     try {\n01476|       const results = await Promise.all([\n01477|         calculateDellin(),\n01478|         calculatePEK(),\n01479|         calculateNordWheel(),\n01480|         calculateRailContinent()\n01481|       ]);\n01482|       \n01483|       // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ü–µ–Ω–µ\n01484|       const sortedResults = results\n01485|         .filter(result => !result.error)\n01486|         .sort((a, b) => a.price - b.price)\n01487|         .concat(results.filter(result => result.error));\n01488|       \n01489|       setCalculations(sortedResults);\n01490|     } catch (error) {\n01491|       console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ:', error);\n01492|     } finally {\n01493|       setCalculating(false);\n01494|     }\n01495|   };\n01496| \n01497|   const exportToPDF = () => {\n01498|     if (typeof window !== 'undefined') {\n01499|       window.print();\n01500|     }\n01501|   };\n01502| \n01503|   const toggleDetails = (company: string) => {\n01504|     setExpandedDetails(prev => ({\n01505|       ...prev,\n01506|       [company]: !prev[company]\n01507|     }));\n01508|   };\n01509| \n01510|   const toggleDebugInfo = (company: string) => {\n01511|     setExpandedDebugInfo(prev => ({\n01512|       ...prev,\n01513|       [company]: !prev[company]\n01514|     }));\n01515|   };\n01516| \n01517|   // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞—Å—á–µ—Ç–∞\n01518|   const handleReset = () => {\n01519|     if (typeof window !== 'undefined') {\n01520|       // –û—á–∏—â–∞–µ–º localStorage\n01521|       localStorage.removeItem('deliveryForm');\n01522|       \n01523|       // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É\n01524|       setForm(initialFormState);\n01525|       \n01526|       // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è\n01527|       setCalculations([]);\n01528|       setExpandedDetails({});\n01529|       setExpandedDebugInfo({});\n01530|       setSuggestions([]);\n01531|       setShowSuggestions(false);\n01532|       setActiveField('');\n01533|       \n01534|       console.log('–§–æ—Ä–º–∞ —Å–±—Ä–æ—à–µ–Ω–∞ –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é');\n01535|     }\n01536|   };\n01537| \n01538|   // –ü–∞—Ä—Å–µ—Ä –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è —á–∏—Ç–∞–µ–º–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞\n01539|   const parseCalculationDetails = (calc: CalculationResult) => {\n01540|     const details: { service: string; description: string; price: number }[] = [];\n\n(File has more lines. Use 'offset' parameter to read beyond line 1540)\n</file>",
    "metadata": {
      "preview": "          'Authorization': `Bearer 624FC93CA677B23673BB476D4982294DC27E246F`\n        },\n        body: JSON.stringify(requestData)\n      });\n\n      const data = await response.json();\n      console.log('üöÄ –ü–≠–ö API –æ—Ç–≤–µ—Ç:', JSON.stringify(data, null, 2));\n\n      if (response.ok && !data.hasError && data.transfers && data.transfers.length > 0) {\n        const transfer = data.transfers[0]; // –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Ç–∞—Ä–∏—Ñ (–∞–≤—Ç–æ)\n        \n        if (!transfer.hasError) {\n          // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —É—Å–ª—É–≥\n          const services: { name: string; description: string; price: number }[] = [];\n          let totalCalculated = 0;\n\n          const processServices = (servicesList: any[], parentName = '') => {\n            servicesList.forEach(service => {\n              const serviceName = parentName ? `${parentName} - ${service.info}` : service.info;\n              const serviceCost = parseFloat(service.cost) || 0;"
    },
    "title": "app/page.tsx",
    "time": {
      "start": 1758903298252,
      "end": 1758903298254
    }
  }
}