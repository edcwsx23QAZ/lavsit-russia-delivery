{
  "id": "prt_986cb5174001fxUakxXsIvhs7x",
  "messageID": "msg_986cb16f6001hgYHgWxj5ABVEt",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "multiedit",
  "callID": "toolu_012h52oTBDvwpBJB1Ju5sUfU",
  "state": {
    "status": "error",
    "input": {
      "filePath": "/home/user/project/app/page.tsx",
      "edits": [
        {
          "oldString": "  // –ü–æ–ª—É—á–µ–Ω–∏–µ ID —Å–∫–ª–∞–¥–∞ –ü–≠–ö –ø–æ –≥–æ—Ä–æ–¥—É\n  const getPekWarehouseId = (cityName: string): string | null => {\n    const normalizedCity = cityName.toLowerCase()\n      .replace(/—ë/g, '–µ')\n      .replace(/[\\s\\-\\.–≥\\.]+/g, '')\n      .replace(/–æ–±–ª–∞—Å—Ç—å|–æ–±–ª|–∫—Ä–∞–π|—Ä–µ—Å–ø—É–±–ª–∏–∫–∞|—Ä–µ—Å–ø|–∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥|–∞–æ/g, '');\n    \n    console.log(`üè¢ –ü–æ–∏—Å–∫ —Å–∫–ª–∞–¥–∞ –ü–≠–ö –¥–ª—è –≥–æ—Ä–æ–¥–∞: \"${cityName}\" -> \"${normalizedCity}\"`);\n    \n    const warehouseId = PEK_WAREHOUSES[normalizedCity];\n    if (warehouseId) {\n      console.log(`‚úÖ –ù–∞–π–¥–µ–Ω —Å–∫–ª–∞–¥ –ü–≠–ö: ${warehouseId}`);\n      return warehouseId;\n    }\n    \n    console.log(`‚ùå –°–∫–ª–∞–¥ –ü–≠–ö –¥–ª—è –≥–æ—Ä–æ–¥–∞ \"${cityName}\" –Ω–µ –Ω–∞–π–¥–µ–Ω`);\n    return null;\n  };",
          "newString": "  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–Ω–æ–π –∑–æ–Ω—ã –∏ —Å–∫–ª–∞–¥–∞ –ü–≠–ö –ø–æ –∞–¥—Ä–µ—Å—É —á–µ—Ä–µ–∑ API\n  const getPekZoneByAddress = async (address: string) => {\n    try {\n      console.log(`üîç –ü–≠–ö: –ø–æ–∏—Å–∫ –∑–æ–Ω—ã –ø–æ –∞–¥—Ä–µ—Å—É \"${address}\"`);\n      \n      const response = await fetch('https://api.pecom.ru/v1/branches/findzonebyaddress/', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer 624FC93CA677B23673BB476D4982294DC27E246F`\n        },\n        body: JSON.stringify({\n          address: address\n        })\n      });\n\n      if (!response.ok) {\n        console.error(`‚ùå –ü–≠–ö API –æ—à–∏–±–∫–∞: ${response.status} ${response.statusText}`);\n        return null;\n      }\n\n      const data = await response.json();\n      console.log(`‚úÖ –ü–≠–ö –∑–æ–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞:`, data);\n      \n      if (data.zoneId && data.mainWarehouseId) {\n        return {\n          zoneId: data.zoneId,\n          zoneName: data.zoneName,\n          branchUID: data.branchUID,\n          branchCode: data.branchCode,\n          branchTitle: data.branchTitle,\n          mainWarehouseId: data.mainWarehouseId,\n          warehousePoint: data.warehousePoint,\n          geoData: data.GeoData,\n          precision: data.GeoData?.precision\n        };\n      }\n      \n      console.warn(`‚ùå –ü–≠–ö: –∑–æ–Ω–∞ –Ω–µ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è –¥–ª—è –∞–¥—Ä–µ—Å–∞ \"${address}\"`);\n      return null;\n    } catch (error) {\n      console.error('‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∑–æ–Ω—ã:', error);\n      return null;\n    }\n  };\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –ü–≠–ö\n  const getPekNearestDepartments = async (address: string, coordinates?: { latitude: string, longitude: string }) => {\n    try {\n      console.log(`üè¢ –ü–≠–ö: –ø–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–∏—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π –¥–ª—è \"${address}\"`);\n      \n      const requestBody: any = {\n        departmentOperation: 3, // –≤—ã–¥–∞—á–∞ –≥—Ä—É–∑–æ–≤\n        type: 3, // –∞–≤—Ç–æ-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç\n        searchRadius: 50, // –∫–º\n        limit: 5\n      };\n      \n      if (coordinates) {\n        requestBody.coordinates = coordinates;\n      } else {\n        requestBody.address = address;\n      }\n      \n      const response = await fetch('https://api.pecom.ru/v1/branches/nearestdepartments/', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer 624FC93CA677B23673BB476D4982294DC27E246F`\n        },\n        body: JSON.stringify(requestBody)\n      });\n\n      if (!response.ok) {\n        console.error(`‚ùå –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è API –æ—à–∏–±–∫–∞: ${response.status} ${response.statusText}`);\n        return null;\n      }\n\n      const data = await response.json();\n      console.log(`‚úÖ –ü–≠–ö –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–∞–π–¥–µ–Ω—ã:`, data);\n      \n      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤–æ–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ —Å –Ω–∞–∏–≤—ã—Å—à–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º\n      if (data.freeDepartments && data.freeDepartments.length > 0) {\n        const bestDepartment = data.freeDepartments.sort((a: any, b: any) => b.priority - a.priority)[0];\n        return {\n          warehouseId: bestDepartment.warehouseId,\n          branchId: bestDepartment.branchId,\n          branchName: bestDepartment.branchName,\n          divisionName: bestDepartment.divisionName,\n          address: bestDepartment.address,\n          coordinates: bestDepartment.coordinates,\n          phone: bestDepartment.phone,\n          email: bestDepartment.email\n        };\n      }\n      \n      console.warn(`‚ùå –ü–≠–ö: –æ—Ç–¥–µ–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è \"${address}\"`);\n      return null;\n    } catch (error) {\n      console.error('‚ùå –ü–≠–ö: –æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –æ—Ç–¥–µ–ª–µ–Ω–∏–π:', error);\n      return null;\n    }\n  };"
        },
        {
          "oldString": "  // –†–∞—Å—á–µ—Ç –¥–ª—è –ü–≠–ö —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API\n  const calculatePEK = async (): Promise<CalculationResult> => {\n    const apiUrl = 'https://kabinet.pecom.ru/api/v1/calculateprice/';\n    \n    try {\n      // –ü–æ–ª—É—á–∞–µ–º ID —Å–∫–ª–∞–¥–æ–≤ –ø–æ –≥–æ—Ä–æ–¥–∞–º\n      const senderWarehouseId = getPekWarehouseId(form.fromCity);\n      const receiverWarehouseId = getPekWarehouseId(form.toCity);\n      \n      if (!senderWarehouseId || !receiverWarehouseId) {\n        return {\n          company: '–ü–≠–ö',\n          price: 0,\n          days: 0,\n          error: `–°–∫–ª–∞–¥ –ü–≠–ö –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–æ—Ä–æ–¥–∞: ${!senderWarehouseId ? form.fromCity : ''} ${!receiverWarehouseId ? form.toCity : ''}`.trim(),\n          apiUrl,\n          requestData: { fromCity: form.fromCity, toCity: form.toCity },\n          responseData: null\n        };\n      }\n\n      // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞—Ç—É –∑–∞–≤—Ç—Ä–∞ –¥–ª—è –∑–∞–±–æ—Ä–∞\n      const tomorrow = new Date();\n      tomorrow.setDate(tomorrow.getDate() + 1);\n      const plannedDateTime = tomorrow.toISOString().slice(0, 19); // 2023-02-28T14:00:00\n\n      // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤\n      const cargos = form.cargos.map(cargo => ({\n        length: cargo.length / 100, // –ø–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–µ—Ç—Ä—ã\n        width: cargo.width / 100,\n        height: cargo.height / 100,\n        volume: (cargo.length * cargo.width * cargo.height) / 1000000, // –º3\n        weight: cargo.weight,\n        isHP: form.needPackaging, // –∑–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n        sealingPositionsCount: 0\n      }));\n\n      // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –∫ API –ü–≠–ö\n      const requestData = {\n        currencyCode: \"643\", // —Ä—É–±–ª–∏\n        types: [3], // —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ –ø–µ—Ä–µ–≤–æ–∑–∫–∞\n        senderWarehouseId,\n        receiverWarehouseId,\n        isOpenCarSender: false,\n        isOpenCarReceiver: false,\n        isHyperMarket: false,\n        plannedDateTime,\n        isInsurance: form.needInsurance && form.declaredValue > 0,\n        isInsurancePrice: form.needInsurance ? form.declaredValue : 0,\n        isPickUp: form.fromAddressDelivery,\n        isDelivery: form.toAddressDelivery,\n        needReturnDocuments: false,\n        needArrangeTransportationDocuments: false,\n        senderDistanceType: 0,\n        receiverDistanceType: 0,\n        cargos\n      };\n\n      // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏ –ü–†–† –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\n      if (form.needCarry) {\n        requestData.pickupServices = {\n          isLoading: true,\n          floor: 0,\n          carryingDistance: 0,\n          isElevator: false\n        };\n        requestData.deliveryServices = {\n          isLoading: true,\n          floor: 0,\n          carryingDistance: 0,\n          isElevator: false\n        };\n      }\n\n      // –î–æ–±–∞–≤–ª—è–µ–º –∞–¥—Ä–µ—Å–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞\n      if (form.fromAddressDelivery) {\n        requestData.pickup = {\n          address: form.fromAddress || `–†–æ—Å—Å–∏—è, ${form.fromCity}`\n        };\n      }\n      \n      if (form.toAddressDelivery) {\n        requestData.delivery = {\n          address: form.toAddress || `–†–æ—Å—Å–∏—è, ${form.toCity}`\n        };\n      }\n\n      console.log('üöÄ –ü–≠–ö API –∑–∞–ø—Ä–æ—Å:', requestData);\n\n      const response = await fetch(apiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json;charset=utf-8',\n          'Accept': 'application/json',\n          'Authorization': `Bearer 624FC93CA677B23673BB476D4982294DC27E246F`\n        },\n        body: JSON.stringify(requestData)\n      });\n\n      const data = await response.json();\n      console.log('üöÄ –ü–≠–ö API –æ—Ç–≤–µ—Ç:', data);\n\n      if (response.ok && !data.hasError && data.transfers && data.transfers.length > 0) {\n        const transfer = data.transfers[0]; // –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Ç–∞—Ä–∏—Ñ (–∞–≤—Ç–æ)\n        \n        if (!transfer.hasError) {\n          // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —É—Å–ª—É–≥\n          const services = [];\n          let totalCalculated = 0;\n\n          const processServices = (servicesList: any[], parentName = '') => {\n            servicesList.forEach(service => {\n              const serviceName = parentName ? `${parentName} - ${service.info}` : service.info;\n              const serviceCost = parseFloat(service.cost) || 0;\n              \n              if (serviceCost > 0) {\n                services.push({\n                  name: serviceName,\n                  description: service.serviceType,\n                  price: serviceCost\n                });\n                totalCalculated += serviceCost;\n              }\n\n              // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏\n              if (service.services && Array.isArray(service.services)) {\n                processServices(service.services, serviceName);\n              }\n            });\n          };\n\n          if (transfer.services) {\n            processServices(transfer.services);\n          }\n\n          return {\n            company: '–ü–≠–ö',\n            price: Math.round(transfer.costTotal),\n            days: transfer.estDeliveryTime || 3,\n            details: {\n              note: `–î–æ—Å—Ç–∞–≤–∫–∞ ${form.fromCity} - ${form.toCity} (—Ç–∞—Ä–∏—Ñ ${transfer.type})`,\n              services: services.length > 0 ? services : [\n                {\n                  name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n                  description: `${form.fromCity} - ${form.toCity}`,\n                  price: Math.round(transfer.costTotal)\n                }\n              ]\n            },\n            requestData,\n            responseData: data,\n            apiUrl\n          };\n        } else {\n          throw new Error(transfer.errorMessage || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞ –ü–≠–ö');\n        }\n      } else {\n        throw new Error(data.errorMessage || '–û—à–∏–±–∫–∞ API –ü–≠–ö');\n      }\n      \n    } catch (error: any) {\n      console.error('üö® –û—à–∏–±–∫–∞ –ü–≠–ö API:', error);\n      \n      // –§–æ–ª–ª–±—ç–∫ —Ä–∞—Å—á–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ\n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n      let basePrice = totalWeight * 18; // 18 —Ä—É–± –∑–∞ –∫–≥ –¥–ª—è –ü–≠–ö\n      \n      if (form.fromAddressDelivery) basePrice += 600;\n      if (form.toAddressDelivery) basePrice += 600;\n      if (form.needInsurance && form.declaredValue > 0) basePrice += form.declaredValue * 0.012;\n      if (form.needPackaging) basePrice += totalWeight * 25;\n      if (form.needCarry) basePrice += 500;\n      \n      return {\n        company: '–ü–≠–ö',\n        price: Math.round(basePrice),\n        days: 3,\n        details: {\n          note: '–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º –ü–≠–ö (–æ—à–∏–±–∫–∞ API)',\n          services: [\n            {\n              name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n              description: `${form.fromCity} - ${form.toCity}`,\n              price: Math.round(basePrice)\n            }\n          ]\n        },\n        requestData: null,\n        responseData: null,\n        apiUrl,\n        error: `–û—à–∏–±–∫–∞ API –ü–≠–ö: ${error.message}. –ü–æ–∫–∞–∑–∞–Ω –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç.`\n      };\n    }\n  };",
          "newString": "  // –†–∞—Å—á–µ—Ç –¥–ª—è –ü–≠–ö —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API v1/calculateprice/\n  const calculatePEK = async (): Promise<CalculationResult> => {\n    const apiUrl = 'https://kabinet.pecom.ru/api/v1/calculateprice/';\n    \n    try {\n      // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–æ–Ω–∞—Ö –∏ —Å–∫–ª–∞–¥–∞—Ö –ø–æ –∞–¥—Ä–µ—Å–∞–º\n      const senderZone = await getPekZoneByAddress(form.fromAddress || `–†–æ—Å—Å–∏—è, ${form.fromCity}`);\n      const receiverZone = await getPekZoneByAddress(form.toAddress || `–†–æ—Å—Å–∏—è, ${form.toCity}`);\n      \n      if (!senderZone || !receiverZone) {\n        return {\n          company: '–ü–≠–ö',\n          price: 0,\n          days: 0,\n          error: `–ó–æ–Ω–∞ –ü–≠–ö –Ω–µ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥—Ä–µ—Å–∞: ${!senderZone ? (form.fromAddress || form.fromCity) : ''} ${!receiverZone ? (form.toAddress || form.toCity) : ''}`.trim(),\n          apiUrl,\n          requestData: { fromAddress: form.fromAddress || form.fromCity, toAddress: form.toAddress || form.toCity },\n          responseData: null\n        };\n      }\n\n      // –ü–æ–ª—É—á–∞–µ–º –±–ª–∏–∂–∞–π—à–∏–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –∞–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞\n      let senderWarehouseId = senderZone.mainWarehouseId;\n      let receiverWarehouseId = receiverZone.mainWarehouseId;\n      \n      if (form.fromAddressDelivery && senderZone.warehousePoint) {\n        const senderDepartment = await getPekNearestDepartments(\n          form.fromAddress || form.fromCity,\n          {\n            latitude: senderZone.warehousePoint.latitude.toString(),\n            longitude: senderZone.warehousePoint.longitude.toString()\n          }\n        );\n        if (senderDepartment) {\n          senderWarehouseId = senderDepartment.warehouseId;\n        }\n      }\n      \n      if (form.toAddressDelivery && receiverZone.warehousePoint) {\n        const receiverDepartment = await getPekNearestDepartments(\n          form.toAddress || form.toCity,\n          {\n            latitude: receiverZone.warehousePoint.latitude.toString(),\n            longitude: receiverZone.warehousePoint.longitude.toString()\n          }\n        );\n        if (receiverDepartment) {\n          receiverWarehouseId = receiverDepartment.warehouseId;\n        }\n      }\n\n      // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞—Ç—É –∑–∞–≤—Ç—Ä–∞ –¥–ª—è –∑–∞–±–æ—Ä–∞\n      const tomorrow = new Date();\n      tomorrow.setDate(tomorrow.getDate() + 1);\n      const plannedDateTime = tomorrow.toISOString().slice(0, 19); // 2025-09-28T14:00:00\n\n      // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤\n      const cargos = form.cargos.map(cargo => ({\n        length: cargo.length / 100, // –ø–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–µ—Ç—Ä—ã\n        width: cargo.width / 100,\n        height: cargo.height / 100,\n        volume: (cargo.length * cargo.width * cargo.height) / 1000000, // –º3\n        weight: cargo.weight,\n        isHP: form.needPackaging, // –∑–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n        sealingPositionsCount: 0\n      }));\n\n      // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –∫ API –ü–≠–ö\n      const requestData: any = {\n        currencyCode: \"643\", // —Ä—É–±–ª–∏\n        types: [3], // —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ –ø–µ—Ä–µ–≤–æ–∑–∫–∞\n        senderWarehouseId,\n        receiverWarehouseId,\n        isOpenCarSender: false,\n        isOpenCarReceiver: false,\n        isHyperMarket: false,\n        plannedDateTime,\n        isInsurance: form.needInsurance && form.declaredValue > 0,\n        isInsurancePrice: form.needInsurance ? form.declaredValue : 0,\n        isPickUp: form.fromAddressDelivery,\n        isDelivery: form.toAddressDelivery,\n        needReturnDocuments: false,\n        needArrangeTransportationDocuments: false,\n        senderDistanceType: 0,\n        receiverDistanceType: 0,\n        cargos\n      };\n\n      // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏ –ü–†–† –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\n      if (form.needCarry) {\n        requestData.pickupServices = {\n          isLoading: true,\n          floor: Math.max(0, form.floor - 1), // –ü–≠–ö —Å—á–∏—Ç–∞–µ—Ç —Å 0\n          carryingDistance: 0,\n          isElevator: form.hasFreightLift\n        };\n        requestData.deliveryServices = {\n          isLoading: true,\n          floor: Math.max(0, form.floor - 1),\n          carryingDistance: 0,\n          isElevator: form.hasFreightLift\n        };\n      }\n\n      // –î–æ–±–∞–≤–ª—è–µ–º –∞–¥—Ä–µ—Å–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞\n      if (form.fromAddressDelivery) {\n        requestData.pickup = {\n          address: form.fromAddress || `–†–æ—Å—Å–∏—è, ${form.fromCity}`,\n          coordinates: senderZone.warehousePoint\n        };\n      }\n      \n      if (form.toAddressDelivery) {\n        requestData.delivery = {\n          address: form.toAddress || `–†–æ—Å—Å–∏—è, ${form.toCity}`,\n          coordinates: receiverZone.warehousePoint\n        };\n      }\n\n      console.log('üöÄ –ü–≠–ö API –∑–∞–ø—Ä–æ—Å:', JSON.stringify(requestData, null, 2));\n\n      const response = await fetch(apiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json;charset=utf-8',\n          'Accept': 'application/json',\n          'Authorization': `Bearer 624FC93CA677B23673BB476D4982294DC27E246F`\n        },\n        body: JSON.stringify(requestData)\n      });\n\n      const data = await response.json();\n      console.log('üöÄ –ü–≠–ö API –æ—Ç–≤–µ—Ç:', JSON.stringify(data, null, 2));\n\n      if (response.ok && !data.hasError && data.transfers && data.transfers.length > 0) {\n        const transfer = data.transfers[0]; // –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Ç–∞—Ä–∏—Ñ (–∞–≤—Ç–æ)\n        \n        if (!transfer.hasError) {\n          // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —É—Å–ª—É–≥\n          const services: { name: string; description: string; price: number }[] = [];\n          let totalCalculated = 0;\n\n          const processServices = (servicesList: any[], parentName = '') => {\n            servicesList.forEach(service => {\n              const serviceName = parentName ? `${parentName} - ${service.info}` : service.info;\n              const serviceCost = parseFloat(service.cost) || 0;\n              \n              if (serviceCost > 0) {\n                services.push({\n                  name: serviceName,\n                  description: service.serviceType || '',\n                  price: serviceCost\n                });\n                totalCalculated += serviceCost;\n              }\n\n              // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏\n              if (service.services && Array.isArray(service.services)) {\n                processServices(service.services, serviceName);\n              }\n            });\n          };\n\n          if (transfer.services) {\n            processServices(transfer.services);\n          }\n\n          // –ï—Å–ª–∏ –Ω–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —É—Å–ª—É–≥, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n          if (services.length === 0) {\n            services.push({\n              name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n              description: `${senderZone.branchTitle} - ${receiverZone.branchTitle}`,\n              price: Math.round(transfer.costTotal)\n            });\n          }\n\n          return {\n            company: '–ü–≠–ö',\n            price: Math.round(transfer.costTotal),\n            days: transfer.estDeliveryTime || 3,\n            details: {\n              note: `–î–æ—Å—Ç–∞–≤–∫–∞ ${senderZone.branchTitle} - ${receiverZone.branchTitle} (–∞–≤—Ç–æ)`,\n              services,\n              senderZone: {\n                title: senderZone.branchTitle,\n                zone: senderZone.zoneName,\n                warehouseId: senderWarehouseId\n              },\n              receiverZone: {\n                title: receiverZone.branchTitle,\n                zone: receiverZone.zoneName,\n                warehouseId: receiverWarehouseId\n              }\n            },\n            requestData,\n            responseData: data,\n            apiUrl\n          };\n        } else {\n          throw new Error(transfer.errorMessage || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞ –ü–≠–ö');\n        }\n      } else {\n        throw new Error(data.errorMessage || data.message || '–û—à–∏–±–∫–∞ API –ü–≠–ö');\n      }\n      \n    } catch (error: any) {\n      console.error('üö® –û—à–∏–±–∫–∞ –ü–≠–ö API:', error);\n      \n      // –§–æ–ª–ª–±—ç–∫ —Ä–∞—Å—á–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ\n      const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n      let basePrice = totalWeight * 18; // 18 —Ä—É–± –∑–∞ –∫–≥ –¥–ª—è –ü–≠–ö\n      \n      if (form.fromAddressDelivery) basePrice += 600;\n      if (form.toAddressDelivery) basePrice += 600;\n      if (form.needInsurance && form.declaredValue > 0) basePrice += form.declaredValue * 0.012;\n      if (form.needPackaging) basePrice += totalWeight * 25;\n      if (form.needCarry) basePrice += 500;\n      \n      return {\n        company: '–ü–≠–ö',\n        price: Math.round(basePrice),\n        days: 3,\n        details: {\n          note: '–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º –ü–≠–ö (–æ—à–∏–±–∫–∞ API)',\n          services: [\n            {\n              name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n              description: `${form.fromCity} - ${form.toCity}`,\n              price: Math.round(basePrice)\n            }\n          ]\n        },\n        requestData: null,\n        responseData: null,\n        apiUrl,\n        error: `–û—à–∏–±–∫–∞ API –ü–≠–ö: ${error.message}. –ü–æ–∫–∞–∑–∞–Ω –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç.`\n      };\n    }\n  };"
        }
      ]
    },
    "error": "Error: oldString not found in content",
    "time": {
      "start": 1758903175445,
      "end": 1758903175527
    }
  }
}