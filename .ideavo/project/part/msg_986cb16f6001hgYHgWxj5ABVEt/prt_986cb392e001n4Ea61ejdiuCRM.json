{
  "id": "prt_986cb392e001n4Ea61ejdiuCRM",
  "messageID": "msg_986cb16f6001hgYHgWxj5ABVEt",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "read",
  "callID": "toolu_011kTh7j1VjwHQycpUKkSphZ",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/page.tsx"
    },
    "output": "<file>\n00001| 'use client';\n00002| \n00003| import React, { useState, useEffect, useCallback } from 'react';\n00004| import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\n00005| import { Button } from '@/components/ui/button';\n00006| import { Input } from '@/components/ui/input';\n00007| import { Label } from '@/components/ui/label';\n00008| import { Checkbox } from '@/components/ui/checkbox';\n00009| import { Plus, Truck, Building2, Map } from 'lucide-react';\n00010| import { Alert, AlertDescription } from '@/components/ui/alert';\n00011| import { Badge } from '@/components/ui/badge';\n00012| import { Separator } from '@/components/ui/separator';\n00013| import { Collapsible, CollapsibleContent } from '@/components/ui/collapsible';\n00014| \n00015| interface Cargo {\n00016|   id: string;\n00017|   length: number;\n00018|   width: number;\n00019|   height: number;\n00020|   weight: number;\n00021| }\n00022| \n00023| interface DeliveryForm {\n00024|   cargos: Cargo[];\n00025|   fromCity: string;\n00026|   toCity: string;\n00027|   fromAddress: string;\n00028|   toAddress: string;\n00029|   declaredValue: number;\n00030|   needPackaging: boolean;\n00031|   needLoading: boolean;\n00032|   needCarry: boolean;\n00033|   floor: number;\n00034|   hasFreightLift: boolean;\n00035|   needInsurance: boolean;\n00036|   fromTerminal: boolean;\n00037|   toTerminal: boolean;\n00038|   fromAddressDelivery: boolean;\n00039|   toAddressDelivery: boolean;\n00040| }\n00041| \n00042| interface CalculationResult {\n00043|   company: string;\n00044|   price: number;\n00045|   days: number;\n00046|   details?: any;\n00047|   error?: string;\n00048|   requestData?: any;\n00049|   responseData?: any;\n00050|   apiUrl?: string;\n00051|   sessionId?: string;\n00052| }\n00053| \n00054| interface AddressSuggestion {\n00055|   value: string;\n00056|   unrestricted_value: string;\n00057|   data: {\n00058|     city?: string;\n00059|     street?: string;\n00060|     house?: string;\n00061|   };\n00062| }\n00063| \n00064| const COMPANIES = [\n00065|   { name: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏', logo: 'üì¶', connected: true },\n00066|   { name: '–ü–≠–ö', logo: 'üöõ', connected: true },\n00067|   { name: 'Nord Wheel', logo: 'üåê', connected: true },\n00068|   { name: 'Rail Continent', logo: 'üöÇ', connected: true }\n00069| ];\n00070| \n00071| export default function Home() {\n00072|   // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n00073|   const initialFormState: DeliveryForm = {\n00074|     cargos: [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00075|     fromCity: '',\n00076|     toCity: '',\n00077|     fromAddress: '',\n00078|     toAddress: '',\n00079|     declaredValue: 0,\n00080|     needPackaging: false,\n00081|     needLoading: false,\n00082|     needCarry: false,\n00083|     floor: 1,\n00084|     hasFreightLift: false,\n00085|     needInsurance: false,\n00086|     fromTerminal: true,\n00087|     toTerminal: true,\n00088|     fromAddressDelivery: false,\n00089|     toAddressDelivery: false\n00090|   };\n00091| \n00092|   const [form, setForm] = useState<DeliveryForm>(initialFormState);\n00093|   const [isLoaded, setIsLoaded] = useState(false);\n00094| \n00095|   const [suggestions, setSuggestions] = useState<AddressSuggestion[]>([]);\n00096|   const [showSuggestions, setShowSuggestions] = useState(false);\n00097|   const [activeField, setActiveField] = useState('');\n00098|   const [calculations, setCalculations] = useState<CalculationResult[]>([]);\n00099|   const [calculating, setCalculating] = useState(false);\n00100|   const [expandedDetails, setExpandedDetails] = useState<{ [key: string]: boolean }>({});\n00101|   const [expandedDebugInfo, setExpandedDebugInfo] = useState<{ [key: string]: boolean }>({});\n00102|   const [suggestionPosition, setSuggestionPosition] = useState({ top: 0, left: 0 });\n00103| \n00104|   // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)\n00105|   useEffect(() => {\n00106|     // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ\n00107|     if (typeof window !== 'undefined' && !isLoaded) {\n00108|       try {\n00109|         const saved = localStorage.getItem('deliveryForm');\n00110|         if (saved) {\n00111|           const savedForm = JSON.parse(saved);\n00112|           // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≥—Ä—É–∑\n00113|           if (!savedForm.cargos || savedForm.cargos.length === 0) {\n00114|             savedForm.cargos = [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }];\n00115|           }\n00116|           setForm(savedForm);\n00117|           console.log('–ó–∞–≥—Ä—É–∂–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã:', savedForm);\n00118|         }\n00119|       } catch (error) {\n00120|         console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);\n00121|         // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ\n00122|       } finally {\n00123|         setIsLoaded(true);\n00124|       }\n00125|     }\n00126|   }, [isLoaded]);\n00127| \n00128|   // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ (—Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)\n00129|   useEffect(() => {\n00130|     if (typeof window !== 'undefined' && isLoaded) {\n00131|       try {\n00132|         localStorage.setItem('deliveryForm', JSON.stringify(form));\n00133|         console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –≤ localStorage');\n00134|       } catch (error) {\n00135|         console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);\n00136|       }\n00137|     }\n00138|   }, [form, isLoaded]);\n00139| \n00140|   // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –ø—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n00141|   useEffect(() => {\n00142|     if (form.declaredValue > 0) {\n00143|       setForm(prev => ({ ...prev, needInsurance: true }));\n00144|     }\n00145|   }, [form.declaredValue]);\n00146| \n00147|   const searchAddresses = useCallback(async (query: string, field: string, element?: HTMLInputElement) => {\n00148|     if (query.length < 3) {\n00149|       setSuggestions([]);\n00150|       setShowSuggestions(false);\n00151|       return;\n00152|     }\n00153| \n00154|     setActiveField(field);\n00155|     \n00156|     // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ –∞–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–æ–∫\n00157|     if (element) {\n00158|       const rect = element.getBoundingClientRect();\n00159|       setSuggestionPosition({\n00160|         top: rect.bottom + window.scrollY,\n00161|         left: rect.left + window.scrollX\n00162|       });\n00163|     }\n00164|     \n00165|     try {\n00166|       const response = await fetch('https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address', {\n00167|         method: 'POST',\n00168|         headers: {\n00169|           'Content-Type': 'application/json',\n00170|           'Accept': 'application/json',\n00171|           'Authorization': 'Token eb87bbb3789bb43ed465f796892ea951f9e91008'\n00172|         },\n00173|         body: JSON.stringify({\n00174|           query: query,\n00175|           count: 10,\n00176|           // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª–µ–π –≥–æ—Ä–æ–¥–æ–≤ - —Ç–æ–ª—å–∫–æ –≥–æ—Ä–æ–¥–∞\n00177|           ...(field === 'fromCity' || field === 'toCity' ? {\n00178|             restrict_value: true,\n00179|             locations: [{\n00180|               country: '–†–æ—Å—Å–∏—è'\n00181|             }],\n00182|             from_bound: { value: 'city' },\n00183|             to_bound: { value: 'city' }\n00184|           } : {})\n00185|         })\n00186|       });\n00187| \n00188|       if (response.ok) {\n00189|         const data = await response.json();\n00190|         setSuggestions(data.suggestions || []);\n00191|         setShowSuggestions(true);\n00192|       }\n00193|     } catch (error) {\n00194|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫:', error);\n00195|     }\n00196|   }, []);\n00197| \n00198|   const debounceTimer = React.useRef<NodeJS.Timeout>();\n00199|   const handleAddressChange = (field: string, value: string, element?: HTMLInputElement) => {\n00200|     setForm(prev => ({ ...prev, [field]: value }));\n00201|     \n00202|     clearTimeout(debounceTimer.current);\n00203|     debounceTimer.current = setTimeout(() => {\n00204|       searchAddresses(value, field, element);\n00205|     }, 50);\n00206|   };\n00207| \n00208|   const selectSuggestion = (suggestion: AddressSuggestion) => {\n00209|     setForm(prev => ({ ...prev, [activeField]: suggestion.value }));\n00210|     setShowSuggestions(false);\n00211|     setSuggestions([]);\n00212|   };\n00213| \n00214|   const addCargo = () => {\n00215|     const newId = (form.cargos.length + 1).toString();\n00216|     setForm(prev => ({\n00217|       ...prev,\n00218|       cargos: [...prev.cargos, { id: newId, length: 0, width: 0, height: 0, weight: 0 }]\n00219|     }));\n00220|   };\n00221| \n00222|   const updateCargo = (id: string, field: string, value: number) => {\n00223|     setForm(prev => ({\n00224|       ...prev,\n00225|       cargos: prev.cargos.map(cargo => \n00226|         cargo.id === id ? { ...cargo, [field]: value } : cargo\n00227|       )\n00228|     }));\n00229|   };\n00230| \n00231|   const removeCargo = (id: string) => {\n00232|     if (form.cargos.length > 1) {\n00233|       setForm(prev => ({\n00234|         ...prev,\n00235|         cargos: prev.cargos.filter(cargo => cargo.id !== id)\n00236|       }));\n00237|     }\n00238|   };\n00239| \n00240|   // –ü–æ–ª—É—á–µ–Ω–∏–µ sessionID –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n00241|   const getDellinSessionId = async (): Promise<string | null> => {\n00242|     try {\n00243|       const authResponse = await fetch('https://api.dellin.ru/v3/auth/login.json', {\n00244|         method: 'POST',\n00245|         headers: {\n00246|           'Content-Type': 'application/json'\n00247|         },\n00248|         body: JSON.stringify({\n00249|           appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n00250|           login: 'service@lavsit.ru',\n00251|           password: 'edcwsx123QAZ'\n00252|         })\n00253|       });\n00254| \n00255|       const authData = await authResponse.json();\n00256|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ response.ok:', authResponse.ok);\n00257|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData:', authData);\n00258|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData.data:', authData.data);\n00259|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData.data?.sessionID:', authData.data?.sessionID);\n00260|       \n00261|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ –∫ sessionID\n00262|       let sessionID = null;\n00263|       \n00264|       if (authData.data?.sessionID) {\n00265|         sessionID = authData.data.sessionID;\n00266|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ data.sessionID:', sessionID);\n00267|       } else if (authData.sessionID) {\n00268|         sessionID = authData.sessionID;\n00269|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ sessionID:', sessionID);\n00270|       } else if (authData.data?.session) {\n00271|         sessionID = authData.data.session;\n00272|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ data.session:', sessionID);\n00273|       }\n00274|       \n00275|       if (authResponse.ok && sessionID) {\n00276|         return sessionID;\n00277|       } else {\n00278|         console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', authData);\n00279|         console.error('‚ùå –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', authResponse.status);\n00280|         console.error('‚ùå –¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞:', authResponse.statusText);\n00281|         return null;\n00282|       }\n00283|     } catch (error) {\n00284|       console.error('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', error);\n00285|     }\n00286|     return null;\n00287|   };\n00288| \n00289|   // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ –¥–ª—è –≥–æ—Ä–æ–¥–∞\n00290|   const getDellinTerminal = async (citySearch: string): Promise<string | null> => {\n00291|     try {\n00292|       const response = await fetch('https://api.dellin.ru/v3/public/terminals.json', {\n00293|         method: 'POST',\n00294|         headers: {\n00295|           'Content-Type': 'application/json'\n00296|         },\n00297|         body: JSON.stringify({\n00298|           appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B'\n00299|         })\n00300|       });\n00301| \n00302|       const data = await response.json();\n00303|       console.log('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã:', data);\n00304|       \n00305|       if (response.ok && data.terminals) {\n00306|         // –ò—â–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –≥–æ—Ä–æ–¥–µ\n00307|         const normalizedCity = citySearch.toLowerCase().trim();\n00308|         const terminal = data.terminals.find((t: any) => \n00309|           t.city?.toLowerCase().includes(normalizedCity) ||\n00310|           normalizedCity.includes(t.city?.toLowerCase())\n00311|         );\n00312|         \n00313|         return terminal?.id || data.terminals[0]?.id || null;\n00314|       }\n00315|       \n00316|       return null;\n00317|     } catch (error) {\n00318|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', error);\n00319|       return null;\n00320|     }\n00321|   };\n00322| \n00323|   // –ü–æ–ª—É—á–µ–Ω–∏–µ UID —É–ø–∞–∫–æ–≤–∫–∏ \"crate_with_bubble\" –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ —É–ø–∞–∫–æ–≤–æ–∫ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏\n00324|   const getDellinCrateWithBubbleUid = async (): Promise<string | null> => {\n00325|     try {\n00326|       const response = await fetch('https://api.dellin.ru/v1/references/packages.json', {\n00327|         method: 'POST',\n00328|         headers: {\n00329|           'Content-Type': 'application/json'\n00330|         },\n00331|         body: JSON.stringify({\n00332|           appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B'\n00333|         })\n00334|       });\n00335| \n00336|       const data = await response.json();\n00337|       console.log('üì¶ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö response.ok:', response.ok);\n00338|       console.log('üì¶ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö status:', response.status);\n00339|       console.log('üì¶ –°–ü–†–ê–í–û–ß–ù–ò–ö –£–ü–ê–ö–û–í–û–ö data:', data);\n00340|       \n00341|       if (response.ok && data.data && Array.isArray(data.data)) {\n00342|         console.log('üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–ø–∞–∫–æ–≤–æ–∫ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ:', data.data.length);\n00343|         console.log('üì¶ –ü–µ—Ä–≤—ã–µ 3 —É–ø–∞–∫–æ–≤–∫–∏:', data.data.slice(0, 3).map(p => ({name: p.name, uid: p.uid})));\n00344|         \n00345|         // –ù–∞—Ö–æ–¥–∏–º —É–ø–∞–∫–æ–≤–∫—É —Å name \"crate_with_bubble\"\n00346|         const crateWithBubble = data.data.find((pkg: any) => \n00347|           pkg.name === 'crate_with_bubble'\n00348|         );\n00349|         \n00350|         console.log('üì¶ –ü–æ–∏—Å–∫ crate_with_bubble —Ä–µ–∑—É–ª—å—Ç–∞—Ç:', crateWithBubble);\n00351|         \n00352|         if (crateWithBubble && crateWithBubble.uid) {\n00353|           console.log('‚úÖ –ù–∞–π–¥–µ–Ω UID –¥–ª—è crate_with_bubble:', crateWithBubble.uid);\n00354|           return crateWithBubble.uid;\n00355|         } else {\n00356|           console.log('‚ùå crate_with_bubble –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ—Ç UID');\n00357|         }\n00358|       } else {\n00359|         console.log('‚ùå –û—à–∏–±–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–∞ API —É–ø–∞–∫–æ–≤–æ–∫');\n00360|       }\n00361|       \n00362|       console.warn('–£–ø–∞–∫–æ–≤–∫–∞ —Å name=crate_with_bubble –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ');\n00363|       return null;\n00364|     } catch (error) {\n00365|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ —É–ø–∞–∫–æ–≤–æ–∫ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', error);\n00366|       return null;\n00367|     }\n00368|   };\n00369| \n00370|   // –†–∞—Å—á–µ—Ç –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π —á–µ—Ä–µ–∑ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π API v2/calculator.json\n00371|   const calculateDellin = async (): Promise<CalculationResult> => {\n00372|     const apiUrl = 'https://api.dellin.ru/v2/calculator.json';\n00373|     \n00374|     try {\n00375|       const sessionID = await getDellinSessionId();\n00376|       \n00377|       if (!sessionID) {\n00378|         return {\n00379|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n00380|           price: 0,\n00381|           days: 0,\n00382|           error: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å sessionID',\n00383|           apiUrl,\n00384|           requestData: null,\n00385|           responseData: null\n00386|         };\n00387|       }\n00388| \n00389|       // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏ –æ–±—ä–µ–º—ã\n00390|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n00391|       const totalVolume = form.cargos.reduce((sum, cargo) => \n00392|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n00393|       );\n00394|       const maxLength = Math.max(...form.cargos.map(c => c.length)) / 100; // –≤ –º–µ—Ç—Ä–∞—Ö\n00395|       const maxWidth = Math.max(...form.cargos.map(c => c.width)) / 100;\n00396|       const maxHeight = Math.max(...form.cargos.map(c => c.height)) / 100;\n00397| \n00398|       // –ü–æ–ª—É—á–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª—ã –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)\n00399|       const fromTerminalId = !form.fromAddressDelivery ? await getDellinTerminal(form.fromCity) : null;\n00400|       const toTerminalId = !form.toAddressDelivery ? await getDellinTerminal(form.toCity) : null;\n00401| \n00402|       // –ü–æ–ª—É—á–∞–µ–º UID —É–ø–∞–∫–æ–≤–∫–∏ crate_with_bubble (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∞)\n00403|       let packageUid: string | null = null;\n00404|       console.log('=== –ù–ê–ß–ê–õ–û –û–¢–õ–ê–î–ö–ò –£–ü–ê–ö–û–í–ö–ò ===');\n00405|       console.log('üîç –û–¢–õ–ê–î–ö–ê –£–ü–ê–ö–û–í–ö–ò: form.needPackaging =', form.needPackaging);\n00406|       console.log('üîç –û–¢–õ–ê–î–ö–ê –£–ü–ê–ö–û–í–ö–ò: typeof form.needPackaging =', typeof form.needPackaging);\n00407|       \n00408|       if (form.needPackaging) {\n00409|         console.log('üîç ‚úÖ –£–ü–ê–ö–û–í–ö–ê –¢–†–ï–ë–£–ï–¢–°–Ø - –ó–ê–ü–†–ê–®–ò–í–ê–ï–ú UID...');\n00410|         try {\n00411|           packageUid = await getDellinCrateWithBubbleUid();\n00412|           console.log('üîç ‚úÖ –ü–û–õ–£–ß–ï–ù packageUid –∏–∑ API:', packageUid);\n00413|           \n00414|           // –í–†–ï–ú–ï–ù–ù–û: –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ UID –∏–∑ API, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π\n00415|           if (!packageUid) {\n00416|             packageUid = '0xa6a7bd2bf950e67f4b2cf7cc3a97c111';\n00417|             console.log('üîç üß™ –ò–°–ü–û–õ–¨–ó–£–ï–ú –¢–ï–°–¢–û–í–´–ô UID:', packageUid);\n00418|           }\n00419|           \n00420|           console.log('üîç ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô packageUid:', packageUid);\n00421|           console.log('üîç ‚úÖ typeof packageUid:', typeof packageUid);\n00422|           console.log('üîç ‚úÖ packageUid truthy:', !!packageUid);\n00423|         } catch (error) {\n00424|           console.log('üîç ‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ packageUid:', error);\n00425|           // –í–†–ï–ú–ï–ù–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π UID –ø—Ä–∏ –æ—à–∏–±–∫–µ\n00426|           packageUid = '0xa6a7bd2bf950e67f4b2cf7cc3a97c111';\n00427|           console.log('üîç üß™ –ò–°–ü–û–õ–¨–ó–£–ï–ú –¢–ï–°–¢–û–í–´–ô UID –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏:', packageUid);\n00428|         }\n00429|       } else {\n00430|         console.log('üîç ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ UID');\n00431|       }\n00432|       console.log('=== –ö–û–ù–ï–¶ –û–¢–õ–ê–î–ö–ò –£–ü–ê–ö–û–í–ö–ò ===');\n00433| \n00434|       // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞—Ç—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞\n00435|       const tomorrow = new Date();\n00436|       tomorrow.setDate(tomorrow.getDate() + 1);\n00437|       const produceDate = tomorrow.toISOString().split('T')[0];\n00438| \n00439|       // –û—Ç–ª–∞–¥–∫–∞ –ø–µ—Ä–µ–¥ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–∞\n00440|       console.log('=== –û–¢–õ–ê–î–ö–ê –§–û–†–ú–ò–†–û–í–ê–ù–ò–Ø –ó–ê–ü–†–û–°–ê ===');\n00441|       console.log('üîç form.needPackaging =', form.needPackaging, '(—Ç–∏–ø:', typeof form.needPackaging, ')');\n00442|       console.log('üîç packageUid =', packageUid, '(—Ç–∏–ø:', typeof packageUid, ')');\n00443|       console.log('üîç packageUid truthy =', !!packageUid);\n00444|       console.log('üîç –£—Å–ª–æ–≤–∏–µ (form.needPackaging && packageUid) =', form.needPackaging && packageUid);\n00445|       \n00446|       if (form.needPackaging && packageUid) {\n00447|         console.log('‚úÖ PACKAGES –ë–£–î–ï–¢ –î–û–ë–ê–í–õ–ï–ù –í –ó–ê–ü–†–û–°!');\n00448|       } else {\n00449|         console.log('‚ùå PACKAGES –ù–ï –ë–£–î–ï–¢ –î–û–ë–ê–í–õ–ï–ù:');\n00450|         if (!form.needPackaging) console.log('  - form.needPackaging = false');\n00451|         if (!packageUid) console.log('  - packageUid –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç/null');\n00452|       }\n00453| \n00454|       // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n00455|       const requestData = {\n00456|         appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n00457|         sessionID: sessionID,\n00458|         delivery: {\n00459|           deliveryType: {\n00460|             type: 'auto'  // –í—Å–µ–≥–¥–∞ \"auto\" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n00461|           },\n00462|           derival: {\n00463|             produceDate: produceDate,  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –¥–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n00464|             variant: form.fromAddressDelivery ? 'address' : 'terminal',\n00465|             ...(form.fromAddressDelivery ? {\n00466|               address: {\n00467|                 search: form.fromAddress || form.fromCity\n00468|               }\n00469|             } : {\n00470|               terminalID: fromTerminalId\n00471|             }),\n00472|             time: {\n00473|               worktimeStart: '10:00',\n00474|               worktimeEnd: '18:00',\n00475|               breakStart: '13:00',\n00476|               breakEnd: '14:00',\n00477|               exactTime: false\n00478|             }\n00479|             // handling –≤ derival –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n00480|           },\n00481|           arrival: {\n00482|             variant: form.toAddressDelivery ? 'address' : 'terminal',\n00483|             ...(form.toAddressDelivery ? {\n00484|               address: {\n00485|                 search: form.toAddress || form.toCity\n00486|               }\n00487|             } : {\n00488|               terminalID: toTerminalId\n00489|             }),\n00490|             time: {\n00491|               worktimeStart: '10:00',\n00492|               worktimeEnd: '18:00',\n00493|               breakStart: '13:00',\n00494|               breakEnd: '14:00',\n00495|               exactTime: false\n00496|             },\n00497|             // handling –≤ arrival –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—ä–µ–º\n00498|             ...(form.needCarry ? {\n00499|               handling: {\n00500|                 freightLift: form.hasFreightLift, // true —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –≥–∞–ª–æ—á–∫–∞ \"–Ω–∞–ª–∏—á–∏–µ –≥—Ä—É–∑–æ–≤–æ–≥–æ –ª–∏—Ñ—Ç–∞\"\n00501|                 toFloor: form.floor, // —ç—Ç–∞–∂ –∏–∑ —Ñ–æ—Ä–º—ã\n00502|                 carry: 0\n00503|               }\n00504|             } : {})\n00505|           },\n00506|           ...(form.needPackaging && packageUid ? {\n00507|             packages: [{\n00508|               uid: packageUid,  // UID —É–ø–∞–∫–æ–≤–∫–∏ crate_with_bubble –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞\n00509|               count: 1  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1\n00510|             }]\n00511|           } : {})\n00512|         },\n00513|         cargo: {\n00514|           quantity: form.cargos.length,\n00515|           length: maxLength,\n00516|           width: maxWidth,\n00517|           height: maxHeight,\n00518|           weight: totalWeight,\n00519|           totalVolume: totalVolume,\n00520|           totalWeight: totalWeight,\n00521|           oversizedWeight: 0,\n00522|           oversizedVolume: 0,\n00523|           hazardClass: 0,  // –í—Å–µ–≥–¥–∞ 0 –µ—Å–ª–∏ –Ω–µ—Ç –æ–ø–∞—Å–Ω—ã—Ö –≥—Ä—É–∑–æ–≤\n00524|           ...(form.needInsurance && form.declaredValue > 0 ? {\n00525|             insurance: {\n00526|               statedValue: form.declaredValue,\n00527|               term: true  // –í—Å–µ–≥–¥–∞ true –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è\n00528|             }\n00529|           } : {})\n00530|         },\n00531|         payment: {\n00532|           type: 'noncash',  // –í—Å–µ–≥–¥–∞ \"noncash\"\n00533|           paymentCitySearch: {\n00534|             search: form.fromCity  // –ì–æ—Ä–æ–¥ –æ–ø–ª–∞—Ç—ã\n00535|           }\n00536|         }\n00537|       };\n00538| \n00539|       console.log('üöÄ –ò–¢–û–ì–û–í–´–ô –ó–ê–ü–†–û–° –ö –î–õ:', JSON.stringify(requestData, null, 2));\n00540|       \n00541|       // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∞ packages\n00542|       if (requestData.delivery.packages) {\n00543|         console.log('‚úÖ PACKAGES –ù–ê–ô–î–ï–ù –í –ó–ê–ü–†–û–°–ï:', requestData.delivery.packages);\n00544|       } else {\n00545|         console.log('‚ùå PACKAGES –ù–ï –ù–ê–ô–î–ï–ù –í –ó–ê–ü–†–û–°–ï');\n00546|         console.log('   form.needPackaging =', form.needPackaging);\n00547|         console.log('   packageUid =', packageUid);\n00548|         console.log('   –£—Å–ª–æ–≤–∏–µ:', form.needPackaging && packageUid);\n00549|       }\n00550| \n00551|       const response = await fetch(apiUrl, {\n00552|         method: 'POST',\n00553|         headers: {\n00554|           'Content-Type': 'application/json',\n00555|           'Accept': 'application/json'\n00556|         },\n00557|         body: JSON.stringify(requestData)\n00558|       });\n00559| \n00560|       const data = await response.json();\n00561|       console.log('üöÄ –û–¢–í–ï–¢ –î–õ response.ok:', response.ok);\n00562|       console.log('üöÄ –û–¢–í–ï–¢ –î–õ status:', response.status);\n00563|       console.log('üöÄ –û–¢–í–ï–¢ –î–õ data:', data);\n00564|       \n00565|       // –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –°–¢–†–ê–•–û–í–ö–ò\n00566|       console.log('=== –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –°–¢–†–ê–•–û–í–ö–ò ===');\n00567|       console.log('üîç –ü–û–õ–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê data.data:', JSON.stringify(data.data, null, 2));\n00568|       \n00569|       // –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç—Ä–∞—Ö–æ–≤–∫–æ–π\n00570|       console.log('üí≥ –ü–û–ò–°–ö –ö–û–ú–ü–û–ù–ï–ù–¢–û–í –°–¢–†–ê–•–û–í–ö–ò:');\n00571|       console.log('üí≥ data.data.insurance:', data.data?.insurance);\n00572|       console.log('üí≥ data.data.cargoInsurance:', data.data?.cargoInsurance);\n00573|       console.log('üí≥ data.data.termInsurance:', data.data?.termInsurance);\n00574|       console.log('üí≥ data.data.insuranceDetails:', data.data?.insuranceDetails);\n00575|       console.log('üí≥ data.data.services:', data.data?.services);\n00576|       console.log('üí≥ data.data.additionalServices:', data.data?.additionalServices);\n00577|       \n00578|       // –ü–æ–∏—Å–∫ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏ –≤ –¥—Ä—É–≥–∏—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö\n00579|       if (data.data.derival) {\n00580|         console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –ó–ê–ë–û–ï data.data.derival.insurance:', data.data.derival.insurance);\n00581|       }\n00582|       if (data.data.arrival) {\n00583|         console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –î–û–°–¢–ê–í–ö–ï data.data.arrival.insurance:', data.data.arrival.insurance);\n00584|       }\n00585|       if (data.data.intercity) {\n00586|         console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –ü–ï–†–ï–í–û–ó–ö–ï data.data.intercity.insurance:', data.data.intercity.insurance);\n00587|       }\n00588|       \n00589|       // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö \"insurance\"\n00590|       const findInsuranceFields = (obj: any, path = '') => {\n00591|         if (typeof obj !== 'object' || obj === null) return;\n00592|         \n00593|         Object.keys(obj).forEach(key => {\n00594|           const fullPath = path ? `${path}.${key}` : key;\n00595|           if (key.toLowerCase().includes('insurance') || key.toLowerCase().includes('insur')) {\n00596|             console.log(`üí≥ –ù–ê–ô–î–ï–ù–û –ü–û–õ–ï –°–¢–†–ê–•–û–í–ö–ò [${fullPath}]:`, obj[key]);\n00597|           }\n00598|           if (typeof obj[key] === 'object') {\n00599|             findInsuranceFields(obj[key], fullPath);\n00600|           }\n00601|         });\n00602|       };\n00603|       \n00604|       console.log('üí≥ –†–ï–ö–£–†–°–ò–í–ù–´–ô –ü–û–ò–°–ö –ü–û–õ–ï–ô –°–¢–†–ê–•–û–í–ö–ò:');\n00605|       findInsuranceFields(data.data, 'data.data');\n00606|       console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –°–¢–†–ê–•–û–í–ö–ò ===');\n00607|       \n00608|       // –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ packages –≤ –æ—Ç–≤–µ—Ç–µ\n00609|       console.log('=== –ü–û–ò–°–ö PACKAGES –í –û–¢–í–ï–¢–ï ===');\n00610|       console.log('üì¶ data.data =', data.data);\n00611|       console.log('üì¶ data.data.packages =', data.data?.packages);\n00612|       console.log('üì¶ –¢–∏–ø data.data.packages:', typeof data.data?.packages);\n00613|       if (data.data?.packages) {\n00614|         console.log('‚úÖ PACKAGES –ù–ê–ô–î–ï–ù –í –û–¢–í–ï–¢–ï!');\n00615|         console.log('üì¶ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ packages:', JSON.stringify(data.data.packages, null, 2));\n00616|       } else {\n00617|         console.log('‚ùå PACKAGES –ù–ï –ù–ê–ô–î–ï–ù –í –û–¢–í–ï–¢–ï');\n00618|       }\n00619|       console.log('=== –ö–û–ù–ï–¶ –ü–û–ò–°–ö–ê PACKAGES ===');\n00620| \n00621|       if (response.ok && data.data && data.metadata?.status === 200) {\n00622|         let totalPrice = data.data.price || 0;\n00623|         console.log('üí∞ –†–ê–°–ß–ï–¢ –ò–¢–û–ì–û–í–û–ô –°–¢–û–ò–ú–û–°–¢–ò:');\n00624|         console.log('üí∞ –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å data.data.price (–£–ñ–ï –í–ö–õ–Æ–ß–ê–ï–¢ –í–°–ï):', totalPrice);\n00625|         \n00626|         // –°–¢–†–ê–•–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n00627|         if (data.data.insurance) {\n00628|           console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ data.data.insurance (–£–ñ–ï –≤–∫–ª—é—á–µ–Ω–∞ –≤ –±–∞–∑–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):', data.data.insurance);\n00629|           console.log('üí∞ –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞—Ö–æ–≤–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ');\n00630|         } else {\n00631|           console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–≤–µ—Ç–µ');\n00632|         }\n00633|         \n00634|         // –£–ü–ê–ö–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n00635|         console.log('üí∞ –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–ë –£–ü–ê–ö–û–í–ö–ï (–£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –í –û–°–ù–û–í–ù–£–Æ –°–¢–û–ò–ú–û–°–¢–¨):');\n00636|         console.log('üí∞ data.data.packages =', data.data.packages);\n00637|         console.log('üí∞ form.needPackaging =', form.needPackaging);\n00638|         \n00639|         if (data.data.packages && form.needPackaging) {\n00640|           console.log('üí∞ ‚úÖ –£–ü–ê–ö–û–í–ö–ê –ü–†–ò–°–£–¢–°–¢–í–£–ï–¢ –í –û–¢–í–ï–¢–ï (—Ü–µ–Ω–∞ —É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ data.data.price)');\n00641|           console.log('üí∞ –¢–∏–ø packages:', Array.isArray(data.data.packages) ? 'Array' : 'Object');\n00642|           \n00643|           if (Array.isArray(data.data.packages)) {\n00644|             data.data.packages.forEach((pkg: any, index: number) => {\n00645|               console.log(`üí∞ Package [${index}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n00646|             });\n00647|           } else {\n00648|             Object.entries(data.data.packages).forEach(([key, pkg]: [string, any]) => {\n00649|               console.log(`üí∞ Package [${key}] (–≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):`, pkg);\n00650|             });\n00651|           }\n00652|         } else {\n00653|           console.log('üí∞ ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∞—Å—å');\n00654|         }\n00655| \n00656|         // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–∞–∫ —Ä–∞–∑–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –¥–∞—Ç–∞–º–∏ pickup –∏ arrivalToOspReceiver\n00657|         let deliveryDays = 0;\n00658|         try {\n00659|           console.log('=== –ü–û–ò–°–ö –î–ê–¢ –í –û–¢–í–ï–¢–ï ===');\n00660|           \n00661|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–µ—Å—Ç–∞ –≥–¥–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–∞—Ç—ã\n00662|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.pickup:', data.data?.pickup);\n00663|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.pickup:', data.pickup);\n00664|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.pickup:', data?.pickup);\n00665|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.data?.arrivalToOspReceiver:', data.data?.arrivalToOspReceiver);\n00666|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data.arrivalToOspReceiver:', data.arrivalToOspReceiver);\n00667|           console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º data?.arrivalToOspReceiver:', data?.arrivalToOspReceiver);\n00668|           \n00669|           // –ë–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–π –ø–æ–∏—Å–∫ –≤–æ –≤—Å–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ data\n00670|           const findDateInObject = (obj: any, fieldName: string): string | null => {\n00671|             if (!obj || typeof obj !== 'object') return null;\n00672|             \n00673|             for (const [key, value] of Object.entries(obj)) {\n00674|               if (key === fieldName && typeof value === 'string') {\n00675|                 return value;\n00676|               }\n00677|               if (typeof value === 'object' && value !== null) {\n00678|                 const found = findDateInObject(value, fieldName);\n00679|                 if (found) return found;\n00680|               }\n00681|             }\n00682|             return null;\n00683|           };\n00684|           \n00685|           const pickup = findDateInObject(data, 'pickup');\n00686|           const arrivalToOspReceiver = findDateInObject(data, 'arrivalToOspReceiver');\n00687|           \n00688|           console.log('–ù–ê–ô–î–ï–ù–ù–´–ï –î–ê–¢–´:');\n00689|           console.log('pickup:', pickup);\n00690|           console.log('arrivalToOspReceiver:', arrivalToOspReceiver);\n00691|           \n00692|           if (pickup && arrivalToOspReceiver) {\n00693|             // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—ã (—Ñ–æ—Ä–º–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å \"2025-09-27\" –∏–ª–∏ \"2025-09-27 10:00:00\")\n00694|             const pickupDate = new Date(pickup);\n00695|             const arrivalDate = new Date(arrivalToOspReceiver);\n00696|             \n00697|             console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ pickup:', pickupDate);\n00698|             console.log('–ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ arrival:', arrivalDate);\n00699|             \n00700|             // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã\n00701|             if (!isNaN(pickupDate.getTime()) && !isNaN(arrivalDate.getTime())) {\n00702|               // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–æ—Å—Ç—å –≤ –¥–Ω—è—Ö\n00703|               const timeDiff = arrivalDate.getTime() - pickupDate.getTime();\n00704|               deliveryDays = Math.max(1, Math.ceil(timeDiff / (1000 * 3600 * 24))); // –ú–∏–Ω–∏–º—É–º 1 –¥–µ–Ω—å\n00705|               \n00706|               console.log('–†–∞–∑–Ω–æ—Å—Ç—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö:', timeDiff);\n00707|               console.log('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –í–´–ß–ò–°–õ–ï–ù —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:', deliveryDays, '–¥–Ω–µ–π');\n00708|             } else {\n00709|               console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞—Ç—ã –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞');\n00710|               console.error('pickup Date object:', pickupDate);\n00711|               console.error('arrival Date object:', arrivalDate);\n00712|             }\n00713|           } else {\n00714|             console.warn('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –ù–µ –Ω–∞–π–¥–µ–Ω—ã –¥–∞—Ç—ã pickup –∏–ª–∏ arrivalToOspReceiver');\n00715|             console.log('pickup –Ω–∞–π–¥–µ–Ω:', !!pickup, pickup);\n00716|             console.log('arrivalToOspReceiver –Ω–∞–π–¥–µ–Ω:', !!arrivalToOspReceiver, arrivalToOspReceiver);\n00717|           }\n00718|         } catch (error) {\n00719|           console.error('–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ - –û—à–∏–±–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:', error);\n00720|         }\n00721| \n00722|         console.log('üí∞ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ò–¢–û–ì–û–í–ê–Ø –°–¢–û–ò–ú–û–°–¢–¨:', Math.round(totalPrice));\n00723|         \n00724|         return {\n00725|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n00726|           price: Math.round(totalPrice),\n00727|           days: deliveryDays || 0,\n00728|           details: data.data,\n00729|           requestData,\n00730|           responseData: data,\n00731|           apiUrl,\n00732|           sessionId: sessionID\n00733|         };\n00734|       } else {\n00735|         const errorMessage = data.metadata?.detail || \n00736|                            data.metadata?.message || \n00737|                            data.errors?.[0]?.detail || \n00738|                            (data.metadata?.status !== 200 ? `HTTP ${data.metadata?.status}` : '') ||\n00739|                            '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏';\n00740|         return {\n00741|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n00742|           price: 0,\n00743|           days: 0,\n00744|           error: errorMessage,\n00745|           requestData,\n00746|           responseData: data,\n00747|           apiUrl,\n00748|           sessionId: sessionID\n00749|         };\n00750|       }\n00751|     } catch (error: any) {\n00752|       return {\n00753|         company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n00754|         price: 0,\n00755|         days: 0,\n00756|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n00757|         requestData: null,\n00758|         responseData: null,\n00759|         apiUrl\n00760|       };\n00761|     }\n00762|   };\n00763| \n00764|   // –†–∞—Å—á–µ—Ç –¥–ª—è Nord Wheel\n00765|   const calculateNordWheel = async (): Promise<CalculationResult> => {\n00766|     const apiUrl = 'https://nordw.ru/tools/api/calc/calculate/';\n00767|     \n00768|     try {\n00769|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n00770|       const totalVolume = form.cargos.reduce((sum, cargo) => \n00771|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n00772|       );\n00773| \n00774|       const params = new URLSearchParams({\n00775|         from: '91', // –ú–æ—Å–∫–≤–∞ (–Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å ID –≥–æ—Ä–æ–¥–∞)\n00776|         to: '92', // –°–ü–± (–Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å ID –≥–æ—Ä–æ–¥–∞)\n00777|         pickup: form.fromAddressDelivery ? '1' : '0',\n00778|         deliver: form.toAddressDelivery ? '1' : '0',\n00779|         weight: totalWeight.toString(),\n00780|         volume: totalVolume.toString(),\n00781|         oversized: '0',\n00782|         package: form.needPackaging ? '1' : '0',\n00783|         packageCount: form.cargos.length.toString(),\n00784|         insurance: form.needInsurance ? '1' : '0',\n00785|         sum: form.declaredValue.toString(),\n00786|         documentsReturn: '0',\n00787|         fragile: '1'\n00788|       });\n00789| \n00790|       const requestData = Object.fromEntries(params);\n00791|       const fullUrl = `${apiUrl}?${params.toString()}`;\n00792| \n00793|       const response = await fetch(fullUrl);\n00794|       const data = await response.json();\n00795| \n00796|       if (response.ok && data.status === 'success' && data.data) {\n00797|         return {\n00798|           company: 'Nord Wheel',\n00799|           price: data.data.total || 0,\n00800|           days: data.data.days || 0,\n00801|           details: {\n00802|             ...data.data,\n00803|             totalCost: data.data.total,\n00804|             deliveryCost: data.data.door,\n00805|             terminalCost: data.data.terminal,\n00806|             pickupCost: data.data.pick,\n00807|             deliveryToDoorCost: data.data.deliver,\n00808|             additionalServices: (data.data.total || 0) - (data.data.door || 0)\n00809|           },\n00810|           requestData,\n00811|           responseData: data,\n00812|           apiUrl: fullUrl\n00813|         };\n00814|       } else {\n00815|         return {\n00816|           company: 'Nord Wheel',\n00817|           price: 0,\n00818|           days: 0,\n00819|           error: '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ Nord Wheel',\n00820|           requestData,\n00821|           responseData: data,\n00822|           apiUrl: fullUrl\n00823|         };\n00824|       }\n00825|     } catch (error: any) {\n00826|       return {\n00827|         company: 'Nord Wheel',\n00828|         price: 0,\n00829|         days: 0,\n00830|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`,\n00831|         apiUrl\n00832|       };\n00833|     }\n00834|   };\n00835| \n00836|   // –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Å–∫–ª–∞–¥–æ–≤ –ü–≠–ö –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ (UUID –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ API)\n00837|   const PEK_WAREHOUSES: { [key: string]: string } = {\n00838|     '–º–æ—Å–∫–≤–∞': 'dc6c746d-812d-11e4-bbfc-001999d8b3c5',\n00839|     '—Å–∞–Ω–∫—Ç–ø–µ—Ç–µ—Ä–±—É—Ä–≥': 'b436c978-086d-11e6-b6ca-00155d668909', \n00840|     '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': 'f8d9c8e3-8e2d-11e4-bbfc-001999d8b3c5',\n00841|     '–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫': 'a1b2c3d4-5e6f-7g8h-9i0j-k1l2m3n4o5p6',\n00842|     '–Ω–∏–∂–Ω–∏–π–Ω–æ–≤–≥–æ—Ä–æ–¥': 'e1f2g3h4-5i6j-7k8l-9m0n-o1p2q3r4s5t6',\n00843|     '–∫–∞–∑–∞–Ω—å': 'u1v2w3x4-5y6z-7a8b-9c0d-e1f2g3h4i5j6',\n00844|     '—á–µ–ª—è–±–∏–Ω—Å–∫': 'k1l2m3n4-5o6p-7q8r-9s0t-u1v2w3x4y5z6',\n00845|     '–æ–º—Å–∫': 'a1b2c3d4-5e6f-7g8h-9i0j-k1l2m3n4o5p7',\n00846|     '—Å–∞–º–∞—Ä–∞': 'q1w2e3r4-5t6y-7u8i-9o0p-a1s2d3f4g5h6',\n00847|     '—Ä–æ—Å—Ç–æ–≤–Ω–∞–¥–æ–Ω—É': 'z1x2c3v4-5b6n-7m8q-9w0e-r1t2y3u4i5o6',\n00848|     '—É—Ñ–∞': 'p1o2i3u4-5y6t-7r8e-9w0q-a1s2d3f4g5h7',\n00849|     '–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫': 'l1k2j3h4-5g6f-7d8s-9a0z-x1c2v3b4n5m6',\n00850|     '–≤–æ—Ä–æ–Ω–µ–∂': 'q1w2e3r4-5t6y-7u8i-9o0p-z1x2c3v4b5n6',\n00851|     '–ø–µ—Ä–º—å': 'm1n2b3v4-5c6x-7z8a-9s0d-f1g2h3j4k5l6',\n00852|     '–≤–æ–ª–≥–æ–≥—Ä–∞–¥': 'p1o2i3u4-5y6t-7r8e-9w0q-m1n2b3v4c5x6'\n00853|   };\n00854| \n00855|   // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–∫–ª–∞–¥–∞ –ü–≠–ö –ø–æ –≥–æ—Ä–æ–¥—É\n00856|   const getPekWarehouseId = (cityName: string): string | null => {\n00857|     const normalizedCity = cityName.toLowerCase()\n00858|       .replace(/—ë/g, '–µ')\n00859|       .replace(/[\\s\\-\\.–≥\\.]+/g, '')\n00860|       .replace(/–æ–±–ª–∞—Å—Ç—å|–æ–±–ª|–∫—Ä–∞–π|—Ä–µ—Å–ø—É–±–ª–∏–∫–∞|—Ä–µ—Å–ø|–∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥|–∞–æ/g, '');\n00861|     \n00862|     console.log(`üè¢ –ü–æ–∏—Å–∫ —Å–∫–ª–∞–¥–∞ –ü–≠–ö –¥–ª—è –≥–æ—Ä–æ–¥–∞: \"${cityName}\" -> \"${normalizedCity}\"`);\n00863|     \n00864|     const warehouseId = PEK_WAREHOUSES[normalizedCity];\n00865|     if (warehouseId) {\n00866|       console.log(`‚úÖ –ù–∞–π–¥–µ–Ω —Å–∫–ª–∞–¥ –ü–≠–ö: ${warehouseId}`);\n00867|       return warehouseId;\n00868|     }\n00869|     \n00870|     console.log(`‚ùå –°–∫–ª–∞–¥ –ü–≠–ö –¥–ª—è –≥–æ—Ä–æ–¥–∞ \"${cityName}\" –Ω–µ –Ω–∞–π–¥–µ–Ω`);\n00871|     return null;\n00872|   };\n00873| \n00874|   // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ü–≠–ö)\n00875|   const getYandexCoordinates = async (address: string): Promise<{ latitude: string, longitude: string } | null> => {\n00876|     try {\n00877|       const encodedAddress = encodeURIComponent(address);\n00878|       const response = await fetch(`https://geocode-maps.yandex.ru/1.x/?apikey=YOUR_API_KEY&geocode=${encodedAddress}&format=json`);\n00879|       \n00880|       if (!response.ok) return null;\n00881|       \n00882|       const data = await response.json();\n00883|       const coords = data?.response?.GeoObjectCollection?.featureMember?.[0]?.GeoObject?.Point?.pos?.split(' ');\n00884|       \n00885|       if (coords && coords.length === 2) {\n00886|         return {\n00887|           longitude: coords[0],\n00888|           latitude: coords[1]\n00889|         };\n00890|       }\n00891|       \n00892|       return null;\n00893|     } catch (error) {\n00894|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ø–Ω–¥–µ–∫—Å:', error);\n00895|       return null;\n00896|     }\n00897|   };\n00898| \n00899|   // –†–∞—Å—á–µ—Ç –¥–ª—è –ü–≠–ö —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API\n00900|   const calculatePEK = async (): Promise<CalculationResult> => {\n00901|     const apiUrl = 'https://kabinet.pecom.ru/api/v1/calculateprice/';\n00902|     \n00903|     try {\n00904|       // –ü–æ–ª—É—á–∞–µ–º ID —Å–∫–ª–∞–¥–æ–≤ –ø–æ –≥–æ—Ä–æ–¥–∞–º\n00905|       const senderWarehouseId = getPekWarehouseId(form.fromCity);\n00906|       const receiverWarehouseId = getPekWarehouseId(form.toCity);\n00907|       \n00908|       if (!senderWarehouseId || !receiverWarehouseId) {\n00909|         return {\n00910|           company: '–ü–≠–ö',\n00911|           price: 0,\n00912|           days: 0,\n00913|           error: `–°–∫–ª–∞–¥ –ü–≠–ö –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–æ—Ä–æ–¥–∞: ${!senderWarehouseId ? form.fromCity : ''} ${!receiverWarehouseId ? form.toCity : ''}`.trim(),\n00914|           apiUrl,\n00915|           requestData: { fromCity: form.fromCity, toCity: form.toCity },\n00916|           responseData: null\n00917|         };\n00918|       }\n00919| \n00920|       // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞—Ç—É –∑–∞–≤—Ç—Ä–∞ –¥–ª—è –∑–∞–±–æ—Ä–∞\n00921|       const tomorrow = new Date();\n00922|       tomorrow.setDate(tomorrow.getDate() + 1);\n00923|       const plannedDateTime = tomorrow.toISOString().slice(0, 19); // 2023-02-28T14:00:00\n00924| \n00925|       // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –≥—Ä—É–∑–æ–≤\n00926|       const cargos = form.cargos.map(cargo => ({\n00927|         length: cargo.length / 100, // –ø–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–µ—Ç—Ä—ã\n00928|         width: cargo.width / 100,\n00929|         height: cargo.height / 100,\n00930|         volume: (cargo.length * cargo.width * cargo.height) / 1000000, // –º3\n00931|         weight: cargo.weight,\n00932|         isHP: form.needPackaging, // –∑–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n00933|         sealingPositionsCount: 0\n00934|       }));\n00935| \n00936|       // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –∫ API –ü–≠–ö\n00937|       const requestData = {\n00938|         currencyCode: \"643\", // —Ä—É–±–ª–∏\n00939|         types: [3], // —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ –ø–µ—Ä–µ–≤–æ–∑–∫–∞\n00940|         senderWarehouseId,\n00941|         receiverWarehouseId,\n00942|         isOpenCarSender: false,\n00943|         isOpenCarReceiver: false,\n00944|         isHyperMarket: false,\n00945|         plannedDateTime,\n00946|         isInsurance: form.needInsurance && form.declaredValue > 0,\n00947|         isInsurancePrice: form.needInsurance ? form.declaredValue : 0,\n00948|         isPickUp: form.fromAddressDelivery,\n00949|         isDelivery: form.toAddressDelivery,\n00950|         needReturnDocuments: false,\n00951|         needArrangeTransportationDocuments: false,\n00952|         senderDistanceType: 0,\n00953|         receiverDistanceType: 0,\n00954|         cargos\n00955|       };\n00956| \n00957|       // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏ –ü–†–† –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\n00958|       if (form.needCarry) {\n00959|         requestData.pickupServices = {\n00960|           isLoading: true,\n00961|           floor: 0,\n00962|           carryingDistance: 0,\n00963|           isElevator: false\n00964|         };\n00965|         requestData.deliveryServices = {\n00966|           isLoading: true,\n00967|           floor: 0,\n00968|           carryingDistance: 0,\n00969|           isElevator: false\n00970|         };\n00971|       }\n00972| \n00973|       // –î–æ–±–∞–≤–ª—è–µ–º –∞–¥—Ä–µ—Å–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞\n00974|       if (form.fromAddressDelivery) {\n00975|         requestData.pickup = {\n00976|           address: form.fromAddress || `–†–æ—Å—Å–∏—è, ${form.fromCity}`\n00977|         };\n00978|       }\n00979|       \n00980|       if (form.toAddressDelivery) {\n00981|         requestData.delivery = {\n00982|           address: form.toAddress || `–†–æ—Å—Å–∏—è, ${form.toCity}`\n00983|         };\n00984|       }\n00985| \n00986|       console.log('üöÄ –ü–≠–ö API –∑–∞–ø—Ä–æ—Å:', requestData);\n00987| \n00988|       const response = await fetch(apiUrl, {\n00989|         method: 'POST',\n00990|         headers: {\n00991|           'Content-Type': 'application/json;charset=utf-8',\n00992|           'Accept': 'application/json',\n00993|           'Authorization': `Bearer 624FC93CA677B23673BB476D4982294DC27E246F`\n00994|         },\n00995|         body: JSON.stringify(requestData)\n00996|       });\n00997| \n00998|       const data = await response.json();\n00999|       console.log('üöÄ –ü–≠–ö API –æ—Ç–≤–µ—Ç:', data);\n01000| \n01001|       if (response.ok && !data.hasError && data.transfers && data.transfers.length > 0) {\n01002|         const transfer = data.transfers[0]; // –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Ç–∞—Ä–∏—Ñ (–∞–≤—Ç–æ)\n01003|         \n01004|         if (!transfer.hasError) {\n01005|           // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —É—Å–ª—É–≥\n01006|           const services = [];\n01007|           let totalCalculated = 0;\n01008| \n01009|           const processServices = (servicesList: any[], parentName = '') => {\n01010|             servicesList.forEach(service => {\n01011|               const serviceName = parentName ? `${parentName} - ${service.info}` : service.info;\n01012|               const serviceCost = parseFloat(service.cost) || 0;\n01013|               \n01014|               if (serviceCost > 0) {\n01015|                 services.push({\n01016|                   name: serviceName,\n01017|                   description: service.serviceType,\n01018|                   price: serviceCost\n01019|                 });\n01020|                 totalCalculated += serviceCost;\n01021|               }\n01022| \n01023|               // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏\n01024|               if (service.services && Array.isArray(service.services)) {\n01025|                 processServices(service.services, serviceName);\n01026|               }\n01027|             });\n01028|           };\n01029| \n01030|           if (transfer.services) {\n01031|             processServices(transfer.services);\n01032|           }\n01033| \n01034|           return {\n01035|             company: '–ü–≠–ö',\n01036|             price: Math.round(transfer.costTotal),\n01037|             days: transfer.estDeliveryTime || 3,\n01038|             details: {\n01039|               note: `–î–æ—Å—Ç–∞–≤–∫–∞ ${form.fromCity} - ${form.toCity} (—Ç–∞—Ä–∏—Ñ ${transfer.type})`,\n01040|               services: services.length > 0 ? services : [\n01041|                 {\n01042|                   name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n01043|                   description: `${form.fromCity} - ${form.toCity}`,\n01044|                   price: Math.round(transfer.costTotal)\n01045|                 }\n01046|               ]\n01047|             },\n01048|             requestData,\n01049|             responseData: data,\n01050|             apiUrl\n01051|           };\n01052|         } else {\n01053|           throw new Error(transfer.errorMessage || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞ –ü–≠–ö');\n01054|         }\n01055|       } else {\n01056|         throw new Error(data.errorMessage || '–û—à–∏–±–∫–∞ API –ü–≠–ö');\n01057|       }\n01058|       \n01059|     } catch (error: any) {\n01060|       console.error('üö® –û—à–∏–±–∫–∞ –ü–≠–ö API:', error);\n01061|       \n01062|       // –§–æ–ª–ª–±—ç–∫ —Ä–∞—Å—á–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ\n01063|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n01064|       let basePrice = totalWeight * 18; // 18 —Ä—É–± –∑–∞ –∫–≥ –¥–ª—è –ü–≠–ö\n01065|       \n01066|       if (form.fromAddressDelivery) basePrice += 600;\n01067|       if (form.toAddressDelivery) basePrice += 600;\n01068|       if (form.needInsurance && form.declaredValue > 0) basePrice += form.declaredValue * 0.012;\n01069|       if (form.needPackaging) basePrice += totalWeight * 25;\n01070|       if (form.needCarry) basePrice += 500;\n01071|       \n01072|       return {\n01073|         company: '–ü–≠–ö',\n01074|         price: Math.round(basePrice),\n01075|         days: 3,\n01076|         details: {\n01077|           note: '–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º –ü–≠–ö (–æ—à–∏–±–∫–∞ API)',\n01078|           services: [\n01079|             {\n01080|               name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n01081|               description: `${form.fromCity} - ${form.toCity}`,\n01082|               price: Math.round(basePrice)\n01083|             }\n01084|           ]\n01085|         },\n01086|         requestData: null,\n01087|         responseData: null,\n01088|         apiUrl,\n01089|         error: `–û—à–∏–±–∫–∞ API –ü–≠–ö: ${error.message}. –ü–æ–∫–∞–∑–∞–Ω –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç.`\n01090|       };\n01091|     }\n01092|   };\n01093| \n01094|   // –ü–æ–ª—É—á–µ–Ω–∏–µ ID —Å–∫–ª–∞–¥–∞ –ü–≠–ö –ø–æ –∞–¥—Ä–µ—Å—É —á–µ—Ä–µ–∑ API\n01095|   const findPekWarehouseId = async (address: string): Promise<string | null> => {\n01096|     try {\n01097|       // –ò—Å–ø–æ–ª—å–∑—É–µ–º API –ü–≠–ö –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–∫–ª–∞–¥–∞ –ø–æ –∞–¥—Ä–µ—Å—É\n01098|       const response = await fetch('https://api.pecom.ru/v1/branches/findzonebyaddress', {\n01099|         method: 'POST',\n01100|         headers: {\n01101|           'Content-Type': 'application/json',\n01102|           'Authorization': 'Basic ' + btoa('C04C5BF2AE367BDCBDC71E7DA520A69B167D1984:')\n01103|         },\n01104|         body: JSON.stringify({\n01105|           address: address\n01106|         })\n01107|       });\n01108| \n01109|       if (response.ok) {\n01110|         const data = await response.json();\n01111|         return data.mainWarehouseId || null;\n01112|       }\n01113|       \n01114|       // –§–æ–ª–ª–±—ç–∫ –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤\n01115|       const fallbackWarehouses: { [key: string]: string } = {\n01116|         '–º–æ—Å–∫–≤–∞': 'dc6c746d-812d-11e4-bbfc-001999d8b3c5',\n01117|         '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': 'b436c978-086d-11e6-b6ca-00155d668909',\n01118|         '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': '550e8400-e29b-41d4-a716-446655440000'\n01119|       };\n01120|       \n01121|       const normalizedCity = address.toLowerCase().trim()\n01122|         .replace(/—ë/g, '–µ')\n01123|         .replace(/[\\s\\-\\.]+/g, '');\n01124|       \n01125|       for (const [city, warehouseId] of Object.entries(fallbackWarehouses)) {\n01126|         const normalizedCityKey = city.replace(/[\\s\\-\\.]+/g, '');\n01127|         if (normalizedCity.includes(normalizedCityKey) || normalizedCityKey.includes(normalizedCity)) {\n01128|           return warehouseId;\n01129|         }\n01130|       }\n01131|       \n01132|       return null;\n01133|     } catch (error) {\n01134|       console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ —Å–∫–ª–∞–¥–∞ –ü–≠–ö:', error);\n01135|       return null;\n01136|     }\n01137|   };\n01138| \n01139|   // –†–∞—Å—á–µ—Ç –¥–ª—è –ü–≠–ö —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–π API\n01140|   const calculatePEK = async (): Promise<CalculationResult> => {\n01141|     const apiUrl = 'http://calc.pecom.ru/bitrix/components/pecom/calc/ajax.php';\n01142|     \n01143|     try {\n01144|       // –ü–æ–ª—É—á–∞–µ–º ID –≥–æ—Ä–æ–¥–æ–≤\n01145|       const fromCityId = await findPekCityId(form.fromCity);\n01146|       const toCityId = await findPekCityId(form.toCity);\n01147|       \n01148|       if (!fromCityId || !toCityId) {\n01149|         return {\n01150|           company: '–ü–≠–ö',\n01151|           price: 0,\n01152|           days: 0,\n01153|           error: `–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –ü–≠–ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: ${!fromCityId ? form.fromCity : ''} ${!toCityId ? form.toCity : ''}`.trim(),\n01154|           apiUrl,\n01155|           requestData: { fromCity: form.fromCity, toCity: form.toCity, fromCityId, toCityId },\n01156|           responseData: null\n01157|         };\n01158|       }\n01159| \n01160|       // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –ø—É–±–ª–∏—á–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n01161|       const params = new URLSearchParams();\n01162|       \n01163|       // –î–æ–±–∞–≤–ª—è–µ–º –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ —Ñ–æ—Ä–º–∞—Ç—É: –®–∏—Ä–∏–Ω–∞ (–º), –î–ª–∏–Ω–∞ (–º), –í—ã—Å–æ—Ç–∞ (–º), –û–±—ä–µ–º (–º3), –í–µ—Å (–∫–≥), –ù–µ–≥–∞–±–∞—Ä–∏—Ç (0/1), –ó–¢–£ (0/1)\n01164|       form.cargos.forEach((cargo, index) => {\n01165|         const width = cargo.width / 100; // –ø–µ—Ä–µ–≤–æ–¥–∏–º —Å–º –≤ –º–µ—Ç—Ä—ã\n01166|         const length = cargo.length / 100;\n01167|         const height = cargo.height / 100;\n01168|         const volume = width * length * height;\n01169|         const weight = cargo.weight;\n01170|         const isOversized = (width > 2.4 || length > 12 || height > 2.7 || weight > 1500) ? 1 : 0;\n01171|         const needZTU = form.needPackaging ? 1 : 0;\n01172|         \n01173|         params.append(`places[${index}][]`, width.toString());\n01174|         params.append(`places[${index}][]`, length.toString());\n01175|         params.append(`places[${index}][]`, height.toString());\n01176|         params.append(`places[${index}][]`, volume.toString());\n01177|         params.append(`places[${index}][]`, weight.toString());\n01178|         params.append(`places[${index}][]`, isOversized.toString());\n01179|         params.append(`places[${index}][]`, needZTU.toString());\n01180|       });\n01181|       \n01182|       // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–±–æ—Ä–∞\n01183|       params.append('take[town]', fromCityId.toString());\n01184|       params.append('take[tent]', '0'); // —Ä–∞—Å—Ç–µ–Ω—Ç—Ä–æ–≤–∫–∞\n01185|       params.append('take[gidro]', form.needLoading ? '1' : '0'); // –≥–∏–¥—Ä–æ–ª–∏—Ñ—Ç\n01186|       params.append('take[manip]', '0'); // –º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä\n01187|       params.append('take[speed]', '0'); // —Å—Ä–æ—á–Ω—ã–π –∑–∞–±–æ—Ä\n01188|       params.append('take[moscow]', '0'); // –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –ú–æ—Å–∫–≤–µ\n01189|       \n01190|       // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ—Å—Ç–∞–≤–∫–∏\n01191|       params.append('deliver[town]', toCityId.toString());\n01192|       params.append('deliver[tent]', '0');\n01193|       params.append('deliver[gidro]', form.needLoading ? '1' : '0');\n01194|       params.append('deliver[manip]', '0');\n01195|       params.append('deliver[speed]', '0');\n01196|       params.append('deliver[moscow]', '0');\n01197|       \n01198|       // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏\n01199|       params.append('plombir', '0'); // –ø–ª–æ–º–±—ã\n01200|       params.append('strah', form.needInsurance ? form.declaredValue.toString() : '0'); // —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞\n01201|       params.append('ashan', '0'); // –¥–æ—Å—Ç–∞–≤–∫–∞ –≤ –ê—à–∞–Ω\n01202|       params.append('night', '0'); // –Ω–æ—á–Ω–æ–µ –≤—Ä–µ–º—è\n01203|       params.append('pal', '0'); // –∑–∞–ø–∞–ª–ª–µ—á–∏–≤–∞–Ω–∏–µ\n01204|       params.append('pallets', '0'); // –ø–∞–ª–ª–µ—Ç–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞\n01205| \n01206|       const fullUrl = `${apiUrl}?${params.toString()}`;\n01207|       const requestData = Object.fromEntries(params);\n01208| \n01209|       console.log('–ü–≠–ö –∑–∞–ø—Ä–æ—Å URL:', fullUrl);\n01210|       console.log('–ü–≠–ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:', requestData);\n01211| \n01212|       // –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ API (–±–µ–∑ –ø—Ä–æ–∫—Å–∏, —Ç–∞–∫ –∫–∞–∫ HTTPS —Å–∞–π—Ç –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å HTTP –∑–∞–ø—Ä–æ—Å—ã)\n01213|       const response = await fetch(fullUrl);\n01214|       const data = await response.json();\n01215|       \n01216|       console.log('–ü–≠–ö –æ—Ç–≤–µ—Ç:', data);\n01217| \n01218|       if (response.ok && data.success) {\n01219|         let totalPrice = 0;\n01220|         let services: { name: string; description: string; price: number }[] = [];\n01221|         \n01222|         // –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏\n01223|         if (data.data?.totalCost) {\n01224|           totalPrice = data.data.totalCost;\n01225|           \n01226|           // –†–∞–∑–±–∏–≤–∫–∞ –ø–æ —É—Å–ª—É–≥–∞–º –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞\n01227|           if (data.data.services) {\n01228|             data.data.services.forEach((service: any) => {\n01229|               services.push({\n01230|                 name: service.name || '–£—Å–ª—É–≥–∞ –ü–≠–ö',\n01231|                 description: service.description || '',\n01232|                 price: service.cost || 0\n01233|               });\n01234|             });\n01235|           } else {\n01236|             // –û—Å–Ω–æ–≤–Ω–∞—è —É—Å–ª—É–≥–∞\n01237|             services.push({\n01238|               name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n01239|               description: `${form.fromCity} - ${form.toCity}`,\n01240|               price: totalPrice\n01241|             });\n01242|           }\n01243|         }\n01244|         \n01245|         // –ó–∞–±–æ—Ä –≥—Ä—É–∑–∞\n01246|         if (data.data?.pickupCost && form.fromAddressDelivery) {\n01247|           services.push({\n01248|             name: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n01249|             description: '–û—Ç –∞–¥—Ä–µ—Å–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è',\n01250|             price: data.data.pickupCost\n01251|           });\n01252|         }\n01253|         \n01254|         // –î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –∞–¥—Ä–µ—Å–∞\n01255|         if (data.data?.deliveryCost && form.toAddressDelivery) {\n01256|           services.push({\n01257|             name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n01258|             description: '–î–æ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è',\n01259|             price: data.data.deliveryCost\n01260|           });\n01261|         }\n01262| \n01263|         // –°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏\n01264|         const deliveryDays = data.data?.deliveryDays || 3;\n01265| \n01266|         return {\n01267|           company: '–ü–≠–ö',\n01268|           price: Math.round(totalPrice),\n01269|           days: deliveryDays,\n01270|           details: {\n01271|             services,\n01272|             totalCost: data.data?.totalCost,\n01273|             pickupCost: data.data?.pickupCost,\n01274|             deliveryCost: data.data?.deliveryCost,\n01275|             deliveryDays: data.data?.deliveryDays,\n01276|             fromCityId,\n01277|             toCityId,\n01278|             rawData: data.data\n01279|           },\n01280|           requestData,\n01281|           responseData: data,\n01282|           apiUrl\n01283|         };\n01284|       } else {\n01285|         // –§–æ–ª–ª–±—ç–∫ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–∞–≥–ª—É—à–∫—É –µ—Å–ª–∏ API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç\n01286|         const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n01287|         let basePrice = totalWeight * 15; // 15 —Ä—É–± –∑–∞ –∫–≥ –±–∞–∑–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞\n01288|         \n01289|         if (form.fromAddressDelivery) basePrice += 500; // –∑–∞–±–æ—Ä\n01290|         if (form.toAddressDelivery) basePrice += 500; // –¥–æ—Å—Ç–∞–≤–∫–∞\n01291|         if (form.needInsurance) basePrice += form.declaredValue * 0.01; // —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞\n01292|         if (form.needPackaging) basePrice += totalWeight * 20; // —É–ø–∞–∫–æ–≤–∫–∞\n01293|         \n01294|         return {\n01295|           company: '–ü–≠–ö',\n01296|           price: Math.round(basePrice),\n01297|           days: 3,\n01298|           details: {\n01299|             note: '–†–∞—Å—á–µ—Ç –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º (API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)',\n01300|             fromCityId,\n01301|             toCityId,\n01302|             services: [\n01303|               { name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞', description: `${form.fromCity} - ${form.toCity}`, price: basePrice }\n01304|             ]\n01305|           },\n01306|           requestData,\n01307|           responseData: data,\n01308|           apiUrl,\n01309|           error: data.message || data.error || 'API –ü–≠–ö –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–∫–∞–∑–∞–Ω –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç'\n01310|         };\n01311|       }\n01312|     } catch (error: any) {\n01313|       // –§–æ–ª–ª–±—ç–∫ —Ä–∞—Å—á–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n01314|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n01315|       let basePrice = totalWeight * 15; // 15 —Ä—É–± –∑–∞ –∫–≥\n01316|       \n01317|       if (form.fromAddressDelivery) basePrice += 500;\n01318|       if (form.toAddressDelivery) basePrice += 500; \n01319|       if (form.needInsurance) basePrice += form.declaredValue * 0.01;\n01320|       if (form.needPackaging) basePrice += totalWeight * 20;\n01321|       \n01322|       return {\n01323|         company: '–ü–≠–ö',\n01324|         price: Math.round(basePrice),\n01325|         days: 3,\n01326|         details: {\n01327|           note: '–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –±–∞–∑–æ–≤—ã–º —Ç–∞—Ä–∏—Ñ–∞–º (–æ—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å API)',\n01328|           services: [\n01329|             { name: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞', description: `${form.fromCity} - ${form.toCity}`, price: basePrice }\n01330|           ]\n01331|         },\n01332|         requestData: null,\n01333|         responseData: null,\n01334|         apiUrl,\n01335|         error: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}. –ü–æ–∫–∞–∑–∞–Ω –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç.`\n01336|       };\n01337|     }\n01338|   };\n01339| \n01340|   const calculateRailContinent = async (): Promise<CalculationResult> => {\n01341|     await new Promise(resolve => setTimeout(resolve, 1200));\n01342|     const basePrice = form.cargos.reduce((sum, cargo) => sum + cargo.weight * 12, 0);\n01343|     let totalPrice = basePrice;\n01344|     \n01345|     if (form.needInsurance) totalPrice += form.declaredValue * 0.025;\n01346|     if (form.needPackaging) totalPrice += basePrice * 0.08;\n01347|     \n01348|     return {\n01349|       company: 'Rail Continent',\n01350|       price: totalPrice,\n01351|       days: 5,\n01352|       apiUrl: 'https://www.railcontinent.ru/services/prochie-gruzoperevozki/forshop/api-manual/',\n01353|       details: { note: '–ó–∞–≥–ª—É—à–∫–∞ - API –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω' }\n01354|     };\n01355|   };\n01356| \n01357|   const handleCalculate = async () => {\n01358|     setCalculating(true);\n01359|     setCalculations([]);\n01360|     \n01361|     // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø–æ—Å–ª–µ —Ä–∞—Å—á–µ—Ç–∞\n01362|     localStorage.setItem('deliveryForm', JSON.stringify(form));\n01363|     \n01364|     try {\n01365|       const results = await Promise.all([\n01366|         calculateDellin(),\n01367|         calculatePEK(),\n01368|         calculateNordWheel(),\n01369|         calculateRailContinent()\n01370|       ]);\n01371|       \n01372|       // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ü–µ–Ω–µ\n01373|       const sortedResults = results\n01374|         .filter(result => !result.error)\n01375|         .sort((a, b) => a.price - b.price)\n01376|         .concat(results.filter(result => result.error));\n01377|       \n01378|       setCalculations(sortedResults);\n01379|     } catch (error) {\n01380|       console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ:', error);\n01381|     } finally {\n01382|       setCalculating(false);\n01383|     }\n01384|   };\n01385| \n01386|   const exportToPDF = () => {\n01387|     if (typeof window !== 'undefined') {\n01388|       window.print();\n01389|     }\n01390|   };\n01391| \n01392|   const toggleDetails = (company: string) => {\n01393|     setExpandedDetails(prev => ({\n01394|       ...prev,\n01395|       [company]: !prev[company]\n01396|     }));\n01397|   };\n01398| \n01399|   const toggleDebugInfo = (company: string) => {\n01400|     setExpandedDebugInfo(prev => ({\n01401|       ...prev,\n01402|       [company]: !prev[company]\n01403|     }));\n01404|   };\n01405| \n01406|   // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞—Å—á–µ—Ç–∞\n01407|   const handleReset = () => {\n01408|     if (typeof window !== 'undefined') {\n01409|       // –û—á–∏—â–∞–µ–º localStorage\n01410|       localStorage.removeItem('deliveryForm');\n01411|       \n01412|       // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É\n01413|       setForm(initialFormState);\n01414|       \n01415|       // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è\n01416|       setCalculations([]);\n01417|       setExpandedDetails({});\n01418|       setExpandedDebugInfo({});\n01419|       setSuggestions([]);\n01420|       setShowSuggestions(false);\n01421|       setActiveField('');\n01422|       \n01423|       console.log('–§–æ—Ä–º–∞ —Å–±—Ä–æ—à–µ–Ω–∞ –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é');\n01424|     }\n01425|   };\n01426| \n01427|   // –ü–∞—Ä—Å–µ—Ä –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è —á–∏—Ç–∞–µ–º–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞\n01428|   const parseCalculationDetails = (calc: CalculationResult) => {\n01429|     const details: { service: string; description: string; price: number }[] = [];\n01430|     \n01431|     if (calc.company === '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏' && calc.details) {\n01432|       // –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ (—É–∂–µ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –±–∞–∑–æ–≤—ã–µ —É—Å–ª—É–≥–∏ –∏ —É–ø–∞–∫–æ–≤–∫—É)\n01433|       let basePrice = calc.details.price || calc.price || 0;\n01434|       \n01435|       // –†–∞–∑–±–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ\n01436|       let intercityPrice = 0;\n01437|       let derivalPrice = 0;\n01438|       let arrivalPrice = 0;\n01439|       let packagingPrice = 0;\n01440|       // packagingPremiums –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è - –Ω–∞–¥–±–∞–≤–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ pkg.price\n01441|       let insurancePrice = 0;\n01442|       \n01443|       // –ú–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞\n01444|       if (calc.details.intercity?.price) {\n01445|         intercityPrice = calc.details.intercity.price;\n01446|         details.push({\n01447|           service: '–ú–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞',\n01448|           description: `${form.fromCity} - ${form.toCity}`,\n01449|           price: intercityPrice\n01450|         });\n01451|       }\n01452|       \n01453|       // –ó–∞–±–æ—Ä –≥—Ä—É–∑–∞\n01454|       if (calc.details.derival?.price) {\n01455|         derivalPrice = calc.details.derival.price;\n01456|         details.push({\n01457|           service: '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞',\n01458|           description: '–û—Ç –∞–¥—Ä–µ—Å–∞',\n01459|           price: derivalPrice\n01460|         });\n01461|       }\n01462|       \n01463|       // –î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞\n01464|       if (calc.details.arrival?.price) {\n01465|         arrivalPrice = calc.details.arrival.price;\n01466|         details.push({\n01467|           service: '–û—Ç–≤–æ–∑ –≥—Ä—É–∑–∞',\n01468|           description: '–î–æ –∞–¥—Ä–µ—Å–∞',\n01469|           price: arrivalPrice\n01470|         });\n01471|       }\n01472|       \n01473|       // –£–ø–∞–∫–æ–≤–∫–∞ (–Ω–∞–¥–±–∞–≤–∫–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ pkg.price, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏)\n01474|       if (form.needPackaging && calc.details.packages) {\n01475|         Object.entries(calc.details.packages).forEach(([key, pkg]: [string, any]) => {\n01476|           if (pkg.price && pkg.price > 0) {\n01477|             // –í—ã—á–∏—Å–ª—è–µ–º –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É —É–ø–∞–∫–æ–≤–∫–∏ (–±–µ–∑ –Ω–∞–¥–±–∞–≤–æ–∫) –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n01478|             let basePkgPrice = pkg.price;\n01479|             let totalPremiums = 0;\n01480|             \n01481|             if (pkg.premiumDetails && Array.isArray(pkg.premiumDetails)) {\n01482|               totalPremiums = pkg.premiumDetails.reduce((sum: number, premium: any) => \n01483|                 sum + (premium.value || 0), 0);\n01484|               basePkgPrice = pkg.price - totalPremiums;\n01485|             }\n01486|             \n01487|             packagingPrice += pkg.price; // –í –æ–±—â—É—é —Å—É–º–º—É –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–Ω—É—é —Ü–µ–Ω—É\n01488|             \n01489|             // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—É—é —É–ø–∞–∫–æ–≤–∫—É\n01490|             details.push({\n01491|               service: '–£–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞',\n01492|               description: '–£–ø–∞–∫–æ–≤–∞—Ç—å –≤ –∫–æ–º–ø–ª–µ–∫—Å ¬´–æ–±—Ä–µ—à—ë—Ç–∫–∞ + –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è¬ª',\n01493|               price: basePkgPrice\n01494|             });\n01495|             \n01496|             // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–¥–±–∞–≤–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ (–¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏, –Ω–æ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –∫ –æ–±—â–µ–π —Å—É–º–º–µ)\n01497|             if (pkg.premiumDetails && Array.isArray(pkg.premiumDetails)) {\n01498|               pkg.premiumDetails.forEach((premium: any) => {\n01499|                 if (premium.value && premium.value > 0) {\n01500|                   details.push({\n01501|                     service: '–ù–∞–¥–±–∞–≤–∫–∞ –∫ —É–ø–∞–∫–æ–≤–∫–µ',\n01502|                     description: premium.name || '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–¥–±–∞–≤–∫–∞',\n01503|                     price: premium.value\n01504|                   });\n01505|                 }\n01506|               });\n01507|             }\n01508|           }\n01509|         });\n01510|       }\n01511|       \n01512|       // –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ\n01513|       if (form.needInsurance && calc.details.insurance) {\n01514|         insurancePrice = calc.details.insurance;\n01515|         details.push({\n01516|           service: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞',\n01517|           description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n01518|           price: insurancePrice\n01519|         });\n01520|       }\n01521|       \n01522|       // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏\n01523|       details.push({\n01524|         service: '–î–æ–ø.—É—Å–ª—É–≥–∏',\n01525|         description: '–ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ –≥—Ä—É–∑–∞',\n01526|         price: 15\n01527|       });\n01528|       \n01529|       // –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –º–µ–∂–¥—É —Å—É–º–º–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é, –¥–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞—Ç–æ–∫\n01530|       const calculatedSum = intercityPrice + derivalPrice + arrivalPrice + packagingPrice + insurancePrice + 15;\n01531|       const remainder = basePrice - calculatedSum;\n01532|       \n01533|       if (Math.abs(remainder) > 1) { // –ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –±–æ–ª—å—à–µ 1 —Ä—É–±–ª—è\n01534|         details.push({\n01535|           service: remainder > 0 ? '–ü—Ä–æ—á–∏–µ —É—Å–ª—É–≥–∏' : '–°–∫–∏–¥–∫–∞',\n01536|           description: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–±–æ—Ä—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏',\n01537|           price: remainder\n01538|         });\n01539|       }\n01540|     } else if (calc.company === 'Nord Wheel' && calc.details) {\n01541|       // –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –¥–ª—è Nord Wheel —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º\n01542|       if (calc.details.totalCost) {\n01543|         details.push({\n01544|           service: '–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',\n01545|           description: '',\n01546|           price: calc.details.totalCost\n01547|         });\n01548|       }\n01549|       if (calc.details.deliveryCost) {\n01550|         details.push({\n01551|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–∑–∫–∏',\n01552|           description: '',\n01553|           price: calc.details.deliveryCost\n01554|         });\n01555|       }\n01556|       if (calc.details.terminalCost) {\n01557|         details.push({\n01558|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –º–µ–∂—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–≤–æ–∑–∫–∏',\n01559|           description: '',\n01560|           price: calc.details.terminalCost\n01561|         });\n01562|       }\n01563|       if (calc.details.pickupCost) {\n01564|         details.push({\n01565|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–±–æ—Ä–∞',\n01566|           description: '',\n01567|           price: calc.details.pickupCost\n01568|         });\n01569|       }\n01570|       if (calc.details.deliveryToDoorCost) {\n01571|         details.push({\n01572|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–æ –¥–≤–µ—Ä–∏',\n01573|           description: '',\n01574|           price: calc.details.deliveryToDoorCost\n01575|         });\n01576|       }\n01577|       if (calc.details.additionalServices && calc.details.additionalServices > 0) {\n01578|         details.push({\n01579|           service: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ–ø.—É—Å–ª—É–≥',\n01580|           description: '',\n01581|           price: calc.details.additionalServices\n01582|         });\n01583|       }\n01584| \n01585|     } else if (calc.company === '–ü–≠–ö' && calc.details?.services) {\n01586|       // –î–ª—è –ü–≠–ö –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ API\n01587|       calc.details.services.forEach((service: any) => {\n01588|         if (service.price > 0) {\n01589|           details.push({\n01590|             service: service.name || '–£—Å–ª—É–≥–∞ –ü–≠–ö',\n01591|             description: service.description || '',\n01592|             price: service.price\n01593|           });\n01594|         }\n01595|       });\n01596|     } else {\n01597|       // –î–ª—è –¥—Ä—É–≥–∏—Ö –¢–ö - –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n01598|       details.push({\n01599|         service: '–î–æ—Å—Ç–∞–≤–∫–∞ –≥—Ä—É–∑–∞',\n01600|         description: `${form.fromCity} - ${form.toCity}`,\n01601|         price: calc.price\n01602|       });\n01603|       \n01604|       if (form.needInsurance && form.declaredValue > 0) {\n01605|         details.push({\n01606|           service: '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ',\n01607|           description: `–ù–∞ —Å—É–º–º—É ${form.declaredValue.toLocaleString()} ‚ÇΩ`,\n01608|           price: Math.round(form.declaredValue * 0.02)\n01609|         });\n01610|       }\n01611|       \n01612|       if (form.needPackaging) {\n01613|         const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n01614|         details.push({\n01615|           service: '–£–ø–∞–∫–æ–≤–∫–∞',\n01616|           description: '',\n01617|           price: Math.round(totalWeight * 30)\n01618|         });\n01619|       }\n01620|     }\n01621|     \n01622|     return details;\n01623|   };\n01624| \n01625|   return (\n01626|     <div className=\"min-h-screen bg-gray-900 text-white p-4 relative\">\n01627|       <div className=\"max-w-7xl mx-auto\">\n01628|         <h1 className=\"text-2xl font-bold text-center mb-6 text-blue-400\">\n01629|           –ú–µ–∂–¥—É–≥–æ—Ä–æ–¥–Ω—è—è –¥–æ—Å—Ç–∞–≤–∫–∞ –õ–∞–≤—Å–∏—Ç\n01630|         </h1>\n01631|         \n01632|         <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4 h-[90vh]\">\n01633|           {/* –õ–µ–≤–∞—è —á–∞—Å—Ç—å - —Ñ–æ—Ä–º–∞ */}\n01634|           <div className=\"space-y-3 overflow-y-auto pr-2\">\n01635|             {/* –ì—Ä—É–∑—ã */}\n01636|             <Card className=\"bg-gray-800 border-gray-700\">\n01637|               <CardHeader className=\"pb-3\">\n01638|                 <CardTitle className=\"text-white flex items-center gap-2 text-lg\">\n01639|                   <Truck className=\"h-4 w-4\" />\n01640|                   –ì—Ä—É–∑—ã\n01641|                 </CardTitle>\n01642|               </CardHeader>\n01643|               <CardContent className=\"space-y-3\">\n01644|                 {form.cargos.map((cargo, index) => (\n01645|                   <div key={cargo.id} className=\"border border-gray-600 rounded p-3\">\n01646|                     <div className=\"flex justify-between items-center mb-2\">\n01647|                       <h4 className=\"text-sm font-medium text-white\">–ì—Ä—É–∑ ‚Ññ{index + 1}</h4>\n01648|                       {form.cargos.length > 1 && (\n01649|                         <Button\n01650|                           variant=\"destructive\"\n01651|                           size=\"sm\"\n01652|                           onClick={() => removeCargo(cargo.id)}\n01653|                           className=\"h-6 text-xs\"\n01654|                         >\n01655|                           –£–¥–∞–ª–∏—Ç—å\n01656|                         </Button>\n01657|                       )}\n01658|                     </div>\n01659|                     <div className=\"grid grid-cols-2 gap-2\">\n01660|                       <div>\n01661|                         <Label className=\"text-white text-xs\">–î–ª–∏–Ω–∞ (—Å–º)</Label>\n01662|                         <Input\n01663|                           type=\"number\"\n01664|                           value={cargo.length || ''}\n01665|                           onChange={(e) => updateCargo(cargo.id, 'length', Number(e.target.value))}\n01666|                           className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n01667|                         />\n01668|                       </div>\n01669|                       <div>\n01670|                         <Label className=\"text-white text-xs\">–®–∏—Ä–∏–Ω–∞ (—Å–º)</Label>\n01671|                         <Input\n01672|                           type=\"number\"\n01673|                           value={cargo.width || ''}\n01674|                           onChange={(e) => updateCargo(cargo.id, 'width', Number(e.target.value))}\n01675|                           className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n01676|                         />\n01677|                       </div>\n01678|                       <div>\n01679|                         <Label className=\"text-white text-xs\">–í—ã—Å–æ—Ç–∞ (—Å–º)</Label>\n01680|                         <Input\n01681|                           type=\"number\"\n01682|                           value={cargo.height || ''}\n01683|                           onChange={(e) => updateCargo(cargo.id, 'height', Number(e.target.value))}\n01684|                           className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n01685|                         />\n01686|                       </div>\n01687|                       <div>\n01688|                         <Label className=\"text-white text-xs\">–í–µ—Å (–∫–≥)</Label>\n01689|                         <Input\n01690|                           type=\"number\"\n01691|                           value={cargo.weight || ''}\n01692|                           onChange={(e) => updateCargo(cargo.id, 'weight', Number(e.target.value))}\n01693|                           className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n01694|                         />\n01695|                       </div>\n01696|                     </div>\n01697|                   </div>\n01698|                 ))}\n01699|                 <Button onClick={addCargo} className=\"w-full h-8\" variant=\"outline\">\n01700|                   <Plus className=\"h-3 w-3 mr-1\" />\n01701|                   –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–∑\n01702|                 </Button>\n01703|               </CardContent>\n01704|             </Card>\n01705| \n01706|             {/* –ú–∞—Ä—à—Ä—É—Ç */}\n01707|             <Card className=\"bg-gray-800 border-gray-700\">\n01708|               <CardHeader className=\"pb-3\">\n01709|                 <CardTitle className=\"text-white flex items-center gap-2 text-lg\">\n01710|                   <Map className=\"h-4 w-4\" />\n01711|                   –ú–∞—Ä—à—Ä—É—Ç\n01712|                 </CardTitle>\n01713|               </CardHeader>\n01714|               <CardContent className=\"space-y-3\">\n01715|                 {/* –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */}\n01716|                 <div className=\"space-y-2\">\n01717|                   <Label className=\"text-sm font-medium text-white\">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</Label>\n01718|                   <div className=\"flex gap-3\">\n01719|                     <label className=\"flex items-center space-x-1\">\n01720|                       <input\n01721|                         type=\"radio\"\n01722|                         name=\"fromDelivery\"\n01723|                         checked={form.fromTerminal}\n01724|                         onChange={() => setForm(prev => ({ ...prev, fromTerminal: true, fromAddressDelivery: false }))}\n01725|                       />\n01726|                       <span className=\"text-white text-xs\">–û—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞</span>\n01727|                     </label>\n01728|                     <label className=\"flex items-center space-x-1\">\n01729|                       <input\n01730|                         type=\"radio\"\n01731|                         name=\"fromDelivery\"\n01732|                         checked={form.fromAddressDelivery}\n01733|                         onChange={() => setForm(prev => ({ ...prev, fromTerminal: false, fromAddressDelivery: true }))}\n01734|                       />\n01735|                       <span className=\"text-white text-xs\">–û—Ç –∞–¥—Ä–µ—Å–∞</span>\n01736|                     </label>\n01737|                   </div>\n01738|                   \n01739|                   <div>\n01740|                     <Label className=\"text-white text-xs\">–ì–æ—Ä–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</Label>\n01741|                     <Input\n01742|                       value={form.fromCity}\n01743|                       onChange={(e) => handleAddressChange('fromCity', e.target.value, e.target)}\n01744|                       placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –≥–æ—Ä–æ–¥\"\n01745|                       className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n01746|                     />\n01747|                   </div>\n01748|                   \n01749|                   {form.fromAddressDelivery && (\n01750|                     <div>\n01751|                       <Label className=\"text-white text-xs\">–ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</Label>\n01752|                       <Input\n01753|                         value={form.fromAddress}\n01754|                         onChange={(e) => handleAddressChange('fromAddress', e.target.value, e.target)}\n01755|                         placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å\"\n01756|                         className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n01757|                       />\n01758|                     </div>\n01759|                   )}\n01760|                 </div>\n01761| \n01762|                 <Separator className=\"bg-gray-600\" />\n01763| \n01764|                 {/* –î–æ—Å—Ç–∞–≤–∫–∞ */}\n01765|                 <div className=\"space-y-2\">\n01766|                   <Label className=\"text-sm font-medium text-white\">–î–æ—Å—Ç–∞–≤–∫–∞</Label>\n01767|                   <div className=\"flex gap-3\">\n01768|                     <label className=\"flex items-center space-x-1\">\n01769|                       <input\n01770|                         type=\"radio\"\n01771|                         name=\"toDelivery\"\n01772|                         checked={form.toTerminal}\n01773|                         onChange={() => setForm(prev => ({ ...prev, toTerminal: true, toAddressDelivery: false }))}\n01774|                       />\n01775|                       <span className=\"text-white text-xs\">–î–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞</span>\n01776|                     </label>\n01777|                     <label className=\"flex items-center space-x-1\">\n01778|                       <input\n01779|                         type=\"radio\"\n01780|                         name=\"toDelivery\"\n01781|                         checked={form.toAddressDelivery}\n01782|                         onChange={() => setForm(prev => ({ ...prev, toTerminal: false, toAddressDelivery: true }))}\n01783|                       />\n01784|                       <span className=\"text-white text-xs\">–î–æ –∞–¥—Ä–µ—Å–∞</span>\n01785|                     </label>\n01786|                   </div>\n01787|                   \n01788|                   <div>\n01789|                     <Label className=\"text-white text-xs\">–ì–æ—Ä–æ–¥ –¥–æ—Å—Ç–∞–≤–∫–∏</Label>\n01790|                     <Input\n01791|                       value={form.toCity}\n01792|                       onChange={(e) => handleAddressChange('toCity', e.target.value, e.target)}\n01793|                       placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –≥–æ—Ä–æ–¥\"\n01794|                       className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n01795|                     />\n01796|                   </div>\n01797|                   \n01798|                   {form.toAddressDelivery && (\n01799|                     <div>\n01800|                       <Label className=\"text-white text-xs\">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</Label>\n01801|                       <Input\n01802|                         value={form.toAddress}\n01803|                         onChange={(e) => handleAddressChange('toAddress', e.target.value, e.target)}\n01804|                         placeholder=\"–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å\"\n01805|                         className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n01806|                       />\n01807|                     </div>\n01808|                   )}\n01809|                 </div>\n01810|               </CardContent>\n01811|             </Card>\n01812| \n01813|             {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}\n01814|             <Card className=\"bg-gray-800 border-gray-700\">\n01815|               <CardHeader className=\"pb-3\">\n01816|                 <CardTitle className=\"text-white text-lg\">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏</CardTitle>\n01817|               </CardHeader>\n01818|               <CardContent className=\"space-y-3\">\n01819|                 <div>\n01820|                   <Label className=\"text-white text-xs\">–û–±—ä—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (—Ä—É–±.)</Label>\n01821|                   <Input\n01822|                     type=\"number\"\n01823|                     value={form.declaredValue || ''}\n01824|                     onChange={(e) => setForm(prev => ({ ...prev, declaredValue: Number(e.target.value) }))}\n01825|                     className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n01826|                   />\n01827|                 </div>\n01828|                 \n01829|                 <div className=\"space-y-2\">\n01830|                   <div className=\"flex items-center space-x-2\">\n01831|                     <Checkbox\n01832|                       id=\"packaging\"\n01833|                       checked={form.needPackaging}\n01834|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needPackaging: checked as boolean }))}\n01835|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n01836|                     />\n01837|                     <Label htmlFor=\"packaging\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è —É–ø–∞–∫–æ–≤–∫–∞</Label>\n01838|                   </div>\n01839|                   \n01840|                   <div className=\"flex items-center space-x-2\">\n01841|                     <Checkbox\n01842|                       id=\"insurance\"\n01843|                       checked={form.needInsurance}\n01844|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needInsurance: checked as boolean }))}\n01845|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n01846|                     />\n01847|                     <Label htmlFor=\"insurance\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞</Label>\n01848|                   </div>\n01849|                   \n01850|                   <div className=\"flex items-center space-x-2\">\n01851|                     <Checkbox\n01852|                       id=\"loading\"\n01853|                       checked={form.needLoading}\n01854|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needLoading: checked as boolean }))}\n01855|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n01856|                     />\n01857|                     <Label htmlFor=\"loading\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≥—Ä—É–∑–∫–∞/—Ä–∞–∑–≥—Ä—É–∑–∫–∞</Label>\n01858|                   </div>\n01859|                   \n01860|                   <div className=\"flex items-center space-x-2\">\n01861|                     <Checkbox\n01862|                       id=\"carry\"\n01863|                       checked={form.needCarry}\n01864|                       onCheckedChange={(checked) => setForm(prev => ({ ...prev, needCarry: checked as boolean }))}\n01865|                       className=\"border-white data-[state=checked]:bg-white data-[state=checked]:text-black\"\n01866|                     />\n01867|                     <Label htmlFor=\"carry\" className=\"text-white text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—ä–µ–º</Label>\n01868|                   </div>\n01869|                   \n01870|                   {form.needCarry && (\n01871|                     <div className=\"ml-6 space-y-2 border-l-2 border-gray-600 pl-3\">\n01872|                       <div>\n01873|                         <Label className=\"text-white text-xs\">–≠—Ç–∞–∂</Label>\n01874|                         <Input\n01875|                           type=\"number\"\n01876|                           value={form.floor}\n01877|                           onChange={(e) => setForm(prev => ({ ...prev, floor: Number(e.target.value) }))}\n01878|                           className=\"bg-gray-700 border-gray-600 h-8 text-white\"\n01879|                         />\n01880|                       </div>\n01881|                       <div className=\"flex items-center space-x-2\">\n01882|                         <Checkbox\n01883|                           id=\"freightLift\"\n01884|                           checked={form.hasFreightLift}\n01885|                           onCheckedChange={(checked) => setForm(prev => ({ ...prev, hasFreightLift: checked as boolean }))}\n01886|                         />\n01887|                         <Label htmlFor=\"freightLift\" className=\"text-white text-xs\">–ù–∞–ª–∏—á–∏–µ –≥—Ä—É–∑–æ–≤–æ–≥–æ –ª–∏—Ñ—Ç–∞</Label>\n01888|                       </div>\n01889|                     </div>\n01890|                   )}\n01891|                 </div>\n01892|                 \n01893|                 <div className=\"space-y-2\">\n01894|                   <Button \n01895|                     onClick={handleCalculate} \n01896|                     className=\"w-full bg-blue-600 hover:bg-blue-700 h-8\" \n01897|                     disabled={calculating}\n01898|                   >\n01899|                     {calculating ? '–†–∞—Å—á–µ—Ç...' : '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å'}\n01900|                   </Button>\n01901|                   \n01902|                   <Button \n01903|                     onClick={handleReset} \n01904|                     variant=\"outline\" \n01905|                     className=\"w-full h-8 text-black border-gray-600 hover:bg-gray-700 hover:text-white\" \n01906|                     disabled={calculating}\n01907|                   >\n01908|                     –°–±—Ä–æ—Å–∏—Ç—å —Ä–∞—Å—á–µ—Ç\n01909|                   </Button>\n01910|                 </div>\n01911|               </CardContent>\n01912|             </Card>\n01913|           </div>\n01914| \n01915|           {/* –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã */}\n01916|           <div className=\"space-y-3 overflow-y-auto\">\n01917|             {calculations.length > 0 && (\n01918|               <div className=\"space-y-3\">\n01919|                 <div className=\"flex justify-between items-center\">\n01920|                   <h2 className=\"text-xl font-bold text-blue-400\">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞</h2>\n01921|                   <Button onClick={exportToPDF} variant=\"outline\" size=\"sm\" className=\"h-7 text-xs\">\n01922|                     –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ PDF\n01923|                   </Button>\n01924|                 </div>\n01925|                 \n01926|                 {calculations.map((calc, index) => (\n01927|                   <Card key={index} className=\"bg-gray-800 border-gray-700\">\n01928|                     <CardHeader className=\"pb-2\">\n01929|                       <div className=\"flex justify-between items-center\">\n01930|                         <CardTitle className=\"text-white flex items-center gap-2 text-sm\">\n01931|                           <Building2 className=\"h-4 w-4\" />\n01932|                           {calc.company}\n01933|                         </CardTitle>\n01934|                         {calc.error ? (\n01935|                           <Badge variant=\"destructive\" className=\"text-xs\">–û—à–∏–±–∫–∞</Badge>\n01936|                         ) : (\n01937|                           <Badge variant=\"default\" className=\"bg-green-600 text-xs\">\n01938|                             {calc.price.toLocaleString()} ‚ÇΩ\n01939|                           </Badge>\n01940|                         )}\n01941|                       </div>\n01942|                     </CardHeader>\n01943|                     <CardContent className=\"pt-0\">\n01944|                       <div className=\"space-y-2\">\n01945|                         {calc.error ? (\n01946|                           <div className=\"space-y-2\">\n01947|                             <Alert className=\"border-red-600\">\n01948|                               <AlertDescription className=\"text-white text-xs\">{calc.error}</AlertDescription>\n01949|                             </Alert>\n01950|                             {calc.price > 0 && (\n01951|                               <>\n01952|                                 <p className=\"text-white text-xs\"><strong>–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {calc.price.toLocaleString()} ‚ÇΩ</p>\n01953|                                 <p className=\"text-white text-xs\"><strong>–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Å—Ä–æ–∫:</strong> {calc.days} –¥–Ω–µ–π</p>\n01954|                               </>\n01955|                             )}\n01956|                           </div>\n01957|                         ) : (\n01958|                           <>\n01959|                             <p className=\"text-white text-xs\"><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {calc.price.toLocaleString()} ‚ÇΩ</p>\n01960|                             <p className=\"text-white text-xs\"><strong>–°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> {calc.days} –¥–Ω–µ–π</p>\n01961|                           </>\n01962|                         )}\n01963|                         \n01964|                         <div className=\"flex gap-2 mt-2\">\n01965|                           {!calc.error && (\n01966|                             <Button\n01967|                               variant=\"outline\"\n01968|                               size=\"sm\"\n01969|                               onClick={() => toggleDetails(calc.company)}\n01970|                               className=\"h-6 text-xs\"\n01971|                             >\n01972|                               {expandedDetails[calc.company] ? '–°–∫—Ä—ã—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ' : '–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ'}\n01973|                             </Button>\n01974|                           )}\n01975|                           <Button\n01976|                             variant=\"outline\"\n01977|                             size=\"sm\"\n01978|                             onClick={() => toggleDebugInfo(calc.company)}\n01979|                             className=\"h-6 text-xs\"\n01980|                           >\n01981|                             {expandedDebugInfo[calc.company] ? '–°–∫—Ä—ã—Ç—å –æ—Ç–ª–∞–¥–∫—É' : '–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'}\n01982|                           </Button>\n01983|                         </div>\n01984|                         \n01985|                         {/* –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ */}\n01986|                         {!calc.error && (\n01987|                           <Collapsible open={expandedDetails[calc.company]}>\n01988|                             <CollapsibleContent className=\"mt-2\">\n01989|                               <div className=\"bg-gray-900 p-3 rounded text-xs\">\n01990|                                 <h4 className=\"font-bold mb-2 text-white\">–î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞:</h4>\n01991|                                 {(() => {\n01992|                                   const details = parseCalculationDetails(calc);\n01993|                                   const totalPrice = details.reduce((sum, detail) => sum + detail.price, 0);\n01994|                                   \n01995|                                   return (\n01996|                                     <div className=\"space-y-1\">\n01997|                                       {details.map((detail, idx) => (\n01998|                                         <div key={idx} className=\"flex justify-between text-white\">\n01999|                                           <div>\n02000|                                             <div className=\"font-medium\">{detail.service}</div>\n\n(File has more lines. Use 'offset' parameter to read beyond line 2000)\n</file>",
    "metadata": {
      "preview": "'use client';\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Plus, Truck, Building2, Map } from 'lucide-react';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { Collapsible, CollapsibleContent } from '@/components/ui/collapsible';\n\ninterface Cargo {\n  id: string;\n  length: number;\n  width: number;\n  height: number;\n  weight: number;"
    },
    "title": "app/page.tsx",
    "time": {
      "start": 1758903089994,
      "end": 1758903090000
    }
  }
}