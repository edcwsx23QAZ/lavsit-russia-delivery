{
  "id": "prt_ab86a7e970016VvzhfaS3LCQy5",
  "sessionID": "ses_54b97e247ffenCZZa4jZiIWD0l",
  "messageID": "msg_ab86a7339001MkZGoB8BKQ3hPZ",
  "type": "tool",
  "callID": "call_00254044",
  "tool": "read",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "app/page.tsx"
    },
    "output": "<file>\n00001| 'use client';\n00002| \n00003| import React, { useState, useEffect, useCallback, useMemo } from 'react';\n00004| import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\n00005| import { Button } from '@/components/ui/button';\n00006| import { Input } from '@/components/ui/input';\n00007| import { Label } from '@/components/ui/label';\n00008| import { Checkbox } from '@/components/ui/checkbox';\n00009| import { Switch } from '@/components/ui/switch';\n00010| import { Plus, Truck, Building2, Map, Settings, Package2, Trash2 } from 'lucide-react';\n00011| import { Alert, AlertDescription } from '@/components/ui/alert';\n00012| import { Badge } from '@/components/ui/badge';\n00013| import { Separator } from '@/components/ui/separator';\n00014| import { Collapsible, CollapsibleContent } from '@/components/ui/collapsible';\n00015| import { LazyProductSearch, LazyTruckVisualization } from '@/components/LazyLoadedComponents';\n00016| import ProductManager from '@/components/ProductManager';\n00017| import CalculationProgress from '@/components/CalculationProgress';\n00018| import { FurnitureProduct, ProductInForm, CargoWithMetadata } from '@/lib/furniture-types';\n00019| import { saveFormData, loadFormData, hasStoredFormData, createDebouncedSaver, clearFormData } from '@/lib/form-storage';\n00020| import {\n00021|   createCargosForProduct,\n00022|   removeCargosForProduct,\n00023|   calculateTotalValue,\n00024|   findCargoIndexesForProduct\n00025| } from '@/lib/furniture-utils';\n00026| import { enhancedApiRequest } from '@/lib/api-utils';\n00027| import { cacheManager } from '@/lib/cache-manager';\n00028| import { optimizedApiClient } from '@/lib/optimized-api-client';\n00029| \n00030| interface Cargo {\n00031|   id: string;\n00032|   length: number;\n00033|   width: number;\n00034|   height: number;\n00035|   weight: number;\n00036|   // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–≤—è–∑–∏ —Å —Ç–æ–≤–∞—Ä–∞–º–∏\n00037|   productId?: string;\n00038|   placeNumber?: number;\n00039|   isFromProduct?: boolean;\n00040|   addedAt?: number;\n00041| }\n00042| \n00043| interface DeliveryForm {\n00044|   cargos: Cargo[];\n00045|   fromCity: string;\n00046|   toCity: string;\n00047|   fromAddress: string;\n00048|   toAddress: string;\n00049|   declaredValue: number;\n00050|   needPackaging: boolean;\n00051|   needLoading: boolean;\n00052|   needCarry: boolean;\n00053|   floor: number;\n00054|   hasFreightLift: boolean;\n00055|   needInsurance: boolean;\n00056|   fromTerminal: boolean;\n00057|   toTerminal: boolean;\n00058|   fromAddressDelivery: boolean;\n00059|   toAddressDelivery: boolean;\n00060|   fromLavsiteWarehouse: boolean;\n00061|   // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ç–æ–≤–∞—Ä–æ–≤\n00062|   selectedProducts: ProductInForm[];\n00063| }\n00064| \n00065| interface CalculationResult {\n00066|   company: string;\n00067|   price: number;\n00068|   days: number;\n00069|   details?: any;\n00070|   error?: string;\n00071|   requestData?: any;\n00072|   responseData?: any;\n00073|   apiUrl?: string;\n00074|   sessionId?: string;\n00075| }\n00076| \n00077| interface AddressSuggestion {\n00078|   value: string;\n00079|   unrestricted_value: string;\n00080|   data: {\n00081|     city?: string;\n00082|     street?: string;\n00083|     house?: string;\n00084|   };\n00085| }\n00086| \n00087| // –û–ø—Ä–µ–¥–µ–ª–∏–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–º–ø–∞–Ω–∏–π\n00088| const COMPANIES_BASE = [\n00089|   { name: '–ü–≠–ö', logo: 'üöõ', apiKey: 'pek' },\n00090|   { name: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏', logo: 'üì¶', apiKey: 'dellin' },\n00091|   { name: 'Rail Continent', logo: 'üöÇ', apiKey: 'railcontinent' },\n00092|   { name: '–í–æ–∑–æ–≤–æ–∑', logo: 'üöö', apiKey: 'vozovoz' },\n00093|   { name: 'Nord Wheel', logo: 'üåê', apiKey: 'nordwheel' },\n00094|   { name: '–°–¥—ç–∫', logo: 'üìÆ', apiKey: 'cdek' },\n00095|   { name: '–ù–æ–≤–∞—è –ª–∏–Ω–∏—è', logo: 'üõ£Ô∏è', apiKey: 'newline' },\n00096|   { name: '–ò—Ä-–¢—Ä–∞—Å—Ç', logo: 'üè≠', apiKey: 'irtrust' },\n00097|   { name: '–ú–∞–π–æ—Ä —Ç—Ä–∞–Ω—Å', logo: '‚≠ê', apiKey: 'majortrans' },\n00098|   { name: '–ë–ê–ô–ö–ê–õ –°–ï–†–í–ò–°', logo: 'üåä', apiKey: 'baikalservice' },\n00099|   { name: '–ê–¥–∞–º–∞–Ω—Ç', logo: 'üíé', apiKey: 'adamant' },\n00100|   { name: '–≠–ù–ï–†–ì–ò–Ø', logo: '‚ö°', apiKey: 'energiya' },\n00101|   { name: '–¶–ê–ü', logo: 'üéØ', apiKey: 'cap' },\n00102|   { name: '–£—Ä–∞–ª–¢—Ä–∞–Ω—Å–ö–æ–º–ø–∞–Ω–∏', logo: '‚õ∞Ô∏è', apiKey: 'uraltrans' },\n00103|   { name: '–ù–û–í–û–¢–≠–ö', logo: 'üîß', apiKey: 'novotek' },\n00104|   { name: '–ö–∏—Ç', logo: 'üêã', apiKey: 'kit' },\n00105|   { name: '–ö–∞—Ä–∞–≤–∞–Ω', logo: 'üê™', apiKey: 'karavan' },\n00106|   { name: '–ñ–µ–ª–î–æ—Ä–≠–∫—Å–ø–µ–¥–∏—Ü–∏—è', logo: 'üöÑ', apiKey: 'zeldor' },\n00107|   { name: '–î–ö –¢—Ä–∞–Ω–∑–∏—Ç', logo: 'üöê', apiKey: 'dktransit' },\n00108|   { name: '–ì–ª–∞–≤—Ç—Ä–∞—Å—Å–∞', logo: 'üõ§Ô∏è', apiKey: 'glavtrassa' },\n00109|   { name: '–ë–∞–ª—Ç–∏–π—Å–∫–∞—è –°–ª—É–∂–±–∞ –î–æ—Å—Ç–∞–≤–∫–∏', logo: '‚öì', apiKey: 'baltservice' },\n00110|   { name: '–ê–ù–ö–û–†', logo: 'üîó', apiKey: 'ankor' }\n00111| ];\n00112| \n00113| export default function Home() {\n00114|   // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n00115|   const initialFormState: DeliveryForm = {\n00116|     cargos: [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00117|     fromCity: '',\n00118|     toCity: '',\n00119|     fromAddress: '',\n00120|     toAddress: '',\n00121|     declaredValue: 0,\n00122|     needPackaging: false,\n00123|     needLoading: false,\n00124|     needCarry: false,\n00125|     floor: 1,\n00126|     hasFreightLift: false,\n00127|     needInsurance: false,\n00128|     fromTerminal: true,\n00129|     toTerminal: true,\n00130|     fromAddressDelivery: false,\n00131|     toAddressDelivery: false,\n00132|     fromLavsiteWarehouse: false,\n00133|     selectedProducts: []\n00134|   };\n00135| \n00136|   const [form, setForm] = useState<DeliveryForm>(initialFormState);\n00137|   const [isLoaded, setIsLoaded] = useState(false);\n00138|   const [isRestoring, setIsRestoring] = useState(false);\n00139|   const [lastSaveTime, setLastSaveTime] = useState<Date | null>(null);\n00140|   const [isFormChanged, setIsFormChanged] = useState(false);\n00141|   \n00142|   // –°–æ–∑–¥–∞–µ–º –¥–µ–±–∞—É–Ω—Å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (—Å–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è)\n00143|   const debouncedSave = useMemo(() => {\n00144|     const saver = createDebouncedSaver(1000);\n00145|     // –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã\n00146|     return (formData: any) => {\n00147|       setIsFormChanged(true);\n00148|       saver(formData);\n00149|       // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É\n00150|       setTimeout(() => {\n00151|         setLastSaveTime(new Date());\n00152|         setIsFormChanged(false);\n00153|       }, 1100);\n00154|     };\n00155|   }, []);\n00156| \n00157|   const [suggestions, setSuggestions] = useState<AddressSuggestion[]>([]);\n00158|   const [showSuggestions, setShowSuggestions] = useState(false);\n00159|   const [activeField, setActiveField] = useState('');\n00160|   \n00161|   // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω–∏–µ–º/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n00162|   const [enabledCompanies, setEnabledCompanies] = useState<Record<string, boolean>>({\n00163|     pek: true,\n00164|     dellin: true,\n00165|     railcontinent: true,\n00166|     vozovoz: true,\n00167|     nordwheel: true,\n00168|     cdek: true,\n00169|     newline: false,\n00170|     irtrust: false,\n00171|     majortrans: false,\n00172|     baikalservice: false,\n00173|     adamant: false,\n00174|     energiya: false,\n00175|     cap: false,\n00176|     uraltrans: false,\n00177|     novotek: false,\n00178|     kit: true,\n00179|     karavan: false,\n00180|     zeldor: false,\n00181|     dktransit: false,\n00182|     glavtrassa: false,\n00183|     baltservice: false,\n00184|     ankor: false\n00185|   });\n00186|   const [calculations, setCalculations] = useState<CalculationResult[]>([]);\n00187|   const [calculating, setCalculating] = useState(false);\n00188|   const [calculationProgress, setCalculationProgress] = useState<{\n00189|     companies: Array<{\n00190|       name: string;\n00191|       status: 'pending' | 'loading' | 'completed' | 'error';\n00192|       progress?: number;\n00193|       error?: string;\n00194|       duration?: number;\n00195|     }>;\n00196|     totalDuration: number;\n00197|   }>({\n00198|     companies: [],\n00199|     totalDuration: 0\n00200|   });\n00201|   const [expandedDetails, setExpandedDetails] = useState<{ [key: string]: boolean }>({});\n00202|   const [expandedDebugInfo, setExpandedDebugInfo] = useState<{ [key: string]: boolean }>({});\n00203|   const [suggestionPosition, setSuggestionPosition] = useState({ top: 0, left: 0 });\n00204|   const [apiStatus, setApiStatus] = useState({\n00205|     pek: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00206|     dellin: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00207|     railcontinent: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00208|     vozovoz: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00209|     nordwheel: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00210|     cdek: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00211|     kit: '–ø—Ä–æ–≤–µ—Ä–∫–∞...',\n00212|     newline: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00213|     irtrust: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00214|     majortrans: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00215|     baikalservice: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00216|     adamant: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00217|     energiya: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00218|     cap: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00219|     uraltrans: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00220|     novotek: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00221|     karavan: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00222|     zeldor: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00223|     dktransit: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00224|     glavtrassa: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00225|     baltservice: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ',\n00226|     ankor: '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ'\n00227|   });\n00228| \n00229|   // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–∫—Ä—ã—Ç—ã—Ö —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n00230|   const [hiddenCompanies, setHiddenCompanies] = useState<Record<string, boolean>>({});\n00231|   const [showHiddenCompanies, setShowHiddenCompanies] = useState(false);\n00232| \n00233|   // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö - –ù–ï –æ—á–∏—â–∞–µ–º localStorage –≤ dev —Ä–µ–∂–∏–º–µ\n00234|   // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞–º–∏\n00235| \n00236|   // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏\n00237|   useEffect(() => {\n00238|     if (typeof window !== 'undefined' && isLoaded) {\n00239|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ (–ø–æ—Å–ª–µ Clear-Site-Data)\n00240|       const delayedCheck = setTimeout(() => {\n00241|         const currentFormData = loadFormData();\n00242|         if (!currentFormData) {\n00243|           console.log('üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –∏—â–µ–º backup...');\n00244|           \n00245|           // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ backup –¥–∞–Ω–Ω—ã–µ\n00246|           const backupKeys = ['formBackup1', 'formBackup2', 'formBackup3'];\n00247|           for (const key of backupKeys) {\n00248|             const backup = localStorage.getItem(key);\n00249|             if (backup) {\n00250|               try {\n00251|                 localStorage.setItem('deliveryFormData', backup);\n00252|                 console.log('üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ backup:', key);\n00253|                 \n00254|                 // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ\n00255|                 const restoredData = loadFormData();\n00256|                 if (restoredData) {\n00257|                   setIsRestoring(true);\n00258|                   const restoredForm: DeliveryForm = {\n00259|                     cargos: restoredData.cargos.length > 0 ? restoredData.cargos : [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00260|                     fromCity: restoredData.fromCity,\n00261|                     toCity: restoredData.toCity,\n00262|                     fromAddress: restoredData.fromAddress,\n00263|                     toAddress: restoredData.toAddress,\n00264|                     declaredValue: restoredData.declaredValue,\n00265|                     needPackaging: restoredData.needPackaging,\n00266|                     needLoading: restoredData.needLoading,\n00267|                     needCarry: restoredData.needCarry,\n00268|                     floor: restoredData.floor,\n00269|                     hasFreightLift: restoredData.hasFreightLift,\n00270|                     needInsurance: restoredData.needInsurance,\n00271|                     fromTerminal: restoredData.fromTerminal,\n00272|                     toTerminal: restoredData.toTerminal,\n00273|                     fromAddressDelivery: restoredData.fromAddressDelivery,\n00274|                     toAddressDelivery: restoredData.toAddressDelivery,\n00275|                     fromLavsiteWarehouse: restoredData.fromLavsiteWarehouse || false,\n00276|                     selectedProducts: restoredData.selectedProducts,\n00277|                   };\n00278|                   setForm(restoredForm);\n00279|                   if (restoredData.enabledCompanies && Object.keys(restoredData.enabledCompanies).length > 0) {\n00280|                     setEnabledCompanies(restoredData.enabledCompanies);\n00281|                   }\n00282|                   setTimeout(() => setIsRestoring(false), 100);\n00283|                   console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!');\n00284|                 }\n00285|                 break;\n00286|               } catch (e) {\n00287|                 console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ backup:', key, e);\n00288|               }\n00289|             }\n00290|           }\n00291|         }\n00292|       }, 2000);\n00293|       \n00294|       return () => clearTimeout(delayedCheck);\n00295|     }\n00296|   }, [isLoaded]);\n00297| \n00298|   // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)\n00299|   useEffect(() => {\n00300|     // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ\n00301|     if (typeof window !== 'undefined' && !isLoaded) {\n00302|       let dataRestored = false;\n00303|       try {\n00304|         setIsRestoring(true); // –ë–ª–æ–∫–∏—Ä—É–µ–º –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è\n00305|         \n00306|         // –ú—è–≥–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –±–µ–∑ –æ—á–∏—Å—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö\n00307|         const currentVersion = 'v2.4.0-persistent-storage'; // –í–µ—Ä—Å–∏—è —Å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º\n00308|         const savedVersion = localStorage.getItem('appVersion');\n00309|         \n00310|         if (savedVersion !== currentVersion) {\n00311|           console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ', currentVersion);\n00312|           // –ù–ï –æ—á–∏—â–∞–µ–º localStorage - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ\n00313|           localStorage.setItem('appVersion', currentVersion);\n00314|         }\n00315|         \n00316|         // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É\n00317|         const savedFormData = loadFormData();\n00318|         if (savedFormData) {\n00319|           // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞\n00320|           const restoredForm: DeliveryForm = {\n00321|             cargos: savedFormData.cargos.length > 0 ? savedFormData.cargos : [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00322|             fromCity: savedFormData.fromCity,\n00323|             toCity: savedFormData.toCity,\n00324|             fromAddress: savedFormData.fromAddress,\n00325|             toAddress: savedFormData.toAddress,\n00326|             declaredValue: savedFormData.declaredValue,\n00327|             needPackaging: savedFormData.needPackaging,\n00328|             needLoading: savedFormData.needLoading,\n00329|             needCarry: savedFormData.needCarry,\n00330|             floor: savedFormData.floor,\n00331|             hasFreightLift: savedFormData.hasFreightLift,\n00332|             needInsurance: savedFormData.needInsurance,\n00333|             fromTerminal: savedFormData.fromTerminal,\n00334|             toTerminal: savedFormData.toTerminal,\n00335|             fromAddressDelivery: savedFormData.fromAddressDelivery,\n00336|             toAddressDelivery: savedFormData.toAddressDelivery,\n00337|             fromLavsiteWarehouse: savedFormData.fromLavsiteWarehouse || false,\n00338|             selectedProducts: savedFormData.selectedProducts,\n00339|           };\n00340|           \n00341|           setForm(restoredForm);\n00342|           \n00343|           // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π\n00344|           if (savedFormData.enabledCompanies && Object.keys(savedFormData.enabledCompanies).length > 0) {\n00345|             setEnabledCompanies(savedFormData.enabledCompanies);\n00346|           }\n00347|           console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ localStorage');\n00348|           \n00349|           // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è Supabase\n00350|           const currentTime = Math.floor(Date.now() / 1000);\n00351|           console.log('üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (timestamp):', currentTime);\n00352|           console.log('üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (ISO):', new Date().toISOString());\n00353|           \n00354|           dataRestored = true;\n00355|           // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—Å–ø–µ–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è\n00356|           setTimeout(() => {\n00357|             setIsRestoring(false);\n00358|           }, 100);\n00359|         } else {\n00360|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏\n00361|           const oldSaved = localStorage.getItem('deliveryForm');\n00362|           if (oldSaved) {\n00363|             console.log('üîÑ –ù–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç–∞—Ä–æ–º —Ñ–æ—Ä–º–∞—Ç–µ, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è...');\n00364|             const oldForm = JSON.parse(oldSaved);\n00365|             if (!oldForm.cargos || oldForm.cargos.length === 0) {\n00366|               oldForm.cargos = [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }];\n00367|             }\n00368|             setForm(oldForm);\n00369|             \n00370|             // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –∏ —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ\n00371|             saveFormData(oldForm);\n00372|             localStorage.removeItem('deliveryForm');\n00373|             console.log('‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');\n00374|             \n00375|             dataRestored = true;\n00376|             // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—Å–ø–µ–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è\n00377|             setTimeout(() => {\n00378|               setIsRestoring(false);\n00379|             }, 100);\n00380|           }\n00381|         }\n00382|         \n00383|         // –í—ã–≤–æ–¥–∏–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¢–ö –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n00384|         console.log('üìã –í—Å–µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ –¢–ö:', COMPANIES_BASE.length);\n00385|         console.log('üìã –°–ø–∏—Å–æ–∫ –¢–ö:', COMPANIES_BASE.map(c => c.name));\n00386|         \n00387|       } catch (error) {\n00388|         console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);\n00389|         // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ\n00390|       } finally {\n00391|         // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, —Å—Ä–∞–∑—É —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ\n00392|         if (!dataRestored) {\n00393|           setIsRestoring(false);\n00394|         }\n00395|         setIsLoaded(true);\n00396|       }\n00397|     }\n00398|   }, [isLoaded]);\n00399| \n00400|   // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–æ—Ä–º—ã (—Å –¥–µ–±–∞—É–Ω—Å–æ–º)\n00401|   useEffect(() => {\n00402|     if (typeof window !== 'undefined' && isLoaded && !isRestoring) {\n00403|       // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–±–∞—É–Ω—Å –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è\n00404|       debouncedSave({\n00405|         cargos: form.cargos,\n00406|         fromCity: form.fromCity,\n00407|         toCity: form.toCity,\n00408|         fromAddress: form.fromAddress,\n00409|         toAddress: form.toAddress,\n00410|         declaredValue: form.declaredValue,\n00411|         needPackaging: form.needPackaging,\n00412|         needLoading: form.needLoading,\n00413|         needCarry: form.needCarry,\n00414|         floor: form.floor,\n00415|         hasFreightLift: form.hasFreightLift,\n00416|         needInsurance: form.needInsurance,\n00417|         fromTerminal: form.fromTerminal,\n00418|         toTerminal: form.toTerminal,\n00419|         fromAddressDelivery: form.fromAddressDelivery,\n00420|         toAddressDelivery: form.toAddressDelivery,\n00421|         fromLavsiteWarehouse: form.fromLavsiteWarehouse,\n00422|         selectedProducts: form.selectedProducts,\n00423|         enabledCompanies: enabledCompanies,\n00424|       });\n00425|     }\n00426|   }, [form, enabledCompanies, isLoaded, isRestoring, debouncedSave]);\n00427| \n00428|   // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –ø—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n00429|   useEffect(() => {\n00430|     if (form.declaredValue > 0) {\n00431|       setForm(prev => ({ ...prev, needInsurance: true }));\n00432|     }\n00433|   }, [form.declaredValue]);\n00434| \n00435|   // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤\n00436|   useEffect(() => {\n00437|     const handleMessage = (event: MessageEvent) => {\n00438|       if (event.data && event.data.type === 'PRODUCTS_UPDATED') {\n00439|         console.log('üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤:', event.data.data);\n00440|         \n00441|         // –û—á–∏—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫—ç—à–∏ —Ç–æ–≤–∞—Ä–æ–≤\n00442|         const keysToRemove: string[] = [];\n00443|         for (let i = 0; i < localStorage.length; i++) {\n00444|           const key = localStorage.key(i);\n00445|           if (key && (key.startsWith('furniture_') || key.startsWith('product_') || key.includes('ProductSearch'))) {\n00446|             keysToRemove.push(key);\n00447|           }\n00448|         }\n00449|         keysToRemove.forEach(key => localStorage.removeItem(key));\n00450|         console.log(`üßΩ –û—á–∏—â–µ–Ω–æ ${keysToRemove.length} –∫–ª—é—á–µ–π –∫—ç—à–∞ —Ç–æ–≤–∞—Ä–æ–≤`);\n00451|         \n00452|         // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É ProductSearch –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è\n00453|         window.dispatchEvent(new CustomEvent('forceProductsReload', {\n00454|           detail: event.data.data\n00455|         }));\n00456|       }\n00457|     };\n00458|     \n00459|     window.addEventListener('message', handleMessage);\n00460|     \n00461|     return () => {\n00462|       window.removeEventListener('message', handleMessage);\n00463|     };\n00464|   }, []);\n00465| \n00466|   // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã\n00467|   useEffect(() => {\n00468|     if (typeof window !== 'undefined' && isLoaded) {\n00469|       checkAllAPIStatus();\n00470|     }\n00471|   }, [isLoaded]);\n00472| \n00473|   const checkAPIStatus = async (apiName: string, testFunction: () => Promise<any>) => {\n00474|     try {\n00475|       const result = await testFunction();\n00476|       if (result && !result.error) {\n00477|         setApiStatus(prev => ({ ...prev, [apiName]: '–ø–æ–¥–∫–ª—é—á–µ–Ω–æ' }));\n00478|       } else {\n00479|         setApiStatus(prev => ({ ...prev, [apiName]: '–æ—à–∏–±–∫–∞' }));\n00480|       }\n00481|     } catch (error) {\n00482|       setApiStatus(prev => ({ ...prev, [apiName]: '–æ—à–∏–±–∫–∞' }));\n00483|     }\n00484|   };\n00485| \n00486|   const checkAllAPIStatus = async () => {\n00487|     // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\n00488|     const testData = {\n00489|       fromCity: '–ú–æ—Å–∫–≤–∞',\n00490|       toCity: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', \n00491|       cargos: [{ id: '1', length: 100, width: 100, height: 100, weight: 10 }],\n00492|       declaredValue: 50000,\n00493|       fromAddressDelivery: false,\n00494|       toAddressDelivery: false,\n00495|       needPackaging: false,\n00496|       needInsurance: false\n00497|     };\n00498| \n00499|     // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n00500|     const currentForm = form;\n00501|     \n00502|     // –í—Ä–µ–º–µ–Ω–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ\n00503|     setForm({\n00504|       ...form,\n00505|       fromCity: testData.fromCity,\n00506|       toCity: testData.toCity,\n00507|       cargos: testData.cargos,\n00508|       declaredValue: testData.declaredValue,\n00509|       fromAddressDelivery: testData.fromAddressDelivery,\n00510|       toAddressDelivery: testData.toAddressDelivery,\n00511|       needPackaging: testData.needPackaging,\n00512|       needInsurance: testData.needInsurance\n00513|     });\n00514| \n00515|     // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ\n00516|     Promise.all([\n00517|       checkAPIStatus('pek', async () => {\n00518|         try {\n00519|           const response = await fetch('/api/pek', {\n00520|             method: 'POST',\n00521|             headers: { 'Content-Type': 'application/json' },\n00522|             body: JSON.stringify({ method: 'test' })\n00523|           });\n00524|           const data = await response.json();\n00525|           if (data.status === 'OK') {\n00526|             return { success: true };\n00527|           } else {\n00528|             return { error: true };\n00529|           }\n00530|         } catch (error) {\n00531|           return { error: true };\n00532|         }\n00533|       }),\n00534|       \n00535|       checkAPIStatus('dellin', async () => {\n00536|         try {\n00537|           // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ sessionID –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π (—Ç–æ—Ç –∂–µ –º–µ—Ç–æ–¥ —á—Ç–æ –≤ calculateDellin)\n00538|           const authResponse = await fetch('https://api.dellin.ru/v3/auth/login.json', {\n00539|             method: 'POST',\n00540|             headers: { 'Content-Type': 'application/json' },\n00541|             body: JSON.stringify({\n00542|               appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n00543|               login: 'service@lavsit.ru',\n00544|               password: 'edcwsx123QAZ'\n00545|             })\n00546|           });\n00547|           const authData = await authResponse.json();\n00548|           \n00549|           // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ –∫ sessionID –∫–∞–∫ –≤ calculateDellin\n00550|           if (authData.data?.sessionID || authData.sessionID || authData.data?.session) {\n00551|             return { success: true };\n00552|           } else {\n00553|             return { error: true };\n00554|           }\n00555|         } catch (error) {\n00556|           return { error: true };\n00557|         }\n00558|       }),\n00559|       \n00560|       checkAPIStatus('railcontinent', async () => {\n00561|         try {\n00562|           const response = await fetch('/api/rail-continent', {\n00563|             method: 'POST',\n00564|             headers: { 'Content-Type': 'application/json' },\n00565|             body: JSON.stringify({\n00566|               city_sender: testData.fromCity,\n00567|               city_receiver: testData.toCity,\n00568|               weight: 10,\n00569|               volume: 0.1,\n00570|               length: 1,\n00571|               width: 1,\n00572|               height: 1,\n00573|               declared_cost: testData.declaredValue,\n00574|               pickup: '0',\n00575|               delivery: '0',\n00576|               packaging: '0',\n00577|               insurance: '0',\n00578|               tariff: 'auto'\n00579|             })\n00580|           });\n00581|           return await response.json();\n00582|         } catch (error) {\n00583|           return { error: true };\n00584|         }\n00585|       }),\n00586|       \n00587|       checkAPIStatus('vozovoz', async () => {\n00588|         try {\n00589|           const response = await fetch('/api/vozovoz', {\n00590|             method: 'POST',\n00591|             headers: { 'Content-Type': 'application/json' },\n00592|             body: JSON.stringify({\n00593|               object: \"price\",\n00594|               action: \"get\",\n00595|               params: {\n00596|                 cargo: {\n00597|                   dimension: {\n00598|                     quantity: 1,\n00599|                     volume: 0.1,\n00600|                     weight: 10\n00601|                   }\n00602|                 },\n00603|                 gateway: {\n00604|                   dispatch: {\n00605|                     point: {\n00606|                       location: testData.fromCity,\n00607|                       terminal: \"default\"\n00608|                     }\n00609|                   },\n00610|                   destination: {\n00611|                     point: {\n00612|                       location: testData.toCity,\n00613|                       terminal: \"default\"\n00614|                     }\n00615|                   }\n00616|                 }\n00617|               }\n00618|             })\n00619|           });\n00620|           return await response.json();\n00621|         } catch (error) {\n00622|           return { error: true };\n00623|         }\n00624|       }),\n00625|       \n00626|       checkAPIStatus('nordwheel', async () => {\n00627|         try {\n00628|           const totalWeight = 10;\n00629|           const totalVolume = 0.1;\n00630|           \n00631|           const params = new URLSearchParams({\n00632|             from: '91',\n00633|             to: '92',\n00634|             pickup: '1',\n00635|             deliver: '1',\n00636|             weight: totalWeight.toString(),\n00637|             volume: totalVolume.toString(),\n00638|             oversized: '0',\n00639|             package: '1',\n00640|             packageCount: '1',\n00641|             insurance: '1',\n00642|             sum: '50000',\n00643|             documentsReturn: '0',\n00644|             fragile: '1'\n00645|           });\n00646| \n00647|           const fullUrl = `https://nordw.ru/tools/api/calc/calculate/?${params.toString()}`;\n00648|        const result = await enhancedApiRequest(\n00649|          fullUrl,\n00650|          {\n00651|            method: 'GET'\n00652|          },\n00653|          { operation: 'calculate', company: 'Nord Wheel' }\n00654|        );\n00655| \n00656|         if (result && typeof result === 'object' && 'success' in result && !result.success) {\n00657|           console.error('‚ùå Nord Wheel API –æ—à–∏–±–∫–∞:', result.error);\n00658|           return {\n00659|             company: 'Nord Wheel',\n00660|             price: 0,\n00661|             days: 0,\n00662|             error: result.error.userMessage || result.error.message,\n00663|             requestData: params,\n00664|             responseData: null,\n00665|             apiUrl: fullUrl\n00666|           };\n00667|         }\n00668| \n00669|        const response = result as Response;\n00670|        const data = await response.json();\n00671|           \n00672|           if (response.ok && data.status === 'success') {\n00673|             return { success: true };\n00674|           } else {\n00675|             return { error: true };\n00676|           }\n00677|         } catch (error) {\n00678|           return { error: true };\n00679|         }\n00680|       }),\n00681|       \n00682|       checkAPIStatus('cdek', async () => {\n00683|         try {\n00684|           const response = await fetch('/api/cdek', {\n00685|             method: 'POST',\n00686|             headers: { 'Content-Type': 'application/json' },\n00687|             body: JSON.stringify({\n00688|               from_city: testData.fromCity,\n00689|               to_city: testData.toCity,\n00690|               packages: [{\n00691|                 height: 10,\n00692|                 length: 20,\n00693|                 width: 10,\n00694|                 weight: 1000\n00695|               }]\n00696|             })\n00697|           });\n00698|           const data = await response.json();\n00699|           \n00700|           if (response.ok && data.tariff_codes && data.tariff_codes.length > 0) {\n00701|             return { success: true };\n00702|           } else {\n00703|             return { error: true };\n00704|           }\n00705|         } catch (error) {\n00706|           return { error: true };\n00707|         }\n00708|       })\n00709|     ]).finally(() => {\n00710|       // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã\n00711|       setForm(currentForm);\n00712|     });\n00713|   };\n00714| \n00715|   const searchAddresses = useCallback(async (query: string, field: string, element?: HTMLInputElement) => {\n00716|     if (query.length < 3) {\n00717|       setSuggestions([]);\n00718|       setShowSuggestions(false);\n00719|       return;\n00720|     }\n00721| \n00722|     setActiveField(field);\n00723|     \n00724|     // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ –∞–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–æ–∫\n00725|     if (element) {\n00726|       const rect = element.getBoundingClientRect();\n00727|       setSuggestionPosition({\n00728|         top: rect.bottom + window.scrollY,\n00729|         left: rect.left + window.scrollX\n00730|       });\n00731|     }\n00732|     \n00733|     try {\n00734|       const response = await fetch('https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address', {\n00735|         method: 'POST',\n00736|         headers: {\n00737|           'Content-Type': 'application/json',\n00738|           'Accept': 'application/json',\n00739|           'Authorization': 'Token eb87bbb3789bb43ed465f796892ea951f9e91008'\n00740|         },\n00741|         body: JSON.stringify({\n00742|           query: query,\n00743|           count: 10,\n00744|           // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª–µ–π –≥–æ—Ä–æ–¥–æ–≤ - —Ç–æ–ª—å–∫–æ –≥–æ—Ä–æ–¥–∞\n00745|           ...(field === 'fromCity' || field === 'toCity' ? {\n00746|             restrict_value: true,\n00747|             locations: [{\n00748|               country: '–†–æ—Å—Å–∏—è'\n00749|             }],\n00750|             from_bound: { value: 'city' },\n00751|             to_bound: { value: 'city' }\n00752|           } : {})\n00753|         })\n00754|       });\n00755| \n00756|       if (response.ok) {\n00757|         const data = await response.json();\n00758|         setSuggestions(data.suggestions || []);\n00759|         setShowSuggestions(true);\n00760|       }\n00761|     } catch (error) {\n00762|       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫:', error);\n00763|     }\n00764|   }, []);\n00765| \n00766|   const debounceTimer = React.useRef<NodeJS.Timeout>();\n00767|   const handleAddressChange = (field: string, value: string, element?: HTMLInputElement) => {\n00768|     setForm(prev => ({ ...prev, [field]: value }));\n00769|     \n00770|     clearTimeout(debounceTimer.current);\n00771|     debounceTimer.current = setTimeout(() => {\n00772|       searchAddresses(value, field, element);\n00773|     }, 50);\n00774|   };\n00775| \n00776|   const selectSuggestion = (suggestion: AddressSuggestion) => {\n00777|     setForm(prev => ({ ...prev, [activeField]: suggestion.value }));\n00778|     setShowSuggestions(false);\n00779|     setActiveField('');\n00780|   };\n00781| \n00782|   // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞ \"–°–æ —Å–∫–ª–∞–¥–∞ –õ–∞–≤—Å–∏—Ç\"\n00783|   const handleLavsiteWarehouseChange = (checked: boolean) => {\n00784|     if (checked) {\n00785|       setForm(prev => ({\n00786|         ...prev,\n00787|         fromLavsiteWarehouse: true,\n00788|         fromAddressDelivery: true,\n00789|         fromTerminal: false,\n00790|         fromCity: '–õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π',\n00791|         fromAddress: '–¥–µ—Ä–µ–≤–Ω—è –û—Å–µ–µ–≤–æ, 202, –≥–æ—Ä–æ–¥—Å–∫–æ–π –æ–∫—Ä—É–≥ –õ–æ—Å–∏–Ω–æ-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π, –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å'\n00792|       }));\n00793|     } else {\n00794|       setForm(prev => ({\n00795|         ...prev,\n00796|         fromLavsiteWarehouse: false,\n00797|         fromCity: '',\n00798|         fromAddress: ''\n00799|       }));\n00800|     }\n00801|   };\n00802| \n00803|   const addCargo = () => {\n00804|     const newId = (form.cargos.length + 1).toString();\n00805|     setForm(prev => ({\n00806|       ...prev,\n00807|       cargos: [...prev.cargos, { id: newId, length: 0, width: 0, height: 0, weight: 0 }]\n00808|     }));\n00809|   };\n00810| \n00811|   const updateCargo = (id: string, field: string, value: number) => {\n00812|     setForm(prev => {\n00813|       const updatedCargos = prev.cargos.map(cargo => \n00814|         cargo.id === id ? { ...cargo, [field]: value } : cargo\n00815|       );\n00816|       \n00817|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n00818|       const cleanResult = cleanEmptyCargos(updatedCargos, prev.selectedProducts || []);\n00819|       \n00820|       return {\n00821|         ...prev,\n00822|         cargos: cleanResult.cargos,\n00823|         selectedProducts: cleanResult.products\n00824|       };\n00825|     });\n00826|   };\n00827| \n00828|   const removeCargo = (id: string) => {\n00829|     if (form.cargos.length > 1) {\n00830|       setForm(prev => ({\n00831|         ...prev,\n00832|         cargos: prev.cargos.filter(cargo => cargo.id !== id)\n00833|       }));\n00834|     }\n00835|   };\n00836| \n00837|   // üîß –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ (–≤—Å–µ –ø–æ–ª—è —Ä–∞–≤–Ω—ã 0)\n00838|   const isEmptyCargo = (cargo: Cargo) => {\n00839|     return cargo.length === 0 && cargo.width === 0 && cargo.height === 0 && cargo.weight === 0;\n00840|   };\n00841| \n00842|   // üîß –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤\n00843|   const cleanEmptyCargos = (cargos: Cargo[], selectedProducts: ProductInForm[]) => {\n00844|     // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –≥—Ä—É–∑\n00845|     const hasFilledCargos = cargos.some(cargo => !isEmptyCargo(cargo));\n00846|     \n00847|     if (!hasFilledCargos) {\n00848|       // –ï—Å–ª–∏ –Ω–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –ø—É—Å—Ç–æ–π\n00849|       return {\n00850|         cargos: cargos.length > 0 ? [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }] : [{ id: '1', length: 0, width: 0, height: 0, weight: 0 }],\n00851|         products: selectedProducts\n00852|       };\n00853|     }\n00854| \n00855|     // –°–æ–∑–¥–∞–µ–º –º–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ä—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –∫ –Ω–æ–≤—ã–º\n00856|     const oldToNewIndexMap = new globalThis.Map<number, number>();\n00857|     let newIndex = 0;\n00858|     \n00859|     cargos.forEach((cargo, oldIndex) => {\n00860|       if (!isEmptyCargo(cargo)) {\n00861|         oldToNewIndexMap.set(oldIndex, newIndex);\n00862|         newIndex++;\n00863|       }\n00864|     });\n00865|     \n00866|     // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –≥—Ä—É–∑—ã\n00867|     const filledCargos = cargos.filter(cargo => !isEmptyCargo(cargo));\n00868|     \n00869|     // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã —É —Ç–æ–≤–∞—Ä–æ–≤\n00870|     const updatedProducts = selectedProducts.map(productItem => ({\n00871|       ...productItem,\n00872|       cargoIndexes: productItem.cargoIndexes\n00873|         .map(oldIndex => oldToNewIndexMap.get(oldIndex))\n00874|         .filter(newIdx => newIdx !== undefined) as number[]\n00875|     }));\n00876|     \n00877|     return {\n00878|       cargos: filledCargos,\n00879|       products: updatedProducts\n00880|     };\n00881|   };\n00882| \n00883|   // üîß –§—É–Ω–∫—Ü–∏—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≥—Ä—É–∑–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n00884|   interface GroupedCargoDisplay {\n00885|     length: number;\n00886|     width: number;\n00887|     height: number;\n00888|     weight: number;\n00889|     quantity: number;\n00890|     indices: number[];\n00891|     isEmpty: boolean;\n00892|   }\n00893| \n00894|   const groupCargosForDisplay = (cargos: Cargo[]): GroupedCargoDisplay[] => {\n00895|     const groups = new globalThis.Map<string, GroupedCargoDisplay>();\n00896|     \n00897|     cargos.forEach((cargo, index) => {\n00898|       const isEmpty = isEmptyCargo(cargo);\n00899|       \n00900|       // –î–ª—è –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤ –Ω–µ –≥—Ä—É–ø–ø–∏—Ä—É–µ–º\n00901|       if (isEmpty) {\n00902|         groups.set(`empty_${index}`, {\n00903|           length: 0,\n00904|           width: 0,\n00905|           height: 0,\n00906|           weight: 0,\n00907|           quantity: 1,\n00908|           indices: [index],\n00909|           isEmpty: true\n00910|         });\n00911|         return;\n00912|       }\n00913|       \n00914|       // –°–æ–∑–¥–∞–µ–º –∫–ª—é—á –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥–∞–±–∞—Ä–∏—Ç–æ–≤ –∏ –≤–µ—Å–∞\n00915|       const key = `${cargo.length}_${cargo.width}_${cargo.height}_${cargo.weight}`;\n00916|       \n00917|       if (groups.has(key)) {\n00918|         const existing = groups.get(key)!;\n00919|         existing.quantity += 1;\n00920|         existing.indices.push(index);\n00921|       } else {\n00922|         groups.set(key, {\n00923|           length: cargo.length,\n00924|           width: cargo.width,\n00925|           height: cargo.height,\n00926|           weight: cargo.weight,\n00927|           quantity: 1,\n00928|           indices: [index],\n00929|           isEmpty: false\n00930|         });\n00931|       }\n00932|     });\n00933|     \n00934|     // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤: —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ (–ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É–±—ã–≤–∞–Ω–∏—è), –ø–æ—Ç–æ–º –ø—É—Å—Ç—ã–µ\n00935|     return Array.from(groups.values()).sort((a, b) => {\n00936|       if (a.isEmpty && !b.isEmpty) return 1;\n00937|       if (!a.isEmpty && b.isEmpty) return -1;\n00938|       if (!a.isEmpty && !b.isEmpty) {\n00939|         return b.quantity - a.quantity; // –ü–æ —É–±—ã–≤–∞–Ω–∏—é –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞\n00940|       }\n00941|       return a.indices[0] - b.indices[0]; // –ü—É—Å—Ç—ã–µ –ø–æ –ø–æ—Ä—è–¥–∫—É –∏–Ω–¥–µ–∫—Å–æ–≤\n00942|     });\n00943|   };\n00944| \n00945|   // üîß –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏\n00946|   const handleProductAdd = (product: FurnitureProduct) => {\n00947|     const timestamp = Date.now();\n00948|     \n00949|     console.log(`‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞: ${product.name} (${product.cargoPlaces.length} –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç)`);\n00950|     \n00951|     // –°–æ–∑–¥–∞–µ–º –≥—Ä—É–∑–æ–≤—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è —Ç–æ–≤–∞—Ä–∞\n00952|     const newCargos = createCargosForProduct(product, 1, timestamp);\n00953|     \n00954|     console.log('–°–æ–∑–¥–∞–Ω–æ –Ω–æ–≤—ã—Ö –≥—Ä—É–∑–æ–≤:', newCargos.length);\n00955|     console.log('–ù–æ–≤—ã–µ –≥—Ä—É–∑—ã:', newCargos.map(c => ({ id: c.id, productId: c.productId, addedAt: c.addedAt })));\n00956|     \n00957|     // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç —Ç–æ–≤–∞—Ä–∞ –≤ —Ñ–æ—Ä–º–µ\n00958|     const productInForm: ProductInForm = {\n00959|       product,\n00960|       quantity: 1,\n00961|       totalPrice: product.retailPrice,\n00962|       cargoIndexes: [], // –ó–∞–ø–æ–ª–Ω–∏–º –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–∑–æ–≤\n00963|       addedAt: timestamp\n00964|     };\n00965|     \n00966|     setForm(prev => {\n00967|       let updatedCargos = [...prev.cargos];\n00968|       let cargoIndexes: number[] = [];\n00969|       \n00970|       // –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è\n00971|       const emptyCargos = updatedCargos\n00972|         .map((cargo, index) => ({ cargo, index }))\n00973|         .filter(item => isEmptyCargo(item.cargo));\n00974|       \n00975|       console.log('–ù–∞–π–¥–µ–Ω–æ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤:', emptyCargos.length);\n00976|       console.log('–ù—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –≥—Ä—É–∑–æ–≤:', newCargos.length);\n00977|       \n00978|       // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞\n00979|       let filledCount = 0;\n00980|       for (let i = 0; i < Math.min(emptyCargos.length, newCargos.length); i++) {\n00981|         const emptyCargoIndex = emptyCargos[i].index;\n00982|         const newCargoData = newCargos[i];\n00983|         \n00984|         updatedCargos[emptyCargoIndex] = {\n00985|           ...updatedCargos[emptyCargoIndex],\n00986|           length: newCargoData.length,\n00987|           width: newCargoData.width,\n00988|           height: newCargoData.height,\n00989|           weight: newCargoData.weight,\n00990|           productId: newCargoData.productId,\n00991|           placeNumber: newCargoData.placeNumber,\n00992|           isFromProduct: newCargoData.isFromProduct,\n00993|           addedAt: newCargoData.addedAt\n00994|         };\n00995|         \n00996|         cargoIndexes.push(emptyCargoIndex);\n00997|         filledCount++;\n00998|       }\n00999|       \n01000|       // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –≥—Ä—É–∑–æ–≤, —á–µ–º –µ—Å—Ç—å –ø—É—Å—Ç—ã—Ö - –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ\n01001|       if (filledCount < newCargos.length) {\n01002|         const remainingCargos = newCargos.slice(filledCount);\n01003|         const startIndex = updatedCargos.length;\n01004|         \n01005|         for (let i = 0; i < remainingCargos.length; i++) {\n01006|           updatedCargos.push(remainingCargos[i]);\n01007|           cargoIndexes.push(startIndex + i);\n01008|         }\n01009|       }\n01010|       \n01011|       productInForm.cargoIndexes = cargoIndexes;\n01012|       \n01013|       console.log('–ò–Ω–¥–µ–∫—Å—ã –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –≥—Ä—É–∑–æ–≤:', cargoIndexes);\n01014|       console.log('–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–≤ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:', updatedCargos.length);\n01015|       \n01016|       // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n01017|       const prevSelectedProducts = prev.selectedProducts || [];\n01018|       const newSelectedProducts = [...prevSelectedProducts, productInForm];\n01019|       const newDeclaredValue = calculateTotalValue(newSelectedProducts);\n01020|       \n01021|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n01022|       const cleanResult = cleanEmptyCargos(updatedCargos, newSelectedProducts);\n01023|       \n01024|       return {\n01025|         ...prev,\n01026|         cargos: cleanResult.cargos,\n01027|         selectedProducts: cleanResult.products,\n01028|         declaredValue: newDeclaredValue\n01029|       };\n01030|     });\n01031|     \n01032|     console.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä: ${product.name} (${newCargos.length} –≥—Ä—É–∑–æ–≤—ã—Ö –º–µ—Å—Ç)`);\n01033|     console.log('–§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥—Ä—É–∑–æ–≤:', newCargos.length);\n01034|   };\n01035| \n01036|   const handleProductQuantityChange = (productId: string, addedAt: number, newQuantity: number) => {\n01037|     setForm(prev => {\n01038|       console.log(`üî¢ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞ ${productId} —Å ${prev.selectedProducts?.find(p => p.product.id === productId && p.addedAt === addedAt)?.quantity || 0} –Ω–∞ ${newQuantity}`);\n01039|       \n01040|       // –ù–∞—Ö–æ–¥–∏–º —Ç–æ–≤–∞—Ä\n01041|       const selectedProducts = prev.selectedProducts || [];\n01042|       const productIndex = selectedProducts.findIndex(p => \n01043|         p.product.id === productId && p.addedAt === addedAt\n01044|       );\n01045|       \n01046|       if (productIndex === -1) {\n01047|         console.warn('‚ùå –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞');\n01048|         return prev;\n01049|       }\n01050|       \n01051|       const product = selectedProducts[productIndex];\n01052|       console.log('–ì—Ä—É–∑—ã –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞:', prev.cargos.length);\n01053|       \n01054|       // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –≥—Ä—É–∑—ã —ç—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞\n01055|       const cargosWithoutProduct = removeCargosForProduct(\n01056|         prev.cargos as CargoWithMetadata[], \n01057|         productId, \n01058|         addedAt\n01059|       );\n01060|       \n01061|       console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö:', cargosWithoutProduct.length);\n01062|       \n01063|       // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –≥—Ä—É–∑—ã —Å –Ω–æ–≤—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º\n01064|       const newCargos = createCargosForProduct(product.product, newQuantity, addedAt);\n01065|       const updatedCargos = [...cargosWithoutProduct, ...newCargos];\n01066|       \n01067|       console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö:', updatedCargos.length);\n01068|       \n01069|       // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä\n01070|       const updatedProduct = {\n01071|         ...product,\n01072|         quantity: newQuantity,\n01073|         totalPrice: product.product.retailPrice * newQuantity,\n01074|         cargoIndexes: findCargoIndexesForProduct(updatedCargos, productId, addedAt)\n01075|       };\n01076|       \n01077|       const updatedProducts = selectedProducts.map((p, index) => \n01078|         index === productIndex ? updatedProduct : p\n01079|       );\n01080|       \n01081|       // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n01082|       const newDeclaredValue = calculateTotalValue(updatedProducts);\n01083|       \n01084|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n01085|       const cleanResult = cleanEmptyCargos(updatedCargos, updatedProducts);\n01086|       \n01087|       return {\n01088|         ...prev,\n01089|         cargos: cleanResult.cargos,\n01090|         selectedProducts: cleanResult.products,\n01091|         declaredValue: newDeclaredValue\n01092|       };\n01093|     });\n01094|     \n01095|     console.log(`üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ ${productId}: ${newQuantity} —à—Ç.`);\n01096|   };\n01097| \n01098|   const handleProductRemove = (productId: string, addedAt: number) => {\n01099|     setForm(prev => {\n01100|       console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ ${productId} (addedAt: ${addedAt})`);\n01101|       \n01102|       // –ù–∞—Ö–æ–¥–∏–º —Ç–æ–≤–∞—Ä –∏ –µ–≥–æ –∏–Ω–¥–µ–∫—Å—ã –≥—Ä—É–∑–æ–≤\n01103|       const selectedProducts = prev.selectedProducts || [];\n01104|       const product = selectedProducts.find(p => \n01105|         p.product.id === productId && p.addedAt === addedAt\n01106|       );\n01107|       \n01108|       if (!product) {\n01109|         console.log('–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω');\n01110|         return prev;\n01111|       }\n01112|       \n01113|       // –û—á–∏—â–∞–µ–º –≥—Ä—É–∑—ã —Ç–æ–≤–∞—Ä–∞ (–¥–µ–ª–∞–µ–º –∏—Ö –ø—É—Å—Ç—ã–º–∏ –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è)\n01114|       const updatedCargos = prev.cargos.map((cargo, index) => {\n01115|         if (product.cargoIndexes.includes(index)) {\n01116|           return {\n01117|             ...cargo,\n01118|             length: 0,\n01119|             width: 0,\n01120|             height: 0,\n01121|             weight: 0,\n01122|             productId: undefined,\n01123|             placeNumber: undefined,\n01124|             isFromProduct: undefined,\n01125|             addedAt: undefined\n01126|           };\n01127|         }\n01128|         return cargo;\n01129|       });\n01130|       \n01131|       // –£–¥–∞–ª—è–µ–º —Ç–æ–≤–∞—Ä –∏–∑ —Å–ø–∏—Å–∫–∞\n01132|       const updatedProducts = selectedProducts.filter(p => \n01133|         !(p.product.id === productId && p.addedAt === addedAt)\n01134|       );\n01135|       \n01136|       // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å\n01137|       const newDeclaredValue = calculateTotalValue(updatedProducts);\n01138|       \n01139|       // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–∑—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ\n01140|       const cleanResult = cleanEmptyCargos(updatedCargos, updatedProducts);\n01141|       \n01142|       console.log('–ì—Ä—É–∑—ã –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:', cleanResult.cargos.length);\n01143|       console.log('–£–¥–∞–ª–µ–Ω–æ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–∑–æ–≤:', updatedCargos.length - cleanResult.cargos.length);\n01144|       \n01145|       return {\n01146|         ...prev,\n01147|         cargos: cleanResult.cargos,\n01148|         selectedProducts: cleanResult.products,\n01149|         declaredValue: newDeclaredValue\n01150|       };\n01151|     });\n01152|     \n01153|     console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω —Ç–æ–≤–∞—Ä ${productId}`);\n01154|   };\n01155| \n01156|   // –ü–æ–ª—É—á–µ–Ω–∏–µ sessionID –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n01157|   const getDellinSessionId = async (): Promise<string | null> => {\n01158|     try {\n01159|       const authResponse = await fetch('https://api.dellin.ru/v3/auth/login.json', {\n01160|         method: 'POST',\n01161|         headers: {\n01162|           'Content-Type': 'application/json'\n01163|         },\n01164|         body: JSON.stringify({\n01165|           appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n01166|           login: 'service@lavsit.ru',\n01167|           password: 'edcwsx123QAZ'\n01168|         })\n01169|       });\n01170| \n01171|       const authData = await authResponse.json();\n01172|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ response.ok:', authResponse.ok);\n01173|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData:', authData);\n01174|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData.data:', authData.data);\n01175|       console.log('üîë –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –î–õ authData.data?.sessionID:', authData.data?.sessionID);\n01176|       \n01177|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ –∫ sessionID\n01178|       let sessionID = null;\n01179|       \n01180|       if (authData.data?.sessionID) {\n01181|         sessionID = authData.data.sessionID;\n01182|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ data.sessionID:', sessionID);\n01183|       } else if (authData.sessionID) {\n01184|         sessionID = authData.sessionID;\n01185|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ sessionID:', sessionID);\n01186|       } else if (authData.data?.session) {\n01187|         sessionID = authData.data.session;\n01188|         console.log('‚úÖ SessionID –Ω–∞–π–¥–µ–Ω –≤ data.session:', sessionID);\n01189|       }\n01190|       \n01191|       if (authResponse.ok && sessionID) {\n01192|         return sessionID;\n01193|       } else {\n01194|         console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', authData);\n01195|         console.error('‚ùå –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', authResponse.status);\n01196|         console.error('‚ùå –¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞:', authResponse.statusText);\n01197|         return null;\n01198|       }\n01199|     } catch (error) {\n01200|       console.error('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏:', error);\n01201|     }\n01202|     return null;\n01203|   };\n01204| \n01205|   // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –≥–æ—Ä–æ–¥–æ–≤ –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n01206|   const loadDellinCities = async () => {\n01207|     try {\n01208|       const response = await fetch('/data/dellin-cities.json');\n01209|       if (!response.ok) {\n01210|         console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –≥–æ—Ä–æ–¥–æ–≤');\n01211|         return null;\n01212|       }\n01213|       const data = await response.json();\n01214|       return data.cities;\n01215|     } catch (error) {\n01216|       console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –≥–æ—Ä–æ–¥–æ–≤:', error);\n01217|       return null;\n01218|     }\n01219|   };\n01220| \n01221|   // –ü–æ–∏—Å–∫ cityID –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ\n01222|   const getCityIDFromLocal = async (cityName: string): Promise<string | null> => {\n01223|     const cities = await loadDellinCities();\n01224|     if (!cities) return null;\n01225| \n01226|     const normalizedSearch = cityName.toLowerCase().trim()\n01227|       .replace(/^–≥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥ \"\n01228|       .replace(/^–≥–æ—Ä–æ–¥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥–æ—Ä–æ–¥ \"\n01229|       .replace(/\\s+/g, ' '); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—Ä–æ–±–µ–ª—ã\n01230| \n01231|     console.log(`üîç –ü–æ–∏—Å–∫ cityID –¥–ª—è –≥–æ—Ä–æ–¥–∞: \"${normalizedSearch}\"`);\n01232| \n01233|     // –ü–æ–∏—Å–∫ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ\n01234|     for (const city of cities) {\n01235|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –∏–º–µ–Ω–µ–º –≥–æ—Ä–æ–¥–∞\n01236|       if (city.name.toLowerCase() === normalizedSearch) {\n01237|         console.log(`‚úÖ –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: \"${city.name}\" -> cityID: ${city.cityID}`);\n01238|         return city.cityID;\n01239|       }\n01240| \n01241|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –ø–æ–∏—Å–∫–æ–≤—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏\n01242|       for (const searchString of city.searchStrings) {\n01243|         if (searchString === normalizedSearch) {\n01244|           console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ –≤ –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫–∞—Ö: \"${searchString}\" –¥–ª—è –≥–æ—Ä–æ–¥–∞ \"${city.name}\" -> cityID: ${city.cityID}`);\n01245|           return city.cityID;\n01246|         }\n01247|       }\n01248|     }\n01249| \n01250|     console.warn(`‚ö†Ô∏è cityID –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –¥–ª—è –≥–æ—Ä–æ–¥–∞: \"${normalizedSearch}\"`);\n01251|     return null;\n01252|   };\n01253| \n01254|   // –ü–æ–ª—É—á–µ–Ω–∏–µ cityID —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n01255|   const findCityInDellinDirectory = async (cityName: string): Promise<{cityID: number, code: string} | null> => {\n01256|     try {\n01257|       console.log(`üîç –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –î–õ: ${cityName}`);\n01258|       \n01259|       // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞\n01260|       const normalizedCity = cityName.toLowerCase().trim()\n01261|         .replace(/^–≥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥ \"\n01262|         .replace(/^–≥–æ—Ä–æ–¥\\s+/, '') // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å \"–≥–æ—Ä–æ–¥ \"\n01263|         .replace(/\\s+/g, ' '); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—Ä–æ–±–µ–ª—ã\n01264|       \n01265|       // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞—Å–µ–ª–µ–Ω–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤\n01266|       const response = await fetch('https://api.dellin.ru/v2/public/kladr.json', {\n01267|         method: 'POST',\n01268|         headers: {\n01269|           'Content-Type': 'application/json'\n01270|         },\n01271|         body: JSON.stringify({\n01272|           appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n01273|           q: normalizedCity,\n01274|           limit: 10\n01275|         })\n01276|       });\n01277|       \n01278|       const data = await response.json();\n01279|       console.log(`üèôÔ∏è –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞ \"${normalizedCity}\" response:`, data);\n01280|       \n01281|       if (response.ok && data.cities && Array.isArray(data.cities) && data.cities.length > 0) {\n01282|         // –ò—â–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–ª–∏ –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –≥–æ—Ä–æ–¥\n01283|         let bestMatch = data.cities.find((city: any) => \n01284|           city.searchString?.toLowerCase() === normalizedCity ||\n01285|           city.aString?.toLowerCase().includes(normalizedCity)\n01286|         );\n01287|         \n01288|         // –ï—Å–ª–∏ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –Ω–µ—Ç, –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞–º–∏\n01289|         if (!bestMatch) {\n01290|           bestMatch = data.cities.find((city: any) => city.isTerminal === 1);\n01291|         }\n01292|         \n01293|         // –ï—Å–ª–∏ –∏ —ç—Ç–æ–≥–æ –Ω–µ—Ç, –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π\n01294|         if (!bestMatch) {\n01295|           bestMatch = data.cities[0];\n01296|         }\n01297|         \n01298|         if (bestMatch) {\n01299|           console.log(`‚úÖ –ù–∞–π–¥–µ–Ω –≥–æ—Ä–æ–¥:`, {\n01300|             cityID: bestMatch.cityID,\n01301|             name: bestMatch.aString,\n01302|             code: bestMatch.code,\n01303|             hasTerminals: bestMatch.isTerminal === 1\n01304|           });\n01305|           \n01306|           return {\n01307|             cityID: bestMatch.cityID,\n01308|             code: bestMatch.code\n01309|           };\n01310|         }\n01311|       }\n01312|       \n01313|       console.warn(`‚ö†Ô∏è –ì–æ—Ä–æ–¥ \"${normalizedCity}\" –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –î–õ`);\n01314|       return null;\n01315|       \n01316|     } catch (error) {\n01317|       console.error(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –≥–æ—Ä–æ–¥–∞ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –î–õ:`, error);\n01318|       return null;\n01319|     }\n01320|   };\n01321|   \n01322| \n01323|   \n01324|   // –ü–æ–∏—Å–∫ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ —Ä–∞–±–æ—á–∏–π v1 API (–∏–∑ test-dellin-terminals-simple.js)\n01325|   const getDellinTerminalByDirection = async (citySearch: string, direction: 'arrival' | 'derival'): Promise<string | null> => {\n01326|     try {\n01327|       console.log(`üîç –†–ê–ë–û–ß–ò–ô v1 API: –ü–æ–∏—Å–∫ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ ${direction} –¥–ª—è –≥–æ—Ä–æ–¥–∞: ${citySearch}`);\n01328|       \n01329|       // –ü–æ–ª—É—á–∞–µ–º sessionID –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞\n01330|       const sessionID = await getDellinSessionId();\n01331|       if (!sessionID) {\n01332|         console.error('‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç sessionID –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤');\n01333|         return null;\n01334|       }\n01335|       \n01336|       // –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ —Ä–∞–±–æ—á–µ–º—É API\n01337|       const requestData = {\n01338|         appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n01339|         sessionID: sessionID,\n01340|         search: citySearch,\n01341|         direction: direction\n01342|       };\n01343|       \n01344|       console.log(`üì§ –ó–∞–ø—Ä–æ—Å —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤:`, requestData);\n01345|       \n01346|       const response = await fetch('https://api.dellin.ru/v1/public/request_terminals.json', {\n01347|         method: 'POST',\n01348|         headers: {\n01349|           'Content-Type': 'application/json'\n01350|         },\n01351|         body: JSON.stringify(requestData)\n01352|       });\n01353|       \n01354|       const data = await response.json();\n01355|       console.log(`üì• –û—Ç–≤–µ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ (${response.status}):`, data);\n01356|       \n01357|       if (!response.ok) {\n01358|         console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤:', data);\n01359|         return null;\n01360|       }\n01361|       \n01362|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –≤ –æ—Ç–≤–µ—Ç–µ\n01363|       const terminals = data.terminals || [];\n01364|       if (terminals.length === 0) {\n01365|         console.warn(`‚ö†Ô∏è –¢–µ—Ä–º–∏–Ω–∞–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è –≥–æ—Ä–æ–¥–∞ \"${citySearch}\"`);\n01366|         return null;\n01367|       }\n01368|       \n01369|       // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª\n01370|       const selectedTerminal = terminals[0];\n01371|       \n01372|       console.log(`‚úÖ –ù–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª ${direction}:`, {\n01373|         id: selectedTerminal.id,\n01374|         name: selectedTerminal.name,\n01375|         address: selectedTerminal.address\n01376|       });\n01377|       \n01378|       return selectedTerminal.id.toString();\n01379|       \n01380|     } catch (error) {\n01381|       console.error(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ ${direction} (v1 API):`, error);\n01382|       return null;\n01383|     }\n01384|   };\n01385| \n01386|   // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏ –¥–ª—è –≥–æ—Ä–æ–¥–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º)\n01387|   const getDellinTerminal = async (citySearch: string): Promise<string | null> => {\n01388|     return getDellinTerminalByDirection(citySearch, 'arrival');\n01389|   };\n01390|   \n01391|   // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ DaData –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π\n01392|   const normalizeAddressForDellin = async (address: string): Promise<string> => {\n01393|     try {\n01394|       console.log(`üåê –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ DaData: ${address}`);\n01395|       \n01396|       const response = await fetch('/api/dadata', {\n01397|         method: 'POST',\n01398|         headers: {\n01399|           'Content-Type': 'application/json'\n01400|         },\n01401|         body: JSON.stringify({\n01402|           address: address,\n01403|           type: 'clean'\n01404|         })\n01405|       });\n01406|       \n01407|       const data = await response.json();\n01408|       console.log(`üåê DaData response:`, data);\n01409|       \n01410|       if (data.success && data.data?.dellinFormat) {\n01411|         console.log(`‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å: ${data.data.dellinFormat}`);\n01412|         return data.data.dellinFormat;\n01413|       }\n01414|       \n01415|       // –ï—Å–ª–∏ DaData –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∞–¥—Ä–µ—Å\n01416|       console.warn(`‚ö†Ô∏è DaData –Ω–µ —Å–º–æ–≥ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π`);\n01417|       return address;\n01418|       \n01419|     } catch (error) {\n01420|       console.error(`‚ùå –û—à–∏–±–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ DaData:`, error);\n01421|       return address; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∞–¥—Ä–µ—Å –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏\n01422|     }\n01423|   };\n01424| \n01425|   // –ü–æ–ª—É—á–µ–Ω–∏–µ UID —É–ø–∞–∫–æ–≤–∫–∏ —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π workflow —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –î–õ\n01426|   const getDellinPackageUid = async (packageName: string = 'crate_with_bubble'): Promise<string | null> => {\n01427|     try {\n01428|       console.log(`üì¶ CSV WORKFLOW: –ü–æ–ª—É—á–µ–Ω–∏–µ UID —É–ø–∞–∫–æ–≤–∫–∏ \"${packageName}\" —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π workflow...`);\n01429|       console.log('üì¶ CSV WORKFLOW: API –î–õ ‚Üí CSV —Å—Å—ã–ª–∫–∞ ‚Üí —Å–∫–∞—á–∞—Ç—å CSV ‚Üí –ø–∞—Ä—Å–∏—Ç—å ‚Üí –ø–æ–ª—É—á–∏—Ç—å UID');\n01430|       \n01431|       const response = await fetch('/api/dellin-packages', {\n01432|         method: 'GET',\n01433|         headers: {\n01434|           'Content-Type': 'application/json'\n01435|         }\n01436|       });\n01437| \n01438|       const data = await response.json();\n01439|       console.log('üì¶ CSV WORKFLOW response.ok:', response.ok);\n01440|       console.log('üì¶ CSV WORKFLOW status:', response.status);\n01441|       console.log('üì¶ CSV WORKFLOW workflow info:', data.workflow || 'not specified');\n01442|       \n01443|       if (response.ok && data.success && data.data && Array.isArray(data.data)) {\n01444|         console.log('üì¶ CSV WORKFLOW: —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫');\n01445|         console.log('üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–ø–∞–∫–æ–≤–æ–∫ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ:', data.data.length);\n01446|         console.log('üì¶ –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:', data.cached ? '–∫—ç—à (24—á)' : '—Å–≤–µ–∂–∏–π CSV —Ñ–∞–π–ª');\n01447|         if (data.csvUrl) {\n01448|           console.log('üì¶ CSV URL:', data.csvUrl);\n01449|         }\n01450|         \n01451|         // –ü–æ–∏—Å–∫ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –≤–∞—Ä–∏–∞–Ω—Ç–∞–º –Ω–∞–∑–≤–∞–Ω–∏—è\n01452|         const searchTerms = [\n01453|           packageName,\n01454|           '–æ–±—Ä–µ—à–µ—Ç–∫–∞',\n01455|           '–æ–±—Ä–µ—à—ë—Ç–∫–∞',\n01456|           '–∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è',\n01457|           'bubble',\n01458|           '–∑–∞—â–∏—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞'\n01459|         ];\n01460|         \n01461|         let foundPackage: any = null;\n01462|         \n01463|         for (const term of searchTerms) {\n01464|           foundPackage = data.data.find((pkg: any) => \n01465|             pkg.name && pkg.name.toLowerCase().includes(term.toLowerCase())\n01466|           );\n01467|           \n01468|           if (foundPackage) {\n01469|             console.log(`‚úÖ CSV WORKFLOW: –ù–∞–π–¥–µ–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∞ –ø–æ —Ç–µ—Ä–º–∏–Ω—É \"${term}\": ${foundPackage.name} ‚Üí ${foundPackage.uid}`);\n01470|             break;\n01471|           }\n01472|         }\n01473|         \n01474|         if (foundPackage && foundPackage.uid) {\n01475|           return foundPackage.uid;\n01476|         } else {\n01477|           console.log('‚ùå CSV WORKFLOW: –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –ø–æ –ø–æ–∏—Å–∫–æ–≤—ã–º —Ç–µ—Ä–º–∏–Ω–∞–º');\n01478|           \n01479|           // –í—ã–≤–æ–¥–∏–º –ø–µ—Ä–≤—ã–µ 10 —É–ø–∞–∫–æ–≤–æ–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n01480|           console.log('üì¶ –î–æ—Å—Ç—É–ø–Ω—ã–µ —É–ø–∞–∫–æ–≤–∫–∏ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ (–ø–µ—Ä–≤—ã–µ 10):');\n01481|           data.data.slice(0, 10).forEach((pkg: any, index: number) => {\n01482|             console.log(`  ${index + 1}. ${pkg.name} (${pkg.uid})`);\n01483|           });\n01484|         }\n01485|       } else {\n01486|         console.error('‚ùå CSV WORKFLOW: –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞:', data);\n01487|       }\n01488|       \n01489|       return null;\n01490|         \n01491|     } catch (error) {\n01492|       console.error('‚ùå CSV WORKFLOW: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', error);\n01493|       return null;\n01494|     }\n01495|   };\n01496| \n01497|   // –†–∞—Å—á–µ—Ç –¥–ª—è –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π —á–µ—Ä–µ–∑ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π API v2/calculator.json —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n01498|   const calculateDellin = async (): Promise<CalculationResult> => {\n01499|     const { enhancedApiRequest } = await import('@/lib/api-utils');\n01500|     const apiUrl = 'https://api.dellin.ru/v2/calculator.json';\n01501|     const maxRetries = 2;\n01502|     \n01503|     console.log('üöÄ === –ù–ê–ß–ê–õ–û –†–ê–°–ß–ï–¢–ê –î–ï–õ–û–í–´–• –õ–ò–ù–ò–ô ===');\n01504|     console.log('üöÄ API URL:', apiUrl);\n01505|     \n01506|     try {\n01507|       let sessionID = await getDellinSessionId();\n01508|       \n01509|       if (!sessionID) {\n01510|         return {\n01511|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01512|           price: 0,\n01513|           days: 0,\n01514|           error: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å sessionID',\n01515|           apiUrl,\n01516|           requestData: null,\n01517|           responseData: null\n01518|         };\n01519|       }\n01520| \n01521|       // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏ –æ–±—ä–µ–º—ã\n01522|       const totalWeight = form.cargos.reduce((sum, cargo) => sum + cargo.weight, 0);\n01523|       const totalVolume = form.cargos.reduce((sum, cargo) => \n01524|         sum + (cargo.length * cargo.width * cargo.height) / 1000000, 0\n01525|       );\n01526|       const maxLength = Math.max(...form.cargos.map(c => c.length)) / 100; // –≤ –º–µ—Ç—Ä–∞—Ö\n01527|       const maxWidth = Math.max(...form.cargos.map(c => c.width)) / 100;\n01528|       const maxHeight = Math.max(...form.cargos.map(c => c.height)) / 100;\n01529| \n01530|       // –ü–æ–ª—É—á–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª—ã –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∞–¥—Ä–µ—Å–∞\n01531|       let fromTerminalId: string | null = null;\n01532|       let toTerminalId: string | null = null;\n01533|       let normalizedFromAddress: string | null = null;\n01534|       let normalizedToAddress: string | null = null;\n01535|       \n01536|       // –î–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ–ª—É—á–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª—ã\n01537|       if (!form.fromAddressDelivery) {\n01538|         fromTerminalId = await getDellinTerminalByDirection(form.fromCity, 'derival');\n01539|       } else {\n01540|         // –î–ª—è –∞–¥—Ä–µ—Å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∞–¥—Ä–µ—Å\n01541|         const addressToNormalize = form.fromAddress || form.fromCity;\n01542|         normalizedFromAddress = await normalizeAddressForDellin(addressToNormalize);\n01543|       }\n01544|       \n01545|       if (!form.toAddressDelivery) {\n01546|         toTerminalId = await getDellinTerminalByDirection(form.toCity, 'arrival');\n01547|       } else {\n01548|         // –î–ª—è –∞–¥—Ä–µ—Å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∞–¥—Ä–µ—Å\n01549|         const addressToNormalize = form.toAddress || form.toCity;\n01550|         normalizedToAddress = await normalizeAddressForDellin(addressToNormalize);\n01551|       }\n01552|       \n01553|       console.log('üè¢ –î–ê–ù–ù–´–ï –î–õ:');\n01554|       console.log('üè¢ form.fromAddressDelivery:', form.fromAddressDelivery);\n01555|       console.log('üè¢ form.toAddressDelivery:', form.toAddressDelivery);\n01556|       console.log('üè¢ fromTerminalId:', fromTerminalId);\n01557|       console.log('üè¢ toTerminalId:', toTerminalId);\n01558|       console.log('üè¢ normalizedFromAddress:', normalizedFromAddress);\n01559|       console.log('üè¢ normalizedToAddress:', normalizedToAddress);\n01560|       \n01561|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã –Ω–∞–π–¥–µ–Ω—ã –¢–û–õ–¨–ö–û –¥–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏\n01562|       if (!form.fromAddressDelivery && !fromTerminalId) {\n01563|         console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –≥–æ—Ä–æ–¥–∞:', form.fromCity);\n01564|         return {\n01565|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01566|           price: 0,\n01567|           days: 0,\n01568|           error: `–ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π –≤ –≥–æ—Ä–æ–¥–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è: ${form.fromCity}`,\n01569|           apiUrl,\n01570|           requestData: null,\n01571|           responseData: null\n01572|         };\n01573|       }\n01574|       \n01575|       if (!form.toAddressDelivery && !toTerminalId) {\n01576|         console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≥–æ—Ä–æ–¥–∞:', form.toCity);\n01577|         return {\n01578|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01579|           price: 0,\n01580|           days: 0,\n01581|           error: `–ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –î–µ–ª–æ–≤—ã—Ö –õ–∏–Ω–∏–π –≤ –≥–æ—Ä–æ–¥–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: ${form.toCity}`,\n01582|           apiUrl,\n01583|           requestData: null,\n01584|           responseData: null\n01585|         };\n01586|       }\n01587|       \n01588|       // –î–ª—è –∞–¥—Ä–µ—Å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∞–¥—Ä–µ—Å–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã\n01589|       if (form.fromAddressDelivery && !normalizedFromAddress) {\n01590|         console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è:', form.fromAddress || form.fromCity);\n01591|         return {\n01592|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01593|           price: 0,\n01594|           days: 0,\n01595|           error: `–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è: ${form.fromAddress || form.fromCity}`,\n01596|           apiUrl,\n01597|           requestData: null,\n01598|           responseData: null\n01599|         };\n01600|       }\n01601|       \n01602|       if (form.toAddressDelivery && !normalizedToAddress) {\n01603|         console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:', form.toAddress || form.toCity);\n01604|         return {\n01605|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01606|           price: 0,\n01607|           days: 0,\n01608|           error: `–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: ${form.toAddress || form.toCity}`,\n01609|           apiUrl,\n01610|           requestData: null,\n01611|           responseData: null\n01612|         };\n01613|       }\n01614| \n01615|       // –ü–æ–ª—É—á–∞–µ–º UID —É–ø–∞–∫–æ–≤–∫–∏ crate_with_bubble (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∞)\n01616|       let packageUid: string | null = null;\n01617|       console.log('=== –ù–ê–ß–ê–õ–û –û–¢–õ–ê–î–ö–ò –£–ü–ê–ö–û–í–ö–ò ===');\n01618|       console.log('üîç –û–¢–õ–ê–î–ö–ê –£–ü–ê–ö–û–í–ö–ò: form.needPackaging =', form.needPackaging);\n01619|       console.log('üîç –û–¢–õ–ê–î–ö–ê –£–ü–ê–ö–û–í–ö–ò: typeof form.needPackaging =', typeof form.needPackaging);\n01620|       \n01621|       if (form.needPackaging) {\n01622|         console.log('üîç ‚úÖ –£–ü–ê–ö–û–í–ö–ê –¢–†–ï–ë–£–ï–¢–°–Ø - –ó–ê–ü–†–ê–®–ò–í–ê–ï–ú UID —á–µ—Ä–µ–∑ CSV WORKFLOW...');\n01623|         try {\n01624|           packageUid = await getDellinPackageUid('crate_with_bubble');\n01625|           console.log('üîç ‚úÖ –ü–û–õ–£–ß–ï–ù packageUid –∏–∑ CSV WORKFLOW:', packageUid);\n01626|           \n01627|           // –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ UID –∏–∑ CSV, –∏—Å–ø–æ–ª—å–∑—É–µ–º UID —Å —Å–∞–π—Ç–∞ –î–õ (–∏—Å–ø—Ä–∞–≤–ª—è–µ–º —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ 500‚ÇΩ)\n01628|           if (!packageUid) {\n01629|             packageUid = '0x9dd8901b0ecef10c11e8ed001199bf6e'; // UID —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ –î–õ\n01630|             console.log('üîç üß™ –ò–°–ü–û–õ–¨–ó–£–ï–ú UID –° –°–ê–ô–¢–ê –î–õ (–∏—Å–ø—Ä–∞–≤–ª—è–µ–º —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ):', packageUid);\n01631|           }\n01632|           \n01633|           console.log('üîç ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô packageUid:', packageUid);\n01634|           console.log('üîç ‚úÖ typeof packageUid:', typeof packageUid);\n01635|           console.log('üîç ‚úÖ packageUid truthy:', !!packageUid);\n01636|         } catch (error) {\n01637|           console.log('üîç ‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ packageUid —á–µ—Ä–µ–∑ CSV WORKFLOW:', error);\n01638|           // –ò—Å–ø–æ–ª—å–∑—É–µ–º UID —Å —Å–∞–π—Ç–∞ –î–õ –∫–∞–∫ fallback (–∏—Å–ø—Ä–∞–≤–ª—è–µ–º —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ)\n01639|           packageUid = '0x9dd8901b0ecef10c11e8ed001199bf6e'; // UID —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ –î–õ\n01640|           console.log('üîç üß™ –ò–°–ü–û–õ–¨–ó–£–ï–ú UID –° –°–ê–ô–¢–ê –î–õ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ (–∏—Å–ø—Ä–∞–≤–ª—è–µ–º —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ):', packageUid);\n01641|         }\n01642|       } else {\n01643|         console.log('üîç ‚ùå –£–ø–∞–∫–æ–≤–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ UID');\n01644|       }\n01645|       console.log('=== –ö–û–ù–ï–¶ –û–¢–õ–ê–î–ö–ò –£–ü–ê–ö–û–í–ö–ò ===');\n01646| \n01647|       // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞—Ç—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞\n01648|       const tomorrow = new Date();\n01649|       tomorrow.setDate(tomorrow.getDate() + 1);\n01650|       const produceDate = tomorrow.toISOString().split('T')[0];\n01651| \n01652|       // –û—Ç–ª–∞–¥–∫–∞ –ø–µ—Ä–µ–¥ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–∞\n01653|       console.log('=== –û–¢–õ–ê–î–ö–ê –§–û–†–ú–ò–†–û–í–ê–ù–ò–Ø –ó–ê–ü–†–û–°–ê ===');\n01654|       console.log('üîç form.needPackaging =', form.needPackaging, '(—Ç–∏–ø:', typeof form.needPackaging, ')');\n01655|       console.log('üîç packageUid =', packageUid, '(—Ç–∏–ø:', typeof packageUid, ')');\n01656|       console.log('üîç packageUid truthy =', !!packageUid);\n01657|       console.log('üîç –£—Å–ª–æ–≤–∏–µ (form.needPackaging && packageUid) =', form.needPackaging && packageUid);\n01658|       \n01659|       if (form.needPackaging && packageUid) {\n01660|         console.log('‚úÖ PACKAGES –ë–£–î–ï–¢ –î–û–ë–ê–í–õ–ï–ù –í –ó–ê–ü–†–û–°!');\n01661|       } else {\n01662|         console.log('‚ùå PACKAGES –ù–ï –ë–£–î–ï–¢ –î–û–ë–ê–í–õ–ï–ù:');\n01663|         if (!form.needPackaging) console.log('  - form.needPackaging = false');\n01664|         if (!packageUid) console.log('  - packageUid –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç/null');\n01665|       }\n01666| \n01667|       // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n01668|       const requestData = {\n01669|         appkey: 'E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B',\n01670|         sessionID: sessionID,\n01671|         delivery: {\n01672|           deliveryType: {\n01673|             type: 'auto'  // –í—Å–µ–≥–¥–∞ \"auto\" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n01674|           },\n01675|           derival: {\n01676|             produceDate: produceDate,  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –¥–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n01677|             variant: form.fromAddressDelivery ? 'address' : 'terminal',\n01678|             ...(form.fromAddressDelivery ? {\n01679|               address: {\n01680|                 search: normalizedFromAddress || form.fromAddress || form.fromCity\n01681|               }\n01682|             } : {\n01683|               terminalID: fromTerminalId\n01684|             }),\n01685|             time: {\n01686|               worktimeStart: '10:00',\n01687|               worktimeEnd: '18:00',\n01688|               breakStart: '13:00',\n01689|               breakEnd: '14:00',\n01690|               exactTime: false\n01691|             }\n01692|             // handling –≤ derival –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n01693|           },\n01694|           arrival: {\n01695|             variant: form.toAddressDelivery ? 'address' : 'terminal',\n01696|             ...(form.toAddressDelivery ? {\n01697|               address: {\n01698|                 search: normalizedToAddress || form.toAddress || form.toCity\n01699|               }\n01700|             } : {\n01701|               terminalID: toTerminalId\n01702|             }),\n01703|             time: {\n01704|               worktimeStart: '10:00',\n01705|               worktimeEnd: '18:00',\n01706|               breakStart: '13:00',\n01707|               breakEnd: '14:00',\n01708|               exactTime: false\n01709|             },\n01710|             // handling –≤ arrival –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—ä–µ–º\n01711|             ...(form.needCarry ? {\n01712|               handling: {\n01713|                 freightLift: form.hasFreightLift, // true —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –≥–∞–ª–æ—á–∫–∞ \"–Ω–∞–ª–∏—á–∏–µ –≥—Ä—É–∑–æ–≤–æ–≥–æ –ª–∏—Ñ—Ç–∞\"\n01714|                 toFloor: form.floor, // —ç—Ç–∞–∂ –∏–∑ —Ñ–æ—Ä–º—ã\n01715|                 carry: 0\n01716|               }\n01717|             } : {})\n01718|           },\n01719|           ...(form.needPackaging && packageUid ? {\n01720|             packages: [{\n01721|               uid: packageUid,  // UID —É–ø–∞–∫–æ–≤–∫–∏ crate_with_bubble –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞\n01722|               count: 1  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1\n01723|             }]\n01724|           } : {})\n01725|         },\n01726|         cargo: {\n01727|           quantity: form.cargos.length,\n01728|           length: maxLength,\n01729|           width: maxWidth,\n01730|           height: maxHeight,\n01731|           weight: totalWeight,\n01732|           totalVolume: totalVolume,\n01733|           totalWeight: totalWeight,\n01734|           oversizedWeight: 0,\n01735|           oversizedVolume: 0,\n01736|           hazardClass: 0,  // –í—Å–µ–≥–¥–∞ 0 –µ—Å–ª–∏ –Ω–µ—Ç –æ–ø–∞—Å–Ω—ã—Ö –≥—Ä—É–∑–æ–≤\n01737|           ...(form.needInsurance && form.declaredValue > 0 ? {\n01738|             insurance: {\n01739|               statedValue: form.declaredValue,\n01740|               term: true  // –í—Å–µ–≥–¥–∞ true –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è\n01741|             }\n01742|           } : {})\n01743|         },\n01744|         payment: {\n01745|           type: 'noncash',  // –í—Å–µ–≥–¥–∞ \"noncash\"\n01746|           paymentCitySearch: {\n01747|             search: form.fromCity  // –ì–æ—Ä–æ–¥ –æ–ø–ª–∞—Ç—ã\n01748|           }\n01749|         }\n01750|       };\n01751| \n01752|       console.log('üöÄ –ò–¢–û–ì–û–í–´–ô –ó–ê–ü–†–û–° –ö –î–õ:', JSON.stringify(requestData, null, 2));\n01753|       \n01754|       // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∞ packages\n01755|       if (requestData.delivery.packages) {\n01756|         console.log('‚úÖ PACKAGES –ù–ê–ô–î–ï–ù –í –ó–ê–ü–†–û–°–ï:', requestData.delivery.packages);\n01757|       } else {\n01758|         console.log('‚ùå PACKAGES –ù–ï –ù–ê–ô–î–ï–ù –í –ó–ê–ü–†–û–°–ï');\n01759|         console.log('   form.needPackaging =', form.needPackaging);\n01760|         console.log('   packageUid =', packageUid);\n01761|         console.log('   –£—Å–ª–æ–≤–∏–µ:', form.needPackaging && packageUid);\n01762|       }\n01763| \n01764|       // –ü–æ–ø—ã—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö\n01765|       let response: any = null;\n01766|       let data: any = null;\n01767|       \n01768|       for (let attempt = 1; attempt <= maxRetries; attempt++) {\n01769|         console.log(`üîÑ –î–õ: –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ ${attempt}/${maxRetries}`);\n01770|         \n01771|         const result = await enhancedApiRequest(\n01772|           apiUrl,\n01773|           {\n01774|             method: 'POST',\n01775|             headers: {\n01776|               'Content-Type': 'application/json',\n01777|               'Accept': 'application/json'\n01778|             },\n01779|             body: JSON.stringify(requestData)\n01780|           },\n01781|           { operation: 'calculate', company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏' }\n01782|         );\n01783| \n01784|         if (result && typeof result === 'object' && 'success' in result && !result.success) {\n01785|           console.error('‚ùå –î–õ API –æ—à–∏–±–∫–∞:', result.error);\n01786|           // For Dellin, we still want to handle retries manually for session renewal\n01787|           // So we'll create a mock response that indicates failure\n01788|           response = {\n01789|             ok: false,\n01790|             status: 500,\n01791|             json: async () => ({ error: result.error.message })\n01792|           } as any;\n01793|           data = { error: result.error.message };\n01794|         } else {\n01795|           response = result as Response;\n01796|           try {\n01797|             data = await response.json();\n01798|           } catch (parseError) {\n01799|             console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –æ—Ç–≤–µ—Ç–∞ –î–õ:', parseError);\n01800|             throw new Error(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ API: ${parseError instanceof Error ? parseError.message : '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);\n01801|           }\n01802|         }\n01803|         \n01804|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ response.ok:', response.ok);\n01805|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ status:', response.status);\n01806|         console.log('üöÄ –û–¢–í–ï–¢ –î–õ data:', data);\n01807|         \n01808|         // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\n01809|         const isAuthError = response.status === 401 || \n01810|                            response.status === 403 ||\n01811|                            (response.status === 400 && data?.errors?.some((err: any) => \n01812|                              err.detail?.toLowerCase()?.includes('session') ||\n01813|                              err.detail?.toLowerCase()?.includes('auth') ||\n01814|                              err.detail?.toLowerCase()?.includes('invalid')\n01815|                            ));\n01816| \n01817|         if (isAuthError && attempt < maxRetries) {\n01818|           console.log('üîÑ –î–õ: –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –≤—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...');\n01819|           const newSessionId = await getDellinSessionId();\n01820|           if (newSessionId) {\n01821|             console.log('‚úÖ –î–õ: –ø–æ–ª—É—á–µ–Ω –Ω–æ–≤—ã–π SessionID, –æ–±–Ω–æ–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å...');\n01822|             // –û–±–Ω–æ–≤–ª—è–µ–º sessionID –≤ –∑–∞–ø—Ä–æ—Å–µ\n01823|             requestData.sessionID = newSessionId;\n01824|             sessionID = newSessionId;\n01825|             continue; // –ü—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —Å –Ω–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π\n01826|           } else {\n01827|             console.error('‚ùå –î–õ: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π SessionID');\n01828|             break;\n01829|           }\n01830|         }\n01831|         \n01832|         if (response.status === 400 && data?.errors) {\n01833|           console.log('=== –ê–ù–ê–õ–ò–ó –û–®–ò–ë–ö–ò 400 ===');\n01834|           console.log('üîç –û—à–∏–±–∫–∏:', data.errors);\n01835|           data.errors.forEach((error: any, index: number) => {\n01836|             console.log(`üîç –û—à–∏–±–∫–∞ ${index + 1}:`, error);\n01837|             console.log(`   - –ü–æ–ª–µ: ${error.field || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`);\n01838|             console.log(`   - –°–æ–æ–±—â–µ–Ω–∏–µ: ${error.detail || error.message || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`);\n01839|           });\n01840|           console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –û–®–ò–ë–ö–ò 400 ===');\n01841|         }\n01842| \n01843|         // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–Ω—ã–π –∏–ª–∏ –Ω–µ —Å–≤—è–∑–∞–Ω —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É\n01844|         break;\n01845|       }\n01846| \n01847|       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –æ—à–∏–±–∫–∏ –ü–ï–†–ï–î –∞–Ω–∞–ª–∏–∑–æ–º –¥–∞–Ω–Ω—ã—Ö\n01848|       if (!response.ok || !data.data) {\n01849|         console.log('‚ùå –û—à–∏–±–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç API - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö');\n01850|         const errorMessage = data.metadata?.detail || \n01851|                            data.metadata?.message || \n01852|                            data.errors?.[0]?.detail || \n01853|                            (data.metadata?.status !== 200 ? `HTTP ${data.metadata?.status}` : '') ||\n01854|                            `HTTP ${response.status} - ${response.statusText}` ||\n01855|                            '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏';\n01856|         return {\n01857|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01858|           price: 0,\n01859|           days: 0,\n01860|           error: errorMessage,\n01861|           requestData,\n01862|           responseData: data,\n01863|           apiUrl,\n01864|           sessionId: sessionID\n01865|         };\n01866|       }\n01867|       \n01868|       // –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –°–¢–†–ê–•–û–í–ö–ò (—Ç–æ–ª—å–∫–æ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞)\n01869|       console.log('=== –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –°–¢–†–ê–•–û–í–ö–ò ===');\n01870|       console.log('üîç –ü–†–û–í–ï–†–ö–ê –°–¢–†–£–ö–¢–£–†–´ –î–ê–ù–ù–´–•:');\n01871|       console.log('üîç data:', data ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n01872|       console.log('üîç typeof data:', typeof data);\n01873|       console.log('üîç data.data:', data?.data ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : 'undefined/null');\n01874|       console.log('üîç typeof data.data:', typeof data?.data);\n01875|       \n01876|       // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–π—Å—Ç–≤ data.data\n01877|       if (data?.data) {\n01878|         console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤–æ–π—Å—Ç–≤–∞ data.data:');\n01879|         console.log('üîç data.data.derival:', typeof data.data.derival, data.data.derival);\n01880|         console.log('üîç data.data.arrival:', typeof data.data.arrival, data.data.arrival);\n01881|         console.log('üîç data.data.intercity:', typeof data.data.intercity, data.data.intercity);\n01882|       }\n01883|       \n01884|       if (!data) {\n01885|         console.error('‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: data undefined/null');\n01886|         return {\n01887|           company: '–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏',\n01888|           price: 0,\n01889|           days: 0,\n01890|           error: '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ API: –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã',\n01891|           apiUrl,\n01892|           requestData,\n01893|           responseData: null\n01894|         };\n01895|       }\n01896|       \n01897|       try {\n01898|         console.log('üîç –ü–û–õ–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê data.data:', JSON.stringify(data.data, null, 2));\n01899|       } catch (jsonError) {\n01900|         console.error('‚ùå –û—à–∏–±–∫–∞ JSON.stringify –¥–ª—è data.data:', jsonError);\n01901|         console.log('üîç data.data (toString):', data.data?.toString?.() || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å');\n01902|       }\n01903|       \n01904|       // –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç—Ä–∞—Ö–æ–≤–∫–æ–π\n01905|       console.log('üí≥ –ü–û–ò–°–ö –ö–û–ú–ü–û–ù–ï–ù–¢–û–í –°–¢–†–ê–•–û–í–ö–ò:');\n01906|       console.log('üí≥ data.data.insurance:', data.data?.insurance);\n01907|       console.log('üí≥ data.data.cargoInsurance:', data.data?.cargoInsurance);\n01908|       console.log('üí≥ data.data.termInsurance:', data.data?.termInsurance);\n01909|       console.log('üí≥ data.data.insuranceDetails:', data.data?.insuranceDetails);\n01910|       console.log('üí≥ data.data.services:', data.data?.services);\n01911|       console.log('üí≥ data.data.additionalServices:', data.data?.additionalServices);\n01912|       \n01913|       // –ü–æ–∏—Å–∫ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏ –≤ –¥—Ä—É–≥–∏—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö\n01914|       try {\n01915|         console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º derival...');\n01916|         if (data.data?.derival) {\n01917|           console.log('üí≥ derival –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n01918|           console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –ó–ê–ë–û–ï data.data.derival.insurance:', data.data.derival?.insurance);\n01919|         } else {\n01920|           console.log('üí≥ derival –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n01921|         }\n01922|         \n01923|         console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º arrival...');\n01924|         if (data.data?.arrival) {\n01925|           console.log('üí≥ arrival –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n01926|           console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –î–û–°–¢–ê–í–ö–ï data.data.arrival.insurance:', data.data.arrival?.insurance);\n01927|         } else {\n01928|           console.log('üí≥ arrival –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n01929|         }\n01930|         \n01931|         console.log('üí≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º intercity...');\n01932|         if (data.data?.intercity) {\n01933|           console.log('üí≥ intercity –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º insurance...');\n01934|           console.log('üí≥ –°–¢–†–ê–•–û–í–ö–ê –í –ü–ï–†–ï–í–û–ó–ö–ï data.data.intercity.insurance:', data.data.intercity?.insurance);\n01935|         } else {\n01936|           console.log('üí≥ intercity –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ null');\n01937|         }\n01938|       } catch (error) {\n01939|         console.error('‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–µ–∫—Ü–∏–π —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏:', error);\n01940|         console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', error instanceof Error ? error.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n01941|       }\n01942|       \n01943|       // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö \"insurance\"\n01944|       const findInsuranceFields = (obj: any, path = '') => {\n01945|         if (typeof obj !== 'object' || obj === null || obj === undefined) return;\n01946|         \n01947|         try {\n01948|           Object.keys(obj).forEach(key => {\n01949|             const fullPath = path ? `${path}.${key}` : key;\n01950|             if (key.toLowerCase().includes('insurance') || key.toLowerCase().includes('insur')) {\n01951|               console.log(`üí≥ –ù–ê–ô–î–ï–ù–û –ü–û–õ–ï –°–¢–†–ê–•–û–í–ö–ò [${fullPath}]:`, obj[key]);\n01952|             }\n01953|             if (typeof obj[key] === 'object' && obj[key] !== null && obj[key] !== undefined) {\n01954|               findInsuranceFields(obj[key], fullPath);\n01955|             }\n01956|           });\n01957|         } catch (error) {\n01958|           console.error(`üí≥ –û—à–∏–±–∫–∞ –≤ findInsuranceFields –¥–ª—è –ø—É—Ç–∏ ${path}:`, error);\n01959|         }\n01960|       };\n01961|       \n01962|       console.log('üí≥ –†–ï–ö–£–†–°–ò–í–ù–´–ô –ü–û–ò–°–ö –ü–û–õ–ï–ô –°–¢–†–ê–•–û–í–ö–ò:');\n01963|       try {\n01964|         if (data && data.data) {\n01965|           findInsuranceFields(data.data, 'data.data');\n01966|         } else {\n01967|           console.log('üí≥ –ü—Ä–æ–ø—É—Å–∫ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞: data.data –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');\n01968|         }\n01969|       } catch (error) {\n01970|         console.error('‚ùå –û–®–ò–ë–ö–ê –≤ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–º –ø–æ–∏—Å–∫–µ:', error);\n01971|         console.error('‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', error instanceof Error ? error.stack : '–ù–µ—Ç —Å—Ç–µ–∫–∞');\n01972|       }\n01973|       console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –°–¢–†–ê–•–û–í–ö–ò ===');\n01974|       \n01975|       // –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ packages –≤ –æ—Ç–≤–µ—Ç–µ\n01976|       console.log('=== –ü–û–ò–°–ö PACKAGES –í –û–¢–í–ï–¢–ï ===');\n01977|       console.log('üì¶ data.data =', data.data);\n01978|       console.log('üì¶ data.data.packages =', data.data?.packages);\n01979|       console.log('üì¶ –¢–∏–ø data.data.packages:', typeof data.data?.packages);\n01980|       if (data.data?.packages) {\n01981|         console.log('‚úÖ PACKAGES –ù–ê–ô–î–ï–ù –í –û–¢–í–ï–¢–ï!');\n01982|         try {\n01983|           console.log('üì¶ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ packages:', JSON.stringify(data.data.packages, null, 2));\n01984|         } catch (jsonError) {\n01985|           console.error('‚ùå –û—à–∏–±–∫–∞ JSON.stringify –¥–ª—è packages:', jsonError);\n01986|           console.log('üì¶ packages (toString):', data.data.packages?.toString?.() || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å');\n01987|         }\n01988|       } else {\n01989|         console.log('‚ùå PACKAGES –ù–ï –ù–ê–ô–î–ï–ù –í –û–¢–í–ï–¢–ï');\n01990|       }\n01991|       console.log('=== –ö–û–ù–ï–¶ –ü–û–ò–°–ö–ê PACKAGES ===');\n01992| \n01993|       if (response.ok && data.data && data.metadata?.status === 200) {\n01994|         let totalPrice = data.data.price || 0;\n01995|         console.log('üí∞ –†–ê–°–ß–ï–¢ –ò–¢–û–ì–û–í–û–ô –°–¢–û–ò–ú–û–°–¢–ò:');\n01996|         console.log('üí∞ –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å data.data.price (–£–ñ–ï –í–ö–õ–Æ–ß–ê–ï–¢ –í–°–ï):', totalPrice);\n01997|         \n01998|         // –°–¢–†–ê–•–û–í–ö–ê –£–ñ–ï –í–ö–õ–Æ–ß–ï–ù–ê –≤ data.data.price - –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ\n01999|         if (data.data.insurance) {\n02000|           console.log('üí∞ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ data.data.insurance (–£–ñ–ï –≤–∫–ª—é—á–µ–Ω–∞ –≤ –±–∞–∑–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å):', data.data.insurance);\n\n(File has more lines. Use 'offset' parameter to read beyond line 2000)\n</file>",
    "title": "app/page.tsx",
    "metadata": {
      "preview": "'use client';\n\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Switch } from '@/components/ui/switch';\nimport { Plus, Truck, Building2, Map, Settings, Package2, Trash2 } from 'lucide-react';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { Collapsible, CollapsibleContent } from '@/components/ui/collapsible';\nimport { LazyProductSearch, LazyTruckVisualization } from '@/components/LazyLoadedComponents';\nimport ProductManager from '@/components/ProductManager';\nimport CalculationProgress from '@/components/CalculationProgress';\nimport { FurnitureProduct, ProductInForm, CargoWithMetadata } from '@/lib/furniture-types';\nimport { saveFormData, loadFormData, hasStoredFormData, createDebouncedSaver, clearFormData } from '@/lib/form-storage';\nimport {"
    },
    "time": {
      "start": 1764030578329,
      "end": 1764030578336
    }
  }
}