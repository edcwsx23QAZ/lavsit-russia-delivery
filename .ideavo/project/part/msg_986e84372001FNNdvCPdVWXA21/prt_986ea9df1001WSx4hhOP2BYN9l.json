{
  "id": "prt_986ea9df1001WSx4hhOP2BYN9l",
  "messageID": "msg_986e84372001FNNdvCPdVWXA21",
  "sessionID": "ses_6852784ecffeuHwynj83p2lr14",
  "type": "tool",
  "tool": "read",
  "callID": "toolu_012UMdGdtxv1WNoHd8pjKiPa",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/api/pek/route.ts"
    },
    "output": "<file>\n00001| import { NextRequest, NextResponse } from 'next/server';\n00002| \n00003| export async function POST(request: NextRequest) {\n00004|   try {\n00005|     console.log('üîß –ü–≠–ö –ü—Ä–æ–∫—Å–∏: –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å');\n00006|     \n00007|     const requestData = await request.json();\n00008|     console.log('üìù –î–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞:', JSON.stringify(requestData, null, 2));\n00009|     \n00010|     const { method, address, coordinates } = requestData;\n00011|     \n00012|     const PEK_TOKEN = '624FC93CA677B23673BB476D4982294DC27E246F';\n00013|     const BASE_URL = 'https://api.pecom.ru/v1';\n00014|     \n00015|     let url = '';\n00016|     let body = {};\n00017|     \n00018|     switch (method) {\n00019|       case 'findzonebyaddress':\n00020|         url = `${BASE_URL}/branches/findzonebyaddress/`;\n00021|         body = {\n00022|           address: address\n00023|         };\n00024|         break;\n00025|         \n00026|       case 'findzonebycoordinates':\n00027|         url = `${BASE_URL}/branches/findzonebycoordinates/`;\n00028|         body = {\n00029|           longitude: coordinates.longitude,\n00030|           latitude: coordinates.latitude\n00031|         };\n00032|         break;\n00033|         \n00034|       case 'calculateprice':\n00035|         url = `${BASE_URL}/calculator/calculateprice/`;\n00036|         const { method: methodName, ...calculationData } = requestData;\n00037|         body = calculationData;\n00038|         break;\n00039|         \n00040|       case 'nearestdepartments':\n00041|         url = `${BASE_URL}/branches/nearestdepartments/`;\n00042|         const { method: nearestMethod, ...departmentData } = requestData;\n00043|         body = departmentData;\n00044|         break;\n00045|         \n00046|       case 'test':\n00047|         console.log('üîß –¢–µ—Å—Ç–æ–≤—ã–π –º–µ—Ç–æ–¥ –ø—Ä–æ–∫—Å–∏');\n00048|         return NextResponse.json({ \n00049|           status: 'OK', \n00050|           message: '–ü—Ä–æ–∫—Å–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç',\n00051|           timestamp: new Date().toISOString(),\n00052|           receivedData: requestData\n00053|         });\n00054|         \n00055|       default:\n00056|         console.log('‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –º–µ—Ç–æ–¥:', method);\n00057|         return NextResponse.json({ error: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –º–µ—Ç–æ–¥', method }, { status: 400 });\n00058|     }\n00059|     \n00060|     console.log('üåê –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ –ü–≠–ö:');\n00061|     console.log('URL:', url);\n00062|     console.log('Body:', JSON.stringify(body, null, 2));\n00063|     console.log('Headers: Content-Type: application/json, Authorization: Bearer [TOKEN]');\n00064|     \n00065|     const response = await fetch(url, {\n00066|       method: 'POST',\n00067|       headers: {\n00068|         'Content-Type': 'application/json',\n00069|         'Authorization': `Bearer ${PEK_TOKEN}`,\n00070|       },\n00071|       body: JSON.stringify(body)\n00072|     });\n00073|     \n00074|     console.log('üì° –û—Ç–≤–µ—Ç –æ—Ç –ü–≠–ö API:');\n00075|     console.log('Status:', response.status, response.statusText);\n00076|     console.log('Headers:', Object.fromEntries(response.headers.entries()));\n00077|     \n00078|     if (!response.ok) {\n00079|       const errorText = await response.text();\n00080|       console.error('‚ùå –ü–≠–ö API –æ—à–∏–±–∫–∞:', response.status, response.statusText);\n00081|       console.error('‚ùå –û—Ç–≤–µ—Ç:', errorText.substring(0, 1000));\n00082|       \n00083|       return NextResponse.json({ \n00084|         error: `–ü–≠–ö API –æ—à–∏–±–∫–∞: ${response.status} ${response.statusText}`,\n00085|         details: errorText,\n00086|         url,\n00087|         method,\n00088|         requestBody: body\n00089|       }, { status: response.status });\n00090|     }\n00091|     \n00092|     const responseText = await response.text();\n00093|     console.log('‚úÖ –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç –ü–≠–ö:', responseText.substring(0, 500));\n00094|     \n00095|     try {\n00096|       const data = JSON.parse(responseText);\n00097|       return NextResponse.json(data);\n00098|     } catch (parseError) {\n00099|       console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', parseError);\n00100|       return NextResponse.json({ \n00101|         error: '–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞',\n00102|         details: responseText\n00103|       }, { status: 500 });\n00104|     }\n00105|     \n00106|   } catch (error) {\n00107|     console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–æ–∫—Å–∏ –ü–≠–ö API:', error);\n00108|     \n00109|     if (error instanceof Error) {\n00110|       console.error('Stack trace:', error.stack);\n00111|     }\n00112|     \n00113|     return NextResponse.json({ \n00114|       error: '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞',\n00115|       details: error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞',\n00116|       type: error instanceof Error ? error.name : 'Unknown',\n00117|       stack: error instanceof Error ? error.stack : undefined\n00118|     }, { status: 500 });\n00119|   }\n00120| }\n</file>",
    "metadata": {
      "preview": "import { NextRequest, NextResponse } from 'next/server';\n\nexport async function POST(request: NextRequest) {\n  try {\n    console.log('üîß –ü–≠–ö –ü—Ä–æ–∫—Å–∏: –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å');\n    \n    const requestData = await request.json();\n    console.log('üìù –î–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞:', JSON.stringify(requestData, null, 2));\n    \n    const { method, address, coordinates } = requestData;\n    \n    const PEK_TOKEN = '624FC93CA677B23673BB476D4982294DC27E246F';\n    const BASE_URL = 'https://api.pecom.ru/v1';\n    \n    let url = '';\n    let body = {};\n    \n    switch (method) {\n      case 'findzonebyaddress':\n        url = `${BASE_URL}/branches/findzonebyaddress/`;"
    },
    "title": "app/api/pek/route.ts",
    "time": {
      "start": 1758905147294,
      "end": 1758905147300
    }
  }
}