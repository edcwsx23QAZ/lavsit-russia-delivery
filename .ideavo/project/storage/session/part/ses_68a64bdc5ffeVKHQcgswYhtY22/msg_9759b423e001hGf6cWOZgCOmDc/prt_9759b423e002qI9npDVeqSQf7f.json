{
  "id": "prt_9759b423e002qI9npDVeqSQf7f",
  "type": "text",
  "text": "Создай страницу с названием \"Междугородняя доставка Лавсит\"\nВ левой части страницы должны быть заполняемые поля типа\nГруз №1\nДлина\nШирина\nВысота\nВес\nДобавить груз\n\nГород отправления\nАдрес отправления\nГород доставки\nАдрес доставки\n\nПри вводе города или адреса должна всплывать автоподсказка\nДля ввода адреса клиента необходимо добавить автоподсказки и заполнения адресов используя следующий API\nhttps://dadata.ru/api/suggest/address/\nКлюч: eb87bbb3789bb43ed465f796892ea951f9e91008\n\nЗадержка при всплытии автоподсказки должна быть не более 50мс\n\nОбъявленная стоимость\n\nТребуется ли упаковка (да/нет)\nТребуется ли погрузка/разгрузка (да/нет)\nТребуется ли подъем (да/нет)\nЕсли требуется подъем, то должно быть открывающеся окно ниже в полями \"этаж\" и \"наличие грузового лифта (да/нет)\n\nНиже должна быть кнопка \"рассчитать\"\n\nПосле нажатия кнопки \"рассчитать\" страница должна передавать данные в несколько транспортных компаний и возвращать их ответ в окнах слева, показывая цену, срок доставки и т.д. \n\nОбращение к каждой ТК должно иметь отдельный код, логику и структуру чтобы корректно работать\n\nСтраница должна обращаться через API к Деловым Линиям по правилам\nhttps://dev.dellin.ru/api/\nhttps://dev.dellin.ru/api/calculation/calculator/\n\nКлюч приложения: E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B\n\nСтраница должна обращаться к ПЭК через публичный API\nhttps://pecom.ru/business/developers/api_public/\n\nСтраница должна обращаться к Nord Wheel через публичный API:\nhttps://nordw.ru/tools/api/\n\nСтраница должна обращаться к Rail Continent через публичный API:\nhttps://www.railcontinent.ru/services/prochie-gruzoperevozki/forshop/api-manual/\n\nПорядок окон с расчетами должен начинаться от меньшей стоимости к большей\n\nСтраница должна быть оформлена в современном стиле, иметь темную тему. \nВся вводимая информация должна быть доступна на одном экране, без необходимости скроллинга. \n\nВся последняя вводимая информация должна сохраняться при обновлении страницы. \nТакже страница должна иметь кнопку \"сохранить расчет в PDF\" которая могла бы сохранить скриншот страницы в формате PDF на локальный компьютер\n\nВ разделе \"Маршрут\" добавь галочки \"доставка до терминала\" и \"доставка до адреса\", а также \"отправление от терминала\" и \"отправление от адреса\"\n\n\nВ случае отправления/доставки до адреса пусть появляются окна \"адрес отправления\" и \"адрес доставки\" соответственно\n\nТакже проведи глубокий анализ передаваемой информации. В форме заполняются размеры в сантиметрах. Для каждой службы доставки соотнеси, что размеры передаются правильно. Возможно разные ТК принимают данные в разной форме. Проведи анализ всех передаваемых данных, и для каждой ТК сделай отдельный процесс их передачи и при необходимости конвертации (например сантиметры в метры или килограммы в тонны)\n\nТакже по каждой ТК проведи глубокую проверку достаточности информации для расчета. Если необходимо ввести дополнительные поля для ввода, добавь их. Если в отдельных ТК есть пункты, которые нужно указывать при расчете, добавь их в форму или сделай в виде всплывающего запроса\n\nТакже проведи глубокий анализ передаваемой информации. В форме заполняются размеры в сантиметрах. Для каждой службы доставки соотнеси, что размеры передаются правильно. Возможно разные ТК принимают данные в разной форме. Проведи анализ всех передаваемых данных, и для каждой ТК сделай отдельный процесс их передачи и при необходимости конвертации (например сантиметры в метры или килограммы в тонны)\n\nТакже по каждой ТК проведи глубокую проверку достаточности информации для расчета. Если необходимо ввести дополнительные поля для ввода, добавь их. Если в отдельных ТК есть пункты, которые нужно указывать при расчете, добавь их в форму или сделай в виде всплывающего запроса\n\nТеперь сделай следующее условие:\n1. Всегда добавляем для каждой ТК в расчет упаковку (\"жесткая обрешетка + амортизация\" или \"защитная транспортная упаковка\" или другие названия обрешетки\n2. Всегда добавляем во всех ТК в расчет страховку на полную объявленную стоимость\n3. Во всех ТК отдельно проверь заполнение адреса погрузки и адреса разгрузки. Обязательно проверь, что расчет учитывает отправление и/или доставку \"от терминала\" или \"от адреса\"\n4. В форме в разделе \"маршрут\" поменяй местами поля\nПосле выбора \"Отправление \"от терминала/от адреса\" должно идти поле \"адрес отправления. Только после этого строка \"Доставка\" с выбором \"до терминала/до адреса\"\n5. Сделай отдельно под списком всех расчетов список всех ТК которые сейчас подключены в формате название/логотип, даже если какие-то из них не дали расчет. Это будет список всех подключенных ТК\n\nНа примере расчета Деловых Линий проверь в чем может быть причина расхождения расчета и предложи варианты исправления.\nПример расчета прикладываю в виде фото. Расчет аналогичен последнему проведенному в форме\n\nТакже для каждого расчета добавь кнопку \"показать подробнее\".\nЕсли транспортная компания возвращает более подробный расчет, его должно быть возможно посмотреть после нажатия кнопки \"посмотреть подробнее\"\n\nТакже сделай так, чтобы жесткая обрешетка добавлялась только если поставлена галочка \"требуется упаковка\"\nСтраховка должна включаться только если поставлена галочка \"Требуется страховка\"\nДополни код следующим:\n1. Для каждой ТК сделай кнопку при нажатии на которую можно будет увидеть всю информацию по отправленному запросу и полученному ответа от ТК включая пункты, которые сейчас могут не отображаться\n2. Для Деловых Линий проверь что мы получаем sessionID\nМожешь использовать логин/пароль\nлогин: service@lavsit.ru\nпароль: edcwsx123QAZ\n3. Для каждой ТК сделай расчет негабаритного веса и размера автоматическим по отдельным правилам для каждой ТК. Соответственно убери флаг по негабаритам.\n4. Если указана стоимость груза пусть страховка ставится автоматически. \n\nСкорректируй API запрос в Деловые Линии\n\nФорма запроса должна быть такой:\n\n{\n   \"appkey\":\"00000000-0000-0000-0000-000000000000\",\n   \"sessionID\":\"00000000-0000-0000-0000-000000000000\",\n   \"delivery\":{\n      \"deliveryType\":{\n         \"type\":\"express\"\n      },\n      \"arrival\":{\n         \"variant\":\"terminal\",\n         \"terminalID\":\"1\",\n         \"addressID\":238577,\n         \"address\":{\n            \"search\":\"59.924501, 30.241762\",\n            \"street\":\"7800000000008850000000000\",\n            \"house\":\"5\",\n            \"building\":\"1\",\n            \"structure\":\"лит.А\",\n            \"flat\":\"214а\"\n         },\n         \"city\":\"7800000000000000000000000\",\n         \"time\":{\n            \"worktimeStart\":\"9:30\",\n            \"worktimeEnd\":\"19:00\",\n            \"breakStart\":\"12:00\",\n            \"breakEnd\":\"13:00\",\n            \"exactTime\":false\n         },\n         \"handling\":{\n            \"freightLift\":true,\n            \"toFloor\":2,\n            \"carry\":50\n         },\n         \"requirements\":[\n            \"0x9951e0ff97188f6b4b1b153dfde3cfec\",\n            \"0x88f93a2c37f106d94ff9f7ada8efe886\"\n         ]\n      },\n      \"derival\":{\n         \"produceDate\":\"2019-11-08\",\n         \"variant\":\"address\",\n         \"terminalID\":\"1\",\n         \"addressID\":238577,\n         \"address\":{\n            \"search\":\"Москва, Юности, 5\",\n            \"street\":\"7700000000004650000000000\",\n            \"house\":\"5\",\n            \"building\":\"2\",\n            \"structure\":\"лит.Б\",\n            \"flat\":\"21\"\n         },\n         \"time\":{\n            \"worktimeEnd\":\"19:30\",\n            \"worktimeStart\":\"9:00\",\n            \"breakStart\":\"12:00\",\n            \"breakEnd\":\"13:00\",\n            \"exactTime\":false\n         },\n         \"handling\":{\n            \"freightLift\":true,\n            \"toFloor\":40,\n            \"carry\":243\n         },\n         \"requirements\":[\n            \"0x9951e0ff97188f6b4b1b153dfde3cfec\",\n            \"0x88f93a2c37f106d94ff9f7ada8efe886\"\n         ]\n      },\n      \"packages\":[\n         {\n            \"uid\":\"0xa6a7bd2bf950e67f4b2cf7cc3a97c111\",\n            \"count\":1\n         }\n      ],\n      \"accompanyingDocuments\":[\n         {\n            \"action\":\"send\"\n         },\n         {\n            \"action\":\"return\"\n         }\n      ]\n   },\n   \"members\":{\n      \"requester\":{\n         \"role\":\"sender\",\n         \"uid\":\"ae62f076-d602-4341-b691-45bf8dfe4a10\"\n      }\n   },\n   \"cargo\":{\n      \"quantity\":4,\n      \"length\":1,\n      \"width\":1,\n      \"height\":1,\n      \"weight\":12,\n      \"totalVolume\":1,\n      \"totalWeight\":12,\n      \"oversizedWeight\":0,\n      \"oversizedVolume\":0,\n      \"freightUID\":\"0x82e6000423b423b711da7d15445d42cb\",\n      \"hazardClass\":7.2,\n      \"insurance\":{\n         \"statedValue\":15477.34,\n         \"term\":false\n      }\n   },\n   \"payment\":{\n      \"type\":\"cash\",\n      \"promocode\":\"promo123\",\n      \"paymentCity\":\"7700000000000000000000000\",\n      \"paymentCitySearch\":{\n         \"search\":\"Москва\"\n      }\n   } \n}\n\nПеременные для запроса нужно брать из формы.\n\nАдрес метода: https://api.dellin.ru/v2/calculator.json \n\nСтруктура ответа из которой следует брать данные для ответа должна быть следующей:\n\n{\n   \"metadata\":{\n      \"status\":200,\n      \"generated_at\":\"2019-11-25 08:16:47\"\n   },\n   \"data\":{\n      \"derival\":{\n         \"terminal\":\"Санкт-Петербург\",\n         \"price\":475,\n         \"contractPrice\":false,\n         \"servicePrice\":475,\n         \"premiumDetails\":[\n            \n         ],\n         \"terminals\":[\n            \n         ],\n         \"handling\":{\n            \"price\":0,\n            \"contractPrice\":false,\n            \"premium\":0,\n            \"discount\":0,\n            \"premiumDetails\":[\n               \n            ],\n            \"discountDetails\":[\n               \n            ]\n         },\n         \"contractPrice\":false\n      },\n      \"intercity\":{\n         \"price\":null,\n         \"contractPrice\":true,\n         \"premium\":0,\n         \"discount\":0,\n         \"premiumDetails\":[\n            \n         ],\n         \"discountDetails\":[\n            \n         ]\n      },\n      \"small\":{\n         \"price\":540,\n         \"contractPrice\":false,\n         \"premium\":0,\n         \"discount\":0,\n         \"premiumDetails\":[\n            \n         ],\n         \"discountDetails\":[\n            \n         ]\n      },\n      \"air\":{\n         \"price\":540,\n         \"contractPrice\":false,\n         \"premium\":0,\n         \"discount\":0,\n         \"premiumDetails\":[\n            \n         ],\n         \"discountDetails\":[\n            \n         ]\n      },\n      \"express\":{\n         \"price\":540,\n         \"contractPrice\":false,\n         \"premium\":0,\n         \"discount\":0,\n         \"premiumDetails\":[\n            \n         ],\n         \"discountDetails\":[\n            \n         ]\n      },\n      \"letter\":{\n         \"price\":540,\n         \"contractPrice\":false,\n         \"premium\":0,\n         \"discount\":0,\n         \"premiumDetails\":[\n            \n         ],\n         \"discountDetails\":[\n            \n         ]\n      },\n      \"arrival\":{\n         \"terminal\":\"Чита\",\n         \"price\":0,\n         \"contractPrice\":false,\n         \"premiumDetails\":[\n            {\n               \"name\":\"Экспедирование до клиента график доставки\",\n               \"value\":2000,\n               \"date\":null,\n               \"announcement\":false,\n               \"public\":true\n            }\n         ],\n         \"terminals\":[\n            {\n               \"id\":\"104\",\n               \"name\":\"Чита\",\n               \"address\":\"Чита, Сухая Падь ул., 3\",\n               \"streetCode\":\"7500000100008350000000000\",\n               \"price\":0,\n               \"contractPrice\":false,\n               \"default\":true,\n               \"express\":false,\n               \"isPVZ\":false\n            }\n         ],\n         \"contractPrice\":false\n      },\n      \"price\":1680,\n      \"priceMinimal\":\"auto\",\n      \"packages\":{\n         \n      },\n      \"orderDates\":{\n         \"pickup\":\"2019-11-26\",\n         \"senderAddressTime\":null,\n         \"senderTerminalTime\":null,\n         \"arrivalToOspSender\":null,\n         \"derrivalFromOspSender\":\"2019-11-26\",\n         \"arrivalToOspReceiver\":null,\n         \"arrivalToAirport\":\"2019-11-28\",\n         \"arrivalToAirportMax\":\"2019-11-29\",\n         \"giveoutFromOspReceiver\":\"2019-11-28 00:00:00\",\n         \"giveoutFromOspReceiverMax\":\"2019-11-29 00:00:00\",\n         \"derrivalFromOspReceiver\":null,\n         \"createTo\":null,\n         \"derrivalToAddress\":null,\n         \"derivalToAddressMax\":null\n      },\n      \"deliveryTerm\":0,\n      \"accompanyingDocuments\":{\n         \"send\":{\n            \"price\":200,\n            \"contractPrice\":false,\n            \"premium\":0,\n            \"discount\":0,\n            \"premiumDetails\":[\n               \n            ],\n            \"discountDetails\":[\n               \n            ]\n         },\n         \"return\":{\n            \"price\":200,\n            \"contractPrice\":false,\n            \"premium\":0,\n            \"discount\":0,\n            \"premiumDetails\":[\n               \n            ],\n            \"discountDetails\":[\n               \n            ]\n         }\n      },\n      \"insurance\":250,\n      \"insuranceComponents\":{\n         \"cargoInsurance\":200,\n         \"termInsurance\":50\n      },\n      \"notify\":{\n         \"price\":15,\n         \"contractPrice\":false,\n         \"premium\":0,\n         \"discount\":0,\n         \"premiumDetails\":[\n            \n         ],\n         \"discountDetails\":[\n            \n         ]\n      },\n      \"simpleShippingAvailable\":true,\n      \"availableDeliveryTypes\":{\n         \"auto\":480.0,\n         \"small\":549.0,\n         \"avia\":4230.0,\n         \"express\":620.0,\n         \"letter\":null\n      },\n      \"foundAddresses\":[\n         {\n            \"field\":\"delivery.derival.address\",\n            \"source\":\"199106, Россия, Санкт-Петербург, Санкт-Петербург, Кожевенная линия, дом 40\",\n            \"result\":\"199106, Россия, г Санкт-Петербург, линия Кожевенная, дом 40\"\n         },\n         {\n            \"field\":\"delivery.arrival.address\",\n            \"source\":\"Москва, Юности, 5\",\n            \"result\":\"Россия, Московская обл, г Москва, ул Юности, д 5\"\n         },\n         {\n            \"field\":\"payment.paymentCitySearch\",\n            \"source\":\"Москва\",\n            \"result\":\"Россия, Московская обл, г Москва\"\n         }\n      ],\n      \"information\":[\n         \"После оформления заказа наш специалист свяжется с Вами для утверждения стоимости\"\n      ]\n   }\n} \n\nLovable\nWorked for 1m 30s\n8:53 AM on Sep 23\n\nThought for 7 seconds\nОбновлю API запрос к Деловым Линиям согласно новой структуре.\n\nShow all\n2 edits made\nОбновил API запрос к Деловым Линиям согласно новой структуре - теперь используется правильный URL, структура запроса с полями delivery/cargo/payment и корректный парсинг ответа.\n\n\nRestore\n\nCode\n\nRefactor Dellin API request\nPreview\n\n\n\n\nСейчас в данные запроса к API ничего не попадает. Судя по отладочной информации там null\n\nПроверь и исправь код так, чтобы в данные запроса попадала заполненная на основании введенных данных форма запроса к Деловым Линиям\nLovable\nWorked for 1m 25s\n8:56 AM on Sep 23\n\nThought for 8 seconds\nПроверю код формирования данных запроса к Деловым Линиям и исправлю проблему.\n\nShow all\n3 edits made\nИсправил код так, чтобы данные запроса к Деловым Линиям всегда формировались и попадали в отладочную информацию. Теперь requestData формируется независимо от получения sessionID и содержит все данные из формы: города, адреса, параметры груза, страховку и тип доставки.\n\n\nRestore\n\nCode\n\nFix: Ensure API request data is populated\nPreview\n\nTroubleshooting docs\n\n\n\nСкорректируй код API Деловых Линий\nДобавь авторизацию перед отправкой запроса API:\n\nАдрес метода: https://api.dellin.ru/v3/auth/login.json\n\n{\n   \"appkey\":\"00000000-0000-0000-0000-000000000000\",\n   \"login\":\"+79999999999\",\n   \"password\":\"Password1\"\n}\n\nappkey: E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B\nлогин: service@lavsit.ru\nпароль: edcwsx123QAZ\n\nСкорректируй код API Деловых Линий\nДобавь авторизацию перед отправкой запроса API:\n\nАдрес метода: https://api.dellin.ru/v3/auth/login.json\n\n{\n   \"appkey\":\"00000000-0000-0000-0000-000000000000\",\n   \"login\":\"+79999999999\",\n   \"password\":\"Password1\"\n}\n\nappkey: E6C50E91-8E93-440F-9CC6-DEF9F0D68F1B\nлогин: service@lavsit.ru\nпароль: edcwsx123QAZ\n\nПроверь что обмен с API Деловых Линий соответствует всем правилам\nhttps://dev.dellin.ru/api/calculation/calculator/",
  "messageID": "msg_9759b423e001hGf6cWOZgCOmDc",
  "sessionID": "ses_68a64bdc5ffeVKHQcgswYhtY22"
}